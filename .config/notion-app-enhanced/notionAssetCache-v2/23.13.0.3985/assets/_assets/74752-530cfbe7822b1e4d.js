"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[74752],{574752:(e,t,r)=>{r.r(t),r.d(t,{ENGLISH_PERSONAL_PRONOUNS:()=>Ne,TEST_ONLY__getVisibleSpaceUserIds:()=>Be,checkIsTrashEmpty:()=>he,getLocalCacheFromAppState:()=>ae,getSpaceBotIds:()=>be,isPersonalPronoun:()=>Ce,searchActorsById:()=>Ve,searchCollections:()=>ye,searchCollectionsWithRecents:()=>ge,searchEmailUser:()=>Fe,searchInstallableIntegrations:()=>Pe,searchLocalNavigableBlocks:()=>Se,searchMentionablePages:()=>xe,searchPageIds:()=>oe,searchPageIdsInAncestor:()=>me,searchPagesInAncestor:()=>de,searchPagesInCollection:()=>ce,searchPagesInSpace:()=>ie,searchPagesWithParent:()=>le,searchPublicPages:()=>Me,searchSpaceActorIds:()=>Ue,searchSpaceActors:()=>Te,searchSpaceBots:()=>ve,searchSpaceGroups:()=>fe,searchSpaceUsers:()=>Ae,searchTeams:()=>Re,searchTrashPages:()=>pe,searchUsers:()=>_e,searchUsersByNameWithNoSpaces:()=>qe,searchVisibleSpaceUsers:()=>ke});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(581454);var s=r.n(r(844751)),n=()=>r(799288),a=()=>r(842599),i=()=>r(617871),o=()=>r(857639),c=()=>r(792071),l=()=>r(142748),u=()=>r(68263),d=()=>r(388821),m=()=>r(861017),p=()=>r(179034),h=()=>r(824862),y=()=>r(519831),g=()=>r(96689),S=()=>r(798880),f=()=>r(245241),v=()=>r(468006),b=()=>r(919709),I=()=>r(695608),P=()=>r(778078),w=()=>r(496603),_=()=>r(763824),q=()=>r(498212),A=()=>r(973647),k=()=>r(534177),E=()=>r(720665),C=()=>r(449506),N=()=>r(908928),B=()=>r(2220),T=()=>r(518362),U=()=>r(780054),F=()=>r(186445),V=()=>r(47373),x=()=>r(108944),O=()=>r(731320),M=()=>r(825972),R=()=>r(780865),z=()=>r(698449),W=()=>r(406792),L=()=>r(696746),D=()=>r(765957),H=()=>r(227440),G=()=>r(605402),X=()=>r(21735),j=()=>r(217429),Q=()=>r(968172),J=()=>r(20199),$=()=>r(558407),K=()=>r(630116),Y=()=>r(271084),Z=()=>r(224701),ee=()=>r(134217),te=()=>r(749240),re=()=>r(52395),se=()=>r(690978),ne=()=>r(448433);async function ae(e){let{environment:t,localSearchAnalytics:r}=e;const{currentSpaceStore:s,currentSpaceViewStore:n}=D().default.state;if(!s)return;const a=j().default.checkGate({gateName:"search_use_local_search_cache",disableEventTrailLogging:!1}),i=j().default.checkGate({gateName:"timeout_for_local_searchable_blocks_cache",disableEventTrailLogging:!1});if(a){if((0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"use_local_search_cache_before"}}),J().A.state.localSearchableBlocksCache)return(0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"use_local_search_cache_already_loaded"}}),J().A.state.localSearchableBlocksCache;if((0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"use_local_search_cache_before_loading"}}),i)try{await Promise.race([J().A.waitUntil((()=>Boolean(J().A.state.localSearchableBlocksCache))),new Promise(((e,t)=>setTimeout((()=>t(new Error("Cache load timeout"))),2e3)))])}catch(o){return void(0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"use_local_search_cache_timed_out"}})}else await J().A.waitUntil((()=>Boolean(J().A.state.localSearchableBlocksCache)));return(0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"use_local_search_cache_after_loading"}}),J().A.state.localSearchableBlocksCache}return(0,re().F)({environment:t,localSearchAnalytics:r,eventProperties:{search_step:"get_searchable_blocks_before"}}),await(0,ne().h)({environment:t,currentSpaceStore:s,currentSpaceViewStore:n,localSearchAnalytics:r})}async function ie(e){const{environment:t,query:r,limit:s,currentPageId:n,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:o,spaceId:c,requireEditPermissions:l,excludeTemplates:u,source:m,boostRecentlyViewedPages:p,ignoresHighlight:h,filterOverrides:y,spaceStore:g}=e,S={results:[],recordMap:d().RecordMapWithRole.create().toJson(),total:0,trackEventProperties:void 0};if(!g)return S;const v=await ae({environment:t}),b=f().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:u,requireEditPermissions:l||void 0,...y}),I={field:"relevance"};if(!r&&v){const e=(0,se().k)({query:{query:{text:r,filters:b,sort:I},limit:s},localCachedPages:v,userId:t.currentUser.id,environment:t,spaceStore:g});return e||S}const P=await C().callApi({eventName:"search",environment:t,data:{type:f().Vz.BlocksInSpace,query:r,spaceId:c,currentPageId:n,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:o,limit:s,filters:b,sort:I,source:m,recentPagesForBoosting:p?(0,M().cs)(Q().A.getWithoutSubscribing(c)):void 0,ignoresHighlight:h}});if("failed"===P.type)throw P.error;return P.data}async function oe(e){const t=await ie(e);return{results:t.results.map((e=>e.id)),recordMap:t.recordMap}}async function ce(e){const{environment:t,query:r,collectionId:s,limit:n,spaceId:a,excludeTemplates:i,source:o,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:l,ignoresHighlight:u,localSearchAnalytics:d}=e,m=new Array;if(d){const e=JSON.stringify(localStorage).length/1024;(0,re().F)({environment:t,localSearchAnalytics:d,eventProperties:{search_step:"load_records_before",local_storage_size_kb:Math.trunc(e)}})}const p=await ae({environment:t,localSearchAnalytics:d});(0,re().F)({environment:t,localSearchAnalytics:d,eventProperties:{search_step:"load_records_after"}});const h=f().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:i}),g={field:"relevance"},S=C().callApi({eventName:"search",environment:t,data:{type:f().Vz.BlocksInCollection,query:r,spaceId:a,collectionId:s,limit:n,filters:h,sort:g,source:o,recentPagesForBoosting:l?(0,M().cs)(Q().A.getWithoutSubscribing(a)):void 0,ignoresHighlight:u}});if(p){const e={table:y().Vl,id:s,spaceId:a},i=new(K().md)(t,e);await i.load();const o=(0,se().k)({query:{query:{text:r,filters:i.isPageTreeCollection()?{...h,ancestors:[s]}:{...h,parentId:s},sort:g},limit:n},localCachedPages:p,userId:t.currentUser.id,environment:t,spaceStore:i.getSpaceStore()});o&&m.push(...o.results)}const v=await S;if("failed"===v.type){if(0===m.length)throw v.error}else{let e=v.data.results;r||(e=R().Fj({sort:g,batchSize:n,currentUserId:t.currentUser.id,unsorted:e})),m.push(...e)}return{results:w().oE(w().sb(m.map((e=>e.id))))}}async function le(e){const{environment:t,query:r,parentId:s,limit:n,spaceId:a,excludeTemplates:i,source:o,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:l,ignoresHighlight:u}=e,[d,m]=await Promise.all([C().callApi({eventName:"search",environment:t,data:{type:f().Vz.BlocksInParent,query:r,spaceId:a,parentId:s,limit:n,filters:f().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:i}),sort:{field:"relevance"},source:o,recentPagesForBoosting:l?(0,M().cs)(Q().A.getWithoutSubscribing(a)):void 0,ignoresHighlight:u}}),ue(e)]);if("failed"===d.type)throw d.error;return{results:w().oE(w().sb([m,...d.data.results.map((e=>e.id))]))}}async function ue(e){const{environment:t,query:r,parentId:s,spaceId:n}=e,a=(0,m().parseRoute)({url:r,baseUrl:U().A.domainBaseUrl,publicDomainName:U().A.publicDomainName,isMobile:t.device.isMobile,protocol:U().A.protocol,currentUrl:window.location.href}),i="page"===a.name?a.peekViewBlockId||a.blockId:void 0,o=((0,q().c_)(r)?(0,q().np)(r):void 0)||i;if(o){const e={table:p().ev,id:o},r=new(K().Bv)(t,e);await r.load();const a=r.id,i=r.getParentId(),c=r.getSpaceId();if(i===s&&c===n)return a}}async function de(e){const{environment:t,query:r,ancestorId:s,limit:n,excludeTemplates:a,source:i,currentPageId:o,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:u,ignoresHighlight:d,includePublicPagesWithoutExplicitAccess:m,spaceId:p}=e,h=await C().callApi({eventName:"search",environment:t,data:{type:f().Vz.BlocksInAncestor,query:r,ancestorId:s,filters:f().N2({navigableBlockContentOnly:!0,excludeTemplates:a,includePublicPagesWithoutExplicitAccess:m}),sort:{field:"relevance"},limit:n,source:i,spaceId:p,currentPageId:o,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:u,ignoresHighlight:d}});if("failed"===h.type)throw h.error;return h.data}async function me(e){return{results:(await de(e)).results.map((e=>e.id))}}async function pe(e){const{environment:t,query:r,limit:s,spaceId:n}=e,a=0===r.trim().length?{field:"lastEdited",direction:"desc"}:{field:"relevance"},i={query:r,filters:f().N2({isDeletedOnly:!0,navigableBlockContentOnly:!0,excludeTemplates:!1,editedBy:e.editedByIds||[],ancestors:e.ancestorIds||[],inTeams:e.teamspaceIds||[]}),sort:a,limit:s,spaceId:n,source:"trash"},o=C().callApi({eventName:"search",environment:t,data:{type:f().Vz.BlocksInSpace,...i}}),c=await o;if("failed"===c.type)throw c.error;{const{results:e,recordMap:t,total:r}=c.data;return{results:e.map((e=>e.id)),recordMap:d().RecordMapWithRole.create(t),endOfResultsReached:r===e.length}}}async function he(e){const{currentSpaceStore:t,currentUserStore:r}=D().default.state;if(!t||!r)return!1;return 0===(await pe({environment:e,query:"",limit:1,spaceId:t.id,ancestorIds:[],editedByIds:[],teamspaceIds:[]})).results.length}async function ye(e,t){const{query:r,limit:s,source:n,requireEditPermissions:a,databaseType:i,spaceStore:o,searchSessionId:c}=t;if(!o)return{results:[],total:0};const l=o.id,[u,d]=await Promise.all([ze(e,{...t,spaceId:l,requireEditPermissions:a,databaseType:i,parentStore:o}),C().callApi({eventName:"search",environment:e,data:{type:f().Vz.CollectionsInSpace,query:r,spaceId:l,limit:s,filters:{...f().N2({excludeTemplates:!0,requireEditPermissions:a,databaseType:i})},sort:{field:"relevance"},source:n,recentPagesForBoosting:(0,M().cs)(Q().A.get(l)),searchSessionId:c}})]),m=w().KC("success"===d.type?w().oE(d.data.results.map((e=>e.collectionId))):[],u).slice(0,s);return{results:m,total:"success"===d.type?d.data.total:m.length}}async function ge(e){const{environment:t,collectionViewBlockStore:r,spaceStore:s,parentStore:n,query:a,limit:i,requireEditPermissions:o,databaseType:c,searchSessionId:l}=e;let u=[],d=0;if(!a){const e=t.currentUser.id;s&&(u=[...(0,T().F)({currentUserId:e,spaceId:s.id}).map((e=>K().md.createChildStore(n,{table:y().Vl,id:e})))]),u=[...w().oE(null==r?void 0:r.getCollectionViewStores().map((e=>e.getCollectionStore()))),...u],c&&(u=u.filter((e=>{const t=e.getDatabaseType();return!!t&&c.includes(t)}))),u=w().hS(u,(e=>e.id)).filter((e=>!o||e.canEdit()))}const m=await ye(t,{query:a,limit:i,source:"collection_settings_source",requireEditPermissions:o,databaseType:c,spaceStore:s,searchSessionId:l});return u=[...u,...m.results.map((e=>K().md.createChildStore(n,{table:y().Vl,id:e})))],d=m.total,u=u.filter((e=>!(0,x().ze)(e)&&e.canRead())),await Promise.all(u.map((async e=>{await e.load()}))),{results:w().hS(u,(e=>e.id)).slice(0,i).map((e=>e.id)),total:d}}async function Se(e){const{environment:t,searchQuery:r,blockTypes:s,currentSpaceStore:n,currentSpaceViewStore:a,limit:i,parentId:o}=e,c=await(0,ne().h)({environment:t,currentSpaceStore:n,currentSpaceViewStore:a}),l={query:{text:r,filters:(0,f().N2)({requireEditPermissions:!1,isDeletedOnly:!1,excludeTemplates:!0,navigableBlockContentOnly:!0,blockTypes:s,parentId:o}),sort:{field:"relevance"}},limit:i},u=(0,se().r)({query:l,localCachedPages:c,parentStore:n,spaceStore:n,isOnline:H().A.state.online,environment:t,shouldLimitLocalResultsWhenOnline:!1,applyScoreThresholdWhenOnline:!0,canUseLtr:!1});return u&&A().Q.isSuccess(u)?u.value.results.filter((e=>e.store.pathIsAccessibleAndAlive())):[]}function fe(e){const{query:t,intl:r,limit:s}=e,n=G().A.state.permissionGroupsAndMemberCounts.map((e=>e.group));if(0===n.length)return[];return(t?(0,P().Ay)(t,n,(e=>(0,z().Pf)({intl:r,groupName:e.name})),{normalizeFuzzyScore:!0}):n).slice(0,s)}async function ve(e){const{query:t,limit:r}=e,{currentSpaceStore:s}=D().default.state;if(!s)return[];return Ie({parentStore:s,query:t,botIds:await be(e)}).slice(0,r)}async function be(e){const{environment:t}=e,{currentSpaceStore:r}=D().default.state;if(!r)return[];const s=r.id,n=await N().Ju({environment:t,table:g().NX,id:s,type:"guest"});return w().sb(n.botIds)}function Ie(e){const{parentStore:t,query:r,botIds:s}=e,a=w().oE(s.map((e=>{const r=t.table===g().NX?t.id:void 0;return(0,K().Oo)(t,{table:h().GP,id:e,spaceId:r}).getValue()})));return r?(0,P().Ay)(r,a,n().tb):a}async function Pe(e){const{query:t,environment:r,spaceId:s,botSettings:n}=e;if(!s)return[];const a=await C().callApi({eventName:"searchIntegrations",environment:r,data:{query:t}});if("success"===a.type){const e=a.data.integrationIds,t=n&&n.integration_approval_statuses?Object.keys(n.integration_approval_statuses):[],r=Boolean(null==n?void 0:n.integration_restrictions),s=Boolean("approved_or_built_by_notion"===(null==n?void 0:n.integration_restrictions));return r?e.filter((e=>s?t.includes(e)||(0,i().CX)({integrationId:e,env:"production"}):t.includes(e))):e}if("failed"===a.type)throw a.error;(0,k().HB)(a)}const we=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com"]);async function _e(e){var t;let{environment:r,parentStore:s,query:n,userIds:i,minFuzzyScore:c,placeSelfFirst:l}=e;const u=W().default.mark("user_search_latency"),d=j().default.checkGate({gateName:"search_batch_load_users"}),m=_().lX(i,d?300:Math.max(i.length,1),(async e=>{const t=K().LU.createChildStore(s,{table:S().oo,id:e});return await t.load(),t.getValue()}));(await(0,_().nQ)(1e4,[m])).timeout&&(o().log({level:"error",from:"searchActions.searchUsers",type:"UserStoreLoadTimeoutV1",error:{message:"The UserStore.load()'s took longer than 10 seconds"},data:{searchedUserIdCount:i.length,queryLength:n.length,parentStoreLoaded:s.isReady(),documentVisibilityState:document.visibilityState}}),(0,B().u)({environment:r,event:{eventName:"user_search_timeout",eventProperties:{searchedUserIdCount:i.length,queryLength:n.length,parentStoreLoaded:s.isReady(),documentVisibilityState:document.visibilityState}}}));const p=w().oE(await m);let h;const y=null===(t=D().default.state.currentUserStore)||void 0===t?void 0:t.userId;if(l&&y){const e=p.findIndex((e=>y===e.id));e>-1&&(h=p[e],p.splice(e,1))}const g=Y().k.state??{},f=Math.max(...Object.values(g));function v(e){var t;return e===(null===(t=D().default.state.currentUserRootStore)||void 0===t?void 0:t.userId)?f+1e-5:g[e]??0}const b=w().Im(g)?p:p.sort(((e,t)=>{const r=v(e.id);return v(t.id)-r})),q=new Set(s.getEmailDomains()),A=n?(0,P().Ay)(n,b,I().T2,{minThreshold:c,getSortScore:e=>{const{original:t,score:r}=e,s=t.email&&(0,a().zN)(t.email),n=h&&(0,a().zN)(h.email),i=s&&q.has(s),o=n===s,c=n&&we.has(n);return r*(i||o&&!c?-2:-1)}}):p;return W().default.measure(u,{environment:r}),h?[h,...A]:A}async function qe(e){const{environment:t,query:r,membersOnly:s,shouldUseEdgeCacheRollout:n}=e;if(n&&X().A.state.shouldUseEdgeCache){const e=D().default.state.currentSpaceStore;if(!e)return[];const n=await C().callApi({eventName:"listUsers",environment:t,data:{cursor:void 0,membershipFilter:s?"members":void 0,limit:1,uniqueNameWithoutSpaces:r,spaceId:e.id}});if("success"!==n.type||0===n.data.users.length)return[];const a=K().LU.createChildStore(e,{table:S().oo,id:n.data.users[0].id});await a.load();const i=a.getModel();return i?[i]:[]}return(await ke({environment:t,query:r,membersOnly:s})).map((e=>c().Bj6.fromValue(S().oo,e)))}async function Ae(e){return e.shouldUseEdgeCacheRollout&&X().A.state.shouldUseEdgeCache?async function(e){const{environment:t,membersOnly:r,minFuzzyScore:s=1e3,placeSelfFirst:n,limit:a}=e,{currentSpaceStore:i,mainEditorCurrentBlockStore:o,currentUserStore:c}=D().default.state;if(!i)return[];const l=e.query.startsWith("@")?e.query.slice(1):e.query,d=Y().k.getSortedUserIds().slice(0,100),m=o&&!r?(0,O().i0)(o).flatMap((e=>{let{permissionItem:t}=e;return(0,u().B2)(t)?[t.user_id]:[]})):[],p=await _e({environment:e.environment,parentStore:i,query:l,userIds:w().sb([...w().oE([null==c?void 0:c.userId]),...d,...m]),minFuzzyScore:s,placeSelfFirst:n});if(a&&p.length>=a)return p.slice(0,a);const h=await C().callApi({eventName:"listUsers",environment:t,data:{cursor:void 0,membershipFilter:r?"members":void 0,limit:a?a-p.length:100,query:l,spaceId:i.id}});if("success"!==h.type||0===h.data.users.length)return p;const y=h.data.users.sort(((e,t)=>{var r,s;const n=(null===(r=Y().k.state)||void 0===r?void 0:r[e.id])??0;return((null===(s=Y().k.state)||void 0===s?void 0:s[t.id])??0)-n})),g=await(0,_().lX)(y,y.length,(async e=>{const t=K().LU.createChildStore(i,{table:S().oo,id:e.id});return await t.load(),t.getValue()}));return w().hS([...p,...w().oE(g)],(e=>e.id))}(e):ke(e)}async function ke(e){const{currentSpaceStore:t}=D().default.state;if(!t)return[];const r=e.query.startsWith("@")?e.query.slice(1):e.query,s=await Ee(e);return(await _e({environment:e.environment,parentStore:t,query:r,userIds:s,minFuzzyScore:e.minFuzzyScore,placeSelfFirst:e.placeSelfFirst})).slice(0,e.limit)}async function Ee(e){const{environment:t,membersOnly:r}=e,{currentSpaceStore:s}=D().default.state;if(!s)return[];await Z().$D({environment:t,spaceId:s.id});const n=te().subscriptionDataStoreInstance.state;if(!n)return[];const a=(0,ee().Be)(n).filter((e=>!(r&&!(0,u().DH)(e.role)))),{mainEditorCurrentBlockStore:i,currentUserStore:o}=D().default.state,c=i&&!r?(0,O().i0)(i).flatMap((e=>{let{permissionItem:t}=e;return(0,u().B2)(t)?[t.user_id]:[]})):[],l=(0,V().Qd)()&&i?function(e,t){const r=x().Uo(e);if(r){const e=new Set((0,v().gm)({membership:r.getRawMembership()}));return t.filter((t=>"none"!==t.role||t.isPageGuest||t.isTeamGuest&&e.has(t.userId)))}return t.filter((e=>"none"!==e.role||e.isPageGuest))}(i,a):a,d=l.map((e=>e.userId));return w().sb([...w().oE([null==o?void 0:o.userId]),...c,...d])}function Ce(e,t){return!(!t.startsWith("en-")||!Ne.has(e.toLowerCase()))}const Ne=new Set(["me","you","i"]),Be=Ee;async function Te(e){const{query:t}=e,[r,s]=await Promise.all([Ae({...e,placeSelfFirst:""===t||Ce(t,e.userLocale)}),ve(e)]);return{users:r,bots:s}}async function Ue(e){const[t,r]=await Promise.all([Ee(e),be(e)]);return{userIds:t,botIds:r}}async function Fe(e,t){const r=(0,a().qh)(t);if((0,a().DT)(r)&&r){const t=await C().callApi({eventName:"findUser",environment:e,data:{email:r}});if("failed"===t.type)throw t.error;const s=t.data;return s.value?{user:s.value.value}:{email:r}}return{}}async function Ve(e){const{query:t,userIds:r,botIds:s,store:n,environment:a}=e;let i=n;if(!i){const{currentSpaceStore:e}=D().default.state;if(!e)return{users:[],bots:[]};i=e}return{users:await _e({environment:a,parentStore:i,query:t,userIds:r}),bots:Ie({parentStore:i,query:t,botIds:s})}}async function xe(e){const{nearBlock:t,environment:r,query:s,source:n,searchSessionId:a,searchSessionFlowNumber:i}=e,{currentSpaceStore:o}=D().default.state,c=(0,F().s0)(),l=t&&(0,O().i0)(t).find((e=>{let{permissionItem:t}=e;return(0,u().FP)(t)})),d=$().A.getMentionedIds(r.currentUser.id);if(o){return Oe(await ie({environment:r,query:s,limit:20,spaceId:o.id,currentPageId:c,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:d,requireEditPermissions:!1,excludeTemplates:!0,source:n,boostRecentlyViewedPages:!0,ignoresHighlight:!0,spaceStore:o}))}if(l&&l.from.table===p().ev){return Oe(await de({environment:r,query:s,limit:20,ancestorId:l.from.blockId,excludeTemplates:!0,source:n,currentPageId:c,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:d,ignoresHighlight:!0}))}return[]}function Oe(e){const{trackEventProperties:t,results:r}=e,s=(0,E().MU)((0,k().WP)(t).map((e=>{let[t,r]=e;return[`server-${t}`,r]})));return r.map((e=>({...e,serverEventProperties:s})))}async function Me(e){const{environment:t,query:r,source:s,limit:n}=e,{currentSpaceStore:a}=D().default.state;if(!a)return[];return(await ie({environment:t,query:r,limit:n||20,spaceId:a.id,requireEditPermissions:!0,excludeTemplates:!0,source:s,boostRecentlyViewedPages:!1,spaceStore:a})).results.filter((e=>{const t=K().Bv.createChildStore(a,{table:p().ev,id:e.id}),r=(0,x().E)(t);return(0,l().ot)(r)}))}async function Re(e){let{spaceViewStore:t,query:r,teamStores:s}=e;const n=w().oE(await Promise.all(s.map((async e=>(await e.load(),e.getValue()))))),a=t.getTeamsStores(),i=new Set(a.map((e=>e.id)));return r?(0,P().Ay)(r,n,(e=>e.name),{getSortScore:e=>{const{original:t,score:r}=e;return r*(i.has(t.id)?-2:-1)}}):n}function ze(e,t){const{query:r,limit:n,spaceId:a,requireEditPermissions:i,databaseType:o}=t,c=[];if(n>0){const l=new AbortController;e.defaultRecordCache.inMemoryRecordCache.forEachRecord(e.currentUser.id,(e=>{let{model:d,role:m}=e;if(d.table===y().Vl){const e=d.space_id===a,p=!i||(0,u().p2)(m);if(!e||!p||(0,L().Nh)(d.getParentId()))return;const h=d.getDatabaseType();if(!(!o||h&&o.includes(h)))return;const y=(0,b().q4_)(d.getName());if(!s().test(r,y))return;const g=K().md.createChildStore(t.parentStore,d.pointer),S=x().g7(g);if(!x().yR(S))return;c.push(d.pointer.id),c.length>=n&&l.abort()}}),l.signal)}return c}}}]);