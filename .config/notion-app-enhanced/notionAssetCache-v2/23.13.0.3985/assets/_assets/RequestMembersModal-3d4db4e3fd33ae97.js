"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77282],{346:(e,t,n)=>{n.d(t,{MG:()=>m,T1:()=>g,a1:()=>x,dt:()=>f,kg:()=>h,lC:()=>y,n_:()=>v});var o=n(296540),i=()=>n(484714),s=()=>n(56366),a=()=>n(187174),r=()=>n(645873),l=()=>n(941463),c=()=>n(441199),d=()=>n(749687),u=()=>n(737230),p=()=>n(756114);const g=new(r().O2)("PerformanceToolbar",(()=>Promise.all([n.e(16471),n.e(92845),n.e(84468),n.e(48632),n.e(75078),n.e(95168),n.e(36908),n.e(21194),n.e(23930),n.e(61347),n.e(45624)]).then(n.bind(n,462407)))),m=(0,r()._h)(g,(e=>e.PerformanceToolbar)),f=(0,r()._h)(g,(e=>e.PerformanceToolbarSettings));function h(){const e=(0,i().v3)();return(0,s().K8)((()=>(0,p().D)(e,e.RouterStore.state)),[e])}function v(){const e=(0,i().v3)(),t=b("PerformanceToolbarStore"),n=b("isPerformanceToolbarVisible");return(0,s().K8)((()=>!(!t||!n)&&n(e,e.RouterStore.state,t.state)),[n,e,t])}function y(){const e=b("PerformanceToolbarStore");return(0,s().K8)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function x(){const e=(0,i().v3)(),t=b("createPerformanceToolbarMouseListeners"),n=b("PerformanceToolbarStore"),{sidebarExpanded:a,sidebarWidth:r,secondarySidebarExpanded:p,secondarySidebarWidth:g,updateSidebarExpanded:m,updateSidebarWidth:f}=(0,s().K8)((()=>({sidebarExpanded:d().sidebarExpandedStore.state,sidebarWidth:d().sidebarWidthStore.state,secondarySidebarExpanded:c().default.isOpen(),secondarySidebarWidth:l().Ay.getWidth(),updateSidebarExpanded:u().Ay.state.expanded,updateSidebarWidth:u().Ay.state.width})),[]);return(0,o.useEffect)((()=>{if(n&&t)return t(e,(e=>n.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),a,r,p,g,m,f)}),[t,e,n,a,r,p,g,m,f])}function b(e){const t=h(),[{value:n}]=(0,a().Yb)((()=>t?g.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return n}},77279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const i=new o},97059:(e,t,n)=>{n.d(t,{W:()=>f,w:()=>m});n(944114);var o=()=>n(585515),i=()=>n(577449),s=()=>n(161479),a=()=>n(545285),r=()=>n(763824),l=()=>n(780054),c=()=>n(870618),d=()=>n(670631),u=()=>n(227440),p=()=>n(217429),g=()=>n(540758);async function m(e){const{environment:t}=e;return(await r().lX(Object.keys(d().A.state.offlinePages||{}),100,(e=>async function(e){const{environment:t,pageId:n}=e,r={page:{id:n,spaceId:(0,s().e)(void 0)},baseUrl:l().A.domainBaseUrl,publicDomainName:l().A.publicDomainName,shouldTraverseToggleBlocks:!0,limit:1/0,cursor:{stack:[]},verticalColumns:!1},d=[];return await o().T(r,i().h.sideEffect((e=>((0,a().u)(e)&&d.push(e.id),Promise.resolve())),i().h.fromMonomorphicFunctionUnsafe((async e=>{const n=await c().h7({environment:t,pointer:e,useInMemoryCacheOnly:!1,skipAccessWrites:!0});return null==n?void 0:n.model})))),d}({environment:t,pageId:e})))).flat()}function f(e,t){return!u().A.state.online&&(e.device.isElectron||e.device.isMobileNative)&&p().default.checkGate({gateName:"download_for_offline"})&&!(0,g().Bd)(t)}},101749:(e,t,n)=>{n.d(t,{N:()=>a});n(296540);var o=()=>n(959013),i=()=>n(423657),s=n(474848);function a(e){const t=(0,i().A)(e);return t.isGuestRequestRequired?(0,s.jsx)(o().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsx)(o().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests."})}),(0,s.jsx)("div",{children:(0,s.jsx)(o().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsx)(o().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests."})}),(0,s.jsx)("div",{children:(0,s.jsx)(o().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},103674:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{permissionsInviteStore:new(n(986229).A),contextualInviteStore:new(n(159026).Ay)}}get stage(){return this.state.contextualInviteStore.state.inviteStage}}const i=o},105819:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>o,pencilLineIcon:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.63 4.12 14.99 11.76",svg:(0,n(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},i=(0,n(340498).wt)("pencilLine",o)},108414:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const i=new o},123350:(e,t,n)=>{n.r(t),n.d(t,{RequestMembersModal:()=>B,default:()=>P,messages:()=>M});var o=n(296540),i=()=>n(484714),s=()=>n(56366),a=()=>n(401497),r=()=>n(959013),l=()=>n(381349),c=()=>n(284371),d=()=>n(134696),u=()=>n(542056),p=()=>n(436572),g=()=>n(805751),m=()=>n(623580),f=()=>n(928600),h=()=>n(433876),v=()=>n(897119),y=()=>n(204063),x=()=>n(125565),b=()=>n(654856),S=()=>n(263919),k=()=>n(495867),C=()=>n(722872),I=()=>n(743260),w=()=>n(962730),A=()=>n(766343),j=()=>n(103674),T=n(474848);const M=(0,r().YK)({reason_placeholder:{id:"RequestMembersModal.reason.placeholder",defaultMessage:"Add a reason (optional)"}});function B(e){const t=(0,i().v3)(),{store:n,origin:B,analyticsFrom:P}=e,{modalOpen:R,focus:_}=(0,s().K8)((()=>{const{open:e,focus:t}=A().A.state;return{modalOpen:e,focus:t}}),[]),L=(0,o.useCallback)((e=>{R&&A().A.setState({...A().A.state,open:!0,focus:e})}),[R]),E=(0,s().uB)(void 0,j().A),D=(0,r().tz)(),W=(0,a().IS)((e=>({modalStyle:{alignSelf:"center",overflow:"visible",top:0,width:420},container:{padding:20},title:{fontWeight:c().Wy.medium,marginBottom:10},reasonTitle:{color:l().Ay.mediumTextColor,marginTop:10,marginBottom:5},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:15},requestInvitesButton:{marginLeft:20},divider:{width:"100%",marginTop:10,marginBottom:15},showDivider:{background:e.regularDividerColor,boxShadow:e.shadowLG},hideDivider:{boxShadow:"none"}})),[]);(0,o.useEffect)((()=>{L("invites")}),[L]);const U=e=>{e.currentTarget===e.target&&L("none")},F=async()=>{d().RH(t,{...k().nE(t,E.state.contextualInviteStore),from:P}),u().KW({permissionsInviteStore:E.state.permissionsInviteStore,contextualInviteStore:E.state.contextualInviteStore}),E.state.contextualInviteStore.startRequestMembership();const e=E.state.contextualInviteStore.state.invitedUsers;A().A.close();const o=await k().xi({environment:t,spaceStore:n,originId:void 0,originType:P,reasonMessage:E.state.permissionsInviteStore.state.emailMessage,contextualInviteStore:E.state.contextualInviteStore,intl:D});O({success:o,intl:D,users:e}),E.reset()},O=e=>{const{success:t,intl:n,users:o}=e;0!==o.length&&(t?p().D6({label:n.formatMessage({id:"requestMembersModal.requestSuccess.toast",defaultMessage:"Successfully requested membership for {users} to your workspace admins."},{users:k().id(o,n)})}):p().D6({label:n.formatMessage({id:"requestMembersModal.requestFail.toast",defaultMessage:"Failed to invite {users} to the workspace."},{users:k().id(o,n)})}))};return(0,T.jsx)(h().A,{modalStyle:W.modalStyle,open:R,onDismiss:async()=>{if(!(await(0,I().iQ)({environment:t,permissionsInviteStoreState:E.state.permissionsInviteStore.state,from:"space_settings_add_members"})))return A().A.close(),void E.reset();L("none")},renderContent:()=>(0,T.jsxs)("div",{style:W.container,onClick:U,children:[(0,T.jsx)("div",{style:W.title,onClick:U,children:(0,T.jsx)(r().sA,{id:"requestMembersModal.title",defaultMessage:"Request to invite members"})}),(0,T.jsx)(v().Ay,{popupType:v().nl.Popup,alignmentToOrigin:w().C.Start,placementToOrigin:w().W.Bottom,open:"invites"===_,sameWidthAsOrigin:!0,originGap:10,trapFocus:!0,disableMouseCapture:!0,popupWrapStyle:{boxShadow:"none"},origin:(0,T.jsx)(b().A,{permissionsInviteStore:E.state.permissionsInviteStore,store:n,handleClickRemoveToken:e=>{u().St({targetToRemove:e,permissionsInviteStore:E.state.permissionsInviteStore,defaultRoleForNonBot:"read_and_write"})},handleInputChange:async e=>{L("invites"),await u().Pp({environment:t,event:e,permissionsInviteStore:E.state.permissionsInviteStore})},handleInputSubmit:async()=>{},origin:"add_members",defaultRoleForNonBot:"read_and_write",right:(0,T.jsx)("div",{}),focus:"invites"===_,handleFocus:()=>L("invites")}),onDismiss:()=>L("none"),render:()=>{const e=(0,T.jsx)(S().A,{permissionsInviteStore:E.state.permissionsInviteStore,store:n,shouldShowGroups:!1,sectionRenderLimit:10,membersOnly:!1}),t={menuType:C().gu.Popup,disableScroller:!1};return(0,T.jsx)("div",{children:(0,T.jsx)(f().A,{...t,width:380,children:e})})},style:{width:"100%"}}),(0,T.jsx)("div",{style:{...W.divider,..."invites"===_?W.showDivider:W.hideDivider}}),(0,T.jsx)("div",{style:W.reasonTitle,onClick:U,children:(0,T.jsx)(r().sA,{id:"requestMembersModal.reasonForRequest.title",defaultMessage:"Reason for request"})}),(0,T.jsx)(g().A,{debugName:"RequestMembersModal",capture:!0,allowEsc:!0,children:(0,T.jsx)(m().A,{textarea:!0,style:{padding:8},value:E.state.permissionsInviteStore.state.emailMessage,focus:"reason"===_,onFocus:()=>L("reason"),onChange:e=>{E.state.permissionsInviteStore.setState({...E.state.permissionsInviteStore.state,emailMessage:e.target.value})},placeholder:D.formatMessage(M.reason_placeholder)})}),(0,T.jsxs)("div",{style:W.footer,onClick:U,children:[(0,T.jsx)(x().A,{isSecondaryColor:!0,isSmall:!0,isMultiline:!0,children:(0,T.jsx)(r().sA,{id:"RequestMembersModal.caption",defaultMessage:"Your admins will approve or decline your request."})}),(0,T.jsx)(y().A,{size:"lg",style:W.requestInvitesButton,onClick:F,children:(0,T.jsx)(r().sA,{id:"requestMembersModal.requestInvitesButton.label",defaultMessage:"Request invites"})})]})]}),origin:(0,T.jsx)("div",{onClick:()=>{A().A.open()},children:B})})}const P=B},129852:(e,t,n)=>{n.r(t),n.d(t,{exclamationMarkCircleIcon:()=>s,iconDefinition:()=>i});n(296540);var o=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M9.875 6.25c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625m0 7.375a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,o.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},s=(0,n(340498).wt)("exclamationMarkCircle",i)},159026:(e,t,n)=>{n.d(t,{Ay:()=>a,NJ:()=>o,d5:()=>i});n(898992),n(354520),n(581454),n(737550);let o=function(e){return e.unselected="unselected",e.workspace_member="workspace_member",e.request_workspace_member="request_workspace_member",e.page_guest="page_guest",e.closed="closed",e}({}),i=function(e){return e[e.closed=0]="closed",e[e.share_page=1]="share_page",e[e.share_workspace=2]="share_workspace",e[e.request_workspace=3]="request_workspace",e}({});class s extends(()=>n(757695))().Store{getInitialState(){return{inviteStage:i.closed,selection:o.workspace_member,order:[o.workspace_member,o.page_guest],invitedUsers:[],invitedEmailToUserIdMap:{},flowId:n(206267).JW()}}startWorkspaceInvite(){this.setState({...this.state,inviteStage:i.share_workspace,order:[o.workspace_member,o.page_guest],selection:o.workspace_member})}startRequestMembership(){this.setState({...this.state,inviteStage:i.request_workspace,order:[o.request_workspace_member,o.page_guest],selection:o.request_workspace_member})}hasGuests(){return this.state.invitedUsers.some((e=>e.isGuest))}getGuestEmails(){return this.state.invitedUsers.filter((e=>e.isGuest)).map((e=>e.email))}}const a=s},207207:(e,t,n)=>{n.d(t,{J:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.62 2.62 15.26 15.26",svg:(0,n(474848).jsx)("path",{d:"M8.875 2.625a6.25 6.25 0 1 0 3.955 11.09l3.983 3.982a.625.625 0 1 0 .884-.884l-3.983-3.982a6.25 6.25 0 0 0-4.84-10.205m-5 6.25a5 5 0 1 1 10 0 5 5 0 0 1-10 0"})},i=(0,n(340498).wt)("magnifyingGlass",o)},263919:(e,t,n)=>{n.d(t,{A:()=>C});n(944114),n(898992),n(354520),n(672577),n(581454);var o=n(296540),i=()=>n(56366),s=()=>n(842599),a=()=>n(733816),r=()=>n(792071),l=()=>n(798880),c=()=>n(959013),d=()=>n(284371),u=()=>n(743260),p=()=>n(299545),g=()=>n(962730),m=()=>n(630116),f=()=>n(760217),h=()=>n(939740),v=()=>n(64e3),y=()=>n(8980),x=()=>n(267155),b=n(474848);const S=(0,c().YK)({invited_page:{id:"PermissionsInviteSearchRequest.userTooltip.invited_page",defaultMessage:"{userNameAndEmail} is invited to this page already"},invited_database:{id:"PermissionsInviteSearchRequest.userTooltip.invite_database",defaultMessage:"{userNameAndEmail} is invited to this database already"},invited_space:{id:"PermissionsInviteSearchRequest.userTooltip.invited_space",defaultMessage:"{userNameAndEmail} is invited to this workspace already"},invited_team:{id:"PermissionsInviteSearchRequest.userTooltip.invited_team",defaultMessage:"{userNameAndEmail} is invited to this teamspace already"},not_in_space:{id:"PermissionsInviteSearchRequest.userTooltip.admin",defaultMessage:"Click to invite {userNameAndEmail}"}});function k(e,t){return e.filter(((e,n)=>n<t))}const C=function(e){const{store:t,shouldShowGroups:C,sectionRenderLimit:I,membersOnly:w,hideCurrentUser:A,hideUserTypeToken:j,disableInvitedUsers:T,guestsMustBeRequested:M,hideTitle:B,defaultUserTitle:P,performSearchRequest:R}=e,[_,L,E]=(0,i().$y)(e.permissionsInviteStore),D=(0,n(484714).v3)(),{device:W}=D,U=(0,c().tz)(),{tokenQuery:F}=_,O=(0,o.useMemo)((()=>u()._c({environment:{device:W}})),[W]),N=(0,n(401497).IS)((e=>({roleBadge:{...O},invitedBadge:{...O,backgroundColor:e.defaultBadgeBackground}})),[O]),G="invitee",z=(0,i().K8)((()=>{const e=n(21735).A.state.shouldUseEdgeCache,t=n(217429).default.checkGate({gateName:"edge_cache_settings"});return e&&t}),[]),q={request:F,performRequest:e=>R?R({query:e,limit:10,environment:D}):n(542056).hQ({query:e,sectionLimit:{userLimit:10,groupLimit:C?10:0,importContactLimit:0},membersOnly:w,environment:D,intl:U,shouldUseEdgeCacheRollout:z}),render:(e,o,i)=>{if(e)return(0,b.jsx)(x().z,{loading:!i,hideTitle:B,children:(0,b.jsx)(v().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})})});const w=o&&{...o,inviteUsers:o.inviteUsers.filter((e=>!(0,u().mQ)({permissionsInviteStore:E,target:e})&&(!A||e.value.id!==D.currentUser.id))),importedContacts:(0,u().GZ)(o.inviteUsers,o.importedContacts)},R=w&&(null==F?void 0:F.length)>0,{inviteUsers:L,inviteGroups:W,importedContacts:O=[]}=R?w:(0,u().Es)({currentInviteActors:w,permissionsInviteStore:E,targetStore:t}),z=[...k(L,I),...k(O,10)].map(((e,o)=>{const i="newUser"===e.type?e.value.email:e.value.id,s=(0,u().$D)(e),d=Boolean(R&&(0,u().VF)({permissionsInviteStore:E,userTarget:e,targetStore:t}));return{key:i,render:o=>{const{tooltip:i,userTypeToken:h}=function(e){const{userTarget:t,targetStore:n,isInvited:o,userSpaceRole:i,styles:s,intl:a}=e,d="newUser"===t.type?null:r().Bj6.fromValue(l().oo,t.value).getDisplayName(a),g=t.value.email,f=d&&d!==g?`${d} (${g})`:g,h=i&&"not_in_space"!==i;if(o)return{tooltip:(0,p().Yu)(n)?a.formatMessage(S.invited_space,{userNameAndEmail:f}):n instanceof m().Bv?a.formatMessage(S.invited_page,{userNameAndEmail:f}):n instanceof m().md?a.formatMessage(S.invited_database,{userNameAndEmail:f}):a.formatMessage(S.invited_team,{userNameAndEmail:f}),userTypeToken:(0,b.jsx)("div",{style:{...s.invitedBadge},children:(0,b.jsx)(c().sA,{id:"inviteUserModal.userRole.invitedBadge.label",defaultMessage:"Invited"})})};if(h){const e=u().S6({role:i,intl:a,nameOrEmail:f});return{tooltip:e.tooltip,userTypeToken:(0,b.jsx)("div",{style:{...s.roleBadge},children:e.userRoleBadge})}}return{tooltip:a.formatMessage(S.not_in_space,{userNameAndEmail:f}),userTypeToken:void 0}}({userTarget:e,targetStore:t,userSpaceRole:s,isInvited:d,styles:N,intl:U});return"existingUser"===e.type?(0,b.jsx)(n(457688).A,{...o,actor:(0,n(764880).A7)(e.value),right:j?void 0:h,tooltip:i,tooltipPlacement:g().W.Left,disabled:T&&d,defaultUserTitle:P}):(0,b.jsx)(n(859428).A,{placement:g().W.Left,alignment:g().C.Start,textWrap:!0,render:t=>(0,b.jsx)(f().A,{...o,...t,icon:(0,b.jsx)(y().I,{icon:a().o}),right:h,title:e.value.email.trim(),disabled:T&&d}),disableTooltip:!i,renderTooltip:()=>i})},action:()=>{if(T&&d)return;const t={...e,..."existingUser"===e.type&&{spaceRole:s}};n(134696).kH(D,{subscription_tier:(0,n(10984).AI)(),invite_token_query:F,selected_user_token:e,selected_user_token_rank:o,from:"permission_invite"}),E.setState({..._,inviteTargets:[..._.inviteTargets,t],tokenQuery:"",inputFocus:G})}}})),q=k(W,I).map((e=>{const{value:t}=e;return{key:t.id,render:e=>(0,b.jsx)(n(862139)._,{group:t,menuListItemProps:e}),action:()=>{E.setState({..._,inviteTargets:[..._.inviteTargets,e],tokenQuery:"",inputFocus:G})}}})),H=[];if(z.length>0&&H.push({key:"user results",render:e=>(0,b.jsx)(x().z,{...e,loading:!i,hideTitle:B}),items:z}),C&&q.length>0&&H.push({key:"group results",render:e=>(0,b.jsx)(n(89924).A,{...e,title:(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!i}),items:q}),0===H.length){const e=(0,s().qh)(_.tokenQuery);if((0,s().DT)(e)){const s={type:"newUser",value:{email:e},source:"email"},a=(0,u().mQ)({target:s,permissionsInviteStore:E});if(!a)return;if(a)return(0,b.jsx)(x().z,{loading:!i,hideTitle:B,children:(0,b.jsx)(v().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:(0,b.jsx)("span",{style:{fontWeight:d().Wy.bold},children:(0,u().Sk)({intl:U,target:a})})}})})});const r=(o&&o.inviteUsers||[]).find((t=>"existingUser"===t.type&&t.value.email===e));if(r&&"existingUser"===r.type&&(0,u().wF)({store:t,target:r}))return(0,b.jsx)(x().z,{loading:!i,hideTitle:B,children:(0,b.jsx)(v().A,{title:(0,b.jsx)(c().sA,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:(0,b.jsx)("span",{style:{fontWeight:d().Wy.bold},children:(0,n(695608).c6)(U,r.value)})}})})})}else{if(!_.tokenQuery)return null;H.push({key:"user results",render:e=>(0,b.jsx)(x().z,{...e,loading:!i,hideTitle:B,title:M?(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.requestPeople",defaultMessage:"Keep typing to request inviting an email"}):(0,b.jsx)(c().sA,{id:"inviteUserModal.searchDropdown.addPeople",defaultMessage:"Keep typing to invite email"})}),items:[{key:_.tokenQuery,render:e=>(0,b.jsx)(f().A,{icon:(0,b.jsx)(y().I,{icon:a().o}),title:_.tokenQuery,...e}),action:()=>{}}]})}}return(0,b.jsx)(h().Ay,{type:h().Oh.Vertical,initialFocus:F.length>0?0:void 0,sections:H})}};return(0,b.jsx)(n(251126).A,{...q})}},267155:(e,t,n)=>{n.d(t,{z:()=>r});n(296540);var o=()=>n(401497),i=()=>n(959013),s=()=>n(89924),a=n(474848);function r(e){const t=(0,o().IS)((()=>({container:{paddingBlock:4}})),[]);return(0,a.jsx)(s().A,{title:e.hideTitle?void 0:(0,a.jsx)(i().sA,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"}),style:t.container,...e})}},417555:(e,t,n)=>{n.d(t,{A:()=>c});n(296540);var o=()=>n(784892),i=()=>n(738418),s=()=>n(695608),a=()=>n(534177),r=()=>n(698449),l=n(474848);const c=function(e){let{isStrikedThrough:t,backgroundColor:c,onClickRemove:d,target:u,disabled:p,showInfoIcon:g,style:m,shouldWrap:f}=e;const h=(0,n(484714).v3)(),v=(0,n(959013).tz)(),{device:y}=h,x=(0,n(56366).K8)((()=>function(e){let t,{target:n,intl:o,showInfoIcon:c}=e;switch(n.type){case"newUser":t=n.value.email.trim();break;case"existingUser":t=(0,s().c6)(o,n.value);break;case"group":t=(0,r().Pf)({intl:o,groupName:n.value.name});break;default:(0,a().HB)(n)}return c?(d=t,(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,i().G)({marginRight:4,width:14,height:14}),d]})):t;var d}({target:u,intl:v,showInfoIcon:g})),[u,v,g]);return(0,l.jsx)(n(881690).A,{showRemoveButton:!0,isSingle:!0,isStrikedThrough:t,backgroundColor:c,format:y.isMobile?o().NY.Large:o().NY.Medium,onClickRemove:e=>function(e,t,n){e.stopPropagation(),t(n)}(e,d,u),disabled:p,disabledFeedback:!0,value:x,style:m,shouldWrap:f})}},423657:(e,t,n)=>{n.d(t,{A:()=>r});var o=()=>n(108944),i=()=>n(299545),s=()=>n(640653);function a(e,t){return(0,s().hN)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const r=function(e){return(0,n(56366).K8)((()=>{if((0,i().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if(!(0,i()._p)(e))return(0,s().r7)(e)?a(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,o().Uo)(e),r=(0,o().pp)(e),l=r||n(765957).default.state.currentSpaceStore;if((0,s().r7)(l))return a(l,t);const c=!(null!=r&&r.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:c,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:c,isGuestRequestRequired:!1}}),[e])}},454531:(e,t,n)=>{n.d(t,{W:()=>f});var o=()=>n(780054),i=()=>n(972435),s=()=>n(867772),a=()=>n(681810),r=()=>n(901389),l=()=>n(896628),c=()=>n(383594),d=()=>n(675925),u=()=>n(751156),p=()=>n(892632);const g=1500,m=(0,n(959013).YK)({pageCover:{defaultMessage:"Page cover",id:"pageCover.title"},fileTypeCaption:{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"},preparing:{defaultMessage:"Preparing...",id:"pageCover.status.preparing"},downloading:{defaultMessage:"Downloading...",id:"pageCover.status.downloading"},embedTitle:{defaultMessage:"Link",id:"pageCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image link…",id:"pageCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}});function f(e){let{environment:t,intl:n,store:o,rect:i,from:s}=e;c().W(t,{originGap:3,originRect:i,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:n.formatMessage(m.pageCover),onDelete:()=>{!function(e){let{environment:t,store:n}=e;c().I(),u().createAndCommit({userAction:"PageCover.handleDelete",environment:t,canUndo:!0,perform:e=>{l().PT({store:n,transaction:e})}})}({environment:t,store:o})},currentTab:"gallery",tabs:[{type:"gallery",onChange:e=>{let{url:n,position:i}=e;(0,d().o)(t,{action:"edit_cover",block_type:"page",from:s},(e=>{v({environment:t,store:o,url:{originUrl:n},position:i}),e()}))}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:n.formatMessage(m.fileTypeCaption,{idealImageWidth:g}),onUpload:e=>{(0,d().o)(t,{action:"edit_cover",block_type:"page",from:s},(i=>{var s;c().I(),p().QM({environment:t,file:e[0],bucket:"secure",record:(null===(s=o.getCoverStore())||void 0===s?void 0:s.pointer)??o.pointer,isFileBlock:!1,reportRichUploadMetrics:!0,onStart:y,onProgress:x,onComplete:e=>{var n;n={environment:t,store:o,url:{originUrl:e}},h({...n,position:.5})},onError:()=>{r().f1(n.formatMessage(m.uploadFailed))}}),i()}))}},{type:"embed",title:n.formatMessage(m.embedTitle),inputPlaceholder:n.formatMessage(m.embedPlaceholder),caption:n.formatMessage(m.embedCaption),buttonText:n.formatMessage(m.embedSubmit),onChange:e=>{(0,d().o)(t,{action:"edit_cover",block_type:"page",from:s},(n=>{var i;i={environment:t,store:o,url:e},h({...i,position:.5}),c().I(),n()}))}},{type:"unsplash",onChange:e=>{let{url:n,position:i}=e;(0,d().o)(t,{action:"edit_cover",block_type:"page",from:s},(e=>{v({environment:t,store:o,url:{originUrl:n},position:i}),e()}))}}]})}async function h(e){const{environment:t,store:n,url:o,position:r}=e,{serverCommitResult:c}=u().createAndCommit({userAction:"PageCover.updatePageCover",environment:t,canUndo:!0,perform:e=>{l().fg({store:n,url:o,position:r||.5,transaction:e})}});await c,a().A.state.loadingMode===s().vS&&a().A.setState({loadingMode:s().Gi,dataURL:a().A.state.dataURL,uploadProgress:t.device.isMobileNative?void 0:100,progressText:i().A.formatMessage(m.downloading)})}function v(e){h(e),o().A.isMobile&&c().I()}function y(e){const{file:t,name:n,size:o}=e;if(c().I(),a().A.setState({loadingMode:s().Wc,file:t,name:n,size:o}),t.type.indexOf("image")>=0)if(t instanceof File){const e=new FileReader;e.onload=e=>{a().A.state.loadingMode===s().Wc&&a().A.setState({...a().A.state,loadingMode:s().vS,uploadProgress:0,dataURL:e.target.result})},e.readAsDataURL(t)}else a().A.state.loadingMode===s().Wc&&a().A.setState({...a().A.state,loadingMode:s().vS,dataURL:t.dataURL,progressText:i().A.formatMessage(m.preparing)});else a().A.state.loadingMode===s().Wc&&a().A.setState({...a().A.state,loadingMode:s().vS,progressText:i().A.formatMessage(m.preparing)})}function x(e){const{progressPercent:t,progressText:n}=e;a().A.state.loadingMode===s().vS&&a().A.setState({...a().A.state,uploadProgress:t,progressText:n})}},475355:(e,t,n)=>{n.d(t,{Vs:()=>M,gj:()=>T,hX:()=>R,oH:()=>P,v4:()=>B});n(16280);var o=()=>n(110192),i=()=>n(857639),s=()=>n(416504),a=()=>n(206267),r=()=>n(737188),l=()=>n(179034),c=()=>n(519831),d=()=>n(854150),u=()=>n(529316),p=()=>n(797573),g=()=>n(919709),m=()=>n(946141),f=()=>n(449506),h=()=>n(413677),v=()=>n(751156),y=()=>n(972435),x=()=>n(45359),b=()=>n(37433),S=()=>n(274511),k=()=>n(406792),C=()=>n(632709),I=()=>n(765957),w=()=>n(630116),A=()=>n(108414),j=()=>n(848237);async function T(e){let{environment:t,name:n,description:o,icon:i,accessLevel:s,isDefault:a,flowId:u,createTeamHome:p,teamPermissionRole:g,spacePermissionRole:h,members:v,settings:y}=e;const{currentSpaceStore:x}=I().default.getState();if(!x)throw new Error("currentSpaceStore does not exist");const b=k().default.mark("client_create_team_latency"),S=x.id,C=await f().callApi({eventName:"createTeam",environment:t,data:{spaceId:S,name:n,description:o,icon:i,isDefault:a,accessLevel:s,teamPermissionRole:g,spacePermissionRole:h,members:v,settings:y}});if("failed"===C.type)return void(0,j().O)(C);const{teamId:A}=C.data,T=w().h4.createChildStore(x,{table:d().yK,id:A,spaceId:S});await T.load();const M=T.getSpaceId(),B=T&&M&&{id:T.id,table:c().Vl,spaceId:M},P=T&&B&&w().md.createChildStore(T,B);await(null==P?void 0:P.load());const R=T&&M&&w().Bv.createChildStore(T,{id:(0,r().t)(T.id),table:l().ev,spaceId:M});return await(null==R?void 0:R.load()),M&&await f().callApi({eventName:"createCollectionViewBlockForPosts",environment:t,data:{teamId:T.id,spaceId:M}}),p&&_({environment:t,teamStore:T}),m()._P(t,{store:T,flowId:u}),k().default.measure(b,{environment:t}),T}function M(e){var t;let{environment:n,page:o}=e;const i=a().JW(),s=(null===(t=o.getParentPointer())||void 0===t?void 0:t.table)!==d().yK?"page_to_team_nested":"page_to_team";m().H8(n,{from:s,flowId:i}),A().A.setState({open:!0,pageStore:o,flowId:i})}async function B(e){var t;let{environment:n,page:o,flowId:i,intl:a}=e;const{accessLevel:r,spacePermissionRole:l,teamPermissionRole:c,members:u}=await(0,b().sy)(o),p=(o.isDefined()?o.getModel().getRenderTitle({intl:a,userTimeZone:(0,s().P)(),getRecordModel:o.getRecordModel}):void 0)??g().q4_(o.getTitleValue()),m=await T({environment:n,name:p,icon:null===(t=o.getIcon())||void 0===t?void 0:t.icon,accessLevel:r,isDefault:!1,description:"",flowId:i,createTeamHome:!1,teamPermissionRole:c,spacePermissionRole:l,members:u});if(!m)return;const{currentSpaceViewStore:f}=I().default.state;if(!f)return;const h=await(0,S().U)();v().createAndCommit({userAction:"teamActions.movePageToCreatedTeam",environment:n,canUndo:!0,perform:e=>{h({environment:n,currentSpaceViewStore:f,transaction:e,teamStore:m,action:"move",value:{type:d().yK,id:m.id},targets:[o],location:{type:"append"}})}}),(0,j().F2)({environment:n,teamId:m.id,tab:C().p.Members,from:"create_team_from_page"}),await new Promise((e=>setTimeout((()=>(0,j().Mh)({teamStore:m,environment:n})),100)))}async function P(e){let{environment:t,name:n,description:o,icon:i,flowId:s,trackCreateTeamComplete:a}=e;const{currentSpaceStore:r}=I().default.getState();if(!r)throw new Error("currentSpaceStore does not exist");const l=r.id,c=await f().callApi({eventName:"enableTeams",environment:t,data:{spaceId:l,defaultTeamName:n,defaultTeamIcon:i,defaultTeamDescription:o}});if("failed"===c.type)return void(0,j().O)(c);const{teamId:u}=c.data,p=w().h4.createChildStore(r,{table:d().yK,id:u,spaceId:l});return await p.load(),await _({environment:t,teamStore:p}),m().b0(t,{spaceId:l,store:p,flowId:s}),a&&u&&m()._P(t,{store:p,flowId:s}),p}async function R(e){var t;let{environment:n,teamStore:i,from:s,buttonPopupStore:r}=e;if(!n.currentUser.id)return!1;const l=a().JW(),c=i.isDefault(),d=i.getTeamAccessLevel();if(c)return!1;const u=i.getName(),p=await T({environment:n,name:(0,o().Q)(u||""),description:"",icon:i.getRawIcon(),accessLevel:d,isDefault:c,createTeamHome:!0,teamPermissionRole:null===(t=i.getTeamPermission())||void 0===t?void 0:t.role,spacePermissionRole:i.getSpacePermissionRole(),members:[],settings:i.getSettings(),flowId:l});return!!p&&(m().KK(n,{store:p,from:s}),(0,j().L0)({environment:n,teamStore:p,shouldScroll:!0}),(0,j().F2)({environment:n,teamId:p.id,tab:C().p.General,from:"duplicate_team",buttonPopupStore:r}),new Promise((e=>setTimeout(e,500))).then((()=>{(0,x().jH)(u)})),!0)}async function _(e){const{environment:t,teamStore:n}=e,o=I().default.state.currentSpaceStore,s=I().default.state.currentSpaceViewStore;if(!o||!s)return i().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-SpaceOrSpaceViewStoreError"}),!1;const a=(r=y().A.getIntl(),(0,p().B)(u().wA.teamsHomepage,r));var r;return!!(await h().createTemplateInstance({environment:t,item:a,spaceStore:o,spaceViewStore:s,useMinimalTemplates:!1,type:"inTeam",teamStore:n,from:"homepage_team",isOnboarding:!1}))||(i().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-PageNotCreated"}),!1)}},495867:(e,t,n)=>{n.d(t,{BY:()=>v,Lg:()=>y,id:()=>k,nE:()=>C,xi:()=>x});n(944114),n(898992),n(430670),n(581454);var o=()=>n(857639),i=()=>n(402390),s=()=>n(68263),a=()=>n(762433),r=()=>n(449506),l=()=>n(579627),c=()=>n(436572),d=()=>n(972435),u=()=>n(765957),p=()=>n(57605),g=()=>n(159026),m=()=>n(329304),f=()=>n(47373),h=()=>n(250064);async function v(e){const{environment:t,spaceStore:n,contextualInviteStore:o}=e;!function(e){const{spaceStore:t,contextualInviteStore:n}=e,o=t.getRole();if(!o||!(0,s().NB)(o))return!1;if(!n.hasGuests())return!1;if(t.getDisableMembershipRequests())return!1;return(0,f().x3)()}({environment:t,spaceStore:n,contextualInviteStore:o})?await async function(e){const{spaceStore:t,contextualInviteStore:n,environment:o}=e,i=t.getRole();if(!i||!(0,s().vp)(i))return!1;if(!n.hasGuests())return!1;return await(0,m().Se)(o,{name:"members",spaceId:t.id,userId:t.userId,amount:1})}({environment:t,spaceStore:n,contextualInviteStore:o})?o.startWorkspaceInvite():o.setState({...o.state,inviteStage:g().d5.closed}):o.startRequestMembership()}async function y(e){const{environment:t,spaceStore:n,contextualInviteStore:i,from:s,intl:a}=e,{selection:r,flowId:d}=i.state;if("page_guest"===r||!i.hasGuests())return i.reset(),!1;const{inviteTargets:u,unknownEmails:p}=await b({environment:t,contextualInviteStore:i}),g={...i.state};i.reset();const f=await(0,m().Se)(t,{name:"non_admin_members",spaceId:n.id,userId:n.userId})?e.inviteRole??"read_and_write":"editor";try{await l().eP({environment:t,store:n,inviteTargets:u,inviteRole:f,isOnboarding:!1,invite:{inviteOrigin:s,inviteFlowId:d,disable_invite_email:!0}})}catch(h){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:k(t,e),userCount:t.length})})}(a,g.invitedUsers),o().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{...g,inviteTargets:u}}}),!1}finally{p.length&&o().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.unknownUserId",data:{miscDataToConvertToString:{...g,unknownEmails:p}}})}return!0}async function x(e){const{environment:t,spaceStore:n,originId:i,originType:s,reasonMessage:a,contextualInviteStore:l,intl:d}=e,{selection:u}=l.state;if("page_guest"===u||!l.hasGuests())return l.reset(),!1;const{inviteTargets:p,unknownEmails:g}=await b({environment:t,contextualInviteStore:l}),m={...l.state};l.reset();const f=[];try{const e=p.map((e=>r().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:e.value.id,spaceId:n.id,message:a,attributes:{origin_id:i,origin_type:s,origin_table:"share_menu"===s?"block":"space",add_permissions_on_approval:!1}}}).catch((()=>f.push(e)))));await Promise.all(e)}catch(h){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:k(t,e)})})}(d,m.invitedUsers),o().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.inviteTargets",data:{miscDataToConvertToString:{...m,inviteTargetsWithErrors:f}}}),!1}finally{g.length&&o().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.unknownUserId",data:{miscDataToConvertToString:{...m,unknownEmails:g}}})}return!0}async function b(e){const{environment:t,contextualInviteStore:n}=e,{invitedEmailToUserIdMap:o}=n.state,i=[],s=[];for(const a of n.state.invitedUsers){if(!a.isGuest)continue;const e=await S(t,a,o);e?i.push({type:"existingUser",value:{id:e,email:a.email,version:1}}):s.push(a.email)}return{inviteTargets:i,unknownEmails:s}}async function S(e,t,n){const o=await async function(e,t,n){let o=t.id;if(o||(o=n[t.email]),!o){const n=await r().callApi({eventName:"findUser",environment:e,data:{email:t.email}});if("failed"!==n.type){const e=n.data;e.value&&(o=e.value.value.id)}}return o}(e,t,n);if(o)return o;const s=(0,i().H)(d().A.getIntl()),a=await r().callApi({eventName:"createEmailUser",environment:e,data:{email:t.email,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:s}});return"failed"!==a.type?a.data.userId:void 0}function k(e,t){return(0,h().l)(e.flatMap((e=>e.email||[])))}function C(e,t){var n;const{state:o}=t,i=null===(n=u().default.state.currentSpaceStore)||void 0===n?void 0:n.id,s=i?(0,a().AI)(p().A.getData(e,{spaceId:i})):void 0,r=t.getGuestEmails();return{invite_flow_id:o.flowId,user_count:r.length,user_emails:r,invite_space_role_selection:o.selection,is_bot:!1,subscription_tier:s}}},542056:(e,t,n)=>{n.d(t,{Ah:()=>P,D6:()=>B,KW:()=>A,Oo:()=>w,Pp:()=>R,St:()=>M,hQ:()=>L,iS:()=>T,kW:()=>j,l5:()=>I,lf:()=>_});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var o=()=>n(842599),i=()=>n(68263),s=()=>n(96689),a=()=>n(496603),r=()=>n(763824),l=()=>n(579627),c=()=>n(495867),d=()=>n(731320),u=()=>n(743260),p=()=>n(299545),g=()=>n(37433),m=()=>n(106628),f=()=>n(765957),h=()=>n(57605),v=()=>n(159026),y=()=>n(217429),x=()=>n(630116),b=()=>n(991249),S=()=>n(475355),k=()=>n(134696),C=()=>n(449506);async function I(e){const{environment:t,store:n,sudoModeStore:s,permissionsInviteStore:a,onInviteStart:r,contextualInviteStore:c,inviteOrigin:g}=e,{tokenQuery:m}=a.state;if((0,o().DT)(m.trim())){const e={type:"newUser",value:{email:m.trim()},source:"email"};u().mQ({target:e,permissionsInviteStore:a})||a.setState({...a.state,inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}if(a.state.inviteTargets.length>0){null==r||r();const e=a.state,{inviteRole:o,flowId:u,emailMessage:m}=e;a.reset();const f=await(0,d().hb)(n,e.inviteTargets);if((0,i().PW)(o)){const e=await l().eP({environment:t,store:n,sudoModeStore:s,inviteTargets:f,inviteRole:o,isOnboarding:!1,invite:{inviteFlowId:u,inviteMessage:m,inviteOrigin:g}});return e.success&&(null==c||c.setState({...null==c?void 0:c.state,invitedEmailToUserIdMap:e.invitedUsers})),{success:e.success,requestedUserCount:e.success?Object.keys(e.requestedUsers).length:0}}if((0,p().$R)(n)){return{success:await l().sQ({environment:t,store:n,inviteTargets:e.inviteTargets,inviteRole:o,createNewTeamFlowId:u}),requestedUserCount:0}}}return{success:!0,requestedUserCount:0}}function w(e){e.permissionsInviteStore.setState({...e.permissionsInviteStore.state,modalOpen:!1,flowId:void 0})}function A(e){const{permissionsInviteStore:t,contextualInviteStore:n}=e;if(!n)return;const o=[];t.state.inviteTargets.forEach((e=>{if("newUser"===e.type)o.push({email:e.value.email,isGuest:!0});else if("existingUser"===e.type){const t={...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};o.push(t)}})),n.setState({...n.state,invitedUsers:o})}async function j(e){const{environment:t,store:n,sudoModeStore:o,permissionsInviteStore:i,contextualInviteStore:a,onInviteClick:r,onInviteComplete:l,inviteOrigin:d,intl:u}=e,p=n.getSpaceId(),m=new(x().SL)(t,{table:s().NX,id:p}),f=p?await h().A.awaitData(t,{spaceId:p}):void 0;if((null==a?void 0:a.state.selection)===v().NJ.workspace_member&&m&&(0,g().Gx)(t,f)){if(!(await S().oH({environment:t,flowId:i.state.flowId||"",trackCreateTeamComplete:!1})))return;A({permissionsInviteStore:i,contextualInviteStore:a}),await(0,c().Lg)({environment:t,spaceStore:m,contextualInviteStore:a,from:d,intl:u})}else A({permissionsInviteStore:i,contextualInviteStore:a});let y={success:!1,requestedUserCount:0};try{y=await I({environment:t,store:n,sudoModeStore:o,permissionsInviteStore:i,contextualInviteStore:a,onInviteStart:()=>{null==r||r()},inviteOrigin:d})}catch(b){}finally{null==l||l(y.success,y.requestedUserCount)}}async function T(e){const{environment:t,permissionsInviteStore:n,from:o}=e;await u().iQ({environment:t,permissionsInviteStoreState:n.state,from:o})||n.reset()}function M(e){const{permissionsInviteStore:t,targetToRemove:n,defaultRoleForNonBot:o}=e,i=t.state.inviteTargets.filter((e=>e!==n));t.setState({...t.state,inviteTargets:i,inviteRole:o})}function B(e){const{environment:t,onUpgradeButtonClick:n,upgradeButtonName:o}=e;b().K(t,{from:o,upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}}),null==n||n()}async function P(e,t){const n=new Set(t),o=Array.from(n).map((async t=>{const n=await C().callApi({eventName:"findUser",environment:e,data:{email:t}});if("success"===n.type){const e=n.data;if(e.value){return{type:"existingUser",value:e.value.value}}}return{type:"newUser",value:{email:t},source:"email"}}));return await Promise.all(o)}async function R(e){const{environment:t,permissionsInviteStore:n,event:i}=e,s=i.target.value,{extractedEmails:a,newInputValue:r}=(0,o().Ct)(s),l=(await P(t,a)).filter((e=>!u().mQ({target:e,permissionsInviteStore:n}))),c=[...n.state.inviteTargets,...l];n.setState({...n.state,inviteTargets:c,inputFocus:"invitee",tokenQuery:r})}function _(e){const{environment:t,newRole:n,permissionsInviteStore:o}=e,{state:i}=o;k().Jy(t,{...u().oX(t,i),invite_updated_role:n}),o.setState({...i,inviteRole:n})}async function L(e){var t;const{query:n,environment:o,sectionLimit:i,intl:s,membersOnly:l,importContactType:c,shouldUseEdgeCacheRollout:d}=e,{currentSpaceStore:u}=f().default.state;if(!u)return{inviteUsers:[],inviteGroups:[]};const p=y().default.getConfigKey("search_contacts_timeout","timeoutMs"),{userLimit:g,groupLimit:h,importContactLimit:v}=i,x=await m().T.searchActions.load(),[b,S,{user:k,email:I},w]=await Promise.all([g>0?x.searchSpaceUsers({environment:o,query:n,membersOnly:l,limit:g,shouldUseEdgeCacheRollout:d}):[],h>0?x.searchSpaceGroups({query:n,intl:s}):[],x.searchEmailUser(o,n),v>0?(0,r().nQ)(p,C().callApi({eventName:"searchContacts",environment:o,data:{spaceId:u.id,limit:v,query:n,importContactType:c,includeNonNotionUsers:!l,includeUserId:!0}})):void 0]),A=b.slice(0,g).map((e=>({type:"existingUser",value:e}))),j=S.slice(0,h).map((e=>({type:"group",value:e})));k&&A.unshift({type:"existingUser",value:k}),I&&A.unshift({type:"newUser",value:{email:I},source:"email"});let T=0,M=[];var B;"success"===(null==w||null===(t=w.result)||void 0===t?void 0:t.type)&&(M=w.result.data.contacts.map((e=>({type:"newUser",value:{email:e.email,name:e.name,avatar_url:e.profile_photo,user_id:e.user_id},source:e.type}))),T=(null==w||null===(B=w.result)||void 0===B||null===(B=B.data)||void 0===B?void 0:B.totalCount)??0);return{inviteUsers:a().hS(A,(e=>e.value.email)),inviteGroups:j,importedContacts:M,totalContactsCount:T}}},544862:(e,t,n)=>{n.d(t,{A:()=>C});var o=n(296540),i=()=>n(484714),s=()=>n(56366),a=()=>n(959013),r=()=>n(896628),l=()=>n(454531),c=()=>n(751156),d=()=>n(478726),u=()=>n(227440),p=()=>n(867772),g=()=>n(681810),m=()=>n(608581),f=()=>n(145214),h=()=>n(704152),v=()=>n(807683),y=()=>n(401497),x=()=>n(534177),b=n(474848);function S(e){let{src:t,placeholderSrc:n,placeholderBehavior:i,imageStyle:s,containerStyle:a,onLoadComplete:r,testId:l}=e;const[c,d]=(0,o.useState)(!0);let u;switch(i){case"force-show-placeholder":u=!0;break;case"force-show-src":u=!1;break;case"show-placeholder-if-loading-src":u=!!n&&(c||void 0===t);break;default:(0,x().HB)(i)}const p=(0,y().IS)((()=>{const e={gridColumn:1,gridRow:1};return{container:{display:"grid",...a},srcWrapper:{...u&&{display:"none"},...e},placeholderWrapper:{pointerEvents:"none",...e}}}),[a,u]);(0,o.useEffect)((()=>{void 0!==t&&d(!0)}),[t]);const g=(0,o.useCallback)((e=>{d(!1),null==r||r()}),[r]);return(0,b.jsxs)("div",{style:p.container,children:[(0,b.jsx)(v().Ay,{src:t,onLoad:g,style:s,placeholderStyle:p.srcWrapper,placeholderLoadedStyle:p.srcWrapper,testId:l}),n&&(0,b.jsx)(v().Ay,{src:n,style:s,placeholderStyle:p.placeholderWrapper,placeholderLoadedStyle:p.placeholderWrapper})]})}var k=()=>n(453101);const C=function(e){let{store:t,disabled:a,paddingRight:l,paddingLeft:d,height:u,proxyWidth:m}=e;const f=(0,i().v3)(),h=(0,i().Y0)(),y=(0,s().uB)(void 0,n(454305).A),x=(0,s().K8)((()=>a||"suggest"===n(77246).Uv.getMode(t)||(0,n(600871).aD)(h)),[a,t,h]),k=(0,s().K8)((()=>t.getCover()),[t]),C=(0,s().O$)(g().A),[A,j]=(0,o.useState)(void 0);if(!k)return null;const T=C.loadingMode!==p().pF&&C.loadingMode!==p().Wc;return(0,b.jsx)(n(801678).A,{mouseStore:y,onFlushTemporaryPosition:e=>function(e,t,n){const{imagePosition:o,reset:i}=e;c().createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:n,canUndo:!0,perform:e=>{r().yY({store:t,coverPosition:o,transaction:e}),i()}})}(e,t,f),renderControl:e=>{let{handleRepositionClick:n,handleSavePositionClick:o,handleCancelClick:i,isVisible:s,isRepositioning:a}=e;return(0,b.jsx)(w,{handleRepositionClick:n,handleSavePositionClick:o,handleCancelClick:i,isVisible:s,isRepositioning:a,lastProxiedUrl:A,store:t,disabled:x,paddingRight:l,paddingLeft:d,mouseStore:y})},source:"page",store:t,style:{display:"flex",flexDirection:"column",alignItems:"center",height:u,maxHeight:280,cursor:"default"},preventClickPropagation:!0,render:e=>(0,b.jsxs)(o.Fragment,{children:[(0,b.jsx)(n(360083).A,{url:k.cover,isAuthenticated:!0,permissionRecord:k.pointer,width:m,onFinishedLoadingProxyUrl:j,render:(t,n)=>{const o={width:"100%",height:u,maxHeight:280,objectFit:"cover",opacity:T?.5:1,objectPosition:`center ${100*(1-(e.imagePosition||0))}%`,borderRadius:0},i={width:"100%",height:u,maxHeight:280};return(0,b.jsx)(S,{src:n,placeholderSrc:T?C.dataURL:void 0,placeholderBehavior:T?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:i,imageStyle:o,onLoadComplete:I,testId:"pageCover"})}}),T&&(0,b.jsxs)("div",{style:v().fd,children:[(0,b.jsx)(n(331542).A,{size:"md",style:{marginRight:4}}),(0,b.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:void 0!==C.uploadProgress?(0,b.jsx)(n(773382).A,{percentage:C.uploadProgress}):C.progressText?(0,b.jsx)("span",{children:C.progressText}):null})]})]})})};function I(){g().A.reset()}function w(e){let{isVisible:t,isRepositioning:n,handleCancelClick:r,handleRepositionClick:c,handleSavePositionClick:v,lastProxiedUrl:y,store:x,disabled:S,paddingRight:C,paddingLeft:I,mouseStore:w}=e;const A=(0,i().v3)(),j=(0,a().tz)(),T=(0,o.useCallback)((e=>function(e,t,n,o,i){i.reset();const s=e.target.getBoundingClientRect();l().W({environment:t,intl:n,store:o,rect:s,from:"page_header"})}(e,A,j,x,w)),[A,j,x,w]),M=(0,s().K8)((()=>g().A.state.loadingMode),[]),B=(0,s().K8)((()=>function(e){let t;return t=Boolean(e.isFullWidth())?"100%":d().x6,t}(x)),[x]),{device:P}=A,R=(0,s().O$)(u().e);if(S||M!==p().pF||!R)return null;const{isMobile:_}=P;return(0,b.jsx)(f().A,{animate:{width:B,opacity:t?1:0},style:{position:"absolute",pointerEvents:t?"auto":"none",maxWidth:"100%",top:48},children:(0,b.jsxs)(m().A,{isVisible:t,position:"bottom",style:{marginRight:C,marginLeft:I},children:[!n&&(0,b.jsx)(h().A,{style:{borderRight:_?"none":void 0,...k().k},onClick:T,children:(0,b.jsx)(a().sA,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!n&&!_&&(0,b.jsx)(h().A,{style:{...k().k,borderRight:"none"},onClick:e=>c(e,y),children:(0,b.jsx)(a().sA,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),n&&!_&&(0,b.jsx)(h().A,{style:k().k,onClick:v,children:(0,b.jsx)(a().sA,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),n&&!_&&(0,b.jsx)(h().A,{style:{...k().k,borderRight:"none"},onClick:r,children:(0,b.jsx)(a().sA,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})}},555267:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(296540),i=()=>n(401497),s=()=>n(62856),a=()=>n(331542),r=n(474848);function l(e){let{loadingMessage:t}=e;const n=(0,i().DP)(),l=(0,s().A)(!0,400);return(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:l?(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)(a().A,{}),t?(0,r.jsx)("div",{style:{marginLeft:8,color:n.text.secondary},children:t}):void 0]}):void 0})}},567121:(e,t,n)=>{n.d(t,{EG:()=>a,K5:()=>s,RH:()=>i,Yi:()=>r,ls:()=>o});const o=32,i=202,s=1e3,a="Want to add a metric? Look for 'src/client/performanceToolbar/config.ts' in notion-next.",r="To disable the toolbar entirely, go to the 'Experiments' panel and look for the 'performance_debugging_toolbar' flag."},578194:(e,t,n)=>{n.d(t,{r:()=>o});const o=(0,n(583835).Dv)("importEvernote")},608581:(e,t,n)=>{n.d(t,{A:()=>u});n(898992),n(354520),n(581454),n(941795);var o=n(296540),i=()=>n(401497),s=()=>n(955825),a=()=>n(284371),r=()=>n(780054),l=()=>n(963575),c=n(474848);function d(e){const{button:t,isLast:n}=e,r=(0,i().IS)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:a().Wy.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return o.cloneElement(t,{...(0,s().AH)(t.props.style,r.button,n&&r.buttonLast),hoveredStyle:(0,s().AH)(r.buttonHovered,n&&r.buttonLast).style,pressedStyle:r.buttonPressed})}const u=function(e){let{children:t,isVisible:u,position:p,style:g}=e;const m=(0,i().IS)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.shadowSM,display:"flex",whiteSpace:"nowrap",borderRadius:l().A.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:r().A.isMobile?"auto":"none",opacity:r().A.isMobile?1:0,fontFamily:a().vc(n(662303).locale).sans,position:"absolute",right:l().A.horizontal.small,bottom:l().A.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:l().A.vertical.small,bottom:void 0}})),[]),f=o.Children.toArray(t).filter(n(534177).O9),h=f.length;return(0,c.jsx)(n(145214).A,{animate:{opacity:u?1:0},...(0,s().AH)(m.container,g,u&&m.containerHover,"top"===p&&m.containerTop),children:f.map(((e,t)=>{const i=t===h-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===n(859428).A&&o.isValidElement(e))return o.cloneElement(e,{render:(t,n)=>{const o=e.props.render(t,n);return(0,c.jsx)(d,{isLast:i,button:o},e.key)}});if(e.type===n(704152).A&&o.isValidElement(e))return(0,c.jsx)(d,{isLast:i,button:e},e.key)}}))})}},617837:(e,t,n)=>{n.d(t,{j:()=>f});var o=n(296540),i=()=>n(484714),s=()=>n(56366),a=()=>n(401497),r=()=>n(959013),l=()=>n(534177),c=()=>n(272200),d=()=>n(273190),u=()=>n(227440),p=()=>n(966106),g=()=>n(285790),m=n(474848);function f(e){const{traceId:t,feedbackState:n,setFeedbackState:c,feedbackType:f,iconHeight:v}=e,y=(0,a().IS)((e=>({wrapper:{...v?{height:v}:{}},iconButton:{...v?{height:v}:{}}})),[v]),{thumbsUpType:x,thumbsDownType:b}=(0,o.useMemo)((()=>{switch(f){case"ai_block":return{thumbsDownType:"ai_block_thumbs_down",thumbsUpType:"ai_block_thumbs_up"};case"autofill":return{thumbsDownType:"ai_autofill_thumbs_down",thumbsUpType:"ai_autofill_thumbs_up"};default:(0,l().HB)(f)}}),[f]),S=(0,r().tz)(),k=(0,i().v3)(),C=!(0,s().O$)(u().e),I=(0,o.useCallback)((()=>{p().A.setState({...p().A.state,open:!0,type:b,traceId:t,thumbsUpOrDown:"down"}),c({type:"thumbsdown",userContent:"",shareWithNotion:!0}),h({environment:k,inferenceId:t,feedbackType:"thumbsdown",userContent:"",shareWithNotion:!0})}),[k,c,b,t]),w=(0,o.useCallback)((()=>{p().A.setState({...p().A.state,open:!0,type:x,traceId:t,thumbsUpOrDown:"up"}),c({type:"thumbsup",userContent:"",shareWithNotion:!0}),h({environment:k,inferenceId:t,feedbackType:"thumbsup",userContent:"",shareWithNotion:!0})}),[k,c,x,t]);return(0,m.jsxs)("div",{onClick:e=>{e.stopPropagation(),e.preventDefault()},style:y.wrapper,children:[(0,m.jsx)(g().A,{onClick:w,icon:(0,d().gZ)("thumbsup","thumbsup"===(null==n?void 0:n.type)),ariaLabel:S.formatMessage({id:"AiFeatureFeedbackButtons.thumbsUp",defaultMessage:"Helpful"}),disabled:C,style:y.iconButton}),(0,m.jsx)(g().A,{icon:(0,d().gZ)("thumbsdown","thumbsdown"===(null==n?void 0:n.type)),onClick:I,ariaLabel:S.formatMessage({id:"AiFeatureFeedbackButtons.thumbsDown",defaultMessage:"Not helpful"}),disabled:C,style:y.iconButton})]})}function h(e){const{environment:t,inferenceId:n,feedbackType:o,userContent:i,shareWithNotion:s}=e;c().trackAIAction(t,{type:"property_autofill",inference_id:n,feedback_type:o,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:s})}},628864:(e,t,n)=>{n.d(t,{Hn:()=>W,XN:()=>D,pj:()=>P,qj:()=>U});n(944114),n(898992),n(354520),n(672577),n(581454),n(737550);var o=n(296540),i=()=>n(484714),s=()=>n(56366),a=()=>n(401497),r=()=>n(148307),l=()=>n(617871),c=()=>n(353147),d=()=>n(315564),u=()=>n(381138),p=()=>n(966098),g=()=>n(959013),m=()=>n(496603),f=()=>n(973647),h=()=>n(534177),v=()=>n(449506),y=()=>n(510683),x=()=>n(972435),b=()=>n(881707),S=()=>n(47170),k=()=>n(62856),C=()=>n(53137),I=()=>n(829e3),w=()=>n(760217),A=()=>n(419357),j=()=>n(331542),T=()=>n(89924),M=n(474848);const B=(0,g().YK)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function P(e){const{currentNotificationChannels:t,onNotificationChannelSelect:n,onNotificationChannelSelectAll:a,onClose:c,onNewSlackAccountAdded:d,renderMenu:p,channelFilter:v,workflowExternalScopedConnectionPointer:I,isMultiSelectMode:P,shouldHideSlackAccountSection:E,shouldShowSelectAllChannels:U,isAllChannels:F,shouldShowImChannels:O}=e,N=(0,i().v3)(),{isMobile:G}=(0,i().Y0)(),z=(0,s().O$)(C().A.completeSlackAuthentications),q=e.currentExternalAuthentication??m().$1(z),H=(0,o.useMemo)((()=>I?{type:"workflow",workflowExternalScopedConnectionId:I.id}:q?{type:"external",botId:q.id}:void 0),[I,q]);o.useEffect((()=>{const e=I?null==I?void 0:I.spaceId:null==q?void 0:q.space_id;H&&e&&W({environment:N,spaceId:e,externalAuthConfig:H})}),[N,H,q,I]);const K=(null==I?void 0:I.id)??(null==q?void 0:q.id),[V,$]=o.useState(""),{loadedChannelsForAccount:Q,isLoading:Y}=D(H),X=(0,s().K8)((()=>C().A.integrations.state.find((e=>e.id===l().zG))),[]),Z=(0,S().O)(),J=o.useCallback((e=>{q?n(e,q.parent_id):I&&n(e,I.id),P||c()}),[n,q,I,c,P]),ee=o.useCallback((()=>{const e=q?q.parent_id:null==I?void 0:I.id;e&&a&&a(e),P&&U||c()}),[q,I,P,U,a,c]),te=R(),ne=o.useCallback((e=>{const{channel:n}=e;return{key:n.id,render:e=>(0,M.jsx)(w().A,{...e,icon:L({channel:n,styles:te.icon}),desktopIconStyle:{width:8},title:n.name,isChecked:!F&&(null==t?void 0:t.some((e=>e.id===n.id)))}),action:()=>{J(n)}}}),[te,F,t,J]),{publicChannels:oe,privateChannels:ie,personalChannels:se,imChannels:ae}=o.useMemo((()=>function(e,t){const n=[],o=[],i=[],s=[];e.sort(((e,t)=>e.name.localeCompare(t.name)));for(const a of e)t&&!t(a)||("public"===a.type?n.push(a):"private"===a.type?o.push(a):"me"===a.type?i.push(a):"im"===a.type?s.push(a):(0,h().HB)(a.type));return{publicChannels:n,privateChannels:o,personalChannels:i,imChannels:s}}(Q,v)),[v,Q]),re=o.useCallback((()=>oe.map((e=>({menuListItem:ne({channel:e}),channelName:e.name})))),[oe,ne]),le=o.useCallback((()=>ie.map((e=>({menuListItem:ne({channel:e}),channelName:e.name})))),[ie,ne]),ce=o.useCallback((()=>se.map((e=>({menuListItem:ne({channel:e}),channelName:e.name})))),[se,ne]),de=o.useCallback((()=>ae.map((e=>({menuListItem:ne({channel:e}),channelName:e.name})))),[ae,ne]),ue=o.useCallback((()=>re().map((e=>{let{menuListItem:t,channelName:n}=e;if(_({channelName:n,query:V}))return t})).filter(h().O9)),[re,V]),pe=o.useCallback((()=>le().map((e=>{let{menuListItem:t,channelName:n}=e;if(_({channelName:n,query:V}))return t})).filter(h().O9)),[le,V]),ge=o.useCallback((()=>ce().map((e=>{let{menuListItem:t,channelName:n}=e;if(_({channelName:n,query:V}))return t})).filter(h().O9)),[ce,V]),me=o.useCallback((()=>de().map((e=>{let{menuListItem:t,channelName:n}=e;if(_({channelName:n,query:V}))return t})).filter(h().O9)),[de,V]),fe=o.useCallback((()=>q?(0,b().qO)(q).organizationName:"Workflows organization"),[q]),he=o.useCallback((()=>{if(!K)return[];const e=[],t=ue(),n=pe(),o=ge(),i=me(),s=U&&P&&!V;return s&&e.push({key:"select-all-channels",render:e=>(0,M.jsx)(T().A,{...e}),items:[{key:"all-channels",render:e=>(0,M.jsx)(w().A,{...e,title:(0,M.jsx)(g().sA,{id:"notificationRuleSettings.selectChannelView.selectAllChannels.label",defaultMessage:"All channels"}),isChecked:F}),action:ee}]}),o.length>0&&e.push({key:"personal-channels",render:e=>(0,M.jsx)(T().A,{...e,title:fe(),topBorder:s}),items:o}),t.length>0&&e.push({key:"public-channels",render:e=>(0,M.jsx)(T().A,{...e,topBorder:o.length>0||s,title:0===o.length&&fe()}),items:t}),n.length>0&&e.push({key:"private-channels",render:e=>(0,M.jsx)(T().A,{...e,topBorder:t.length>0||s,title:0===o.length&&t.length>0&&fe()}),items:n}),O&&i.length>0&&e.push({key:"im-channels",render:e=>(0,M.jsx)(T().A,{...e,title:(0,M.jsx)(g().sA,{defaultMessage:"Direct Messages with Notion",id:"imChannels.title"})}),items:i}),e}),[K,ue,pe,ge,me,U,P,ee,F,fe,V,O]),ve=(0,k().A)(Y,500,300);if(!K)return null;const ye=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,M.jsx)("div",{children:(0,M.jsx)(A().Ay,{...e,inputLeft:(0,M.jsx)(A().Zf,{icon:u().q}),inputRight:ve&&(0,M.jsx)(j().A,{style:{marginRight:2}}),showClearButton:!0,placeholder:x().A.formatMessage(B.channelSearchPlaceholder),focusInitial:!G,value:V,onChange:e=>{$(e.target.value)}})})}],render:e=>(0,M.jsx)(T().A,{...e})},...he()];return t||E||!X||ye.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!Z)return;const e=await y().Jq({environment:N,integration:X,spaceId:Z,from:"collection_view_settings"});f().Q.isFail(e)||d()},render:e=>(0,M.jsx)(w().A,{...e,icon:(0,M.jsx)("img",{src:r().A.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,M.jsx)(g().sA,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,M.jsx)(T().A,{...e,topBorder:!0})}),(0,M.jsx)(M.Fragment,{children:p(ye)})}function R(){return(0,a().IS)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.text.tertiary},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.icon.primary}})),[])}function _(e){const{channelName:t,query:n}=e;return 0===n.length||t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}function L(e){const{channel:t,styles:n}=e;return"private"===t.type?(0,d().S)(n):"me"===t.type||"im"===t.type?(0,c().b)(n):(0,p().E)(n)}const E=15e3;function D(e){return(0,s().K8)((()=>{if(!e)return{loadedChannelsForAccount:[],isLoading:!1};const t=I().c.getStateForBot(e);return{loadedChannelsForAccount:Object.values(t.channels),isLoading:t.fetching}}),[e])}async function W(e){const{environment:t,externalAuthConfig:n,spaceId:o}=e,i=I().c.getStateForBot(n);if(!(i.fetching||Date.now()-i.lastRefreshed<E)){if(I().c.updateStateForBot(n,{fetching:!0,lastRefreshed:Date.now()}),"workflow"===n.type){const e=await v().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:o,cursor:void 0,...n}});if("success"===e.type){const t={};for(const n of e.data.channels)t[n.id]=n;I().c.addChannelsForBot(n,t)}}else{let e;for(;;){const i=await v().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:o,cursor:e,...n}});if("success"!==i.type){console.error(i.error);break}{const t={};for(const e of i.data.channels)t[e.id]=e;if(I().c.addChannelsForBot(n,t),e=i.data.cursor,!e)break}await new Promise((e=>setTimeout(e,0)))}}I().c.updateStateForBot(n,{fetching:!1})}}const U=o.forwardRef(((e,t)=>{const{channel:n,currentNotificationChannels:o,...i}=e,s=R();return(0,M.jsx)(w().A,{ref:t,...i,icon:L({channel:n,styles:s.icon}),desktopIconStyle:{width:8},title:n.name,isChecked:null==o?void 0:o.some((e=>e.id===n.id))})}));U.displayName="SlackChannelMenuItem"},654856:(e,t,n)=>{n.d(t,{A:()=>u});n(581454);var o=n(296540),i=()=>n(56366),s=()=>n(959013),a=()=>n(743260),r=()=>n(299545),l=()=>n(417555),c=()=>n(856952),d=n(474848);const u=function(e){const{origin:t,permissionsInviteStore:u,store:p,handleClickRemoveToken:g,handleInputChange:m,handleInputSubmit:f,defaultRoleForNonBot:h,right:v,focus:y,handleFocus:x}=e,b=(0,i().K8)((()=>0!==(0,n(731320).Qo)()),[]),S="share_menu"===t||"add_members"===t,k="add_members"===t,[C,I]=(0,i().$y)(u),w=(0,n(484714).v3)(),{device:A}=w,j=(0,s().tz)(),{tokenQuery:T}=C,M=(0,n(101749).N)(p),B=C.inviteTargets.map((e=>{const t="newUser"===e.type?e.value.email:`${e.type}-${e.value.id}`,i=(0,a().yi)(e),r="newUser"===e.type||"existingUser"===e.type?e.value.email:void 0,c=i?M:void 0,u={key:t,target:e,onClickRemove:g,role:C.inviteRole,shouldWrap:S,showInfoIcon:Boolean(c)};return S&&r?(0,d.jsx)(n(859428).A,{placement:n(962730).W.Top,disableTooltip:k,renderTooltip:()=>i?c||(0,d.jsx)(s().sA,{defaultMessage:"{email} will be invited as a guest",id:"ContextualInvite.permissions_invites.guest.tooltip",values:{email:r}}):r,render:n=>(0,o.createElement)("span",{...n,key:t},(0,d.jsx)(l().A,{...u,backgroundColor:(0,a().qv)(e)}))},t):(0,o.createElement)(l().A,{...u,key:t})})),P=0===C.inviteTargets.length;return(0,d.jsx)(c().Ay,{focus:A.isMobile?void 0:y,focusInitial:A.isMobile,focusAfterAnimation:!0,onClick:()=>{A.isMobile||null==x||x()},format:c().le.Share,value:T,onChange:m,type:"email",tokens:B,disabled:!1,autoComplete:"off",placeholder:S?b?j.formatMessage({defaultMessage:"Add people, groups, or emails…",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithTeams"}):j.formatMessage({defaultMessage:"Add emails or people",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithoutBots"}):(0,r().Yu)(p)||(0,r().nw)(p)?j.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):j.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),onRemoveLastToken:()=>{const e={...C};e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.inviteRole=h),I(C)},right:v,inputFullWidth:!0,inputAndTokenWrapRightStyle:{paddingTop:w.device.isMobile||"add_members"===t?0:P?7:6,paddingBottom:w.device.isMobile||S?0:4},onEmptySubmit:()=>f(),dontShowBorderBottom:A.isAndroid,showBorder:S,...!S&&{style:{padding:"10px  9px 4px 9px"}},...S&&{style:{borderRadius:4,paddingTop:P?3:0,paddingBottom:0,...y&&{background:"none"}}}})}},681810:(e,t,n)=>{n.d(t,{A:()=>o});const o=new(n(867772).Ay)},731518:(e,t,n)=>{n.r(t),n.d(t,{AiBlockV2:()=>jn});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949);var o=()=>n(153321),i=n(296540),s=()=>n(17022),a=()=>n(662303),r=()=>n(484714),l=()=>n(56366),c=()=>n(401497),d=()=>n(1295),u=()=>n(534177),p=()=>n(68263),g=()=>n(179034),m=()=>n(519831),f=()=>n(96689),h=()=>n(189141);function v(e){const{referenceContext:t,getRecordRole:n,getCanReadSlackChannel:o}=e;if(!t)return!0;for(const i of t)if("collection"===i.type){const e=n({id:i.collectionId,table:m().Vl})??"none";if(!(0,p().Tt)(e))return!1}else if("page"===i.type||"currentPage"===i.type){const e=n({id:i.pageId,table:g().ev})??"none";if(!(0,p().Tt)(e))return!1}else if("slack"===i.type){if(!o(i))return!1}else(0,u().HB)(i);return!0}class y{constructor(e){this.permissionLevel=void 0,this.permissionLevel=e}canOpenConfigurationPanel(){switch(this.permissionLevel){case"editor":case"configuration_reader":return!0;case"reader":return!1;default:(0,u().HB)(this.permissionLevel)}}canEditConfigurationPanel(){switch(this.permissionLevel){case"reader":case"configuration_reader":return!1;case"editor":return!0;default:(0,u().HB)(this.permissionLevel)}}canGenerateBlock(){switch(this.permissionLevel){case"editor":return!0;case"configuration_reader":case"reader":return!1;default:(0,u().HB)(this.permissionLevel)}}canDuplicateBlock(){switch(this.permissionLevel){case"reader":return!1;case"configuration_reader":case"editor":return!0;default:(0,u().HB)(this.permissionLevel)}}}var x=()=>n(663760),b=()=>n(857639),S=()=>n(416845),k=()=>n(513416),C=()=>n(606641),I=()=>n(735790),w=()=>n(134025),A=()=>n(370085),j=()=>n(388821),T=()=>n(798880),M=()=>n(76118),B=()=>n(439180),P=()=>n(959013),R=()=>n(532659),_=()=>n(496603),L=()=>n(532313),E=()=>n(284371),D=()=>n(449506),W=()=>n(901389),U=()=>n(863168),F=()=>n(246826),O=()=>n(778417),N=()=>n(751156),G=()=>n(2220),z=()=>n(285790),q=()=>n(331542),H=()=>n(859428),K=()=>n(780054),V=()=>n(864145),$=()=>n(972435),Q=()=>n(553965),Y=()=>n(963589),X=()=>n(765957),Z=()=>n(829e3),J=()=>n(630116),ee=()=>n(991249),te=()=>n(329304),ne=()=>n(11048),oe=()=>n(155004),ie=()=>n(704152),se=()=>n(406699),ae=()=>n(493733),re=(n(944114),n(823215),n(672577),n(581454),n(737550),()=>n(324254)),le=()=>n(537193),ce=()=>n(671089),de=()=>n(880565),ue=()=>n(813197),pe=()=>n(920495),ge=()=>n(983521),me=()=>n(37719),fe=()=>n(82008),he=()=>n(604018),ve=()=>n(186445),ye=()=>n(847743),xe=()=>n(722872),be=()=>n(517525);function Se(){return(0,l().K8)((()=>{const e=(0,be().J)({originSurface:"ai_block"}),t=e.find((e=>"slack"===e.type)),n=e.find((e=>"web"===e.type));return{isSlackConnected:(null==t?void 0:t.isAvailable({originSurface:"ai_block"}))??!1,isWebSearchAvailable:(null==n?void 0:n.isAvailable({originSurface:"ai_block"}))??!1}}),[])}var ke=()=>n(962730),Ce=()=>n(760217),Ie=()=>n(805751),we=()=>n(928600),Ae=()=>n(939740),je=()=>n(8980),Te=()=>n(204063),Me=()=>n(187820),Be=()=>n(16006),Pe=()=>n(89924),Re=()=>n(946548),_e=()=>n(125565),Le=n(474848);function Ee(e){const{store:t,style:n}=e,o=(0,r().v3)(),s=(0,l().K8)((()=>{const e=t.getNavigableBlockStore();return(null==e?void 0:e.isTemplate())??!1}),[t]),a=(0,l().K8)((()=>t.autoGenerateOnTemplateDuplication()),[t]),c=(0,i.useCallback)((()=>{N().createAndCommit({userAction:"AiBlock.updateBlockConfiguration",environment:o,canUndo:!0,perform:e=>{F().zv({store:t.getFormatStore().getKeyStore("ai_block_configuration_menu"),data:{autoGenerateOnTemplateDuplication:!a},transaction:e})}})}),[t,o,a]);return s?(0,Le.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",...n},children:[(0,Le.jsx)(_e().A,{children:(0,Le.jsx)(P().sA,{id:"AiBlockV2.AutoGenerateOnTemplateDuplicationFieldToggle.Label",defaultMessage:"Autofill when template is duplicated"})}),(0,Le.jsx)(Re().A,{on:a,onClick:c})]}):null}var De=()=>n(908006),We=()=>n(395361),Ue=()=>n(425940),Fe=()=>n(919709),Oe=()=>n(829300),Ne=()=>n(725614),Ge=()=>n(515692),ze=()=>n(220331),qe=()=>n(38337),He=()=>n(792540),Ke=()=>n(231722),Ve=()=>n(24157),$e=()=>n(84817),Qe=()=>n(493823),Ye=()=>n(843189),Xe=()=>n(509657),Ze=()=>n(628864),Je=()=>n(524702),et=()=>n(149375),tt=()=>n(245241),nt=()=>n(778078),ot=()=>n(825972),it=()=>n(135599),st=()=>n(970585),at=()=>n(464708),rt=()=>n(64e3),lt=()=>n(897119),ct=()=>n(958378),dt=(n(18107),n(967357),()=>n(148307)),ut=()=>n(612740),pt=()=>n(784892),gt=()=>n(416504),mt=()=>n(129852),ft=()=>n(881690),ht=()=>n(589222),vt=()=>n(623580),yt=()=>n(460292);const xt=(0,P().YK)({addContextPlaceholder:{id:"ContextTokenPlaceholderTypeahead.addContextPlaceholder",defaultMessage:"Add context"}}),bt={regular:24,spacious:31};function St(e){const{disabled:t,currentlyFocusedItem:n,items:o,query:s,setQuery:a,isMenuOpen:r,hasContextsAlready:l,inputRef:d,heightVariant:u,hideCompactMode:p,isShowingContextWarning:g}=e,m=(0,P().tz)(),f=(0,i.useMemo)((()=>{var e;if(!s)return;if(n)return n.title.toLowerCase().startsWith(s.toLowerCase())?`${s}${n.title.slice(s.length)}`:s;const t=null===(e=o.find((e=>e.title.toLowerCase().startsWith(s.toLowerCase()))))||void 0===e?void 0:e.title;return t?`${s}${t.slice(s.length)}`:s}),[o,s,n]),h=(0,i.useMemo)((()=>!!g||!r&&l),[g,r,l]),v=(0,i.useMemo)((()=>s?f??"":m.formatMessage(xt.addContextPlaceholder)),[s,m,f]),y=(0,i.useRef)(null),[x,b]=(0,i.useState)(null);(0,i.useEffect)((()=>{y.current&&b(y.current.offsetWidth)}),[y,v,h]),(0,i.useEffect)((()=>{r||a("")}),[r,a]);const S=(0,c().IS)((e=>({container:{display:"flex",alignItems:"center",background:h?"transparent":e.inputBackground,borderRadius:6,paddingLeft:0,paddingRight:0,height:bt[u],...E().RC},backgroundInput:{height:void 0,position:"absolute",top:0,left:0,display:"flex",alignItems:"center",borderRadius:6,paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,fontSize:14,lineHeight:"20px",width:"fit-content",...E().RC,color:e.text.quaternary},foregroundInput:{boxShadow:"none",background:"transparent",width:null===x?void 0:x,color:e.text.secondary},plusIcon:{fill:e.text.quaternary,width:14,height:14,marginLeft:6,...h&&{marginRight:6}}})),[x,h,u]);return p&&h?null:(0,Le.jsx)(H().A,{disableTooltip:!h,textWrap:!0,style:{minWidth:200,padding:"4px 8px"},renderTooltip:()=>(0,Le.jsx)(P().sA,{id:"ContextTokenPlaceholderTypeahead.tooltip",defaultMessage:"Add context to help Notion AI generate relevant content"}),render:n=>(0,Le.jsxs)(Qe().p,{...n,style:S.container,onClick:e.onFocus,disabled:t,children:[(0,Le.jsx)(yt().Q,{iconGroup:ht().h,variantName:"default",colorName:"grayPrimary",style:S.plusIcon}),h?void 0:(0,Le.jsxs)("div",{style:{position:"relative"},children:[(0,Le.jsx)("div",{ref:y,style:S.backgroundInput,children:v}),(0,Le.jsx)(Ie().A,{capture:!0,debugName:"ContextTokenPlaceholderTypeahead",allowMenuList:!0,children:(0,Le.jsx)(vt().A,{ref:d,disabled:t,style:S.foregroundInput,focus:r,value:s,onChange:e=>{a(e.target.value)},suppressFocusRing:!0,onFocus:()=>{e.onFocus()}})})]})]})})}const kt=(0,P().YK)({slackIconAriaLabel:{id:"AiBlockV2ContextTokenInput.slackIconAriaLabel",defaultMessage:"Slack"}});function Ct(e){const{disabled:t,currentContexts:n,contextInputRef:o,inputRef:s,query:a,setQuery:r,searchResultMenuIsOpen:d,setSearchResultMenuIsOpen:p,handleUpdateContexts:g,searchResultMenuState:m,menuListStore:f,heightVariant:h,actionButtons:v,showEmptyStateWarning:y}=e,x=(0,gt().P)(),b=(0,P().tz)(),S=(0,l().K8)((()=>"notion"===m.type?m.results.map((e=>({key:e.blockStore.id,item:e,title:e.blockStore.getRenderTitle({userTimeZone:x,intl:b})??(0,ut().L)(b)}))):"slack"===m.type?m.results.map((e=>({key:e.channel.id,title:e.channel.name,item:e}))):"choose"===m.type?[]:void(0,u().HB)(m)),[m,x,b]),k=(0,l().K8)((()=>{const e=f.state.focus.indexGlobal;return void 0!==e?S.at(e):void 0}),[f,S]),C=(0,i.useCallback)((e=>{g(n.filter((t=>!(0,_().n4)(t,e))))}),[n,g]),I=Boolean(v),w=(0,c().IS)((e=>({container:{position:"relative",borderRadius:6,boxShadow:e.inputBoxShadow,backgroundColor:"dark"===e.mode?e.palette.translucentGray[100]:"transparent",display:"flex",alignItems:"center",padding:4,gap:4,justifyContent:"space-between",cursor:"pointer",width:"100%"},tokensWrapper:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:4,flex:1,minHeight:bt[h],paddingLeft:I?4:void 0},actionButtonsWrapper:{display:"flex",alignItems:"center",flexShrink:0,marginRight:4},firstLinePlaceholder:{position:"absolute",top:0,left:0,height:32,width:"100%"}})),[I,h]);return(0,Le.jsxs)("div",{style:w.container,onClick:()=>p(!0),children:[(0,Le.jsx)("div",{ref:o,style:w.firstLinePlaceholder}),(0,Le.jsxs)("div",{style:w.tokensWrapper,children:[(0,Le.jsx)(St,{hideCompactMode:I,disabled:t,inputRef:s,query:a,setQuery:r,items:S,currentlyFocusedItem:k,onSuggestionSelected:e=>{d&&(g([e.item,...n]),r(""),p(!1))},hasContextsAlready:n.length>0,onFocus:()=>{p(!0)},isMenuOpen:d,heightVariant:h,isShowingContextWarning:y}),y&&(0,Le.jsx)(It,{disabled:t,heightVariant:h}),n.map((e=>(0,Le.jsx)(wt,{contextItem:e,disabled:t,onRemove:t=>{C(e),t.preventDefault(),t.stopPropagation()}},function(e){if("currentPage"===e.type)return`currentPage-${e.blockStore.id}`;if("block"===e.type)return`block-${e.blockStore.id}`;if("slack"===e.type)return`slack-${e.channel.id}`}(e))))]}),v&&(0,Le.jsx)("div",{style:w.actionButtonsWrapper,children:v})]})}function It(e){const{disabled:t}=e,n=(0,c().IS)((e=>({container:{position:"relative",borderRadius:6,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:t?"default":"pointer",paddingLeft:4},contentWrapper:{display:"flex",alignItems:"center",gap:8},placeholder:{color:e.text.yellowSecondary,fontSize:14,userSelect:"none"},exclamationIcon:{color:e.text.yellowSecondary,height:18,width:18}})),[t]);return(0,Le.jsx)("div",{style:n.container,children:(0,Le.jsxs)("div",{style:n.contentWrapper,children:[(0,mt().exclamationMarkCircleIcon)(n.exclamationIcon),(0,Le.jsx)("div",{style:n.placeholder,children:(0,Le.jsx)(P().sA,{defaultMessage:"AI blocks work better with context",id:"aiBlockV2ContextInput.placeholder"})})]})})}function wt(e){const{contextItem:t,disabled:n,onRemove:o}=e,i=(0,P().tz)(),s=(0,gt().P)(),a=(0,l().K8)((()=>"currentPage"===t.type||"block"===t.type?t.blockStore.getRenderTitle({userTimeZone:s,intl:i})??(0,ut().L)(i):"slack"===t.type?t.channel.name:void(0,u().HB)(t)),[t,i,s]),r=(0,c().IS)((e=>({tokenWrapper:{backgroundColor:e.lightGrayBannerBackground,cursor:"pointer",paddingLeft:4,paddingRight:4,paddingTop:12,paddingBottom:12,borderRadius:4,maxWidth:150,height:24,color:e.text.secondary}})),[]);return(0,Le.jsx)(ft().A,{disabled:n,style:r.tokenWrapper,format:pt().NY.Small,isSingle:!0,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1,showRemoveButton:!0,onClickRemove:o,value:(0,Le.jsx)(Mt,{contextItem:t}),showTooltip:"overflow",tooltip:a,tooltipPlacement:ke().W.Bottom,tooltipOriginGap:0})}const At=16,jt=12;function Tt(){return(0,c().IS)((e=>({recordTitleStyle:{display:"flex",alignItems:"center",gap:4}})),[])}function Mt(e){const{contextItem:t}=e;return"currentPage"===t.type?(0,Le.jsx)(Bt,{blockStore:t.blockStore}):"block"===t.type?(0,Le.jsx)(Pt,{blockStore:t.blockStore}):"slack"===t.type?(0,Le.jsx)(Rt,{channel:t.channel}):(0,u().HB)(t)}function Bt(e){const{blockStore:t}=e,n=Tt(),o=(0,l().K8)((()=>t.getIcon()),[t]),i=(0,l().K8)((()=>(0,Me().Te)(t)),[t]);return(0,Le.jsxs)("div",{style:n.recordTitleStyle,children:[(0,Le.jsx)(Me().B6,{disabled:!0,icon:o,iconRecordCategory:i,isEmptyPage:!1,size:At}),(0,Le.jsx)("div",{style:E().RC,children:(0,Le.jsx)(P().sA,{defaultMessage:"Current page",id:"ContextTokenInput.currentPage"})})]})}function Pt(e){const{blockStore:t}=e,n=Tt(),o=(0,l().K8)((()=>t.getIcon()),[t],{useDeepEqual:!0}),i=(0,l().K8)((()=>(0,Me().Te)(t)),[t]);return(0,Le.jsxs)("div",{style:n.recordTitleStyle,children:[(0,Le.jsx)(Me().B6,{disabled:!0,icon:o,iconRecordCategory:i,isEmptyPage:!1,size:At}),(0,Le.jsx)(Be().A,{store:t})]})}function Rt(e){const{channel:t}=e,n=Tt(),o=(0,P().tz)();return(0,Le.jsxs)("div",{style:n.recordTitleStyle,children:[(0,Le.jsx)("img",{width:jt,src:dt().A.images.externalIntegrations.slackIconPng,alt:o.formatMessage(kt.slackIconAriaLabel)}),(0,Le.jsx)("div",{children:t.name})]})}const _t=(0,P().YK)({notionContextLabel:{id:"notionContextLabel",defaultMessage:"Notion"},slackContextLabel:{id:"slackContextLabel",defaultMessage:"Slack"}}),Lt="notion";function Et(e){var t;const{currentContexts:n,handleUpdateContexts:o,disabled:s,showEmptyStateWarning:a,heightVariant:c,defaultSearchContext:d,onSearchContextSelected:p,actionButtons:g}=e,[m,f]=(0,i.useState)(!1),h=(0,l().uB)(void 0,st().A),v=(0,l().K8)((()=>["notion",...(0,he().wd)().filter(Ut)]),[]),[y,x]=(0,i.useState)(""),{searchResultMenuState:b,setCurrentSearchContext:S}=function(e){const{availableSearchContexts:t,currentContexts:n,query:o,defaultSearchContext:s}=e,a=t.length>1,[c,d]=(0,i.useState)(s||(a?void 0:Lt)),p=(0,r().v3)(),g=(0,l().O$)(X().AppStoreCurrentSpaceStore),m=null==g?void 0:g.id,f=(0,l().K8)((()=>ot().NK.state.map((e=>e.store))),[]),{results:h,isResultsLoading:v}=(0,it().W)({source:"ai_block_v2_page_context_search",query:o,limit:20,type:tt().Vz.BlocksInSpace,excludedBlockIds:n.filter((e=>"slack"!==e.type)).map((e=>e.blockStore.id)),filters:{requireEditPermissions:!1,excludeTemplates:!1},options:{disable:!o||"notion"!==c}}),y=(0,i.useMemo)((()=>h.map((e=>e.store))),[h]),x=(0,i.useMemo)((()=>o?v?"searching":"loaded":"default"),[o,v]),b=(0,l().O$)(X().AppStoreMainEditorCurrentBlockStore),S=(0,l().K8)((()=>{if(o)return y??[];return[...b?[b]:[],...f]}),[o,y,f,b]);(0,i.useEffect)((()=>{m&&(0,Ze().Hn)({environment:p,spaceId:m,externalAuthConfig:{type:"universal",app:"slack",spaceId:m}})}),[p,m]);const{channels:k,isFetchingSlack:C}=(0,l().K8)((()=>{if(!m)return{channels:Z().m.channels,isFetchingSlack:Z().m.fetching};const e=Z().c.getStateForBot({type:"universal",app:"slack",spaceId:m});return{channels:e.channels,isFetchingSlack:e.fetching}}),[m]),I=(0,i.useMemo)((()=>Object.values(k).map((e=>({type:"slack",channel:e})))),[k]),[w,A]=(0,i.useState)([]);(0,i.useEffect)((()=>{0===w.length&&I.length>0&&A(I)}),[I,w.length]);const j=function(e,t){const[n,o]=(0,i.useState)(e);return(0,i.useEffect)((()=>{const n=setTimeout((()=>o(e)),t);return()=>clearTimeout(n)}),[e,t]),n}(o,300),[T,M]=(0,i.useState)([]);(0,i.useEffect)((()=>{let e=!1;async function t(){if("slack"===c&&j){const t=await async function(e,t,n,o){const i=100,s=[];for(let a=0;a<t.length;a+=i){const r=t.slice(a,a+i);await new Promise((e=>setTimeout(e,0)));const l=(0,nt().Ay)(e,r,n,o);s.push(...l)}return(0,nt().Ay)(e,s,n,o)}(j,I,(e=>e.channel.name));e||M(t)}else M(w)}return t(),()=>{e=!0}}),[c,j,I,w]);const B=(0,i.useDeferredValue)(j),P=(0,i.useMemo)((()=>"slack"===c&&B?T:w),[c,B,w,T]),R=(0,i.useMemo)((()=>{if(!c)return{type:"choose"};const e=S.map((e=>({type:e.id===(null==b?void 0:b.id)?"currentPage":"block",blockStore:e})));if("slack"===c){let e="default";return o&&(e=C?"searching":"loaded"),{type:c,status:e,results:P}}if("notion"===c)return{type:c,status:x,results:e};(0,u().HB)(c)}),[c,o,S,P,x,C,b]);return{setCurrentSearchContext:d,searchResultMenuState:Dt({currentContexts:n,state:R})}}({availableSearchContexts:v,currentContexts:n,query:y,defaultSearchContext:d}),k=(0,i.useRef)(null),C=(0,i.useRef)(null);return(0,i.useEffect)((()=>{e.forceOpen&&d&&(f(!0),S(d),null==p||p())}),[e.forceOpen,d,S]),(0,Le.jsx)(lt().Ay,{popupType:lt().nl.Popup,open:m,onDismiss:()=>{f(!1)},placementToOrigin:ke().W.Bottom,alignmentToOrigin:ke().C.Start,originRect:null==C||null===(t=C.current)||void 0===t?void 0:t.getBoundingClientRect(),trapFocus:!1,sameWidthAsOrigin:!0,origin:(0,Le.jsx)(Ct,{disabled:s,currentContexts:n,inputRef:k,handleUpdateContexts:o,searchResultMenuIsOpen:m,setSearchResultMenuIsOpen:f,menuListStore:h,query:y,setQuery:x,searchResultMenuState:b,contextInputRef:C,heightVariant:c,actionButtons:g,showEmptyStateWarning:a}),render:()=>(0,Le.jsx)(Wt,{query:y,setQuery:x,availableSearchContexts:v,onSelectResult:e=>{o([e,...n]),f(!1),x("")},currentContexts:n,setCurrentSearchContext:e=>{var t;S(e),null===(t=k.current)||void 0===t||t.focus()},state:b,menuListStore:h})})}function Dt(e){const{currentContexts:t,state:n}=e,o=new Set,i=new Set;for(const s of t)"block"===s.type?o.add(s.blockStore.id):"slack"===s.type?i.add(s.channel.id):"currentPage"===s.type?o.add(s.blockStore.id):(0,u().HB)(s);if("choose"===n.type)return n;if("notion"===n.type){const e=(0,_().hS)(n.results.filter((e=>!o.has(e.blockStore.id))),(e=>e.blockStore.id));return{...n,results:e}}if("slack"===n.type){const e=n.results.filter((e=>!i.has(e.channel.id))).sort(((e,t)=>e.channel.name.localeCompare(t.channel.name)));return{...n,results:e}}(0,u().HB)(n)}function Wt(e){const{onSelectResult:t,availableSearchContexts:n,state:o,setCurrentSearchContext:s,menuListStore:a,query:r,setQuery:l}=e,d=(0,P().tz)(),p=(0,c().IS)((e=>({backText:{color:e.text.tertiary,fontSize:12},backContentWrap:{display:"flex",alignItems:"center",cursor:"pointer",marginTop:4,marginLeft:8}})),[]),g=(0,i.useMemo)((()=>(0,nt().Ay)(r,n,(e=>"notion"===e?d.formatMessage(_t.notionContextLabel):"slack"===e?d.formatMessage(_t.slackContextLabel):void(0,u().HB)(e)))),[n,r,d]),m=(0,i.useMemo)((()=>{const e={key:"no-results",render:()=>(0,Le.jsx)(rt().A,{title:(0,Le.jsx)(P().sA,{defaultMessage:"No results found",id:"contextTokenInput.searchResultMenu.noResults.message"})}),action:()=>{}};if("choose"===o.type)return 0===g.length?[e]:g.map((e=>({key:e,render:t=>(0,Le.jsx)(Ft,{...t,searchContext:e}),action:()=>{s(e),l("")}})));const n=[];return"default"===o.status||"loaded"===o.status||"searching"===o.status?0===o.results.length?"searching"===o.status?(n.push({key:"loading",render:()=>(0,Le.jsx)(rt().A,{title:(0,Le.jsx)(P().sA,{defaultMessage:"Loading…",id:"contextTokenInput.searchResultMenu.loading.message"})}),action:()=>{}}),n):(n.push(e),n):n.concat(o.results.map((e=>"block"===e.type?{key:e.blockStore.id,render:t=>(0,Le.jsx)(ct().A,{...t,store:e.blockStore}),action:()=>{t(e)}}:"slack"===e.type?{key:e.channel.id,render:t=>(0,Le.jsx)(Ze().qj,{...t,channel:e.channel}),action:()=>{t(e)}}:"currentPage"===e.type?{key:`${e.blockStore.id}-currentPage`,render:t=>(0,Le.jsx)(ct().A,{...t,store:e.blockStore,right:(0,Le.jsx)(at().A,{content:(0,Le.jsx)(P().sA,{id:"ContextTokenInput.currentPage",defaultMessage:"Current page"})})}),action:()=>{t(e)}}:void(0,u().HB)(e)))):(0,u().HB)(o.status)}),[o,g,s,t,l]);return(0,Le.jsx)(we().A,{menuType:xe().gu.Popup,maxHeight:200,header:"choose"!==o.type&&n.length>1&&(0,Le.jsx)("div",{style:p.backContentWrap,children:(0,Le.jsx)(z().A,{ariaLabel:d.formatMessage({id:"ContextTokenInput.backButton",defaultMessage:"Back"}),icon:et().v,onClick:()=>{s(void 0)},caption:(0,Le.jsx)("div",{style:p.backText,children:(0,Le.jsx)(P().sA,{id:"ContextTokenInput.backButton",defaultMessage:"Back"})}),captionStyle:{textTransform:void 0,letterSpacing:void 0}})}),children:(0,Le.jsx)(Ae().Ay,{type:Ae().Oh.Vertical,initialFocus:0,store:a,sections:[{key:"search-results",render:e=>(0,Le.jsx)(Pe().A,{...e}),items:m}]})})}function Ut(e){return"slack"===e}const Ft=i.forwardRef(((e,t)=>{const{searchContext:o,...i}=e,s=(0,P().tz)();let a,r;return"notion"===o?a=(0,Le.jsx)(je().I,{icon:n(558687).notionIcon,size:"default"}):"slack"===o?a=(0,Le.jsx)(je().I,{icon:n(888382).slackIcon,size:"default"}):(0,u().HB)(o),"notion"===o?r=s.formatMessage(_t.notionContextLabel):"slack"===o?r=s.formatMessage(_t.slackContextLabel):(0,u().HB)(o),(0,Le.jsx)(Ce().A,{ref:t,...i,icon:a,title:r})}));Ft.displayName="SearchContextMenuItem";var Ot=()=>n(792485),Nt=()=>n(68465),Gt=()=>n(227440);const zt=(0,P().YK)({disabledAiCredits:{id:"AiBlockV2.disabled.aiCredits",defaultMessage:"AI is currently disabled"},currentlyGenerating:{defaultMessage:"Generation in progress",id:"AiBlockV2.currentlyGenerating"},cannotEditBlock:{defaultMessage:"This block cannot be edited",id:"AiBlockV2.cannotEditBlock"},insufficientPermissions:{defaultMessage:"You do not have permission to generate this block",id:"AiBlockV2.insufficientPermissions"},noInstructions:{defaultMessage:"No instructions provided",id:"AiBlockV2.noInstructions"},offline:{defaultMessage:"Unavailable while offline",id:"AiBlockV2.offline"}});function qt(e){const{store:t,isGenerating:n,permissionLevelCalculator:o}=e,i=(0,Ot().S)(),s=(0,P().tz)(),{blockConfiguration:a}=Ht(t),r=!(0,l().O$)(Gt().e);return(0,l().K8)((()=>{const e=i&&i.publicEditModeStore.state;return(0,Nt().ZE)(e)?n?{isDisabled:!0,disabledMessage:s.formatMessage(zt.currentlyGenerating)}:r?{isDisabled:!0,disabledMessage:s.formatMessage(zt.offline)}:!t.canEdit()||t.isNonEditableState()?{isDisabled:!0,disabledMessage:s.formatMessage(zt.cannotEditBlock)}:o.canGenerateBlock()?"summarizeThisPage"===a.type||"extractKeyPointsFromThisPage"===a.type||a.autofillInstructions?{isDisabled:!1}:{isDisabled:!0,disabledMessage:s.formatMessage(zt.noInstructions)}:{isDisabled:!0,disabledMessage:s.formatMessage(zt.insufficientPermissions)}:{isDisabled:!0,disabledMessage:s.formatMessage(zt.disabledAiCredits)}}),[i,n,t,o,a,s,r])}function Ht(e){const t=(0,r().v3)();return{blockConfiguration:(0,l().K8)((()=>Kt({model:e.getModel()})),[e]),updateBlockConfiguration:(0,i.useCallback)((n=>{N().createAndCommit({userAction:"AiBlock.updateBlockConfiguration",environment:t,canUndo:!0,perform:t=>{N().applyOperation({store:e,operation:w().op.update({pointer:e.pointer,path:["format"],args:{ai_block_configuration_menu:n}}),transaction:t})}})}),[t,e])}}function Kt(e){var t;const{model:n}=e;if(!n)return h().Z0;const o=null===(t=X().default.state.currentSpaceStore)||void 0===t?void 0:t.getRecordModel;if(!o)return h().Z0;if(null==n||!n.getFormatValue("ai_block_configuration_menu")){const e=(0,h().Hx)({model:n,getRecordModel:o});if(e)return e}return(0,h().Lv)({model:n})}function Vt(e){const t=(0,i.useRef)(void 0),{blockConfiguration:n,updateBlockConfiguration:o}=Ht(e);return{updateBlockSkillType:(0,i.useCallback)((e=>{var i;if(e===n.type)return;if(e===(null===(i=t.current)||void 0===i?void 0:i.type))return o(t.current),void(t.current=n);let s;switch(e){case"custom":s={type:"custom",version:3,autofillInstructions:n.autofillInstructions,context:n.context,searchScopes:n.searchScopes};break;case"extractKeyPointsFromThisPage":s={...n,type:"extractKeyPointsFromThisPage",version:3};break;case"summarizeThisPage":s={...n,type:"summarizeThisPage",version:3};break;default:(0,u().HB)(e)}t.current=n,o(s)}),[n,o]),currentSkillType:n.type}}function $t(e){const{store:t,isGenerating:n,permissionLevelCalculator:o}=e,s=qt({store:t,isGenerating:n,permissionLevelCalculator:o}),a=(0,c().IS)((()=>({generatingText:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:8,fontSize:14,fontWeight:400}})),[]),r=Qt(t),l=(0,i.useMemo)((()=>n?(0,Le.jsx)(P().sA,{id:"aiBlock.generate.loading.label",defaultMessage:"Generating…"}):null!=r&&r.lastAiEditGenerationTime?(0,Le.jsx)(P().sA,{id:"aiBlock.configurableTitle.regenerate",defaultMessage:"Regenerate"}):(0,Le.jsx)(P().sA,{id:"aiBlock.configurableTitle.editlabel",defaultMessage:"Generate"})),[n,r]);return(0,Le.jsx)(H().A,{renderTooltip:()=>(0,Le.jsx)(Yt,{store:t,disabledResult:s,lastGeneratedProps:r}),disableTooltip:!s.isDisabled&&!r,render:e=>(0,Le.jsx)("div",{style:a.generatingText,...e,children:l})})}function Qt(e){const t=(0,P().tz)(),n=(0,l().K8)((()=>{const n=e.getFormat().ai_last_edited;return n?t.formatDate(n,{day:"numeric",month:"long",year:"numeric"}):void 0}),[t,e]);return(0,l().K8)((()=>{var o;const i=e.getLastEditedTime();if(!i)return;const s=t.formatDate(i,{day:"numeric",month:"long",year:"numeric"});if(s===n)return{lastAiEditGenerationTime:n,lastEditedByName:void 0,lastHumanEditedTime:void 0};return{lastEditedByName:(null===(o=e.getLastEditedByStore())||void 0===o?void 0:o.getDisplayName(t,!1))??void 0,lastHumanEditedTime:s,lastAiEditGenerationTime:n}}),[t,n,e])}function Yt(e){const{disabledResult:t,lastGeneratedProps:n}=e,o=(0,c().IS)((e=>({darkTextColor:{color:"#787774"}})),[]);return t.isDisabled?(0,Le.jsx)("div",{children:t.disabledMessage}):n?(0,Le.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:4},children:[n.lastEditedByName&&n.lastHumanEditedTime?(0,Le.jsx)("div",{style:o.darkTextColor,children:(0,Le.jsx)(P().sA,{defaultMessage:"Edited by <whiteName>{personName}</whiteName> {timestamp}",id:"AiBlockV2.lastGeneratedByHuman",values:{personName:n.lastEditedByName,whiteName:e=>(0,Le.jsx)("span",{style:{color:"white"},children:e}),timestamp:n.lastHumanEditedTime}})}):void 0,(0,Le.jsx)("div",{style:o.darkTextColor,children:(0,Le.jsx)(P().sA,{defaultMessage:"Generated by <white>AI</white> {timestamp}",id:"AIBlockV2.LastGeneratedAt",values:{timestamp:n.lastAiEditGenerationTime,white:e=>(0,Le.jsx)("span",{style:{color:"white"},children:e})}})})]}):null}const Xt=(0,P().YK)({custom:{id:"AiBlockV2.skillSelector.custom",defaultMessage:"Custom"},summarize:{id:"AiBlockV2.skillSelector.summarize",defaultMessage:"Summarize"},extractKeyPoints:{id:"AiBlockV2.skillSelector.extractKeyPoints",defaultMessage:"Extract key points"}});function Zt(e){const{store:t,handleGenerateClick:n,isGenerating:o,permissionLevelCalculator:i,updateBlockConfiguration:s}=e,a=(0,c().IS)((()=>({popup:{marginTop:4,width:300,padding:12,paddingTop:4,display:"flex",flexDirection:"column",gap:10}})),[]),r=qt({store:t,isGenerating:o,permissionLevelCalculator:i});return(0,Le.jsxs)("div",{style:a.popup,children:[(0,Le.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Le.jsx)("div",{style:{fontSize:14,fontWeight:500,marginLeft:4},children:(0,Le.jsx)(P().sA,{id:"aiBlock.configuration.blockSettingsTitle",defaultMessage:"AI block"})}),(0,Le.jsx)(an,{store:t,permissionCalculator:i})]}),(0,Le.jsx)(Ee,{style:{marginLeft:4,marginRight:4},store:t}),(0,Le.jsx)(en,{store:t,permissionLevelCalculator:i,updateBlockConfiguration:s}),(0,Le.jsx)(Jt,{store:t}),r.isDisabled?(0,Le.jsx)(Ye().E,{style:{cursor:"not-allowed"},onClick:n,isLoading:o,disabled:!0,children:(0,Le.jsx)($t,{isGenerating:o,store:t,permissionLevelCalculator:i})}):(0,Le.jsx)(Te().A,{onClick:n,isLoading:o,children:(0,Le.jsx)($t,{isGenerating:o,store:t,permissionLevelCalculator:i})})]})}function Jt(e){const t=(0,c().IS)((e=>({divider:{borderTop:`1px solid ${e.lightDividerColor}`,marginLeft:-12,marginRight:-12}})),[]),n=(0,l().K8)((()=>Kt({model:e.store.getModel()})),[e.store]);return n&&"custom"===n.type?(0,Le.jsx)("div",{style:t.divider}):null}function en(e){const{store:t,permissionLevelCalculator:n,updateBlockConfiguration:o}=e,i=(0,l().K8)((()=>Kt({model:t.getModel()})),[t]);if(!i)return null;switch(i.type){case"custom":return(0,Le.jsx)(nn,{blockConfiguration:i,permissionLevelCalculator:n,updateBlockConfiguration:e=>{o({...i,...e})}});case"extractKeyPointsFromThisPage":case"summarizeThisPage":return(0,Le.jsx)(tn,{});default:(0,u().HB)(i)}}function tn(){const e=(0,c().IS)((e=>({textWrapper:{display:"flex",alignItems:"center",justifyContent:"space-between",marginLeft:4,marginRight:4},currentPageLabel:{color:e.text.tertiary,fontSize:14},pageLabel:{fontSize:14}})),[]);return(0,Le.jsxs)("div",{style:e.textWrapper,children:[(0,Le.jsx)("div",{style:e.pageLabel,children:(0,Le.jsx)(P().sA,{defaultMessage:"Page",id:"AiBlockV2.extractKeyPointsFromThisPage.contextLabel"})}),(0,Le.jsx)("div",{style:e.currentPageLabel,children:(0,Le.jsx)(P().sA,{defaultMessage:"Current page",id:"AiBlockV2.extractKeyPointsFromThisPage.currentPageLabel"})})]})}function nn(e){const{blockConfiguration:t,updateBlockConfiguration:n,permissionLevelCalculator:o}=e,s=(0,i.useCallback)((e=>{"custom"===t.type&&n({autofillInstructions:e})}),[t,n]),{store:a}=(0,ye().AI)({initialValue:"custom"===t.type?t.autofillInstructions:void 0,onChange:s}),r=(0,P().tz)(),l=t.context,d=(0,i.useCallback)((e=>{n({context:e})}),[n]),{isSlackConnected:u}=Se(),p=(0,i.useCallback)((()=>{if(t.searchScopes.some((e=>"notion"===e.type)))n({searchScopes:[]});else{const e=[{type:"notion"}];u&&e.push({type:"slack"}),n({searchScopes:e})}}),[t,n,u]),g=(0,c().IS)((e=>({textStyle:{display:"flex",alignItems:"center",fontSize:12,paddingLeft:0,paddingRight:0,paddingTop:4,paddingBottom:4,cursor:"pointer",userSelect:"none",fontWeight:400,border:"none"},selectedSourceText:{color:e.text.secondary,marginTop:2},sourcesLabel:{marginTop:4,marginBottom:-2,color:e.text.secondary,fontSize:12,fontWeight:500}})),[]);return(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(sn,{store:a,placeholder:r.formatMessage({id:"AiBlockV2.AutofillInstructions.Placeholder",defaultMessage:"Describe the content that should be generated. Use '@' to mention people, pages, or dates"}),minTextHeight:115,showAtMentionMenu:!0,fontSize:14,fontWeight:400,disabled:!o.canEditConfigurationPanel(),context:l,updateContexts:d}),(0,Le.jsx)("div",{style:g.sourcesLabel,children:(0,Le.jsx)(P().sA,{defaultMessage:"Sources",id:"AiBlockV2ConfigurationMenu.sourcesLabel"})}),(0,Le.jsx)(on,{contexts:l,updateContexts:d,disabled:!o.canEditConfigurationPanel()}),(0,Le.jsxs)($e().Y1,{direction:"vertical",gap:0,children:[(0,Le.jsx)(Xe().a,{selectorSize:"small",style:g.textStyle,label:(0,Le.jsx)("div",{style:g.selectedSourceText,children:(0,Le.jsx)(P().sA,{defaultMessage:"Use selected sources only",id:"AiBlockV2ConfigurationMenu.selectedSourcesOnly"})}),onChange:()=>{},isSelected:0===t.searchScopes.length,onClick:p,value:"selected_sources",selectType:"radio"}),(0,Le.jsx)(Xe().a,{style:g.textStyle,selectAlignYAxis:"top",label:(0,Le.jsx)("div",{style:g.selectedSourceText,children:(0,Le.jsx)(P().sA,{defaultMessage:"Use selected sources and search workspace to find related information",id:"AiBlockV2ConfigurationMenu.useAllSources"})}),onChange:()=>{},selectType:"radio",isSelected:t.searchScopes.some((e=>"notion"===e.type)),onClick:p,value:"all_sources",selectorSize:"small"})]})]})}function on(e){const{contexts:t,updateContexts:n,disabled:o}=e,s=(0,l().O$)(X().AppStoreCurrentSpaceStore),a=(0,r().v3)(),d=(0,l().K8)((()=>(0,u().O9)(t)&&s?t.map((e=>"page"===e.type||"collection"===e.type?{type:"block",blockStore:new(J().Bv)(a,{table:g().ev,id:e.pageId,spaceId:s.id})}:"currentPage"===e.type?{type:"currentPage",blockStore:new(J().Bv)(a,{table:g().ev,id:e.pageId,spaceId:s.id})}:"slack"===e.type?e:void(0,u().HB)(e))):[]),[t,s,a]),p=(0,i.useCallback)((e=>{if(o)return;const t=e.map((e=>{if("block"===e.type){var t;const n=null===(t=e.blockStore.getCollectionPointer())||void 0===t?void 0:t.id;return n?{pageId:e.blockStore.id,collectionId:n,type:"collection"}:{pageId:e.blockStore.id,type:"page"}}return"slack"===e.type?e:"currentPage"===e.type?{type:"currentPage",pageId:e.blockStore.id}:void(0,u().HB)(e)}));return n(t)}),[n,o]),m=(0,c().IS)((e=>({titleStyle:{fontSize:14,fontWeight:500,color:e.text.tertiary,display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"}})),[]);return s?(0,Le.jsx)("div",{style:m.titleStyle,children:(0,Le.jsx)(Ie().A,{debugName:"PromptOrActionInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:(0,Le.jsx)(Et,{currentContexts:d,handleUpdateContexts:p,disabled:o,heightVariant:"regular"})})}):null}function sn(e){const{store:t,minTextHeight:n=50,placeholder:o,showAtMentionMenu:a,fontSize:l=14,fontWeight:d=500,disabled:u,context:p,updateContexts:g}=e,m=(0,c().IS)((e=>({inputWrap:{display:"flex",flexDirection:"column",justifyContent:"space-between",boxShadow:e.inputBoxShadow,minHeight:n,backgroundColor:"dark"===e.mode?e.palette.translucentGray[100]:"transparent",borderRadius:6,overflow:"inherit",flexGrow:1,flexShrink:1,paddingLeft:6,paddingRight:6,paddingBottom:6},textContainer:{fontSize:l,fontWeight:d,flexGrow:1,padding:"4px 0",maxHeight:240,overflow:"auto"},placeholder:{color:e.text.quaternary}})),[l,d,n]),f=(0,r().v3)();(0,i.useEffect)((()=>{const e=s().e.withListenerIgnored((()=>{var e;return null===(e=X().default.state.currentSpaceStore)||void 0===e?void 0:e.id}));e&&(0,Ze().Hn)({environment:f,spaceId:e,externalAuthConfig:{type:"universal",app:"slack",spaceId:e}})}),[f]);const h=(0,i.useCallback)((async()=>{const e=Ve().default.state;"editing"===e.mode&&(0,Ke().KP)(e.multiSelection)&&e.multiSelection.start.store===t||(Ne().setSelectionAtEnd({store:t}),await De().default.afterNextFlush())}),[t]),v=(0,i.useCallback)((e=>{u||(e.preventDefault(),e.stopPropagation(),async function(){await h(),await De().default.afterNextFlush(),Oe().Gf({environment:f,mentionTypes:Ge().Ap,usePopupOnMobile:!0,mentionSectionOrdering:Ge().h2})}())}),[u,f,h]),y=(0,i.useMemo)((()=>{const e=new Set;return null==p||p.forEach((t=>{"page"!==t.type&&"currentPage"!==t.type||e.add(t.pageId)})),e}),[p]),x=(0,i.useCallback)((()=>{const e=s().e.withListenerIgnored((()=>t.getValue()));if(e){const t=(0,Fe().moK)(e).filter((e=>!y.has(e.id))).map((e=>({type:"page",pageId:e.id})));g([...p??[],...t])}}),[p,y,t,g]),b=(0,We().Y)(x,200);return(0,i.useEffect)((()=>{!async function(){await De().default.afterNextFlush(),await De().default.afterNextFlush(),Ne().setSelectionAtEnd({store:t})}()}),[t]),(0,Le.jsxs)("div",{style:m.inputWrap,className:qe().CCX,children:[(0,Le.jsx)(Je().A,{onChange:b,placeholder:o,placeholderStyle:m.placeholder,style:m.textContainer,disabled:u,store:t,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!1,disableSelectionDrag:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:He().Os.none}),a?(0,Le.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end"},children:(0,Le.jsx)(ze().q,{onClick:v})}):void 0]})}function an(e){const{store:t,permissionCalculator:n}=e,o=(0,c().IS)((e=>({dropdownLabel:{fontSize:14,fontWeight:400,display:"flex",alignItems:"center",gap:2,marginRight:-4},secondaryTextColor:{color:e.text.tertiary}})),[]),s=[{key:"custom",label:(0,Le.jsx)(P().sA,{...Xt.custom}),icon:ge().L},{key:"summarizeThisPage",label:(0,Le.jsx)(P().sA,{...Xt.summarize}),icon:me().P},{key:"extractKeyPointsFromThisPage",label:(0,Le.jsx)(P().sA,{...Xt.extractKeyPoints}),icon:Ue().a}],{currentSkillType:a,updateBlockSkillType:r}=Vt(t),d=s.find((e=>e.key===a))??null,u=(0,i.useCallback)(((e,t)=>{r(e),t()}),[r]),p=(0,l().K8)((()=>!n.canEditConfigurationPanel()),[n]);return(0,Le.jsx)(se().Ay,{isWaxPaper:!0,popupType:se().z7.Popup,disabled:p,placementToOrigin:se().sx.Top,trapFocus:!1,renderOrigin:e=>(0,Le.jsxs)(Qe().p,{...e,style:o.dropdownLabel,hoveredStyle:{background:"rgba(0, 0, 0, 0)"},children:[null!=d&&d.icon?(0,Le.jsx)(je().I,{icon:d.icon,size:"sm",color:"secondary"}):void 0,(0,Le.jsx)("div",{style:o.secondaryTextColor,children:null==d?void 0:d.label}),(0,Le.jsx)(je().I,{icon:re().arrowChevronSingleDownSmallIcon,size:"sm",color:"secondary"})]}),render:e=>{const t={menuType:xe().gu.Popup,width:220},n=[{key:"skillSelectorSection",render:e=>(0,Le.jsx)(Pe().A,{...e}),items:s.map((t=>({key:t.key,action:()=>u(t.key,e.close),render:e=>(0,Le.jsx)(Ce().A,{...e,title:t.label,shouldWrapCaption:!0,icon:(0,Le.jsx)(je().I,{icon:t.icon,color:"primary"}),isChecked:t.key===a})})))}];return(0,Le.jsx)(we().A,{...t,children:(0,Le.jsx)(Ae().Ay,{initialFocus:void 0,type:Ae().Oh.Vertical,sections:n,style:{position:"relative"}})})}})}const rn=(0,P().YK)({custom:{id:"AiBlockV2.inlineConfig.skillSelector.custom",defaultMessage:"Custom output"},summarize:{id:"AiBlockV2.inlineConfig.skillSelector.summarize",defaultMessage:"Summarize"},extractKeyPoints:{id:"AiBlockV2.inlineConfig.skillSelector.extractKeyPoints",defaultMessage:"Extract key points"},selectOutputType:{id:"AiBlockV2.inlineConfig.skillSelector.selectOutputType",defaultMessage:"Select output type"},summarizePlaceholder:{id:"AiBlockV2.inlineConfig.skillSelector.summarizePlaceholder",defaultMessage:"Create a summary about this page"},extractKeyPointsPlaceholder:{id:"AiBlockV2.inlineConfig.skillSelector.extractKeyPointsPlaceholder",defaultMessage:"Find key points on this page"},customAutofillInstructionsPlaceholder:{id:"AiBlockV2.inlineConfig.customAutofillInstructionsPlaceholder",defaultMessage:"Describe the content that should be generated. Use ‘@’ to mention people, pages, or dates"},currentPageOnlyPrefix:{id:"AiBlockV2.inlineConfig.contextType.currentPageOnlyPrefix",defaultMessage:"Current page only —"},currentPageOnlyPrefixNoEmdash:{id:"AiBlockV2.inlineConfig.contextType.currentPageOnlyPrefixNoEmdash",defaultMessage:"Current page —"},notion:{id:"AiBlockConfigView.source.notion",defaultMessage:"Notion"},slack:{id:"AiBlockConfigView.source.slack",defaultMessage:"Slack"},web:{id:"AiBlockConfigView.source.web",defaultMessage:"Web search"},noSources:{id:"AiBlockConfigView.source.noSources",defaultMessage:"Don’t search any sources"}});function ln(e){const{store:t,disabled:n,setSelectedContextType:o,inferredCustomContextType:s}=e,a=(0,c().IS)((e=>({dropdown:{display:"flex",alignItems:"center",padding:"8px 12px",border:`1px solid ${e.stroke.secondary}`,borderRadius:6,marginBottom:4,gap:4,cursor:"pointer",fontSize:14,minHeight:36,justifyContent:"space-between",...n?{backgroundColor:e.inputBackground,cursor:"not-allowed"}:{}},dropdownText:{color:e.text.primary,display:"flex",alignItems:"center",gap:8},optionIcon:{marginRight:8,fill:e.icon.tertiary,width:16,height:16}})),[n]),r=[{key:"custom",label:(0,Le.jsx)(P().sA,{...rn.custom}),icon:()=>(0,ge().L)({...a.optionIcon,fill:void 0})},{key:"summarizeThisPage",label:(0,Le.jsx)(P().sA,{...rn.summarize}),icon:()=>(0,me().P)({...a.optionIcon,fill:void 0})},{key:"extractKeyPointsFromThisPage",label:(0,Le.jsx)(P().sA,{...rn.extractKeyPoints}),icon:()=>(0,de().q)({...a.optionIcon,fill:void 0})}],{currentSkillType:l,updateBlockSkillType:d}=Vt(t),u=r.find((e=>e.key===l)),p=(0,i.useCallback)(((e,t)=>{d(e),o("custom"!==e?"current_page":s),t()}),[d,o,s]);return(0,Le.jsx)(se().Ay,{popupType:se().z7.Popup,placementToOrigin:se().sx.Bottom,trapFocus:!1,sameWidthAsOrigin:!0,renderOrigin:e=>(0,Le.jsxs)("div",{...(0,Q().A)(e,{onClick:e=>e.stopPropagation()}),style:a.dropdown,children:[(0,Le.jsxs)("span",{style:a.dropdownText,children:[null==u?void 0:u.icon(),(null==u?void 0:u.label)||(0,Le.jsx)(P().sA,{...rn.selectOutputType})]}),(0,Le.jsx)(je().I,{icon:re().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]}),render:e=>{const t={menuType:xe().gu.Popup},n=[{key:"skillOptions",render:e=>(0,Le.jsx)(Pe().A,{...e}),items:r.map((t=>({key:t.key,action:()=>{p(t.key,e.close)},render:e=>(0,Le.jsx)(Ce().A,{...e,title:t.label,left:t.icon(),isChecked:t.key===l})})))}];return(0,Le.jsx)(we().A,{...t,children:(0,Le.jsx)(Ae().Ay,{initialFocus:void 0,type:Ae().Oh.Vertical,sections:n,style:{position:"relative"}})})}})}function cn(e){const{handleSaveButton:t,saveButtonDisabledMessage:n}=e,o=(0,c().IS)((e=>({buttonContainer:{zIndex:100,display:"flex",gap:8,alignItems:"center"}})),[]),i=void 0!==n;return(0,Le.jsx)("div",{style:o.buttonContainer,children:(0,Le.jsx)(H().A,{disableTooltip:!i,renderTooltip:()=>(0,Le.jsx)("div",{children:n}),placement:ke().W.Bottom,render:e=>(0,Le.jsx)(Te().A,{...e,onClick:t,size:"md",disabled:i,children:(0,Le.jsx)(P().sA,{id:"AiBlockV2.inlineConfig.done",defaultMessage:"Done"})})})})}function dn(e){let{store:t}=e;const n=(0,l().K8)((()=>t.getIcon()),[t]),o=(0,l().K8)((()=>t.isEmptyPage()),[t]),i=(0,l().K8)((()=>(0,Me().Te)(t)),[t]),s=(0,c().IS)((e=>({pageTitlePreview:{color:e.text.lightGraySecondary}})),[]);return(0,Le.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,Le.jsx)(Me().B6,{disabled:!0,icon:n,iconRecordCategory:i,isEmptyPage:o,size:16}),(0,Le.jsx)(Be().A,{style:s.pageTitlePreview,store:t})]})}function un(e){const{blockConfiguration:t,updateBlockConfiguration:n,editDisabledLackOfPermissions:o,selectedContext:s,updateSelectedContext:a}=e,r=(0,P().tz)(),l=(0,i.useMemo)((()=>"custom"!==t.type),[t.type]),d=(0,c().IS)((e=>({textInputContainer:{border:`1px solid ${e.stroke.secondary}`,borderRadius:6,padding:"12px",minHeight:150,height:150,position:"relative",...l&&{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:e.inputBackground,color:e.text.lightGraySecondary,pointerEvents:"none"}},textInput:{fontSize:14,fontWeight:400,padding:"4px 0",overflow:"auto"}})),[l]),p=(0,i.useCallback)((e=>{"custom"===t.type&&n({...t,autofillInstructions:e})}),[t,n]),{store:g}=(0,ye().AI)({initialValue:"custom"===t.type?t.autofillInstructions:void 0,onChange:p}),m=r.formatMessage(function(e){switch(e){case"summarizeThisPage":return rn.summarizePlaceholder;case"extractKeyPointsFromThisPage":return rn.extractKeyPointsPlaceholder;case"custom":return rn.customAutofillInstructionsPlaceholder;default:(0,u().HB)(e)}}(t.type)),f=t.type;switch(f){case"summarizeThisPage":case"extractKeyPointsFromThisPage":return(0,Le.jsx)("div",{style:d.textInputContainer,children:(0,Le.jsx)("div",{style:d.textInput,children:m})});case"custom":return(0,Le.jsx)(sn,{store:g,placeholder:m,minTextHeight:150,fontSize:14,fontWeight:400,disabled:o,context:s,updateContexts:a,showAtMentionMenu:!0});default:(0,u().HB)(f)}}function pn(e){const{blockConfiguration:t,updateBlockConfiguration:n,editDisabledLackOfPermissions:o,setSelectedContextType:s,selectedContextType:a,currentPageScope:r}=e,d=(0,P().tz)(),{isSlackConnected:p}=Se(),g="custom"===t.type,m=o||!g,f=(0,c().IS)((e=>({dropdown:{display:"flex",alignItems:"center",border:`1px solid ${e.stroke.secondary}`,borderRadius:6,padding:"8px 12px",gap:4,cursor:"pointer",fontSize:14,minHeight:36,justifyContent:"space-between",...m&&{backgroundColor:e.inputBackground,color:e.text.lightGraySecondary,cursor:"not-allowed"}},dropdownText:{color:e.text.primary,display:"flex",alignItems:"center",gap:8},optionIcon:{marginRight:8,fill:e.icon.tertiary,width:16,height:16},currentPageInfoWrapper:{...E().RC}})),[m]),h=K().A.isMobile,v=(0,l().K8)((()=>{const e=(0,ve().ao)();return[{key:"current_page",label:e?(0,Le.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,Le.jsx)("span",{children:d.formatMessage(h?rn.currentPageOnlyPrefixNoEmdash:rn.currentPageOnlyPrefix)}),(0,Le.jsx)("div",{style:f.currentPageInfoWrapper,children:(0,Le.jsx)(dn,{store:e})})]}):d.formatMessage({id:"aiBlock.contextType.currentPage",defaultMessage:"Current page only"}),icon:()=>(0,pe().pageIcon)({...f.optionIcon,fill:void 0})},{key:"specified_context",label:d.formatMessage({id:"aiBlock.contextType.specifiedContext",defaultMessage:"Specified context"}),icon:()=>(0,ce().checkmarkCircleIcon)({...f.optionIcon,fill:void 0})}]}),[d,h,f]),y=v.find((e=>e.key===a))??v[0],x=(0,i.useCallback)((e=>{if(s(e),!g)return;let o,i;switch(e){case"current_page":o=r,i=[];break;case"specified_context":o=t.context&&t.context.length>0?t.context:void 0;const n=t.searchScopes??[];i=n.length>0?n:[{type:"notion"},...p?[{type:"slack"}]:[]];break;default:(0,u().HB)(e)}n({...t,type:"custom",context:o,searchScopes:i})}),[t,n,r,g,s,p]),b=t.type;switch(b){case"summarizeThisPage":case"extractKeyPointsFromThisPage":return(0,Le.jsxs)("div",{style:f.dropdown,children:[(0,Le.jsxs)("span",{style:f.dropdownText,children:[y.icon(),y.label]}),(0,Le.jsx)(je().I,{icon:re().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]});case"custom":return(0,Le.jsx)(se().Ay,{popupType:se().z7.Popup,placementToOrigin:se().sx.Bottom,trapFocus:!1,sameWidthAsOrigin:!0,renderOrigin:e=>(0,Le.jsxs)("div",{...(0,Q().A)(e,{onClick:e=>e.stopPropagation()}),style:f.dropdown,children:[(0,Le.jsxs)("span",{style:f.dropdownText,children:[y.icon(),y.label]}),(0,Le.jsx)(je().I,{icon:re().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]}),render:e=>{const t={menuType:xe().gu.Popup},n=[{key:"contextOptions",render:e=>(0,Le.jsx)(Pe().A,{...e}),items:v.map((t=>({key:t.key,action:()=>{x(t.key),e.close()},render:e=>(0,Le.jsx)(Ce().A,{...e,title:t.label,left:t.icon(),isChecked:t.key===a})})))}];return(0,Le.jsx)(we().A,{...t,children:(0,Le.jsx)(Ae().Ay,{initialFocus:void 0,type:Ae().Oh.Vertical,sections:n,style:{position:"relative"}})})}});default:(0,u().HB)(b)}}function gn(e){const{selectedContext:t,store:n,updateSelectedContext:o,editDisabledLackOfPermissions:s}=e,a=(0,r().v3)(),[d,p]=(0,i.useState)(void 0),m=(0,c().IS)((e=>({contextSection:{marginTop:7},contextInputWrapper:{position:"relative",display:"flex",alignItems:"center"},symbolButton:{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,cursor:"pointer",backgroundColor:"transparent",border:"none",padding:0},symbolIcon:{width:18,height:18,fill:e.icon.tertiary}})),[]),[f,h]=(0,i.useState)(!1),v=(0,i.useCallback)((e=>{p(e),h(!0)}),[]),y=(0,l().K8)((()=>(0,he().wd)().includes("slack")),[]),x=(0,P().tz)();return(0,Le.jsx)("div",{style:m.contextSection,children:(0,Le.jsx)(Ie().A,{debugName:"AiBlockConfigViewContextInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:(0,Le.jsx)("div",{style:m.contextInputWrapper,children:(0,Le.jsx)(Et,{heightVariant:"spacious",defaultSearchContext:d,onSearchContextSelected:()=>{p(void 0),h(!1)},forceOpen:f,currentContexts:(null==t?void 0:t.map((e=>{if("page"===e.type||"collection"===e.type){const t=n.getSpaceId();return{type:"block",blockStore:new(J().Bv)(a,{table:g().ev,id:e.pageId,spaceId:t})}}if("currentPage"===e.type){const t=n.getSpaceId();return{type:"currentPage",blockStore:new(J().Bv)(a,{table:g().ev,id:e.pageId,spaceId:t})}}if("slack"===e.type)return e;(0,u().HB)(e)})))||[],handleUpdateContexts:e=>{const t=e.map((e=>{if("block"===e.type){var t;const n=null===(t=e.blockStore.getCollectionPointer())||void 0===t?void 0:t.id;return n?{pageId:e.blockStore.id,collectionId:n,type:"collection"}:{pageId:e.blockStore.id,type:"page"}}return"slack"===e.type?e:"currentPage"===e.type?{type:"currentPage",pageId:e.blockStore.id}:void(0,u().HB)(e)}));o(t)},disabled:s,showEmptyStateWarning:void 0===t||0===t.length,actionButtons:s?void 0:(0,Le.jsxs)(Le.Fragment,{children:[y&&(0,Le.jsx)(z().A,{ariaLabel:x.formatMessage(rn.slack),icon:ue().L,style:m.symbolButton,iconStyle:m.symbolIcon,onClick:e=>{e.stopPropagation(),v("slack")}}),(0,Le.jsx)(z().A,{ariaLabel:x.formatMessage(rn.notion),icon:le().b,style:m.symbolButton,iconStyle:m.symbolIcon,onClick:e=>{e.stopPropagation(),v("notion")}})]})})})})})}function mn(e){const{buttonPopupParent:t,value:n,onChange:o,validScopeOverrides:s,editDisabledLackOfPermissions:a}=e,r=(0,c().IS)((e=>({clearAllButton:{padding:"8px 12px",cursor:"pointer",fontSize:14,color:e.text.primary,borderBottom:`1px solid ${e.stroke.secondary}`},disabledButton:{color:e.text.lightGraySecondary,cursor:"not-allowed"}})),[]),l=(0,i.useCallback)((()=>{a||(o([]),t.close())}),[o,t,a]);return(0,Le.jsxs)("div",{children:[(0,Le.jsx)("div",{style:{...r.clearAllButton,...a?r.disabledButton:{}},onClick:l,role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l())},children:(0,Le.jsx)(P().sA,{id:"AiBlockConfigView.dontSearchAnySources",defaultMessage:"Don’t search any sources"})}),(0,Le.jsx)(fe().v,{buttonPopupParent:t,value:n,onChange:o,validScopeOverrides:s,hideConnectorFooter:!0,originSource:"ai_block"})]})}function fn(e){const{searchScopes:t,setSearchScopes:n,editDisabledLackOfPermissions:o}=e,s=(0,c().IS)((e=>({section:{marginTop:8},sectionTitle:{fontSize:14,fontWeight:600,color:e.text.primary,marginBottom:8},searchContainer:{border:`1px solid ${e.stroke.secondary}`,borderRadius:6,cursor:"pointer"},dropdownTrigger:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",fontSize:14},dropdownText:{fontSize:14,color:e.text.primary},rightSection:{display:"flex",alignItems:"center",gap:8}})),[]),a=(0,P().tz)(),{isSlackConnected:r,isWebSearchAvailable:l}=Se(),d=(0,i.useMemo)((()=>{if(t)return null==t?void 0:t.filter((e=>"web"===e.type?l:"slack"!==e.type||r))}),[r,l,t]),u=(0,i.useMemo)((()=>{if(!d||0===d.length)return a.formatMessage(rn.noSources);const e=[],t=d.some((e=>"everything"===e.type));return(t||d.some((e=>"notion"===e.type)))&&e.push(a.formatMessage(rn.notion)),(t||d.some((e=>"slack"===e.type)))&&r&&e.push(a.formatMessage(rn.slack)),(t||d.some((e=>"web"===e.type)))&&l&&e.push(a.formatMessage(rn.web)),a.formatList(e,{type:"conjunction"})}),[d,r,l,a]),p=(0,i.useMemo)((()=>["slack"]),[]);return(0,Le.jsxs)("div",{style:s.section,children:[(0,Le.jsx)("div",{style:s.sectionTitle,children:(0,Le.jsx)(P().sA,{id:"AiBlockConfigView.search",defaultMessage:"Search"})}),(0,Le.jsx)("div",{style:s.searchContainer,children:(0,Le.jsx)(se().Ay,{popupType:se().z7.Popup,originGap:2,placementToOrigin:se().sx.Bottom,alignmentToOrigin:se().yP.Start,renderOrigin:e=>(0,Le.jsxs)("div",{style:s.dropdownTrigger,...e,children:[(0,Le.jsx)("div",{children:(0,Le.jsx)("div",{style:s.dropdownText,children:u||a.formatMessage({id:"AiBlockConfigView.dontSearchAnySources2",defaultMessage:"Don't search any sources"})})}),(0,Le.jsx)("div",{style:s.rightSection,children:(0,Le.jsx)(je().I,{icon:re().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})})]}),render:e=>(0,Le.jsx)(mn,{buttonPopupParent:e,value:d||[],onChange:n,validScopeOverrides:p,editDisabledLackOfPermissions:o})})})]})}function hn(e){const{store:t,onClose:n,permissionLevelCalculator:o}=e,s=!o.canEditConfigurationPanel(),{blockConfiguration:a,updateBlockConfiguration:r}=Ht(t),{currentSkillType:d}=Vt(t),p=(0,i.useMemo)((()=>{const e=a.context??[],t=a.searchScopes??[];return e.every((e=>"currentPage"===e.type))&&0===t.length?"current_page":"specified_context"}),[a]),g=(0,i.useMemo)((()=>"custom"!==a.type?"current_page":p),[a,p]),[m,f]=(0,i.useState)(g),h=(0,l().K8)((()=>{const e=(0,ve().ao)();return e?[{type:"currentPage",pageId:e.id}]:[]}),[]),v="custom"===a.type?a.context:void 0,y=(0,i.useCallback)((e=>{null!=e&&e.some((e=>"currentPage"!==e.type))&&f("specified_context"),"custom"===d&&r({type:"custom",version:a.version,autofillInstructions:"custom"===a.type?a.autofillInstructions:void 0,context:_().hS(e,(e=>{switch(e.type){case"currentPage":case"page":return e.pageId;case"collection":return e.collectionId;case"slack":return e.channel.id;default:return(0,u().HB)(e)}})),searchScopes:"custom"===a.type?a.searchScopes:[]})}),[d,a,r]),x=(0,i.useCallback)((e=>{r({...a,searchScopes:e})}),[a,r]),b=(0,P().tz)(),S=(0,i.useMemo)((()=>s?b.formatMessage({id:"AiBlockConfigView.saveButtonDisabled.insufficientEditPermissions",defaultMessage:"Insufficient permissions to edit"}):void 0),[s,b]),k=(0,c().IS)((e=>({container:{padding:16,position:"relative",margin:"0 auto"},content:{paddingTop:2},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},headerTitle:{fontSize:16,fontWeight:600,color:e.text.primary},section:{marginBottom:20},sectionTitle:{fontSize:14,fontWeight:600,color:e.text.primary,marginBottom:8,display:"flex",alignItems:"center"},templateDuplicationFieldToggle:{fontWeight:600,gap:10,justifyContent:void 0,marginBottom:10}})),[]);return(0,Le.jsxs)("div",{style:k.container,children:[(0,Le.jsxs)("div",{style:k.header,children:[(0,Le.jsx)("div",{style:k.headerTitle,children:(0,Le.jsx)(P().sA,{id:"AiBlockConfigView.aiBlock",defaultMessage:"AI block"})}),(0,Le.jsx)(cn,{handleSaveButton:n,saveButtonDisabledMessage:S})]}),(0,Le.jsxs)("div",{style:k.content,children:[(0,Le.jsx)(Ee,{style:k.templateDuplicationFieldToggle,store:t}),(0,Le.jsxs)("div",{style:k.section,children:[(0,Le.jsx)("div",{style:k.sectionTitle,children:(0,Le.jsx)(P().sA,{id:"AiBlockConfigView.generate",defaultMessage:"Generate"})}),(0,Le.jsx)(ln,{store:t,disabled:s,inferredCustomContextType:p,setSelectedContextType:f})]}),(0,Le.jsx)("div",{style:k.section,children:(0,Le.jsx)(un,{blockConfiguration:a,updateBlockConfiguration:r,editDisabledLackOfPermissions:s,selectedContext:v,updateSelectedContext:y})}),(0,Le.jsxs)("div",{style:k.section,children:[(0,Le.jsx)("div",{style:k.sectionTitle,children:(0,Le.jsx)(P().sA,{id:"AiBlockConfigView.usingInformationFrom",defaultMessage:"Using information from"})}),(0,Le.jsx)(pn,{blockConfiguration:a,updateBlockConfiguration:r,editDisabledLackOfPermissions:s,setSelectedContextType:f,selectedContextType:m,currentPageScope:h}),"custom"===a.type&&"specified_context"===m?(0,Le.jsx)(gn,{selectedContext:v,store:t,updateSelectedContext:y,editDisabledLackOfPermissions:s}):void 0,"specified_context"===m?(0,Le.jsx)(fn,{searchScopes:a.searchScopes,setSearchScopes:x,editDisabledLackOfPermissions:s,setSelectedContextType:f}):void 0]})]})]})}var vn=()=>n(617837);function yn(e){const{traceId:t,feedbackState:n,setFeedbackState:o,iconHeight:i}=e;return(0,Le.jsx)(vn().j,{setFeedbackState:o,feedbackState:n,traceId:t,feedbackType:"ai_block",iconHeight:i})}var xn=()=>n(936916);function bn(e){const t=e?Z().c.getStateForBot({type:"universal",app:"slack",spaceId:e}):void 0;return e=>{const n=null==t?void 0:t.channels[e.channel.id];return Boolean(n)}}function Sn(e){const{onSettings:t,handleGenerateClick:n,isGenerating:o,isInlineSettingsEnabled:s,traceId:a,isEmpty:r,store:l,permissionLevelCalculator:d}=e,u=(0,P().tz)(),p=K().A.isMobile,g=qt({store:l,isGenerating:o,permissionLevelCalculator:d}),{isDisabled:m}=g,f=Qt(l),[h,v]=(0,i.useState)(void 0),y=d.canOpenConfigurationPanel(),x=(0,c().IS)((e=>({wrapper:{position:"absolute",top:0,right:8,zIndex:90,display:s?"flex":"none",alignItems:"center",backgroundColor:e.popoverBackground,borderRadius:6,padding:"0px",boxShadow:e.shadowMD,border:`1px solid ${e.regularDividerColor}`,height:"30px"},iconButton:{height:"100%"},loadingSpinner:{padding:"0px 6px"}})),[s]),b=(0,i.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),n()}),[n]);return(0,Le.jsxs)("div",{style:x.wrapper,children:[(0,Le.jsx)(H().A,{disableTooltip:!m&&!f,renderTooltip:()=>(0,Le.jsx)(Yt,{store:l,disabledResult:g,lastGeneratedProps:f}),render:e=>o?(0,Le.jsx)(ie().A,{...e,disabled:!0,style:x.loadingSpinner,children:(0,Le.jsx)(q().A,{size:"sm"})}):(0,Le.jsx)(z().A,{...e,icon:C().h,onClick:b,disabled:m,ariaLabel:o?u.formatMessage({id:"AiBlockV2.generatingTooltip",defaultMessage:"Generating..."}):u.formatMessage({id:"AiBlockV2.generateTooltip",defaultMessage:"Generate"}),size:"sm",color:"secondary",style:x.iconButton})}),p||r||o?null:(0,Le.jsx)(yn,{traceId:a,feedbackState:h,setFeedbackState:v,iconHeight:"100%"}),(0,Le.jsx)(H().A,{renderTooltip:()=>y?u.formatMessage({id:"AiBlockV2.settingsTooltip",defaultMessage:"Settings"}):u.formatMessage({id:"AiBlockV2.settingsTooltipDisabled",defaultMessage:"Insufficient permissions to edit"}),render:e=>(0,Le.jsx)(z().A,{...e,disabled:!y,icon:I().M,onClick:t,ariaLabel:u.formatMessage({id:"AiBlockV2.settingsButton",defaultMessage:"Settings"}),size:"sm",color:"secondary",style:x.iconButton})})]})}function kn(e){const{handleGenerateClick:t,store:n,isGenerating:s,permissionLevelCalculator:d,configurationPopupStore:u,traceId:p}=e,{updateBlockConfiguration:g}=Ht(n),m=qt({store:n,isGenerating:s,permissionLevelCalculator:d}),f=(0,l().K8)((()=>u.state.open),[u]),h=(0,c().IS)((e=>({divider:{borderRight:`1px solid ${e.regularDividerColor}`},actionbarWrapperStyle:{position:"absolute",zIndex:85,top:-40,right:-2,borderRadius:10,height:32,fontSize:14,lineHeight:1.2,display:"flex",whiteSpace:"nowrap",fontFamily:E().vc(a().locale).sans,background:e.popoverBackground,boxShadow:e.shadowMD,visibility:f?"hidden":"visible"}})),[f]),v=(0,r().v3)(),{isMobile:y}=v.device,x=(0,i.useCallback)((()=>{u.setState({open:!1})}),[u]),b=(0,l().K8)((()=>u.state.open),[u]),S=d.canOpenConfigurationPanel();return(0,Le.jsx)(o().P.div,{animate:{opacity:1},initial:{opacity:0},style:h.actionbarWrapperStyle,children:(0,Le.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,Le.jsx)(In,{disabledResult:m,onClick:t,isGenerating:s,store:n,permissionLevelCalculator:d,traceId:p}),(0,Le.jsx)("div",{style:h.divider}),(0,Le.jsx)(se().Ay,{disabled:!S||y,buttonPopupStore:u,open:b,onClick:()=>{(0,G().u)({environment:v,event:{eventName:"ai_block_settings_panel_opened",eventProperties:{}}})},render:()=>(0,Le.jsx)(Zt,{store:n,updateBlockConfiguration:g,onClosePopup:x,handleGenerateClick:t,isGenerating:s,permissionLevelCalculator:d}),renderOrigin:e=>(0,Le.jsx)(Cn,{...e,disabled:!S}),popupType:se().z7.Popup,originGap:8})]})})}const Cn=i.forwardRef((function(e,t){const{onClick:n,...o}=e,i=(0,P().tz)(),s=(0,c().IS)((()=>({wrapper:{display:"flex",alignItems:"center",cursor:"pointer",paddingLeft:10,paddingRight:10,paddingTop:6,paddingBottom:6,...o.disabled&&{cursor:"not-allowed",opacity:.5}}})),[o.disabled]);return(0,Le.jsx)(H().A,{renderTooltip:()=>i.formatMessage({defaultMessage:"Insufficient permissions to view",id:"AiBlockV2.insufficientPermissionsTooltip"}),disableTooltip:!o.disabled,render:e=>(0,Le.jsx)(ie().A,{style:s.wrapper,ignoreLocalHoverState:!0,hovered:!1,onClick:n,ref:t,...(0,Q().A)(o,e),children:(0,Le.jsx)(P().sA,{id:"AiBlockV2.editConfiguration",defaultMessage:"Settings"})})})})),In=i.forwardRef((function(e,t){const{onClick:n,disabledResult:o,isGenerating:s,store:a,permissionLevelCalculator:l,traceId:d}=e,u=o.isDisabled,p=(0,c().IS)((e=>({wrapper:{cursor:u?"not-allowed":"pointer",paddingTop:6,paddingBottom:6,paddingRight:6,paddingLeft:6,fontSize:12,opacity:u?.5:1,display:"flex",alignItems:"center"}})),[u]),g=(0,r().v3)(),{isMobile:m}=g.device,[f,h]=(0,i.useState)(void 0);return(0,Le.jsxs)("div",{style:p.wrapper,onClick:u?void 0:n,ref:t,children:[(0,Le.jsx)($t,{isGenerating:s,store:a,permissionLevelCalculator:l}),m?null:(0,Le.jsx)(yn,{traceId:d,feedbackState:f,setFeedbackState:h})]})})),wn=(0,P().YK)({failedToGenerate:{id:"AIBlockV2.FailedToGenerate",defaultMessage:"Failed to generate. Please try again later."}});function An(e){const{spaceId:t,currentUserId:n}=(0,l().K8)((()=>{var e,t;return{spaceId:null===(e=X().default.state.currentSpaceStore)||void 0===e?void 0:e.id,currentUserId:null===(t=X().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),o=(0,l().K8)((()=>e.getModel()),[e]),i=(0,l().K8)((()=>{var t;return null===(t=e.getNavigableBlockStore())||void 0===t?void 0:t.pointer}),[e]);return(0,l().K8)((()=>function(e){const{model:t,spaceId:n,currentUserId:o,getRecordRole:i,getCanReadSlackChannel:s,currentPagePointer:a}=e;if(!t)return"reader";if(!n||!o)return"reader";const r=i(t.pointer)??"none";if(!(0,p().Tt)(r))return"reader";const l=i({id:n,table:f().NX})??"none";if(!(0,p().Tt)(l))return"reader";if(!(0,p().p2)(r))return"configuration_reader";const c=(0,h().Lv)({model:t});if("custom"===c.type)return v({referenceContext:c.context,getCanReadSlackChannel:s,getRecordRole:i})?"editor":"configuration_reader";if("summarizeThisPage"===c.type||"extractKeyPointsFromThisPage"===c.type)return a?v({referenceContext:[{type:"page",pageId:a.id}],getCanReadSlackChannel:s,getRecordRole:i})?"editor":"configuration_reader":"reader";(0,u().HB)(c)}({spaceId:t,currentUserId:n,getCanReadSlackChannel:bn(t),getRecordRole:e.getRecordRole,model:o,currentPagePointer:i})),[t,n,e,o,i])}function jn(e){const{store:t,hoveredOrSelectionState:n,setHaloShouldBeVisible:o,showingOverlay:a,disabled:c,disableHoverMenu:d,configurationPopupStore:p}=e,m=(0,r().v3)(),f=(0,P().tz)(),h=(0,Y().X)("ai_block_v2_inline_settings"),[v,x]=(0,i.useState)(!1),C=new y(An(t)),{blockConfiguration:I,updateBlockConfiguration:w}=Ht(t);(0,i.useEffect)((()=>{U().EF.state===t.pointer.id&&(!function(e){var t;const{updateBlockConfiguration:n,blockConfiguration:o,environment:i}=e,a=new Set,r=null===(t=X().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(r&&"context"in o){for(const e of o.context??[])if("collection"===e.type||"page"===e.type||"currentPage"===e.type){const t=new(J().Bv)(i,{table:g().ev,id:e.pageId,spaceId:r});s().e.withListenerIgnored((()=>!t.canRead()))&&a.add(e.pageId)}else"slack"===e.type?bn(r)(e)||a.add(e.channel.id):(0,u().HB)(e);n({...o,context:(o.context??[]).filter((e=>"slack"===e.type?!a.has(e.channel.id):!a.has(e.pageId)))})}}({environment:m,blockConfiguration:I,updateBlockConfiguration:w}),h?(x(!0),o(!0)):p.setState({open:!0}),U().EF.setState(void 0))}),[I,m,t.pointer.id,w,p,h,o]),(0,i.useEffect)((()=>{O().AP()}),[n]);const A=(0,i.useCallback)((e=>{W().ui({message:e,showCancel:!1,keepFocus:!1,items:[{label:$().A.formatMessage(W()._0.dismissButtonLabel),onAccept:_().D_}]})}),[]),[j,T]=(0,i.useState)(!1),B=(0,l().K8)((()=>t.isGenerating()),[t]);(0,i.useEffect)((()=>{T(B)}),[B]);const E=t.id,F=(0,i.useCallback)((async()=>{await async function(e){const{environment:t,setIsGenerating:n,onError:o,store:i,intl:s}=e;function a(){o(s.formatMessage(wn.failedToGenerate))}n(!0);const r=async()=>{var e,n;const o=null===(e=X().default.state.currentSpaceStore)||void 0===e?void 0:e.id;if(!o)return;const s=null===(n=i.getNavigableBlockStore())||void 0===n?void 0:n.pointer;if(!s)return;const a=await(0,te().Bw)(t,{spaceId:o,userId:t.currentUser.id,amount:1,name:"ai_usage"});if(!(0,M().e2)(a))return void ee().K(t,{from:"ai_limit_in_app",upsell:a.upsell});const r=await D().callStreamApi({eventName:"generateAiBlock",environment:t,data:{blockPointer:{...i.pointer,spaceId:o},parentPagePointer:{...s,spaceId:o},analyticsSource:"client"}}),l=await(0,te().Bw)(t,{spaceId:o,userId:t.currentUser.id,amount:"unknown",name:"ai_usage"});if((0,k().kX)(r)||"success"!==r.type||!R().hS.is(r.data))throw new Error("InvalidServerResponse");{let e;for await(const n of r.data){if(!(0,k().PX)(n)){if((0,k().kX)(n)){if((0,S().Sdl)(n)&&null!=l&&l.upsell)return void ee().K(t,{from:"ai_limit_in_app",upsell:l.upsell});throw new Error("InvalidStreamResponse")}throw new Error("InvalidStreamResponse")}Tn({environment:t,markdownString:n.markdownString,aiBlockStore:i}),e=n.markdownString}if(!e||0===e.length)throw new Error("EmptyGeneration")}};try{return await(0,L().L5)({fn:r,retryAttemptsMS:[50,100,200],retryAttemptRandomOffsetMS:0,initialInput:void 0,handleError:(e,t,n)=>(t&&a(),function(e){const{type:t,aiBlockId:n,spaceId:o,miscDataToConvertToString:i}=e;b().log({from:"generateAiBlockTask",level:"error",type:t,data:{miscDataToConvertToString:{aiBlockId:n,spaceId:o,...i}}})}({aiBlockId:i.id,spaceId:i.getSpaceId(),type:e.name,miscDataToConvertToString:{source:"client",isRetrying:!t,retryAttempt:n}}),t?{status:"throw",error:e}:{status:"retry"})})}finally{n(!1)}}({environment:m,intl:f,onError:A,store:t,setIsGenerating:T})}),[m,f,A,t]),N=(0,i.useCallback)((()=>{j||(h?x(!0):p.setState({open:!0}))}),[p,h,j]),z=(0,i.useCallback)((()=>{(0,G().u)({environment:m,event:{eventName:"ai_block_settings_panel_opened",eventProperties:{}}}),x(!0),o(!0)}),[o,m]),q=(0,i.useCallback)((()=>{x(!1),o(!1)}),[o]),H=(0,l().K8)((()=>!t.hasContent()),[t]),K=(0,l().K8)((()=>t.getContentStore()),[t]),Q=(0,r().Y0)(),Z=(0,l().K8)((()=>h&&!v&&n!==V().l.Default),[n,h,v]);return(0,Le.jsxs)(ne().A,{name:"AiBlockV2",children:[(0,Le.jsxs)("div",{style:{paddingLeft:8,minHeight:32,position:"relative"},onClick:H?N:void 0,children:[Z?(0,Le.jsx)(Sn,{onSettings:z,isInlineSettingsEnabled:h,handleGenerateClick:F,isGenerating:j,traceId:E,isEmpty:H,permissionLevelCalculator:C,store:t}):void 0,v?(0,Le.jsx)(oe().s,{allowSelectionWithin:!0,onClick:e=>e.stopPropagation(),children:(0,Le.jsx)(hn,{store:t,onClose:q,permissionLevelCalculator:C})}):(0,Le.jsx)(ae().A,{emptyPlaceholder:(0,Le.jsx)(Mn,{placeholderText:f.formatMessage({id:"AiBlockV2.EmptyEditingPlaceholder3",defaultMessage:"Your AI content will be generated here - click to setup"})}),disabled:c||j,store:K,disableHoverMenu:d||n!==V().l.SelectedDescendant,disableDrag:Q.isMobile})]}),a?(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(xn().gM,{hoveredOrSelectionState:n,setHaloShouldBeVisible:o,colorVariant:"blue",configurationPopupStore:p,showingConfigView:v}),h?void 0:(0,Le.jsx)(oe().s,{allowSelectionWithin:!1,children:(0,Le.jsx)(kn,{store:t,handleGenerateClick:F,isGenerating:j,permissionLevelCalculator:C,configurationPopupStore:p,traceId:E})})]}):void 0]})}function Tn(e){const{environment:t,markdownString:n,aiBlockStore:o}=e,i=o.getSpaceId(),s=t.currentUser.id;if(!s)return;const a={table:T().oo,id:s},r=t.idCreator.getSpaceIdCreatorSync(i),l=(0,x().h)(n),c=(0,d().i)({pageId:o.id,recordMap:j().RecordMap.create(),updates:[{action:"insert",blocks:l}],spaceId:i,useCrdt:!1,idCreator:r,actorPointer:a,uriContext:{baseUrl:K().A.domainBaseUrl,publicDomainName:K().A.publicDomainName}});N().createAndCommit({userAction:"aiBlockV2.handleMarkdownStreamResponse",environment:t,canUndo:!0,perform:e=>{o.getContentIds().forEach((t=>{N().applyOperation({store:o,operation:(0,A().TQ)({blockParentId:o.id,recordId:t}),transaction:e})}));for(const n of c)if((0,B().ph)(n)){const o=new(J().Bv)(t,n.pointer);N().applyCrdtTextOperation({store:o,operation:n,invertedOperation:void 0,transaction:e})}else if((0,w().$Y)(n)||(0,w().mP)(n))switch(n.pointer.table){case g().ev:{const o=new(J().Bv)(t,n.pointer);N().applyOperation({store:o,operation:n,transaction:e});break}default:{const o=new(J().pm)({environment:t,pointer:n.pointer,path:n.path});N().applyOperation({store:o,operation:n,transaction:e})}}else(0,u().HB)(n);F().zv({store:o.getFormatStore(),data:{ai_last_edited:Date.now()},transaction:e})}})}function Mn(e){const{placeholderText:t}=e,n=(0,c().IS)((e=>({textWrapper:{caretColor:e.text.tertiary,color:e.text.tertiary,marginTop:4,marginBottom:4,cursor:"pointer"}})),[]);return(0,Le.jsx)("div",{style:n.textWrapper,children:t})}},756114:(e,t,n)=>{n.d(t,{D:()=>o});function o(e,t){t.route.name;return!1}},801678:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(296540),i=()=>n(662303),s=()=>n(56366),a=()=>n(959013),r=()=>n(381349),l=()=>n(496603),c=()=>n(284371),d=()=>n(720665),u=()=>n(145214),p=n(474848);const g={isRepositioning:!1};const m=function(e){const t=(0,o.useRef)(null),i=(0,n(484714).v3)(),[a,r]=(0,o.useState)(g),c=(0,o.useCallback)((()=>{r(g)}),[]),{renderControl:u,onFlushTemporaryPosition:m,style:h,source:v,store:y}=e,{isRepositioning:x,image:b,startDragRenderedPosition:S,startDragImageScreenHeight:k}=a,C=(0,s().K8)((()=>0===n(502438).default.state.stores.length),[]),[I,w]=(0,o.useState)(!1),A=(0,s().uB)(e.mouseStore,n(454305).A),j=(0,s().K8)((()=>A.state.mouseEntered),[A]),T=(0,n(401497).IS)((()=>({dragContainer:{width:"100%",cursor:x?"move":"inherit"},container:{position:"relative",width:"100%",zIndex:1}})),[x]),M=(0,s().K8)((()=>function(e,t,n){return(0,l().Et)(n)?n:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,l().Et)(e))return e}const n=.5;if(t.isCollectionView()){const e=t.getCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,d().pN)(t)?n:t}}const o=t.getFormat(),i=o.page_cover_position;if((0,l().Et)(i))return i;return n}(e,t)}(v,y,a.temporaryPosition)),[a.temporaryPosition,v,y]);(0,o.useEffect)((()=>{const e=e=>{const n=t.current;n&&!n.contains(e.target)&&x&&m({imagePosition:M,reset:()=>{A.reset(),c()}})};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)}),[M,x,A,m,c]),x&&!C&&c();const B=(0,o.useMemo)((()=>(0,l().nF)((e=>{A.setState({...A.state,mouseEntered:!0})}),100)),[A]),P=(0,o.useMemo)((()=>(0,l().sg)((e=>{A.setState({...A.state,mouseEntered:!1})}),100)),[A]),R=(0,o.useCallback)(((e,t)=>{n(778417).IU({environment:i});const o=new Image;o.onload=()=>{r((e=>({...e,isRepositioning:!0,image:o})))},t&&(o.src=t)}),[i]),_=(0,o.useCallback)((e=>{m({imagePosition:M,reset:()=>{c()}})}),[M,m,c]),L=(0,o.useCallback)((e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,n(819121).p)(t)&&w(!0)}),[]),E=(0,o.useCallback)((()=>{w(!0)}),[]),D=(0,o.useCallback)((e=>{if(b&&x){const e=t.current;if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/b.width*b.height;r((e=>({...e,startDragImageScreenHeight:t,startDragRenderedPosition:M})))}}}),[b,M,x]),W=(0,o.useCallback)((e=>{if(x){const t=e.diffY/(k||0)+(S||0);r((e=>({...e,temporaryPosition:(0,l().LI)((0,n(40845).A)(t,0,1),4)})))}}),[x,k,S]),U=(0,o.useCallback)((()=>{r((e=>({...e,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})))}),[]),F=(0,s().K8)((()=>u({handleRepositionClick:R,handleSavePositionClick:_,handleCancelClick:c,isVisible:j||I||x,isRepositioning:x})),[R,_,I,x,j,u,c]),O=(0,n(79043).A)(Boolean(e.preventClickPropagation));return(0,p.jsxs)("div",{ref:t,onFocus:L,onBlur:E,onMouseEnter:B,onMouseMove:B,onMouseLeave:P,...O,...(0,n(955825).AH)(T.container,h),children:[(0,p.jsx)(n(603820).A,{onDraggableDragStart:D,onDraggableDragMove:W,onDraggableDragEnd:U,onDraggableDragCancel:U,disabled:!x,render:t=>(0,p.jsx)("div",{style:T.dragContainer,...t,children:e.render({imagePosition:M,isRepositioning:x})})}),(0,p.jsx)(f,{small:e.small,isRepositioning:x}),F]})};function f(e){let{small:t,isRepositioning:n}=e;if(t)return null;const o={background:r().Ay.blackWithAlpha(.4),borderRadius:4,color:r().Ay.white,fontSize:12,fontFamily:c().vc(i().locale).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"};return(0,p.jsx)(u().A,{visible:n,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:o,children:(0,p.jsx)(a().sA,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})})}},813197:(e,t,n)=>{n.d(t,{L:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"3.5 3.07 13 13.83",svg:(0,n(474848).jsx)("path",{d:"M8.848 3.085c.34.06.567.384.507.724l-.61 3.466h3.42l.65-3.683a.625.625 0 0 1 1.23.216l-.61 3.467h2.435a.625.625 0 1 1 0 1.25h-2.655l-.52 2.95h2.435a.625.625 0 0 1 0 1.25h-2.655l-.65 3.684a.625.625 0 0 1-1.23-.217l.61-3.467h-3.42l-.65 3.684a.625.625 0 0 1-1.23-.217l.61-3.467H4.13a.625.625 0 1 1 0-1.25h2.605l.52-2.95H4.87a.625.625 0 0 1 0-1.25h2.605l.65-3.683a.625.625 0 0 1 .723-.507m2.578 8.39.52-2.95H8.523l-.52 2.95z"})},i=(0,n(340498).wt)("number",o)},829e3:(e,t,n)=>{n.d(t,{c:()=>a,m:()=>i});function o(e){switch(e.type){case"external":return`external-${e.botId}`;case"workflow":return`workflow-${e.workflowExternalScopedConnectionId}`;case"universal":return`universal-${e.app}-${e.spaceId}`;default:throw(0,n(534177).HB)(e)}}const i={channels:{},fetching:!1,lastRefreshed:0};class s extends(()=>n(757695))().Store{getStateForBot(e){const t=o(e);return this.state[t]??i}updateStateForBot(e,t){this.setState({...this.state,[o(e)]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const n=this.getStateForBot(e);this.setState({...this.state,[o(e)]:{...n,channels:{...n.channels,...t}}})}}const a=new s;(0,n(604341).exposeDebugValue)("ExternalNotificationChannelsStore",a)},867772:(e,t,n)=>{n.d(t,{Ay:()=>l,Gi:()=>s,Wc:()=>o,pF:()=>a,vS:()=>i});const o="loadingLocalImage",i="uploading",s="downloading",a="loaded";class r extends(()=>n(757695))().Store{getInitialState(){return{loadingMode:a}}}const l=r},881707:(e,t,n)=>{n.d(t,{Dy:()=>r,Os:()=>c,l$:()=>l,qO:()=>a});n(944114),n(898992),n(354520);var o=()=>n(617871),i=()=>n(792071),s=()=>n(402904);function a(e){if(e.integration_id!==o().zG)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,n,i]=t;return{organizationName:n,accountName:i}}function r(e){return i().Bj6.fromValue(s().As,e).getSlackWorkspaceId()}function l(e,t){return t?e.filter((e=>{const n=r(e);return!!n&&t(n)})):e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};for(const o of e){const{accountName:e,organizationName:i}=a(o);d({query:t,accountName:e,organizationName:i})&&(n[e]||(n[e]=[]),n[e].push({externalAuthentication:o,workspaceName:i}))}return n}function d(e){const{accountName:t,organizationName:n,query:o}=e;if(0===o.length)return!0;const i=t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0,s=!!n&&n.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0;return i||s}}}]);