"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[40925],{37489:(t,e,o)=>{function n(t){var e;const o=Boolean(null===(e=function(t){var e,o;if(!t.isInViewTabLayout())return;if("page"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()))return;return null===(o=t.collectionViewStore())||void 0===o?void 0:o.getCollectionStore()}(t))||void 0===e?void 0:e.canEditCollection());return t.permissionScopesStore.state.canConfigureBlock||t.isEphemeralView()||o}o.d(e,{H:()=>n})},189048:(t,e,o)=>{o.d(e,{u:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowDownThick",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M7.99316 1.52246C7.40527 1.52246 7.00195 1.93262 7.00195 2.54785V10.1357L7.07031 11.6191L5.69629 10.0332L4.1582 8.50195C3.98047 8.31738 3.74805 8.19434 3.44727 8.19434C2.91406 8.19434 2.51074 8.59082 2.51074 9.15137C2.51074 9.41113 2.61328 9.65039 2.81836 9.8623L7.26172 14.3125C7.44629 14.5039 7.72656 14.6133 7.99316 14.6133C8.2666 14.6133 8.54004 14.5039 8.72461 14.3125L13.1748 9.8623C13.3799 9.65039 13.4824 9.41113 13.4824 9.15137C13.4824 8.59082 13.0791 8.19434 12.5459 8.19434C12.252 8.19434 12.0195 8.31738 11.835 8.50195L10.2969 10.0332L8.92285 11.6191L8.98438 10.1357V2.54785C8.98438 1.93262 8.58789 1.52246 7.99316 1.52246Z"})})},199734:(t,e,o)=>{o.d(e,{U:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})},244091:(t,e,o)=>{o.d(e,{Ni:()=>s,U7:()=>l,rY:()=>a});o(296540);var n=()=>o(959013),r=()=>o(292379),i=o(474848);function l(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function s(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function a(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},292379:(t,e,o)=>{o.d(e,{B:()=>m});var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(541235),s=()=>o(73223),a=()=>o(739135);const c=new Map;var u=()=>o(765957),d=()=>o(953006),p=o(474848);function m(t){let{tutorialId:e,tutorialStepId:o,onPrimaryButtonClick:m,displayStore:S,...g}=t;const x=(0,r().v3)(),f=function(t){const e=!c.get(t),o=(0,n.useRef)(e);return o.current&&c.set(t,!0),(0,n.useEffect)((()=>()=>{o.current&&c.set(t,!1)}),[t]),o.current}(`${e}.${o}`),{currentStep:y,isLoading:v}=(0,i().K8)((()=>{var t;return{isLoading:!(null!==(t=u().default.state.currentUserSettingsStore)&&void 0!==t&&t.getSettings()),currentStep:(0,a().gt)(u().default.state.currentUserSettingsStore,e)}}),[e]);if((0,n.useEffect)((()=>{v||y!==o||!f?null==S||S.setState(!1):null==S||S.setState(!0)}),[v,y,o,f,S]),v||y!==o||!f)return null;const h=l().c$[e],C=h.steps.findIndex((t=>t.id===o)),j=h.steps.length;return(0,p.jsx)(d().k,{onCloseClick:()=>{s().dismissTutorial(x,e)},onPrimaryButtonClick:t=>{s().tutorialGoToNextStep(x,e),null==m||m(t)},onBackButtonClick:()=>{s().tutorialGoToPrevStep(x,e)},numSteps:j,currStepIndex:C,...g})}},300089:(t,e,o)=>{o.d(e,{N9:()=>tt,aV:()=>Q,he:()=>rt});o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),r=()=>o(395361),i=()=>o(484714),l=()=>o(56366),s=()=>o(401497),a=()=>o(199734),c=()=>o(863330),u=()=>o(959013),d=()=>o(496603),p=()=>o(436696),m=()=>o(187899),S=()=>o(686526),g=()=>o(778417),x=()=>o(725614),f=()=>o(59400),y=()=>o(615950),v=()=>o(145214),h=()=>o(493823),C=()=>o(594739),j=()=>o(439264),b=()=>o(805751),k=()=>o(623580),A=()=>o(897119),_=()=>o(2143),M=()=>o(59822),T=()=>o(109488),w=()=>o(873050),I=()=>o(525432),B=()=>o(253579),F=()=>o(963589),R=()=>o(658199),P=()=>o(756279),D=()=>o(463830),O=()=>o(700250),L=()=>o(17090),V=()=>o(404779),K=()=>o(37489),N=()=>o(519839),U=()=>o(958832),H=()=>o(602141),z=()=>o(189048),E=()=>o(134421),W=o(474848);const Y=(0,o(340498).wt)("arrowUpThick",{viewBox:"0 0 16 16",svg:(0,W.jsx)("path",{d:"M7.99316 14.6133C8.58789 14.6133 8.98438 14.2031 8.98438 13.5879V6L8.92285 4.5166L10.2969 6.10254L11.835 7.63379C12.0195 7.81836 12.252 7.94141 12.5459 7.94141C13.0791 7.94141 13.4824 7.54492 13.4824 6.98438C13.4824 6.72461 13.3799 6.48535 13.1748 6.27344L8.72461 1.82324C8.54004 1.63184 8.2666 1.52246 7.99316 1.52246C7.72656 1.52246 7.44629 1.63184 7.26172 1.82324L2.81836 6.27344C2.61328 6.48535 2.51074 6.72461 2.51074 6.98438C2.51074 7.54492 2.91406 7.94141 3.44727 7.94141C3.74805 7.94141 3.98047 7.81836 4.1582 7.63379L5.69629 6.10254L7.07031 4.5166L7.00195 6V13.5879C7.00195 14.2031 7.40527 14.6133 7.99316 14.6133Z"})});var $=()=>o(284371),J=()=>o(377586),X=()=>o(56394);function q(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const{device:r}=(0,i().v3)(),s=(0,l().K8)((()=>o.state.open),[o]),a=(0,n.useCallback)((t=>{t&&(0,B().Rp)(t.target)||S().os({collectionSettingsStore:o})}),[o]),c=(0,n.useCallback)((()=>(0,W.jsx)(f().m$,{context:I().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})),[e,o]);return(0,n.useEffect)((()=>()=>S().os({collectionSettingsStore:o})),[]),(0,W.jsx)(A().Ay,{popupType:r.isMobile?J().n.SlideUp:J().n.Popup,placementToOrigin:O().UV.Bottom,alignmentToOrigin:O().MY.Start,open:s,origin:(0,W.jsx)(G,{collectionContextStore:e,collectionSettingsStore:o}),onDismiss:a,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function G(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const r=(0,i().v3)(),[a,c,d,m]=(0,l().K8)((()=>[e.currentSortsStore.state,e.localStateDiffStore.state,e.normalizedSchemaStore.state,e.permissionScopesStore.state]),[e]),g=a[0],x=g?d[g.property]:void 0,f=(0,n.useCallback)((()=>{(0,p().X)({environment:r,collectionContextStore:e,action:"click_sort"}),S().R8({collectionSettingsStore:o,item:{type:"sort"}})}),[e,o,r]),y=(0,s().IS)((t=>({arrowIcon:{width:12,marginRight:4,fill:t.blueColor},arrowsIcon:{width:16,marginRight:4,fill:t.blueColor},title:{marginTop:-1,maxWidth:220,...$().RC}})),[]);let v;return v=1===a.length?g&&"descending"===g.direction?(0,z().u)(y.arrowIcon):Y(y.arrowIcon):(0,E().X)(y.arrowsIcon),(0,W.jsx)(X().A,{on:!0,hasDiff:Boolean(m.canConfigureBlock&&c.sorts),icon:v,title:(0,W.jsx)("span",{style:y.title,children:1===a.length&&x?x.name:(0,W.jsx)(u().sA,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:a.length}})}),onClick:f})}let Q=function(t){return t[t.FilterBar=0]="FilterBar",t[t.SettingsFilters=1]="SettingsFilters",t}({});const Z=o(757695).Store.createClass({open:!1,stack:[]},{name:"CreateFilterSettingsStore"});function tt(t){var e;let{collectionContextStore:o,showHoverActionsStore:r,createFilterSettingsStore:a,saveControlMoreActionsButtonPopupStore:c}=t;const u=(0,i().WS)(),d=(0,F().X)("db_ux_chrome"),p=(0,F().X)("db_ux_phone_remove_bar"),m=(0,l().uB)(c,D().A),S=(0,l().uB)(a,Z),g=(0,l().K8)((()=>(0,w().y_)(o)),[o]),x=(0,l().K8)((()=>u&&o.searchOpenStore.state&&!p),[u,o,p]),f=(0,l().O$)(o.currentPropertyFiltersStore),y=(0,l().O$)(o.currentSortsStore),v=(0,l().K8)((()=>o.filterBarSortSettingsStore.state.open),[o]),h=y.length>0||v,C=(0,l().O$)(o.isUnlistedViewStore),j=(0,l().K8)((()=>(0,K().H)(o)?o.currentCombinatorFilterStore.state:void 0),[o]),b=(0,l().uB)(void 0,L().A),k=null===(e=(0,N().Oz)(o))||void 0===e?void 0:e.background,A=(0,n.useCallback)((t=>{o.filtersBarOpenStore.setState(!0)}),[o]),T=(0,s().IS)((t=>({container:{width:"100%",zIndex:86,...d&&{borderTop:`1px solid ${t.tableDividerColor}`,marginTop:4},...C&&{paddingLeft:16,paddingRight:16,borderTop:"none"}}})),[d,C]);return(0,W.jsxs)("div",{style:T.container,onClick:A,tabIndex:0,role:"button",children:[(0,W.jsxs)("div",{style:{display:"flex",paddingTop:4},children:[x&&(0,W.jsx)(st,{collectionContextStore:o}),!x&&(0,W.jsxs)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:[(0,W.jsx)(_().H,{store:b,type:P().A.X,style:{display:"flex",alignItems:"center",paddingTop:8,paddingBottom:8},children:u?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(at,{collectionContextStore:o}),h&&(0,W.jsx)(ot,{collectionContextStore:o}),h&&!u&&(0,W.jsx)(rt,{}),j&&(0,W.jsx)(et,{collectionContextStore:o}),(0,W.jsx)(lt,{collectionContextStore:o,propertyFilters:f,createFilterSettingsStore:S}),(0,W.jsx)(dt,{collectionContextStore:o,showHoverActionsStore:r,createFilterSettingsStore:S})]}):(0,W.jsxs)(W.Fragment,{children:[h&&(0,W.jsx)(ot,{collectionContextStore:o}),h&&!u&&(0,W.jsx)(rt,{}),j&&(0,W.jsx)(et,{collectionContextStore:o}),(0,W.jsx)(lt,{collectionContextStore:o,createFilterSettingsStore:S,propertyFilters:f}),(0,W.jsx)(dt,{collectionContextStore:o,showHoverActionsStore:r,createFilterSettingsStore:S})]})}),!u&&(0,W.jsx)(M().A,{store:b,backgroundColor:k})]}),(0,W.jsxs)("div",{style:{display:"flex",alignItems:"start",paddingTop:6,marginLeft:"auto",flexShrink:0},children:[!u&&g&&(0,W.jsx)(ct,{collectionContextStore:o,showHoverActionsStore:r,saveControlMoreActionsButtonPopupStore:m}),!u&&(0,W.jsx)(R().A,{collectionContextStore:o})]})]}),u&&!x&&(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[g&&(0,W.jsx)(ct,{collectionContextStore:o,showHoverActionsStore:r,saveControlMoreActionsButtonPopupStore:m}),(0,W.jsx)(R().A,{collectionContextStore:o})]})]})}function et(t){let{collectionContextStore:e}=t;return(0,W.jsx)(U().l,{context:Q.FilterBar,collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore,collectionContextStore:e})}function ot(t){let{collectionContextStore:e}=t;return(0,W.jsx)(q,{collectionContextStore:e,collectionSettingsStore:e.filterBarSortSettingsStore},"sort")}function nt(t){let{filter:e,collectionContextStore:o,onClick:n}=t;const r=(0,l().K8)((()=>o.getFilterBarItemSettingsStore(e)),[o,e]);return(0,W.jsx)(H().A,{id:e.id,context:Q.FilterBar,collectionContextStore:o,collectionSettingsStore:r,onClick:n},e.id)}function rt(){const t=(0,s().DP)();return(0,W.jsx)("div",{style:{borderRight:`1px solid ${t.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}function it(t){t.searchOpenStore.setState(!1),t.searchQueryStore.setState("")}function lt(t){let{propertyFilters:e,collectionContextStore:o,createFilterSettingsStore:r}=t;const s=(0,i().v3)(),a=(0,l().O$)(o.permissionScopesStore),[c]=(0,l().K8)((()=>[o.currentPropertyFiltersStore.state]),[o]),u=(0,n.useCallback)((t=>{S().os({collectionSettingsStore:r}),S().os({collectionSettingsStore:o.filterBarSortSettingsStore}),S().os({collectionSettingsStore:o.filterBarCombinatorFilterSettingsStore}),c.filter((e=>!t||e.id!==t)).forEach((t=>{const e=o.getFilterBarItemSettingsStore(t);S().os({collectionSettingsStore:e})}))}),[o,r,c]);if(a.canConfigureBlock){const t=e.map((t=>t.id));return(0,W.jsx)(j().Ay,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const n=e.find((e=>e.id===t));if(n)return(0,W.jsx)(nt,{collectionContextStore:o,filter:n,onClick:u})},style:{display:"flex",flexShrink:0},onDrop:t=>function(t,e,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,r=d().oE(t.map((t=>n.find((e=>e.id===t)))));m().IU({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,p().X)({environment:e,collectionContextStore:o,action:"reorder_filters"})}(t,s,o)})}return(0,W.jsx)(W.Fragment,{children:e.map((t=>(0,W.jsx)(nt,{filter:t,collectionContextStore:o,onClick:u},t.id)))})}function st(t){let{collectionContextStore:e}=t;const o=(0,u().tz)(),c=(0,s().DP)(),d=(0,i().v3)(),p=(0,l().O$)(e.searchQueryStore),m=(0,n.useCallback)((t=>{e.searchQueryStore.setState(t.target.value)}),[e]),S=(0,r().Y)(m,250),g=(0,F().X)("db_ux_chrome");return(0,W.jsx)(b().A,{debugName:"CollectionViewFilterBar",capture:!0,children:(0,W.jsx)(T().A,{capture:!0,render:t=>(0,W.jsx)("div",{...t,style:{width:"100%",paddingTop:d.device.isMobile?8:12,paddingBottom:2},children:(0,W.jsx)(X().A,{wrapStyle:{width:"100%"},innerStyle:{width:"100%",border:"none"},icon:(0,a().U)({width:g?16:14,fill:c.icon.secondary,marginRight:8}),hideChevron:!0,title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(k().A,{format:k().C.Transparent,value:p,placeholder:o.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:S,autoComplete:"on",autoCorrect:"on",onBlur:()=>function(t){t.searchQueryStore.state||it(t)}(e),onClearButtonClick:()=>it(e),showClearButton:!0,focus:!d.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,W.jsx)(C().A,{show:!0})]})})})})})}function at(t){let{collectionContextStore:e}=t;const o=(0,s().DP)(),n=(0,i().v3)(),r=(0,F().X)("db_ux_chrome");return"chart"===(0,l().K8)((()=>e.getViewType()),[e])?null:(0,W.jsx)(X().A,{wrapStyle:{display:"flex",alignItems:"center"},innerStyle:{border:"none"},icon:(0,a().U)({width:r?16:14,fill:o.icon.secondary}),hideChevron:!0,onClick:()=>function(t,e){x().clear({environment:t}),g().IU({environment:t}),(0,V().y)(),e.searchOpenStore.setState(!0),e.searchQueryStore.setState(""),(0,p().X)({environment:t,collectionContextStore:e,action:"click_mobile_search"})}(n,e)},"search")}function ct(t){let{collectionContextStore:e,showHoverActionsStore:o,saveControlMoreActionsButtonPopupStore:n}=t;return(0,W.jsx)(y().Ay,{context:y().$J.FilterBar,collectionContextStore:e,showHoverActionsStore:o,moreActionsButtonPopupStore:n})}function ut(t){let{collectionContextStore:e,createFilterSettingsStore:o}=t;return(0,W.jsx)(f().m$,{context:I().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})}function dt(t){let{collectionContextStore:e,showHoverActionsStore:o,createFilterSettingsStore:r}=t;const s=(0,i().v3)(),a=(0,F().X)("db_ux_mobile"),d=(0,n.useCallback)((t=>function(t,e){t&&"click"===t.type&&(0,B().Rp)(t.target)||S().os({collectionSettingsStore:e})}(t,r)),[r]),m=(0,n.useCallback)((()=>(0,W.jsx)(ut,{collectionContextStore:e,createFilterSettingsStore:r})),[e,r]),g=(0,n.useCallback)((()=>function(t,e,o){(0,p().X)({environment:t,collectionContextStore:e,action:"click_new_filter"}),S().R8({collectionSettingsStore:o,item:{type:"createFilter"}})}(s,e,r)),[s,e,r]),x=(0,l().K8)((()=>r.state.open),[r]),f=(0,l().K8)((()=>o.state||x),[o,x]);return(0,W.jsx)(A().Ay,{open:x,placementToOrigin:O().UV.Bottom,alignmentToOrigin:O().MY.Start,popupType:s.device.isMobile?a?A().nl.BottomSheet:A().nl.SlideUp:A().nl.Popup,bottomSheetInitialState:"half",origin:(0,W.jsx)(v().A,{tag:h().p,visible:f,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},iconLeading:c().plusSmallIcon,size:"sm",isLightGray:!0,hovered:x,onClick:g,style:{fontSize:14,borderRadius:12,paddingLeft:5,paddingRight:9,marginRight:12},children:(0,W.jsx)(u().sA,{defaultMessage:"Filter",id:"database.filterBar.addButton.title"})}),render:m,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:d})}},516672:(t,e,o)=>{o.d(e,{S:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("filter",{viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4C2 3.58579 2.33579 3.25 2.75 3.25H13.25C13.6642 3.25 14 3.58579 14 4C14 4.41421 13.6642 4.75 13.25 4.75H2.75C2.33579 4.75 2 4.41421 2 4Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 8C3.75 7.58579 4.08579 7.25 4.5 7.25H11.5C11.9142 7.25 12.25 7.58579 12.25 8C12.25 8.41421 11.9142 8.75 11.5 8.75H4.5C4.08579 8.75 3.75 8.41421 3.75 8Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12C5.5 11.5858 5.83579 11.25 6.25 11.25H9.75C10.1642 11.25 10.5 11.5858 10.5 12C10.5 12.4142 10.1642 12.75 9.75 12.75H6.25C5.83579 12.75 5.5 12.4142 5.5 12Z"})]})})},602141:(t,e,o)=>{o.d(e,{A:()=>g});o(898992),o(354520),o(672577);var n=o(296540),r=()=>o(56366),i=()=>o(959013),l=()=>o(284371),s=()=>o(686526),a=()=>o(859428),c=()=>o(873050),u=()=>o(962730),d=()=>o(377586),p=()=>o(700250),m=o(474848);function S(t){let{id:e,context:l,collectionContextStore:S,collectionSettingsStore:g,onClick:f}=t;const y=(0,o(484714).v3)(),v=(0,o(401497).DP)(),h=(0,o(963589).X)("nds_default_property_noticon"),{filter:C,isReadOnly:j}=(0,r().K8)((()=>{const t=function(t,e){const o=e.currentPropertyFiltersStore.state;return o.find((e=>e.id===t))}(e,S);return{filter:t,isReadOnly:Boolean(t&&(0,c().vu)(t.id))}}),[S,e]),b=(0,r().K8)((()=>{const t=S.localStateDiffStore.state;return t.filters.updated.includes(e)||t.filters.added.includes(e)}),[S,e]),k=(0,r().K8)((()=>S.collectionViewStore()),[S]),A=(0,r().O$)(S.normalizedSchemaStore),_=(0,r().K8)((()=>g.state.open),[g]),M=(0,r().K8)((()=>C&&C.id===c().Oe),[C]),T=(0,n.useCallback)((t=>{t&&(0,o(253579).Rp)(t.target)||s().os({collectionSettingsStore:g})}),[g]),w=(0,n.useCallback)((()=>{var t;f&&f(null==C?void 0:C.id),C&&(g.state.open?s().os({collectionSettingsStore:g}):s().R8({collectionSettingsStore:g,item:{type:"filter"}}),(0,o(436696).X)({environment:y,collectionContextStore:S,action:"click_property_filter",original_view_type:void 0,property_type:null==S||null===(t=S.collectionStore())||void 0===t||null===(t=t.getSchema()[C.filter.property])||void 0===t?void 0:t.type}))}),[S,g,y,C,f]),I=(0,n.useCallback)(((t,e)=>{if(!k||!C)return null;const n=C.filter,r=!(0,o(289915).t_)(n),i=A[n.property],l=(null==i?void 0:i.icon)&&(0,o(278238).T8)(i.icon),s=(0,o(700251).xI)({size:"sm",type:l?"custom":"system",isMobile:y.device.isMobile});return(0,m.jsx)(o(56394).A,{icon:i&&(0,m.jsx)(o(743176).zB,{type:i.type,icon:i.icon,size:s,theme:v,style:{fill:"currentColor",marginRight:5},isDefaultNoticonEnabled:h}),title:r?(0,m.jsx)(o(704452).A,{propertyFilter:n,schema:A,style:x(),parentStore:k}):(0,m.jsx)("span",{style:x(),children:null==i?void 0:i.name}),on:r,hasDiff:b,disabled:e,hideChevron:e,onClick:w,...t},C.id)}),[h,k,y,C,w,b,A,v]),B=(0,n.useCallback)((()=>M?(0,m.jsx)(a().A,{placement:u().W.Bottom,render:t=>I(t,!0),renderTooltip:()=>(0,m.jsx)(i().sA,{id:"database.filterBarPropertyFilter.cannotConfigureSubitemDisplayMode",defaultMessage:"To modify this filter, first change the subitem display mode."})}):(0,m.jsx)(a().A,{placement:u().W.Bottom,render:t=>I(t,!0),renderTooltip:()=>(0,m.jsx)(i().sA,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[I,M]),F=(0,n.useCallback)((()=>k&&C?(0,m.jsx)(o(866913).q,{collectionContextStore:S,collectionSettingsStore:g,collectionViewStore:k,context:l,filter:C,schema:A}):null),[S,g,k,l,C,A]);return j?B():(0,m.jsx)(o(897119).Ay,{popupType:y.device.isMobile?d().n.SlideUp:d().n.Popup,placementToOrigin:p().UV.Bottom,alignmentToOrigin:p().MY.Start,open:_,origin:j?B():I(void 0,!1),onDismiss:T,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:F,trapFocus:!0})}const g=n.memo(S,o(821062).A);function x(){return{maxWidth:180,...l().RC}}},643381:(t,e,o)=>{o.d(e,{l:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},658199:(t,e,o)=>{o.d(e,{A:()=>Zt});var n=o(296540),r=()=>o(56366),i=()=>o(484714),l=()=>o(401497),s=()=>o(959013),a=()=>o(284371),c=()=>o(73223),u=()=>o(244091),d=(o(898992),o(354520),o(581454),()=>o(725252)),p=()=>o(757695),m=()=>o(584262),S=()=>o(66689),g=()=>o(784892),x=()=>o(597777),f=()=>o(869190),y=()=>o(668725),v=()=>o(212050),h=()=>o(689094),C=()=>o(643381),j=()=>o(696706),b=()=>o(179034),k=()=>o(864779),A=()=>o(919709),_=()=>o(381349),M=()=>o(496603),T=()=>o(534177),w=()=>o(720665),I=()=>o(857783),B=()=>o(813297),F=()=>o(862292),R=()=>o(476492),P=()=>o(722872),D=()=>o(71304),O=()=>o(685889),L=()=>o(645873),V=()=>o(778708),K=()=>o(679924);function N(t,e){(0,K().v)(t,"complete_sprint_action",e)}var U=()=>o(765957),H=()=>o(764218),z=()=>o(630116),E=()=>o(239391),W=()=>o(493823),Y=()=>o(760217),$=()=>o(406699),J=()=>o(285790),X=()=>o(710149),q=()=>o(928600),G=()=>o(939740),Q=()=>o(480095),Z=()=>o(204063),tt=()=>o(187820),et=()=>o(16006),ot=()=>o(89924),nt=()=>o(427711),rt=()=>o(641514),it=()=>o(719147),lt=()=>o(881690),st=o(474848);const at=(0,s().YK)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function ct(t){let{onDismiss:e,...o}=t;const{isOpen:r}=o,l=(0,i().v3)(),s=(0,n.useId)(),a=t=>{e();let n=!1;(0,T().Gv)(t)&&(0,T().O9)(t.clickedCancel)&&(n=!0===t.clickedCancel),N(l,{...(0,R().sl)(o.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,st.jsx)(rt().A,{ariaLabelledBy:s,isOpen:r,onDismiss:()=>a(),render:()=>(0,st.jsx)(ut,{...o,onDismiss:a,titleAriaId:s})})}function ut(t){var e;const{completeSprintAutomationContext:o,setIsLoading:l,taskCollectionContextStore:a,onDismiss:c,completeSprintAutomationState:u,onAutomationComplete:m,titleAriaId:S}=t,{currentSprintId:g,querySprintsResult:f,currentSprintTaskSummary:y}=u,v=(0,s().tz)(),h=(0,i().v3)(),{isMobile:C}=(0,i().Y0)(),{value:j}=(0,L().fJ)(F().T.formulas),{value:A}=(0,L().fJ)(B().QV.automationTypecheck),{value:_}=(0,L().fJ)(B().QV.automationActionRegistry),M=(0,r().K8)((()=>U().default.state.currentUserSettingsStore),[]),T=(0,r().K8)((()=>o.sprintCollectionStore),[o]),I=(0,r().K8)((()=>{var t;const e=null===(t=o.automationContext)||void 0===t?void 0:t.automationStore;return null==e?void 0:e.getRecurrence()}),[o]),R=(0,r().K8)((()=>{var t;return(null===(t=o.automationContext)||void 0===t||null===(t=t.automationActionStore.getConfig())||void 0===t?void 0:t.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(e=o.automationContext)||void 0===e?void 0:e.automationActionStore]),P=(0,r().K8)((()=>T.getSpaceId()),[T]),O=(0,r().K8)((()=>{if(g)return z().Bv.createChildStore(T,{id:g,table:b().ev,spaceId:T.getSpaceId()})}),[g,T]),V=(0,r().K8)((()=>O?(0,D().tS)({intl:v,environment:h,store:O,untitledFallback:at.fallbackSprintName}):v.formatMessage(at.fallbackSprintName)),[O,v,h]),K=(0,r().K8)((()=>xt({sprintBlockStore:O,sprintCollectionStore:T})),[O,T]),N=(0,r().K8)((()=>ft({sprintDateRange:K,intl:v})),[K,v]),[H,E]=n.useState(),Y=(0,r().K8)((()=>p().Store.createValue(R)),[R]),$=n.useMemo((()=>{if(!I||null==K||!K.end_date)return;const t=(0,k().Vv)(I);return t?(0,k().Z3)({currentSprintEndDate:K.end_date,sprintSchedule:t}):void 0}),[I,null==K?void 0:K.end_date]),J=(0,r().K8)((()=>{if("pointer"!==(null==H?void 0:H.type))return;return xt({sprintBlockStore:z().Bv.createChildStore(T,H.pointer),sprintCollectionStore:T})}),[H,T]),[X,q]=n.useState(void 0),G=n.useMemo((()=>{if(X&&(0,x().oM)(X))return X}),[X]),Q=n.useMemo((()=>{if(!f)return;const{nextSprintIds:t,futureSprintIds:e}=f;return t.length>0?t:e}),[f]),tt=(0,r().K8)((()=>{if(void 0===Q)return;const t=Q[0];return t?{type:"pointer",pointer:{id:t,table:b().ev,spaceId:P}}:{type:"actionId"}}),[Q,P]),et=(0,r().K8)((()=>{var t;return!Boolean(null==M||null===(t=M.getSettings())||void 0===t?void 0:t.seen_sprint_settings_engagement_banner)}),[M]);n.useEffect((()=>{tt&&E(tt)}),[tt,E]),n.useEffect((()=>{q(J??$)}),[J,$,q]);const ot=n.useCallback((async()=>{if(c(),!(j&&A&&_&&H&&G&&o.automationContext))return;l(!0);const t=0===(null==y?void 0:y.incompleteTaskCount)?"complete_sprint":Y.state;if(!o.automationContext)return;const e={type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:t,nextSprintDateRange:G},automationStore:o.automationContext.automationStore,intl:v,parentRecordStore:o.currentCollectionViewBlockStore,formulasModule:j,isLoggedIn:h.currentUser.isLoggedIn(),automationTypecheckModule:A,automationActionRegistryModule:_},n=()=>{m()},{automationExecutionActions:r}=await B().QV.automations.load();await r.executeClientAutomation({environment:h,clientContext:e,onUndo:()=>{l(!0),n(),l(!1)}}),n(),l(!1)}),[c,j,H,G,o.automationContext,o.currentCollectionViewBlockStore,A,_,l,null==y?void 0:y.incompleteTaskCount,Y,v,h,m]),nt=mt({isMobile:C}),{status:rt}=(0,d().L)({value:u,validateLoaded:t=>!1===t.isLoading,waitTimeInMs:Number(w().Xb)});if("pending"!==rt&&u.isLoading)return(0,st.jsx)(dt,{titleAriaId:S,onDismiss:c,sprintCollectionStore:T});if(u.isLoading)return(0,st.jsx)(pt,{titleAriaId:S,onDismiss:c});const{incompleteTaskCount:it}=u.currentSprintTaskSummary,lt=Boolean(H)&&Boolean(G),ct=void 0!==Q&&Q.length>0;return(0,st.jsxs)("div",{style:nt.modalContainer,children:[(0,st.jsx)("div",{style:nt.header,id:S,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:V}})}),(0,st.jsx)(gt,{currentSprintFormattedDateRange:N,currentSprintTaskSummary:y}),et&&(0,st.jsx)(St,{collectionContextStore:a,userSettingsStore:M,onDismissModal:c}),ct&&(0,st.jsxs)("div",{style:nt.flexRow,children:[v.formatMessage(at.selectNextSprintLabel),(0,st.jsx)(jt,{nextSprintInput:H,setNextSprintInput:E,completeSprintAutomationContext:o,sprintPageIds:Q})]}),(0,st.jsxs)("div",{style:nt.flexRow,children:[ct?v.formatMessage(at.selectDatesForNextSprintLabel):v.formatMessage(at.nextSprintDatesLabel),(0,st.jsx)(kt,{sprintDateRange:X,setSprintDateRange:q})]}),it>0&&(0,st.jsxs)("div",{style:nt.flexRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:it}}),(0,st.jsx)(vt,{actionTypeStore:Y})]}),(0,st.jsx)(Z().A,{disabled:!lt,onClick:()=>{ot()},style:nt.button,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:V}})}),(0,st.jsx)(W().p,{onClick:()=>c({clickedCancel:!0}),style:nt.button,children:v.formatMessage(at.cancelButton)})]})}function dt(t){const{onDismiss:e,sprintCollectionStore:o,titleAriaId:n}=t,l=(0,i().v3)(),a=(0,s().tz)(),{isMobile:c}=(0,i().Y0)(),u=(0,r().K8)((()=>o.getParentBlockStore()),[o]),d=mt({isMobile:c});return(0,st.jsxs)("div",{style:d.modalContainer,children:[(0,st.jsx)("div",{style:d.header,id:n,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,st.jsx)(Z().A,{onClick:()=>{u&&I().uK({environment:l,store:u,pageVisitSource:m().y8.LinkInPage})},style:{...d.button,marginTop:24},children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,st.jsx)(W().p,{onClick:e,style:d.button,children:a.formatMessage(at.cancelButton)})]})}function pt(t){const{onDismiss:e,titleAriaId:o}=t,n=(0,s().tz)(),{isMobile:r}=(0,i().Y0)(),l=mt({isMobile:r});return(0,st.jsxs)("div",{style:l.modalContainer,children:[(0,st.jsx)("div",{style:l.header,id:o,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,st.jsx)("div",{style:l.subheader,children:(0,st.jsx)(X().A,{style:l.subheaderShimmer})}),(0,st.jsxs)("div",{style:l.flexRow,children:[n.formatMessage(at.selectNextSprintLabel),(0,st.jsx)(X().A,{style:l.flexRowShimmerBox1})]}),(0,st.jsxs)("div",{style:l.flexRow,children:[n.formatMessage(at.selectDatesForNextSprintLabel),(0,st.jsx)(X().A,{style:l.flexRowShimmerBox2})]}),(0,st.jsxs)("div",{style:l.flexRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,st.jsx)(X().A,{style:l.flexRowShimmerBox3})]}),(0,st.jsx)(Z().A,{disabled:!0,onClick:M().lQ,style:l.button,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,st.jsx)(W().p,{onClick:e,style:l.button,children:n.formatMessage(at.cancelButton)})]})}function mt(t){let{isMobile:e}=t;return(0,l().IS)((t=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:e?a().J.UIRegular.mobile:a().J.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:e?18:16,fontWeight:a().Wy.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:t.text.tertiary,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:t.icon.tertiary},flexRow:{display:"flex",...e?{flexDirection:"column",fontSize:14,color:t.text.secondary}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...e&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...e&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...e&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...e&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...e&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...e&&{...n,border:`1px solid ${t.stroke.secondary}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:t.icon.tertiary,width:12,height:"auto"}}}),[e])}function St(t){const e=(0,s().tz)(),{collectionContextStore:o,userSettingsStore:n,onDismissModal:r}=t,c=(0,i().v3)(),u=(0,l().IS)((t=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:t.palette.blue["light"===t.mode?50:300],borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:t.text.primary},bannerTitle:{fontWeight:a().Wy.regular},icon:{width:12,color:t.blueColor},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:t.text.uiBluePrimary}})),[]);return(0,st.jsxs)("div",{style:u.banner,children:[(0,st.jsx)("div",{style:u.repeatIcon,children:(0,C().l)(u.icon)}),(0,st.jsx)("div",{style:u.bannerContent,children:(0,st.jsx)("div",{style:u.bannerTitle,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return(0,st.jsx)(it().A,{onClick:()=>{n&&(r(),V().cJ({environment:c,userSettingsStore:n}),V().Dl(o))},disableUnderline:!0,style:u.link,children:e})}}})})}),(0,st.jsx)(J().A,{icon:v().u,ariaLabel:e.formatMessage({id:"completeAutomationSprintModal.dismissBannerButton",defaultMessage:"Dismiss banner button"}),style:u.closeButton,onClick:()=>{n&&V().cJ({environment:c,userSettingsStore:n})}})]})}function gt(t){const{currentSprintFormattedDateRange:e,currentSprintTaskSummary:o}=t,{isMobile:n}=(0,i().Y0)(),r=(0,s().tz)(),l=mt({isMobile:n}),a=o?r.formatMessage(at.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=e&&o?(0,st.jsxs)(st.Fragment,{children:[e,(0,st.jsx)("div",{style:l.separator}),a]}):e||a;return void 0===c?null:(0,st.jsx)("div",{style:l.subheader,children:c})}function xt(t){const{sprintBlockStore:e,sprintCollectionStore:o}=t;if(!e)return;const n=o.getPropertyMapping(),r=null==n?void 0:n[S().Hx.Dates];if(!r)return;const i=e.getPropertyValue(r);if(!i)return;const l=(0,A().Cok)(i)[0];return l?(0,x().HB)(l):void 0}function ft(t){const{sprintDateRange:e,intl:o}=t;if(e&&(0,x().oM)(e))return(0,f().ZF)({value:e,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const yt={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function vt(t){const{actionTypeStore:e}=t,{isMobile:o}=(0,i().Y0)(),n=(0,r().O$)(e),l=mt({isMobile:o});return(0,st.jsx)($().Ay,{popupType:o?$().z7.SlideUp:$().z7.Popup,alignmentToOrigin:$().yP.Start,placementToOrigin:$().sx.Bottom,render:t=>(0,st.jsx)(Ct,{actionTypeStore:e,buttonPopupParent:t}),renderOrigin:t=>(0,st.jsxs)(W().p,{...t,style:l.dropdownButton,children:[yt[n],(0,y().b)(l.dropdownChevronIcon)]})})}const ht=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function Ct(t){const{actionTypeStore:e,buttonPopupParent:o}=t,{isMobile:n}=(0,i().Y0)(),l=(0,r().K8)((()=>ht.map((t=>{const n=t===e.state;return{key:t,action:()=>{e.setState(t),o.close()},render:e=>(0,st.jsx)(Y().A,{...e,title:yt[t],isChecked:n})}}))),[e,o]);let s;return s=n?{menuType:P().gu.ActionSheet}:{menuType:P().gu.Popup,maxHeight:"50vh",minWidth:230},(0,st.jsx)(q().A,{...s,children:(0,st.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:l,render:t=>(0,st.jsx)(ot().A,{...t})}]})})}function jt(t){const{nextSprintInput:e,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:a}=t,{sprintCollectionStore:c}=o,{isMobile:u}=(0,i().Y0)(),d=(0,i().v3)(),p=(0,s().tz)(),m=(0,r().K8)((()=>{if(void 0===e)return(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===e.type)return(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===e.type){const t=z().Bv.createChildStore(c,e.pointer);return(0,D().tS)({intl:p,environment:d,store:t,untitledFallback:at.fallbackSprintName})}(0,T().HB)(e)}),[e,p,c,d]),S=mt({isMobile:u}),g=(0,l().IS)((t=>({button:{...void 0===e&&{color:t.text.tertiary}}})),[e]),x={...S.dropdownButton,...g.button};return 0===a.length||1===a.length?(0,st.jsx)(W().p,{style:x,disabled:!0,children:m}):(0,st.jsx)($().Ay,{popupType:u?$().z7.SlideUp:$().z7.Popup,alignmentToOrigin:$().yP.Start,placementToOrigin:$().sx.Bottom,render:t=>(0,st.jsx)(bt,{buttonPopupParent:t,completeSprintAutomationContext:o,sprintPageIds:a,nextSprintInput:e,setNextSprintInput:n}),renderOrigin:t=>(0,st.jsxs)(W().p,{...t,style:x,children:[m,(0,y().b)(S.dropdownChevronIcon)]})})}function bt(t){const{sprintPageIds:e,completeSprintAutomationContext:o,buttonPopupParent:a,nextSprintInput:c,setNextSprintInput:u}=t,{sprintCollectionStore:d}=o,{isMobile:p}=(0,i().Y0)(),m=(0,r().K8)((()=>d.getSpaceId()),[d]),x=(0,r().K8)((()=>(0,O().B7)({collectionStore:o.taskCollectionStore,property:S().yx.TaskToSprintRelation}).filter((t=>t.visible&&("title"===t.property||o.sprintCollectionSchema[t.property])))),[o]),f=(0,r().K8)((()=>new(H().A)),[]),y=(0,l().IS)((t=>({plusIcon:{color:t.icon.tertiary,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...p&&{marginRight:12}}})),[p]),v="purple",C=(0,l().DP)(),k=(0,_().LD)(C,v),A=n.useMemo((()=>{const t="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{u({type:"actionId"}),a.close()},render:e=>(0,st.jsx)(Y().A,{...e,icon:(0,h().W)(y.plusIcon),title:(0,st.jsxs)("div",{style:y.createSprintRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,st.jsx)(lt().A,{isRound:!0,showRemoveButton:!1,value:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:g().NY.Medium,isSingle:!0,color:k.textColor,backgroundColor:k.backgroundColor,showColoredDot:v})]}),isChecked:t})}}),[c,a,u,y,k]),M=(0,r().K8)((()=>e.map((t=>{const e={id:t,table:b().ev,spaceId:m},o=z().Bv.createChildStore(d,e),n=o.getIcon(),r="pointer"===(null==c?void 0:c.type)&&j().L3.isEqual(c.pointer,e);return{key:t,action:()=>{u({type:"pointer",pointer:e}),a.close()},render:t=>(0,st.jsx)(Y().A,{...t,icon:n&&(0,st.jsx)(tt().B6,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,st.jsx)("div",{style:y.sprintRow,children:x.map((t=>"title"===t.property?(0,st.jsx)(et().A,{store:o,style:y.recordTitle},"title"):(0,st.jsx)(E().q,{store:o,property:t.property,disabled:!1,locked:!1,format:"relation",tableWrap:!1,blockPropertyValueOverlayStore:f,collectionStore:d},t.property))).filter(T().O9)}),isChecked:r})}}))),[d,f,a,c,x,m,u,y,e]),w=[{key:"sprints",items:n.useMemo((()=>M.length>0?M:[A]),[M,A]),render:t=>(0,st.jsx)(ot().A,{...t})}];let I;return I=p?{menuType:P().gu.ActionSheet}:{menuType:P().gu.Popup,maxHeight:"50vh",minWidth:230},(0,st.jsx)(q().A,{...I,children:(0,st.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:0,sections:w})})}function kt(t){const{sprintDateRange:e,setSprintDateRange:o}=t,r=(0,s().tz)(),{isMobile:a}=(0,i().Y0)(),c=n.useMemo((()=>ft({sprintDateRange:e,intl:r})),[e,r]),u=mt({isMobile:a}),d=(0,l().IS)((t=>({button:{...!c&&{color:t.text.tertiary}}})),[c]),p=(0,n.useMemo)((()=>c||(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[c]);return(0,st.jsx)($().Ay,{popupType:a?$().z7.SlideUp:$().z7.Popup,alignmentToOrigin:$().yP.Start,placementToOrigin:$().sx.Bottom,render:t=>(0,st.jsx)(At,{sprintDateRange:e,setSprintDateRange:o,onDismiss:()=>{t.close()}}),renderOrigin:t=>(0,st.jsxs)(W().p,{...t,style:{...u.dropdownButton,...d.button},children:[p,(0,y().b)(u.dropdownChevronIcon)]})})}function At(t){const{sprintDateRange:e,setSprintDateRange:o,onDismiss:r}=t,{isMobile:l}=(0,i().Y0)(),a=n.useMemo((()=>({starting:null!=e&&e.start_date?{type:"date",start_date:e.start_date}:void 0,ending:null!=e&&e.end_date?{type:"date",start_date:e.end_date}:void 0})),[e]);let c;return c=l?{menuType:P().gu.Modal,right:(0,st.jsx)(Q().DoneMenuText,{}),onClickRight:r}:{menuType:P().gu.Popup,maxHeight:"50vh",paddingTop:6},(0,st.jsxs)(q().A,{...c,children:[(0,st.jsx)(ot().A,{children:(0,st.jsx)(nt().A,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:a,onUpdate:t=>{var e,n;if(t.error)return;const r={...a,...t.value},i=null===(e=r.starting)||void 0===e?void 0:e.start_date,l=null===(n=r.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:i,end_date:l})},onDismiss:r})}),(0,st.jsx)(ot().A,{topBorder:!0,children:(0,st.jsx)(Y().A,{focused:!1,onClick:()=>{o(void 0)},title:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}o(672577);var _t=()=>o(416504),Mt=()=>o(187174),Tt=()=>o(799829),wt=()=>o(449506),It=()=>o(950914),Bt=()=>o(374562);function Ft(t){if(!t)return;if("aggregation"!==t.type)return;if("text"!==t.aggregationResult.type)return;const e=t.aggregationResult.value,o=null==e?void 0:e.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),r=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:r-n,totalTaskCount:r,completedTaskPercent:0===r?0:n/r}}function Rt(t){if(!t)return;const e=t.getPropertyMapping(),o=null==e?void 0:e[S().yx.TaskToSprintRelation];if(!o)return;return Bt().jj.filter.property=o,{...Bt().jj.filter,property:o}}function Pt(t,e){if(!e)return;const o=e.getPropertyMapping(),n=Rt(e);if(!n)return;const r=null==o?void 0:o[S().yx.Status];if(!r)return;const i=e.getSchema()[r];if(!i||"status"!==i.type)return;const l=(0,It().Q6)(t,i);return l?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:l},property:r}}:void 0}class Dt extends p().Store{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(t){const{querySprintsResult:e,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):t?this.setState({...this.state,currentSprintId:t}):this.setState({...this.state,isLoading:!0,currentSprintId:t})}updateNextAndFutureSprints(t){const{currentSprintId:e,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):t?this.setState({...this.state,querySprintsResult:t}):this.setState({...this.state,isLoading:!0,querySprintsResult:t})}updateCurrentSprintTaskSummary(t){const{currentSprintId:e,querySprintsResult:o}=this.state;void 0!==e&&void 0!==o&&void 0!==t?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:o,currentSprintTaskSummary:t}):t?this.setState({...this.state,currentSprintTaskSummary:t}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:t})}}const Ot=Dt;function Lt(t){const{taskCollectionContextStore:e,completeSprintAutomationContext:o,children:l,isModalOpen:a}=t,{sprintCollectionStore:c}=o,u=c.id,d=(0,i().v3)(),p=(0,r().K8)((()=>new Ot),[]),m=(0,r().K8)((()=>p.state),[p]),g=(0,r().K8)((()=>{var t;const o=e.relativeVariableStore.state;return null==o||null===(t=o[u])||void 0===t?void 0:t.current}),[u,e]);n.useEffect((()=>{p.updateCurrentSprint(g)}),[g,p]);const[{value:x}]=(0,Mt().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n}=t,{sprintCollectionStore:r}=n,i=function(t){var e,o;const{sprintCollectionStore:n,sprintCollectionSchema:r}=t,i=n.getPropertyMapping(),l=null==i?void 0:i[S().Hx.StatusV2];if(!l)return;const s=r[l];if(!s||"status"!==s.type)return;const a=null===(e=s.options)||void 0===e||null===(e=e.find((t=>t.id===S().tO)))||void 0===e?void 0:e.value,c=null===(o=s.options)||void 0===o||null===(o=o.find((t=>t.id===S().Jd)))||void 0===o?void 0:o.value;if(!a||!c)return;const u=Tt().n$[S().av].next.reducer.getCombinatorFilter(r);if(!u)return;const d={type:"results",filter:u,limit:Vt},p={type:"results",filter:{operator:"and",filters:[{property:l,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:Vt};return{[S().tO]:d,[S().Jd]:p}}(n),l=r.getPropertyMapping(),s=null==l?void 0:l[S().Hx.Dates],a=null==l?void 0:l[S().Hx.UniqueId];if(!i||!s||!a)return;const c={userId:o.currentUser.id,userTimeZone:(0,_t().P)(),searchQuery:void 0,sort:[{property:s,direction:"ascending"},{property:a,direction:"ascending"}],reducers:i},u=null===(e=r.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],d=r.getSpaceId();if(!u)return;const p=await wt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:r.id,spaceId:d},collectionView:{id:u.id,spaceId:d},loader:c},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==p.type)return;const m=p.data.result.reducerResults[S().tO],g=p.data.result.reducerResults[S().Jd];if("results"!==m.type||"results"!==g.type)return;const x=m.blockIds,f=g.blockIds;return{nextSprintIds:x,futureSprintIds:f}}({environment:d,completeSprintAutomationContext:o})),[g,d,o]);n.useEffect((()=>{p.updateNextAndFutureSprints(x)}),[x,p]);const f=(0,s().tz)(),[{value:y}]=(0,Mt().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n,intl:r}=t,{taskCollectionStore:i}=n,l=Pt(r,i);if(!l)return;const s=Rt(i);if(!s)return;const a={filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,_t().P)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:l}},c=null===(e=i.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],u=i.getSpaceId();if(!c)return;const d=await wt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:i.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:a},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==d.type)return;return Ft(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({intl:f,environment:d,completeSprintAutomationContext:o})),[g,d,o,a]);return n.useEffect((()=>{p.updateCurrentSprintTaskSummary(y)}),[y,p]),(0,st.jsx)(st.Fragment,{children:l({completeSprintAutomationState:m,onAutomationComplete:()=>{p.reset()}})})}const Vt=5;var Kt=()=>o(864943),Nt=()=>o(739135),Ut=()=>o(101981),Ht=()=>o(873050),zt=()=>o(67775);function Et(t){const{percentage:e}=t;return(0,st.jsx)(zt().l,{numberValue:e,numberFormat:void 0,numberPrecision:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}const Wt=function(t){const{isLoading:e,taskSummary:n,styles:r}=t;return(0,st.jsx)("div",{style:{width:16,height:"auto",...r},children:e?(0,st.jsx)(o(331542).A,{}):(0,st.jsx)(Et,{percentage:(null==n?void 0:n.completedTaskPercent)??0})})};function Yt(t){const{taskCollectionContextStore:e,children:o}=t,n=(0,r().K8)((()=>(0,Ht().y_)(e)),[e]),i=(0,r().K8)((()=>e.collectionStore()),[e]),l=(0,s().tz)(),a=(0,r().K8)((()=>Pt(l,i)),[i,l]);return!a||n?null:(0,st.jsx)(Ut().A,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:e,reducer:a,render:t=>{const e=Ft(t.state);return e?(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)($t,{currentSprintTasksInView:e}),o(e)]}):null}})}function $t(t){const{currentSprintTasksInView:e}=t,o=(0,l().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:t.text.tertiary,fontSize:a().J.UIRegular.desktop,fontWeight:a().Wy.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,i().Y0)();return n?null:(0,st.jsxs)("div",{style:o.summary,children:[(0,st.jsx)(Wt,{styles:{paddingTop:1},isLoading:!1,taskSummary:e}),(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:e.completedTaskCount,totalTaskCount:e.totalTaskCount}})]})}function Jt(t){const{collectionContextStore:e,completeSprintAutomationContext:o}=t,l=(0,i().v3)(),[s,a]=n.useState(!1),[u,d]=n.useState(!1),p=n.useCallback((()=>{d(!1)}),[d]),m=(0,r().K8)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),S=(0,r().K8)((()=>U().default.state.currentUserSettingsStore),[]),g=()=>{d(!0);"complete-sprint-button-tooltip"===(0,Nt().gt)(S,"sprints-onboarding")&&c().tutorialGoToNextStep(l,"sprints-onboarding"),N(l,{...(0,R().sl)(e),action:"open_modal"})};return m?(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)(Lt,{completeSprintAutomationContext:o,taskCollectionContextStore:e,isModalOpen:u,children:t=>{let{completeSprintAutomationState:n,onAutomationComplete:r}=t;return(0,st.jsx)(ct,{completeSprintAutomationContext:o,isOpen:u,onDismiss:p,setIsLoading:a,taskCollectionContextStore:e,completeSprintAutomationState:n,onAutomationComplete:r})}}),(0,st.jsx)(Yt,{taskCollectionContextStore:e,children:()=>(0,st.jsx)(Xt,{taskCollectionContextStore:e,onClick:g,isLoading:s})})]}):null}function Xt(t){const{taskCollectionContextStore:e,onClick:o,isLoading:c}=t,{isPhone:d}=(0,i().Y0)(),p=n.useRef(null),m=function(t){const{isPhone:e}=t;return(0,l().IS)((t=>({button:{height:26,marginLeft:8,fontWeight:a().Wy.medium,...e&&{flexGrow:1,borderRadius:8,height:44}}})),[e])}({isPhone:d}),S=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),g=(0,r().O$)(U().AppStoreCurrentSpaceStore),x=(0,r().K8)((()=>null==S?void 0:S.getSpaceId()),[S]);if(!S)return(0,st.jsx)(st.Fragment,{});const f=x===(null==g?void 0:g.id);return(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)(Kt().A,{size:"lg",ref:p,onClick:o,style:m.button,disabled:c,disabledFeedback:c,children:(0,st.jsx)(s().sA,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),f&&(0,st.jsx)(u().rY,{origin:p})]})}var qt=()=>o(244641);function Gt(t){var e;const{collectionContextStore:o,sprintAutomationContext:n}=t,s=(0,l().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:17,columnGap:5,color:t.text.tertiary,fontSize:a().J.UIRegular.desktop,fontWeight:a().Wy.regular,whiteSpace:"nowrap"},icon:{width:16,height:"auto",paddingTop:2}})),[]),{isPhone:c}=(0,i().Y0)(),u=(0,r().K8)((()=>{var t;const e=null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.getRunAt();if(!e)return;const o=qt().c9.fromMillis(e,{zone:"utc"}).toLocal().startOf("day"),r=qt().c9.now().startOf("day"),i=o.diff(r,"days").days;return i<1?"soon":1===i?"today":2===i?"tomorrow":i-1}),[null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return u?(0,st.jsx)(Yt,{taskCollectionContextStore:o,children:()=>c?null:(0,st.jsxs)("div",{style:s.summary,children:[(0,C().l)(s.icon),(0,st.jsx)(Qt,{daysRemaining:u})]})}):null}function Qt(t){const{daysRemaining:e}=t;return"soon"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:e}})}const Zt=function(t){var e;const{collectionContextStore:o}=t,n=(0,r().K8)((()=>o.completeSprintButtonContextStore.state),[o]),i=(0,r().K8)((()=>{var t;return Boolean(null==n||null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.isActive())}),[null==n||null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return n?i?(0,st.jsx)(Gt,{collectionContextStore:o,sprintAutomationContext:n}):(0,st.jsx)(Jt,{collectionContextStore:o,completeSprintAutomationContext:n}):null}},704452:(t,e,o)=>{o.d(e,{A:()=>A});o(898992),o(354520),o(581454),o(296540);var n=()=>o(56366),r=()=>o(799288),i=()=>o(289915),l=()=>o(597777),s=()=>o(681873),a=()=>o(799829),c=()=>o(179034),u=()=>o(824862),d=()=>o(519831),p=()=>o(437607),m=()=>o(798880),S=()=>o(695608),g=()=>o(959013),x=()=>o(496603),f=()=>o(534177),y=()=>o(284371),v=()=>o(16006),h=()=>o(654734),C=()=>o(205098),j=()=>o(963589),b=()=>o(630116),k=o(474848);const A=function(t){let{schema:e,propertyFilter:r,parentStore:l,valueOnly:s,style:a}=t;const c=(0,n().K8)((()=>{const t=e[r.property];if(t&&(0,o(970013).nC)(t))return(0,o(685889).LQ)(t,l)}),[e,r,l]),{filter:u}=r,d=(0,i().s1)(u)?u.subfilter:u,p=(0,i().My)(d)&&!(0,i().fZ)(u),m={...a,maxWidth:void 0};return(0,k.jsx)("span",{style:(0,i().nM)(d)?m:a,children:(0,k.jsx)(g().sA,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:s?void 0:(0,k.jsx)(M,{propertyFilter:r,schema:e}),colonSeparator:s||p?void 0:":",filterOperator:(0,k.jsx)(T,{propertyFilter:r}),propertyValue:(0,k.jsx)(I,{propertyFilter:r,schema:e,parentStore:l,relatedCollectionAppConfigUri:c})}})})};function _(){return(0,k.jsx)(g().sA,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function M(t){let{propertyFilter:e,schema:o}=t;const n=o[e.property];return n?(0,k.jsx)("span",{style:{fontWeight:y().Wy.medium},children:n.name}):null}function T(t){let{propertyFilter:e}=t;const{filter:o}=e,n=(0,i().s1)(o)?o.subfilter:o;if((0,i().YH)(n))return"string_contains"===n.operator||"string_is"===n.operator?null:"string_does_not_contain"===n.operator||"string_is_not"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().My)(n))return(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().Ui)(n)){if("checkbox_is_not"===n.operator)return(0,k.jsx)(_,{})}else{if((0,i().v0)(n))return"enum_is"===n.operator?null:"enum_is_not"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().as)(n))return"enum_contains"===n.operator?null:"enum_does_not_contain"===n.operator?(0,k.jsx)(_,{}):"enum_contains_all"===n.operator?null:(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().H$)(n))return"status_is"===n.operator?null:"status_is_not"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().Pq)(n))return"relation_contains"===n.operator?null:"relation_does_not_contain"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().I_)(n))return"person_contains"===n.operator?null:"person_does_not_contain"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});if((0,i().G)(n)){if("location_is"===n.operator)return null;if("location_is_not"===n.operator)return(0,k.jsx)(_,{})}else if((0,i().nM)(n)){if("date_is"===n.operator)return null;if("date_is_after"===n.operator)return(0,k.jsx)(g().sA,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===n.operator)return(0,k.jsx)(g().sA,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===n.operator)return(0,k.jsx)(g().sA,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===n.operator)return(0,k.jsx)(g().sA,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,i().Cw)(n))return(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});{const t=n.value;if(!t.value||"exact"!==t.type||!(0,l().jS)(t.value))return(0,k.jsx)(k.Fragment,{children:(0,C().kz)(t)});if(t.value.start_date&&t.value.end_date)return null;if(t.value.start_date)return(0,k.jsx)(g().sA,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(t.value.end_date)return(0,k.jsx)(g().sA,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,i().uU)(n))return"verification_is"===n.operator?null:"verification_is_not"===n.operator?(0,k.jsx)(_,{}):(0,k.jsx)(k.Fragment,{children:(0,C().J)(n.operator)});(0,f().HB)(n)}}return null}function w(t){let{index:e}=t;return(0,k.jsx)("span",{style:{whiteSpace:"pre"},children:(0,k.jsx)(g().sA,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},e)}function I(t){let{propertyFilter:e,schema:o,parentStore:n,relatedCollectionAppConfigUri:r}=t;const{filter:u}=e,p=(0,i().s1)(u)?u.subfilter:u;if(!(0,i().gc)(p))return null;if((0,i().YH)(p)||(0,i().My)(p)){const t=p.value.value;if(void 0!==t)return(0,k.jsx)("span",{children:t})}else if((0,i().Ui)(p)){const t=p.value.value;if(!0===t)return(0,k.jsx)("span",{children:(0,k.jsx)(g().sA,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===t)return(0,k.jsx)("span",{children:(0,k.jsx)(g().sA,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,i().v0)(p)||(0,i().as)(p)){const t=(0,i().v0)(p)?(0,i().Zl)(p):(0,i().SM)(p),e=x().oE(t.map((t=>{let{value:e}=t;return e})));return 0===e.length?null:(0,k.jsx)("span",{children:(0,s().A)(e,(t=>(0,k.jsx)(w,{index:t})))})}if((0,i().H$)(p)){const t=(0,i().V6)(p),e=x().oE(t.map((t=>{let{value:e}=t;return e})));return 0===e.length?null:(0,k.jsx)("span",{children:(0,s().A)(e,(t=>(0,k.jsx)(w,{index:t})))})}if((0,i().Pq)(p)){const t=(0,i().Rh)(p),e=x().oE(t.map(((t,e)=>{if(!t.value)return null;const o=t.type;if("exact"===o){const e=b().Bv.createChildStore(n,{table:c().ev,id:t.value});return(0,k.jsx)(v().A,{style:{display:"inline"},store:e},t.value)}if("relative"===o){var i;if("builtin"===t.value.type)return r?(0,k.jsx)("span",{children:(0,k.jsx)(g().sA,{...null===(i=a().n$[r])||void 0===i||null===(i=i[t.value.variable])||void 0===i?void 0:i.messageDescriptor})},e):null;if("current_page_in_related_collection"===t.value.type)return(0,k.jsx)("span",{children:(0,k.jsx)(g().sA,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"})},e)}else(0,f().HB)(o)})));return(0,k.jsx)(k.Fragment,{children:(0,s().A)(e,(t=>(0,k.jsx)(w,{index:t})))})}if((0,i().I_)(p))return(0,k.jsx)(B,{useFilter:p,parentStore:n});if((0,i().G)(p)){const t=(0,i().GK)(p),e=x().oE(t.map((t=>{if(t.value){const e=t.value,o=b().sk.createChildStore(n,{table:d().Vl,id:e});return(0,k.jsx)(v().A,{style:{display:"inline"},store:o},e)}})));return(0,k.jsx)(k.Fragment,{children:(0,s().A)(e,(t=>(0,k.jsx)(w,{index:t})))})}if((0,i().nM)(p)){const t=o[e.property],n=(t&&"date"===t.type?t.date_format:void 0)||l().vz;let r;if("exact"===p.value.type){const t=p.value;if(t.value)if((0,l().$P)(t.value))r=t.value;else if((0,l().jS)(t.value)){const e=(0,l().dq)(t.value);e&&(r=e.value)}}else if(!(0,i().Cw)(p))return(0,k.jsx)(k.Fragment,{children:(0,C().RR)(p.value)});if(r)return(0,k.jsx)(h().A,{style:{display:"inline"},value:r,dateFormat:n,shortenDateAndRange:!0})}else{if((0,i().uU)(p)){const t=(0,i().ms)(p).filter((t=>{let{value:e}=t;return Boolean(e)})).map(C().w0);return 0===t.length?null:(0,k.jsx)("span",{children:(0,s().A)(t,(t=>(0,k.jsx)(w,{index:t})))})}(0,f().HB)(p)}}return null}function B(t){let{parentStore:e,useFilter:o}=t;const l=(0,g().tz)(),a=(0,i().Wf)(o),c=(0,j().X)("group_mentions_in_person_property_values"),d=(0,n().K8)((()=>x().oE(a.map(((t,o)=>{if("relative"===t.type)return(0,k.jsx)("span",{children:(0,k.jsx)(g().sA,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},o);if(t.value){const i=t.value;if(i.table===m().oo){const t=b().sk.createChildStore(e,{table:i.table,id:i.id});return(0,k.jsx)("span",{children:(0,S().c6)(l,t.getModel())},o)}if(i.table===u().GP){const t=b().sk.createChildStore(e,{table:i.table,id:i.id});return(0,k.jsx)("span",{children:(0,r().Hg)(t.getModel())},o)}if(i.table===p().n&&c){var n;const t=b().sk.createChildStore(e,{table:i.table,id:(0,p().T1)({spaceId:i.spaceId,spacePermissionGroupId:i.id}),spaceId:i.spaceId});return(0,k.jsx)("span",{children:null===(n=t.getModel())||void 0===n?void 0:n.getName()},o)}}})))),[a,e,l,c]);return(0,k.jsx)(k.Fragment,{children:(0,s().A)(d,(t=>(0,k.jsx)(w,{index:t})))})}},866913:(t,e,o)=>{o.d(e,{q:()=>d});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(56366),i=()=>o(436696),l=()=>o(187899),s=()=>o(686526),a=()=>o(859794),c=()=>o(406792),u=o(474848);const d=n.memo((function(t){const{collectionContextStore:e,collectionSettingsStore:d,collectionViewStore:p,context:m,filter:S,schema:g}=t,x=(0,o(484714).v3)(),f=(0,o(963589).X)("db_ux_mobile_filter_sheet"),y=(0,r().K8)((()=>(0,o(37489).H)(e)),[e]),v=(0,r().K8)((()=>{var t;return S?null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type:void 0}),[e,S]),h=(0,n.useCallback)((()=>{o(780054).A.isMobile&&f&&l().H2({environment:x,collectionContextStore:e}),s().os({collectionSettingsStore:d})}),[e,d,x,f]),C=(0,n.useCallback)((t=>{var n;if(!S)return;const r=null===(n=e.remoteResultStore.state)||void 0===n?void 0:n.sizeHint,s=c().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");c().default.DO_NOT_USE_measureAfterNextFlushLegacy(s,{environment:x,getData:()=>o(476492).K6({from:"property_filter",property_type:v,collectionContextStore:e,sizeHintAtStart:r})});const a=S.filter,u=e.currentPropertyFiltersStore.state.map((e=>{if(e.id===S.id){return{...S,filter:{...a,filter:t}}}return e}));l().IU({environment:x,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:u}}}),(0,i().X)({environment:x,collectionContextStore:e,action:"update_property_filter",original_view_type:void 0,property_type:v})}),[e,x,S,v]),j=(0,o(395361).Y)(C,250),b=(0,n.useCallback)((()=>{var t;if(!S)return;const o=e.currentPropertyFiltersStore.state.filter((t=>t.id!==S.id));l().IU({environment:x,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:o}}}),(0,i().X)({environment:x,collectionContextStore:e,action:"delete_property_filter",original_view_type:void 0,property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,x,S]),k=(0,n.useCallback)((()=>{var t;if(!S)return;const{combinatorFilter:n,propertyFilters:r}=(0,o(873050).$4)(e,S);l().IU({environment:x,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:r},combinatorFilter:{value:n}}});const a=m===o(300089).aV.FilterBar?e.filterBarCombinatorFilterSettingsStore:e.filterOptionsCombinatorFilterSettingsStore;s().R8({collectionSettingsStore:a,item:{type:"filter"}}),(0,i().X)({environment:x,collectionContextStore:e,action:"merge_filter_into_combinator",property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,m,x,S]);return(0,u.jsx)(a().td,{collectionViewId:p.id,propertyFilter:S.filter,schema:g,parentStore:p,onChange:C,onChangeDebounced:j,onClose:h,onDelete:b,onAddToCombinatorFilter:k,context:a().mL.PropertyFilter,userCanConfigureFilters:y,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:e})}))},958832:(t,e,o)=>{o.d(e,{l:()=>C});o(898992),o(803949);var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(401497),s=()=>o(516672),a=()=>o(959013),c=()=>o(284371),u=()=>o(436696),d=()=>o(187899),p=()=>o(686526),m=()=>o(59400),S=()=>o(897119),g=()=>o(525432),x=()=>o(253579),f=()=>o(377586),y=()=>o(700250),v=()=>o(56394),h=o(474848);function C(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const l=(0,r().v3)(),[s,a]=(0,i().K8)((()=>[o.state.open,e.currentCombinatorFilterStore.state]),[e,o]),c=(0,n.useCallback)((()=>(0,h.jsx)(m().m$,{context:g().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})),[e,o]),u=(0,n.useCallback)((t=>{var n;t&&(0,x().Rp)(t.target)||(p().os({collectionSettingsStore:o}),a&&0===(null===(n=a.filters)||void 0===n?void 0:n.length)&&d().IU({environment:l,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,combinatorFilter:{value:void 0}}}))}),[e,o,l,a]);return(0,n.useEffect)((()=>()=>p().os({collectionSettingsStore:o})),[]),(0,h.jsx)(S().Ay,{popupType:l.device.isMobile?f().n.SlideUp:f().n.Popup,placementToOrigin:y().UV.Bottom,alignmentToOrigin:y().MY.Start,open:s,origin:(0,h.jsx)(j,{collectionContextStore:e,collectionSettingsStore:o}),onDismiss:u,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function j(t){var e;let{collectionContextStore:o,collectionSettingsStore:d}=t;const m=(0,r().v3)(),S=(0,l().IS)((t=>({icon:{width:void 0,height:m.device.isMobile?14:12,fill:t.blueColor,marginRight:6},title:{maxWidth:180,...c().RC}})),[m.device]),[g,x]=(0,i().K8)((()=>[Boolean(o.localStateDiffStore.state.combinatorFilter),o.currentCombinatorFilterStore.state]),[o]),f=(0,n.useCallback)((()=>{if(!x)return;o.currentPropertyFiltersStore.state.forEach((t=>{const e=o.getFilterOptionsItemSettingsStore(t);p().os({collectionSettingsStore:e})})),p().R8({collectionSettingsStore:d,item:{type:"filter"}}),(0,u().X)({environment:m,collectionContextStore:o,action:"click_combinator_filter"})}),[o,d,m,x]);return x?(0,h.jsx)(v().A,{icon:(0,s().S)(S.icon),title:(0,h.jsx)("span",{style:S.title,children:(0,h.jsx)(a().sA,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=x.filters)||void 0===e?void 0:e.length)||0}})}),on:!0,hasDiff:g,onClick:f},"combinator"):null}}}]);