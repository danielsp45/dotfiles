"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[76793],{867187:(e,n,o)=>{o.r(n),o.d(n,{getFormulaAnalytics:()=>N,getRedactedFormulaAsStringSync:()=>T,getSimpleFormulaAnalytics:()=>F});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(803949);var t=()=>o(534177),i=()=>o(999515),r=()=>o(792071),l=()=>o(247331),c=()=>o(349835),a=()=>o(977345);const s="unknown";function u(e,n){e.mentions.properties[n]??=0,e.mentions.properties[n]++}function d(e,n){e.mentions.variables[n]??=0,e.mentions.variables[n]++}function p(e,n){e.function_names[n]??=0,e.function_names[n]++}function y(e){return"array"===e.type?`array of ${y(e.of)}`:e.type}function f(e,n,o){const{getRecordModel:i,typecheckContextValues:r}=o;switch(e.type){case l().FormulaTokenType.Person:n.mentions.users++;break;case l().FormulaTokenType.Block:n.mentions.pages++;break;case l().FormulaTokenType.BlockProperty:if("collection"in e)if(void 0===e.collection)u(n,e.property);else{const o=i(e.collection),t=null==o?void 0:o.getNormalizedSchema(),r=null==t?void 0:t[(0,a().Yi)(e.property)];u(n,r?r.type:s)}else if(e.contextValueId){const o=(0,a()._H)(r,(0,a().GH)(e.contextValueId));if(o&&"block"===o.type.type&&o.type.collection){const t=i(o.type.collection),r=null==t?void 0:t.getNormalizedSchema(),l=null==r?void 0:r[(0,a().XH)(e.property)];u(n,l?l.type:s)}}else u(n,s);break;case l().FormulaTokenType.ContextValue:{const o=(0,a()._H)(r,(0,a().GH)(e.valueId));null!=o&&o.type?d(n,y(o.type)):d(n,s);break}case l().FormulaTokenType.Date:case l().FormulaTokenType.Checkbox:break;default:(0,t().HB)(e)}}function m(e,n,o){const{getRecordModel:t}=o;if("collection"in e)if(void 0===e.collection)u(n,e.property);else{const o=t(e.collection),i=null==o?void 0:o.getNormalizedSchema(),r=null==i?void 0:i[(0,a().Yi)(e.property)];u(n,r?r.type:s)}else u(n,s)}function k(e,n,o){switch(function(e,n){e.node_kinds[n]??=0,e.node_kinds[n]++}(n,e.kind),e.kind){case c().NM.Number:case c().NM.String:case c().NM.Boolean:case c().NM.Identifier:case c().NM.RecoveryNode:break;case c().NM.Array:case c().NM.LogicalOr:case c().NM.LogicalAnd:e.elements.forEach((e=>k(e,n,o)));break;case c().NM.NotionToken:f(e.token,n,o);break;case c().NM.Conditional:k(e.condition,n,o),k(e.expIfTrue,n,o),e.expIfFalse&&k(e.expIfFalse,n,o);break;case c().NM.Equality:case c().NM.Relational:case c().NM.Additive:case c().NM.Multiplicative:case c().NM.Exponentiation:k(e.lhs,n,o),k(e.rhs,n,o);break;case c().NM.Unary:k(e.expression,n,o);break;case c().NM.Call:k(e.expression,n,o),e.expression.kind===c().NM.Identifier?p(n,e.expression.text):e.expression.kind===c().NM.UnifiedFunctionProperty&&p(n,e.expression.name),e.arguments.forEach((e=>k(e,n,o)));break;case c().NM.UnifiedFunctionProperty:k(e.expression,n,o);break;case c().NM.MemberBlockProperty:k(e.expression,n,o),m(e.propertyToken,n,o);break;default:(0,t().HB)(e)}}function N(e,n){const o={function_names:{},mentions:{pages:0,properties:{},users:0,variables:{}},node_kinds:{}},t=n.getRecordModel??r().b4_.constant(void 0);return k(e,o,{...n,getRecordModel:t}),o}function*v(e,n){const{typecheckContextValues:o}=n;if("collection"in e){if(void 0===e.collection)return e.property;{const n=yield*i().q.fetchRecord(e.collection),o=null==n?void 0:n.getNormalizedSchema(),t=null==o?void 0:o[(0,a().Yi)(e.property)];return(null==t?void 0:t.type)??s}}{const n=(0,a()._H)(o,(0,a().GH)(e.contextValueId)),t=null==n?void 0:n.type;if("block"===(null==t?void 0:t.type)&&t.collection){const n=yield*i().q.fetchRecord(t.collection),o=null==n?void 0:n.getNormalizedSchema(),r=null==o?void 0:o[(0,a().Yi)(e.property)];return(null==r?void 0:r.type)??s}}return s}function*M(e){let n;if(void 0===e.collection)n=e.property;else{const o=yield*i().q.fetchRecord(e.collection),t=null==o?void 0:o.getNormalizedSchema(),r=null==t?void 0:t[(0,a().Yi)(e.property)];n=(null==r?void 0:r.type)??s}return`[Property mention - ${n}]`}function*x(e,n){const{typecheckContextValues:o}=n;switch(e.type){case l().FormulaTokenType.Checkbox:return`[Checkbox - ${e.checked.toString()}]`;case l().FormulaTokenType.Person:return"[Person mention]";case l().FormulaTokenType.Block:return"[Page mention]";case l().FormulaTokenType.Date:return"[Date mention]";case l().FormulaTokenType.BlockProperty:return`[Property mention - ${yield*v(e,n)}]`;case l().FormulaTokenType.ContextValue:{const n=(0,a()._H)(o,(0,a().GH)(e.valueId));return n?`[Formula variable mention - ${y(n.type)}]`:"[Formula variable mention - Unknown]"}default:(0,t().HB)(e)}}function h(e,n){return e.expression.kind===c().NM.Identifier&&e.expression.text===n}function b(e,n){let o;for(let t=0;t<e.length;t+=2)o=e[t],o.kind===c().NM.Identifier&&n.add(o.text);return n}function*g(e,n){switch(e.kind){case c().NM.Number:return'"**"';case c().NM.String:return'"*"';case c().NM.Boolean:return e.text;case c().NM.Identifier:return n.variableNames.has(e.text)?"[User created variable]":e.text;case c().NM.RecoveryNode:return"";case c().NM.Array:const o=[];for(const t of e.elements)o.push(yield*g(t,n));return`[${o.join(", ")}]`;case c().NM.LogicalOr:return`${yield*g(e.elements[0],n)} or ${yield*g(e.elements[1],n)}`;case c().NM.LogicalAnd:return`${yield*g(e.elements[0],n)} and ${yield*g(e.elements[1],n)}`;case c().NM.Conditional:return`${yield*g(e.condition,n)} ? ${yield*g(e.expIfTrue,n)} : ${e.expIfFalse?yield*g(e.expIfFalse,n):"undefined"}`;case c().NM.Equality:case c().NM.Relational:case c().NM.Additive:case c().NM.Multiplicative:case c().NM.Exponentiation:return`${yield*g(e.lhs,n)} ${e.op} ${yield*g(e.rhs,n)}`;case c().NM.Unary:return"not"===e.op?`${e.op} ${yield*g(e.expression,n)}`:`${e.op}${yield*g(e.expression,n)}`;case c().NM.Call:{(h(e,"let")||h(e,"lets"))&&b(e.arguments,n.variableNames);const o=[];for(const t of e.arguments)o.push(yield*g(t,n));return`${yield*g(e.expression,n)}(${o.join(", ")})`}case c().NM.UnifiedFunctionProperty:return`${yield*g(e.expression,n)}.${e.name}`;case c().NM.MemberBlockProperty:return`${yield*g(e.expression,n)}.${yield*M(e.propertyToken)}`;case c().NM.NotionToken:return yield*x(e.token,n);default:(0,t().HB)(e)}}function T(e,n){return i().q.runSync(n.getRecordModel,g(e,{typecheckContextValues:n.typecheckContextValues,variableNames:new Set}))}var $=()=>o(919709);function F(e,n){const{getRecordModel:o,typecheckContextValues:t}=n,i={function_names:{},mentions:{pages:0,properties:{},users:0,variables:{}},node_kinds:{}},l=o??r().b4_.constant(void 0);let c,p,f;for(const r of e)if((0,$().qXl)(r))if(c=(0,$().uPN)(r),(0,$().Sev)(c))i.mentions.pages++;else if((0,$().snh)(c))i.mentions.users++;else if(p=(0,$().tVx)(c)){f=p[1],f.id;const e=(0,a()._H)(t,f.id);null!=e&&e.type?d(i,y(e.type)):d(i,s)}else if(p=(0,$().TVE)(c))if(f=p[1],"collection"in f)if(void 0===f.collection)u(i,f.property);else{const e=l(f.collection);if(e){var m;u(i,(null===(m=e.getNormalizedSchema()[f.property])||void 0===m?void 0:m.type)??s)}else u(i,s)}else if("contextValueId"in f){const e=(0,a()._H)(t,f.contextValueId),n=null==e?void 0:e.type;if(n&&"block"===n.type&&n.collection){const e=l(n.collection);if(e){var k;u(i,(null===(k=e.getNormalizedSchema()[f.property])||void 0===k?void 0:k.type)??s)}}else u(i,s)}return i}}}]);