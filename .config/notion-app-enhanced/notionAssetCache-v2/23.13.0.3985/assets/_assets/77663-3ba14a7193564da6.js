"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77663],{5580:(e,t,n)=>{n.d(t,{n:()=>a});var o=()=>n(56366),i=()=>n(209199),r=()=>n(765957);function a(){return(0,o().K8)((()=>{var e;const t=(null===(e=r().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??i().q;return(0,i().o_)(t)}),[])}},62088:(e,t,n)=>{n.d(t,{u:()=>S});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(430670);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(187174),s=()=>n(68263),u=()=>n(798880),l=()=>n(959013),d=()=>n(496603),m=()=>n(763824),c=()=>n(186445),p=()=>n(731320),g=()=>n(645873),y=()=>n(963589),f=()=>n(118789),v=()=>n(106628),M=()=>n(765957),h=()=>n(227440),T=()=>n(375447),C=()=>n(870092),A=()=>n(271084);const x=75,b=4;function S(e){const{query:t,environment:n,intl:S,useMentionMenuStore:w,open:_}=e,I=(0,r().K8)((()=>w?T().Ay.state.open:_),[_,w]),k=(0,r().K8)((()=>!(!e.disabled&&!w)&&!T().Ay.state.mentionTypes.user),[e.disabled,w]),P=(0,r().K8)((()=>Boolean(M().default.state.currentSpaceStore)),[]),R=(0,y().X)("edge_cache_mentions"),[{value:V=[],status:D}]=(0,a().Yb)((async()=>{if(k||R||!I||!P)return[];const e=await async function(e,t,n){if(h().A.state.online){const o=await v().T.searchActions.load();return await o.searchVisibleSpaceUsers({environment:t,query:e,membersOnly:!1,minFuzzyScore:25,placeSelfFirst:o.isPersonalPronoun(e,n)})}return[]}(t,n,S.locale);return e}),[k,R,I,P,t,n,S.locale],{debounce:x}),{results:j,isLoading:K}=function(e){const{query:t,flagEnabled:n,disabled:y,useMentionMenuStore:h,open:b}=e,S=(0,l().tz)(),w=(0,i().v3)(),_=(0,r().K8)((()=>h?T().Ay.state.open:b),[b,h]),I=(0,r().O$)(M().AppStoreCurrentSpaceStore),k=!y&&n&&t.length>0&&I&&_,P=(0,r().K8)((()=>{var e;const t=A().k.getSortedUserIds(),n=null===(e=(0,c()._m)(w))||void 0===e?void 0:e.id;return[...(0,d().oE)([n]),...t]}),[w]),R=(0,r().K8)((()=>{const e=M().default.state.mainEditorCurrentBlockStore;return e?(0,p().i0)(e).flatMap((e=>{let{permissionItem:t}=e;return(0,s().B2)(t)?[t.user_id]:[]})):[]}),[]),V=(0,g().fJ)(v().T.searchActions),[{value:D=[],status:j}]=(0,a().Yb)((async()=>{if(!k||"resolved"!==V.status)return[];const e=(0,d().sb)([...P,...R]),n=V.value;return(await n.searchUsers({environment:w,parentStore:I,query:t,userIds:e,minFuzzyScore:25,placeSelfFirst:n.isPersonalPronoun(t,S.locale)})).slice(0,3)}),[k,V.status,V.value,P,R,w,I,t,S.locale]),K=(0,o.useMemo)((()=>({field:"name_normalized",direction:"asc"})),[]),F=(0,f().n)({query:t,sort:K,filter:void 0,limit:50,disable:!k}),U=(0,r().K8)((()=>(null==F?void 0:F.rowsStore.state.rows)??[]),[F]),[{value:q=[],status:L}]=(0,a().Yb)((async()=>{if(!k)return[];const e=U.sort(((e,t)=>{var n,o;const i=(null===(n=A().k.state)||void 0===n?void 0:n[e.id])??0;return((null===(o=A().k.state)||void 0===o?void 0:o[t.id])??0)-i})),t=await(0,m().lX)(e,Math.max(e.length,1),(async e=>{const t=C().L.createChildStore(I,{table:u().oo,id:e.id});return await t.load(),t.getValue()}));return(0,d().oE)(t)}),[I,k,U],{debounce:x}),E=(0,o.useMemo)((()=>{const e=new Set;return[...D,...q].filter((t=>!e.has(t.id)&&(e.add(t.id),!0)))}),[D,q]),N="pending"===L||"pending"===j;return{results:E,isLoading:N}}({query:t,flagEnabled:R,disabled:k,...w?{useMentionMenuStore:!0}:{useMentionMenuStore:!1,open:!0}}),F=(0,o.useMemo)((()=>R?j:V),[R,V,j]),U=(0,r().K8)((()=>T().Ay.state.emptyQueryUserRequestStore.state.result??[]),[]),q="pending"===(R?K:D);return{results:0===t.length?U.slice(0,b):F.slice(0,20),isLoading:q}}},70423:(e,t,n)=>{n.d(t,{L:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("bellDisabled",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M7 15.2285C6.48047 15.2285 6.02246 15.11 5.62598 14.873C5.23405 14.6406 4.92188 14.333 4.68945 13.9502C4.46159 13.5719 4.33854 13.1618 4.32031 12.7197H1.51074C1.15072 12.7197 0.868164 12.6331 0.663086 12.46C0.462565 12.2822 0.362305 12.0475 0.362305 11.7559C0.362305 11.5143 0.426107 11.2842 0.553711 11.0654C0.681315 10.8421 0.843099 10.6279 1.03906 10.4229C1.23958 10.2178 1.44466 10.015 1.6543 9.81445C1.8138 9.65951 1.93685 9.45671 2.02344 9.20605C2.11003 8.9554 2.17611 8.67969 2.22168 8.37891C2.26725 8.07812 2.30371 7.77051 2.33105 7.45605C2.34017 7.08691 2.36296 6.73828 2.39941 6.41016C2.44043 6.08203 2.49512 5.77669 2.56348 5.49414L3.73926 6.66992C3.71647 6.8431 3.69596 7.02539 3.67773 7.2168C3.66406 7.4082 3.65495 7.60872 3.65039 7.81836C3.63216 8.12826 3.60482 8.41536 3.56836 8.67969C3.5319 8.94401 3.48405 9.18555 3.4248 9.4043C3.36556 9.62305 3.29264 9.81901 3.20605 9.99219C3.12402 10.1654 3.02604 10.3158 2.91211 10.4434C2.80273 10.571 2.68652 10.6963 2.56348 10.8193C2.44499 10.9378 2.33561 11.0472 2.23535 11.1475C2.13965 11.2477 2.06217 11.3275 2.00293 11.3867V11.4688H8.54492L10.0078 12.9385H9.64551C9.59538 13.3532 9.45182 13.7337 9.21484 14.0801C8.98242 14.4264 8.6748 14.7044 8.29199 14.9141C7.91374 15.1237 7.48307 15.2285 7 15.2285ZM7 14.1348C7.38737 14.1348 7.70866 14.0072 7.96387 13.752C8.21908 13.4967 8.35807 13.1527 8.38086 12.7197H5.6123C5.63965 13.1527 5.78092 13.4967 6.03613 13.752C6.29134 14.0072 6.61263 14.1348 7 14.1348ZM4.01953 2.99902C4.15625 2.89421 4.30208 2.7985 4.45703 2.71191C4.61654 2.62533 4.78516 2.55241 4.96289 2.49316C5.09049 2.04199 5.33431 1.66374 5.69434 1.3584C6.05436 1.05306 6.48958 0.900391 7 0.900391C7.50586 0.900391 7.9388 1.05306 8.29883 1.3584C8.65885 1.66374 8.90495 2.04199 9.03711 2.49316C9.9349 2.81673 10.5889 3.41146 10.999 4.27734C11.4137 5.14323 11.6416 6.2666 11.6826 7.64746C11.7008 7.9209 11.7282 8.17383 11.7646 8.40625C11.8011 8.63411 11.849 8.84603 11.9082 9.04199C11.972 9.2334 12.0518 9.41113 12.1475 9.5752C12.2477 9.73926 12.3685 9.89648 12.5098 10.0469C12.7786 10.3021 13.0293 10.5664 13.2617 10.8398C13.4941 11.1133 13.6104 11.4027 13.6104 11.708C13.6104 11.9587 13.5329 12.166 13.3779 12.3301L10.6641 9.55469C10.5911 9.39518 10.5342 9.22884 10.4932 9.05566C10.4567 8.87793 10.4271 8.68424 10.4043 8.47461C10.3815 8.26497 10.361 8.03027 10.3428 7.77051C10.3245 6.80892 10.222 6.04557 10.0352 5.48047C9.84831 4.91081 9.60449 4.4847 9.30371 4.20215C9.00293 3.9196 8.66569 3.72819 8.29199 3.62793C8.20996 3.6097 8.14616 3.5778 8.10059 3.53223C8.05501 3.4821 8.02767 3.41146 8.01855 3.32031C8.00033 2.97396 7.90007 2.69368 7.71777 2.47949C7.54004 2.2653 7.30078 2.1582 7 2.1582C6.69922 2.1582 6.45768 2.2653 6.27539 2.47949C6.0931 2.69368 5.99284 2.97396 5.97461 3.32031C5.97005 3.41146 5.94271 3.4821 5.89258 3.53223C5.84701 3.5778 5.78548 3.6097 5.70801 3.62793C5.57585 3.66439 5.44824 3.70996 5.3252 3.76465C5.20671 3.81934 5.09277 3.88542 4.9834 3.96289L4.01953 2.99902ZM0.615234 2.35645C0.514974 2.25163 0.464844 2.12402 0.464844 1.97363C0.464844 1.81868 0.514974 1.6888 0.615234 1.58398C0.724609 1.47917 0.854492 1.42676 1.00488 1.42676C1.15983 1.42676 1.28971 1.47917 1.39453 1.58398L13.8086 13.9912C13.9134 14.096 13.9658 14.2236 13.9658 14.374C13.9658 14.5244 13.9134 14.6543 13.8086 14.7637C13.7038 14.8685 13.5739 14.9209 13.4189 14.9209C13.2686 14.9209 13.141 14.8685 13.0361 14.7637L0.615234 2.35645Z"})})},79118:(e,t,n)=>{n.d(t,{Eo:()=>M,Fz:()=>p,KI:()=>s,M4:()=>l,YW:()=>C,iY:()=>A,mO:()=>g,qE:()=>d,vm:()=>f});var o=()=>n(604995),i=()=>n(247331),r=()=>n(977345);const a=(0,n(959013).YK)({buttonAutomationCurrentUserDescription:{defaultMessage:"The user who clicked this button",id:"automations.contextValue.buttonAutomationCurrentUserDescription"},buttonAutomationCurrentUserName:{defaultMessage:"Whoever clicked",id:"automations.contextValue.buttonAutomationCurrentUserName"},buttonAutomationCurrentUserTooltip:{defaultMessage:"The person who clicked the button",id:"automations.contextValue.buttonAutomationCurrentUserTooltip"},buttonAutomationThisPageDescription:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageDescription"},buttonAutomationThisPageName:{defaultMessage:"This page",id:"automations.contextValue.buttonAutomationThisPageName"},buttonAutomationThisPageTooltip:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageTooltip"},eventAutomationCurrentUserDescription:{defaultMessage:"The user who made the edit that triggered this automation to run.",id:"automations.contextValue.eventAutomationCurrentUserDescription"},eventAutomationCurrentUserName:{defaultMessage:"Whoever triggered",id:"automations.contextValue.eventAutomationCurrentUserName"},eventAutomationCurrentUserTooltip:{defaultMessage:"The person whose action triggered this automation",id:"automations.contextValue.eventAutomationCurrentUserTooltip"},eventAutomationThisPageDescription:{defaultMessage:"The page that was edited to trigger this automation to run.",id:"automations.contextValue.eventAutomationThisPageDescription"},eventAutomationThisPageName:{defaultMessage:"Trigger page",id:"automations.contextValue.eventAutomationThisPageName"},eventAutomationThisPageTooltip:{defaultMessage:"The page that triggered this automation",id:"automations.contextValue.eventAutomationThisPageTooltip"},now:{id:"automations.triggers.now.label",defaultMessage:"Time triggered"},nowDescription:{id:"automations.triggers.now.description",defaultMessage:"The time when this automation begins to run."},nowTooltip:{id:"automations.triggers.now.tooltip",defaultMessage:"The time this automation was triggered"},pageCreator:{id:"automations.triggers.pageCreator.label",defaultMessage:"Page creator"},pageCreatorDescription:{id:"automations.triggers.pageCreator.description",defaultMessage:"The user who created the page that was edited to trigger this automation to run."},pageCreatorTooltip:{id:"automations.triggers.pageCreator.tooltip",defaultMessage:"Person who created page"},today:{id:"automations.triggers.today.label",defaultMessage:"Date triggered"},todayDescription:{id:"automations.triggers.today.description",defaultMessage:"The date when this automation begins to run."},todayTooltip:{id:"automations.triggers.today.tooltip",defaultMessage:"The date this automation was triggered"}});function s(){return(0,r().$y)({source:"global",global:"button_page"})}function u(e,t,n){return{description:n,name:e,tooltip:t,compile:(o,r)=>({description:n?o.formatMessage(n):void 0,id:s(),kind:i().FormulaContextValueKind.ContextValue,name:o.formatMessage(e),tooltipName:o.formatMessage(t),type:{collection:r,type:"block"}}),evaluate:e=>({kind:i().FormulaContextValueKind.ContextValue,id:s(),value:{type:"block",value:e}})}}const l=u(a.buttonAutomationThisPageName,a.buttonAutomationThisPageTooltip,a.buttonAutomationThisPageDescription),d=u(a.eventAutomationThisPageName,a.eventAutomationThisPageTooltip,a.eventAutomationThisPageDescription);function m(){return(0,r().$y)({source:"global",global:"current_user"})}function c(e,t,n){return{description:n,name:e,tooltip:t,compile:o=>({description:n?o.formatMessage(n):void 0,id:m(),kind:i().FormulaContextValueKind.ContextValue,name:o.formatMessage(e),tooltipName:o.formatMessage(t),type:{type:"person"}}),evaluate:e=>({id:m(),kind:i().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const p=c(a.buttonAutomationCurrentUserName,a.buttonAutomationCurrentUserTooltip,a.buttonAutomationCurrentUserDescription),g=c(a.eventAutomationCurrentUserName,a.eventAutomationCurrentUserTooltip,a.eventAutomationCurrentUserDescription);function y(){return(0,r().$y)({source:"global",global:"now"})}const f={description:a.nowDescription,name:a.now,tooltip:a.nowTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:y(),kind:i().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:y(),kind:i().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,o().KQ)(Date.now(),e)}})};function v(){return(0,r().$y)({source:"global",global:"today"})}const M={description:a.todayDescription,name:a.today,tooltip:a.todayTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:v(),kind:i().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:v(),kind:i().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,o().p6)(Date.now(),e)}})};function h(){return(0,r().$y)({source:"global",global:"page_creator"})}function T(e,t){return{description:a.pageCreatorDescription,name:e,tooltip:t,compile(n){return{description:this.description?n.formatMessage(this.description):void 0,id:h(),kind:i().FormulaContextValueKind.ContextValue,name:n.formatMessage(e),tooltipName:n.formatMessage(t),type:{type:"person"}}},evaluate:e=>({id:h(),kind:i().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const C=T(a.pageCreator,a.pageCreatorTooltip),A=T(a.pageCreator,a.pageCreatorTooltip)},103966:(e,t,n)=>{n.d(t,{Z:()=>d});var o=()=>n(496603),i=()=>n(534177),r=()=>n(416504),a=()=>n(519831),s=()=>n(79118);const u={type:"button",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,contextType:r,getRecordModel:u,intl:l}=e,d=s().Fz.compile(l),m=s().vm.compile(l),c=s().Eo.compile(l),p=t.getParentPointer();let g,y;if("button_block"===r){if(e.pageBlockModel){const t=(0,n(236162).SH)({block:e.pageBlockModel,getRecordModel:u});t&&(g=s().M4.compile(l,t.pointer),y=s().YW.compile(l))}}else if("button_property"===r){const e=u(p);if((null==e?void 0:e.table)!==a().Vl)return{error:new(n(322867).N9)(`Unable to load automation parent: ${n(696706).L3.toKey(p)}`)};g=s().M4.compile(l,e.pointer),y=s().YW.compile(l)}else(0,i().HB)(r);return{value:{valueTypes:(0,o().oE)([d,m,c,g,y])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:n,executingUserTimeZone:i,thisPageBlockModel:a}=t??{},u=a?s().M4.evaluate(a.pointer):void 0,l=null==a?void 0:a.getCreatedByPointer(),d=l?s().YW.evaluate(l):void 0,m=n?s().Fz.evaluate(n):void 0,c=(0,r().P)(),p=s().vm.evaluate(i??c),g=s().Eo.evaluate(i??c);return{value:{values:(0,o().oE)([u,d,m,p,g])}}},isAvailableForContext:e=>!0};n(944114);const l={button:u,event:{type:"event",getCreatePermissions(e){const{parentPointer:t,spacePointer:n}=e;return[{minimumRole:"editor",pointer:t,type:"record_permission"},{minimumRole:"read_and_write",pointer:n,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e,o=[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}],r=t.getTrigger();if("event"===r.type){const e=r.event;(0,i().O9)(e.source)&&"filter"!==e.source.type&&(e.source.type===a().Vl||e.source.type===n(869558).Gy?o.push({minimumRole:"reader",pointer:e.source.pointer,type:"record_permission"}):(0,i().HB)(e.source))}return o},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,intl:n}=e,i=s().mO.compile(n),r=s().iY.compile(n),u=s().vm.compile(n),l=s().Eo.compile(n),d=t.getParentPointer();let m;return d.table===a().Vl&&(m=s().qE.compile(n,d)),{value:{valueTypes:(0,o().oE)([i,r,u,l,m])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:n,executingUserTimeZone:a,thisPageBlockModel:u}=t??{},l=u?s().qE.evaluate(u.pointer):void 0,d=n?s().mO.evaluate(n):void 0,m=(0,r().P)(),c=s().vm.evaluate(a??m),p=null==u?void 0:u.getCreatedByPointer(),g=(0,i().O9)(p)?s().iY.evaluate(p):void 0,y=s().Eo.evaluate(a??m);return{value:{values:(0,o().oE)([l,d,c,y,g])}}},isAvailableForContext:e=>e.hasAccessToSlackAction},recurrence:{type:"recurrence",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{intl:t}=e;return{value:{valueTypes:[s().vm.compile(t),s().Eo.compile(t)]}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserTimeZone:n}=t??{},o=(0,r().P)();return{value:{values:[s().vm.evaluate(n??o),s().Eo.evaluate(n??o)]}}},isAvailableForContext(e){const{automation:t,automationActions:o,hasPremiumAutomations:r}=e;if(t.parent_table===n(179034).ev)return!0;if(t.parent_table===a().Vl){const e=n(388821).RecordMap.create();for(const t of o)e.addModel(t);return!!t.isCompleteSprintAutomation({getRecordModel:n(792071).b4_.fromRecordMap(e)})||r}(0,i().HB)(t.parent_table)}}};function d(e){return l[e]}},120251:(e,t,n)=>{n.d(t,{k:()=>o});const o=(0,n(340498).xh)("xMark",{default:{loader:()=>n.e(14344).then(n.bind(n,599813))},small:{loader:()=>n.e(14344).then(n.bind(n,995847))},fill:{loader:()=>n.e(14344).then(n.bind(n,297813))},fillSmall:{loader:()=>n.e(14344).then(n.bind(n,563692))}},["close","cross","delete","remove","cancel"])},217827:(e,t,n)=>{n.d(t,{A:()=>r});var o=()=>n(821062);class i extends(()=>n(757695))().Store{getInitialState(){return{automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0}}blur(e){void 0!==this.state.automationStore&&(void 0===e||(0,o().A)(this.state,e))&&this.setState({automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0})}focus(e){(0,o().A)(this.instanceState,e)||this.setState(e)}}const r=new i;(0,n(604341).exposeDebugValue)("AutomationFocusStore",i)},237829:(e,t,n)=>{n.d(t,{X:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("checkedRoundedCheckmark",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M7.99617 16C12.3807 16 15.9923 12.3807 15.9923 7.99617C15.9923 3.61167 12.373 0 7.99617 0C3.61167 0 0 3.61167 0 7.99617C0 12.3807 3.61167 16 7.99617 16ZM7.99617 14.2018C4.5605 14.2018 1.80583 11.4319 1.80583 7.99617C1.80583 4.5605 4.55285 1.79818 7.99617 1.79818C11.4319 1.79818 14.1942 4.5605 14.2018 7.99617C14.2018 11.4319 11.4319 14.2018 7.99617 14.2018ZM7.18508 11.6461C7.47585 11.6461 7.73601 11.4931 7.912 11.2329L11.3324 5.96078C11.4395 5.79244 11.5237 5.60115 11.5237 5.42516C11.5237 5.01196 11.1564 4.72119 10.7585 4.72119C10.506 4.72119 10.2841 4.86657 10.1081 5.14969L7.16212 9.84027L5.80775 8.14921C5.6241 7.912 5.43281 7.82783 5.18795 7.82783C4.7824 7.82783 4.45337 8.14921 4.45337 8.56241C4.45337 8.76136 4.52224 8.93735 4.66762 9.12099L6.42755 11.2406C6.6418 11.5084 6.87901 11.6461 7.18508 11.6461Z"})})},241303:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(296540),i=()=>n(56366),r=()=>n(764880),a=()=>n(959013),s=()=>n(284371),u=()=>n(186445),l=n(474848);function d(e,t){const{user:o,focused:d}=e,m=(0,n(484714).v3)(),p=(0,a().tz)(),g=(0,n(401497).IS)((e=>({icon:{width:17,height:17,fill:e.icon.secondary},tooltip:{color:e.text.contrastSecondary,fontWeight:s().Wy.regular,maxWidth:240},tooltipHeader:{color:e.text.contrastPrimary,fontWeight:s().Wy.medium}})),[]),y=(0,r().A7)(o),f=(0,r().lR)(p,y),v=(0,i().K8)((()=>{const e=(0,u().ao)();return!(e&&(0,n(928074).Aj)({store:e}))||"none"!==(0,n(731320).om)(o.id)}),[o.id]),M=(0,i().K8)((()=>{var e;return o.id===(null===(e=n(765957).default.state.currentUserStore)||void 0===e?void 0:e.id)}),[o.id]),h=(0,n(341694).H)(),T=(0,i().K8)((()=>{if(!h)return;if(!d)return;if(v)return;const e=(0,u().ao)(),t=e&&Boolean(n(763884).K.get({userId:m.currentUser.id,key:(0,n(773706).T)(e.id)})),o=null==e?void 0:e.canAdmin();return!t&&o?(0,n(97835).x)(g.icon):(0,n(70423).L)(g.icon)}),[h,m.currentUser.id,v,d,g.icon]),C=(0,i().K8)((()=>{if(!h)return null;const e=o.email;return(0,l.jsxs)("div",{style:g.tooltip,children:[(0,l.jsx)("header",{style:g.tooltipHeader,children:(0,l.jsx)(c,{userName:f,userHasAccessToPage:v,userIsSelf:M})}),e]})}),[h,v,M,f,o.email,g.tooltip,g.tooltipHeader]);return(0,l.jsx)(n(457688).A,{...e,ref:t,actor:y,right:T,tooltip:C,tooltipPlacement:h?n(962730).W.Right:void 0,useEmailAsTooltip:!h,customUserTitleStyles:m.device.isMobile?{fontSize:14}:void 0,iconSizeOverride:m.device.isMobile?24:void 0})}const m=o.forwardRef(d);function c(e){let{userName:t,userHasAccessToPage:n,userIsSelf:o}=e;return o?(0,l.jsx)(a().sA,{defaultMessage:"You",id:"activitySection.authorPhrase.forOneAuthorCurrentUser.label"}):n?null:(0,l.jsx)(a().sA,{id:"mentionMenu.UserMentionMenuItem.noAccessTooltip",defaultMessage:"{userName} won't be notified because they don't have page access",values:{userName:t}})}},280244:(e,t,n)=>{n.d(t,{BT:()=>h,DK:()=>A,bO:()=>C});n(898992),n(354520),n(581454);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(247331),s=()=>n(977345),u=()=>n(742117),l=()=>n(919709),d=()=>n(959013),m=()=>n(496603),c=()=>n(829300),p=()=>n(751156),g=()=>n(375447),y=()=>n(575143),f=()=>n(89924),v=()=>n(455971),M=n(474848);function h(e){const{mentionMenuCurrentFormulaStore:t,setTemporaryInputData:n,isFirstSection:i,formulaContextVariableResults:l}=e,c=l.filter((e=>e.kind===a().FormulaContextValueKind.ContextValue&&"block"===e.type.type)),p=(0,r().K8)((()=>{const e=c.map((e=>{const o=(0,s().sM)(e),i=(0,s().E9)(e),r=(0,s().Ix)(e.type);return{action:T(e,t),key:e.id,render:e=>(e.focused&&n({title:o,icon:(0,M.jsx)(v().sL,{}),allowTabCompletion:!1}),(0,M.jsx)(y().A,{...e,right:(0,u().V)({height:"auto",marginInlineStart:6,width:12}),svg:r,title:o,tooltipText:i}))}}));return(0,m().oE)(e)}),[c,t,n]),g=(0,o.useMemo)((()=>{if(0!==p.length)return{items:p,key:"formula property results",render:e=>(0,M.jsx)(f().A,{...e,title:(0,M.jsx)(d().sA,{defaultMessage:"Property from",id:"mentionMenu.formulaPropertySection.title"}),desktopTitleStyle:i?{paddingTop:4}:void 0,topBorder:!i})}}),[p,i]);return g}function T(e,t){return function(){t.setState({formulaTypecheckContextValue:e}),g().Ay.updateOpenState({showFormulaProperty:!0})}}function C(e){const{query:t,formulaContextVariableResults:n,setTemporaryInputData:u,isFirstSection:l}=e,m=(0,i().v3)(),c=(0,r().K8)((()=>x({environment:m,formulaVariableFilter:e=>e.kind===a().FormulaContextValueKind.ContextValue&&(0,s().IF)(e),query:t,formulaContextVariableResults:n,setTemporaryInputData:u})),[m,n,t,u]),p=(0,o.useMemo)((()=>{if(0!==c.length)return{items:c,key:"custom formula results",render:e=>(0,M.jsx)(f().A,{...e,title:(0,M.jsx)(d().sA,{defaultMessage:"Custom",id:"mentionMenu.customFormulaVariables.title"}),desktopTitleStyle:l?{paddingTop:4}:void 0,topBorder:!l})}}),[c,l]);return p}function A(e){const{formulaReturnType:t,query:n,formulaContextVariableResults:o,setTemporaryInputData:r}=e;return x({environment:(0,i().v3)(),formulaVariableFilter:e=>e.kind===a().FormulaContextValueKind.ContextValue&&e.type.type===t&&!(0,s().IF)(e),query:n,formulaContextVariableResults:o,setTemporaryInputData:r})}function x(e){const{environment:t,formulaVariableFilter:n,query:o,formulaContextVariableResults:i,setTemporaryInputData:r}=e;if(0===i.length)return[];const a=i.filter(n);return 0===a.length?[]:a.map((e=>{const n=(0,s().sM)(e),i=(0,s().E9)(e),a=(0,s().Ix)(e.type);return{action:b(t,e,o),key:e.id,render:t=>(t.focused&&r({allowTabCompletion:!0,icon:(0,M.jsx)(v().sL,{}),title:e.name}),(0,M.jsx)(y().A,{...t,svg:a,title:n,tooltipText:i}))}}))}function b(e,t,n){return function(o){p().createAndCommit({userAction:"MentionMenu.formulaMenuItem",environment:e,canUndo:!0,perform:i=>{const r=(0,l().CA$)(t);c().Ju({annotations:[r],editorMode:"default",environment:e,mentionType:"formulaContextVariable",menuListItemAction:o,query:n,transaction:i})}})}}},308227:(e,t,n)=>{n.d(t,{A:()=>r});var o=()=>n(56366),i=()=>n(217429);function r(e){const{featureGateId:t,whenEnabled:n,whenDisabled:r,disableExposureLogging:a}=e,s=function(e){const{featureGateId:t,disableExposureLogging:n}=e;return(0,o().K8)((()=>i().default.checkGate({gateName:t,disableExposureLogging:n})),[t,n])}({featureGateId:t,disableExposureLogging:a});return s?n:r}},310109:(e,t,n)=>{n.r(t),n.d(t,{getAllContextValues:()=>v,getContextValueForActionById:()=>h,getContextValuesForAction:()=>M,typecheckAutomation:()=>y,typecheckAutomationAsync:()=>f});n(944114),n(898992),n(581454),n(737550);var o=()=>n(496603),i=()=>n(973647),r=()=>n(534177),a=()=>n(999515),s=()=>n(977345),u=()=>n(81768),l=()=>n(638458),d=()=>n(322867),m=()=>n(281994),c=()=>n(648651),p=()=>n(103966);function*g(e){const{actionModels:t,automationModel:n,contextType:g,formulasModule:y,runtimeStats:f}=e,v={valueTypes:e.valueTypes,actionInputValueTypes:{},actionValidationFailures:{}},M=performance.now();let h,T,C;if("button_block"===g||"button_property"===g){if(!n.isButtonType())return{error:new(d().N9)(`Automation trigger (${n.getTriggerType()}) does not match context type (${g}).`)};const t=n.getTrigger();C=(0,p().Z)(n.getTriggerType()).typecheck(e,t)}else if("event"===g){if(!n.isEventType())return{error:new(d().N9)(`Automation trigger (${n.getTriggerType()}) does not match context type (${g}).`)};const t=n.getTrigger();C=(0,p().Z)(n.getTriggerType()).typecheck(e,t)}else if("recurrence"===g){if(!n.isRecurrenceType())return{error:new(d().N9)(`Automation trigger (${n.getTriggerType()}) does not match context type (${g}).`)};const t=n.getTrigger();C=(0,p().Z)(n.getTriggerType()).typecheck(e,t)}else(0,r().HB)(e);if(i().Q.isFail(C))return C;v.valueTypes.push(...o().o8(C.value.valueTypes));for(const r of t){h=void 0,f&&(h=c().hs.getOrCreateAction(f,r.pointer,r.getType()));const t=(0,u().getActionRegistryItem)(r.getType());if(!t){T={error:new(d().oM)({actionId:r.id,message:`Unsupported action type: ${r.getType()}`})};break}const p=performance.now(),g=(0,l().Q)({automationModel:n,formulasModule:y,formulaValueTypes:v.valueTypes}),M=(0,m().HI)(yield*t.resolveExecutionDependencies(g,r));yield*a().q.fetchRecords(M.map((e=>e.pointer))),h&&(h.totalDependencies=M.length,h.getDependenciesDurationMs=Math.trunc(performance.now()-p));const C=t.typecheck(e,r),A=o().o8(v.valueTypes);if(v.actionInputValueTypes[r.id]=A,i().Q.isFail(C)){T=C;break}for(const e of C.value.valueTypes??[]){v.valueTypes.some((t=>(0,s().oH)(e,t)))||v.valueTypes.push(e)}C.value.validationFailures&&C.value.validationFailures.length>0&&(v.actionValidationFailures[r.id]=C.value.validationFailures)}const A=Math.trunc(performance.now()-M);return f&&(f.typecheckStartTime=M,f.typecheckDurationMs=A,f.typecheckSuccess=!(0,r().O9)(T)),T??{value:v}}function y(e){return a().q.runSync(e.getRecordModel,g(e))}async function f(e){return await a().q.runAsync(e.loadRecordModel,g(e))}function v(e){return i().Q.isFail(e)?[]:e.value.valueTypes.slice(0)}function M(e,t){return i().Q.isFail(e)?[]:e.value.actionInputValueTypes[t]??[]}function h(e,t,n){const o=M(e,t);return(0,s().IV)(o,n)}},341694:(e,t,n)=>{n.d(t,{H:()=>l});var o=()=>n(56366),i=()=>n(21510),r=()=>n(696746),a=()=>n(765957),s=()=>n(375447);const u=["reply_menu_all_updates","reply_menu_archive","reply_menu_mentions_comments"];function l(){const e=(0,o().K8)((()=>i().A.state.open&&u.includes(i().A.state.discussionLocation)),[]),t=(0,o().K8)((()=>s().Ay.getIsMockText()),[]),n=(0,o().K8)((()=>(0,r().lU)(a().default.state.mainEditorCurrentBlockStore)),[]);return!t&&!e&&!n}},383286:(e,t,n)=>{n.d(t,{E:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("microphone",{viewBox:"0 0 17 25",svg:(0,o.jsx)("path",{d:"M0.20752 12.0743C0.20752 13.5496 0.511882 14.853 1.12061 15.9845C1.72933 17.116 2.57438 18.0219 3.65576 18.7023C4.73714 19.3826 5.98324 19.7908 7.39404 19.9269V22.129H3.45166C3.17236 22.129 2.93245 22.2257 2.73193 22.4191C2.53141 22.6196 2.43115 22.8595 2.43115 23.1388C2.43115 23.4109 2.53141 23.6437 2.73193 23.837C2.93245 24.0376 3.17236 24.1378 3.45166 24.1378H13.313C13.5923 24.1378 13.8322 24.0376 14.0327 23.837C14.2332 23.6437 14.3335 23.4109 14.3335 23.1388C14.3335 22.8595 14.2332 22.6196 14.0327 22.4191C13.8322 22.2257 13.5923 22.129 13.313 22.129H9.37061V19.9269C10.7814 19.7908 12.0239 19.3826 13.0981 18.7023C14.1795 18.0219 15.0246 17.116 15.6333 15.9845C16.242 14.853 16.5464 13.5496 16.5464 12.0743V9.94739C16.5464 9.66809 16.4461 9.43176 16.2456 9.2384C16.0522 9.04504 15.8159 8.94836 15.5366 8.94836C15.2573 8.94836 15.0174 9.04504 14.8169 9.2384C14.6164 9.43176 14.5161 9.66809 14.5161 9.94739V11.9991C14.5161 13.2166 14.2583 14.2837 13.7427 15.2003C13.2271 16.1098 12.5109 16.8152 11.5942 17.3165C10.6776 17.8178 9.60693 18.0685 8.38232 18.0685C7.16488 18.0685 6.09424 17.8178 5.17041 17.3165C4.24658 16.8152 3.52686 16.1098 3.01123 15.2003C2.50277 14.2837 2.24854 13.2166 2.24854 11.9991V9.94739C2.24854 9.66809 2.14827 9.43176 1.94775 9.2384C1.74723 9.04504 1.50374 8.94836 1.21729 8.94836C0.94515 8.94836 0.708822 9.04504 0.508301 9.2384C0.30778 9.43176 0.20752 9.66809 0.20752 9.94739V12.0743ZM8.38232 15.8448C9.10563 15.8448 9.75016 15.6766 10.3159 15.34C10.8888 14.9962 11.3364 14.5236 11.6587 13.922C11.9881 13.3204 12.1528 12.6222 12.1528 11.8273V4.59778C12.1528 3.80286 11.9881 3.10461 11.6587 2.50305C11.3364 1.90149 10.8888 1.43241 10.3159 1.09583C9.75016 0.752075 9.10563 0.5802 8.38232 0.5802C7.65902 0.5802 7.0109 0.752075 6.43799 1.09583C5.87223 1.43241 5.42464 1.90149 5.09521 2.50305C4.76579 3.10461 4.60107 3.80286 4.60107 4.59778V11.8273C4.60107 12.6222 4.76579 13.3204 5.09521 13.922C5.42464 14.5236 5.87223 14.9962 6.43799 15.34C7.0109 15.6766 7.65902 15.8448 8.38232 15.8448Z"})})},455971:(e,t,n)=>{n.d(t,{Yo:()=>y,gf:()=>g,qn:()=>M,sL:()=>v,zC:()=>f});var o=n(296540),i=()=>n(401497),r=()=>n(353147),a=()=>n(476724),s=()=>n(689094),u=()=>n(381138),l=()=>n(379632),d=()=>n(191772),m=()=>n(780054),c=()=>n(267419),p=n(474848);function g(e){return"+"===e.insertionType?(0,p.jsx)(y,{}):(0,p.jsx)("span",{style:{width:"1em",height:"1em",display:"inline-block",verticalAlign:"-0.15em",marginRight:"0.2em"},children:(0,p.jsx)(h,{svg:u().q.__iconDefinition.svg,viewBox:u().q.__iconDefinition.viewBox})})}function y(){return(0,p.jsx)("span",{style:{width:"1em",height:"1em",display:"inline-block",verticalAlign:"-0.15em",marginRight:"0.2em"},children:(0,p.jsx)(h,{svg:s().W.__iconDefinition.svg,viewBox:s().W.__iconDefinition.viewBox})})}function f(){return(0,p.jsx)("span",{style:{width:"1em",height:"1em",display:"inline-block",verticalAlign:"-0.15em",marginRight:"0.2em"},children:(0,p.jsx)(h,{svg:a().I.__iconDefinition.svg,viewBox:a().I.__iconDefinition.viewBox})})}function v(){return(0,p.jsx)("span",{style:{width:"1em",height:"1em",display:"inline-block",verticalAlign:"-0.15em",marginRight:"0.2em"},children:(0,p.jsx)(h,{svg:r().b.__iconDefinition.svg,viewBox:r().b.__iconDefinition.viewBox})})}function M(e){const{pageStore:t,theme:n,isSafariOrIOS:o,emojiType:i,currentUserId:r}=e;return(0,d().h6)({pageModel:t.getModel(),pageRole:t.getRole(),showEmojiInline:!0,emojiType:i,baseUrl:m().A.domainBaseUrl,getRecordModel:t.getRecordModel,isClient:!0,isSafariOrIOS:o,currentUserId:r,theme:n,emojiData:c().A.state})}function h(e){const{svg:t,viewBox:n}=e,r=(0,o.useMemo)((()=>{const e=l().A.renderToString((0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:n,children:t}));return`url("${`data:image/svg+xml,${encodeURIComponent(e)}`}")`}),[t,n]),a=(0,i().IS)((e=>({container:{width:"100%",height:"100%",backgroundColor:e.icon.secondary,WebkitMaskImage:r,maskImage:r,WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat"}})),[r]);return(0,p.jsx)("div",{style:a.container})}},542129:(e,t,n)=>{n.d(t,{h:()=>V,v:()=>D});n(898992),n(354520),n(581454);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(401497),s=()=>n(416504),u=()=>n(245241),l=()=>n(919709),d=()=>n(959013),m=()=>n(496603),c=()=>n(829300),p=()=>n(751156),g=()=>n(712030),y=()=>n(186445),f=()=>n(825972),v=()=>n(135599),M=()=>n(62856),h=()=>n(311337),T=()=>n(477244),C=()=>n(765957),A=()=>n(375447),x=()=>n(148832),b=()=>n(331542),S=()=>n(958378),w=()=>n(89924),_=()=>n(455971),I=()=>n(756436),k=()=>n(280244),P=n(474848);const R=20;function V(e,t){const{useMentionMenuStore:n,open:o}=t??{useMentionMenuStore:!0},a=(0,r().K8)((()=>n?A().Ay.state.mentionTypes.page:o),[o,n]),s=(0,r().K8)((()=>n&&A().Ay.state.open&&A().Ay.state.textStore instanceof x().B?A().Ay.state.textStore:void 0),[n]),l=(0,i().v3)(),d=(0,r().K8)((()=>(0,h().y)(l)),[l]),{overriddenPublicShareLinkSpaceStore:m,furthestPublicShareAncestorId:c}=(0,T().W)(),p=(0,r().K8)((()=>Boolean(C().default.state.currentSpaceStore||m)||Boolean(s)),[s,m]),g=(0,r().K8)((()=>{var e;return null===(e=(0,y().ao)())||void 0===e?void 0:e.id}),[]),M=(0,r().K8)((()=>f().NK.state.filter((e=>e.pageId!==g)).slice(0,R).map((e=>e.store))),[g]),b=""===e,{results:S,isResultsLoading:w}=(0,v().W)({...d?{type:u().Vz.BlocksInAncestor,ancestorId:c??""}:{type:u().Vz.BlocksInSpace},source:"mention_menu",query:e,limit:R,filters:{excludeTemplates:!0,includePublicPagesWithoutExplicitAccess:d},options:{disable:!a||!p||b||d&&!c,overrideSpaceStore:d?m:void 0}});return{results:(0,r().K8)((()=>b?M.map((e=>({pageStore:e,serverEventProperties:void 0}))):S.map((e=>{let{store:t,serverEventProperties:n}=e;return{pageStore:t,serverEventProperties:n}}))),[S,M,b]),isLoading:w}}function D(e){const{query:t,isFirstSection:n,setTemporaryInputData:u,formulaContextVariableResults:y}=e,f=(0,d().tz)(),v=(0,i().v3)(),{device:M}=v,h=v.currentUser.id,T=(0,a().DP)(),C=(0,I().Q)(),x=M.isSafari||M.isIOS,{results:b,isLoading:R}=V(t,{useMentionMenuStore:!0}),D=(0,k().DK)({formulaReturnType:"block",query:t,formulaContextVariableResults:y,setTemporaryInputData:u}),F=(0,o.useMemo)((()=>(0,m().oE)(b.map((e=>{let{pageStore:n,serverEventProperties:o}=e;const i=n.id;return{key:i,render:e=>{if(e.focused){const e=n.getModel();if(e){const t=e.getRenderTitle({getRecordModel:n.getRecordModel,userTimeZone:(0,s().P)(),intl:f});u({title:t||"",icon:(0,P.jsx)(_().qn,{pageStore:n,theme:T,isSafariOrIOS:x,emojiType:(0,g().FN)(v),currentUserId:h}),allowTabCompletion:!0})}}return(0,P.jsx)(S().A,{...e,store:n,showVerifiedPageBadge:!0})},action:e=>{p().createAndCommit({userAction:"MentionMenu.getPageResultsMenuSection",environment:v,canUndo:!0,perform:n=>{c().Ju({environment:v,editorMode:"default",annotations:C?[(0,l().Umo)(i)]:[(0,l().ld4)(i,void 0)],transaction:n,menuListItemAction:e,query:t,serverEventProperties:o,mentionType:"page",resultId:i})}})}}})))),[h,v,f,x,C,t,b,u,T]),U=(0,o.useMemo)((()=>[...D,...F]),[D,F]),q=!(U.length>0)&&!R?K.noPageResults:K.linkToPage,L=(0,o.useMemo)((()=>(0,P.jsxs)(P.Fragment,{children:[f.formatMessage(q),(0,P.jsx)(j,{show:R})]})),[f,R,q]),E=(0,r().K8)((()=>A().Ay.state.mentionTypes.page),[]),N=(0,o.useMemo)((()=>{if(E&&(R||0!==U.length))return{key:"no page results",render:e=>(0,P.jsx)(w().A,{...e,title:L,desktopTitleStyle:n?{paddingTop:4}:void 0,topBorder:!n}),items:U}}),[U,R,E,L,n]);return{pageResultsSection:N,isPageResultsLoading:R}}function j(e){let{show:t}=e;const n=(0,M().A)(t,500,300);return(0,P.jsx)(b().A,{style:{textAlign:"center",visibility:n?"visible":"hidden",display:"inline",marginLeft:8}})}const K=(0,d().YK)({noPageResults:{defaultMessage:"No page results",id:"mentionMenu.noPageSearchResults.title"},linkToPage:{defaultMessage:"Link to page",id:"mentionMenu.pagesSection.title2"}})},603533:(e,t,n)=>{function o(){return 330}n.d(t,{W:()=>o})},653475:(e,t,n)=>{n.d(t,{D:()=>o});const o=(0,n(959013).YK)({addPage:{defaultMessage:"Type to add or link page…",id:"mentionMenu.addPage.prompt2"}})},756436:(e,t,n)=>{n.d(t,{Q:()=>pt,p:()=>ct});n(944114),n(898992),n(672577);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(401497),s=()=>n(30626),u=()=>n(959013),l=()=>n(406792),d=()=>n(311337),m=()=>n(375447),c=()=>n(760217),p=(n(354520),()=>n(310109)),g=()=>n(247331),y=()=>n(173979),f=()=>n(778078),v=()=>n(534177),M=()=>n(108944),h=()=>n(578136),T=()=>n(765957),C=()=>n(217827);var A=()=>n(584262),x=()=>n(148307),b=()=>n(955363),S=()=>n(617668),w=()=>n(919709),_=()=>n(264879),I=()=>n(829300),k=()=>n(857783),P=()=>n(553965),R=()=>n(258805),V=()=>n(962730),D=()=>n(8980),j=()=>n(89924),K=()=>n(859428),F=()=>n(284371),U=n(474848);const q={...F().RC,fontWeight:F().Wy.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"};function L(e){const{pageTitle:t}=e;return t?(0,U.jsx)(u().sA,{defaultMessage:"New “{filterText}” page in…",id:"createPageMenuItem.title.withPageName",values:{filterText:(0,U.jsx)("span",{style:q,children:t})}}):(0,U.jsx)(u().sA,{defaultMessage:"Add new page in…",id:"createPageMenuItem.title.withoutPageName"})}function E(e){const{pageTitle:t}=e;return t?(0,U.jsx)(u().sA,{defaultMessage:"New “{filterText}” sub-page",id:"createSubpageMenuItem.title.withPageName",values:{filterText:(0,U.jsx)("span",{style:q,children:t})}}):(0,U.jsx)(u().sA,{defaultMessage:"Add new sub-page",id:"createSubpageMenuItem.title.withoutPageName"})}var N=()=>n(103448),B=()=>n(455971),O=()=>n(653475);function z(e){const{isFirstSection:t,query:n,clearSavedSelection:a,setTemporaryInputData:s}=e,{isOpen:l,insertionType:d,isCreatePageEnabled:p,textStore:g}=(0,r().K8)((()=>{const e=m().Ay.state.open;return{isOpen:e,isCreatePageEnabled:m().Ay.state.mentionTypes.createPage,insertionType:e?m().Ay.state.insertionType:void 0,textStore:e?m().Ay.state.textStore:void 0}}),[]),y=function(e){const{query:t,textStore:n,clearSavedSelection:a,setTemporaryInputData:s}=e,l=(0,i().v3)(),d=(0,u().tz)(),m=(0,r().K8)((()=>_().D8(n)),[n]),p=(0,o.useMemo)((()=>({key:"add new subpage",action:async e=>{m&&await I().eh({environment:l,clearSavedSelection:a,titleText:t,createInValue:m.createInValue,onPageCreated:e=>{e&&""===w().q4_(e.getTitleValue())&&k().uK({environment:l,store:e,pageVisitSource:A().y8.Create})},menuListItemAction:e})},render:e=>{e.focused&&s({title:0===t.length?d.formatMessage(O().D.addPage):"",icon:(0,U.jsx)(B().Yo,{}),allowTabCompletion:!1});const n=n=>(0,U.jsx)(c().A,{...(0,P().A)(n||{},e),icon:(0,U.jsx)(D().I,{icon:S().plusIcon}),title:(0,U.jsx)(E,{pageTitle:t})});return l.device.isMobile?n():(0,U.jsx)(K().A,{renderTooltip:()=>(0,U.jsx)(N().A,{imageURL:x().A.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:(0,U.jsx)(u().sA,{...R().DZ.createSubpage})}),placement:V().W.Right,delayThreshold:0,render:e=>n(e)})}})),[l,a,m,d,t,s]);return p}({query:n,textStore:g,clearSavedSelection:a,setTemporaryInputData:s}),f=function(e){const{query:t,setTemporaryInputData:n}=e,r=(0,i().v3)(),a=(0,u().tz)(),s=(0,o.useCallback)((()=>{m().Ay.updateOpenState({showCreateIn:!0})}),[]),l=(0,o.useMemo)((()=>({key:"open create in menu",action:s,render:e=>{e.focused&&n({title:0===t.length?a.formatMessage(O().D.addPage):"",icon:(0,U.jsx)(B().Yo,{}),allowTabCompletion:!1});const o=n=>(0,U.jsx)(c().A,{...(0,P().A)(n||{},e),icon:(0,U.jsx)(D().I,{icon:b().arrowDiagonalUpRightIcon}),title:(0,U.jsx)(L,{pageTitle:t})});return r.device.isMobile?o():(0,U.jsx)(K().A,{renderTooltip:()=>(0,U.jsx)(N().A,{imageURL:x().A.images.tooltips.pageMenu.newPageInPng,imageWidth:140,imageHeight:100,caption:(0,U.jsx)(u().sA,{...R().DZ.newPageIn})}),placement:V().W.Right,delayThreshold:0,render:e=>o(e)})}})),[r.device.isMobile,s,a,t,n]);return l}({query:n,setTemporaryInputData:s}),v=(0,o.useMemo)((()=>{if(!p||!l)return;const e="@"===d?(0,U.jsx)(u().sA,{id:"mentionMenu.createPageSection.title",defaultMessage:"New page"}):void 0;return{key:"create page",render:n=>(0,U.jsx)(j().A,{...n,title:e,desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:[y,f]}}),[t,y,f,p,l,d]);return v}n(581454),n(737550);var W=()=>n(244641),Z=()=>n(395361),H=()=>n(597777),Y=()=>n(869190),$=()=>n(604995),G=()=>n(498140),J=()=>n(416504),Q=()=>n(187174),X=()=>n(496603),ee=()=>n(751156),te=()=>n(5580),ne=()=>n(963589);function oe(e){const{category:t,query:n,setTemporaryInputData:o,templateVariableResults:r}=e,a=(0,i().v3)(),s=(0,u().tz)();return r.filter((e=>(0,y().BX)(e,t))).map((e=>({key:e,render:t=>{const n=(0,y().Ti)(e,s),i=(0,y().EC)(e,s);return t.focused&&o({title:n,icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,U.jsx)(c().A,{...t,title:n,caption:i,inline:!0})},action:t=>{ee().createAndCommit({userAction:"MentionMenu.menuItem",environment:a,canUndo:!0,perform:o=>{I().Ju({environment:a,editorMode:"default",annotations:[w().Ii$({type:e})],transaction:o,menuListItemAction:t,query:n,mentionType:"templateVariable"})}})}})))}var ie=()=>n(280244);function re(e){const{isFirstSection:t,query:a,setTemporaryInputData:s,templateVariableResults:l,formulaContextVariableResults:d}=e,p=(0,i().v3)(),g=(0,u().tz)(),y=function(e){const[t,i]=(0,o.useState)([]),a=(0,u().tz)(),{areDateMentionsAllowed:s,areReminderMentionsAllowed:l}=(0,r().K8)((()=>({areDateMentionsAllowed:m().Ay.state.mentionTypes.date,areReminderMentionsAllowed:m().Ay.state.mentionTypes.reminder})),[]),d=(0,te().n)(),c=(0,ne().X)("chrono_node_date_mentions",!1,!1),p=(0,ne().X)("default_mentioned_dates_to_reminders",!1,!1),g=(0,o.useCallback)((async()=>{if(0===e.length)return;const t=await async function(e){const{query:t,intl:o,userLocal:i,areReminderMentionsAllowed:r}=e,{chronoNodeDependency:a}=await Promise.all([n.e(91757),n.e(58587)]).then(n.bind(n,211051)),s=await a.load(),u={en:s.en.parse,ja:s.ja.parse,zh:s.zh.parse,fr:s.fr.parse,de:s.de.parse,es:s.es.parse,pt:s.pt.parse,nl:s.nl.parse},l=t.toLowerCase(),d=l.includes(o.formatMessage(ge.ago).toLowerCase()),m=[u[i]??s.en.parse,s.en.parse];let c=[];m.some((e=>{const n=e(t,void 0,{forwardDate:!d});return n.length>0&&(c=n,!0)}));const p=c.length>0?c[0]:void 0;if(!p)return;const{start:g,end:y}=p,f=g.isCertain("minute")||g.isCertain("hour"),v=(null==y?void 0:y.isCertain("minute"))||(null==y?void 0:y.isCertain("hour")),M=g.date().getTime(),h=null==y?void 0:y.date().getTime(),T=(0,J().P)(),C=$().KQ(M,T),A={unit:"day",value:0,time:H().lM,defaultTimeZone:T},x=t.toLowerCase().startsWith(o.formatMessage(G().DZ.remind).toLowerCase());let b;if(M&&!h)b=f?{...C,reminder:x?ae(g):void 0}:{type:"date",start_date:C.start_date,reminder:x?A:void 0};else if(h){const e=$().NC(M,h,(0,J().P)());b=f&&v?{...e,reminder:x?ae(g):void 0}:{type:"daterange",end_date:e.end_date,start_date:e.start_date,reminder:x?A:void 0}}if(!b)return;const S=(0,Y().ZF)({value:b,allowRelativeDates:!0,date_format:"relative",userTimeZone:(0,J().P)(),intl:o,getToday:()=>$().ah((0,J().P)())}),w={label:S,value:()=>b,source:"chrono-node"},_=r&&(x||e.isDefaultMentionedDatesToRemindersEnabled)?pe(b):void 0;if(!_)return[w];const I=o.formatMessage(ge.reminder,{dateTime:S}),k={label:I,value:()=>_,source:"chrono-node"};if(x)return[k];return[w,k]}({query:e,intl:a,userLocal:d,isDefaultMentionedDatesToRemindersEnabled:p,areReminderMentionsAllowed:l}),o=t&&t.filter((e=>e.label.length>0));o&&0!==o.length?i(o):i([])}),[a,p,e,d,l]),y=(0,Z().Y)((async()=>await g()),100);return(0,Q().Yb)((async()=>{if(!s)return;c&&y.cancel();const t=function(e){const{query:t,allowReminder:n,intl:o,isDefaultMentionedDatesToRemindersEnabled:i}=e;if(0===t.length)return(0,X().oE)([{label:o.formatMessage(ge.autocompleteToday),value:()=>$().Ec((0,J().P)()),source:"luxon"},n?void 0:{label:o.formatMessage(ge.autocompleteNextTuesday),value:()=>{const e=$().ah((0,J().P)()),t=e.set({weekday:2,hour:15}),n=t<=e?t.plus({week:2}):t.plus({week:1});return{type:"datetime",start_date:n.toFormat($().tr),start_time:n.toFormat(H().GE),time_zone:(0,J().P)()}},source:"luxon"},n?{label:o.formatMessage(ge.autocompleteReminder),value:()=>({type:"datetime",start_date:$().uf((0,J().P)()).start_date,start_time:"09:00",reminder:{unit:"day",value:0,time:H().lM,defaultTimeZone:(0,J().P)()},time_zone:(0,J().P)()}),source:"luxon"}:void 0]);const r=t.normalize("NFKD"),a=n?G().bm(r,o):G().FA(r,o);if(!a)return[];const s=(0,Y().ZF)({value:a,date_format:"relative",userTimeZone:(0,J().P)(),intl:o,allowRelativeDates:!0}),u=t.toLowerCase().startsWith(o.formatMessage(G().DZ.remind).toLowerCase()),l={label:s,value:()=>a,source:"luxon"},d=n&&i?pe(a):void 0;if(d&&(0,H().Lh)(d)){const e={label:o.formatMessage(ge.reminder,{dateTime:s}),value:()=>d,source:"luxon"};return u?[e]:[l,e]}return[l]}({query:e,allowReminder:l,isDefaultMentionedDatesToRemindersEnabled:p,intl:a}).slice(0,6);t.length>0||!c?i(t):await y()}),[s,c,e,l,p,a,y]),t}(a),f=oe({templateVariableResults:l,category:"date",query:a,setTemporaryInputData:s}),v=(0,ie().DK)({formulaReturnType:"date",query:a,formulaContextVariableResults:d,setTemporaryInputData:s}),M=(0,o.useMemo)((()=>y.map((e=>{let{label:t,value:n,source:o}=e;const i=n(),r={key:t,render:e=>{if(e.focused&&s({title:t,icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),"chrono-node"===o){const o=function(e,t){const n="daterange"===e.type||"datetimerange"===e.type;if(n)return;const o=(0,J().P)(),i=W().c9.now().setZone(o);let r=W().c9.fromFormat(e.start_date,$().tr,{zone:o});"date"===e.type?r=r.startOf("day"):"datetime"===e.type&&(r=(0,$().mF)(e));if("datetime"===e.type&&e.start_time){const e=Math.round(r.diff(i,"minutes").minutes),n=Math.abs(e),o=e>0;if(n<de)return 0===n?t.formatMessage(ge.now):t.formatMessage(o?ge.minutesFromNow:ge.minutesAgo,{count:n});if(n<me){const e=Math.round(n/60);return t.formatMessage(o?ge.hoursFromNow:ge.hoursAgo,{count:e})}}const a=i.startOf("day"),s=Math.round(r.startOf("day").diff(a,"days").days);if(0===s)return t.formatMessage(ge.today);if(1===s)return t.formatMessage(ge.tomorrow);if(-1===s)return t.formatMessage(ge.yesterday);const u=Math.abs(s),l=s>0;return u<se?t.formatMessage(l?ge.daysFromToday:ge.daysAgo,{count:u}):u<ue?t.formatMessage(l?ge.weeksFromToday:ge.weeksAgo,{count:Math.round(u/se)}):u<le?t.formatMessage(l?ge.monthsFromToday:ge.monthsAgo,{count:Math.round(u/ue)}):t.formatMessage(l?ge.yearsFromToday:ge.yearsAgo,{count:Math.round(u/le)})}(n(),g);return(0,U.jsx)(c().A,{...e,title:t,caption:o,inline:!0})}if(G().e_(t,g)){const n=(0,Y().ZF)({value:i,userTimeZone:(0,J().P)(),intl:g,allowRelativeDates:!1});return(0,U.jsx)(c().A,{...e,title:t,caption:n,inline:!0})}return(0,U.jsx)(c().A,{...e,title:t})},action:e=>{ee().createAndCommit({userAction:"MentionMenu.menuItem",environment:p,canUndo:!0,perform:t=>{I().Ju({environment:p,editorMode:"default",annotations:[["d",{...i,date_format:"relative"}]],transaction:t,menuListItemAction:e,query:a,mentionType:(0,H().Lh)(i)?"reminder":"date"})}})}};return r}))),[y,g,s,p,a]),h=(0,o.useMemo)((()=>[...v,...f,...M]),[M,v,f]),T=(0,o.useMemo)((()=>{if(h.length>0)return{key:"date results",render:e=>(0,U.jsx)(j().A,{...e,title:(0,U.jsx)(u().sA,{defaultMessage:"Date",id:"mentionMenu.dateSection.title"}),desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:h}}),[h,t]);return T}function ae(e){const t=e.isCertain("minute")?"minute":e.isCertain("hour")?"hour":"day";return"minute"===t?{unit:t,value:e.get("minute")??0}:"hour"===t?{unit:t,value:e.get("hour")??0}:{unit:"day",value:0,time:H().lM}}const se=7,ue=30,le=365,de=60,me=24*de;const ce={time:H().lM,unit:"day",value:0};function pe(e){if((0,H().Lh)(e)||!function(e){const t=$().Dz(e);if(!t)return!1;if("datetime"===e.type&&e.start_time){const t=W().c9.now().setZone((0,J().P)()),n=(0,$().mF)(e);if(Math.abs(n.diff(t,"minutes").minutes)<1)return!1}return t.start>$().ah((0,J().P)())}(e))return e;switch(e.type){case"date":case"daterange":return{...e,reminder:ce};case"datetimerange":case"datetime":return{...e,reminder:{unit:"minute",value:0}};default:(0,v().HB)(e)}}const ge=(0,u().YK)({autocompleteToday:{defaultMessage:"Today",id:"mentionMenu.date.autocomplete.today"},autocompleteNextTuesday:{defaultMessage:"Next Tuesday 3pm",id:"mentionMenu.date.autocomplete.nextTuesday"},autocompleteReminder:{defaultMessage:"Remind tomorrow 9am",id:"mentionMenu.date.autocomplete.reminder"},reminder:{defaultMessage:"Remind {dateTime}",id:"mentionMenu.date.remindAtDateTime"},now:{defaultMessage:"Now",id:"mentionMenu.date.timeCaption.now"},today:{defaultMessage:"Today",id:"mentionMenu.date.timeCaption.today"},tomorrow:{defaultMessage:"Tomorrow",id:"mentionMenu.date.timeCaption.tomorrow"},yesterday:{defaultMessage:"Yesterday",id:"mentionMenu.date.timeCaption.yesterday"},minutesFromNow:{defaultMessage:"{count, plural, one {# minute from now} other {# minutes from now}}",id:"mentionMenu.date.timeCaption.minutesFromNow"},minutesAgo:{defaultMessage:"{count, plural, one {# minute ago} other {# minutes ago}}",id:"mentionMenu.date.timeCaption.minutesAgo"},hoursFromNow:{defaultMessage:"{count, plural, one {# hour from now} other {# hours from now}}",id:"mentionMenu.date.timeCaption.hoursFromNow"},hoursAgo:{defaultMessage:"{count, plural, one {# hour ago} other {# hours ago}}",id:"mentionMenu.date.timeCaption.hoursAgo"},daysFromToday:{defaultMessage:"{count, plural, one {# day from now} other {# days from now}}",id:"mentionMenu.date.timeCaption.daysFromToday"},daysAgo:{defaultMessage:"{count, plural, one {# day ago} other {# days ago}}",id:"mentionMenu.date.timeCaption.daysAgo"},weeksFromToday:{defaultMessage:"{count, plural, one {# week from now} other {# weeks from now}}",id:"mentionMenu.date.timeCaption.weeksFromToday"},weeksAgo:{defaultMessage:"{count, plural, one {# week ago} other {# weeks ago}}",id:"mentionMenu.date.timeCaption.weeksAgo"},monthsFromToday:{defaultMessage:"{count, plural, one {# month from now} other {# months from now}}",id:"mentionMenu.date.timeCaption.monthsFromToday"},monthsAgo:{defaultMessage:"{count, plural, one {# month ago} other {# months ago}}",id:"mentionMenu.date.timeCaption.monthsAgo"},yearsFromToday:{defaultMessage:"{count, plural, one {# year from now} other {# years from now}}",id:"mentionMenu.date.timeCaption.yearsFromToday"},yearsAgo:{defaultMessage:"{count, plural, one {# year ago} other {# years ago}}",id:"mentionMenu.date.timeCaption.yearsAgo"},ago:{defaultMessage:"ago",id:"mentionMenu.date.timeCaption.ago"}});var ye=()=>n(47170),fe=()=>n(605402),ve=()=>n(862139);const Me=(0,u().YK)({groupMentionCaption:{defaultMessage:"{numMembersInGroup, plural, one {{numMembersInGroup} member} other {{numMembersInGroup} members}}",id:"mentionMenu.group.caption"}});function he(e){const{isFirstSection:t,query:n,setTemporaryInputData:a}=e,s=(0,i().v3)(),l=(0,u().tz)(),d=function(e){const{query:t}=e,n=(0,r().K8)((()=>m().Ay.state.mentionTypes.group),[]),i=(0,r().K8)((()=>fe().A.state.permissionGroupsAndMemberCounts.map((e=>e.group))),[]),a=(0,o.useMemo)((()=>n?(0,f().Ay)(t,i,(e=>e.name||""),{normalizeFuzzyScore:!0}):[]),[n,t,i]);return a}({query:n}),c=(0,r().K8)((()=>X().pY(fe().A.state.permissionGroupsAndMemberCounts,(e=>e.group.group_id))),[]),p=(0,ye().O)(),g=(0,o.useMemo)((()=>X().oE(d.map((e=>{var t;if(!p)return;const o=l.formatMessage(Me.groupMentionCaption,{numMembersInGroup:(null===(t=c[e.group_id])||void 0===t?void 0:t.memberCount)||0});return{key:e.id,render:t=>(t.focused&&a({title:e.name||"",icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,U.jsx)(ve()._,{menuListItemProps:{...t,caption:o},group:e,iconSizeOverride:s.device.isMobile?24:void 0})),action:t=>{ee().createAndCommit({userAction:"MentionMenu.groupMention",environment:s,canUndo:!0,perform:o=>{I().Ju({environment:s,editorMode:"default",annotations:[w().dWL(e.group_id,p)],transaction:o,menuListItemAction:t,query:n,mentionType:"group"})}})}}})))),[d,p,l,c,a,s,n]),y=(0,o.useMemo)((()=>{if(0!==g.length)return{key:"group results",render:e=>(0,U.jsx)(j().A,{...e,title:(0,U.jsx)(u().sA,{defaultMessage:"Groups",id:"mentionMenu.groupSection.title"}),desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:g}}),[g,t]);return y}var Te=()=>n(179034),Ce=()=>n(125958),Ae=()=>n(186445),xe=()=>n(712505),be=()=>n(630116);const Se=o.forwardRef((function(e,t){const{store:o}=e,r=(0,i().v3)().device.isMobile?24:20,s=(0,a().IS)((e=>({icon:{fill:e.text.tertiary,width:r,height:r}})),[r]);return(0,U.jsx)(c().A,{...e,ref:t,title:(0,U.jsx)(n(16006).A,{store:o}),className:"notranslate",icon:(0,n(476724).I)(s.icon)})}));function we(e){const t=(0,i().v3)(),n=(0,u().tz)(),{query:a,setTemporaryInputData:s,isFirstSection:l}=e,d=function(e){const{intl:t,query:n}=e,o=n.toLowerCase(),i=(0,ne().X)("mention_menu_page_headings"),a=(0,r().K8)((()=>i&&m().Ay.state.mentionTypes.heading),[i]),s=(0,r().K8)((()=>{const e=(0,Ae().ZO)();if(!e)return;const{mainEditorCurrentBlockStore:t}=T().default.state;return e===t?t:xe().default.peekTargetStore.state===e?xe().default.peekTargetStore.state:void 0}),[]),u=(0,r().K8)((()=>a&&s?(0,Ce().T)(s.id,s.getRecordModel):[]),[a,s],{recomputeSchedule:"lazy"}),l=(0,r().K8)((()=>s?(0,X().oE)(u.map((e=>{const n=be().Bv.createChildStore(s,{table:Te().ev,id:e}),i=n.getModel();if(!i)return;const r=i.getRenderTitle({getRecordModel:n.getRecordModel,userTimeZone:(0,J().P)(),intl:t});return r&&r.toLowerCase().includes(o)?n:void 0}))):[]),[t,o,s,u],{recomputeSchedule:"lazy"});return l}({query:a,intl:n}),c=0===d.length,p=(0,r().K8)((()=>d.map((e=>{const o=e.id;return{key:o,render:t=>{if(t.focused){const t=e.getModel();if(t){const o=t.getRenderTitle({getRecordModel:e.getRecordModel,userTimeZone:(0,J().P)(),intl:n});s({title:o||"",icon:(0,U.jsx)(B().zC,{}),allowTabCompletion:!0})}}return(0,U.jsx)(Se,{...t,store:e})},action:e=>{ee().createAndCommit({userAction:"MentionMenu.getHeaderResultsMenuSection",environment:t,canUndo:!0,perform:n=>{I().Ju({environment:t,editorMode:"default",annotations:[["p",o]],transaction:n,menuListItemAction:e,query:a,mentionType:"heading"})}})}}}))),[t,d,n,a,s]),g=(0,o.useMemo)((()=>{if(!c)return{key:"heading results",render:e=>(0,U.jsx)(j().A,{...e,title:(0,U.jsx)(u().sA,{defaultMessage:"Link to heading",id:"mentionMenu.headerSection.title"}),desktopTitleStyle:l?{paddingTop:4}:void 0,topBorder:!l}),items:p}}),[p,l,c]);return g}var _e=()=>n(626822);function Ie(e){const{isFirstSection:t,environment:n,query:a,setTemporaryInputData:s}=e,{teamResults:l,currentTeamResultStore:d}=function(e){const{isMobileNative:t}=(0,i().Y0)(),{query:n}=e,o=(0,r().K8)((()=>(0,h().D)({isMobileNative:t,disableExposureLogging:!0})&&m().Ay.state.mentionTypes.team),[t]),a=(0,r().K8)((()=>{var e;if(!o)return[];if(!m().Ay.state.open)return[];const t=(null===(e=T().default.state.currentSpaceViewStore)||void 0===e?void 0:e.getTeamsStores().filter(v().O9))||[];return(0,f().Ay)(n,t,(e=>e.getName()||""),{normalizeFuzzyScore:!0})}),[o,n]),s=(0,r().K8)((()=>m().Ay.state.open?m().Ay.state.textStore:void 0),[]);return{teamResults:a,currentTeamResultStore:(0,r().K8)((()=>{if(s&&(0,M().Wo)(s))return(0,M().Iw)(s)}),[s])}}({query:a}),c=(0,ye().O)(),p=pt(),g=(0,r().K8)((()=>X().oE(l.map((e=>{if(!c)return;return{key:e.id,render:t=>(t.focused&&s({title:e.getName()||"",icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,o.createElement)(_e().A,{...t,key:e.id,teamStore:e})),action:t=>{ee().createAndCommit({userAction:"MentionMenu.teamMention",environment:n,canUndo:!0,perform:o=>{const i=w().DH3(e.id,c,"teamspace");I().Ju({environment:n,editorMode:"default",annotations:p?[(0,w().tPj)({teamId:e.id,spaceId:c,mentionType:"teamspace"})]:[i],transaction:o,menuListItemAction:t,query:a,mentionType:"team"})}})}}})))),[n,a,s,c,l,p]),y=(0,o.useMemo)((()=>{if(0!==g.length)return{key:"team results",render:e=>(0,U.jsx)(j().A,{...e,title:(0,U.jsx)(u().sA,{defaultMessage:"Teams",id:"mentionMenu.teamSection.title"}),desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:g}}),[g,t]);return{currentTeamResultStore:d,teamResultsSection:y}}var ke=()=>n(542129),Pe=(n(908872),()=>n(764880)),Re=()=>n(237829),Ve=()=>n(97835),De=()=>n(763884),je=()=>n(798880),Ke=()=>n(695608),Fe=()=>n(381349),Ue=()=>n(498212),qe=()=>n(134696),Le=()=>n(966505),Ee=()=>n(449506),Ne=()=>n(579627),Be=()=>n(812182),Oe=()=>n(2220),ze=()=>n(731320),We=()=>n(928074),Ze=()=>n(217429),He=()=>n(448693);const Ye=(0,u().YK)({here:{id:"mentionMenu.SlackSpecialMentionMenuItem.hereMention",defaultMessage:"@here"},channel:{id:"mentionMenu.SlackSpecialMentionMenuItem.channelMention",defaultMessage:"@channel"}}),$e=(0,u().YK)({here:{id:"mentionMenu.SlackSpecialMentionMenuItem.hereMentionNoAmpersand",defaultMessage:"here"},channel:{id:"mentionMenu.SlackSpecialMentionMenuItem.channelMentionNoAmpersand",defaultMessage:"channel"}}),Ge=[{message:$e.here,channelRecipient:"here"},{message:$e.channel,channelRecipient:"channel"}],Je=o.forwardRef((function(e,t){const{channelRecipient:o}=e;return(0,U.jsx)(c().A,{...e,icon:(0,n(522500).q)({width:14,height:14}),title:(0,U.jsx)(u().sA,{...Ye[o]}),ref:t,inline:!0,caption:(0,U.jsx)(u().sA,{...Ye[o]})})}));var Qe=()=>n(241303),Xe=()=>n(773706),et=()=>n(341694),tt=()=>n(62088);const nt="__invite";function ot(e){const{isFirstSection:t,query:n,inviteTargetsStore:a,personPropertyInviteStore:s,mentionMenuCurrentMentionStore:l,setTemporaryInputData:d,templateVariableResults:p,formulaContextVariableResults:g,currentTeamResultStore:y,disabled:f}=e,v=(0,i().v3)(),M=(0,u().tz)(),T=pt(),A=(0,r().K8)((()=>m().Ay.state.mentionTypes.user),[]),{results:x,isLoading:b}=(0,tt().u)({query:n,environment:v,intl:M,disabled:f,useMentionMenuStore:!0}),S=(0,r().K8)((()=>(0,Ae().ao)()),[]),_=(0,r().K8)((()=>S&&Boolean(De().K.get({userId:v.currentUser.id,key:(0,Xe().T)(S.id)}))),[v.currentUser.id,S]),k=(0,r().K8)((()=>m().Ay.state.mentionTypes.inviteUserToPage&&!_),[_]),P=oe({templateVariableResults:p,category:"user",query:n,setTemporaryInputData:d}),R=(0,ie().DK)({formulaReturnType:"person",query:n,formulaContextVariableResults:g,setTemporaryInputData:d}),V=(0,r().K8)((()=>{const e=m().Ay.state.mentionTypes.team;return(0,h().D)({isMobileNative:v.device.isMobileNative,disableExposureLogging:!0})&&e}),[v.device.isMobileNative]),K=(0,r().K8)((()=>!x.find((e=>e.email===n))&&m().Ay.state.mentionTypes.inviteUserToWorkspace),[n,x]),F=(0,ye().O)(),q=(0,r().K8)((()=>{var e;return"slack_notification"===(null===(e=C().A.state.automationActionStore)||void 0===e?void 0:e.getType())}),[]),L=K||x.length>0||P.length>0||R.length>0||V,E=(0,r().K8)((()=>{if(!F||!y||!L)return;const e=M.formatMessage({id:"posts.teamMenuItem.everyoneMentionNoAmpersand",defaultMessage:"everyone"});return e.startsWith(n)?{key:"everyone-unique-item",render:t=>(t.focused&&d({title:e,icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,o.createElement)(_e().A,{...t,key:"everyone-unique-item",teamStore:y,renderAsEveryoneMention:!0})),action:e=>{ee().createAndCommit({userAction:"MentionMenu.teamMention",environment:v,canUndo:!0,perform:t=>{I().Ju({environment:v,editorMode:"default",annotations:[w().DH3(y.id,F,"everyone")],transaction:t,menuListItemAction:e,query:n,mentionType:"team"})}})}}:void 0}),[L,y,v,M,n,d,F]),N=(0,r().K8)((()=>Ge.reduce(((e,t)=>{if(!q)return e;const{channelRecipient:i,message:r}=t,a=M.formatMessage(r);if("channel"!==i&&"here"!==i)return e;if(!a.startsWith(n))return e;const s=function(e){return`slack-special-mention-${e}-unique-item`}(i),u={key:s,render:e=>(e.focused&&d({title:a,icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,o.createElement)(Je,{...e,channelRecipient:i,key:s})),action:e=>{ee().createAndCommit({userAction:`MentionMenu.slackSpecialMention.${r.id}MenuItem`,environment:v,canUndo:!0,perform:t=>{I().Ju({environment:v,editorMode:"default",annotations:[w().zP1(i)],transaction:t,menuListItemAction:e,query:n,mentionType:"slackSpecialMention"})}})}};return e.push(u),e}),[])),[q,v,M,n,d]),O=(0,et().H)(),z=(0,r().K8)((()=>m().Ay.getMentionMenuContext()??Te().ev),[]),W=(0,r().K8)((()=>!!S&&((0,We().Aj)({store:S})&&S.canAdmin())),[S]),Z=(0,o.useCallback)((async e=>{let{user:t}=e;if(!(!v.device.isMobile&&O&&!_&&W))return;if(!S)return;const n=await Ee().callApi({eventName:"canMentionInviteUserToPage",environment:v,data:{block:{id:S.pointer.id,table:Te().ev,spaceId:S.getSpaceId()},mentionedUser:{id:t.id,table:je().oo,spaceId:S.getSpaceId()}}});if("success"!==n.type||!n.data.canInvite)return;const o=(0,Ue().Ay)();Be().HK(function(e){const{environment:t,user:n,pageStore:o,intl:i,flowId:r,from:a}=e;return o&&De().K.set({userId:t.currentUser.id,key:(0,Xe().T)(o.id),value:!0}),{id:`invite_${n.id}`,title:i.formatMessage(at.pageInviteToastTitle,{name:n.name??n.email}),jsxMessage:(0,U.jsx)(it,{user:n}),actions:{primary:{title:i.formatMessage(at.pageInviteToastInviteButton),onAction:()=>{if(!o)return;const i="read_and_write";ee().createAndCommit({userAction:"MentionMenu.menuItem",environment:t,canUndo:!0,perform:e=>{Ne().zP({environment:t,transaction:e,store:o,permissionItems:[{type:"user_permission",role:i,user_id:n.id}],pagePermissionChangeLocation:"mention_share_menu",fromPermissionWrapper:"mention_menu",flowId:r})}}),De().K.set({userId:t.currentUser.id,key:(0,Xe().T)(o.id),value:!1}),qe().Jg(t,{role:i,is_space:!1,invite_targets:[{type:"existingUser",value:n}],is_onboarding:!1,invite_origin:"mention_menu",permission_items:[{type:"user_permission",role:i,user_id:n.id}],invite_message_length:0,invite_flow_id:r}),rt(t,{flow_id:r,selection:"invite",target_user_id:n.id,from:a}),Be().HK(function(e){const{user:t,intl:n,environment:o,pageStore:i,flowId:r,from:a}=e;return{id:`invite_${t.id}`,icon:Re().X,title:n.formatMessage(at.pageInviteSnackbarSuccessTitle),jsxMessage:void 0,message:n.formatMessage(at.pageInviteSnackbarSuccessMessage),actions:{primary:{title:n.formatMessage(at.pageInviteUndo),onAction:()=>{ee().createAndCommit({userAction:"MentionMenu.menuItem",environment:o,canUndo:!0,perform:e=>{i&&Ne().zP({environment:o,transaction:e,store:i,permissionItems:[{type:"user_permission",role:"none",user_id:t.id}],pagePermissionChangeLocation:"mention_share_menu",flowId:r})}}),Be().UW(`invite_${t.id}`),function(e,t){(0,Oe().u)({environment:e,event:{eventName:"undo_invite_to_page_popup",eventProperties:t}}),Ze().default.logEvent("undo_invite_to_page_popup",void 0,t)}(o,{flow_id:r,target_user_id:t.id,from:a})}}}}}(e))}},secondary:{title:i.formatMessage(at.pageInviteToastIgnoreButton),onAction:()=>{o&&(Be().UW(`invite_${n.id}`),rt(t,{flow_id:r,selection:"dismiss",target_user_id:n.id,from:a}))}}}}}({environment:v,user:t,pageStore:S,intl:M,flowId:o,from:z})),function(e,t){(0,Oe().u)({environment:e,event:{eventName:"trigger_invite_to_page_popup",eventProperties:t}}),Ze().default.logEvent("trigger_invite_to_page_popup",void 0,t)}(v,{flow_id:o,target_user_id:t.id,from:z})}),[v,_,W,O,S,z,M]),H=(0,r().K8)((()=>m().Ay.state.open?m().Ay.state.flowId:void 0),[]),Y=(0,o.useCallback)(((e,t,n,o)=>{t.reset(),n.reset(),H&&(t.setState({...t.state,tokenQuery:o}),n.setState({...n.state,flowId:H}),Le().TS(e,{origin:m().Ay.getInviteOrigin(),invite_flow_id:H}),m().Ay.updateOpenState({showInvite:!0}))}),[H]),$=(0,r().K8)((()=>x.map((e=>{const t=e.id;return{key:t,render:n=>(n.focused&&d({title:(0,Ke().c6)(M,e),icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!0}),(0,o.createElement)(Qe().A,{...n,key:t,user:e})),action:o=>{const i=(0,ze().om)(t);k&&"none"===i?(l.setState({userId:t,userEmail:e.email,displayName:(0,Pe().A7)(e).getDisplayName(M)}),m().Ay.updateOpenState({showMentionAndShare:!0})):(ee().createAndCommit({userAction:"MentionMenu.menuItem",environment:v,canUndo:!0,perform:t=>{I().Ju({environment:v,editorMode:"default",annotations:T?[(0,w().J_S)(e.id)]:[(0,w().P4h)(e.id)],transaction:t,menuListItemAction:o,query:n,mentionType:"user"})}}),Z({user:e}))}}})).concat(K&&L?[{key:nt,action:()=>Y(v,a,s,n),render:e=>(e.focused&&d({title:"",icon:(0,U.jsx)(B().sL,{}),allowTabCompletion:!1}),(0,U.jsx)(c().A,{...e,icon:(0,U.jsx)(D().I,{icon:Ve().x}),title:n.length>0?(0,U.jsx)(u().sA,{defaultMessage:"Invite “{query}”…",id:"mentionMenu.peopleSection.invitePrompt",values:{query:n}}):(0,U.jsx)(u().sA,{defaultMessage:"Invite…",id:"mentionMenu.peopleSection.invitePrompt.empty"})}))}]:[])),[Z,v,Y,M,a,l,s,n,d,K,k,L,x,T]),G=(0,o.useMemo)((()=>[...E?[E]:[],...N,...R,...P,...$]),[E,R,P,N,$]),J=(0,o.useMemo)((()=>{if(0!==G.length||b)return{key:"user results",render:e=>(0,U.jsx)(j().A,{...e,title:(0,U.jsx)(u().sA,{defaultMessage:"People",id:"mentionMenu.peopleSection.title"}),desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:G}}),[G,t,b]);return A?{userResultsSection:J,isUserResultsLoading:b,numberOfUserResults:x.length}:{userResultsSection:void 0,isUserResultsLoading:!1,numberOfUserResults:0}}function it(e){const{user:t}=e,n=(0,a().IS)((()=>{const e=(0,Fe().O4)({theme:"dark"});return{container:{display:"flex",flexDirection:"column",gap:4},tokenContainer:{paddingTop:4,paddingBottom:4},darkTooltip:{background:e.tooltipBackground,color:e.text.contrastPrimary}}}),[]);return(0,U.jsxs)("div",{style:n.container,children:[(0,U.jsx)(K().A,{overlayContainerZIndex:202,alignment:V().C.Center,originGap:2,placement:V().W.Top,renderTooltip:()=>t.email,render:e=>(0,U.jsx)("div",{style:n.tokenContainer,...e,children:(0,U.jsx)(He().t_,{userValue:t,isSingle:!0,shouldShrink:!0,format:He().t_.Format.Medium,hasPersonHoverCard:!1})}),style:n.darkTooltip}),(0,U.jsx)("div",{children:(0,U.jsx)(u().sA,{...at.pageInviteToastMessage})})]})}function rt(e,t){(0,Oe().u)({environment:e,event:{eventName:"select_invite_to_page_popup",eventProperties:t}}),Ze().default.logEvent("select_invite_to_page_popup",t.selection,t)}const at=(0,u().YK)({pageInviteToastTitle:{defaultMessage:"Invite to page?",id:"mentionMenu.UserMentionMenuItem.inviteToastTitle"},pageInviteToastMessage:{defaultMessage:"They won’t be notified unless you invite them to the page.",id:"mentionMenu.UserMentionMenuItem.inviteToastMessage"},pageInviteToastInviteButton:{defaultMessage:"Invite",id:"mentionMenu.UserMentionMenuItem.inviteToastInviteButton"},pageInviteToastIgnoreButton:{defaultMessage:"Ignore",id:"mentionMenu.UserMentionMenuItem.inviteToastIgnoreButton"},pageInviteSnackbarSuccessTitle:{defaultMessage:"Invite sent",id:"mentionMenu.UserMentionMenuItem.snackbarInviteSuccessTitle"},pageInviteSnackbarSuccessMessage:{defaultMessage:"They were notified and invited to edit the page.",id:"mentionMenu.UserMentionMenuItem.snackbarInviteSuccessMessage"},pageInviteUndo:{defaultMessage:"Undo",id:"mentionMenu.UserMentionMenuItem.undoToastMessage"}});var st=()=>n(842599),ut=()=>n(720665);function lt(e){const{numberOfUserResults:t,templateVariableResults:n,query:i}=e,a=i.length>0,s=(0,r().K8)((()=>m().Ay.state.open&&m().Ay.state.insertionType),[]),u=function(e){const{templateVariableResults:t,query:n,numberOfUserResults:o}=e,i=(0,r().K8)((()=>m().Ay.state.open),[]),a=(0,r().K8)((()=>m().Ay.state.open?m().Ay.state.sectionOrder:void 0),[]),s=function(e){const{numberOfUserResults:t,templateVariableResults:n,query:o}=e,i=t+n.length;if(""===o||i>0||(0,st().xn)(o))return!0;const r=n.some((e=>(0,y().BX)(e,"user")));if(r)return!0;return!1}({numberOfUserResults:o,templateVariableResults:t,query:n});if(i&&a)return a;if(s)return mt;return dt}({numberOfUserResults:t,templateVariableResults:n,query:i});return(0,o.useMemo)((()=>{const e=u,t=(0,ut().sb)([...e,...m().kc]),n=t.filter((e=>"createPage"!==e));return"+"===s?["createPage",...n]:"@"===s&&a||"[["===s?[...n,"createPage"]:t}),[a,s,u])}const dt=["date","page","team","group","heading","user"],mt=["date","user","page","team","group","heading"];function ct(e){const{query:t,clearSavedSelection:n,inviteTargetsStore:v,personPropertyInviteStore:M,mentionMenuCurrentMentionStore:h,mentionMenuCurrentFormulaStore:T,setTemporaryInputData:A}=e,[x,b]=(0,o.useState)(dt[0]),S=(0,i().v3)(),w=(0,r().K8)((()=>(0,d().y)(S)),[S]),_=(0,a().DP)(),I=(0,i().WS)(),{expandSection:k,isOpen:P}=(0,r().K8)((()=>({isOpen:m().Ay.state.open,expandSection:m().Ay.state.open?m().Ay.state.expandSection:void 0})),[]),R=function(e){const t=(0,u().tz)();return(0,r().K8)((()=>m().Ay.state.mentionTypes.templateVariable),[])?(0,y().W4)(e,t):[]}(t),V=function(e){const t=(0,r().K8)((()=>m().Ay.state.mentionTypes.formulaContextVariable),[]),{automationActionStore:n,typecheckResult:i}=(0,r().K8)((()=>({automationActionStore:C().A.state.automationActionStore,typecheckResult:C().A.state.typecheckResult})),[]),a=(0,o.useMemo)((()=>n&&i?(0,p().getContextValuesForAction)({value:i},n.id):(null==i?void 0:i.valueTypes)||[]),[n,i]),s=i&&t;return(0,o.useMemo)((()=>s?(0,f().Ay)(e,a,(e=>e.kind!==g().FormulaContextValueKind.ContextValue?"":e.name),{normalizeFuzzyScore:!0}):[]),[s,e,a])}(t),{pageResultsSection:D,isPageResultsLoading:j}=(0,ke().v)({query:t,isFirstSection:"page"===x,setTemporaryInputData:A,formulaContextVariableResults:V}),K=re({templateVariableResults:R,formulaContextVariableResults:V,isFirstSection:"date"===x,query:t,setTemporaryInputData:A}),F=we({query:t,setTemporaryInputData:A,isFirstSection:"heading"===x}),{teamResultsSection:q,currentTeamResultStore:L}=Ie({isFirstSection:"team"===x,environment:S,query:t,setTemporaryInputData:A}),{userResultsSection:E,isUserResultsLoading:N,numberOfUserResults:B}=ot({isFirstSection:"user"===x,query:t,inviteTargetsStore:v,personPropertyInviteStore:M,mentionMenuCurrentMentionStore:h,setTemporaryInputData:A,templateVariableResults:R,formulaContextVariableResults:V,currentTeamResultStore:L,disabled:w}),O=he({isFirstSection:"group"===x,query:t,setTemporaryInputData:A}),W=z({isFirstSection:"createPage"===x,query:t,clearSavedSelection:n,setTemporaryInputData:A}),Z=(0,ie().BT)({mentionMenuCurrentFormulaStore:T,setTemporaryInputData:A,isFirstSection:"formula"===x,formulaContextVariableResults:V}),H=(0,ie().bO)({query:t,formulaContextVariableResults:V,setTemporaryInputData:A,isFirstSection:"custom-formula"===x}),Y=(0,o.useMemo)((()=>({date:K,user:E,page:D,group:O,team:q,heading:F,createPage:W,formula:Z,"custom-formula":H,bot:void 0})),[K,E,D,O,q,F,W,Z,H]),$=lt({templateVariableResults:R,numberOfUserResults:B,query:t});(0,o.useEffect)((()=>{const e=$.find((e=>void 0!==Y[e]));b(e??$[0])}),[Y,$]);const G=!N&&!j;(0,o.useEffect)((()=>{const e=l().default.DO_NOT_USE_markLegacy("rum.mention_menu_ready");G&&l().default.DO_NOT_USE_measureLegacy(e,{environment:S})}),[S,G]);const J=(0,o.useCallback)((e=>function(e){const{sectionName:t,menuSection:n,isOpen:o,expandSection:i,theme:r,isPhone:a}=e;if(!o||i===t)return n;const{items:l}=n,d=a||"heading"===t?3:5;if(l.length<=d)return n;const p=[...l.slice(0,d),{key:"show more",render:e=>(0,U.jsx)(c().A,{...e,icon:(0,s()._)({width:16,fill:r.text.secondary}),title:(0,U.jsx)("span",{style:{color:r.text.secondary},children:(0,U.jsx)(u().sA,{defaultMessage:"{numberMore} more results",id:"mentionMenu.showMoreResultsButton.title",values:{numberMore:l.length-d}})})}),action:()=>{m().Ay.updateOpenState({expandSection:t})}}];return{...n,items:p}}({sectionName:e.sectionName,menuSection:e.menuSection,isPhone:I,isOpen:P,expandSection:k,theme:_})),[I,P,k,_]);return(0,o.useMemo)((()=>{const e=[];for(const t of $){const n=Y[t];n&&(w&&"user"===t||e.push("createPage"===t?n:J({sectionName:t,menuSection:n})))}return e}),[$,Y,J,w])}function pt(){return(0,r().K8)((()=>m().Ay.state.open&&m().Ay.state.insertionType===m().D),[])}},773706:(e,t,n)=>{n.d(t,{T:()=>i});const o="ShowMentionInvite";function i(e){return`${o}-${e}`}}}]);