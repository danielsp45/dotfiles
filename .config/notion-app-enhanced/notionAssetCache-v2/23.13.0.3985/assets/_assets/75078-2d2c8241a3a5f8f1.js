"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[75078],{87017:(e,t,n)=>{n.r(t),n.d(t,{duplicateBlocks:()=>w,duplicateBlocksWithMaybeConfirmation:()=>B,insertBlockAbove:()=>x,insertBlockAndEdit:()=>M,insertBlockBelow:()=>R,insertTextAbove:()=>U,insertTextBelow:()=>F});n(18107),n(944114),n(967357);var o=()=>n(908006),r=()=>n(206267),c=()=>n(496603),i=()=>n(855801),a=()=>n(466614),l=()=>n(60867),s=()=>n(669548),d=()=>n(901389),p=()=>n(620689),u=()=>n(797265),m=()=>n(751156),v=()=>n(838256),f=()=>n(521358),S=()=>n(807700),k=()=>n(799832),g=()=>n(413962),b=()=>n(405417),C=()=>n(755206),I=()=>n(53664),h=()=>n(393255),y=()=>n(77246),T=()=>n(502438),_=()=>n(611371);async function B(e){const{environment:t,blocks:n,duplicateOnlyCollectionSchema:r,callback:c}=e;if(!(0,_().EF)(t))return;const a=await i().VI.duplicateActions.load();let s=n;if(1===n.length){const e=await f().rW({environment:t,block:n[0],action:"duplicate"});if("user_canceled"===e)return void(null==c||c());s=e}const d=s.at(0);if(!d)return;const u=(0,k().U)(d);if(u&&(0,b().ls)(d,u))await l().un({blocks:s,environment:t,analyticsFrom:"subitem_duplication",callback:c,collectionContextStore:u});else{const{serverCommitResult:e}=m().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{w({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"local",duplicateOnlyCollectionSchema:r,duplicateActions:a})},transactionTooBigFallback:e=>{w({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"server",duplicateOnlyCollectionSchema:r,duplicateActions:a})}});e.then(c)}o().default.afterNextFlush((()=>{p().BM({environment:t})}))}function w(e){const{environment:t,blocks:n,transaction:o,preferDuplicateLocation:r,lastTopLevelBlockStore:i,preventSetSelection:l,duplicateOnlyCollectionSchema:s,duplicateActions:p}=e,m=c().$z(n,(e=>e.getFormat().app_id??e.id)),v=[];return c().jJ(m,(e=>{const n=e[0],{blockStores:c,onComplete:i}=p.duplicateBlock({environment:t,stores:e,transaction:o,targetSpaceId:n.getSpaceId(),preferDuplicateLocation:r,options:{addCopyName:(0,I().A)(n),allowRedundancy:!1,deepCopyTransclusionContainers:!n.isTransclusionType(),resolveTemplateVariables:!(0,S().l)(n),duplicateOnlyCollectionSchema:s}});v.push(...c),i.then((e=>{if("error"===e.status){const n=e.error;a().Rk(n)?a().UK(t,{product:n.clientData.metadata.product}):d().f1(e.errorMessage)}}))})),u().LE({blocksToInsert:v,target:i?[i]:n,environment:t,transaction:o,replaceEmptyTextBlock:!1,preventSetSelection:l}),v}function R(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:c,preventSetSelection:i}=e,a=T().default.getCurrentRecordCache(),l=new(v().UF)({environment:t,userFlow:"page"===(null==n?void 0:n.blockType)?"user_flow_create_page":"user_flow_create_block",succeedOnEnqueue:!0});let d;if((0,_().EF)(t)&&n&&a){const e=s().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:a,from:c,selection:o});l.track(e.pointer,r),d=u().LE({environment:t,blocksToInsert:[e],target:o,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:i})[0]}else l.fail("invalid_state");return d}function x(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:c,preventSetSelection:i}=e,a=T().default.getCurrentRecordCache();let l;if((0,_().EF)(t)&&n&&a){const e=s().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:a,from:c,selection:o});l=u().t1({environment:t,blocks:[e],selection:o,transaction:r,preventSetSelection:i})[0]}return l}function M(e){const{environment:t,selection:n,transaction:o}=e,c=R({...e,preventSetSelection:!0});if(c){var i;u().x5({environment:t,insertedStores:[c],isCreated:!0});const e=y().Uv.getMode(c);if("suggest"===e){const e=g().RR(t,o,c);g().tM(o,c,{id:r().JW(),type:"insert",discussionId:e.id}),g().c3({environment:t,transaction:o,discussionStore:e,addModifiedBlockIdsAfter:[c.id]})}"suggest"===e&&null!==(i=c.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==i&&i.isCommentOnly()||u().um({transaction:o,blocks:n})}return c}function F(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:c}=e,i=c?void 0:"text_insert_below",a=R({environment:r,selection:t,createBlockItem:C().ry.text,analyticsFrom:i,transaction:n});return a&&o().default.afterNextFlush((()=>{h().zz({environment:r,blockStore:a,insertedTextBlockLocation:"below"})})),a}function U(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:c}=e,i=c?void 0:"text_insert_below",a=x({environment:r,selection:t,createBlockItem:C().ry.text,analyticsFrom:i,transaction:n});return a&&o().default.afterNextFlush((()=>{h().zz({environment:r,blockStore:a,insertedTextBlockLocation:"above"})})),a}},375078:(e,t,n)=>{n.r(t),n.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>y,transformBlocks:()=>h,transformIntoColumnList:()=>T});n(581454);var o=()=>n(908006),r=()=>n(700500),c=()=>n(179034),i=()=>n(496603),a=()=>n(722101),l=()=>n(44729),s=()=>n(863168),d=()=>n(246826),p=()=>n(797265),u=()=>n(778417),m=()=>n(725614),v=()=>n(751156),f=()=>n(62287),S=()=>n(87017),k=()=>n(594794),g=()=>n(299545),b=()=>n(217429),C=()=>n(630116),I=()=>n(65269);function h(e){const{environment:t,blocks:n,blockType:I,transaction:h}=e;if(I!==r().xd.transclusionContainer)if(I===r().xd.callout&&b().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:n,transaction:o}=e,i=n[0];if(!i)return;const a=i.getRecordStoreUIParent();if(!a||!(0,g().iU)(a))return;const p=a.getRecordStoreUIParent();if(!(p&&p instanceof C().Bv))return;const v=(0,k().Z1)({environment:t,table:c().ev,spaceId:p.getSpaceId()}),f=d().Wv({environment:t,id:v,type:r().xd.callout,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:p.getSpaceId(),format:{callout_version:2}});l().NI({parentStore:a,childStore:f,after:i.id,transaction:o});_({newParentStore:f.getContentStore(),blocks:n,transaction:o}),s().s4({store:f,transaction:o}),m().clear({environment:t}),u().IU({environment:t}),u().td({environment:t,stores:[f]})}({environment:t,blocks:n,transaction:h});else if(I!==r().xd.columnList)if(I!==r().xd.slide)if((0,r().ZK)(I)){const e=parseInt(I.replace("column","").replace("block","")),r=i().oE(i().Hn(e-1,(()=>S().insertTextBelow({environment:t,blocks:n,transaction:h})))),c=[...n,...r],a=T({environment:t,blocks:c,transaction:h});o().default.afterNextFlush((()=>{m().setSelectionAtStart({store:a[0].getBlockTitleStore()})}))}else for(const r of n)if(r.isCalloutV2()){const e=r.getParentBlockStore();if(e){const c=r.getContentStores();v().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:c.map((e=>e.id)),after:r.id}},transaction:h}),l().zz({parentStore:e.getContentStore(),childStore:r,transaction:h});for(const e of c)f().pd({environment:t,block:e,blockType:I,transaction:h,isMultiBlockTransformation:n.length>1});o().default.afterNextFlush((()=>{p().dL(t,c.map((e=>e.id)))}))}}else f().pd({environment:t,block:r,blockType:I,transaction:h,isMultiBlockTransformation:n.length>1});else!function(e){const{environment:t,blocks:n,transaction:o}=e,i=n[0];if(!i)return;const a=i.getRecordStoreUIParent();if(!a||!(0,g().iU)(a))return;const s=a.getRecordStoreUIParent();if(!(s&&s instanceof C().Bv))return;const p=(0,k().Z1)({environment:t,table:c().ev,spaceId:s.getSpaceId()}),v=d().Wv({environment:t,id:p,type:r().xd.slide,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:s.getSpaceId()});l().NI({parentStore:a,childStore:v,after:i.id,transaction:o});_({newParentStore:v.getContentStore(),blocks:n,transaction:o}),m().clear({environment:t}),u().IU({environment:t}),u().td({environment:t,stores:[v]})}({environment:t,blocks:n,transaction:h});else T({environment:t,blocks:n,transaction:h});else!function(e){const{environment:t,blocks:n,transaction:o}=e,i=n[0];if(!i)return;const l=i.getRecordStoreUIParent();if(!l||!(0,g().iU)(l))return;const s=l.getRecordStoreUIParent();if(!s||!(0,g()._p)(s))return;if(!s.isDefined())return;const p=(0,k().Z1)({environment:t,table:c().ev,spaceId:s.getSpaceId()}),v=d().Wv({environment:t,id:p,type:r().xd.transclusionContainer,inMemoryRecordCache:l.inMemoryRecordCache,transaction:o,spaceId:s.getSpaceId()});a().WH({parentStore:l,insertStore:v,afterStore:i,transaction:o});_({newParentStore:v.getContentStore(),blocks:n,transaction:o}),m().clear({environment:t}),u().IU({environment:t}),u().td({environment:t,stores:[v]})}({environment:t,blocks:n,transaction:h})}function y(e){let{environment:t,blocks:n,transaction:o}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(n)&&h({environment:t,blocks:n,blockType:"collection_view_page",transaction:o})}function T(e){const{environment:t,blocks:n,transaction:o}=e,i=n[0];if(!i)return[];const l=i.recordStoreUIParentStore;if(null==l||!l.valueIs(I()._))return[];const s=(0,k().Z1)({environment:t,table:c().ev,spaceId:i.getSpaceId()}),p=d().Wv({environment:t,id:s,type:r().xd.columnList,inMemoryRecordCache:i.inMemoryRecordCache,transaction:o,spaceId:i.getSpaceId()}),{childStore:u}=a().nc({parentStore:l,insertStore:p,beforeStore:i,transaction:o});return n.map((e=>{const n=(0,k().Z1)({environment:t,table:c().ev,spaceId:i.getSpaceId()}),s=d().Wv({environment:t,id:n,type:r().xd.column,inMemoryRecordCache:i.inMemoryRecordCache,transaction:o,spaceId:i.getSpaceId()}),{childStore:p}=a().TF({parentStore:l,childToRemoveStore:e,transaction:o}),{childStore:m}=a().WH({parentStore:u.getContentStore(),insertStore:s,transaction:o}),{childStore:v}=a().WH({parentStore:m.getContentStore(),insertStore:p,transaction:o});return v}))}function _(e){const{newParentStore:t,blocks:n,transaction:o}=e;for(const r of n){const e=r.getRecordStoreUIParent();null!=e&&e.valueIs(I()._)&&(a().TF({parentStore:e,childToRemoveStore:r,transaction:o}),a().BC({parentStore:t,appendStore:r,transaction:o}))}}},669548:(e,t,n)=>{n.d(t,{w:()=>d});n(16280),n(18107),n(967357);var o=()=>n(388821),r=()=>n(179034),c=()=>n(184468),i=()=>n(594794),a=()=>n(765957),l=()=>n(970330),s=()=>n(863168);function d(e){var t,n,d;const{environment:p,createBlockItem:u,from:m,inMemoryRecordCache:v,transaction:f,selection:S}=e;if(!u.templateRootBlockId||!u.createTemplate)throw new Error("Invalid createBlock item.");const k=(S.length>0?S[0].getSpaceId():void 0)??(null===(t=a().default.state.currentSpaceStore)||void 0===t?void 0:t.id)??(null===(n=a().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getSpaceId()),g=k?p.idCreator.getSpaceIdCreatorSync(k):void 0,{targetBlockStore:b}=(0,c().j)({environment:p,sourceBlockId:u.templateRootBlockId,targetBlockPointer:(0,i().zP)({environment:p,table:r().ev,spaceId:k}),sourceBlockSubtree:(0,o().partialRecordMapToRecordMap)(u.createTemplate(p)),targetRecordCache:v,transaction:f,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,spaceIdCreator:g});if(null===(d=u.postCreateCallback)||void 0===d||d.call(u,b,p,f),s().eY({environment:p,store:b,transaction:f}),m&&u.blockType){var C,I;const e=u.collectionViewType,t="full_page"===e,n=0!==S.length?null===(C=S[0])||void 0===C?void 0:C.getParentCollectionIdUpToTwoLevels():void 0;let o,r,c,i;if("chart"===e){var h,y;const e=null===(h=b.getCollectionViewStores())||void 0===h?void 0:h.at(0);o=null==e||null===(y=e.getChartConfig())||void 0===y?void 0:y.type,r=null==e?void 0:e.getChartPlaceholderType()}if("form_editor"===e){var T;const e=null===(T=b.getCollectionViewStores())||void 0===T?void 0:T.at(0),t=null==e?void 0:e.getFormBlockStore();c=null==t?void 0:t.id,i=null==e?void 0:e.id}l().v(p,{from:m,type:u.blockType,collection_id:b.getAssociatedCollectionId()??(null===(I=b.getCollectionStore())||void 0===I?void 0:I.id),view_type:"inline"===e||"full_page"===e?"table":e,is_toggleable:u.isToggleable,automation_id:b.getAutomationId(),new_page_id:"page"===u.blockType?b.id:void 0,creating_block_id:b.id,parent_collection_id:n,is_full_screen:t,chart_type:"placeholder"===o?r:o,is_chart_placeholder:"placeholder"===o,form_id:c,view_id:i})}return b}}}]);