"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[31276],{61661:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(296540),i=()=>n(534177),a=()=>n(623580),s=n(474848);function o(e){const{onChange:t,currentValue:n,extraValidation:o,...d}=e,[u,c]=(0,r.useState)(!1),[l,y]=(0,r.useState)((null==n?void 0:n.toString())??""),m=e=>!(0,i().O9)(o)||o(e);return(0,s.jsx)(a().A,{errorOutline:u,onKeyDown:e=>{if(("ArrowUp"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),e.stopPropagation(),(0,i().O9)(n))){const r="ArrowUp"===e.key?1:-1,i=n+r;m(i)&&(t(i),y(i.toString()))}},value:l,onChange:e=>{const n=e.currentTarget.value;if(y(n),""===n)t(void 0),c(!1);else{const n=Number(e.currentTarget.value);m(n)?(t(n),c(!1)):(t(void 0),c(!0))}},...d})}},131276:(e,t,n)=>{n.d(t,{$:()=>Te});var r=n(296540),i=()=>n(852507),a=()=>n(56366),s=()=>n(390527),o=()=>n(463830),d=()=>n(104636),u=(n(944114),()=>n(244641)),c=()=>n(401497),l=()=>n(668725),y=()=>n(402390),m=()=>n(959013),h=()=>n(496603),p=()=>n(534177),f=()=>n(284371),g=()=>n(84817),x=()=>n(760217),b=()=>n(406699),k=()=>n(113474),w=()=>n(805751),j=()=>n(928600),M=()=>n(678553),A=()=>n(939740),S=()=>n(864943),v=()=>n(89924),R=()=>n(573351),C=()=>n(780054),_=()=>n(186445),T=()=>n(781697),O=()=>n(61661),I=n(474848);const E=(0,m().YK)({never:{id:"automations.RecurrenceEditor.endConditionMenu.never",defaultMessage:"Never"},numberOfRuns:{id:"automations.RecurrenceEditor.endConditionMenu.numberOfRuns",defaultMessage:"Number of runs"},specificDate:{id:"automations.RecurrenceEditor.endConditionMenu.specificDate",defaultMessage:"Specific date"}});function z(e){const{currentValue:t,onChange:n}=e,i=(0,T().e)({minWidth:230}),a="number"===(null==t?void 0:t.type)?t.number_of_occurrences:void 0,[s,o]=(0,r.useState)(a??1),d=[{key:"never",items:[{key:"never",action:()=>{n(void 0)},render:e=>(0,I.jsx)(x().A,{...e,title:(0,I.jsx)(m().sA,{...E.never}),isChecked:void 0===t})}],render:e=>(0,I.jsx)(v().A,{...e})},{key:"number_of_occurrences",items:[{key:"number_of_occurrences",action:()=>{n({type:"number",number_of_occurrences:s})},render:e=>(0,I.jsx)(B,{...e,currentNumber:a??s,onNumberChange:e=>{(0,p().O9)(e)&&(o(e),n({type:"number",number_of_occurrences:e}))},selected:"number"===(null==t?void 0:t.type)})}],render:e=>(0,I.jsx)(v().A,{topBorder:!0,...e})},{key:"date",items:[{key:"date",action:()=>{},render:t=>(0,I.jsx)(W,{...t,...e})}],render:e=>(0,I.jsx)(v().A,{topBorder:!0,...e})}];return(0,I.jsx)(j().A,{...i,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:d,initialFocus:0})})}const B=(0,r.forwardRef)((function(e,t){const{currentNumber:n,onNumberChange:r,selected:i,...a}=e,o=(0,c().IS)((e=>({input:{maxWidth:60},menuItemTitle:{overflow:"visible"}})),[]);return(0,I.jsx)(x().A,{...a,itemMarginRight:4,ref:t,titleStyle:o.menuItemTitle,title:(0,I.jsxs)(g().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,I.jsx)("div",{children:(0,I.jsx)(m().sA,{...E.numberOfRuns})}),i&&(0,I.jsx)(O().b,{disabled:!i,currentValue:n,onChange:r,extraValidation:s().isValidRecurrenceNumberOfRuns,style:o.input,maxlength:3})]}),isChecked:i})})),W=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,...o}=e,d=(0,r.useMemo)((()=>u().c9.now().plus({weeks:1}).toMillis()),[]),l=(0,m().tz)(),y=(0,a().K8)((()=>_().XX.state),[]),h="date"===(null==n?void 0:n.type),p=h?n.end_at:d,[f,g]=(0,r.useState)(h);(0,r.useEffect)((()=>{!h&&f&&g(!1)}),[h,f]);const x=(0,r.useMemo)((()=>"date"===(null==n?void 0:n.type)?(0,s().getFormattedEndCondition)(n,l):void 0),[n,l]),b=(0,r.useCallback)((e=>{i({type:"date",end_at:e})}),[i]),w=(0,r.useMemo)((()=>({before:new Date})),[]),j=(0,r.useCallback)((()=>{i({type:"date",end_at:d})}),[i,d]),M=(0,c().IS)((()=>({minWidth:{minWidth:"247px"},calendarContainer:{padding:"8px 0"}})),[]),A=f||h;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(k()._,{...o,title:(0,I.jsx)(m().sA,{...E.specificDate}),chevronType:A?"down":"right",right:x,onClick:j,style:M.minWidth}),A&&(0,I.jsx)("div",{style:M.calendarContainer,children:(0,I.jsx)(R().A,{firstDayOfWeek:y,value:p,onChange:b,disabledDays:w})})]})}));n(581454);const N=(0,m().YK)({day:{id:"automations.FrequencyMenu.day",defaultMessage:"{number, plural, one {Day} other {Days}}"},week:{id:"automations.FrequencyMenu.week",defaultMessage:"{number, plural, one {Week} other {Weeks}}"},month:{id:"automations.FrequencyMenu.month",defaultMessage:"{number, plural, one {Month} other {Months}}"},year:{id:"automations.FrequencyMenu.year",defaultMessage:"{number, plural, one {Year} other {Years}}"}}),D={day:e=>({...N.day,values:{number:e?2:1}}),week:e=>({...N.week,values:{number:e?2:1}}),month:e=>({...N.month,values:{number:e?2:1}}),year:e=>({...N.year,values:{number:e?2:1}})};function F(e){const{onSelect:t,currentFrequency:n,pluralLabels:r}=e,i=(0,T().e)(),a=[{key:"default",items:(0,p().WP)(D).map((e=>{let[i,a]=e;return{key:i,action:()=>{t(i)},render:e=>(0,I.jsx)(x().A,{...e,title:(0,I.jsx)(m().sA,{...a(r)}),isChecked:n===i})}})),render:e=>(0,I.jsx)(v().A,{...e})}];return(0,I.jsx)(j().A,{...i,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:a,initialFocus:0})})}var U=()=>n(264435);const V=(0,m().YK)({monthRestrictionLabel:{id:"automations.MonthRestrictionMenuItem.monthRestrictionLabel",defaultMessage:"On the"},last:{id:"automations.MonthRestrictionMenuItem.last",defaultMessage:"Last"},day:{id:"automations.MonthRestrictionMenuItem.day",defaultMessage:"Day"}}),L=31,q=4,P=(0,r.forwardRef)((function(e,t){const{initialValue:n,onChange:i,startDateForFallback:a,...s}=e,o=(0,c().IS)((e=>({menuItem:{...!C().A.isMobile&&{paddingTop:6,paddingBottom:8}}})),[]),[d,l]=(y=function(e,t){const n=()=>t?{type:"day",dayNumber:u().c9.fromMillis(t).day}:K;return e?"monthdays"===e.type?1!==e.monthdays.length?n():{type:"day",dayNumber:e.monthdays[0]}:"weekdays_in_month"===e.type?1!==e.week_numbers.length||1!==e.weekdays.length?n():{type:"weekday",weekday:e.weekdays[0],weekNumber:-1===e.week_numbers[0]?"last":e.week_numbers[0]}:void(0,p().HB)(e):n()}(n,a),(0,r.useReducer)(((e,t)=>{if("change_day"===t.type)if("day"===t.newDay){if("day"===e.type)return e;if("weekday"===e.type)return{type:"day",dayNumber:"last"===e.weekNumber?1:Math.min(e.weekNumber,q)};(0,p().HB)(e)}else{if("weekday"===e.type)return{...e,weekday:t.newDay};if("day"===e.type)return{type:"weekday",weekday:t.newDay,weekNumber:e.dayNumber>q?"last":e.dayNumber};(0,p().HB)(e)}else if("change_number"===t.type){if("day"===e.type)return{...e,dayNumber:"last"===t.newNumber?1:t.newNumber};if("weekday"===e.type)return{...e,weekNumber:t.newNumber};(0,p().HB)(e)}else(0,p().HB)(t)}),y));var y;return function(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]);const i=(0,r.useRef)(!0);(0,r.useEffect)((()=>{i.current?i.current=!1:n.current(function(e){if("day"===e.type)return{type:"monthdays",monthdays:[e.dayNumber]};if("weekday"===e.type)return{type:"weekdays_in_month",weekdays:[e.weekday],week_numbers:["last"===e.weekNumber?-1:e.weekNumber]};(0,p().HB)(e)}(e))}),[e])}(d,i),(0,I.jsx)(M().Ay,{...s,ref:t,style:o.menuItem,title:(0,I.jsxs)(g().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,I.jsx)("div",{children:(0,I.jsx)(m().sA,{...V.monthRestrictionLabel})}),(0,I.jsx)(H,{state:d,dispatch:l})]})})}));function H(e){const{state:t,dispatch:n}=e,r=(0,m().tz)(),i=Q(),a=(0,c().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{height:28,padding:"4px 8px"}})),[]),s=X(t),o=$(t),d=C().A.isMobile?b().z7.SlideUp:b().z7.Popup;return(0,I.jsxs)(g().Y1,{width:"hug",direction:"horizontal",gap:6,children:[(0,I.jsx)(b().Ay,{popupType:d,render:e=>(0,I.jsx)(Y,{state:t,onSelect:t=>{n({type:"change_number",newNumber:t}),e.close()}}),renderOrigin:e=>(0,I.jsxs)(S().A,{size:"lg",...e,style:a.button,children:["last"===s?(0,I.jsx)(m().sA,{...V.last}):i(s),(0,l().b)(a.icon)]})}),(0,I.jsx)(b().Ay,{popupType:d,render:e=>(0,I.jsx)(J,{state:t,onSelect:t=>{n({type:"change_day",newDay:t}),e.close()}}),renderOrigin:e=>(0,I.jsxs)(S().A,{size:"lg",...e,style:a.button,children:[G(r,o),(0,l().b)(a.icon)]})})]})}function Y(e){const{state:t,onSelect:n}=e,r=(0,T().e)({maxHeight:255}),i=Q(),a=X(t),s="weekday"===t.type,o=h().oE([{key:"days",items:h().y1(1,("day"===t.type?L:"weekday"===t.type?q:(0,p().HB)(t))+1).map((e=>({key:`day_${e}`,action:()=>n(e),render:t=>(0,I.jsx)(x().A,{...t,title:i(e),isChecked:a===e})}))),render:e=>(0,I.jsx)(v().A,{...e})},s?{key:"last",items:[{key:"last",action:()=>n("last"),render:e=>(0,I.jsx)(x().A,{...e,title:(0,I.jsx)(m().sA,{...V.last}),isChecked:"last"===a})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})}:void 0]);return(0,I.jsx)(j().A,{...r,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:o,initialFocus:0})})}function J(e){const{state:t,onSelect:n}=e,r=(0,m().tz)(),i=(0,T().e)(),s=$(t),o=[{key:"day",items:[{key:"day",action:()=>n("day"),render:e=>(0,I.jsx)(x().A,{...e,title:G(r,"day"),isChecked:"day"===s})}],render:e=>(0,I.jsx)(v().A,{...e})},{key:"weekdays",items:(0,a().K8)((()=>1===_().XX.state?["MO","TU","WE","TH","FR","SA","SU"]:["SU","MO","TU","WE","TH","FR","SA"]),[]).map((e=>({key:`weekday_${e}`,action:()=>n(e),render:t=>(0,I.jsx)(x().A,{...t,title:G(r,e),isChecked:e===s})}))),render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})}];return(0,I.jsx)(j().A,{...i,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:o,initialFocus:0})})}const K={type:"day",dayNumber:1};function X(e){return"day"===e.type?e.dayNumber:"weekday"===e.type?e.weekNumber:void(0,p().HB)(e)}function $(e){return"day"===e.type?"day":"weekday"===e.type?e.weekday:void(0,p().HB)(e)}function Q(){const e=(0,m().tz)().locale.substring(0,2);return t=>(0,U().o4)(e,t,"d")}function G(e,t){if("day"===t)return e.formatMessage(V.day);{const n=(0,p().uv)(s().RRULE_WEEKDAYS_MAP).indexOf(t)+1;return u().c9.fromObject({weekday:n}).setLocale(e.locale).toLocaleString({weekday:"long"})}}n(898992),n(354520),n(430670);var Z=()=>n(484714);const ee=(0,m().YK)({aroundMidnight:{id:"automations.RecurTimeMenu.aroundMidnight",defaultMessage:"Around midnight"},aroundMidnightCaption:{id:"automations.RecurTimeMenu.aroundMidnightCaption",defaultMessage:"12â€“3AM"}});function te(e){const{currentRecurTime:t,onRecurTimeSelected:r}=e,i=(0,m().tz)(),a=(0,T().e)(),{isMobile:o}=(0,Z().Y0)(),d=[{key:"default",items:[...(0,n(963589).X)("automations_dev_tools")?[ne({onRecurTimeSelected:r})]:[],...[{type:"around_midnight"},...h().y1(0,24).flatMap((e=>h().y1(0,60,15).map((t=>({type:"hour_minute",hour:e,minute:t}))))).filter((e=>{let{hour:t,minute:n}=e;return 0!==t&&1!==t&&2!==t&&!(3===t&&0===n)}))].map((e=>{if("hour_minute"===e.type){const{hour:n,minute:a}=e,s=u().c9.utc().set({hour:n,minute:a,second:0,millisecond:0}).setLocale((0,y().H)(i)).toFormat("h:mm a"),o=(null==t?void 0:t.minute)===a&&(null==t?void 0:t.hour)===n;return{key:`hour_minute-${n}-${a}`,action:()=>{r({hour:n,minute:a})},render:e=>(0,I.jsx)(x().A,{...e,title:s,isChecked:o})}}if("around_midnight"===e.type){const e=(0,s().isRunningBetweenMidnightAnd3AM)(t);return{key:"around_midnight",action:()=>{r({hour:0,minute:0})},render:t=>(0,I.jsx)(x().A,{...t,title:(0,I.jsx)(m().sA,{...ee.aroundMidnight}),caption:(0,I.jsx)(m().sA,{...ee.aroundMidnightCaption}),isChecked:e})}}(0,p().HB)(e)}))],render:e=>(0,I.jsx)(v().A,{...e,desktopStyle:{maxHeight:o?"unset":250,overflow:"scroll"}})}];return(0,I.jsx)(j().A,{...a,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:d,initialFocus:0})})}function ne(e){const{onRecurTimeSelected:t}=e;return{key:"developer",action:()=>{const e=re();t({hour:e.hour,minute:e.minute})},render:e=>(0,I.jsx)(ie,{...e})}}function re(){const e=u().c9.local();let t=e.set({second:0,millisecond:0}).plus({minute:1});return t.diff(e,"seconds").seconds<20&&(t=t.plus({minute:1})),t}const ie=(0,r.forwardRef)((function(e,t){const[i,a]=(0,r.useState)((()=>re()));return(0,n(866515).n)((()=>{a(re())}),1e3,!0),(0,I.jsx)(x().A,{...e,ref:t,title:`[Dev] Run at ${i.toLocaleString(u().c9.TIME_SIMPLE)}`})}));function ae(e){return(0,p().O9)(e.interval)}var se=()=>n(381349),oe=()=>n(704152);const de=(0,m().YK)({sunday:{id:"automations.WeekdaySelector.weekdayAbbreviations.sunday",defaultMessage:"Su"},monday:{id:"automations.WeekdaySelector.weekdayAbbreviations.monday",defaultMessage:"Mo"},tuesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.tuesday",defaultMessage:"Tu"},wednesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.wednesday",defaultMessage:"We"},thursday:{id:"automations.WeekdaySelector.weekdayAbbreviations.thursday",defaultMessage:"Th"},friday:{id:"automations.WeekdaySelector.weekdayAbbreviations.friday",defaultMessage:"Fr"},saturday:{id:"automations.WeekdaySelector.weekdayAbbreviations.saturday",defaultMessage:"Sa"}}),ue={SU:de.sunday,MO:de.monday,TU:de.tuesday,WE:de.wednesday,TH:de.thursday,FR:de.friday,SA:de.saturday};function ce(e){const{weekdays:t,onChange:r,style:i,disabled:a}=e,s=(0,m().tz)();return(0,I.jsx)(g().Y1,{direction:"horizontal",gap:"auto",width:"fill",style:i,children:n(856662).U.map((e=>(0,I.jsx)(le,{isSelected:t.includes(e),onClick:()=>{const n=t.includes(e)?t.length>1?t.filter((t=>t!==e)):t:[...t,e];r(n)},disabled:a,children:s.formatMessage(ue[e])},e)))})}function le(e){const{isSelected:t,children:n,onClick:r,disabled:i}=e,{isMobile:a}=(0,Z().Y0)(),s=(0,c().IS)((e=>({button:{...a?{width:44,height:44,fontSize:32}:{width:28,height:28},color:t?se().Ay.white:e.darkTextColor,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:100,flexShrink:0,fontSize:a?f().J.UISmall.mobile:f().J.UISmall.desktop,background:t?se().Ay.blue:e.palette.gray[75]},pressed:{background:t?e.blueButtonPressedBackground:e.palette.gray[200]},hovered:{background:t?e.blueButtonHoveredBackground:e.palette.gray[100]}})),[a,t]);return(0,I.jsx)(oe().A,{disabled:i,onClick:r,style:s.button,hoveredStyle:s.hovered,pressedStyle:s.pressed,children:n})}const ye=(0,m().YK)({frequencyLabel:{id:"automations.RecurrenceEditor.frequencyLabel",defaultMessage:"Every"},recurTimeLabel:{id:"automations.RecurrenceEditor.recurTimeLabel",defaultMessage:"At"},startTimeLabel:{id:"automations.RecurrenceEditor.startTimeLabel",defaultMessage:"Starting"},endConditionLabel:{id:"automations.RecurrenceEditor.endConditionLabel",defaultMessage:"Ending"},deleteRecurrenceLabel:{id:"automations.RecurrenceEditor.deleteRecurrenceLabel",defaultMessage:"Stop repeating"},timezone:{id:"automations.RecurrenceEditor.timezone",defaultMessage:"Timezone"}});function me(e){const{currentValue:t,onDelete:n,disabled:r,allowExpiredRecurrence:i,onSave:a,disallowEnd:o=!1}=e,d=(0,m().tz)(),u=(0,T().e)({minWidth:260}),l=[],y=(0,c().IS)((e=>({disabledMessage:{color:e.text.secondary,fontSize:C().A.isMobile?f().J.UISmall.mobile:f().J.UISmall.desktop}})),[]);r&&l.push({key:"disabled_message",items:[{key:"disabled_message",action:()=>{},render:e=>(0,I.jsx)(M().Ay,{...e,title:(0,I.jsx)("div",{style:y.disabledMessage,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.noPermissionMessage",defaultMessage:"You do not have permission to edit this automation"})})})}],render:e=>(0,I.jsx)(v().A,{...e})}),!r&&(0,p().O9)(a)&&l.push({key:"save_section",items:[{key:"save_item",action:()=>{},render:e=>(0,I.jsx)(he,{...e,onSave:a,canSave:(0,p().O9)(t.interval)})}],render:e=>(0,I.jsx)(v().A,{...e})}),l.push({key:"main",items:(0,h().oE)([{key:"frequency",action:()=>{},render:t=>(0,I.jsx)(pe,{...t,...e,hasSaveSection:(0,p().O9)(a)})},we(e),Se(e),{key:"recur_time",action:()=>{},render:t=>(0,I.jsx)(fe,{...t,...e})}]),render:e=>(0,I.jsx)(v().A,{...e,topBorder:r})}),l.push({key:"times",items:[{key:"start_time",action:()=>{},render:t=>(0,I.jsx)(ge,{...t,...e})},...o?[]:[{key:"end_condition",action:()=>{},render:t=>(0,I.jsx)(Me,{...t,...e})}],{key:"timezone",action:()=>{},render:t=>(0,I.jsx)(Ae,{...t,...e})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})}),n&&!r&&l.push({key:"delete",items:[{key:"delete",action:()=>{},render:t=>(0,I.jsx)(xe,{...t,...e,onClick:n})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})});const g=function(e){const{recurrence:t,intl:n,allowExpiredRecurrence:r}=e;if(!ae(t))return{key:"next_recurrence",items:[{key:"invalid_recurrence_config",action:()=>{},render:e=>(0,I.jsx)(be,{...e,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.invalidRecurrenceConfig",defaultMessage:"Missing required fields"})})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})};const i=(0,s().getFormattedNextRecurrenceTime)({recurrence:t,intl:n});if(!i)return r?{key:"expired_recurrence",items:[{key:"expired_recurrence",action:()=>{},render:e=>(0,I.jsx)(be,{mode:"info",...e,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.automationComplete",defaultMessage:"This is complete and will not run again"})})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})}:{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,I.jsx)(be,{...e,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.automationWillNeverRun",defaultMessage:"This automation will never run"})})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})};return{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,I.jsx)(ke,{...e,nextRecurrenceTime:i})}],render:e=>(0,I.jsx)(v().A,{...e,topBorder:!0})}}({recurrence:e.currentValue,intl:d,allowExpiredRecurrence:i});return g&&l.push(g),(0,I.jsx)(w().A,{debugName:"RecurrenceEditor",capture:!0,allowEsc:!0,children:(0,I.jsx)(j().A,{...u,children:(0,I.jsx)(A().Ay,{disallowBackspace:!0,type:A().Oh.Vertical,sections:l,initialFocus:0})})})}const he=(0,r.forwardRef)((function(e,t){const{onSave:r,canSave:i,...a}=e,s=(0,c().IS)((e=>({menuItem:{paddingTop:2},message:{color:e.text.secondary,fontSize:C().A.isMobile?f().J.UISmall.mobile:f().J.UISmall.desktop},button:{fontSize:C().A.isMobile?f().J.UISmall.mobile:f().J.UISmall.desktop}})),[]),o=!i||"disabled"===r;return(0,I.jsx)(M().Ay,{...a,ref:t,style:s.menuItem,title:(0,I.jsxs)(g().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,I.jsx)("div",{style:s.message,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.editCadenceTitle",defaultMessage:"Edit cadence"})}),(0,I.jsx)(n(493823).p,{isBlue:!0,size:"sm",style:s.button,disabled:o,disabledFeedback:!0,onClick:"disabled"===r?h().lQ:r,children:(0,I.jsx)(m().sA,{id:"automations.RecurrenceEditor.saveButtonLabel",defaultMessage:"Save"})})]})})})),pe=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,disabled:a,hasSaveSection:o,...d}=e,u=(0,c().IS)((e=>({input:{maxWidth:34,padding:"4px 8px",opacity:a?.5:1},icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{justifyContent:"flex-end",height:28,opacity:a?.5:1,padding:"4px 8px"},menuItem:{...!C().A.isMobile&&{paddingTop:o?0:8,paddingBottom:2}}})),[a,o]),y=(0,p().O9)(n.interval)&&1!==n.interval,h=(0,r.useCallback)((e=>{n.frequency!==e&&i({...n,frequency:e,..."week"===e&&0===(n.weekdays??[]).length?{weekdays:["MO"]}:{},..."month"===e?{monthly_restriction:{type:"monthdays",monthdays:[1]}}:{}})}),[n,i]);return(0,I.jsx)(M().Ay,{...d,ref:t,title:(0,I.jsx)(m().sA,{...ye.frequencyLabel}),style:u.menuItem,disabled:a,right:(0,I.jsxs)(g().Y1,{direction:"horizontal",gap:6,width:"hug",align:"center",children:[(0,I.jsx)(O().b,{style:u.input,currentValue:n.interval,onChange:e=>{i({...n,interval:e})},extraValidation:s().isValidRecurrenceInterval,disabled:a,maxlength:2}),(0,I.jsx)(b().Ay,{popupType:C().A.isMobile?b().z7.SlideUp:b().z7.Popup,render:e=>(0,I.jsx)(F,{currentFrequency:n.frequency,onSelect:t=>{h(t),e.close()},pluralLabels:y}),renderOrigin:e=>(0,I.jsxs)(S().A,{...e,size:"lg",style:u.button,disabled:a,children:[(0,I.jsx)(m().sA,{...D[n.frequency](y)}),!a&&(0,l().b)(u.icon)]}),disabled:a})]})})})),fe=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:i,...a}=e,o=(0,m().tz)();let d;return(0,p().O9)(n.hour)&&(d=(0,s().isRunningBetweenMidnightAnd3AM)(n)?o.formatMessage(ee.aroundMidnight):u().c9.utc().set({hour:n.hour,minute:n.minute??0,second:0,millisecond:0}).setLocale((0,y().H)(o)).toFormat((0,p().O9)(n.minute)&&0!==n.minute?"h:mm a":"h a")),(0,I.jsx)(b().Ay,{disabled:i,popupType:C().A.isMobile?b().z7.SlideUp:b().z7.Popup,render:e=>(0,I.jsx)(te,{onRecurTimeSelected:t=>{r({...n,hour:t.hour,minute:t.minute}),e.close()},currentRecurTime:{hour:n.hour,minute:n.minute}}),placementToOrigin:b().sx.Right,alignmentToOrigin:b().yP.Start,renderOrigin:e=>(0,I.jsx)(k()._,{...a,...e,right:d,title:(0,I.jsx)(m().sA,{...ye.recurTimeLabel}),chevronType:"right",disabled:i})})})),ge=(0,r.forwardRef)((function(e,t){const{currentValue:r,onChange:i,disabled:a,disallowStart:s=!1,...o}=e,d=(0,m().tz)(),c=(0,n(869190).Yq)({date:u().c9.fromMillis(r.start_date),dateFormat:"relative",allowRelativeDates:!0,intl:d,shortenDate:!0});return(0,I.jsx)(b().Ay,{disabled:a||s,popupType:C().A.isMobile?b().z7.SlideUp:b().z7.Popup,render:e=>(0,I.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,I.jsx)(R().A,{firstDayOfWeek:_().XX.state,value:Math.max(r.start_date,Date.now()),onChange:t=>{i({...r,start_date:t}),e.close()},disabledDays:{before:new Date}})}),placementToOrigin:b().sx.Right,alignmentToOrigin:b().yP.Start,renderOrigin:e=>(0,I.jsx)(k()._,{...o,...e,right:c,title:(0,I.jsx)(m().sA,{...ye.startTimeLabel}),chevronType:"right",disabled:a||s})})})),xe=(0,r.forwardRef)((function(e,t){const{currentValue:n,...r}=e,i=(0,c().IS)((e=>({menuItem:{paddingBlock:2}})),[]);return(0,I.jsx)(x().A,{...r,ref:t,title:(0,I.jsx)(m().sA,{...ye.deleteRecurrenceLabel}),style:i.menuItem,isRedOnHover:!0})}));const be=(0,r.forwardRef)((function(e,t){const{children:n,mode:r="error",...i}=e,a=(0,c().IS)((e=>({disabledMessage:{color:"error"===r?e.errorText:e.text.secondary,fontSize:C().A.isMobile?f().J.UISmall.mobile:f().J.UISmall.desktop}})),[r]);return(0,I.jsx)(M().Ay,{...i,ref:t,title:(0,I.jsx)("div",{style:a.disabledMessage,children:n})})})),ke=(0,r.forwardRef)((function(e,t){const{nextRecurrenceTime:n,...r}=e,i=(0,c().IS)((e=>({menuItem:{paddingBlock:2},titleWrap:{display:"flex",...C().A.isMobile?{flexDirection:"row",flexWrap:"wrap",gap:4}:{flexDirection:"column"},color:e.text.secondary,fontSize:C().A.isMobile?f().J.UISmall.mobile:f().J.UISmall.desktop}})),[]);return(0,I.jsx)(M().Ay,{...r,style:i.menuItem,title:(0,I.jsxs)("div",{style:i.titleWrap,children:[(0,I.jsx)("div",{children:(0,I.jsx)(m().sA,{defaultMessage:"Next occurrence:",id:"automations.RecurrenceEditor.NextRecurrenceMenuItem.nextOccurrence"})}),(0,I.jsx)("div",{children:n})]})})}));function we(e){const{currentValue:t}=e;if("week"===t.frequency)return{key:"weekday_selector",action:()=>{},render:t=>(0,I.jsx)(je,{...t,...e})}}const je=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:i,...a}=e,s=(0,c().IS)((e=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]);return(0,I.jsx)(M().Ay,{...a,disabled:i,style:s.menuItem,title:(0,I.jsx)(ce,{weekdays:n.weekdays??[],onChange:e=>{r({...n,weekdays:e})},disabled:i})})})),Me=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,disabled:a,...o}=e,d=(0,m().tz)(),u=(0,r.useMemo)((()=>n.end_condition),[n]),c=(0,r.useCallback)((e=>{i({...n,end_condition:e})}),[n,i]),l=(0,r.useMemo)((()=>(0,s().getFormattedEndCondition)(u,d)),[u,d]);return(0,I.jsx)(b().Ay,{disabled:a,popupType:C().A.isMobile?b().z7.SlideUp:b().z7.Popup,render:e=>(0,I.jsx)(z,{currentValue:u,onChange:c}),placementToOrigin:b().sx.Right,alignmentToOrigin:b().yP.Start,renderOrigin:e=>(0,I.jsx)(k()._,{...o,...e,right:l,title:(0,I.jsx)(m().sA,{...ye.endConditionLabel}),chevronType:"right",disabled:a})})})),Ae=(0,r.forwardRef)((function(e,t){const{currentValue:i,onChange:a,disabled:s,...o}=e,d=(0,r.useCallback)((e=>{a({...i,timezone:e})}),[i,a]);return(0,I.jsx)(n(304422).G,{enableRecents:!0,placementToOrigin:b().sx.Right,alignmentToOrigin:b().yP.Start,onSelect:d,disabled:s,currentValue:i.timezone,renderOrigin:e=>(0,I.jsx)(k()._,{...o,...e,title:(0,I.jsx)(m().sA,{...ye.timezone}),chevronType:"right",right:(0,n(604995).GF)(i.timezone),disabled:s})})}));function Se(e){const{currentValue:t,onChange:n,disabled:r}=e;if("month"===t.frequency)return{key:"month_restriction",action:()=>{},render:e=>(0,I.jsx)(P,{...e,initialValue:t.monthly_restriction,startDateForFallback:t.start_date,onChange:e=>{n({...t,monthly_restriction:e})},disabled:r})}}const ve=(0,m().YK)({day:{id:"automations.RecurrencePresetMenu.day",defaultMessage:"Day"},weekday:{id:"automations.RecurrencePresetMenu.weekday",defaultMessage:"Weekday"},week:{id:"automations.RecurrencePresetMenu.week",defaultMessage:"Week"},twoWeeks:{id:"automations.RecurrencePresetMenu.twoWeeks",defaultMessage:"2 Weeks"},month:{id:"automations.RecurrencePresetMenu.month",defaultMessage:"Month"},threeMonths:{id:"automations.RecurrencePresetMenu.threeMonths",defaultMessage:"3 Months"},sixMonths:{id:"automations.RecurrencePresetMenu.sixMonths",defaultMessage:"6 Months"},year:{id:"automations.RecurrencePresetMenu.year",defaultMessage:"Year"}}),Re={day:ve.day,weekday:ve.weekday,week:ve.week,twoWeeks:ve.twoWeeks,month:ve.month,threeMonths:ve.threeMonths,sixMonths:ve.sixMonths,year:ve.year};function Ce(e){const{onSelect:t}=e,n=(0,T().e)(),r=[{key:"default",items:(0,p().WP)(Re).map((e=>{let[n]=e;return{key:n,action:()=>{t(function(e){const t=(0,d().QA)();switch(e){case"day":return{...t,frequency:"day"};case"weekday":return{...t,frequency:"week",weekdays:["MO","TU","WE","TH","FR"]};case"week":return{...t,frequency:"week",weekdays:["MO"]};case"twoWeeks":return{...t,frequency:"week",interval:2,weekdays:["MO"]};case"month":return{...t,frequency:"month"};case"threeMonths":return{...t,frequency:"month",interval:3};case"sixMonths":return{...t,frequency:"month",interval:6};case"year":return{...t,frequency:"year"};default:(0,p().HB)(e)}}(n))},render:e=>(0,I.jsx)(x().A,{...e,title:(0,I.jsx)(m().sA,{...Re[n]})})}})),render:e=>(0,I.jsx)(v().A,{...e})}];return(0,I.jsx)(j().A,{...n,children:(0,I.jsx)(A().Ay,{type:A().Oh.Vertical,sections:r,initialFocus:0})})}const _e=150;function Te(e){const{recurrence:t,onChange:n,disabled:u,autoFocusIfNew:c,requireExplicitSaveAndAllowDelete:l,buttonPopupStore:y,disallowStart:m=!1,disallowEnd:h=!1}=e,p=(0,a().uB)(y,o().A);(0,i().l)((()=>{c&&!t&&setTimeout((()=>{p.setState({open:!0})}),_e)}));const[f,g]=(0,r.useState)(),x=(0,r.useMemo)((()=>f||(t?{...(0,s().convertToUnpersistedRecurrenceConfig)(t),hour:t.hour??0,minute:t.minute??0}:(0,d().QA)())),[f,t]),[b,k]=(0,r.useState)(!1);(0,r.useEffect)((()=>{k((e=>e||Boolean(t)))}),[t]);const w=(0,r.useCallback)((e=>{if(g(e),!l){const t=Oe(e);n(t?e:void 0)}}),[n,l]),j=(0,r.useCallback)((()=>{n(void 0),k(!1),p.setState({open:!1})}),[n,p]),M=(0,r.useCallback)((e=>{g(e),l||n(e),p.setState({open:!1}),setTimeout((()=>{k(!0),p.setState({open:!0})}),_e)}),[l,p,n]),A=(0,r.useCallback)((()=>{g(void 0),k(Boolean(t))}),[t]),S=(0,r.useCallback)((()=>!(!t&&!f)&&(!t||!Oe(x)||!(0,s().areRecurrenceSchedulesEqual)(x,(0,s().convertToUnpersistedRecurrenceConfig)(t)))),[x,t,f]),v=(0,r.useMemo)((()=>{if(l)return S()&&Oe(x)?()=>{n(x),p.setState({open:!1})}:"disabled"}),[p,x,S,n,l]);return{render:(0,r.useCallback)((()=>b||t?(0,I.jsx)(me,{currentValue:x,onChange:w,onDelete:l?j:void 0,onSave:v,disabled:u,disallowStart:m,disallowEnd:h}):(0,I.jsx)(Ce,{onSelect:M})),[b,t,x,w,l,j,v,u,m,h,M]),onClose:A,buttonPopupStore:p,hasUnpersistedChanges:S}}function Oe(e){return ae(e)&&void 0!==(0,s().getNextDateUtc)((0,s().convertFromUnpersistedRecurrenceConfig)(e))}}}]);