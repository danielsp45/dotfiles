"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11922],{117686:(e,t,o)=>{o.r(t),o.d(t,{TimelineItemDateRange:()=>Y,propertiesWidth:()=>q,scrollArrowLeftOffset:()=>H,scrollArrowLeftOffsetAnimatePx:()=>X});o(581454);var r=o(296540),l=()=>o(484714),n=()=>o(56366),i=()=>o(401497),a=()=>o(693954),s=()=>o(959013),c=()=>o(496603),d=()=>o(284371),u=()=>o(415651),g=()=>o(778417),S=()=>o(751156),m=()=>o(519839),p=()=>o(740241),h=()=>o(74513),b=()=>o(743147),f=()=>o(164124),y=()=>o(187820),v=()=>o(16006),x=()=>o(524702),k=()=>o(862292),C=()=>o(38337),D=()=>o(405417),w=()=>o(792540),P=()=>o(645873),M=()=>o(695625),I=()=>o(217429),A=()=>o(230062),R=()=>o(717989),j=()=>o(690471),K=()=>o(259464),B=()=>o(603820),T=()=>o(953418),E=o(474848);const L=24;function F(e){const{store:t,schema:o,timelineState:a,dateValueStore:s,collectionContextStore:c,isFullScreen:d,isRootChild:u}=e,g=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1),h=(0,l().v3)(),b=(0,n().K8)((()=>{const e=a.drawStateStore.state;if(e)return e.startStore===t}),[t,a.drawStateStore]),f=(0,n().K8)((()=>!b&&a.hoveredItemStore.state===t&&!A().A.state),[b,t,a.hoveredItemStore]),y=(0,n().K8)((()=>(0,j().tH)(c)),[c]),v=(0,r.useCallback)((e=>{if(e.preventDefault(),!a.scrollLeftStore.state||!g.current)return;const r=(0,T().NM)(g.current);R().vt({timelineState:a,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:c,verticalScroller:r}),p(!1)}),[c,o,t,a]),x=(0,r.useCallback)((e=>{if(!g.current)return;const t=(0,T().NM)(g.current);R().GZ({timelineState:a,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[a]),k=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,canUndo:!0,perform:e=>{R().sd({timelineState:a,environment:h,transaction:e,collectionContextStore:c,isFullScreen:d,isRootChild:u})}})}),[h,a,c,d,u]),C=(0,r.useCallback)((e=>{R().P7({timelineState:a,environment:h})}),[h,a]),D=(0,r.useCallback)((()=>{p(!0)}),[p]),w=(0,r.useCallback)((()=>{p(!1)}),[p]),P=(0,i().IS)((e=>({draggableStyle:{position:"absolute",top:0,right:-L,width:L,height:"100%",zIndex:1,isolation:"auto"},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:y?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:j().cC},svgCircleFill:{color:e.white}})),[y]),M=(0,r.useCallback)((e=>{if(!s.state)return;return(0,E.jsx)("div",{ref:g,style:P.draggableStyle,...e,children:f&&(0,E.jsx)("div",{style:P.draggableSvgStyle,children:(0,E.jsxs)("svg",{style:{width:22,height:30},onMouseMove:D,onMouseLeave:w,children:[(0,E.jsx)(K().A,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:P.svgPathStyle,showArrowHead:m}),(0,E.jsx)("circle",{cx:m?10+j().EZ:10,cy:14,r:m?j().EZ:j().w7,style:P.svgPathStyle,fill:P.svgCircleFill.color})]})})})}),[s,w,D,f,P.draggableStyle,P.draggableSvgStyle,P.svgCircleFill.color,P.svgPathStyle,m]);return(0,E.jsx)(B().A,{render:M,onDraggableDragStart:v,onDraggableDragMove:x,onDraggableDragEnd:k,onDraggableDragCancel:C})}var z=()=>o(839106);const V={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},W={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function N(e){let{type:t,store:o,query:a,schema:c,timelineState:d,dateValueStore:u,collectionContextStore:g,isInPeekRenderer:m,isFullScreen:p,isRootChild:b}=e;const f=(0,l().v3)(),y=(0,s().tz)(),[v,x]=(0,r.useState)(!1),{value:C}=(0,P().fJ)(k().T.formulas),D=(0,n().K8)((()=>{const e=d.dragStateStore.state;return e?e.stores[0]===o&&("left"===t?e.type===j().MB.LeftResizer:e.type===j().MB.RightResizer):v&&!A().A.state}),[v,o,d,t]),w=(0,n().O$)(u),M=(0,n().O$)(d.zoomLevelStore),I=(0,i().IS)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.text.primary},o={fontSize:12,position:"absolute",width:200,lineHeight:`${h().V}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:m?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:6}}}),[m]),K=(0,r.useCallback)((()=>x(!0)),[]),T=(0,r.useCallback)((()=>x(!1)),[]),L=(0,r.useCallback)((e=>{R().GB({timelineState:d,currentX:e.currentX})}),[d]),F=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:f,canUndo:!0,perform:e=>{R().eW({timelineState:d,collectionContextStore:g,query:a,schema:c,intl:y,environment:f,transaction:e})}}),(0,z().gp)(f,{...(0,z().ZR)({environment:f,collectionContextStore:g,timelineState:d,isFullScreen:p,isRootChild:b}),type:t})}),[g,f,y,p,b,a,c,d,t]),N=(0,r.useCallback)((e=>{e.preventDefault(),R().v7({timelineState:d,store:o,startX:e.startX,type:"left"===t?j().MB.LeftResizer:j().MB.RightResizer,query:a,schema:c,intl:y,environment:f,formulasModule:C})}),[f,y,a,c,o,d,t,C]),O=(0,r.useCallback)((()=>{R().Pt({timelineState:d,environment:f})}),[f,d]),$=(0,r.useCallback)((e=>{const o="left"===t;if(w)return(0,E.jsx)("div",{style:o?W:V,onMouseMove:K,onMouseLeave:T,...e,children:D&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:o?I.leftDraggableIndicator:I.rightDraggableIndicator}),(0,E.jsx)("span",{style:o?I.leftDraggableLabel:I.rightDraggableLabel,children:(0,E.jsx)("span",{style:I.timelineBackground,children:o?(0,j()._D)(w,M):(0,j().ji)(w,M)})})]})})}),[w,M,T,K,D,I,t]);return(0,E.jsx)(B().A,{render:$,onDraggableDragStart:N,onDraggableDragMove:L,onDraggableDragEnd:F,onDraggableDragCancel:O})}const O=r.memo(N,o(821062).A),$=(0,s().YK)({typeAName:{defaultMessage:"Type a nameâ€¦",id:"timelineItem.itemName.placeholder"}}),H=21,X=48,q=800,U=400;var Z=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(Z||{});function _(e){const{timelineState:t,scrollerLeftOffset:a,itemPositionStore:c,store:d,query:u,schema:g,dateValueStore:p,disabled:b,isDraggingViaTimelineItemStore:f,collectionContextStore:y,isFullScreen:v,isRootChild:x,parentStore:D,toggleButton:w,isInPeekRenderer:M,handleOpenPeekPage:K,showProperties:B,clonedStore:T,blockPropertyValueOverlayStore:L,propertiesWrapElementRef:z}=e,V=(0,l().v3)(),W=(0,s().tz)(),{value:N}=(0,P().fJ)(k().T.formulas),$=(0,n().K8)((()=>c.state),[c]),X=(0,n().K8)((()=>{if($){const{left:e,right:o}=$,r=o-e;if(!((0,j().zZ)(V)&&r>50))return{position:Z.Absolute,left:e};{const l=t.scrollLeftStore.state;if(void 0!==l){const t=l+a-e+H;if(t<0)return{position:Z.Absolute,left:e};if(t>r)return{position:Z.Absolute,left:o};if(t>0)return{position:Z.Sticky,left:a+H}}}}}),[V,$,a,t.scrollLeftStore]),U=(0,n().K8)((()=>{var e;const t=o(24157).default.state;if("editing"!==t.mode)return!1;const r=null===(e=(0,o(231722).H7)(t.multiSelection))||void 0===e?void 0:e.store;return d&&r&&r===d.getBlockTitleStore()}),[d]),_=(0,n().K8)((()=>(0,j().tH)(y)),[y]),Y=(0,n().K8)((()=>t.hoveredItemStore.state===d),[d,t.hoveredItemStore]),ee=(0,n().K8)((()=>{const{mainEditorCurrentBlockStore:e}=o(765957).default.state;if(d&&e)return m().wy({environment:V,store:d,mainEditorCurrentBlockStore:e,collectionContextStore:y,fullyQualified:!1})}),[V,y,d]),oe=(0,n().K8)((()=>{if(d)return(0,o(492414).Ay)({store:d,fullyQualified:!1,pageVisitSource:o(584262).y8.LinkInPage})}),[d]),re=(0,n().K8)((()=>!b&&(null==d?void 0:d.canEdit())),[b,d]),le=(0,l().WS)(),ne=(0,n().K8)((()=>"collectionTypedView"===y.contextType),[y]),ie=(0,n().K8)((()=>re&&!le&&(_||y.permissionScopesStore.state.canConfigureBlock)&&!ne),[re,y.permissionScopesStore,le,ne,_]),ae=(0,n().K8)((()=>y.currentSubitemFormatStoreForUiDisplayStore.state),[y]),se=ae?42:10,ce=$?Math.max($.right-$.left,se)+1:se+1,de=(0,n().K8)((()=>f.state),[f]),ue=(0,n().K8)((()=>{const e=D,t=(0,o(873050).AU)({collectionContextStore:y,collectionStore:e,environment:V}),r=null==d?void 0:d.getModel(),l=null==d?void 0:d.getRecordModel;if(!t||!r||!l)return!0;const n=I().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,o(289915).oR)(t)({block:r,getRecordModel:l,propertyMapping:null==e?void 0:e.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+n,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:I().default,formulasModule:N})}),[y,V,D,d,N]),ge=(0,n().K8)((()=>d&&(0,o(97059).W)(V,d.id)),[V,d]),Se=(0,n().O$)(y.isInHomeWidgetStore),me=(0,n().K8)((()=>!!d&&m().NM(d)),[d]),pe=(0,n().K8)((()=>{const e=t.drawStateStore.state;return e&&e.startStore!==d}),[d,t.drawStateStore]),he=(0,r.useMemo)((()=>(0,E.jsx)(G,{collectionContextStore:y,toggleButton:w,itemPositionStore:c})),[y,c,w]),be=(0,i().IS)((e=>({linkBoxStyle:{width:"100%",height:"100%",borderRadius:6},linkBoxInnerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:6},container:{position:"absolute",left:null==$?void 0:$.left,marginTop:1,marginBottom:1,width:ce,height:h().V-2,borderRadius:6,display:"flex",...null!=$&&$.isExistingSubitemPlaceholder?void 0:{..."light"===e.mode?{background:null!=$&&$.isPlaceholder?e.buttonHoveredBackground:e.contentBackground,boxShadow:null!=$&&$.isPlaceholder?void 0:e.buttonBoxShadow}:{background:M?e.calendarItemBackground:e.popoverBackground,boxShadow:null!=$&&$.isPlaceholder?void 0:e.shadowSM}},...(null==$?void 0:$.isPlaceholder)&&{cursor:"crosshair"},...de&&{display:"none"},...!ue&&{opacity:.5},...ge&&{opacity:.5},zIndex:85},halo:{...m().wh(e,me),borderRadius:6},propertiesContainer:{width:"100%",WebkitMaskImage:null!=$&&$.maskPercent&&(null==$?void 0:$.maskPercent)<1&&Y?`linear-gradient(90deg, rgba(0,0,0,1) ${100*$.maskPercent}%, rgba(0,0,0,0.4) ${100*$.maskPercent}%)`:void 0,pointerEvents:"none",...de&&{display:"none"},zIndex:85,opacity:!ue||ge?.5:1},propertiesWrapInnerStyle:{display:"flex",height:h().V-2+1,paddingLeft:ae&&he?24:6,width:q,overflow:"hidden"}})),[de,Y,M,ue,$,me,ae,he,ce,ge]),fe=(0,r.useCallback)((()=>{const e=null==z?void 0:z.current,t=X;e&&t&&(e.style.position=t.position===Z.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)}),[X,z]),ye=(0,r.useMemo)((()=>(0,E.jsx)("div",{style:be.propertiesContainer,children:(0,E.jsx)("div",{style:be.propertiesWrapInnerStyle,ref:z,className:C().st6,children:B.map(((e,t)=>(0,E.jsx)(te,{showProperties:B,store:d,disabled:b,blockPropertyValueOverlayStore:L,clonedStore:T,collectionContextStore:y,parentStore:D,editingTitle:U,property:e,index:t},e)))})})),[L,T,y,b,U,D,z,B,d,be]),ve=(0,r.useCallback)((e=>{d&&(t.dragStateStore.state||R().v7({timelineState:t,store:d,startX:e.startX,type:j().MB.ItemDrag,query:u,schema:g,intl:W,environment:V,formulasModule:N}),R().GB({timelineState:t,currentX:e.currentX}))}),[t,d,u,g,W,V,N]),xe=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:V,canUndo:!0,perform:e=>{R().eW({timelineState:t,collectionContextStore:y,query:u,schema:g,intl:W,environment:V,transaction:e})}})}),[t,y,u,g,W,V]),ke=(0,r.useCallback)((()=>{R().Pt({timelineState:t,environment:V})}),[t,V]),Ce=(0,r.useCallback)((e=>{const o=t.dragStateStore.state;(A().A.state||o)&&!pe||V.device.isPhone||t.hoveredItemStore.setState(d)}),[t,pe,V,d]),De=(0,r.useCallback)((()=>{const e=t.dragStateStore.state;A().A.state}),[t,pe]);return(0,r.useEffect)((()=>{fe()}),[X,fe]),$?!d||null!=$&&$.isPlaceholder?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:be.container,className:C().KfS}),ye]}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(o(199896).Ay,{style:be.container,haloStyle:be.halo,className:C().KfS,store:d,canSelect:!0,shouldShowHalo:!Se,shouldForceRenderSelectionHalo:me,canDrag:re,analyticsName:"timeline",onDraggableDragStart:Q,onDraggableDragMove:ve,onDraggableDragEnd:xe,onDraggableDragCancel:ke,canTriggerContextMenu:re,getGhostElement:J,disableScrollToReveal:!0,onMouseMove:Ce,onMouseLeave:De,showBlockMenuInput:!0,children:[he,(0,E.jsx)(o(296798).A,{style:be.linkBoxStyle,innerStyle:be.linkBoxInnerStyle,onClick:K,href:oe,metaHref:ee,hovered:Y,ignoreLocalHoverState:!0,disableForOffline:ge}),ie&&d&&(0,E.jsx)(F,{store:d,isFullScreen:v,isRootChild:x,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:y}),re&&!le&&(0,E.jsx)(O,{type:"left",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:y,isFullScreen:v,isInPeekRenderer:M,isRootChild:x}),re&&!le&&(0,E.jsx)(O,{type:"right",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:y,isFullScreen:v,isInPeekRenderer:M,isRootChild:x})]}),ye]}):null}const Y=r.memo(_);function G(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;const l=(0,n().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(0,n().O$)(r);return!l||!o||null!=i&&i.isExistingSubitemPlaceholder?null:(0,E.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function Q(e){e.preventDefault()}function J(e){const t=M().T.findSelectablesFromStore(e),o=c().oE(t.map((e=>e.getNode()))),r=c().oE(o.map((e=>e.closest(`.${C().ZLF}`))))[0];if(r){const e=u().up(r),t=e.cloned.querySelector(`.${C().KfS}`),o=e.cloned.querySelector(`.${C().st6}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(u().up)}function ee(e){let{isLast:t,store:o,collectionContextStore:u,parentStore:S,editingTitle:m}=e;const p=(0,i().DP)(),h=(0,l().v3)(),k=(0,s().tz)(),C=(0,n().K8)((()=>null==o?void 0:o.getIcon()),[o]),P=(0,n().K8)((()=>null==u?void 0:u.shouldShowPageIcon()),[u]),M=(0,n().K8)((()=>null==o?void 0:o.hasError()),[o]),I=(0,n().K8)((()=>!o||o.isEmptyPage()),[o]),A=(0,n().K8)((()=>(0,y().Te)(o)),[o]),R=(0,n().O$)(u.currentSubitemFormatStoreForUiDisplayStore),j=(0,n().K8)((()=>{var e;return R&&S?null===(e=S.getSchema()[R.property])||void 0===e?void 0:e.name:""}),[S,R]),K=(0,n().K8)((()=>null==o?void 0:o.getBlockTitleStore()),[o]),B=(0,n().K8)((()=>o&&(0,D().xC)({collectionContextStore:u,blockStore:o})),[u,o]),T=(0,n().K8)((()=>o&&(0,D().Kk)({collectionContextStore:u,blockStore:o})),[u,o]),L=(0,r.useCallback)((()=>{o&&g().Lt({environment:h,store:o})}),[h,o]);return(0,E.jsxs)("div",{style:{display:"flex",marginRight:t?0:10,fontSize:14,fontWeight:d().Wy.medium,alignItems:"center"},children:[P&&C&&!M&&(0,E.jsx)(y().B6,{disabled:!0,icon:C,iconRecordCategory:A,isEmptyPage:I,size:20,style:{marginLeft:2,marginRight:6}}),M&&(0,a().Q)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:p.palette.orange[500]}),o&&!m&&(0,E.jsx)(v().A,{style:{whiteSpace:"nowrap",maxWidth:U},store:o}),m&&o&&K&&(0,E.jsx)(x().A,{store:K,style:{whiteSpace:h.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:L,onEsc:L,onTab:c().D_,placeholder:k.formatMessage($.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:w().Os.none}),o&&B&&(0,E.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,E.jsx)(b().n,{blockStore:o,collectionContextStore:u})}),o&&T&&(0,E.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:p.text.tertiary},children:(0,E.jsx)(f().W,{blockStore:o,collectionContextStore:u})}),!o&&(0,E.jsx)("span",{children:S&&j?(0,E.jsx)(s().sA,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:j}}):(0,E.jsx)(s().sA,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function te(e){let{property:t,index:o,showProperties:r,store:l,disabled:i,blockPropertyValueOverlayStore:a,clonedStore:s,collectionContextStore:c,parentStore:d,editingTitle:u}=e;const g=o===r.length-1,S=(0,n().K8)((()=>null==l?void 0:l.getAssociatedCollectionStore()),[l]),m=(0,n().K8)((()=>null==l?void 0:l.canEdit()),[l]),h=(0,n().K8)((()=>c.collectionViewStore()),[c]);return S?"title"===t?(0,E.jsx)(ee,{store:l,collectionContextStore:c,parentStore:d,editingTitle:u,isLast:g}):l&&s?(0,E.jsx)(p().BlockPropertyRouter,{store:s,property:t,disabled:i||!m,locked:!1,format:"timeline",tableWrap:!1,isLast:g,blockPropertyValueOverlayStore:a,enablePointerEventsForInteractiveTypes:!0,collectionStore:S,collectionViewStore:h},t):null:null}}}]);