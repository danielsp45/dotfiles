"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22114],{140612:(e,t,s)=>{s.d(t,{w:()=>o});var r=()=>s(2220);function o(e,t){const{spaceId:s,pageId:o,joinSpaceMethod:a}=t;(0,r().u)({environment:e,event:{eventName:"trusted_domain_banner_cta_clicked",eventProperties:{spaceId:s,pageId:o,joinSpaceMethod:a}}})}},322114:(e,t,s)=>{s.d(t,{A:()=>B});var r=s(296540),o=()=>s(484714),a=()=>s(56366),c=()=>s(757695),n=()=>s(959013),i=()=>s(381349),l=()=>s(534177),u=()=>s(284371),d=()=>s(530216),p=()=>s(701763),m=()=>s(140612),g=()=>s(449506),y=()=>s(898486),f=()=>s(722872),b=()=>s(249847),v=()=>s(10984),_=()=>s(251126),A=()=>s(805751),q=()=>s(623580),x=()=>s(928600),I=()=>s(864943),h=()=>s(204063),k=s(474848);const j={marginBottom:10},S={...j,width:"100%",height:"100%",padding:10,alignItems:"top",borderRadius:0},w=(0,n().YK)({requestAccessMessagePlaceholder:{defaultMessage:"Message (optional)",id:"requestAccessForm.messageInput.placeholder"},rateLimitError:{defaultMessage:"You have recently requested access to this page.",id:"requestAccessForm.errorMessage.rateLimit"},currentUserNotFound:{defaultMessage:"Current user not found.",id:"requestAccessForm.errorMessage.currentUserNotFound"}});function C(){return(0,k.jsx)(n().sA,{defaultMessage:"Cancel",id:"requestAccessForm.cancelButton.label"})}const M=c().Store.createClass(0,{name:"RequestAttemptStore"}),T=c().Store.createClass(void 0,{name:"MessageStore"});const B=function(e){const t=(0,o().v3)(),c=(0,o().WS)(),i=(0,a().uB)(e.popupStore,s(463830).A),l=(0,a().uB)(void 0,T),p=(0,a().uB)(void 0,M),g=(0,r.useCallback)((()=>N(i)),[i]),y=(0,r.useCallback)((()=>(0,k.jsx)(U,{...e,requestAttemptStore:p,messageStore:l,buttonPopupStore:i})),[e,p,l,i]),f=(0,a().K8)((()=>p.state>0),[p]),b=(0,a().K8)((()=>i.state.open),[i]);if("current-actor-to-block"===e.type)return(0,k.jsx)(W,{type:"page",block:e.block,flowId:e.flowId,buttonType:e.buttonType});if("current-actor-to-collection"===e.type)return(0,k.jsx)(W,{type:"collection",collection:e.collection,flowId:e.flowId,buttonType:e.buttonType});const v="primary"===e.buttonType?h().A:I().A,_=c?(0,k.jsx)(s(897119).Ay,{popupType:s(377586).n.SlideUp,open:b,render:y}):(0,k.jsx)(s(676007).a,{open:b,onDismiss:g,render:y});return"current-actor-to-space-via-onboarding"===e.type?_:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(v,{size:"lg",disabled:f,onClick:()=>{var s,r;return function(e,t){const{environment:s,flowId:r,type:o,source:a,spaceId:c,pageId:n}=e;"trusted_domain_page"===a&&c&&m().w(s,{spaceId:c,pageId:n,joinSpaceMethod:"request_to_join"});"current-actor-to-block"===o?d().Xx(s,{button_name:"request-access",flow_id:r,request_access_type:"page"}):"current-actor-to-space-via-team"===o&&d().Xx(s,{button_name:"request-access",flow_id:r,request_access_type:"team"});t.setState({open:!0})}({environment:t,flowId:e.flowId,type:e.type,source:e.source,pageId:null===(s=e.block)||void 0===s?void 0:s.id,spaceId:null===(r=e.block)||void 0===r?void 0:r.spaceId},i)},style:"outline"===e.buttonType?{...e.buttonStyle,fontWeight:u().Wy.semibold}:e.buttonStyle,children:f?(0,k.jsx)(n().sA,{id:"fullPageError.requestAccessButton.requested",defaultMessage:"Requested access"}):(0,k.jsxs)(s(21140).Ye,{gap:4,alignItems:"center",justifyContent:"center",children:[e.icon,z(e.type)]})}),_]})};function R(e){let{result:t}=e;return t&&t.error?(0,k.jsx)("div",{style:{color:i().Ay.redWithAlpha(1),textAlign:"center",width:"100%",marginBottom:16},children:t.error}):null}function F(e){e.update((e=>e+1))}function N(e){return e.setState({open:!1})}function P(e){let{error:t,result:s,ready:c,requestAttemptStore:i,messageStore:l,type:d}=e;const p=(0,n().tz)(),m=(0,o().WS)(),g=(0,r.useCallback)((()=>F(i)),[i]),y=(0,r.useCallback)((e=>function(e,t){t.setState(e.target.value)}(e,l)),[l]),f=(0,a().K8)((()=>Boolean(0===i.state||c&&s&&s.error)),[i,c,s]),b=(0,a().K8)((()=>l.state||""),[l]);return(0,k.jsxs)(k.Fragment,{children:[!m&&(0,k.jsx)("div",{style:{fontSize:16,fontWeight:u().Wy.semibold,marginBottom:16},children:z(d)}),(0,k.jsx)(q().A,{format:m?q().C.Transparent:void 0,textarea:!0,value:b,onChange:y,disabled:!f,placeholder:p.formatMessage(w.requestAccessMessagePlaceholder),style:{...m?{...S,padding:"16px"}:{...j,marginBottom:16,padding:"8px 12px",alignItems:"flex-start"}}}),!m&&(0,k.jsx)(h().A,{size:"lg",disabled:!f,onClick:g,style:j,children:(0,k.jsx)(n().sA,{defaultMessage:"Send request",id:"requestAccessForm.sendRequestButton.label"})}),(0,k.jsx)(R,{result:s})]})}function U(e){const{requestAttemptStore:t,messageStore:s,buttonPopupStore:c}=e,i=(0,o().v3)(),u=(0,o().WS)(),d=(0,n().tz)(),m=(0,r.useCallback)(((r,o,a)=>(0,k.jsx)(P,{requestAttemptStore:t,messageStore:s,error:r,result:o,ready:a,type:e.type})),[t,s,e.type]),v=(0,b().T)(),q=(0,r.useCallback)((t=>async function(e){const{messageStore:t,buttonPopupStore:s,type:r,teamId:o,requestAttempt:a,environment:c,currentUserId:n,intl:i,flowId:u}=e;if(0===a)return;const d=t.state,m=await async function(){if("current-actor-to-block"===r)return g().callApi({eventName:"requestAccess",environment:c,data:{type:"current-actor-to-block",block:e.block,message:d}});if("current-actor-to-collection"===r)return g().callApi({eventName:"requestAccess",environment:c,data:{type:"current-actor-to-collection",collection:e.collection,message:d}});if("current-actor-to-space-via-team"===r)return g().callApi({eventName:"requestAccess",environment:c,data:{type:"current-actor-to-space-via-team",teamId:o,message:d}});if("current-actor-to-space-via-block"===r){if(!n)return;return g().callApi({eventName:"requestAccess",environment:c,data:{type:"actor-to-space",spaceId:e.block.spaceId,message:d,forActorId:n,attributes:{add_permissions_on_approval:!1,origin_type:"trusted_domain_page"}}})}if("current-actor-to-space-via-onboarding"===r){if(!n)return;return g().callApi({eventName:"requestAccess",environment:c,data:{type:"actor-to-space",spaceId:e.spaceId,message:d,forActorId:n,attributes:{add_permissions_on_approval:!1,origin_type:"onboarding"}}})}if("current-actor-to-space-via-workspace-discovery"===r){if(!n)return;return g().callApi({eventName:"requestAccess",environment:c,data:{type:"actor-to-space",spaceId:e.spaceId,message:d,forActorId:n,attributes:{add_permissions_on_approval:!1,origin_type:"workspace_discovery"}}})}}();return m?"success"!==m.type?"UserRateLimitResponse"===(null===(f=m.body)||void 0===f?void 0:f.name)?{error:i.formatMessage(w.rateLimitError)}:{error:(0,y().Hu)(i,m)}:("current-actor-to-block"===r?p().T_(c,{request_access_type:"page",flow_id:u,requestId:m.data.requestId}):"current-actor-to-space-via-team"===r?p().T_(c,{request_access_type:"team",flow_id:u}):"current-actor-to-space-via-block"===r?p().T_(c,{request_access_type:"space",flow_id:u,source:"trusted_domain_page"}):"current-actor-to-collection"===r?p().T_(c,{request_access_type:"collection",flow_id:u,requestId:m.data.requestId}):"current-actor-to-space-via-onboarding"===r?p().T_(c,{request_access_type:"space",flow_id:u,source:"onboarding"}):"current-actor-to-space-via-workspace-discovery"===r?p().T_(c,{request_access_type:"space",flow_id:u,source:"workspace_discovery"}):(0,l().HB)(r),s.reset(),{value:!0}):{error:i.formatMessage(w.currentUserNotFound)};var f}({...e,requestAttempt:t,environment:i,intl:d,currentUserId:v})),[i,d,e,v]),h=(0,r.useCallback)((()=>F(t)),[t]),j=(0,r.useCallback)((()=>N(c)),[c]),S=(0,a().O$)(t);return u?(0,k.jsx)(x().A,{menuType:f().gu.Modal,whiteBackground:!0,title:z(e.type),left:C(),onClickLeft:j,right:(0,k.jsx)(n().sA,{id:"requestAccessForm.mobileSend.label",defaultMessage:"Send"}),onClickRight:h,children:(0,k.jsx)(A().A,{debugName:"RequestAccessForm",capture:!0,children:(0,k.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",width:"100%",height:"100%"},children:(0,k.jsx)(_().A,{request:S,performRequest:q,render:m})})})}):(0,k.jsx)(A().A,{debugName:"RequestAccessForm",capture:!0,children:(0,k.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-evently",alignItems:"stretch",padding:"20px 28px 24px",width:"340px"},children:[(0,k.jsx)(_().A,{request:S,performRequest:q,render:m}),(0,k.jsx)(I().A,{size:"lg",onClick:j,children:C()})]})})}function W(e){const{type:t,flowId:s,buttonType:c}=e,i=(0,o().v3)(),u="outline"===c?I().A:h().A,[d,m]=(0,r.useState)(!1),[y,f]=(0,r.useState)(!1),b={attributes:{add_permissions_on_approval:!1,role:(0,a().K8)((()=>(0,v().dL)()),[])?"reader":"read_and_write"},message:void 0};let _;"page"===t?_={...b,type:"current-actor-to-block",block:{id:e.block.id,spaceId:e.block.spaceId}}:"collection"===t?_={...b,type:"current-actor-to-collection",collection:{id:e.collection.id,spaceId:e.collection.spaceId}}:(0,l().HB)(t);const A=(0,r.useCallback)((async()=>{var e;const r=await g().callApi({eventName:"requestAccess",environment:i,data:_});"success"===r.type&&r.data.request?(m(!0),p().T_(i,{request_access_type:t,previous_access_level:"none",requested_access_level:"read_and_write",flow_id:s,requestId:r.data.requestId})):"failed"===r.type&&"UserRateLimitResponse"===(null===(e=r.body)||void 0===e?void 0:e.name)&&f(!0)}),[i,_,t,s]);return(0,k.jsx)(u,{size:"lg",disabled:d||y,disabledFeedback:d||y,onClick:A,style:e.buttonStyle,children:d?(0,k.jsx)(n().sA,{id:"fullPageError.requestAccessButton.edit.Requested",defaultMessage:"Requested access"}):y?(0,k.jsx)(n().sA,{id:"fullPageError.requestAccessButton.edit.TryAgain",defaultMessage:"Try again later"}):z("page"===t?"current-actor-to-block":"current-actor-to-collection")})}function z(e){return"current-actor-to-space-via-block"===e||"current-actor-to-space-via-onboarding"===e?(0,k.jsx)(n().sA,{defaultMessage:"Request membership",id:"requestAccessForm.requestAccessToSpaceButton.title"}):(0,k.jsx)(n().sA,{defaultMessage:"Request access",id:"requestAccessForm.requestAccessButton.title"})}}}]);