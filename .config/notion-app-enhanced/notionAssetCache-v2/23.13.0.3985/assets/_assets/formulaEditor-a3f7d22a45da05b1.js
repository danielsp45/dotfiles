"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22542,55776],{66529:(e,t,n)=>{n.r(t),n.d(t,{canAcceptAutocompletionsWithoutDot:()=>g,getFormulaEditorInfoAtPosition:()=>I});n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(354520),n(672577),n(803949),n(581454);var o=()=>n(303151),r=()=>n(778078),i=()=>n(763824),a=()=>n(973647),s=()=>n(534177),c=()=>n(510916),l=()=>n(958970),p=()=>n(247331),u=()=>n(106714),d=()=>n(44907),y=()=>n(871202),m=()=>n(844698),f=()=>n(349835),h=()=>n(977345),v=()=>n(628048);async function T(e,t,n){const o=[],r=new Set;if(void 0!==e){const a=t.handleDataRequest({recordPointers:[e]}),c=((0,i().yL)(a)?await a:a).getRecordModel(e),l=null==c?void 0:c.getNormalizedSchema();if(l)for(const[i,u]of Object.entries(l))if(void 0!==(null==u?void 0:u.type)&&(0,s().Xk)(p().FormulaTokenSupportedBlockSystemPropertyList,null==u?void 0:u.type)&&r.add(u.type),i!==t.sourceProperty&&null!=u&&u.name&&p().FORMULAS_SUPPORTED_COLLECTION_PROPERTY_TYPES.includes(null==u?void 0:u.type)&&k(n,u.name)){let n;"cross_space_only"===t.restrictUnaccessibleProperties?n=y().hasSameSpaceAccess:"read_permissions_only"===t.restrictUnaccessibleProperties?n=y().hasReadPermissionsAccess:"cross_space_and_read_permissions"===t.restrictUnaccessibleProperties&&(n=y().hasAccessDefaultFn);(!t.restrictUnaccessibleProperties||!n||await(0,y().hasAccessToProperty)({collectionPointer:e,collectionSchema:l,context:t,propertyId:i,hasAccessFn:n}))&&o.push({kind:p().FormulaEditorInfoCompletionKind.Token,name:u.name,token:{type:p().FormulaTokenType.BlockProperty,property:(0,h().XH)(i),collection:e}})}}for(const i of Object.values(p().FormulaTokenSupportedBlockSystemProperty)){if(r.has(i))continue;const e=(0,c().i)(i);(""===n||k(n,e))&&o.push({kind:p().FormulaEditorInfoCompletionKind.Token,token:{type:p().FormulaTokenType.BlockProperty,property:i,collection:void 0},name:e})}return o}function k(e,t){return""===e||(0,r().It)(e,t)}async function b(e){const{prefix:t,context:n,receiverType:o,includeDeprecatedCompletions:i,dotMemberExpression:a,allowCountFunction:s}=e,c=[],l=[],u=[],d=new Set;if(void 0===o){var y;n.valueTypes.forEach((e=>{if(e.kind===p().FormulaContextValueKind.Binding){const n=e.id;!d.has(n)&&t!==e.id&&k(t,e.id)&&(c.push({kind:p().FormulaEditorInfoCompletionKind.Binding,text:n,type:e.type}),d.add(n))}}));const e=null===(y=n.valueTypes.find((e=>e.kind===p().FormulaContextValueKind.ThisRow)))||void 0===y?void 0:y.type;"block"===(null==e?void 0:e.type)&&void 0!==e.collection&&l.push(...await T(e.collection,n,t)),n.valueTypes.forEach((e=>{if(e.kind===p().FormulaContextValueKind.ContextValue&&k(t,e.name)){const t=(0,h().Bk)(e.id);l.push({kind:p().FormulaEditorInfoCompletionKind.Token,name:e.name,token:{type:p().FormulaTokenType.ContextValue,valueId:t}})}}))}else"block"===o.type&&l.push(...await T(o.collection,n,t));for(const r in v().LP)if(!d.has(r)&&k(t,r)&&(i||!r.startsWith("_"))&&("count"!==r||s)&&("toNumber"!==r||null==o||!o.type||!v().Qi.includes(o.type))&&(!a||!v().bq.includes(r))){const e=v().LP[r];if(void 0!==o){var m,f;const t=(null===(m=e.parameters)||void 0===m||null===(m=m.expected)||void 0===m||null===(m=m[0])||void 0===m?void 0:m.type)??(null===(f=e.parameters)||void 0===f||null===(f=f.varargs)||void 0===f||null===(f=f[0])||void 0===f?void 0:f.type);if(void 0===t||!(0,h().s7)(o,t))continue}u.push({kind:p().FormulaEditorInfoCompletionKind.LibraryFunction,libraryFunction:e}),d.add(r)}return[...(0,r().Ay)(t,c,(e=>e.text)),...(0,r().Ay)(t,l,(e=>e.name??"")),...(0,r().Ay)(t,[],(e=>e.builtin)),...(0,r().Ay)(t,u,(e=>e.libraryFunction.name))]}function x(e,t){const n=[...e].reverse().find((e=>e.kind===f().NM.Call));if((null==n?void 0:n.kind)===f().NM.Call){let e=-1;if(t>n.lParenOffset&&(void 0===n.rParenOffset||t<=n.rParenOffset))for(e=0;e<n.commaOffsets.length&&!(n.commaOffsets[e]>t);e++);return{expression:n.expression,parameterIndex:e}}}const P={[p().FormulaEditorInfoCompletionKind.Binding]:0,[p().FormulaEditorInfoCompletionKind.Token]:1,[p().FormulaEditorInfoCompletionKind.Builtin]:2,[p().FormulaEditorInfoCompletionKind.LibraryFunction]:3};function g(e){const{nodeAtPosition:t,dotMemberExpression:n}=e;return!(!n||!t)&&(t.kind===f().NM.NotionToken||t.kind===f().NM.MemberBlockProperty||t.kind===f().NM.Call||t.kind===f().NM.Boolean||t.kind===f().NM.Number||t.kind===f().NM.String||t.kind===f().NM.Array)}async function I(e){var t,n;const{formula:r,inputPosition:i,context:s,includeDeprecatedCompletions:c,isBetterFormulaCompletionsEnabled:y}=e,[T,I]=(0,u().kb)(r),F=(0,u().NZ)(I,i);let M=T.substring(0,F);const A=M[M.length-1],N=/[\s.]/.test(A);N&&(M=`${M}_`);const E=(0,d().p8)(),S=(0,d().TM)(E).tokenize(M).tokens,R=(0,d()._M)(E);R.input=S;const w=R.expression(),O=(0,l().f)(w);if(a().Q.isFail(O))return{value:void 0};const X=await(0,m()._)(O.value,s,I),{node:U}=X,D=S[S.length-1];let _=!1,W=S;void 0!==D&&(0,o().G)(D,E.IdentifierName)&&(W=[...W],W.pop(),_=!0);const B=R.computeContentAssist("expression",W),L=_?D.image.substring(0,D.image.length-(N?1:0)):void 0,z=(0,h().Kp)(U,F),V=z.at(-1),K={inputPosition:i,mappedPosition:F,nodePath:z,callParameter:x(z,F)};if(S.find((e=>e.tokenType===E.UnclosedStringLiteral)))return K.completions=[],{value:K};const G=[],H=x(z,F),q={handleDataRequest:s.handleDataRequest,restrictUnaccessibleProperties:s.restrictUnaccessibleProperties,sourceProperty:s.sourceProperty,spaceId:s.spaceId,valueTypes:U.valueTypes,featureGates:s.featureGates};let j;for(let o=1;o<=5;o++){const e=(0,h().Kp)(U,F-o);if(j=e[e.length-1],void 0!==j)break}(null===(t=j)||void 0===t?void 0:t.kind)===f().NM.RecoveryNode&&(j=void 0);const Q=void 0!==j&&(y||0===z.length),$=!j||j.kind===f().NM.Unary||j.kind===f().NM.Equality||j.kind===f().NM.Identifier,J=!j||j.kind===f().NM.Equality||j.kind===f().NM.Identifier;for(const o of B){var Y,Z,ee,te,ne,oe,re,ie,ae;if(o.nextTokenType===E.IdentifierName||o.nextTokenType===E.Dot){const e="dotMemberExpression"===o.ruleStack[o.ruleStack.length-1];if(V&&e){if(V.kind===f().NM.UnifiedFunctionProperty){const t=V.expression;K.completionsInfo={type:"member dot receiver",prefix:L,receiverNode:t};const n=await b({prefix:L??"",context:q,receiverType:t.type,includeDeprecatedCompletions:c,dotMemberExpression:e,allowCountFunction:Boolean(s.featureGates.formulas_count_function)});G.push(...n)}else if(y&&g({nodeAtPosition:V,dotMemberExpression:e})){K.completionsInfo={type:"member dot receiver",prefix:L,receiverNode:V};const t=await b({prefix:L??"",context:q,receiverType:V.type,includeDeprecatedCompletions:c,dotMemberExpression:e,allowCountFunction:Boolean(s.featureGates.formulas_count_function)});G.push(...t)}}else{K.completionsInfo={type:"free identifier",prefix:L};const t=await b({prefix:L??"",context:q,includeDeprecatedCompletions:c,dotMemberExpression:e,allowCountFunction:Boolean(s.featureGates.formulas_count_function)});if(G.push(...t),H&&(H.expression.kind===f().NM.UnifiedFunctionProperty&&0===H.parameterIndex||H.expression.kind===f().NM.Identifier&&1===H.parameterIndex)){const e=H.expression.kind===f().NM.UnifiedFunctionProperty?H.expression.name:H.expression.text,t=v().LP[e];if(((null==t?void 0:t.parameters)===v().Ux||(null==t?void 0:t.parameters)===v().MB)&&k(L??"",p().CURRENT_VALUE_NAME)&&L!==p().CURRENT_VALUE_NAME&&L!==`${p().CURRENT_VALUE_NAME}.`){var se,ce;const e=H.expression,t="function"===e.type.type&&"array"===(null===(se=e.type.boundTargetType)||void 0===se?void 0:se.type)&&(null===(ce=e.type.boundTargetType)||void 0===ce?void 0:ce.of)||{type:"unknown"};G.push({kind:p().FormulaEditorInfoCompletionKind.Binding,text:p().CURRENT_VALUE_NAME,type:t}),G.push({kind:p().FormulaEditorInfoCompletionKind.Binding,text:p().CURRENT_INDEX_NAME,type:{type:"number"}})}}}}else if(o.nextTokenType===E.AdditionOperator&&Q&&(null==V?void 0:V.type.type)!==f().NM.Array&&"text"===(null===(Y=j)||void 0===Y?void 0:Y.type.type)){const e=C(["+"],L??"");G.push(...e)}else if(o.nextTokenType===E.AdditionOperator&&Q&&(null==V?void 0:V.type.type)!==f().NM.Array&&"number"===(null===(Z=j)||void 0===Z?void 0:Z.type.type)){const e=C(["+","-"],L??"");G.push(...e)}else if(o.nextTokenType===E.MultiplicationOperator&&Q&&(null==V?void 0:V.type.type)!==f().NM.Array&&"number"===(null===(ee=j)||void 0===ee?void 0:ee.type.type)){const e=C(["*","/"],L??"");G.push(...e)}else if(o.nextTokenType!==E.RelationalOperator||!Q||(null==V?void 0:V.type.type)===f().NM.Array||"number"!==(null===(te=j)||void 0===te?void 0:te.type.type)&&"text"!==(null===(ne=j)||void 0===ne?void 0:ne.type.type)&&"date"!==(null===(oe=j)||void 0===oe?void 0:oe.type.type)){if(o.nextTokenType===E.EqualityOperator&&Q&&null!==(re=j)&&void 0!==re&&re.type.type&&"unknown"!==(null===(ie=j)||void 0===ie?void 0:ie.type.type)){const e=C(["==","!="],L??"");G.push(...e)}else if(o.nextTokenType===E.BooleanLiteral&&$){const e=C(["true","false"],L??"");G.push(...e)}else if(o.nextTokenType===E.And&&Q&&"checkbox"===(null===(ae=j)||void 0===ae?void 0:ae.type.type)){const e=C(["and","or"],L??"");G.push(...e)}else if(o.nextTokenType===E.UnaryOperator&&J){const e=C(["not"],L??"");G.push(...e)}}else{const e=C([">",">=","<","<="],L??"");G.push(...e)}}const le=null===(n=S[S.length-1])||void 0===n?void 0:n.tokenType;if(0===G.length&&le===E.IdentifierName){const e=S.slice(-4).reverse(),t=[];for(let o=0;o<e.length;o++){var pe;if((null===(pe=e[o])||void 0===pe?void 0:pe.tokenType)!==E.IdentifierName)break;const n=_?e[o].image.substring(0,e[o].image.length-(N?1:0)):void 0;void 0!==n&&(0===o?t.push(n):t.push(n+t[o-1]))}let n=[];for(let o=1;o<t.length;o++){const e=t[o],r=await b({prefix:e.trim(),context:q,includeDeprecatedCompletions:c,dotMemberExpression:!1,allowCountFunction:Boolean(s.featureGates.formulas_count_function)});if(r.length>0){n=r.map((t=>({...t,overridePrefixLength:e.length+o})))}}G.push(...n)}return K.completions=G.sort(((e,t)=>{const n=e.kind,o=t.kind;return P[n]-P[o]})),{value:K}}function C(e,t){return e.filter((e=>k(t,e))).map((e=>({kind:p().FormulaEditorInfoCompletionKind.Builtin,builtin:e})))}},563015:(e,t,n)=>{n.d(t,{eJ:()=>f,ew:()=>m,ml:()=>p,rA:()=>d,yI:()=>y,zf:()=>u});n(581454);var o=()=>n(496603),r=()=>n(534177),i=()=>n(708685),a=()=>n(145076),s=()=>n(349835),c=()=>n(977345);function l(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().HB)(e)}}function p(e){switch(e.type){case s().M9.InvalidCharacter:return{...a().x0.InvalidCharacter,values:{errorCharacter:e.character}};case s().M9.UnclosedStringLiteral:return a().x0.UnclosedStringLiteral;case s().M9.UnclosedComment:return a().x0.UnclosedComment;case s().M9.TokenExpected:return{...a().x0.TokenExpected,values:{expectedToken:e.token}};case s().M9.StringLiteralContainsToken:return a().x0.StringLiteralContainsToken;case s().M9.ExpressionExpected:return a().x0.ExpressionExpected;case s().M9.PropertyTokenOrFunctionExpected:return a().x0.PropertyTokenOrFunctionExpected;case s().M9.EndOfInputExpected:return a().x0.EndOfInputExpected;case s().M9.UnexpectedError:return a().x0.UnexpectedError;case s().M9.TooDeeplyNested:return a().x0.TooDeeplyNested;default:(0,r().HB)(e)}}function u(e){switch(e.type){case s().IA.FunctionCallArgumentWrongType:case s().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function d(e,t){let n;switch(t.type){case s().IA.ThisRowTypeNotFound:n=a().Xz.ThisRowTypeNotFound;break;case s().IA.ThisRowNotBlockWithCollection:n=a().Xz.ThisRowNotBlockWithCollection;break;case s().IA.MissingPropertyOnThisRow:n={...a().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().IA.MissingContextVariable:{const e=(0,c().ix)(t.token)?t.token.contextValueId:t.token.valueId;n={...a().Xz.MissingContextVariable,values:{valueId:e}}}break;case s().IA.MissingBlock:n={...a().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case s().IA.CallingNotFunction:n={...a().Xz.CallingNotFunction,values:{expressionType:l(t.callee.type.type)}};break;case s().IA.FunctionCallTooFewArguments:n={...a().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().IA.FunctionCallUnexpectedArgument:n={...a().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().IA.FunctionCallArgumentWrongType:n={...a().Xz.FunctionCallArgumentWrongType,values:{argumentType:l(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().IA.MemberPropertyMismatchCollection:n={...a().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().IA.MemberPropertyMissing:n={...a().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().IA.MemberPropertyTargetNotBlock:n=a().Xz.MemberPropertyTargetNotBlock;break;case s().IA.MemberPropertyTypeInvalid:n={...a().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().IA.UndefinedIdentifier:n={...a().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().IA.UnifiedFunctionCannotFindFunction:n={...a().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().IA.UnifiedFunctionNoArguments:n={...a().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().IA.UnifiedFunctionTargetWrongType:n={...a().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:l(t.expression.type.type)}};break;case s().IA.CannotRelativelyCompareTypes:n={...a().Xz.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.CannotDoMathOnType:n={...a().Xz.CannotDoMathOnType,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.UnaryMinusOnNonNumber:n={...a().Xz.UnaryMinusOnNonNumber,values:{type:l(t.expression.type.type)}};break;case s().IA.IdentifierExpected:n=a().Xz.IdentifierExpected;break;case s().IA.FunctionCallExpected:n={...a().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().IA.RenamedIdentifier:n={...a().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().IA.RemovedFunction:n={...a().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().IA.ContextVariableNotBlockWithCollection:n={...a().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().IA.MissingPropertyOnContextVariable:n={...a().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().IA.BlockPropertyTypeInvalid:n={...a().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().IA.DisallowedReturnType:{const o=t.allowedReturnTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(o,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,i().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().IA.CrossSpacePropertyNotSupported:n={...a().Xz.CrossSpacePropertyNotSupported};break;default:(0,r().HB)(t)}return{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function y(e,t){let n;switch(t.type){case s().uW.MissingThisRow:n=a().X8.MissingThisRow;break;case s().uW.MissingSchemaPropertyOnThisRow:n={...a().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().uW.ThisRowBlockPropertyMismatchCollection:n=a().X8.ThisRowBlockPropertyMismatchCollection;break;case s().uW.MissingContextVariable:n={...a().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case s().uW.IdentifierNotFound:n={...a().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().uW.CannotRelativelyCompareTypes:n={...a().X8.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType),rhsType:l(t.rhsType)}};break;case s().uW.CannotDoMathOnType:n={...a().X8.CannotDoMathOnType,values:{valueType:l(t.valueType)}};break;case s().uW.CannotCallNonFunction:n={...a().X8.CannotCallNonFunction,values:{calleeType:l(t.calleeType)}};break;case s().uW.UnifiedFunctionPropertyNotFound:n={...a().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().uW.LibraryFunctionExecutionError:const o=t.error instanceof s().x4?t.error:void 0;n=(null==o?void 0:o.info.type)===s().v3.DateInvalidDurationUnit?{...a().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:o.info.invalidUnit}}:(null==o?void 0:o.info.type)===s().v3.CannotUseToNumberOnList?{...a().gW.CannotUseToNumberOnList}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToNonInteger?{...a().gW.CannotRoundToNonInteger,values:{precision:o.info.precision}}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToTooManyDecimalPlaces?{...a().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:o.info.precision}}:{...a().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallTooFewArguments:n={...a().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallUnexpectedArgument:n={...a().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallArgumentWrongType:n={...a().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:l(t.argumentType)}};break;case s().uW.AccessingPropertyOnNonBlock:n=a().X8.AccessingPropertyOnNonBlock;break;case s().uW.MissingDataDependencyBlock:n={...a().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().uW.MissingDataDependencyPerson:n={...a().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().uW.MemberPropertyMismatchCollection:n=a().X8.MemberPropertyMismatchCollection;break;case s().uW.MissingPropertyOnSchemaForMemberProperty:n=a().X8.MissingPropertyOnSchemaForMemberProperty;break;case s().uW.UnaryMinusOnNonNumber:n={...a().X8.UnaryMinusOnNonNumber,values:{expressionType:l(t.expressionType)}};break;case s().uW.UnexpectedRecoveryNode:n=a().X8.UnexpectedRecoveryNode;break;case s().uW.UnexpectedError:n=a().X8.UnexpectedError;break;case s().uW.DepthExceeded:n=a().X8.DepthExceeded;break;case s().uW.CycleDetected:n=a().X8.CycleDetected;break;case s().uW.DownstreamParseFailure:n=a().X8.DownstreamParseFailure;break;case s().uW.MaxEvaluationTimeExceeded:n=a().X8.MaxEvaluationTimeExceeded;break;case s().uW.MissingSchemaPropertyOnCollection:n={...a().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().uW.ContextVariableWrongType:n={...a().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().uW.DisallowedValueType:{const o=t.allowedValueTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(o,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,i().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().HB)(t)}return(0,c().li)(t)?{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:n}function m(e){const t=null==e?void 0:e.values;return[o().cJ(e,"values"),t]}function f(e){return e.type===s().uW.DepthExceeded||e.type===s().uW.CycleDetected||e.type===s().uW.MaxEvaluationTimeExceeded||e.type===s().uW.LibraryFunctionExecutionError}},871202:(e,t,n)=>{n.r(t),n.d(t,{hasAccessDefaultFn:()=>T,hasAccessToCode:()=>P,hasAccessToProperty:()=>x,hasReadPermissionsAccess:()=>k,hasSameSpaceAccess:()=>b,testOnly:()=>g});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520);var o=()=>n(496603),r=()=>n(763824),i=()=>n(973647),a=()=>n(534177),s=()=>n(970013),c=()=>n(247331),l=()=>n(443881),p=()=>n(977345),u=()=>n(501053),d=()=>n(373907);function*y(e){const{collectionPointer:t,context:n,propertyId:o,propertySchema:r,visitedPointers:i,hasAccessFn:a}=e,s=(0,l().G7)({...t,propertyId:o});if(i.has(s))return!0;i.add(s);const c=a({propertySchema:r,spaceId:n.spaceId});return"boolean"==typeof c?c:yield*c}function*m(e){var t,n;const{collectionPointer:r,depth:u,collectionSchema:y,context:m,propertyId:f,propertySchema:h,visitedPointers:T,hasAccessFn:k}=e;if("v2"!==h.version||u>c().FORMULA_MAX_DEPTH)return!1;const b=(0,l().G7)({...r,propertyId:f});if(T.has(b))return!0;if(T.add(b),!(0,a().O9)(null===(t=h.formula2)||void 0===t?void 0:t.code))return!0;const x=(0,d().$t)(null===(n=h.formula2)||void 0===n?void 0:n.code);if(i().Q.isFail(x))return!0;const{spaceId:P}=m,g=(0,l().zm)({formulaTypecheckContextValues:[{kind:c().FormulaContextValueKind.ThisRow,type:{collection:r,type:"block"}}],node:x.value,spaceId:P}),I=(0,o().hS)(g,(e=>(0,l().G7)(e)));if(0===I.length)return!0;const{getRecordModel:C}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:r,property:f,schema:y}],recordPointers:I.filter((e=>(0,p().T3)(e)))};for(const o of I)if((0,s().pq)(o)){const e=C(o);if(!(0,a().O9)(e))return!1;const t=o.propertyId,n=e.getSchema(),r=n[t];if(!r)continue;if((0,s().bT)(r)||(0,s().lb)(r)){if(!(yield*v({collectionPointer:o,collectionSchema:n,context:m,depth:u+1,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:k})))return!1}else if((0,s().nC)(r)){if(!(yield*v({collectionPointer:o,collectionSchema:n,context:m,depth:u,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:k})))return!1}}else if(!(0,a().O9)(C(o)))return!1;return!0}function*f(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:p,hasAccessFn:d}=e;if("v2"===a.version||n>c().FORMULA_MAX_DEPTH)return!1;const y=(0,l().G7)({...t,propertyId:i});if(p.has(y))return!0;p.add(y);const m=(0,u().kh)(a.formula);if(0===m.length)return!0;for(const c of m){const e=o[c];if(e)if((0,s().bT)(e)||(0,s().lb)(e)){if(!(yield*v({collectionPointer:t,depth:n+1,collectionSchema:o,context:r,propertyId:c,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}else if((0,s().nC)(e)){if(!(yield*v({collectionPointer:t,collectionSchema:o,context:r,depth:n,propertyId:c,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}}return!0}function*h(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:p,hasAccessFn:u}=e;if(n>c().FORMULA_MAX_DEPTH)return!1;const d=(0,l().G7)({...t,propertyId:i});if(p.has(d))return!0;if(p.add(d),!a.relation_property||!a.target_property)return!0;const y=o[a.relation_property];if(!y||"relation"!==y.type)return!0;const m=u({propertySchema:y,spaceId:r.spaceId});if(!("boolean"==typeof m?m:yield*m))return!1;const f=(0,s().Nv)(y);if(!f)return!0;const{getRecordModel:h}=yield{recordPointers:[f]},T=h(f),k=null==T?void 0:T.getNormalizedSchema();if(a.target_property_type&&k){const e=k[a.target_property];if(e&&a.target_property_type===e.type){if((0,s().lb)(e))return yield*v({collectionPointer:f,collectionSchema:k,context:r,depth:n+1,propertyId:a.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:u});if((0,s().nC)(e))return yield*v({collectionPointer:f,collectionSchema:k,context:r,depth:n,propertyId:a.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:u})}}return!0}function*v(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}=e;return(0,s().nC)(a)?yield*y({collectionPointer:t,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):(0,s().lb)(a)?"v2"===a.version?yield*m({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):yield*f({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):!(0,s().bT)(a)||(yield*h({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}))}function*T(e){const{propertySchema:t,spaceId:n}=e,o=(0,s().Nv)(t);if(!(0,a().O9)(o))return!0;const{getRecordModel:r}=yield{recordPointers:[o]},i=r(o);return(0,a().O9)(i)&&b({spaceId:n,propertySchema:t})}function*k(e){const{propertySchema:t}=e,n=(0,s().Nv)(t);if(!(0,a().O9)(n))return!0;const{getRecordModel:o}=yield{recordPointers:[n]},r=o(n);return(0,a().O9)(r)}function b(e){const{propertySchema:t,spaceId:n}=e;return!(0,s().o2)(n,t)}async function x(e){const{collectionPointer:t,collectionSchema:n,context:o,propertyId:i,hasAccessFn:a}=e,s=n[i];return!s||await async function(e){const{context:t}=e;try{const n=v(e);let o=n.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=n.next((0,r().yL)(e)?await e:e)}return o.value}catch(n){return!0}}({collectionPointer:t,depth:0,collectionSchema:n,context:o,propertyId:i,propertySchema:s,visitedPointers:new Set,hasAccessFn:a})}function P(e){const{context:t}=e;try{const n=function*(e){const{collectionPointer:t,depth:n,context:r,code:u,visitedPointers:y,hasAccessFn:m}=e,f=(0,d().$t)(u);if(i().Q.isFail(f))return!0;const{spaceId:h}=r,T=r.valueTypes.filter((e=>e.kind!==c().FormulaContextValueKind.ThisRow)),k=(0,l().zm)({formulaTypecheckContextValues:t?[...T,{kind:c().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:f.value,spaceId:h}),b=(0,o().hS)(k,(e=>(0,l().G7)(e)));if(0===b.length)return!0;const{getRecordModel:x}=yield{collectionBlockProperties:[],recordPointers:b.filter((e=>(0,p().T3)(e)))};for(const o of b)if((0,s().pq)(o)){const e=x(o);if(!(0,a().O9)(e))return!1;const t=o.propertyId,i=e.getSchema(),c=i[t];if(!c)continue;if((0,s().bT)(c)||(0,s().lb)(c)){if(!(yield*v({collectionPointer:o,collectionSchema:i,context:r,depth:n+1,propertyId:t,propertySchema:c,visitedPointers:y,hasAccessFn:m})))return!1}else if((0,s().nC)(c)&&!(yield*v({collectionPointer:o,collectionSchema:i,context:r,depth:n,propertyId:t,propertySchema:c,visitedPointers:y,hasAccessFn:m})))return!1}else if(!(0,a().O9)(x(o)))return!1;return!0}(e);let r=n.next();for(;!r.done;){const e=t.handleDataRequest(r.value);r=n.next(e)}return r.value}catch(n){return!0}}const g={hasAccessDefaultFn:T,hasAccessToProperty:x,hasAccessToFormula1Property:f,hasAccessToFormula2Property:m,hasAccessToRelationProperty:y,hasAccessToRollupProperty:h}}}]);