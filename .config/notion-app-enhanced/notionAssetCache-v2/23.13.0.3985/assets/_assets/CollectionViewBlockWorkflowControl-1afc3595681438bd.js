"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72535],{818434:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockWorkflowControl:()=>V});o(944114),o(581454);var s=o(296540),n=()=>o(484714),r=()=>o(56366),l=()=>o(401497),i=()=>o(584262),a=o(474848);const c={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,a.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125z"})},p=(0,o(340498).wt)("appFill",c);var d=()=>o(179034),u=()=>o(519831),g=()=>o(99895),v=()=>o(959013),w=()=>o(857783),m=()=>o(630116),y=()=>o(493823),I=()=>o(406699),h=()=>o(331542),f=()=>o(678553),k=()=>o(939740),x=()=>o(187820),C=()=>o(16006),b=()=>o(89924),j=(o(898992),o(672577),()=>o(187174)),A=()=>o(386164),S=()=>o(68263),B=()=>o(449506);function V(e){const{store:t,style:o}=e,c=(0,n().v3)(),V=function(e){const t=(0,n().v3)(),[o,s]=(0,r().K8)((()=>[e.getSpaceId(),e.getOwnedCollectionStores()]),[e]),[l]=(0,j().Yb)((async()=>{const e=await B().callApi({environment:t,eventName:"getWorkflowsForCollections",data:{collectionIds:s.map((e=>({id:e.id,spaceId:o})))},headers:(0,A().WS)({cellId:void 0,spaceId:o})});return"success"===e.type?e.data.workflowResults:[]}),[t,o,s]);return(0,r().K8)((()=>{const t=new Map(s.map((e=>[e.id,e])));return"resolved"!==l.status?l:{status:"resolved",value:l.value.map((o=>{const{collectionId:s,botId:n}=o,r=t.get(s);if(!r)return{...o,access:"none"};const l=[...r.getPermissionItems(),...e.getPermissionItems()].find((e=>"bot_permission"===e.type&&e.bot_id===n)),i=null==l?void 0:l.role;let a="none";return i&&(0,S().p2)(i)?a="write":i&&(0,S().Tt)(i)&&(a="read"),{...o,access:a}}))}}),[e,l,s])}(t),T=(0,l().IS)((e=>({appContainer:{maxHeight:250,overflowY:"scroll"},appItem:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"}})),[]),z=(0,r().K8)((()=>{if("resolved"!==V.status)return[];const e=new(g().G)((()=>[]));for(const t of V.value)e.get(t.collectionId).push(t);const o=Array.from(e.entries()).map((e=>{let[o,n]=e;const r=m().md.createChildStore(t,{table:u().Vl,id:o,spaceId:t.getSpaceId()});return{key:o,items:n.map((e=>{let{blockId:o,workflowId:n,access:r}=e;const l=m().Bv.createChildStore(t,{table:d().ev,id:o,spaceId:t.getSpaceId()});return{key:o,render:e=>(0,s.createElement)(f().Ay,{...e,key:o,title:(0,a.jsxs)(y().p,{style:T.appItem,onClick:()=>{w().uK({environment:c,store:l,openInNew:"tab",pageVisitSource:i().y8.CollectionViewBlockWorkflowControl})},children:[(0,a.jsx)(x().B6,{disabled:!0,icon:l.getIcon(),iconRecordCategory:(0,x().Te)(l),isEmptyPage:!1,size:18}),(0,a.jsx)(C().A,{store:l})]})}),action:()=>{}}})),render:e=>{let{children:t,...o}=e;return(0,a.jsx)(b().A,{title:(0,a.jsx)(C().A,{store:r}),...o,children:t})}}}));return o}),[c,t,V,T]);return"pending"===V.status?(0,a.jsx)(h().A,{size:"sm"}):"rejected"===V.status||"idle"===V.status||0===V.value.length?null:(0,a.jsx)(I().Ay,{popupType:I().z7.Popup,renderOrigin:e=>(0,a.jsx)(y().p,{...e,style:o,isLightGray:!0,iconLeading:p,children:(0,a.jsx)(v().sA,{id:"collectionViewBlock.workflow.apps",defaultMessage:"{count, plural, one {1 app} other {{count} apps}}",values:{count:V.value.length}})}),render:()=>(0,a.jsx)(k().Ay,{style:T.appContainer,type:k().Oh.Vertical,sections:z,initialFocus:0})})}}}]);