"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51466],{3031:(e,n,t)=>{t.r(n),t.d(n,{RemoveAddOnModal:()=>S});t(16280),t(581454);var r=t(296540),o=()=>t(662303),i=()=>t(484714),s=()=>t(56366),a=()=>t(869190),c=()=>t(206267),u=()=>t(762433),d=()=>t(47273),l=()=>t(323063),f=()=>t(491598),p=()=>t(166386),m=()=>t(959013),v=()=>t(496603),g=()=>t(252105),y=()=>t(436572),h=()=>t(58293),b=()=>t(224701),_=()=>t(749356),w=()=>t(807778),x=()=>t(960236),A=()=>t(8540),O=()=>t(995604),C=()=>t(231127),M=()=>t(156262),j=()=>t(30265),I=t(474848);function S(e){let{currentPeriodEnd:n,isOpen:t,onClose:v}=e;const C=(0,i().v3)(),[S,T]=r.useState("survey"),[k,V]=r.useState({reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[B,P]=r.useState(void 0),[R]=r.useState(c().JW()),N=(0,s().K8)((()=>(0,w().Le)()),[]);(0,r.useEffect)((()=>g().u4(C,{name:"churn_survey",args:{churnType:"ai",reasons:k.reasons,reasonOther:k.reasonOther,reasonOtherTools:k.reasonOtherTools,stage:S,churnSurveyId:R}})),[C,S,k,R]);const D=(0,h().r)(),q=Boolean((0,s().K8)((()=>null==D?void 0:D.canAdmin()),[D])),K=(0,x().lh)({spaceId:null==D?void 0:D.id}),L=(0,s().K8)((()=>(0,u().Rz)(K)),[K]),Q=(0,u().qd)({billingData:K,canUpdateBilling:q}),U=(0,A().X)(),Y=(0,s().K8)((()=>{if(U&&(0,p().rM)(U))return U.offer}),[U]),Z=n?(0,a().W_)(n,"long",o().locale):void 0,z=r.useCallback((()=>{g().u4(C,{name:"churn_survey_close",args:{churnSurveyId:R}}),v()}),[R,C,v]);return(0,I.jsx)(j().W,{step:S,isOpen:t,onClose:z,children:(()=>{switch(S){case"survey":return(0,I.jsx)(M().lU,{options:E(),onSubmit:async e=>{g().u4(C,{name:"churn_survey_submitted",args:{churnType:"ai",reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0,stage:S,churnSurveyId:R}}),V((n=>({...n,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0})));const n=await _().z6(C,{spaceId:null==D?void 0:D.id,offerCampaign:"ai_fifty_percent_downgrade"});return n?(P(n),void T("offer")):T("downgrade")}});case"offer":return B?(0,I.jsx)(M().hL,{currentProduct:"ai",currentSubscriptionTier:(0,u().AI)(K),secondaryButtonMessage:(0,I.jsx)(m().sA,{id:"removeAddOnModal.cancelAnyway",defaultMessage:"Cancel anyway"}),newProduct:"free",offer:B,onSubmit:async e=>{if(e){g().u4(C,{name:"offer_accepted",args:{coupon:B.campaign}});const e=null==D?void 0:D.id;if(L&&e&&Q&&(0,p().mE)(null==B?void 0:B.campaign))return await _().VY({environment:C,spaceId:e,offerCampaign:"ai_fifty_percent_downgrade",entrypoint:"ai_downgrade_flow"}),z(),void y().D6({label:(0,I.jsx)(m().sA,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})}T("downgrade")}}):void T("downgrade");case"downgrade":return(0,I.jsx)(M().kv,{title:(0,I.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.title",defaultMessage:"Remove AI at the end of your billing period?"}),description:Z?(0,I.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.description",defaultMessage:"If you continue with the downgrade, you will continue to enjoy Notion AI until the end of your billing period on <bold>{periodEnd}</bold>. You can resubscribe anytime.",values:{periodEnd:Z,bold:e=>(0,I.jsx)("b",{children:e})}}):null,onSubmit:async()=>{if(g().u4(C,{name:"continue_downgrade_button_clicked"}),K&&D){const e=(0,u().lQ)(K),n=(0,l().gL)(e,"ai");if(Y&&!(0,f().MN)(Y.campaign,n.items.map((e=>e.price.product)))){if(!(await(0,O().Z)(C)))return}await(0,b().nV)({environment:C,spaceStore:D,from:"billing_page",desiredState:n})}T("confirmation")},may13PackagingChangesEnabled:N});case"confirmation":if(K){const e=(0,u().lQ)(K);if(Boolean((0,d().yp)(e,"ai")))throw new Error("Notion AI is not cancelled or scheduled to be cancelled")}return(0,I.jsx)(M().Qe,{title:(0,I.jsx)(m().sA,{id:"downgradeFlow.confirmationStep.ai.title",defaultMessage:"Notion AI has been removed"}),formattedPeriodEndDate:Z})}})()})}function E(){return[...(0,v().k4)([C().V.tooExpensive,C().V.missingFeatures,C().V.upgradedByMistake,C().V.tooDifficult,C().V.notUsingEnough,C().V.qualityOfResults,C().V.usingAnotherAiService,C().V.dataSecurity]),C().V.other]}},8540:(e,n,t)=>{t.d(n,{X:()=>s});var r=()=>t(166386),o=()=>t(47170),i=()=>t(985315);function s(){const e=(0,o().O)(),n=(0,i().g)({spaceId:e});if(n)return(0,r().e8)(n,"coupon")}},323063:(e,n,t)=>{t.d(n,{HO:()=>p,V5:()=>c,Vr:()=>u,ef:()=>f,gL:()=>d,ng:()=>g,vH:()=>l,vk:()=>v,z2:()=>m});t(16280),t(269479),t(898992),t(354520),t(672577),t(581454),t(737550);var r=()=>t(720665),o=()=>t(762433),i=()=>t(47273),s=()=>t(622963),a=()=>t(979340);function c(e,n){return p(e.items,n.items).some((e=>{let[n,t]=e;return function(e,n){if(!e)return!1;if(!n)return!0;const t=o().xp(e),r=o().xp(n);if(!t||!r)return!1;return a().o3[t]>a().o3[r]}(n,t)}))}function u(e,n,t){let{trialEnd:r,items:o}=n;return{trialEnd:r,items:o.map((n=>{const r=n.price.product,o=n.price.unitAmount.currencyCode,i=v(e,{interval:t,product:r,currency:o});return{...n,price:i}}))}}function d(e,n){const t=e.items.filter((e=>o().IE(e)!==n));return{...e,items:t}}function l(e,n,t){const{isMay13PackagingChangesEnabled:r}=t,i=o().IE(n),s=n.price.product,a=e.items.filter((e=>{const n=e.price.product,t=o().IE(e);return!(i===t)&&!(r&&"ai"===n&&("business"===s||"enterprise"===s))}));return{...e,items:a.concat([n])}}function f(e){const{state:n,prices:t,quantities:r,params:{interval:i,currency:s},products:a,flags:{isMay13PackagingChangesEnabled:c}}=e,u=a.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),d=u.map((e=>o().Mr(e))),l=n.items.filter((e=>{const n=e.price.product,t=o().IE(e),r=d.includes(t),i=c&&"ai"===n&&(u.includes("business")||u.includes("enterprise"));return!r&&!i})),f=u.map((e=>g(v(t,{interval:i,currency:s,product:e}),r)));return{...n,items:l.concat(f)}}function p(e,n){return(0,r().Z4)(e,(e=>o().IE(e)),n,(e=>o().IE(e)))}function m(e){const{prices:n,billingData:t,product:r}=e,s=o().Ry(t),a=o().lQ(t),c=i().yw(a),u=o().q8(t),d=c??u;return n.find((e=>e.product===r&&e.billingInterval===d&&e.unitAmount.currencyCode===s))}function v(e,n){let{interval:t,product:r,currency:o}=n;return function(e,n){if(null==e)throw new Error(n);return e}(e.find((e=>e.product===r&&e.billingInterval===t&&e.unitAmount.currencyCode===o)),`Unable to find price with interval: ${t}, product: ${r}, currency: ${o}`)}function g(e,n){const{numSeats:t,numCustomHostnames:r}=n;return"public_domain_custom_hostnames"===(0,s().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:t}}},995604:(e,n,t)=>{t.d(n,{Z:()=>g});t(296540);var r=()=>t(449506),o=()=>t(2220),i=()=>t(82275),s=()=>t(49210),a=()=>t(765957),c=()=>t(503416),u=()=>t(959013),d=()=>t(7674),l=()=>t(719147),f=()=>t(836251),p=t(474848);function m(e){let{onAccept:n}=e;return(0,p.jsx)(d().tf,{header:(0,p.jsx)(d().YA,{iconAndTitle:(0,p.jsx)(d().ZQ,{iconGroup:c().r,iconColorName:"uiRedPrimary",title:(0,p.jsx)(u().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,p.jsx)(u().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,p.jsx)(l().A,{external:!0,href:(0,f().xS)("resurrectionLearnMore"),children:e})}})}),footer:(0,p.jsx)(d().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,p.jsx)(u().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:n}],secondaryButtons:[{buttonType:"dismiss",label:(0,p.jsx)(u().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const v=406;async function g(e){var n;const t=null===(n=a().default.state.currentSpaceStore)||void 0===n?void 0:n.id;return await s().T.showAsyncModal((n=>(0,p.jsx)(i().s,{isOpen:n.isOpen,onDismiss:()=>{(0,o().u)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),n.onDismiss()},onClosed:n.onClosed,areaConstraint:{width:{type:"min",length:v},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,p.jsx)(m,{onAccept:async()=>{(0,o().u)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),t&&await r().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:t}}),n.resolve("accepted")}})})))}}}]);