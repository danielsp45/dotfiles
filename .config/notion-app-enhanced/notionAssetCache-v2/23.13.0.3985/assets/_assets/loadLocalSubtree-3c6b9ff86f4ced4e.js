"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[48486],{59110:(e,t,o)=>{o.r(t),o.d(t,{loadLocalSubtree:()=>k});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949);var n=()=>o(700500),r=()=>o(175482),i=()=>o(777447),a=()=>o(792071),p=()=>o(976618),s=()=>o(388821),d=()=>o(696706),l=()=>o(912720),u=()=>o(199378),c=()=>o(179034),f=()=>o(519831),v=()=>o(869558),_=()=>o(343666),I=()=>o(197959),m=()=>o(37165),b=()=>o(144081),h=()=>o(743246),y=()=>o(919709),g=()=>o(534177),C=()=>o(780054);function k(e,t){const{blockId:o,inMemoryRecordCache:k,allowCopyCollections:B,requireFullSubtree:R,skipTransclusionContainerChildren:j,allowCopyExternalObjectInstances:x,skipBlockContent:V,skipNavigableChildren:Y,excludeCrdtData:w,includeLegacyTransclusionBlockValues:N,includeDiscussions:O,includeComments:S}=t,T=e.currentUser.id,$=s().RecordMap.create(),D=new Set,E=[{pointer:{table:c().ev,id:o},parentId:"doesn't matter"}];for(;E.length>0;){const e=E.shift();if(!e)continue;if(D.has(e.pointer.id))continue;const t=o===e.pointer.id;if((0,d().Yt)(e.pointer,c().ev)){var M,P,Q,U;const o=k.getRecord({pointer:e.pointer,userId:T});if(null==o||!o.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}const p=w?r().ir(o.value):o.value;if(N){if(!t&&p.parent_id!==e.parentId&&!e.isBlockContentChild)continue}else if(!t&&p.parent_id!==e.parentId)continue;if(p.type===n().xd.externalObjectInstance&&!x)return{type:"error",reason:"encountered_external_object_instance",pointer:e.pointer};if($.setValue(e.pointer,p),!Y){const e=a().Bj6.fromBlock(p).getCollectionPointers();for(const t of e){const e=k.getRecord({pointer:t,userId:T});var z,A;if(e)(null===(z=e.value)||void 0===z?void 0:z.parent_table)===c().ev&&(null===(A=e.value)||void 0===A?void 0:A.parent_id)===p.id&&E.push({pointer:t,parentId:p.id});else if(R)return{type:"error",reason:"missing_record",pointer:t}}if(p.view_ids)for(const t of p.view_ids)E.push({pointer:{table:v().Gy,id:t,spaceId:p.space_id},parentId:p.id})}if(!(V||j&&"transclusion_container"===p.type||Y&&(0,n().$I)(p.type))){const e=a().Bj6.fromBlock(p).getRenderableContentIds();for(const t of e)E.push({pointer:{table:c().ev,id:t},parentId:p.id,isBlockContentChild:!0})}const s=a().Bj6.fromBlock(p).getNonContentChildren();for(const e of s)E.push({pointer:{table:c().ev,id:e},parentId:p.id,isBlockContentChild:!0});if(p.type===n().xd.externalObjectInstance){var G,L;const e=(null===(G=p.format)||void 0===G?void 0:G.related_external_object_uris_to_instance_ids)&&Object.values(null===(L=p.format)||void 0===L?void 0:L.related_external_object_uris_to_instance_ids)||[];for(const t of e)E.push({pointer:{table:c().ev,id:t,spaceId:p.space_id},parentId:p.id})}if(!Y&&p.properties){const e=Object.values(p.properties).filter(g().O9);for(const t of e)for(const e of t)for(const t of y().uPN(e)){if(y().jIt(t)){const e=y().v55(t);E.push({pointer:{table:c().ev,id:e},parentId:p.id})}if(y().sh$(t)){const e=y().cQR(t),o=(0,i().lX)({url:e,baseUrl:C().A.domainBaseUrl,publicDomainName:C().A.publicDomainName});o&&E.push({pointer:{table:c().ev,id:o},parentId:p.id})}if(y().N53(t)){const e=y().T$c(t);e&&E.push({pointer:{table:c().ev,id:e,spaceId:p.space_id},parentId:p.id})}}}if("form"===p.type&&null!==(M=p.format)&&void 0!==M&&M.form_layout_pointer&&E.push({pointer:p.format.form_layout_pointer,parentId:p.id}),null!==(P=p.format)&&void 0!==P&&P.automation_id&&E.push({pointer:{table:l().yB,id:p.format.automation_id,spaceId:p.space_id},parentId:p.id}),null!==(Q=p.format)&&void 0!==Q&&Q.workflow_id&&E.push({pointer:{table:h().C0,id:p.format.workflow_id,spaceId:p.space_id},parentId:p.id}),null!==(U=p.format)&&void 0!==U&&U.ai_instructions_page_pointer&&E.push({pointer:p.format.ai_instructions_page_pointer,parentId:p.id}),O&&p.discussions)for(const e of p.discussions)E.push({pointer:{table:I().$Y,id:e,spaceId:p.space_id},parentId:p.id})}else if((0,d().Yt)(e.pointer,f().Vl)){var q,F;if(!B)return{type:"error",reason:"encountered_collection",pointer:e.pointer};const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;const o=t.value;$.setValue(e.pointer,o),k.forEachRecord(T,(t=>{let{model:o}=t;o.table===c().ev&&o&&o.parent_id===e.pointer.id&&o.alive&&E.push({pointer:o.pointer,parentId:e.pointer.id})}));const n=(null===(q=o.format)||void 0===q?void 0:q.automation_ids)??[];for(const e of n)E.push({pointer:{table:l().yB,id:e,spaceId:o.space_id},parentId:o.id});o.schema&&Object.values(o.schema).forEach((e=>{e&&"button"===e.type&&e.automation_id&&E.push({pointer:{id:e.automation_id,spaceId:o.space_id,table:l().yB},parentId:o.id})})),null!==(F=o.format)&&void 0!==F&&F.layout_pointer&&E.push({pointer:o.format.layout_pointer,parentId:o.id})}else if((0,d().Yt)(e.pointer,v().Gy)){var X;const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;"form_editor"===t.value.type&&null!==(X=t.value.format)&&void 0!==X&&X.form_block_pointer&&E.push({pointer:t.value.format.form_block_pointer,parentId:t.value.id}),$.setValue(e.pointer,t.value)}else if((0,d().Yt)(e.pointer,l().yB)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;$.setValue(e.pointer,t.value);for(const e of t.value.action_ids??[])E.push({pointer:{table:u().SC,id:e,spaceId:t.value.space_id},parentId:t.value.id})}else if((0,d().Yt)(e.pointer,u().SC)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;$.setValue(e.pointer,t.value);for(const e of t.value.blocks??[])E.push({pointer:{table:c().ev,id:e,spaceId:t.value.space_id},parentId:t.value.id})}else if((0,d().Yt)(e.pointer,h().C0)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;$.setValue(e.pointer,t.value)}else if((0,d().Yt)(e.pointer,I().$Y)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;if($.setValue(e.pointer,t.value),S)for(const e of t.value.comments??[])E.push({pointer:{table:_().SN,id:e,spaceId:t.value.space_id},parentId:t.value.id})}else if((0,d().Yt)(e.pointer,_().SN)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}if(t.value.parent_id!==e.parentId)continue;$.setValue(e.pointer,t.value);for(const e of t.value.content??[])E.push({pointer:{table:c().ev,id:e,spaceId:t.value.space_id},parentId:t.value.id})}else if((0,d().Yt)(e.pointer,b().zx)){const t=k.getRecord({pointer:e.pointer,userId:T}),o=null==t?void 0:t.value;if(!o){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}$.setValue(e.pointer,o);const n=a().Bj6.fromValue(b().zx,o);for(const r of n.getBlockChildrenPointers())E.push({pointer:r,parentId:e.pointer.id});(0,p().E)(o.modules,(t=>{if("formQuestion"===t.type){const n={id:t.formQuestionId,table:m().lo,spaceId:o.space_id};E.push({pointer:n,parentId:e.pointer.id})}}))}else if((0,d().Yt)(e.pointer,m().lo)){const t=k.getRecord({pointer:e.pointer,userId:T});if(null==t||!t.value){if(R)return{type:"error",reason:"missing_record",pointer:e.pointer};continue}$.setValue(e.pointer,t.value)}D.add(e.pointer.id)}return{type:"success",recordMap:$}}}}]);