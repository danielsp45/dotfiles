"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[24930],{93263:(e,t,r)=>{r.d(t,{A:()=>i});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(581454);var n=r(296540);const o=function(e,t){if(e.ref&&t.ref){const r=t.ref;t.ref=t=>{e.ref(t),r(t)}}return n.cloneElement(e,t)};var a=r(474848);const i=function(e){const[t,i]=(0,n.useState)([]),{render:s}=e,c=(0,r(56366).K8)((()=>s()),[s]),l=(0,n.useMemo)((()=>new Set(c.map((e=>e.key)))),[c]),u=(0,r(591779).ZC)(c);if(u){const e=[],r=new Set(t.map((e=>e.key)));for(const t of u)if(!l.has(t.key)&&!r.has(t.key)){const r={visible:!1,onAnimationEnd:()=>{i((e=>e.filter((e=>e.key!==n.key))))}},n=o(t,r);e.push(n)}e.length>0&&i((t=>[...t,...e]))}const d=t.filter((e=>!l.has(e.key))).concat(c);return(0,a.jsx)("div",{className:e.className,children:d})}},278014:(e,t,r)=>{r.d(t,{ac:()=>w,jU:()=>P,qg:()=>R});var n=()=>r(799954),o=()=>r(700500),a=()=>r(908521),i=()=>r(534177),s=()=>r(571400),c=()=>r(236030),l=()=>r(519839),u=()=>r(799832),d=()=>r(835066),p=()=>r(780054),f=()=>r(444570),g=()=>r(327994),h=()=>r(980914),m=()=>r(217429),v=()=>r(871399),S=()=>r(502438),y=()=>r(809724);const b=c().Fh-2,C=10,k=4,I=15,_=24;function w(e){const{marginItemType:t,store:r,nodeRect:s,containerRect:l}=e,u=m().default.checkGate({gateName:"content_reskin_v2"}),d=u?function(e){const t=m().default.checkGate({gateName:"content_reskin_v2"});if(!t)return 0;const{store:r,marginItemType:i}=e,s=r.getType(),c=r.getNavigableAncestorFormat(),l=Boolean(c.page_small_text),u=(0,y().xU)(r),d=r.isFirstChildInParentBlock();if(u)return u.wrapper.paddingTop+u.title.paddingTop-(l?1.5:0);if(s===o().xd.text)return n().dE.paddingTop-(l?1.5:0);if(s===o().xd.header){return 39.5-(l?2.5:0)-(d?a().Aw.header-n().dE.paddingTop:0)}if(s===o().xd.subHeader){return 31.5-(l?2:0)-(d?a().Aw.subHeader-n().dE.paddingTop:0)}if(s===o().xd.subSubHeader){return 25-(l?1.5:0)-(d?a().Aw.subSubHeader-n().dE.paddingTop:0)}if(s===o().xd.divider)return 2;if(s===o().xd.table)return"presence_avatars"===i?5.5:14;return 8}({store:r,marginItemType:t}):function(e){const{store:t,marginItemType:r}=e,n=t.getType(),a=t.getNavigableAncestorFormat(),i=Boolean(a.page_small_text);return n===o().xd.divider?-6:n===o().xd.header?i?7:10:n===o().xd.subHeader?i?4:6:n===o().xd.collectionView?8:n===o().xd.table?"presence_avatars"===r?5.5:14:3}({store:r,marginItemType:t}),f=u?function(e){const t=m().default.checkGate({gateName:"content_reskin_v2"});if(!t)return 0;const{baseOffset:r,store:n}=e;if(n.isTransclusionType())return r-1.5;if(M(n))return m().default.checkGate({gateName:"db_ux_chrome"})?(c().tt-_)/2:r+1;if("ai_block"===n.getType())return n.hasContent()?r+9:r+15;if(n.getType()===o().xd.button)return r+6;return r}({baseOffset:d,store:r}):function(e){const{baseOffset:t,store:r}=e;if(r.isTransclusionType())return t+5;if(M(r))return m().default.checkGate({gateName:"db_ux_chrome"})?(c().tt-_)/2:t+1;if("ai_block"===r.getType())return r.hasContent()?t+9:t+15;if(r.getType()===o().xd.button)return t+3;return t}({baseOffset:d,store:r}),h=((null==s?void 0:s.top)??0)-((null==l?void 0:l.top)??0)+f,v=p().A.isMobile?16:22,S=(g().jK-v)/2;if("selectable_hover_menu_overlay_item"===t)return h;if("attribution_avatars"===t)return h-S;if("presence_avatars"===t){const{attributionsIncludeFoundBlock:t,avatarCount:r}=e;return h+S+(r+(t?1:0)-1)*I}(0,i().HB)(t)}function R(e){const{marginItemType:t,store:r,environment:n,nodeRect:o,containerRect:a,selectable:s}=e,c=p().A.isMobile?16:22,l=(0,f().zb)()+C,{maxLeft:d,isBoundedByParentContainer:g}=function(e){const{selectable:t,nodeRect:r,store:n}=e,o=(null==r?void 0:r.left)??0;if(n.isCollectionView()||n.isInsideCollection()){const e=(0,u().U)(n);if(e&&"table"!==e.getViewType())return{maxLeft:o,isBoundedByParentContainer:!1}}const a=null==t?void 0:t.getScrollerContext();let i=0;if(a&&a.horizontalScroller){const e=a.horizontalScroller.getClientRect();i=(null==e?void 0:e.left)??0}const s=Math.max(i,o),c=M(n)&&O(n)?b:0,l=s-c<=i,d=l?i:s;return{maxLeft:d,isBoundedByParentContainer:l}}({selectable:s,nodeRect:o,store:r}),h=A(n,l+_,r,g),m=d-((null==a?void 0:a.left)??0);if("drag_handle"===t)return m-A(n,l,r,g);if("plus_button"===t)return m-h;if("attribution_avatars"===t){return m-T({marginItemType:t,store:r,originalMenuOffset:h,environment:n,isBoundedByParentContainer:g})-k-c}if("presence_avatars"===t){return m-T({marginItemType:t,originalMenuOffset:h,environment:n,store:r,isBoundedByParentContainer:g})-k-c}(0,i().HB)(t)}function P(e){const{marginItemType:t,nodeRect:r,containerRect:n}=e;if("add_comment"===t)return((null==n?void 0:n.right)??0)-((null==r?void 0:r.right)??0);(0,i().HB)(t)}function T(e){var t;const{marginItemType:r,originalMenuOffset:n,environment:o,store:a,isBoundedByParentContainer:s}=e,c=v().default.state,l=c.isOpen&&(null===(t=c.currentStore)||void 0===t?void 0:t.id)===a.id;switch(r){case"attribution_avatars":return l?n:A(o,0,a,s);case"presence_avatars":return l&&c.currentStore&&!v().default.isRightMarginCommentHovered()?n:A(o,0,a,s);case"drag_handle":case"plus_button":return n;default:(0,i().HB)(r)}}function A(e,t,r,a){if(!a&&O(r)&&M(r))return t+b;if(r.isQuoteBlockChild()){return t+3+14+n().CC.paddingLeft}if(m().default.checkGate({gateName:"db_ux_chrome"})&&r.getType()===o().xd.collectionView)return t+6;if(r.isTransclusionType()||"ai_block"===r.getType())return t+4;if(r.isDirectChildOfAiBlock())return t+13;if(r.isInsideTransclusion())return t+5;if(r.getType()===o().xd.table){const n=h().Xe({simpleTableStore:r,environment:e,includeInline:!(0,d().dC)(e,r)}),o=r.isImmediateColumnChild();return 0!==n||o?t+8:t}const i=r.getNumberOfDuplicateBlocksAncestors();return i>0?t+s().t*i:t}function M(e){var t;if(e.getType()!==o().xd.page&&!e.isPersonProfile())return!1;const r=(0,u().U)(e);if(!r)return!1;return(e.isInsideCollection()||Boolean(null==r||null===(t=r.collectionStore())||void 0===t?void 0:t.isPageTreeCollection()))&&(0,l().f5)({collectionContextStore:r})}function O(e){var t;const r=S().default.state.stores.includes(e);return v().default.state.isOpen&&(null===(t=v().default.state.currentStore)||void 0===t?void 0:t.id)===e.id||r}},281795:(e,t,r)=>{r.d(t,{E:()=>a});var n=()=>r(963589),o=()=>r(706762);function a(){const e=(0,n().X)("opfs_recordmap_cache",!1,!1),t=(0,o().s)();return e&&t}},496978:(e,t,r)=>{r.d(t,{A:()=>q});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(823215),r(354520),r(672577),r(430670),r(581454);var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(641007),c=()=>r(798880),l=()=>r(959013),u=()=>r(496603),d=()=>r(534177),p=()=>r(116008),f=()=>r(777092),g=()=>r(278014),h=()=>r(680026),m=()=>r(569912),v=()=>r(299545),S=()=>r(141333),y=()=>r(129522),b=()=>r(695625),C=()=>r(765957),k=()=>r(372154),I=()=>r(732770),_=()=>r(630116),w=()=>r(502438),R=()=>r(24157),P=()=>r(381349),T=()=>r(634201);function A(e,t){return e&&(0,P().Nq)(e,t)}var M=()=>r(962730),O=r(474848);const x=function(e){let{renderTooltip:t,children:n,style:o}=e;return(0,O.jsx)(r(859428).A,{renderTooltip:t,placement:M().W.Bottom,alignment:M().C.Start,render:e=>(0,O.jsx)("div",{style:o,...e,children:n})})};const B=function(e){let{name:t,size:n,style:o,tooltipStore:a,userId:s}=e;const c=(0,i().IS)((e=>({wrapper:{background:"none",boxShadow:"none"},attribution:{boxSizing:"content-box",width:n||18,height:n||18,lineHeight:`${n||18}px`,overflow:"hidden",textAlign:"center",fontSize:11,letterSpacing:"0.03em",userSelect:"none",WebkitUserSelect:"none",fontVariant:"small-caps",color:s&&A(s,e),cursor:"default"}})),[s,n]),l=function(e){const t=e.name,r=e.email;let n;if(t||r){if(t){const e=t.split(" ").filter((e=>e.length>0));n=e.length>1?String(T().PE(e[0])[0])+String(T().PE(e[e.length-1])[0]):String(T().PE(t)[0])+String(T().PE(t)[1])}else n=null==r?void 0:r.substring(0,2);return n=n?n.toUpperCase():void 0,n}}({name:t});return l&&c.attribution.color?(0,O.jsx)(x,{style:o,renderTooltip:()=>(0,O.jsx)(r(706965).A,{store:a}),children:(0,O.jsx)("div",{style:c.wrapper,children:(0,O.jsx)("div",{style:c.attribution,children:(0,O.jsx)(r(288722).A,{children:l})})})}):null};var E=()=>r(453697);const L={position:"absolute",top:0,left:0,zIndex:89},F=16,D=22;const q=function(e){const{pageVisitStore:t,presenceStore:i}=e,s=(0,o().v3)(),[{status:c,value:l}]=(0,r(187174).Yb)((async()=>(0,r(488923).$g)()),[]),d=(0,n.useRef)(null),f=(0,r(963589).X)("block_attribution"),m=e.isPeekView?r(285288).A:r(195613).A,P=(0,a().K8)((()=>m.state.elementRef??{current:null}),[m]),T=(0,S().yE)(P),A=(0,S().o7)(P),M=(0,a().r6)((()=>{if(!f)return[];const e=T-5e3,t=e+A+5e3,r=function(e){var t;const{blockAttributionEnabled:r,containerEl:n,presenceStore:o,environment:a}=e,{currentUserSettingsStore:i}=C().default.state,s=(null==i||null===(t=i.getSettings())||void 0===t?void 0:t.show_block_attribution)??!0;if(!r||!s)return[];const{rootStore:c}=o.state;if(!n||!c||"editing"!==R().default.state.mode||p().A.state.open||k().A.state.open||I().A.state.isKeyboardMode)return[];let l;for(const u of w().default.state.stores){const e=u.findRecordStoreUIAncestor((e=>e instanceof _().Bv&&e.isTransclusionType())).ancestor;e&&e instanceof _().Bv&&"transclusion_container"===e.getType()&&(l=e)}const d=b().T.getMembersByDOMOrder({filter:()=>!0}),f=n.getBoundingClientRect(),g=v().zo({blockStore:c,transclusionReferences:"omit",childPages:"omit"}).flatMap((e=>{const t=[];if(e.isInsideTransclusion()||e.isTransclusionType()){let r=e;if("transclusion_reference"===e.getType()){const t=e.getTransclusionReferenceTargetStore();t&&(r=t)}"transclusion_reference"!==e.getType()&&"transclusion_container"!==e.getType()||(r!==l?t.push(U(e,d,f,a)):v().zo({blockStore:r,transclusionReferences:"omit",childPages:"omit"}).map((e=>t.push(U(e,d,f,a)))))}else t.push(U(e,d,f,a));return t})).filter((e=>!u().b0(e)));g.sort(((e,t)=>e.top-t.top));const h=g.filter(((e,t,r)=>0===t||e.actor.id!==r[t-1].actor.id));if(1===h.length)return[];return h}({blockAttributionEnabled:f,containerEl:d.current,presenceStore:i,environment:s});r.sort(((e,t)=>e.top-t.top));const n=[];return r.every((r=>r.top>=e&&r.top<=t&&(n.push(r),!0))),n}),[f,i,T,A,s],{debugName:"attributionAvatarStore",useDeepEqual:!0});(0,a().O$)(M),(0,n.useEffect)((()=>{let e;const t=u().sg(M.recompute,100);return f&&(window.addEventListener("resize",t),e=setInterval(t,1e3)),()=>{window.removeEventListener("resize",t),clearInterval(e)}}),[M,f]);const x=(0,a().O$)(M),B=[...(0,a().K8)((()=>function(e){const{attributionAvatars:t,pageVisitStore:r,presenceStore:n,environment:o,containerEl:a,coEditingPresenceStore:i}=e,{rootStore:s}=n.state;if(!s||!(0,h().xm)(n))return[];if(!a)return[];const c=o.currentUser.id,l=(0,h().PZ)({pageVisitStore:r,presenceStore:n}).filter((e=>e.userId!==c&&(0,h().dp)(o,e))),u=null==i?void 0:i.getPresencesForBlock(s.id);u&&l.push(...u);if(!l.length)return[];const d=new Set(t.map((e=>{let{blockStore:t}=e;return t.id}))),p={},f=b().T.getMembersByDOMOrder({filter:()=>!0}),m=a.getBoundingClientRect(),v=[];for(const b of l){const e=(0,h().EV)(b),t=null==b?void 0:b.blockPath;let r;if(t&&(null==t?void 0:t.length)>0?r=V(f,t,s):e&&(r=J(f,e,s)),!r)continue;const n=r.props.store.id;p.hasOwnProperty(n)||(p[n]=0),p[n]++;const a=r.getNode();if(!(a&&a instanceof Element))continue;const i=a.getBoundingClientRect();if(!i)continue;let c,l;if(r.props.store.isFirstBlockInCalloutV2Block()){var S;const e=null===(S=r.props.store.getRecordStoreUIParent())||void 0===S?void 0:S.findRecordStoreUIAncestor((e=>e instanceof _().Bv)).ancestor;e instanceof _().Bv&&(c=e,l=c?y().K.getRect(c):void 0)}const u=d.has(n),C=(0,g().ac)({marginItemType:"presence_avatars",nodeRect:l??i,containerRect:m,attributionsIncludeFoundBlock:u,avatarCount:p[n],store:c??r.props.store,environment:o}),k=(0,g().qg)({marginItemType:"presence_avatars",nodeRect:l??i,containerRect:m,environment:o,store:c??r.props.store,selectable:r});v.push({type:"presence",userId:b.userId,left:k,top:C,blockType:r.props.store.getType()})}return v}({attributionAvatars:x,pageVisitStore:t,presenceStore:i,environment:s,containerEl:d.current,coEditingPresenceStore:"resolved"===c?l:void 0})),[x,t,i,s,c,l],{debugName:"presenceAvatars",useDeepEqual:!0}),...x];return(0,O.jsx)("div",{className:"notion-presence-container",style:L,ref:d,children:(0,O.jsx)(r(93263).A,{render:()=>B.map((t=>{const{left:n,top:o}=t,a={avatarWrapperAnimation:{translateX:n,translateY:o,scale:1,opacity:1},avatarEnterExitAnimation:{scale:.7,opacity:0}},i={...a.avatarWrapperAnimation,...a.avatarEnterExitAnimation};return(0,O.jsx)(r(145214).A,{initial:i,exit:i,animate:a.avatarWrapperAnimation,children:(0,O.jsx)(N,{avatar:t,presenceStore:e.presenceStore})},"attribution"===t.type?t.uniqueId:t.userId)}))})})};function J(e,t,r){return e.find((e=>{const n=e.props.store;return Boolean(n&&n.id===t&&r.uiContains(n)&&e.props.shouldShowHalo)}))}function U(e,t,r,n){const o=e.getLastEditedByPointer();if(!o||o.table!==c().oo)return;const a=e.getType();if("collection_view"===a||"collection_view_page"===a||"divider"===a||"table"===a||"table_row"===a||"tab"===a)return;if(e.isEmptyEditableBlock())return;const i=J(t,e.id,e);if(!i)return;const s=i.getNode();if(!(s&&s instanceof Element))return;const l=s.getBoundingClientRect();if(!l)return;const u=(0,g().ac)({marginItemType:"attribution_avatars",store:e,containerRect:r,nodeRect:l,environment:n}),d=(0,g().qg)({marginItemType:"attribution_avatars",store:e,containerRect:r,nodeRect:l,environment:n,selectable:i});return{type:"attribution",actor:o,left:d,top:u,uniqueId:d>0?`${String(e.key)}+left`:String(e.key),blockStore:e}}function N(e){const{device:t}=(0,o().v3)(),{isMobile:r}=t,{avatar:n}=e,u=(0,l().tz)(),p=r?F:D,g=(0,i().IS)((e=>{const t={width:p,height:p,borderRadius:p};return{uiUserAvatarStyles:{...t},avatarInnerOutline:{...t,outlineStyle:"solid",outlineColor:e.UIUserAvatarInnerOutline,outlineWidth:.5,outlineOffset:-.5},avatarBorder:"presence"===n.type?{...t,outlineStyle:"solid",outlineColor:(0,h().$L)({userId:n.userId,theme:e}),outlineWidth:1.5,outlineOffset:-.5}:{},avatarWrapper:{...t,position:"absolute",top:0,left:r?2:0,outlineStyle:"solid",outlineWidth:.5,outlineOffset:1,outlineColor:e.UIUserAvatarOuterOutline},initialColor:"presence"===n.type?{color:(0,h().$L)({userId:n.userId,theme:e})}:{}}}),[r,p,n]),v=(0,a().K8)((()=>{const{rootStore:t}=e.presenceStore.state;if(t){if("presence"===n.type){if((0,c().MF)(n.userId))return{type:"presence",userStore:s().px};const e=_().LU.createChildStore(t,{table:c().oo,id:n.userId});return e.isDefined()?{type:"presence",userStore:e}:null}if("attribution"===n.type){const e=(0,f().JQ)({parentStore:t,pointer:n.actor});return e.isDefined()?{type:"attribution",userId:e.id,name:e.getDisplayName(u),blockStore:n.blockStore}:null}(0,d().HB)(n)}return null}),[n,u,e.presenceStore]);return v?(0,m().A)((e=>"presence"===v.type?(0,O.jsx)("div",{style:g.avatarWrapper,...e,children:(0,O.jsx)("div",{style:g.avatarBorder,children:(0,O.jsx)(E().A,{iconStyle:g.avatarInnerOutline,hasTooltip:!0,userStore:v.userStore,style:g.uiUserAvatarStyles,size:p,avatarShouldShowShadow:!0,initialOverrideStyle:g.initialColor})})}):"attribution"===v.type?(0,O.jsx)("div",{style:g.avatarWrapper,...e,children:(0,O.jsx)(B,{userId:v.userId,name:v.name,style:g.uiUserAvatarStyles,size:D,tooltipStore:v.blockStore})}):void(0,d().HB)(v))):null}function V(e,t,r){const n=new Map(t.map(((e,t)=>[e,t])));let o,a;for(const i of e){const e=i.props.store,t=n.get(e.id);if(void 0!==t&&((void 0===a||t<a)&&r.uiContains(e)&&i.props.shouldShowHalo&&(o=i,a=t),0===a))return o}return o}},556048:(e,t,r)=>{r.d(t,{C8:()=>p,Dz:()=>c,GC:()=>g,GL:()=>h,YY:()=>f,dM:()=>u,h9:()=>l,jX:()=>s,oF:()=>d,uj:()=>i});var n=()=>r(645873);const o={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([r.e(75134),r.e(68744)]).then(r.bind(r,408453)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([r.e(75134),r.e(2686)]).then(r.bind(r,484967)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await r.e(28763).then(r.bind(r,992567)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await r.e(98288).then(r.bind(r,244399)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await r.e(21446).then(r.bind(r,470020)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await r.e(21446).then(r.bind(r,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await r.e(21446).then(r.bind(r,470020)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await r.e(21446).then(r.bind(r,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await r.e(21446).then(r.bind(r,470020))))},a={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([r.e(75134),r.e(92845),r.e(84468),r.e(5605),r.e(48486),r.e(95794),r.e(13677),r.e(56952),r.e(25497),r.e(74562),r.e(27711),r.e(30291),r.e(12913),r.e(28464),r.e(6463),r.e(50569),r.e(93449),r.e(56188)]).then(r.bind(r,604698))))},i=(0,n()._h)(a.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,n()._h)(o.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),c=(0,n()._h)(o.JiraDCAuthModal,(e=>e.default)),l=(0,n()._h)(o.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),u=(0,n()._h)(o.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),d=(0,n()._h)(o.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(o.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),f=(0,n()._h)(o.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,n()._h)(o.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),h=(0,n()._h)(o.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,r(340498).xh)("jira",{default:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:20},small:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:16},mini:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:14},large:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:24}})},571400:(e,t,r)=>{r.d(t,{t:()=>n});const n=35},629537:(e,t,r)=>{r.d(t,{V:()=>i});r(296540);var n=()=>r(56366),o=()=>r(851240),a=r(474848);function i(e){const{render:t,...r}=e,i=(0,o().A)(r);return(0,a.jsx)(a.Fragment,{children:(0,n().K8)((()=>t(i)),[t,i],{silenceRerenderDefender:!0})})}},679192:(e,t,r)=>{r.d(t,{w:()=>a});var n=()=>r(645873);const o={UncollectibleExperienceOverlay:new(n().O2)("UncollectibleExperienceOverlay",(async()=>r.e(36432).then(r.bind(r,134673))))},a=(0,n()._h)(o.UncollectibleExperienceOverlay,(e=>e.UncollectibleExperienceOverlay))},773582:(e,t,r)=>{r.d(t,{I:()=>o,O:()=>a});var n=()=>r(143197);function o(e){const{cursors:t,rootStore:r}=e,o={};for(const n of t)for(const e of n.stack)for(const t of e)o[t.id]=t.index;n().A.setLimitParents(r,o)}function a(e){n().A.removeLimitParents(e.rootStore)}},851240:(e,t,r)=>{r.d(t,{A:()=>re});r(16280),r(944114),r(898992),r(354520),r(672577),r(430670),r(964979);var n=r.n(r(625473)),o=r(296540),a=()=>r(17022),i=()=>r(908006),s=()=>r(484714),c=()=>r(56366),l=()=>r(105751),u=()=>r(591779),d=()=>r(386164),p=()=>r(388821),f=()=>r(161479),g=()=>r(449412),h=()=>r(319625),m=()=>r(496603),v=()=>r(763824),S=()=>r(498212),y=()=>r(534177),b=()=>r(787172),C=()=>r(915086),k=()=>r(773582),I=()=>r(466721),_=()=>r(507785),w=()=>r(666144),R=()=>r(255460),P=()=>r(633457),T=()=>r(374026),A=()=>r(780054),M=()=>r(603815),O=()=>r(953418),x=(r(581454),()=>r(700500)),B=()=>r(651124),E=()=>r(179034),L=()=>r(519831),F=()=>r(449506),D=()=>r(504836),q=()=>r(217429);async function J(e){if(!(0,D().vL)())return;if("all_views"===e.viewType){if(!q().default.checkGate({gateName:"jira_linked_views_resync_on_load"}))return;const t=e.recordMap,r=((null==t?void 0:t.getByTable(L().Vl).filter((e=>{var t;let{value:r}=e;return(null==r||null===(t=r.value)||void 0===t||null===(t=t.format)||void 0===t?void 0:t.external_collection_type)===B().uO.Jira})))||[]).map((e=>{let{value:t}=e;return(null==t?void 0:t.value)&&{id:t.value.parent_id,table:E().ev,spaceId:t.value.space_id}})).filter(y().O9);for(const n of r)await F().callApi({eventName:"resyncJiraCollection",environment:e.environment,data:{pagePointer:n}});return}const t=e.pageStore,r=t.getType(),n=t.getFormat();r&&(0,x().Ef)(r)&&(0,D().MP)(null==n?void 0:n.app_config_uri)&&await F().callApi({eventName:"resyncJiraCollection",environment:e.environment,data:{pagePointer:t.pointer}})}var U=()=>r(303626),N=()=>r(281795),V=()=>r(865085),j=()=>r(882368),W=()=>r(495074),H=()=>r(695625),z=()=>r(792415),$=()=>r(765957),K=()=>r(227440),G=()=>r(83573),Q=()=>r(961581),X=()=>r(606932),Y=()=>r(865688);function Z(e){performance.mark(`OPFS:useLoadPage:${e}`)}function ee(e,t,r){return performance.measure(`OPFS:useLoadPage:${e}`,`OPFS:useLoadPage:${t}`,`OPFS:useLoadPage:${r}`)}let te=!1;function re(e){return function(e){!function(e){const{pageStore:t,store:r}=e,{initialRequestCompleted:n,error:a}=(0,c().K8)((()=>({initialRequestCompleted:r.state.initialRequestCompleted,error:r.state.error})),[r]);(0,o.useEffect)((()=>{if(n&&!a)return W().A.trackPage(t),()=>{W().A.untrackPage(t)}}),[n,a,t])}(e);const{isCollectionInPage:t,updateIsCollectionInPage:r}=function(){const e=(0,s().v3)(),[t,r]=(0,o.useState)(!1),n=(0,o.useCallback)((r=>{var n;const{page:o,recordMap:a,inMemoryRecordCache:i}=r;if(t)return!0;const s=null===(n=i.getRecord({pointer:{table:"block",id:o.id,spaceId:o.spaceId},userId:e.currentUser.id}))||void 0===n?void 0:n.value;if(s)for(const e of a.getByTable("block")){var c,l,u;if(("collection_view"===(null===(c=e.value)||void 0===c||null===(c=c.value)||void 0===c?void 0:c.type)||"collection_view_page"===(null===(l=e.value)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.type))&&s.parent_id!==(null===(u=e.value)||void 0===u||null===(u=u.value)||void 0===u?void 0:u.collection_id))return!0}return!1}),[e,t]);return{isCollectionInPage:t,updateIsCollectionInPage:(0,o.useCallback)((e=>{r(n(e))}),[n])}}(),n=(0,o.useRef)(null);(function(e){const{store:t,pageStore:r,observer:n}=e,u=(0,s().v3)(),{loading:f,endOfResultsReached:g,initialRequestCompleted:m,error:S}=(0,c().K8)((()=>({loading:t.state.loading,endOfResultsReached:t.state.endOfResultsReached,initialRequestCompleted:t.state.initialRequestCompleted,error:t.state.error})),[t]),k=ae(e),I=function(e){const{pageStore:t}=e,r=(0,s().v3)(),n=(0,s().Y0)(),a=(0,N().E)(),i=oe(e),c=ne(e),u=function(e){const{pageStore:t}=e,r=(0,s().v3)();return(0,o.useCallback)((async e=>{const{request:n,userId:o,abortSignal:a}=e;Z("load-opfs-page-cache.start");const i=await async function(e){const{userId:t,pageId:r,abortSignal:n}=e;if(!(0,j().getOPFSPageCache)())return;if(!Q().A.state.initialRenderCompleted&&V().OPFSBootupRegistry.pageRecordMapBufferPromise)try{Z("readBuffer.start");const e=await V().OPFSBootupRegistry.pageRecordMapBufferPromise;Z("readBuffer.end");const t=ee("readBuffer","readBuffer.start","readBuffer.end");return V().OPFSBootupRegistry.updateInitialMetricData({await_read_blocking_page_chunk_end_duration:t.duration}),e}catch(S){return}else{const e=(0,j().getOPFSPageCache)();if(!e)return;try{return await e.readBuffer(t,r,n)}catch(S){return void(S instanceof DOMException&&S.name)}}}({userId:o,pageId:n.page.id,abortSignal:a});Z("load-opfs-page-cache.end");ee("load-opfs-page-cache","load-opfs-page-cache.start","load-opfs-page-cache.end");if(null!=a&&a.aborted)throw new Error("Abort signal received");if(!i)throw new Error("No OPFS RecordMap found");if(!i.buffer||0===i.buffer.byteLength)throw new Error("No Valid OPFS RecordMap found");const s=i.iterator.next();if(!s.value)throw new Error("Failed to extract first chunk from buffer");const c=s.value,l=p().RecordMapWithRole.create(c);return w()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:l,debugSource:"PageLoadingContainer.OPFSPageCache"}),{source:"local",localSource:"opfs",recordMap:l,iterator:i.iterator,metadata:i.metadata,isLast:1===i.metadata.totalChunks}}),[r,t])}(e),f=ae(e);return(0,o.useCallback)((async()=>{const e={page:{id:t.id,spaceId:t.getSpaceId()},cursor:{stack:[]},verticalColumns:Boolean(A().A.isMobile)},o=await(0,l().getHtmlStreamQueueEntry)("requiredRedirectMetadata");o&&o.pageId===t.id&&o.requiresRedirect&&o.redirectUrl&&(window.location.href=o.redirectUrl,await new Promise((()=>{})));try{return{firstPageChunkResult:await i({request:e,mode:"inMemoryOnly",isFirstChunk:!0})}}catch(S){}const s=await async function(e){const{environment:t,pageId:r}=e;if(!(await(0,l().getHtmlStreamQueueEntry)("serverSidePrefetchDataPending")))return;const n=await(0,l().getHtmlStreamQueueEntry)("serverSidePrefetchData");if(n&&n.pageId===r){(0,b().s)({environment:t,eventName:"loadCachedPageChunkV2",response:n,userId:t.currentUser.id});const e=p().RecordMapWithRole.create(n.recordMap);return{source:"server",cursors:n.cursors,recordMap:e}}}({environment:r,pageId:t.id});if(s)return{firstPageChunkResult:s};const g=le(e),h=g?r.prefetchCache.getPrefetchStatus(g):void 0,m=Boolean(r.defaultRecordCache.persistedRecordCache)&&"success"!==h,v=new AbortController,C=new AbortController,k=new AbortController,I=[];a&&r.currentUser.id&&I.push(u({request:e,userId:r.currentUser.id,abortSignal:k.signal})),m&&I.push(i({request:e,mode:n.isAndroid?"inMemoryAndDiskCache":"inMemoryAndDiskCacheWithInexactPreload",isFirstChunk:!0,abortSignal:v.signal})),I.push(c({request:e,headers:(0,d().WS)({recordId:t.id,spaceId:t.getSpaceId()}),abortSignal:C.signal})),f.concurrentlyWithAsyncRequests();const _=await Promise.any(I);if("local"===_.source){const e=`${_.source}-${_.localSource} won`;"disk"===_.localSource?(C.abort(e),k.abort(e)):"opfs"===_.localSource&&(v.abort(e),C.abort(e))}else if("remote"===_.source||"remoteV2"===_.source||"server"===_.source){const e=`${_.source} won`;v.abort(e),k.abort(e)}else(0,y().HB)(_);return{firstPageChunkResult:_}}),[f,n.isAndroid,i,c,u,t,r,a])}(e),_=function(e){const{pageStore:t}=e,r=(0,s().v3)(),n=oe(e),a=ne(e),i=ae(e);return(0,o.useCallback)((async e=>{const{firstPageChunkResult:o}=e;if(ce(o)){let e=1;const n=o.iterator;let a=n.next();for(;!a.done;){e++;const s=a.value,c=p().RecordMapWithRole.create(s);await w()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:c,debugSource:"PageLoadingContainer.OPFSPageCache"}),i.afterEachChunk({source:"local",localSource:"opfs",metadata:o.metadata,recordMap:c,iterator:n,isLast:o.metadata.totalChunks===e}),a=n.next()}}else{const e=e=>{let t;if(t=se(e)?e.cursors:ce(e)?void 0:[e.cursor],t)return t.filter((e=>e.stack.length>0))};let r=e(o);for(;r&&r.length>0;){r=(await v().lX(r,10,(async e=>{const r={page:{id:t.id,spaceId:t.getSpaceId()},cursor:e,verticalColumns:Boolean(A().A.isMobile)};let s;try{s="local"===o.source?await n({request:r,mode:"inMemoryAndDiskCache",isFirstChunk:!1}):await a({request:r,headers:(0,d().WS)({cellId:"cellId"in e?e.cellId:void 0})})}catch(S){s=se(o)?{source:"remoteV2",cursors:[],recordMap:p().RecordMapWithRole.create({})}:"remote"===o.source?{source:o.source,cursor:{stack:[]},recordMap:p().RecordMapWithRole.create({})}:{source:o.source,localSource:o.localSource,cursor:{stack:[]},recordMap:p().RecordMapWithRole.create({})}}return i.afterEachChunk(s),s}))).flatMap((t=>e(t)??[]))}}}),[r,i,n,a,t])}(e);if(f||g||m&&S)return;async function R(){let e;t.setState({...t.state,loading:!0}),X().A.markRequestFirstChunkStart(),Q().A.state.initialRenderCompleted||C().setSubMetric({name:"render_end_to_await_page_chunk_start",startTime:e=>{var t;return null===(t=e.render_start_to_render_end)||void 0===t?void 0:t.endTime},endTime:performance.now()});try{e=(await I()).firstPageChunkResult}catch(S){return void M(S)}if(!Q().A.state.initialRenderCompleted){C().setSubMetric({name:"await_page_chunk_start_to_await_page_chunk_end",startTime:e=>{var t;return null===(t=e.render_end_to_await_page_chunk_start)||void 0===t?void 0:t.endTime},endTime:performance.now()}),"local"===e.source&&"opfs"===e.localSource&&V().OPFSBootupRegistry.IPRMetricData&&C().updateOPFSMetricData(V().OPFSBootupRegistry.IPRMetricData);const t=u.prefetchCache;C().updateMetricData({page_chunk_source:e.source,local_source:"local"===e.source?e.localSource:void 0,page_chunk_prefetch:"server"===e.source?{type:"hit-server"}:t.getPrefetchAnalytic(`loadCachedPageChunk(${r.id})`)})}const o={chunkSource:e.source,chunkLocalSource:"local"===e.source?e.localSource:void 0};X().A.markRequestFirstChunkEnd(o),null==n||n.startRecording(o),P(),q().default.checkGate({gateName:"load_page_flush"})?await i().default.flush():await i().default.afterNextFlush(),k.afterEachChunk(e);const a=_({firstPageChunkResult:e});try{await a}catch(S){return void M(S)}T(),k.afterAllChunks()}function P(){t.setState({...t.state,initialRequestCompleted:!0})}function T(){t.setState({initialRequestCompleted:!0,ready:!0,loading:!1,endOfResultsReached:!0,error:void 0})}function M(e){t.setState({ready:!0,initialRequestCompleted:!0,loading:!1,endOfResultsReached:!1,error:(0,h().A)(e)})}a().e.withListenerIgnored((()=>{R()}))})({...e,updateIsCollectionInPage:r,scrollerRef:n}),function(e){const{store:t,scrollToBlockIds:r,onReady:n,onDone:a,pageStore:s}=e;(0,o.useEffect)((()=>{let e;const o=m().Oo((()=>{r&&n&&(e=async function(e,t){e&&await R().NH(t,e)}(r,s))})),c=m().Oo((()=>{n&&i().default.afterNextFlush((()=>{i().default.afterNextFlush((async()=>{if(e){const t=performance.now();await(0,v().Vq)(e,5e3),Q().A.state.initialRenderCompleted||C().updateMetricData({scroll_to_blocks_wait_time:performance.now()-t})}n()}))}))})),l=m().Oo((()=>{null==a||a()})),u=()=>{t.state.loading&&o(),t.state.ready&&c(),(t.state.endOfResultsReached||t.state.error)&&l()};return t.addListener(u),()=>{t.removeListener(u)}}),[a,n,s,r,t])}(e),function(e){const{store:t}=e,r=(0,c().K8)((()=>t.state.error),[t]),n=(0,c().O$)(K().e),a=(0,u().ZC)(n),i=void 0!==a&&(n&&!a);(0,o.useEffect)((()=>{i&&r&&t.reset()}),[i,t,r])}(e),function(){const e=(0,s().v3)(),t=(0,c().K8)((()=>{var e;return null===(e=$().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id}),[]),r=(0,c().K8)((()=>$().default.state.currentUserRootStore),[]),n=(0,c().O$)(K().e),a=(0,u().ZC)(n),i=void 0!==a&&(n&&!a);(0,o.useEffect)((()=>{async function n(){const{route:n}=e.RouterStore.state,o=await _().Ty({environment:e,request:{...n,type:"block-space",blockId:t,spaceId:"spaceId"in n?n.spaceId:void 0,slug:"slug"in n?n.slug:void 0,spaceDomain:"spaceDomain"in n?n.spaceDomain:void 0,requestedOnPublicDomain:"requestedOnPublicDomain"in n?n.requestedOnPublicDomain:void 0,isBot:!1}});if("failed"===o.type)return;const a=o.data;if(z().A.setState({publicPageData:a}),a.spaceId&&r){const e=r.getSpaceViewStores().find((e=>e.getSpaceId()===a.spaceId));e&&$().default.setState({...$().default.state,currentSpaceStore:e.getSpaceStore(),currentSpaceViewStore:e})}}i&&t&&n()}),[i,e,t,r])}();const{store:f}=e;return(0,c().K8)((()=>({ready:f.state.ready,error:f.state.error,initialRequestCompleted:f.state.initialRequestCompleted,endOfResultsReached:f.state.endOfResultsReached,isCollectionInPage:t,scrollerRef:n})),[f,t,n])}({...e,store:(0,c().uB)(e.store,Y().A)})}function ne(e){const{pageStore:t}=e,r=(0,s().v3)();return(0,o.useCallback)((async e=>{const{request:n,headers:o,abortSignal:a}=e,i=M().JQ(t),s=await M().Vn({environment:r,request:{...n,...i?{omitExistingRecordVersions:i}:{}},abortSignal:a,prefetchCacheKey:le(n),headers:o});if(null!=a&&a.aborted)throw new Error("Abort signal received");if("success"===s.type){return{recordMap:p().RecordMapWithRole.create(s.data.recordMap),cursors:s.data.cursors,source:"remoteV2"}}throw g().O8(s.error,{from:"useLoadRemotePageChunk",type:"pageLoadingError",data:{pageId:t.id,miscDataToConvertToString:{offline:s.offline,status:s.status,body:s.body}}}),new Error("No successful load result found.")}),[r,t])}function oe(e){const{pageStore:t}=e,r=(0,s().v3)();return(0,o.useCallback)((async e=>{const{request:n,mode:o,isFirstChunk:a,abortSignal:i}=e;Z("localLoadPageChunk.start");const s=await U().N.measure("localLoadPageChunk",n.page.id,(()=>M().s4({mode:o,environment:r,request:n,isFirstChunk:a,abortSignal:i})));Z("localLoadPageChunk.end");ee("localLoadPageChunk","localLoadPageChunk.start","localLoadPageChunk.end");if(null!=i&&i.aborted)throw new Error("Abort signal received");const c=p().RecordMapWithRole.create(s.recordMap);return w()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:c,debugSource:"PageLoadingContainer.performLocalLoadPageChunk"}),{source:"local",localSource:"inMemoryOnly"===o?"memory":"disk",cursor:s.cursor,recordMap:c}}),[r,t])}function ae(e){const{pageStore:t,store:r,scrollToDiscussionId:n,scrollerRef:a,scrollToPosition:c,scrollToBlockIds:l,updateIsCollectionInPage:u,pageVisitStore:d,disableSideEffects:p,observer:g}=e,h=(0,s().v3)(),v=(0,o.useCallback)((()=>{p||I().Ds(h,{blockStore:t,pageVisitStore:d,incremental:!1}).catch((()=>{}))}),[p,h,t,d]),S=(0,o.useCallback)((e=>{if(p)return;let o,s;se(e)?(o=ie(e.cursors),s=e.cursors):ce(e)?(o=function(e){return e.isLast}(e),s=void 0):(o=ie([e.cursor]),s=[e.cursor]),o||i().default.afterNextFlush((()=>{if(r.state.ready)return;const e=!n||(t=n,Boolean((0,T().V)({discussionId:t})));var t;const o=!0===function(e){const{scrollerRef:t,scrollToPosition:r}=e;if(null===t.current)return;const n=(0,O().NM)(t.current);return!n||!m().Et(r)||r<=n.scrollHeight-n.clientHeight}({scrollerRef:a,scrollToPosition:c})&&function(e){return!e||H().T.findSelectablesFromIds(e).length===e.length}(l)&&e;o&&r.setState({...r.state,ready:!0})})),u({page:{id:t.id,spaceId:t.getSpaceId()},recordMap:e.recordMap,inMemoryRecordCache:t.inMemoryRecordCache}),h.currentUser.isLoggedIn()&&(G().A.addFromRecordMapWithRole(e.recordMap),G().A.isEmpty()||P().lK({environment:h})),h.currentUser.isLoggedIn()&&J({environment:h,recordMap:e.recordMap,viewType:"all_views"}),s&&k().I({rootStore:t,cursors:s})}),[p,h,t,l,n,c,a,r,u]),y=(0,o.useCallback)((()=>{p||("personal_home_page"!==t.getType()&&async function(e){const{blockPointer:t,environment:r}=e;r.LocalBacklinkStore.initializeBacklinks({block:{id:t.id,spaceId:(0,f().e)(t.spaceId)},currentUserId:r.currentUser.id,environment:r});try{await r.LocalBacklinkStore.awaitLoaded(t.id)}catch(n){}}({environment:h,blockPointer:t.pointer}),h.currentUser.isLoggedIn()&&J({environment:h,pageStore:t,viewType:"collection_view_full_page"}),null==g||g.onLastChunkLoaded(h))}),[p,h,t,g]);return(0,o.useMemo)((()=>({concurrentlyWithAsyncRequests:v,afterEachChunk:S,afterAllChunks:y})),[v,S,y])}function ie(e){return 0===e.length||1===e.length&&(!(t=e[0])||0===t.stack.length);var t}function se(e){return"remoteV2"===e.source||"server"===e.source}function ce(e){return"local"===e.source&&"opfs"===e.localSource}function le(e){if(function(e){return!e.cursor||0===e.cursor.stack.length}(e))return`loadCachedPageChunk(${e.page.id})`;{const t=(0,S().gB)(n()(e.cursor));return`loadCachedPageChunk(${e.page.id})-${t}`}}(0,r(604341).exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{te=!te,console.info(te?"Local page load error logging enabled":"Local page load error logging disabled")}))}}]);