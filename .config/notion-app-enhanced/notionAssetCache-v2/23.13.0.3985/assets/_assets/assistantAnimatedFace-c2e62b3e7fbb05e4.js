"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[15961],{995062:(e,t,n)=>{n.r(t),n.d(t,{AssistantAnimatedFace:()=>A,AssistantAnimatedFaceInner:()=>x});n(18107),n(967357);var i=()=>n(303848),a=()=>n(244641),r=n(296540),o=()=>n(624919),s=()=>n(56366),c=()=>n(401497),u=()=>n(604341),l=()=>n(592328),g=()=>n(336811),d=()=>n(999752),h=()=>n(763824),w=()=>n(534177),f=()=>n(631611),p=()=>n(295169),S=()=>n(337567),m=()=>n(865241),v=()=>n(998109),b=()=>n(846955),T=()=>n(278589),k=()=>n(783793);const y=n.p+"bc69e69669ca365b.riv",I=["Base_Idle","Idle A","Idle B","Idle C"];var C=n(474848);i().RuntimeLoader.setWasmUrl(n(390654));const M=!1;function A(e){const{sizeVariant:t,includeBoxShadow:n,onMouseEnter:i}=e,a=function(){const e=(0,f().jw)().isWriter,t=(0,s().K8)((()=>{const t=e?(0,S().K1)():p().default.getActiveSession();if(!t)return"idle";const n=t.evaluator.getTranscript().at(-1);if(n&&"observation"===n.type&&"error"===n.observationType)return"error";const i=t.isStreaming();if(!i)return"idle";const a=t.getCombinedSteps().at(-1),r="assistantSearch"===(null==a?void 0:a.type)||"assistantShowSearchResults"===(null==a?void 0:a.type),o="assistantLoading"===(null==a?void 0:a.type)||"human"===(null==a?void 0:a.type);return"groupedEditCard"===(null==a?void 0:a.type)?"writing":r?"searching":o?"thinking":i?"writing":"idle"}),[e]);return(0,r.useEffect)((()=>{M&&L("HighLevelState","Pink",t)}),[t]),t}();return(0,C.jsx)(v().n,{step:"ai_assistant",isFullWidth:!1,highlightStyle:{borderRadius:"100%"},children:(0,C.jsx)(x,{sizeVariant:t,includeBoxShadow:n,highLevelState:a,onMouseEnter:i})})}function x(e){const{sizeVariant:t,highLevelState:n,includeBoxShadow:a,onMouseEnter:f}=e,[p,S]=(0,r.useState)(!1),v=(0,r.useCallback)((()=>{S(!0)}),[]),{onStateChange:A,waitUntilState:x,animationState:_}=function(){const e=(0,r.useRef)("Idle B"),t=(0,r.useMemo)((()=>new(l().A)),[]),n=(0,r.useCallback)((n=>{if(Array.isArray(n.data)&&1===n.data.length){const i=n.data[0];M&&L("State change","DarkGreen",i),e.current=i,t.emit(i)}}),[t]),i=(0,r.useCallback)((()=>new Promise((e=>{const n=i=>{t.removeListener(n),e(i)};t.addListener(n)}))),[t]),a=(0,r.useCallback)((async t=>{(await h().nQ(2e3,(async()=>{for(;!t(e.current);)await i()})())).timeout&&(0,o().NK)("Timed out while waiting for an assistant face state change.")}),[i]);return{animationState:e,waitUntilState:a,onStateChange:n}}(),{rive:E,RiveComponent:R}=(0,i().useRive)({src:y,stateMachines:["Main"],autoplay:!0,onAdvance:v,onStateChange:A});!function(e){const t=(0,s().K8)((()=>m().A.state.isVisible),[]),n=(0,r.useCallback)((()=>{null==e||e.startRendering()}),[e]),i=(0,r.useCallback)((()=>{null==e||e.stopRendering()}),[e]);(0,r.useEffect)((()=>{t?n():i()}),[t,i,n])}(E);const W=function(e){const t=(0,r.useMemo)((()=>{const t=null==e?void 0:e.stateMachineInputs("Main"),n=new Map;if(!t)return n;for(const e of t)n.set(e.name,e);return n}),[e]);(0,r.useEffect)((()=>{(0,u().exposeDebugValue)("AssistantAnimatedFaceTriggers",t)}),[t]);const n=(0,g().T)(),i=(0,r.useCallback)((e=>{var i;n.current&&(M&&L("Firing trigger","MediumBlue",e),null===(i=t.get(e))||void 0===i||i.fire())}),[n,t]);return i}(E),B=(0,r.useMemo)((()=>new(d().O)(1)),[]);(0,r.useEffect)((()=>{B.enqueue((async()=>{"writing"===n?W("WritingInTrigger"):"idle"===n?(await async function(){"Writing_In"===_.current&&await x((e=>"Writing_Loop"===e)),"Writing_Loop"===_.current&&(W("WritingOutTrigger"),await x((e=>(0,w().Xk)(I,e)))),"Thinking_In"!==_.current&&"Thinking_Loop"!==_.current||(W("ThinkingOutTrigger"),await x((e=>(0,w().Xk)(I,e)))),"Searching_In"===_.current&&await x((e=>"Searching_Loop"===e)),"Searching_Loop"===_.current&&(W("SearchingOutTrigger"),await x((e=>(0,w().Xk)(I,e))))}(),W("IdleTrigger")):"searching"===n?W("SearchingInTrigger"):"thinking"===n?W("ThinkingInTrigger"):"error"===n?W("ErrorTrigger"):(0,w().HB)(n)}))}),[n,W,x,B,_]);const F=(0,c().IS)((e=>{const n=(0,T().N)(t);return{wrap:{width:n,height:n,...a&&{boxShadow:e.shadowXS,borderRadius:"100%"},position:"relative"},faceImg:{position:"absolute",height:n,width:n},staticFace:{position:"absolute",left:0,top:0}}}),[t,a]);return(0,C.jsxs)("div",{style:F.wrap,onMouseEnter:e=>{e.stopPropagation(),null==f||f(e),setTimeout((()=>b().default.dismissTourTutorial()),400)},children:[(0,C.jsx)(R,{style:F.faceImg,onMouseEnter:()=>{Math.random()<.1&&W("GreetingTrigger")}}),p?void 0:(0,C.jsx)(k().o,{variant:t,wrapWithPadding:!0,style:F.staticFace,shadowVariant:a?"strong":"none"})]})}function L(e,t){const n=a().c9.local().toFormat("HH:mm:ss.SSS");for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];console.log(`%c[${n}] %c${e}:`,"color: Grey;",`color: ${t}; font-weight: bold;`,...r)}}}]);