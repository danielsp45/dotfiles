"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[45620],{90857:(e,t,n)=>{n.d(t,{Om:()=>C,g2:()=>b,FC:()=>w,$z:()=>S,IC:()=>f});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(581454);var a=()=>n(244641),r=()=>n(465474),o=()=>n(857639),i=()=>n(496603),c=()=>n(534177),d=()=>n(569243),s=()=>n(185984),l=()=>n(812109),u=()=>n(606982),m=()=>n(823115);function v(e){if(e.isAllDay){const{date:t}=e.start;return(0,m().V$)(t,"UTC")}{const{dateTime:t}=e.start;return a().c9.fromISO(t,{zone:"UTC"})}}function f(e){let{botId:t,accounts:n,calendars:a,events:o,timeMin:i,timeMax:c}=e;const d=new(r().A)(a.map(p),l().N);return{botId:t,accounts:new(r().A)(n,(e=>e.id)),calendars:d,events:new(r().A)(g(o).sort(y(d)),l().z),timeMin:i,timeMax:c}}function p(e){return{...e,color:(0,d().Pf)({color:e.color,colorId:e.colorId,colorType:"calendar"}),colorId:void 0,primary:e.primary}}function g(e){return e.map((e=>function(e){var t,n,r,i,c,s;let l;const u=h(null===(t=e.start)||void 0===t?void 0:t.timeZone),v=h(null===(n=e.end)||void 0===n?void 0:n.timeZone),f=(null===(r=e.start)||void 0===r?void 0:r.date)??(null===(i=e.start)||void 0===i?void 0:i.dateTime)??void 0,p=(null===(c=e.end)||void 0===c?void 0:c.date)??(null===(s=e.end)||void 0===s?void 0:s.dateTime)??void 0;if(!f||!p)return;const g=()=>{o().log({level:"error",from:"toHydratedEvent",type:"invalidDate",data:{miscDataToConvertToString:{accountId:e.accountId,calendarId:e.calendarId,eventId:e.id,start:f,end:p}}})};if(e.isAllDay){let e,t;try{e=(0,m().J_)(f,u||"UTC"),t=(0,m().J_)(p,u||"UTC")}catch(S){return void g()}l={isAllDay:!0,start:{date:e},end:{date:t}}}else{const e=a().c9.fromISO(f,{zone:u}),t=a().c9.fromISO(p,{zone:v});if(!e.isValid||!t.isValid)return void g();l={isAllDay:!1,start:{dateTime:f,timeZone:u},end:{dateTime:p,timeZone:v}}}return{...e,...l,color:(0,d().Pf)({colorId:e.colorId,colorType:"event"})}}(e))).filter(c().O9)}function h(e){if(e)return a().R2.normalizeZone(e).isValid?e:void 0}function S(e){let{events:t,updatedCalendarAndAccountIds:n,newEvents:a,calendars:o}=e;const i=new Set(n.map(l().N)),c=function(e,t,n){const a=[];let r=0,o=0;for(;r<e.length&&o<t.length;){n(e[r],t[o])<=0?(a.push(e[r]),r++):(a.push(t[o]),o++)}r<e.length?a.push(...e.slice(r)):o<t.length&&a.push(...t.slice(o));return a}(t.getOrderedValues().filter((e=>!i.has((0,l().N)(e)))),[...a].sort(y(o)),y(o));return new(r().A)(c,l().z)}function y(e){const t=t=>e.get((0,l().N)(t));return(e,n)=>function(e){let{aCalendar:t,aEvent:n,aStartTimeOverride:a,bCalendar:r,bEvent:o,bStartTimeOverride:i}=e,c=a,d=i;if(!c&&n.start&&(c=v(n)),!d&&o.start&&(d=v(o)),!c)return 1;if(!d)return-1;let s=(0,u().A)(c.toMillis(),d.toMillis());if(0===s){var l,m;const e=Boolean(null==t?void 0:t.primary),a=Boolean(null==r?void 0:r.primary),i=Boolean(null===(l=n.conferencing)||void 0===l?void 0:l.providerName),c=Boolean(n.hasParticipants),d=i&&c,u=Boolean(null===(m=o.conferencing)||void 0===m?void 0:m.providerName),v=Boolean(o.hasParticipants),f=u&&v,p="accepted"===n.responseStatus,g="accepted"===o.responseStatus,h="needsAction"===n.responseStatus,S="needsAction"===o.responseStatus,y="tentative"===n.responseStatus,I="tentative"===o.responseStatus;e&&!a?s=-1:a&&!e?s=1:d&&!f?s=-1:f&&!d?s=1:i&&!u?s=-1:u&&!i?s=1:c&&!v?s=-1:v&&!c?s=1:p&&!g?s=-1:g&&!p?s=1:!h||g||S?!S||p||h?y&&!(g||S||I)?s=-1:I&&!(p||h||y)&&(s=1):s=1:s=-1}return s}({aEvent:e,bEvent:n,aCalendar:t(e),bCalendar:t(n)})}function I(e,t){return(0,m().V$)(e,t).minus({days:1}).toISODate()}function b(e){let{events:t,getCalendarVisibility:n,calendars:a,startDate:o,endDateInclusive:c,eventFilters:d,timeZone:s}=e;const u=o.toISODate(),v=c.toISODate(),f=new(r().A)([],(e=>{let{baseEvent:t}=e;return t.id}));for(const r of t){const e=null==a?void 0:a.get((0,l().N)(r));if(!e||!n(e)||!_({event:r,minDate:u,maxDateInclusive:v,eventFilters:d,timeZone:s}))continue;const t=f.get(r.id);if(t)t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],(e=>(0,l().z)(e)));else if(r.cronSyncOriginalEventData){const e=r.cronSyncOriginalEventData.eventId,t=f.get(e);t&&(t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],l().z))}else f.append(r.id,{baseEvent:r,allSquashedEvents:[r]})}const p=new(r().A)((0,m().$D)(u,v,s).map((e=>({date:e,allDayEvents:[],timedEvents:[]}))),(e=>{let{date:t}=e;return t}));for(const{baseEvent:r,allSquashedEvents:i}of f.getOrderedValues())if(r.isAllDay){const e=(0,m().RY)({eventStartDate:r.start.date,eventEndDateInclusive:I(r.end.date,s),minDate:u,maxDateInclusive:v,timeZone:s});for(const t of e){const e=p.get(t);e&&e.allDayEvents.push({baseEvent:r,allSquashedEvents:i})}}else{const e=(0,m().J_)(r.start.dateTime,s),t=p.get(e);if(!t)continue;t.timedEvents.push({baseEvent:r,allSquashedEvents:i})}return p.getOrderedValues()}function _(e){let{event:t,minDate:n,maxDateInclusive:a,eventFilters:r,timeZone:o}=e;if(function(e){switch(e.responseStatus){case"declined":return!0;case"needsAction":case"tentative":case"accepted":case void 0:return!1;default:(0,c().HB)(e.responseStatus)}}(t))return!1;if(!(0,s().J)({event:t,eventFilters:r}))return!1;const{start:i,end:d}=function(e,t){return e.isAllDay?{start:e.start.date,end:I(e.end.date,t)}:{start:(0,m().J_)(e.start.dateTime,t),end:(0,m().J_)(e.end.dateTime,t)}}(t,o);return!(i>a||d<n)&&(0,s().J)({event:t,eventFilters:r})}function C(e){return[...e.allDayEvents,...e.timedEvents]}function w(e,t,n){return function(e,t){const n=e.isAllDay?e.end.date:e.end.dateTime;return a().c9.fromISO(n,{zone:t})}(e,n)<t}},185984:(e,t,n)=>{n.d(t,{E:()=>o,J:()=>i});var a=()=>n(765957);const r={all_day_events:!0,events_without_participants:!0,events_without_location:!0};function o(e){const{currentSpaceViewStore:t}=a().default.state;return(null==t?void 0:t.getHomeCalendarFilter(e))??r[e]}function i(e){let{event:t,eventFilters:n}=e;return(!1!==n.all_day_events||!t.isAllDay)&&(!(!1===n.events_without_participants&&!t.hasParticipants)&&!(!1===n.events_without_location&&!t.hasConferencingOrLocation))}},321032:(e,t,n)=>{n.d(t,{R:()=>r});var a=()=>n(449506);function r(e,t){a().callApi({eventName:"calendarTrack",environment:e,data:t})}},338931:(e,t,n)=>{n.d(t,{Gj:()=>d,RN:()=>v,_X:()=>f,vZ:()=>s,xy:()=>g});n(944114),n(898992),n(823215),n(354520),n(672577);var a=()=>n(244641),r=()=>n(861017),o=()=>n(179034),i=()=>n(780054),c=()=>n(148832);function d(e){const t=a().c9.fromMillis(e.startUnixTimestampMS),n=e.endUnixTimestampMS?a().c9.fromMillis(e.endUnixTimestampMS):void 0,r=a().c9.fromMillis(e.startOfWeekUnixTimestampMS),o=a().c9.fromMillis(e.endOfWeekUnixTimestampMS),i=t.startOf("day"),c=a().c9.max(r,i),d=Math.ceil(c.diff(r,"days").get("days"));let s=1;if(n){const e=n.endOf("day"),t=a().c9.min(o,e);s=Math.ceil(t.diff(c,"days").get("days"))}return{start:t,end:n,startOfWeek:r,endOfWeek:o,startColumn:d,columnCount:s}}function s(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const l={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15},u={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:5};function m(e){const{events:t,thresholds:n=l,filters:r}=e,o=t.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===o.length)return[];const{upcomingMinsThreshold:i,startingMinsThreshold:c,startedMinsThreshold:d}=n,s=[],u=[],m=[],v=[],f=[];for(const l of o){if(l.isAllDay)continue;const e=p(l),t=a().c9.now(),n=e.start.diff(t,"minutes").minutes;if(n>=0&&n<=i)s.push(l);else if(n<0){const a=-n;a>0&&a<=c?m.push(l):a>c&&a<=d?v.push(l):e.contains(t)&&u.push(l)}else f.push(l)}u.sort(((e,t)=>{const n=a().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone});return a().c9.fromISO(t.start.dateTime,{zone:t.start.timeZone}).diff(n).toMillis()}));return[...s,...m,...v,...null!=r&&r.excludeInProgressEvents?[]:u,...null!=r&&r.excludeUpcomingLaterEvents?[]:f]}function v(e){return m({events:e,thresholds:l,filters:void 0})[0]}function f(e){return m({events:e,thresholds:u,filters:{excludeUpcomingLaterEvents:!0}})[0]}function p(e){const t=a().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),n=a().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone});return a().IX.fromDateTimes(t,n)}function g(e){const{environment:t,currentSpaceStore:n}=e;let a=e.fileUrl;if(!n)return;const d=(0,r().parseRoute)({url:a,isMobile:t.device.isMobile,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,protocol:i().A.protocol,currentUrl:window.location.href}),s="page"===d.name?d.blockId:void 0;if(!s)return;const l=c().B.createChildStore(n,{table:o().ev,id:s});return l.load(),l}},377515:(e,t,n)=>{n.d(t,{AU:()=>s,GF:()=>c,NU:()=>u,Pj:()=>d,Xg:()=>v,cL:()=>l});n(944114),n(898992),n(430670),n(737550);var a=()=>n(496603),r=()=>n(534177),o=()=>n(379560),i=()=>n(812109);function c(e){const t=function(e){let{botId:t,currentSpaceViewStore:n}=e;const a=o().A.getCurrentCalendars()??[],r={};for(const o of a)r[(0,i().N)(o)]={calendarId:o.id,accountId:o.accountId,visible:d({spaceViewStore:n,botId:t,calendar:o})};return r}(e);return Object.values(t).flatMap((e=>{let{calendarId:t,accountId:n,visible:a}=e;return a?[{calendarId:t,accountId:n}]:[]}))}function d(e){let{spaceViewStore:t,botId:n,calendar:a}=e;return function(e){var t;let{spaceViewStore:n,botId:a,calendarId:r,accountId:o}=e;const i=null==n?void 0:n.getHomeCalendarVisibilityConfig(a);if(!i||v({spaceViewStore:n,botId:a}))return;return null===(t=i.calendarVisibility)||void 0===t||null===(t=t[o])||void 0===t?void 0:t[r]}({spaceViewStore:t,botId:n,calendarId:a.id,accountId:a.accountId})??a.selected}function s(e){let{spaceViewStore:t,botId:n,specificCalendars:a}=e;const o=t.getHomeCalendarVisibilityConfig(n);if(!o||!(0,r().O9)(null==o?void 0:o.calendarVisibility)||v({spaceViewStore:t,botId:n}))return{type:"mirrorWithCron"};const i=[];for(const[c,d]of(0,r().WP)(o.calendarVisibility??{}))for(const[e,t]of(0,r().WP)(d??{}))!(0,r().O9)(t)||a&&!a.some((t=>t.accountId===c&&t.calendarId===e))||i.push({accountId:c,calendarId:e,visible:t});return{type:"calendarOverrides",calendarOverrides:i}}function l(e){const t={};for(const{id:n,accountId:a,selected:r}of e)t[a]={...t[a],[n]:r};return t}function u(e){let{currentConfig:t,calendars:n}=e;const r=(0,a().mg)(t)??{};let o=!1;for(const{id:a,accountId:c,selected:d}of n){var i;void 0===(null===(i=r[c])||void 0===i?void 0:i[a])&&(r[c]={...r[c],[a]:d},o=!0)}return o?{result:"updated",newConfig:r}:{result:"noChanges"}}const m=!0;function v(e){let{spaceViewStore:t,botId:n}=e;if(!t||!n)return m;const a=t.getHomeCalendarVisibilityConfig(n);return(null==a?void 0:a.mirrorWithNotionCalendar)??m}},379560:(e,t,n)=>{n.d(t,{A:()=>i});n(898992),n(354520),n(581454);var a=()=>n(765957);class r extends(()=>n(757695))().Store{getInitialState(){return{}}getCalendarMap(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.calendars}getEvents(){var e;const t=null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.events;return t?t.getOrderedValues():[]}getCalendarAndAccountIds(){const e=this.getCalendarMap();return e?e.getOrderedValues().map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}})):[]}getStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;if(e)return this.state[e.id]}update(e){super.update(e)}updateStateForCurrentSpaceView(e){const{currentSpaceViewStore:t}=a().default.state;t&&this.update((n=>({...n,[t.id]:e(n[t.id])})))}clearStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;e&&this.update((t=>Object.fromEntries(Object.entries(t).filter((t=>{let[n]=t;return n!==e.id})))))}getCurrentCalendars(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.calendars)||void 0===e?void 0:e.getOrderedValues()}getAccount(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.accounts)||void 0===t?void 0:t.get(e)}getCalendar(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.get("string"==typeof e?e:`${e.accountId}:${e.calendarId}`)}getCalendarsForAccount(e){var t;return(null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.getOrderedValues().filter((t=>t.accountId===e)))??[]}getCurrentAccountIds(){var e;return(null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.accounts)||void 0===e?void 0:e.getOrderedValues().map((e=>e.id)))??[]}getCalendarFetchedTime(e){var t;const n="string"==typeof e?e:`${e.accountId}:${e.calendarId}`;return null===(t=this.getStateForCurrentSpaceView())||void 0===t?void 0:t.calendarsToLastFetchedTime[n]}}const o=new r;(0,n(604341).exposeDebugValue)("HomeCalendarStore",o);const i=o},465474:(e,t,n)=>{n.d(t,{A:()=>a});n(16280),n(944114),n(898992),n(354520),n(581454);class a{get length(){return this.orderedKeys.length}constructor(e,t){if(this.orderedKeys=void 0,this.keysToValues=void 0,!e&&!t)return this.orderedKeys=[],void(this.keysToValues={});if(!e||!t)throw new Error("Missing values or keyGetter in OrderedMap constructor");this.orderedKeys=e.map(t),this.keysToValues={};for(const n of e)this.keysToValues[t(n)]=n}append(e,t){let{keepOrdering:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keepOrdering:!1};if(e in this.keysToValues){if(this.keysToValues[e]=t,n)return;this.orderedKeys=[...this.orderedKeys.filter((t=>t!==e)),e]}else this.orderedKeys.push(e),this.keysToValues[e]=t}delete(e){this.orderedKeys=this.orderedKeys.filter((t=>t!==e)),delete this.keysToValues[e]}get(e){return this.keysToValues[e]}getOrderedValues(){return this.orderedKeys.map((e=>this.keysToValues[e]))}hasKey(e){return e in this.keysToValues}toJSON(){return this.orderedKeys.map((e=>[e,this.keysToValues[e]]))}static fromJSON(e){const t=new a;return t.orderedKeys=e.map((e=>{let[t]=e;return t})),t.keysToValues=Object.fromEntries(e),t}}},481887:(e,t,n)=>{n.d(t,{G7:()=>p,IU:()=>v,J3:()=>_,V0:()=>g,_w:()=>y,jr:()=>S,lv:()=>h,m3:()=>I,np:()=>f,qL:()=>w,rP:()=>b,sp:()=>m});n(898992),n(354520),n(581454);var a=()=>n(679924),r=()=>n(321032),o=()=>n(765957),i=()=>n(379560),c=()=>n(185984),d=()=>n(614016),s=()=>n(377515);function l(e){let{state:t,calendars:n,event_filters:a,mirror_calendars:r,time_range:o,bot_id:i,view:c}=e;return{state:t,calendars:n,event_filters:a&&{all_day_events:a.all_day_events,events_without_participants:a.events_without_participants,events_without_location:a.events_without_location},mirror_calendars:r,time_range:o,bot_id:i,view:c}}function u(e){let{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:c,num_days_in_future:d}=e;return{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:c,num_days_in_future:d}}function m(e){var t,n,a;const r=o().default.state.currentSpaceViewStore,l=null===(t=i().A.getStateForCurrentSpaceView())||void 0===t?void 0:t.botId;return{state:e.panelState,calendars:r&&l&&(null===(n=i().A.getCurrentCalendars())||void 0===n?void 0:n.map((e=>({type:e.provider,calendarId:e.id,accountId:e.accountId,isShown:(0,s().Pj)({spaceViewStore:r,botId:l,calendar:e})})))),mirror_calendars:(0,s().Xg)({botId:l,spaceViewStore:r}),event_filters:{all_day_events:(0,c().E)("all_day_events"),events_without_participants:(0,c().E)("events_without_participants"),events_without_location:(0,c().E)("events_without_location")},time_range:(null==r||null===(a=r.getHomeCalendarConfigStore())||void 0===a?void 0:a.getKeyStore("time_range").getValue())??d().C0,bot_id:l,view:e.view}}function v(e){var t;let{event:n,eventIndex:a,numDaysInFuture:r}=e;return{event_id:n.id,calendar_id:n.calendarId,account_id:n.accountId,is_all_day:n.isAllDay,has_participants:n.hasParticipants,conferencing_type:null===(t=n.conferencing)||void 0===t?void 0:t.providerName,index:a,num_days_in_future:r}}function f(e){let{environment:t,target:n,eventContext:o,calendarPanelContext:i}=e;(0,a().v)(t,"cal_event_click",{target:n,...l(i),...u(o)}),"conferencing"===n&&i.bot_id&&(0,r().R)(t,{botId:i.bot_id,payload:{type:"track",payload:{event:"joinMeeting",eventId:o.event_id,calendarId:o.calendar_id,conferencingProvider:o.conferencing_type,method:i.view}}})}function p(e){let{environment:t,eventContext:n,calendarPanelContext:o,attachmentType:i,notionBlockId:c,attachmentIndex:d}=e;(0,a().v)(t,"cal_event_click",{target:"attachment",attachment_type:i,attachment_index:d,notion_block_id:c,...l(o),...u(n)}),o.bot_id&&(0,r().R)(t,{botId:o.bot_id,payload:{type:"track",payload:{event:"eventAttachmentOpened",provider:i,location:o.view}}})}function g(e){const{environment:t,calendarPanelContext:n,notionAnalyticsSessionId:o}=e;(0,a().v)(t,"cal_create_event",{...l(n)}),n.bot_id&&(0,r().R)(t,{botId:n.bot_id,payload:{type:"track",payload:{event:"createEventButtonClicked",notionAnalyticsSessionId:o,method:n.view}}})}function h(e){(0,a().v)(e.environment,"cal_settings_menu",{action:e.action,...l(e.calendarPanelContext)})}function S(e){C({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:`toggle_${e.filter}`,value:e.newValue})}function y(e){C({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_calendar_bot",value:e.botId})}function I(e){C({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_mirroring",value:e.newValue})}function b(e){C({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_time_range",value:e.newValue})}function _(e){C({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_calendar_visibility",calendarId:e.calendarId,accountId:e.accountId,value:e.newValue})}function C(e){(0,a().v)(e.environment,"cal_configure_view",{...l(e.calendarPanelContext),action:e.action,value:e.value,..."calendarId"in e?{calendar_id:e.calendarId}:{},..."accountId"in e?{account_id:e.accountId}:{}})}function w(e){const{environment:t,calendarPanelContext:n}=e;(0,a().v)(t,"cal_loaded",{...l(n)}),"connected_with_events"!==n.state&&"connected_no_events"!==n.state||!n.bot_id||(0,r().R)(t,{botId:n.bot_id,payload:{type:"page",payload:{page:n.view,state:n.state}}})}},523239:(e,t,n)=>{n.d(t,{Hz:()=>X,rq:()=>R,w1:()=>N,k2:()=>F,F8:()=>J,qq:()=>P,Rv:()=>G,tD:()=>K,m5:()=>j,X6:()=>W,Kq:()=>q,X8:()=>L,vA:()=>z,NC:()=>B});n(898992),n(354520),n(672577),n(581454);var a=()=>n(244641),r=()=>n(584262),o=()=>n(465474),i=()=>n(496603),c=()=>n(534177),d=()=>n(449506),s=()=>n(901389),l=()=>n(246826),u=()=>n(755636),m=()=>n(281948),v=()=>n(436572),f=()=>n(751156),p=()=>n(338931),g=()=>n(767525),h=()=>n(972435),S=()=>n(583238),y=()=>n(406792),I=()=>n(765957),b=()=>n(217429),_=()=>n(185984),C=()=>n(90857),w=()=>n(658082),V=()=>n(812109);function A(e){let{oldMap:t,newMap:n,keyGetter:a}=e;const r=new(o().A)(t.getOrderedValues(),a);for(const o of(null==n?void 0:n.getOrderedValues())??[]){const e=a(o);r.append(e,o,{keepOrdering:!0})}return r}var M=()=>n(614016),T=()=>n(638681);const x=T().object({required:{botId:T().uuid(),timeMin:T().number(),timeMax:T().number(),accounts:T().array(T().tuple([T().string(),T().object({required:{},optional:{}})])),calendars:T().array(T().tuple([T().string(),T().object({required:{},optional:{}})])),events:T().array(T().tuple([T().string(),T().object({required:{},optional:{}})])),calendarsToLastFetchedTime:T().record(T().string(),T().number())},optional:{}});const O=new class{constructor(){this.localStorageStore=new(n(419494).Ay)({namespace:"homeCalendarCache",important:!1,trackingType:"preference",maxValueLength:512e3})}waitUntilReady(){return this.localStorageStore.waitUntilReady()}get(e){let t;try{if(t=this.localStorageStore.get(e),void 0===t)return}catch{}if(t&&null===x.validator(t))return function(e){return{...e,accounts:o().A.fromJSON(e.accounts),calendars:o().A.fromJSON(e.calendars),events:o().A.fromJSON(e.events),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(e.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,a().c9.fromMillis(n)]})))}}(t);this.localStorageStore.remove(e)}set(e,t){try{this.localStorageStore.set(e,(n=t,{...n,accounts:n.accounts.toJSON(),calendars:n.calendars.toJSON(),events:n.events.toJSON(),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(n.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,n.toMillis()]})))}))}catch{}var n}remove(e){this.localStorageStore.remove(e)}};var k=()=>n(481887),H=()=>n(377515);class D{constructor(e,t,n,a){this.pendingInvocations=new Map,this.fn=e,this.coalesce=t,this.waitMs=n,this.options=a}enqueue(e){for(const[n,a]of this.pendingInvocations){const t=this.coalesce(n,e);if(t)return this.pendingInvocations.delete(n),this.pendingInvocations.set(t,a),void a.dequeueDebounced(t)}const t=(0,i().sg)(this.dequeue.bind(this),this.waitMs,this.options);this.pendingInvocations.set(e,{dequeueDebounced:t}),t(e)}dequeue(e){this.pendingInvocations.delete(e),this.fn.apply(null,e)}}var E=()=>n(379560);function N(e){let{environment:t,timeRange:n,analyticsContext:a}=e;const{currentSpaceViewStore:r}=I().default.state;if(!r)return;const o=r.getHomeCalendarConfigStore().getKeyStore("time_range");f().createAndCommit({userAction:"homeCalendarActions.changeUpcomingEventsTimeRange",environment:t,canUndo:!0,perform:e=>{l().KY({transaction:e,store:o,value:n})}}),(0,k().rP)({environment:t,calendarPanelContext:(0,k().sp)(a),newValue:n})}function W(e){var t;let{environment:n,filter:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=I().default.state;if(!o)return;const i=null===(t=o.getHomeCalendarConfigStore())||void 0===t||null===(t=t.getKeyStore("event_filters"))||void 0===t?void 0:t.getKeyStore(a),c=!(0,_().E)(a);f().createAndCommit({userAction:"homeCalendarActions.toggleCalendarEventFilter",environment:n,canUndo:!0,perform:e=>{l().KY({transaction:e,store:i,value:c})}});const d=(0,k().sp)(r);(0,k().jr)({environment:n,calendarPanelContext:d,filter:a,newValue:c})}function R(e){let{environment:t,botId:n,shouldLog:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=I().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");if(i.getValue()!==n&&(0,S().pH)().find((e=>e.id===n))&&(f().createAndCommit({userAction:"homeCalendarActions.changeSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{l().KY({transaction:e,store:i,value:n})}}),a)){const e=(0,k().sp)(r);(0,k()._w)({environment:t,botId:n,calendarPanelContext:e})}}function F(e){let{environment:t}=e;const{currentSpaceViewStore:n}=I().default.state;if(!n)return;const a=n.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");a.getValue()&&f().createAndCommit({userAction:"homeCalendarActions.clearSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{l().KY({transaction:e,store:a,value:void 0})}})}async function P(e){let{environment:t,currentSpaceViewStore:n,botId:r,timeRange:o,calendarAndAccountIds:s,forceRefetch:u,updateMethod:m,reason:v}=e;if(!n||!n.isReady()||!n.canRead())return"failure";const p=b().default.checkGate({gateName:"calendar_home_tile_caching"});if(!u){var h;let e=E().A.getStateForCurrentSpaceView();if(!e&&p&&(await O.waitUntilReady(),e=function(e){let{timeMin:t,botId:n}=e;const{currentSpaceViewStore:r}=I().default.state;if(!r)return;let o=O.get(r.id);if(o){const e=o.botId===n,i=t>=o.timeMin&&a().c9.fromMillis(t).plus({days:$}).toMillis()<=o.timeMax;e&&i?(o=Z({state:o}).newState,E().A.updateStateForCurrentSpaceView((()=>o))):(O.remove(r.id),o=void 0)}return o}({timeMin:o.timeMin,botId:r})),(null===(h=e)||void 0===h?void 0:h.botId)===r)if(s){if((0,w().zn)(s))return"skipped"}else if((0,w().zn)((0,H().GF)({botId:r,currentSpaceViewStore:n})))return"skipped"}const S=(0,H().AU)({spaceViewStore:n,botId:r,specificCalendars:s}),_=y().default.DO_NOT_USE_markLegacy("home.calendar.get_calendar_events_all"),M=await d().callApi({eventName:"getCalendarEvents",environment:t,data:{botId:r,timeMin:o.timeMin,timeMax:o.timeMax,orderBy:"startTime",calendars:s,calendarVisibilityOverrides:"mirrorWithCron"===S.type?void 0:S.calendarOverrides,userTimeZone:(0,g().s1)().timeZone,reason:Array.isArray(v)?(0,i().sb)(v).sort().join(","):v}});if("success"!==M.type)return"failure";s||y().default.DO_NOT_USE_measureLegacy(_,{environment:t});const{accounts:T,calendars:x,events:k}=M.data,D=(0,w().MP)({calendarApiResponse:x,specificCalendarsFetched:s,calendarVisibilityOverrides:S});return E().A.updateStateForCurrentSpaceView((e=>{let t;switch(m){case void 0:case"merge":t=e;break;case"replace":t=void 0;break;default:(0,c().ub)(m)}const i=function(e){let{oldState:t,newState:n,updatedCalendars:a,fetchTime:r}=e;const o=!t||n.botId!==t.botId,i=(0,w().tQ)({calendarsThatWereUpdated:a.map(V().N),oldCalendarFetchedTimes:o||null==t?void 0:t.calendarsToLastFetchedTime,fetchTime:r});if(!t||o)return{...n,calendarsToLastFetchedTime:i};const d={...t,calendarsToLastFetchedTime:i};for(const s of(0,c().WP)(n))switch(s[0]){case"accounts":d.accounts=A({oldMap:t.accounts,newMap:n.accounts,keyGetter:e=>{let{id:t}=e;return t}});break;case"events":d.events=(0,C().$z)({events:t.events,calendars:t.calendars,updatedCalendarAndAccountIds:a,newEvents:n.events.getOrderedValues()});break;case"botId":d.botId=n.botId;break;case"timeMin":d.timeMin=Math.max(t.timeMin,n.timeMin);break;case"timeMax":d.timeMax=Math.min(t.timeMax,n.timeMax);break;case"calendars":d.calendars=A({oldMap:t.calendars,newMap:n.calendars,keyGetter:V().N});break;default:(0,c().ub)(s[0])}return d}({oldState:t,newState:(0,C().IC)({botId:r,accounts:T,calendars:x,events:k,timeMin:o.timeMin,timeMax:o.timeMax}),updatedCalendars:D,fetchTime:a().c9.now()});return p&&O.set(n.id,i),i})),function(e){let{environment:t,spaceViewStore:n,botId:a,calendarResponse:r}=e;const o=n.getHomeCalendarVisibilityConfig(a);if((0,H().Xg)({spaceViewStore:n,botId:a}))return;const i=(0,H().NU)({currentConfig:null==o?void 0:o.calendarVisibility,calendars:r});if("noChanges"===i.result)return;f().createAndCommit({userAction:"homeCalendarActions.populateCalendarConfigWithCalendarResponse",environment:t,canUndo:!0,perform:e=>{l().KY({transaction:e,store:n.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(a).getKeyStore("calendarVisibility"),value:i.newConfig})}})}({environment:t,spaceViewStore:n,botId:r,calendarResponse:x}),"success"}const U=(0,i().sg)(P,1e3,{leading:!1,trailing:!0});const K=function(e,t,n,a){const r=new D(e,t,n,a);return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.enqueue(t)}}(P,(function(e,t){let n,[a]=e,[r]=t;if(a.environment!==r.environment||a.currentSpaceViewStore!==r.currentSpaceViewStore||a.botId!==r.botId||a.timeRange.key!==r.timeRange.key)return!1;const o={environment:a.environment,currentSpaceViewStore:a.currentSpaceViewStore,botId:a.botId,timeRange:{key:a.timeRange.key,timeMin:Math.max(a.timeRange.timeMin,r.timeRange.timeMin),timeMax:Math.max(a.timeRange.timeMax,r.timeRange.timeMax)},reason:(0,i().Bq)([a.reason,r.reason]),forceRefetch:a.forceRefetch||r.forceRefetch};return n=a.calendarAndAccountIds&&r.calendarAndAccountIds?{...o,calendarAndAccountIds:(0,i().hS)([...a.calendarAndAccountIds,...r.calendarAndAccountIds],V().N)}:{...o,updateMethod:"replace"===a.updateMethod||"replace"===r.updateMethod?"replace":"merge"},[n]}),2e3+2e3*Math.random(),{maxWait:5e3});function q(e){let{environment:t,botId:n,mirrorWithNotionCalendar:a,analyticsContext:r}=e;const{currentSpaceViewStore:o}=I().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(n);f().createAndCommit({userAction:"homeCalendarActions.toggleCalendarMirroring",environment:t,canUndo:!0,perform:e=>{const t=a?void 0:(0,H().cL)(E().A.getCurrentCalendars()??[]);l().KY({transaction:e,store:i,value:{mirrorWithNotionCalendar:a,calendarVisibility:t}})}});const c=(0,k().sp)(r),d=a;(0,k().m3)({environment:t,calendarPanelContext:c,newValue:d}),U({environment:t,currentSpaceViewStore:o,botId:n,timeRange:(0,M().M)(),forceRefetch:!1,reason:"toggle_mirroring"})}function z(e){let{environment:t,botId:n,calendarId:a,accountId:r,newIsVisible:o,analyticsContext:i}=e;const{currentSpaceViewStore:c}=I().default.state;if(!c)return;const d=c.getCalendarVisibilityStore({botId:n,calendarId:a,accountId:r});f().createAndCommit({userAction:"homeCalendarActions.toggleCalendarVisibility",environment:t,canUndo:!0,perform:e=>{l().KY({transaction:e,store:d,value:o})}}),(0,k().J3)({environment:t,calendarPanelContext:(0,k().sp)(i),calendarId:a,accountId:r,newValue:o}),U({environment:t,currentSpaceViewStore:c,botId:n,timeRange:(0,M().M)(),calendarAndAccountIds:[{calendarId:a,accountId:r}],forceRefetch:!1,reason:"toggle_calendar_visibility"})}function L(e){var t;let{environment:n,botId:a,calendarId:r,accountId:o,newIsVisible:c}=e;const{currentSpaceViewStore:d}=I().default.state;if(!d)return;const s=E().A.getCalendar({calendarId:r,accountId:o});if(!s||s.selected===c)return;E().A.updateStateForCurrentSpaceView((e=>{if(!e)return;const t=(0,i().mg)(e),n=t.calendars.get((0,V().N)({accountId:o,calendarId:r}));if(!n||n.selected===c)return e;n.selected=c;return b().default.checkGate({gateName:"calendar_home_tile_caching"})&&O.set(d.id,t),t}));((null===(t=d.getHomeCalendarVisibilityConfig(a))||void 0===t?void 0:t.mirrorWithNotionCalendar)??!1)&&c&&K({currentSpaceViewStore:d,environment:n,botId:a,timeRange:(0,M().M)(),calendarAndAccountIds:[{calendarId:r,accountId:o}],forceRefetch:!1,reason:"calendar_visibility_change"})}function Z(e){let{now:t=a().c9.now(),state:n}=e;const{events:r}=n,{timeZone:i}=(0,g().s1)(),c=new(o().A)(r.getOrderedValues().filter((e=>!(0,C().FC)(e,t,i))),V().z);return c.length===r.length?{didChange:!1,newState:n}:{didChange:!0,newState:{...n,timeMin:t.toMillis(),events:c}}}function j(e){let{now:t=a().c9.now(),currentSpaceViewStore:n}=e;if(!n)return;const r=E().A.getStateForCurrentSpaceView();if(!r)return;const{didChange:o,newState:i}=Z({now:t,state:r});if(o){E().A.updateStateForCurrentSpaceView((()=>i));b().default.checkGate({gateName:"calendar_home_tile_caching"})&&O.set(n.id,i)}}const $=1;function J(){const{currentSpaceViewStore:e}=I().default.state;e&&(E().A.clearStateForCurrentSpaceView(),O.remove(e.id))}async function B(e){const{environment:t,botId:n,event:a,meetingNote:r,from:o}=e,i=a.isAllDay?{uid:a.uid,title:a.summary??"",attendees:(a.attendees??[]).map((e=>({email:e.email??"",self:e.self}))),isAllDay:!0,start:{date:a.start.date},end:{date:a.end.date}}:{uid:a.uid,title:a.summary??"",attendees:(a.attendees??[]).map((e=>({email:e.email??"",self:e.self}))),isAllDay:!1,start:{dateTime:a.start.dateTime,timeZone:a.start.timeZone},end:{dateTime:a.end.dateTime,timeZone:a.end.timeZone}};return await d().callApi({eventName:"upsertCalendarMeetingNote",environment:t,data:{botId:n,from:o,platform:t.device.platform,event:i,location:null==r?void 0:r.location,share:Boolean(null==r?void 0:r.share)}})}async function G(e){const{environment:t,currentSpaceStore:n,meetingNoteUrl:a,openInNew:o}=e,i=(0,p().xy)({environment:t,currentSpaceStore:n,fileUrl:a});i&&!i.isReady()&&await i.waitUntil((()=>i.isReady())),null!=i&&i.isReady()?m().VU({environment:t,openInNew:o,store:i,pageVisitSource:r().y8.PersonalHomeCalendarAttachment,peekMode:"center_peek",resultsStore:void 0,collectionContextStore:void 0}):u().f({environment:t,url:a})}function Y(e){const{event:t,meetingNote:n}=e;E().A.updateStateForCurrentSpaceView((e=>{if(!e)return;const a=(0,i().mg)(e),r=a.events.get((0,V().z)({accountId:t.accountId,calendarId:t.calendarId,id:t.id}));return r&&(r.meetingNote=n),a}))}async function X(e){const{environment:t,botId:n,event:a,data:r,currentSpaceStore:o}=e;r.location&&Y({event:a,meetingNote:{eventUid:a.uid,workspaceId:o.getSpaceId(),location:r.location,share:r.share}}),v().D6({label:h().A.getIntl().formatMessage({id:"homeCalendarActions.meetingNoteAdded",defaultMessage:"Added AI Meeting Note"})});const i=await d().callApi({eventName:"addEventMeetingNote",environment:t,data:{botId:n,...r}});return"failed"===i.type&&(Y({event:a,meetingNote:void 0}),s().Qg(i)),i}},569243:(e,t,n)=>{n.d(t,{Pf:()=>s,QL:()=>c,Sk:()=>d});var a=()=>n(534177);const r={1:e=>e.calendarHomeWidget.base.orange,2:e=>e.calendarHomeWidget.base.red,3:e=>e.calendarHomeWidget.base.red,4:e=>e.calendarHomeWidget.base.orange,5:e=>e.calendarHomeWidget.base.orange,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.green,8:e=>e.calendarHomeWidget.base.green,9:e=>e.calendarHomeWidget.base.green,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.yellow,12:e=>e.calendarHomeWidget.base.yellow,13:e=>e.calendarHomeWidget.base.green,14:e=>e.calendarHomeWidget.base.blue,15:e=>e.calendarHomeWidget.base.blue,16:e=>e.calendarHomeWidget.base.blue,17:e=>e.calendarHomeWidget.base.purple,18:e=>e.calendarHomeWidget.base.purple,19:e=>e.calendarHomeWidget.base.gray,20:e=>e.calendarHomeWidget.base.gray,21:e=>e.calendarHomeWidget.base.pink,22:e=>e.calendarHomeWidget.base.pink,23:e=>e.calendarHomeWidget.base.purple,24:e=>e.calendarHomeWidget.base.purple},o={1:e=>e.calendarHomeWidget.base.purple,2:e=>e.calendarHomeWidget.base.green,3:e=>e.calendarHomeWidget.base.pink,4:e=>e.calendarHomeWidget.base.red,5:e=>e.calendarHomeWidget.base.yellow,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.blue,8:e=>e.calendarHomeWidget.base.gray,9:e=>e.calendarHomeWidget.base.blue,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.red};function i(e){let{theme:t,color:n}=e;if("preset"===n.type){var i,c;if("calendar"===n.colorType)return null===(i=r[n.colorId])||void 0===i?void 0:i.call(r,t);if("event"===n.colorType)return null===(c=o[n.colorId])||void 0===c?void 0:c.call(o,t);(0,a().ub)(n)}var d;if("custom"===n.type)return null===(d=n.colorHexes)||void 0===d?void 0:d[t.mode].backgroundPrimary;(0,a().ub)(n)}function c(e){let{theme:t,calendarColor:n}=e;const a=n&&i({theme:t,color:n});return a||t.calendarHomeWidget.base.blue}function d(e){let{theme:t,eventColor:n,calendarColor:a}=e;const r=n&&i({theme:t,color:n});return r||c({theme:t,calendarColor:a})}function s(e){const{colorType:t,color:n,colorId:a}=e;return a?{type:"preset",colorId:a,colorType:t}:n?{type:"custom",colorHexes:n}:void 0}},614016:(e,t,n)=>{n.d(t,{B7:()=>l,C0:()=>c,M:()=>s,P8:()=>u,_I:()=>m,iI:()=>d});var a=()=>n(392998),r=()=>n(894074),o=()=>n(534177),i=()=>n(765957);const c="three_days";function d(){const e=m();return{key:e,...l(e)}}function s(){const e="one_week";return{key:e,...l(e)}}function l(e){const t=Date.now();return{timeMin:t,timeMax:(0,a().A)((0,r().A)(t,{hours:23,minutes:59,seconds:59,milliseconds:999}),u(e)-1).getTime()}}function u(e){switch(e){case"one_day":return 1;case"two_days":return 2;case"three_days":return 3;case"one_week":return 7;default:(0,o().HB)(e)}}function m(){var e;const t=null===(e=i().default.state.currentSpaceViewStore)||void 0===e||null===(e=e.getHomeCalendarConfigStore())||void 0===e||null===(e=e.getKeyStore("time_range"))||void 0===e?void 0:e.getValue();switch(t){case"one_day":case"two_days":case"three_days":case"one_week":return t;case void 0:return c;default:return(0,o().ub)(t),c}}},658082:(e,t,n)=>{n.d(t,{MP:()=>d,oM:()=>l,tQ:()=>s,zn:()=>c});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(581454);var a=()=>n(496603),r=()=>n(534177),o=()=>n(379560),i=()=>n(812109);function c(e){return e.every((e=>{let{calendarId:t,accountId:n}=e;return o().A.getCalendarFetchedTime({calendarId:t,accountId:n})}))}function d(e){let{specificCalendarsFetched:t,calendarVisibilityOverrides:n,calendarApiResponse:o}=e;const c=new Set((t??[]).map(i().N)),d="calendarOverrides"===n.type?n.calendarOverrides:[],s=(0,a().pY)(d,i().N);return o.filter((e=>{const n=(0,i().N)(e);if(void 0!==t)return c.has(n);const a=s[n];return(0,r().O9)(a)?a.visible:e.selected})).map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}}))}function s(e){let{calendarsThatWereUpdated:t,oldCalendarFetchedTimes:n,fetchTime:a}=e;const r={...n};for(const o of t)(!r[o]||r[o]<a)&&(r[o]=a);return r}function l(e){switch(e){case"events":return"connected_with_events";case"noEvents":return"connected_no_events";case"signedOut":return"disconnected";case"disconnectedAccount":case"missingScopes":return"connected_permissions_error";case"loadError":return"load_error";case"loading":return;default:return void(0,r().ub)(e)}}},812109:(e,t,n)=>{function a(e){return"string"==typeof e?e:"calendarId"in e?`${e.accountId}:${e.calendarId}`:`${e.accountId}:${e.id}`}function r(e){let{id:t,accountId:n,calendarId:a}=e;return`${n}:${a}:${t}`}n.d(t,{N:()=>a,z:()=>r})},823115:(e,t,n)=>{n.d(t,{$D:()=>o,J_:()=>c,RY:()=>r,V$:()=>i,cK:()=>d,qi:()=>s});n(16280),n(944114),n(581454);var a=()=>n(244641);function r(e){let{eventStartDate:t,eventEndDateInclusive:n,minDate:a,maxDateInclusive:r,timeZone:i}=e;const d=function(e){let{startAndEndDaysRange:t,minAndMaxDaysRange:n}=e;if(t.end<n.min)return;if(t.start>n.max)return;const{start:a,end:r}=t,{min:o,max:i}=n,c=a<o?o:a,d=r>i?i:r;return{start:c,end:d}}({startAndEndDaysRange:{start:c(t,i),end:c(n,i)},minAndMaxDaysRange:{min:c(a,i),max:c(r,i)}});if(!d)return[];const{start:s,end:l}=d;return o(s,l,i)}function o(e,t,n){const a=c(t,n);let r=c(e,n);const o=[];for(;r<=a;)o.push(r),r=i(r,n).plus({days:1}).toISODate();return o}function i(e,t){const[n,r,o]=c(e,t).split("-").map(Number);return a().c9.fromObject({year:n,month:r,day:o},{zone:t})}function c(e,t){const n=a().c9.fromISO(e,{zone:t});if(!n.isValid)throw new Error(`Invalid date string: ${e}`);return e.includes("T")?n.toISODate():e}function d(e,t){const n="en-US";return a().c9.fromISO(e,{zone:"UTC"}).setLocale(n).toLocaleString(a().c9.DATE_SHORT)===t.setLocale(n).toLocaleString(a().c9.DATE_SHORT)}function s(e,t,n){const a=i(e,n);return i(t,n).diff(a,"days").days}}}]);