"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[70193],{28834:(e,t,o)=>{o.d(t,{Nr:()=>u,Q:()=>l});o(16280),o(944114),o(816573),o(878100),o(177936),o(748140),o(821903),o(491134),o(128845),o(237467),o(444732),o(979577),o(898992),o(823215),o(672577),o(430670),o(803949),o(581454);class i{constructor(e,t){this._inputSampleRate=void 0,this._outputSampleRate=void 0,this._inputSampleRate=e,this._outputSampleRate=t}downsample(e){return this.downSampleAudioFrame(e,this._inputSampleRate,this._outputSampleRate)}downSampleAudioFrame(e,t,o){if(o===t||o>t)return e;const i=t/o,n=Math.round(e.length/i),r=new Float32Array(n);let s=0,a=0;for(;a<n;){const t=Math.round((a+1)*i);let o=0,n=0;for(;s<t&&s<e.length;)o+=e[s++],n++;r[a++]=o/n}return r}}var n=()=>o(857639),r=()=>o(502800),s=()=>o(909557),a=()=>o(673903),c=()=>o(426175),d=()=>o(524007);o(814603),o(147566),o(198721);const l="ms_change";class u{constructor(e){this._mediaStreams=void 0,this._emitter=void 0,this.recorder=void 0,this.onDataReceived=void 0,this.onStop=void 0,this.environment=void 0,this.startController=void 0,this.saveAudioFiles=void 0,this.audioBuffer=[],this.currentStreamId=null,this.sampleRate=void 0,this.blockId=void 0,this.includeSystemAudio=void 0,this.handleDeviceChange=async()=>{var e;const t=null===(e=this.mediaStreams)||void 0===e||null===(e=e.flatMap((e=>e.getAudioTracks())))||void 0===e||null===(e=e.map((e=>e.getSettings())))||void 0===e?void 0:e.find((e=>void 0!==e)),i=this.getPreferredOrDefaultDevice();if(!t||i&&(i.deviceId!==t.deviceId||i.groupId!==t.groupId)){this.stop({triggerOnStop:!1,triggerFlushToOPFS:!0});try{await this.start()}catch(n){this.destroy((0,o(319625).A)(n))}}},this._emitter=(0,o(827380).A)(),this.recorder=new p,this.onDataReceived=e.onDataReceived,this.onStop=e.onStop,this.includeSystemAudio=e.includeSystemAudio,this.environment=e.environment,this.saveAudioFiles=e.saveAudioFiles??!1,this.sampleRate=e.sampleRate??16e3,this.blockId=e.blockId}get emitter(){return this._emitter}set mediaStreams(e){if(this._mediaStreams)for(const o of this._mediaStreams)for(const e of o.getTracks())e.stop();for(const i of e??[])for(const e of i.getTracks())e.addEventListener("ended",(async()=>{if(i.getTracks().every((e=>"ended"===e.readyState))){"denied"===(await o(927648).Ay.checkPermissions(this.includeSystemAudio)).audio&&this.stop({triggerOnStop:!0,error:new(s().d1)("Audio permission denied")})}}));for(const i of e??[]){var t;const e=null==i||null===(t=i.getAudioTracks()[0])||void 0===t?void 0:t.getSettings();o(964576).A.setState(c().X8.state.find((t=>t.deviceId===(null==e?void 0:e.deviceId))))}this._mediaStreams=e,this._emitter.emit(l)}get mediaStreams(){return this._mediaStreams}getPreferredOrDefaultDevice(){var e;return(null===(e=c().X8.state)||void 0===e?void 0:e.find((e=>{var t;return e.deviceId===(null===(t=d().d.state)||void 0===t?void 0:t.deviceId)})))??c().X8.state[0]}async start(){if(void 0===this.startController||this.startController.signal.aborted){this.startController=new AbortController;const t=this.startController.signal;if(null===this.currentStreamId){this.currentStreamId=(0,o(206267).JW)().slice(-4);try{u.meetingNotesCache&&await u.meetingNotesCache.trimCache(9)}catch(e){n().log({level:"error",from:"audioRecorderHelpers",type:"trimCacheError",error:(0,r().convertErrorToLog)(e)})}}this.audioBuffer=[];const i=this.getPreferredOrDefaultDevice(),l=(0,a().E)(),p=await l.getUserMedia({audio:{deviceId:i?{exact:i.deviceId}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1}});if(await c().Ay.updateMediaDevices(),this.includeSystemAudio){n().log({level:"info",from:"audioRecorderHelpers",type:"getDisplayMediaAttempt",data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio}}});try{const e=await l.getDisplayMedia({audio:!0,systemAudio:this.includeSystemAudio?"include":void 0});this.mediaStreams=[p,e]}catch(e){if(n().log({level:"error",from:"audioRecorderHelpers",type:"getDisplayMediaFailed",error:(0,r().convertErrorToLog)(e),data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio}}}),e instanceof Error&&"NotReadableError"===e.name)throw new(s().$W);throw new(s().Yh)}}else this.mediaStreams=[p];if(t.aborted){for(const e of this.mediaStreams??[])for(const t of e.getTracks())t.stop();return}if(await this.recorder.record(this.mediaStreams??[],(e=>{t.aborted||(this.saveAudioFiles&&(this.audioBuffer.push(...e),this.maybeWriteAudioBufferToOPFS({forceWrite:!1})),this.onDataReceived(e))}),this.sampleRate),t.aborted)return this.recorder.releaseMediaResources(),void(this.mediaStreams=void 0);d().d.addListener(this.handleDeviceChange),c().X8.addListener(this.handleDeviceChange)}}maybeWriteAudioBufferToOPFS(e){var t;const i=10*this.sampleRate;this.saveAudioFiles&&(e.forceWrite||this.audioBuffer.length>i)&&u.meetingNotesCache&&null!==(t=this.environment.currentUser)&&void 0!==t&&t.id&&this.blockId&&this.currentStreamId&&(u.meetingNotesCache.write((0,o(631616).NL)({userId:this.environment.currentUser.id,blockId:this.blockId,recordingId:this.currentStreamId,fileType:"PCM_F32_16000_MONO"}),new Float32Array(this.audioBuffer).buffer).catch((e=>{n().log({level:"error",from:"audioRecorderHelpers",type:"writeToOPFSFailed",error:(0,r().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:this.blockId}}})})),this.audioBuffer=[])}stop(e){const{error:t,triggerOnStop:o=!0,triggerFlushToOPFS:i=!1}=e||{};if(void 0!==this.startController&&!this.startController.signal.aborted){var n;if(this.startController.abort(),this.recorder.releaseMediaResources(),this.mediaStreams=void 0,(o||i)&&this.maybeWriteAudioBufferToOPFS({forceWrite:!0}),o)this.currentStreamId=null,null===(n=this.onStop)||void 0===n||n.call(this,t);d().d.removeListener(this.handleDeviceChange),c().X8.removeListener(this.handleDeviceChange)}}destroy(e){d().d.removeListener(this.handleDeviceChange),c().X8.removeListener(this.handleDeviceChange),this.stop({triggerOnStop:!0,error:e})}}u.meetingNotesCache=(0,o(870991).bB)();class p{constructor(){this._audioWorkletNode=void 0,this._sourceNodes=void 0,this._audioContext=void 0}set sourceNodes(e){this._sourceNodes&&this._sourceNodes.forEach((e=>e.disconnect())),this._sourceNodes=e}set audioWorkletNode(e){this._audioWorkletNode&&this._audioWorkletNode.disconnect(),this._audioWorkletNode=e}set audioContext(e){this._audioContext&&this._audioContext.close(),this._audioContext=e}get audioContext(){return this._audioContext}async record(e,t,n){if(this.releaseMediaResources(),this.audioContext=(0,a().G)(n),Boolean(this.audioContext.audioWorklet))try{const r=new i(this.audioContext.sampleRate,n),s=this.audioContext,a=e.map((e=>s.createMediaStreamSource(e)));await this.audioContext.audioWorklet.addModule(new URL(o(986850),o.b));const c=new AudioWorkletNode(this.audioContext,"pcm-processor");c.port.onmessage=e=>{if(e.data){const o=e.data,i=r.downsample(o);t(i)}},a.forEach((e=>e.connect(c))),this._audioWorkletNode=c,this._sourceNodes=a}catch{console.info("unable to create worklet"),this.releaseMediaResources()}else this.releaseMediaResources()}releaseMediaResources(){this.sourceNodes=void 0,this.audioWorkletNode=void 0,this.audioContext=void 0}}},74e3:(e,t,o)=>{o.d(t,{$q:()=>r,u1:()=>n});var i=()=>o(805952);function n(){return Object.entries(i().Cu)}function r(e){return i().Cu[e][1]}},99874:(e,t,o)=>{o.r(t),o.d(t,{createClient:()=>c,generateNewClientSessionId:()=>s,getCurrentClientSessionId:()=>a});o(814603),o(147566),o(198721);var i=()=>o(206267),n=()=>o(780054);let r=i().JW();function s(){r=i().JW()}function a(){return r}function c(e){let t=n().A.audioProcessor.url;const{maxReconnectDelayMs:i,minReconnectDelayMs:s,jwtToken:a}=e,c=new URLSearchParams({sessionId:r});a&&c.set("token",a);const d=`${t}?${c.toString()}`;return new(o(502681))(d,{reconnect:{max:i,min:s,"reconnect timeout":2500,retries:1e20},timeout:2500,credentials:!0,transport:{withCredentials:!0},transportOverrides:{transports:["websocket"]}})}},135428:(e,t,o)=>{o.d(t,{Vj:()=>a,ax:()=>c});o(898992),o(354520),o(581454),o(737550);var i=()=>o(244641),n=()=>o(604995);const r="–",s=" ";function a(e){let{start:t,end:o,locale:n,timeZone:a}=e;const d=i().c9.fromISO(t),l=i().c9.fromISO(o),u=function(e){let{start:t,end:o}=e;const i=o.diff(t);if(i.as("hours")>12)return!0;const n=t.hour<12,r=o.hour<12;return n!==r}({start:d,end:l}),p=c({time:d,showAmPm:u,locale:n,timeZone:a}),m=c({time:l,showAmPm:!0,locale:n,timeZone:a});return`${p}${s}${r}${s}${m}`}function c(e){let{time:t,showAmPm:o,locale:r,timeZone:a}=e;const c=function(e){return i().c9.fromObject({hour:13}).setLocale(e).toLocaleParts(i().c9.TIME_SIMPLE).some((e=>"dayPeriod"===e.type))}(r),d=0!==t.minute||!c,l={...i().c9.TIME_SIMPLE,hour:"numeric",minute:d?"2-digit":void 0,timeZone:(0,n().lW)(a)};return c&&!o?t.setLocale(r).toLocaleParts(l).filter((e=>"dayPeriod"!==e.type)).map((e=>e.value.trim())).join(""):t.toLocaleString({...l,hour12:c},{locale:r}).replace(" ",s)}},233124:(e,t,o)=>{o.d(t,{D_:()=>s,E_:()=>r,Im:()=>a,K_:()=>d,rP:()=>c,uB:()=>n});var i=()=>o(679924);function n(e,t){e&&(0,i().v)(e,"dictation_modal_open",t)}function r(e,t){e&&(0,i().v)(e,"dictation_modal_close",t)}function s(e,t){e&&(0,i().v)(e,"dictation_start",t)}function a(e,t){e&&(0,i().v)(e,"dictation_end",t)}function c(e,t){e&&(0,i().v)(e,"dictation_error",t)}function d(e,t){e&&(0,i().v)(e,"update_dictation_language",t)}},262089:(e,t,o)=>{o.d(t,{zz:()=>T,YE:()=>C,ZQ:()=>M,bH:()=>x,Ux:()=>w,gA:()=>B,L6:()=>I,$I:()=>D,Ep:()=>fe,Ez:()=>ne,UC:()=>ae,$g:()=>le,rJ:()=>ue,lW:()=>ce});o(16280);var i=()=>o(857639),n=()=>o(206267),r=()=>o(220719),s=()=>o(502800),a=()=>o(763824),c=()=>o(720665),d=()=>o(671593),l=()=>o(780054),u=()=>o(870193),p=()=>o(909557),m=()=>o(165121),g=()=>o(765957),f=()=>o(217429);const v=!1;var h=()=>o(908006),y=()=>o(679924);function S(e,t){h().default.afterNextFlush((()=>{f().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&(0,y().v)(e,"audio_processor.client.send_request",t)}))}var b=()=>o(99874),k=()=>o(638681);const A=k().union([k().object({required:{audioDuration:k().number(),id:k().string(),status:k().literal("complete"),text:k().string()},optional:{}}),k().object({required:{audioDuration:k().number(),id:k().string(),reason:k().string(),status:k().literal("error")},optional:{}}),k().object({required:{audioDuration:k().number(),id:k().string(),status:k().literal("ignore")},optional:{}}),k().object({required:{audioDuration:k().number(),id:k().string(),status:k().literal("pending")},optional:{}})]),_=k().union([k().object({required:{message:k().string(),name:k().literal("ForbiddenError"),status:k().literal(403),type:k().literal("forbidden")},optional:{}}),k().object({required:{currentS:k().number(),limitS:k().number(),type:k().literal("free_trial_limit_update")},optional:{}}),k().object({required:{message:k().string(),type:k().literal("openai_error")},optional:{status:k().number()}}),k().object({required:{requestId:k().string(),result:k().unknown(),status:k().literals("error","ok"),type:k().literal("response")},optional:{}}),k().object({required:{audioSessionId:k().string(),isAudioSessionComplete:k().boolean(),isSegmentComplete:k().boolean(),segmentId:k().string(),transcription:k().lazy((()=>A)),type:k().literal("transcription")},optional:{}}),k().object({required:{message:k().string(),name:k().literal("UpgradeRequiredError"),status:k().literal(403),type:k().literal("upgrade_required")},optional:{}}),k().object({required:{message:k().string(),name:k().literal("UserRateLimitResponse"),retryAfterSec:k().union([k().isUndefined(),k().number()]),status:k().literal(429),type:k().literal("rate_limited")},optional:{}}),k().object({required:{talking:k().boolean(),type:k().literal("vad")},optional:{}})]),w="transcription",I="vad",x="rate_limited",T="forbidden",M="openai_error",B="upgrade_required",C="free_trial_info",D=(0,o(827380).A)(),R=async()=>Promise.all([o.e(2681),o.e(36733)]).then(o.bind(o,99874)),E=!1,j=90*c().TD;function P(e){return{_id:e,charactersSent:0,requestsSent:0,requestsTimedOut:0,responsesReceivedWithoutHandlers:0,successfulResponsesReceived:0,unsuccessfulResponsesReceived:0,invalidMessagesReceived:0,notificationsReceived:0,messagesReceived:0}}const N=new(o(999752).O)(20),F=new Map,q=(Date.now(),"audioProcessorInternals"),L=new(i().BatchedLogger)({from:q,team:"no-team-specified",type:"BulkDebug",level:"info",maxLength:250,logToConsole:E});let O,W=0,U=0,$=0,z=0,H=P(0),K=null,Y=null,V=null,X=0,G=o(882362).u,Q=!1,J="uninitialized";const Z=!0;function ee(e){L.log({level:"info",team:"editor",from:q,type:e})}function te(){O=function(e){var t;const o=null==e||null===(t=e.socket)||void 0===t||null===(t=t.transport)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.transport;if("websocket"===o||"polling"===o)return o}(this),ee(`ping:${O}`),K=Date.now(),he(`Incoming primus ping received from server via ${O}.`)}function oe(){return{...N.getStats()}}function ie(e){switch(L.log({level:"info",team:"editor",from:q,type:"readyStateChange",data:{message:e}}),V=Date.now(),e){case"end":J="closed";break;case"open":J="open";break;case"opening":J="opening"}}const ne=o(496603).Bj((e=>async function(e){if(v)return;W+=1;const{createClient:t}=await R(),n=f().default.checkGate({gateName:"audio_processor_auth_client_fetch_jwt_enabled"});let r;if(n){const t=await o(449506).callApi({eventName:"getAudioProcessorAuthToken",environment:e,data:{}});if("success"!==t.type)throw new Error(`Failed to get audio processor auth token, ${t.error.message}`);r=t.data.accessToken}const a=t({minReconnectDelayMs:.5*c().TD,maxReconnectDelayMs:2*c().TD,jwtToken:r});return a.on("data",me),a.on("open",(()=>{m().A.setState("connected"),ee("open"),H=P(H._id+1),E&&function(){const e=Date.now(),t=20;function o(){const i=oe();if(0===i.queue&&0===i.running)return he(`Queues emptied after ${Date.now()-e} ms`),void(re=void 0);re=window.setTimeout(o,t)}re&&window.clearTimeout(re),he("Starting measurement of time until send queues are empty."),o()}()})),a.on("reconnected",(e=>{var t;(t=null==e?void 0:e.duration)&&t>1e4?de():Q=!1,L.log({level:"info",team:"editor",from:q,type:"reconnected",data:{message:`Reconnected in ${null==e?void 0:e.duration} ms`}})})),a.on("reconnect",(()=>{ee("reconnect")})),a.on("reconnect scheduled",(e=>{(void 0===(null==e?void 0:e.attempt)||void 0===(null==e?void 0:e.duration)||e.attempt>2||e.duration>5e3||void 0===m().A.state)&&m().A.setState("disconnected"),L.log({level:"info",team:"editor",from:q,type:"reconnect scheduled",data:{message:`Reconnecting in ${null==e?void 0:e.scheduled} ms, attempt ${null==e?void 0:e.attempt} of ${null==e?void 0:e.retries}`}})})),a.on("reconnect timeout",(()=>{ee("reconnect timeout")})),a.on("reconnect failed",(()=>{ee("reconnect failed")})),a.on("timeout",(()=>{ee("timeout")})),a.on("destroy",(()=>{ee("destroy")})),a.on("close",(()=>{ee("close")})),a.on("online",(()=>{ee("online")})),a.on("offline",(()=>{ee("offline")})),a.on("error",(e=>{let t;t="TransportError"===e.type?{level:"info",from:q,team:"no-team-specified",type:"primusTransportError",error:(0,s().convertErrorToLog)(e)}:{level:"error",from:q,team:"no-team-specified",type:"unknownPrimusError",error:(0,s().convertErrorToLog)(e)};(0,o(745875).rQ)(1)&&i().rateLimitedLog(t),L.log(t),$+=1})),a.on("incoming::ping",te),a.on("readyStateChange",ie),a.on("end",(()=>{ee("end"),a.off("readyStateChange",ie),U+=1,ge(a,e)})),window.__primusClient_audioProcessor=a,a}(e)),(function(){return"primus_audioProcessor"}));let re,se;function ae(e){if(se)throw new Error("Having more than one onRestartAudioProcessorConnectionHandler is not currently supported");se=e}function ce(){se=void 0}function de(){var e;Q=!1,N.cancel(),function(){for(const e of F.values())window.clearTimeout(e.timeout),e.reject(new Error("Cancelled pending requests"));F.clear()}(),null===(e=se)||void 0===e||e()}async function le(e){var t,o;const{base64Audio:i,environment:n,language:r}=e,s=null===(t=g().default.state.currentUserStore)||void 0===t?void 0:t.id,a=null===(o=g().default.state.currentSpaceStore)||void 0===o?void 0:o.id;var c;if(s&&a)return null===(c=pe({method:"audioData",request:{base64Audio:i,language:r,userId:s,spaceId:a},environment:n}))||void 0===c?void 0:c.response;{const e=s||a?s?"Space":"User":"Both";return await(0,u().stopDictation)({environment:n,error:new(p().eY)(e),from:"missing_user_or_space"})}}function ue(e){var t;const{environment:o,rootBlockId:i}=e,n=null===(t=g().default.state.currentSpaceStore)||void 0===t?void 0:t.id;pe({method:"transcriptionInfo",request:{rootBlockId:i,spaceId:(0,r().o9)(n)},environment:o})}function pe(e){if(v)return;const{method:t,request:o,environment:r}=e;S(r,{status:"enqueued",endpoint:t});const c=N.enqueue((()=>{var c;const d=n().JW();!function(e,t){h().default.afterNextFlush((()=>{f().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&((0,y().v)(e,"audio_processor.client.send_request.queue_running_size",{value:t.running}),(0,y().v)(e,"audio_processor.client.send_request.queue_backup_size",{value:t.queue}))}))}(r,N.getStats());const u=a().yX(),p=Date.now(),m=Z?window.setTimeout((()=>{"open"===J&&(H.requestsTimedOut+=1,L.log({level:"info",team:"editor",from:q,type:"requestTimeout",data:{requestId:d,time:Date.now()-p}}))}),j):void 0;F.set(d,{resolve:u.resolve,reject:u.reject,timeout:m,sendTime:p}),L.log({level:"info",team:"editor",from:q,type:"requestSent",data:{requestId:d,method:t}});const g={type:`${l().A.audioProcessor.api}/${t}`,requestId:d,...o};H.requestsSent+=1,async function(e){const{message:t,environment:o}=e,i=JSON.stringify(t);H.charactersSent+=i.length,X<i.length&&(X=i.length);const n=await ne(o);null==n||n.write(t)}({message:g,environment:r}),null===(c=e.onRequestSent)||void 0===c||c.call(e),u.promise.then((e=>{S(r,{status:"success",endpoint:t})})).catch((e=>{const o=N.getStats();S(r,{status:"failure",endpoint:t,queue_running_size:o.running,queue_backup_size:o.queue})}));const v=a().nQ(1e3,u.promise).then((e=>{let{timeout:o}=e;if(o){const e=N.getStats();S(r,{status:"failure",endpoint:t,queue_running_size:e.running,queue_backup_size:e.queue,queue_timeout:!0}),i().rateLimitedLog({level:"error",from:"audioProcessorInternals",team:"editor",type:"requestTimeout",error:(0,s().convertErrorToLog)(new Error("Request timed out")),data:{miscDataToConvertToString:{requestId:d,method:t}}})}return{}}));return v}));return{response:c.catch((e=>{e instanceof ve&&!Q?(Q=!0,z+=1,ee("connectionResetDueToFailedRequest"),ne(r).then((e=>{null==e||e.end()})),he(`sendRequest() for ${t} returned server error (${e.message}), resetting connection`,o)):he(`sendRequest() cancelled or errored for ${t} (${e.message})`,o)})),asyncQueuePromise:c}}function me(e){H.messagesReceived+=1;const t=(0,d().tf)(_,e);if(t)return H.invalidMessagesReceived+=1,void i().rateLimitedLog({level:"warning",team:"editor",from:q,type:"ValidationError",data:{miscDataToConvertToString:e},error:(0,s().convertErrorToLog)(t)});const o=e;switch(o.type){case"response":{const{requestId:e,status:t,result:i}=o,n=F.get(e);let r;if(F.delete(e),o.result&&"object"==typeof o.result&&"internalProcessingTimeMs"in o.result&&"number"==typeof o.result.internalProcessingTimeMs&&(r=o.result.internalProcessingTimeMs),L.log({level:"info",team:"editor",from:q,type:"responseReceived",data:{requestId:e,response:t,time:n&&Date.now()-n.sendTime,internalProcessingTimeMs:r}}),!n)return void(H.responsesReceivedWithoutHandlers+=1);Y=Date.now(),window.clearTimeout(n.timeout),"ok"===t?(H.successfulResponsesReceived+=1,n.resolve(i)):(H.unsuccessfulResponsesReceived+=1,n.reject(new ve(i)));break}case"transcription":D.emit(w,o);break;case"vad":D.emit(I,o);break;case"rate_limited":D.emit(x,o);break;case"forbidden":D.emit(T,o);break;case"upgrade_required":D.emit(B,o);break;case"free_trial_limit_update":D.emit(C,o);break;case"openai_error":D.emit(M,o)}}function ge(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,r;o&&i().log({level:"info",team:"editor",from:q,type:"audioProcessorEnd",error:{message:`SocketId: ${null==e||null===(n=e.socket)||void 0===n?void 0:n.id} Query:${null==e||null===(r=e.transport)||void 0===r?void 0:r.query}`}});G.setTimeout((()=>{void 0!==e&&e.destroy()}),0),ne.cache.clear(),de(),o&&G.setTimeout((()=>{ne(t)}),2*c().TD)}async function fe(e){if(e&&ne.cache.has("primus_audioProcessor")){const t=await ne(e);if(t){const o={type:`${l().A.audioProcessor.api}/destroySession`,requestId:n().JW()};t.write(o),t.removeAllListeners("end"),ge(t,e,!1),(0,b().generateNewClientSessionId)()}}}class ve extends Error{constructor(e){super(e),this.name="FailedAudioProcessorRequestError"}}function he(){if(E){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];console.info("audioProcessorInternals:",...t)}}},271380:(e,t,o)=>{o.r(t),o.d(t,{ensureTranscriptionIsInActive:()=>F,insertEmptyText:()=>$,pauseTranscription:()=>q,runSummarization:()=>O,startTranscription:()=>P,stopTranscription:()=>N,updatePreferredSummarizationFormat:()=>W});o(16280);var i=()=>o(700500),n=()=>o(416845),r=()=>o(388821),s=()=>o(798880),a=()=>o(763824),c=()=>o(498212),d=()=>o(615234),l=()=>o(534177),u=()=>o(896628),p=()=>o(722101),m=()=>o(246826),g=()=>o(666144),f=()=>o(778417),v=()=>o(436572),h=()=>o(725614),y=()=>o(812182),S=()=>o(751156),b=()=>o(390898),k=()=>o(348869),A=()=>o(2220),_=()=>o(595345),w=()=>o(807700),I=()=>o(972435),x=()=>o(765957),T=()=>o(909557),M=()=>o(239837),B=()=>o(748197),C=()=>o(870193),D=()=>o(276600),R=()=>o(723545),E=()=>o(431895);const j=(0,o(959013).YK)({genericError:{id:"transcriptionBlockActions.genericError",defaultMessage:"Something went wrong while summarizing your transcript."},failedToStartDictation:{id:"transcriptionBlockActions.failedToStartDictation",defaultMessage:"Unable to start transcription"},systemAudioMacHardwareError:{id:"transcriptionBlockActions.systemAudioMacHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of macOS."},systemAudioMacHardwareErrorRequiresMacOS13:{id:"transcriptionBlockActions.systemAudioMacHardwareErrorRequiresMacOS13",defaultMessage:"Transcribing on AI Meeting Notes requires macOS 13 or later."},systemAudioWindowsHardwareError:{id:"transcriptionBlockActions.systemAudioWindowsHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of Windows."}});async function P(e){var t;const{environment:o,blockStore:i}=e,r=null===(t=x().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!r)return;if((0,w().l)(i))return;y().UW("transcription_error_notification");const c=t=>{S().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:o,canUndo:!1,perform:t=>{U({...e,transaction:t,state:{state:"paused"}})}}),t&&v().D6({label:I().A.formatMessage(t),helpUrl:(0,M().zv)()})},d=await(0,E().HT)(o);switch(d){case"requiresMacOS13":return void c(j.systemAudioMacHardwareErrorRequiresMacOS13);case"showSetupModal":return c(),B().c.openTranscriptionSetupModal(),void(0,A().u)({environment:o,event:{eventName:"transcription_block_setup_modal_opened",eventProperties:{}}});case"noBrowserSupport":return void c(j.failedToStartDictation);case"startDictation":break;default:(0,l().HB)(d)}B().c.setSettingsOpenForBlockId(void 0),y().UW("transcription_idle_notification");try{B().c.setLoadingState(i.id,!0);if((await(0,a().nQ)(5e3,C().DictationManager.startDictation({environment:o,blockStore:i,from:"transcription_block",includeSystemAudio:(0,E().u)(o)}))).timeout)throw new(T().Tn)}catch(p){return void((0,n().USz)(p)&&("DictationSystemAudioFailedError"===p.name||"DictationStartTimeoutError"===p.name)&&o.device.isElectronMac?(c(),B().c.openTranscriptionSetupModal()):(0,n().USz)(p)&&"DictationSystemAudioHardwareError"===p.name&&o.device.isElectron?c(o.device.isElectronMac?j.systemAudioMacHardwareError:j.systemAudioWindowsHardwareError):c(j.failedToStartDictation))}finally{B().c.setLoadingState(i.id,!1)}const u={state:"transcribing",transcriber_id:r,transcriber_table:s().oo,session_id:(0,_().qY)()};S().createAndCommit({userAction:"transcriptionBlockActions.initializeTitleAndStartTranscription",environment:o,canUndo:!1,perform:t=>{U({...e,transaction:t,state:u})}})}async function N(e){await L({...e,shouldStopDictation:!0})}async function F(e){var t;const{environment:o,blockStore:i,from:n}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.transcription_state;return r&&"transcribing"!==r.state?"initial"!==(null==r?void 0:r.state)&&"idle"!==(null==r?void 0:r.state)&&"paused"!==(null==r?void 0:r.state)&&"summarizing"!==r.state&&void(0,l().HB)(r):(await q({environment:o,blockStore:i,shouldStopDictation:!1,from:n}),!0)}async function q(e){await L({...e,disableSummarization:!0,state:{state:"paused"}})}async function L(e){const{environment:t,blockStore:o,state:i,disableSummarization:n,shouldStopDictation:r,from:s}=e;B().c.setSettingsOpenForBlockId(void 0),y().UW("transcription_idle_notification"),i&&U({environment:t,blockStore:o,state:i,from:s}),r&&C().DictationManager.stopDictation({environment:t,from:"transcription_block"}),n||await O({environment:t,blockStore:o,from:s})}async function O(e){const{environment:t,blockStore:o,from:i}=e;if(!x().default.state.mainEditorCurrentBlockStore)return;const n=o.pointer.spaceId;if(!n)return;U({environment:t,blockStore:o,state:{state:"summarizing",step:"thinking",thinkingSteps:[]},from:i});const s={...o.pointer,spaceId:n},a=B().c.getSummarizationAbortController(o.id);null==a||a.abort();const l=B().c.createSummarizationAbortController(o.id);try{const e=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Summarization timeout"))),31*d().TD)}));let i=!1;await Promise.race([e,(0,k().g)({environment:t,onResponse:e=>{if("summarize-transcript-error"===e.type)return void v().D6({label:I().A.formatMessage(j.genericError)});if("summarize-transcript-record-map"===e.type){const o=e.recordMap;g()._O({environment:t,recordMap:r().RecordMapWithRole.create(o),inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,debugSource:"transcriptionBlockActions.runSummarization"})}const n=B().c.getTabState(o.id),s=(0,M().y1)(o,"summary");s&&n!==(null==s?void 0:s.id)&&!i&&(i=!0,B().c.setTabState(o.id,s.id))},data:{transcript:[{id:(0,c().Ay)(),type:"config",value:{type:"summarize-transcript",transcriptPointer:s,language:(0,D().F)(t.currentUser.id)}},{id:(0,c().Ay)(),type:"summarize-transcript"}],traceId:o.id,spaceId:n,generateTitle:!1},abortSignal:l.signal})])}catch(u){if((0,b().zf)(l,u))return;U({environment:t,blockStore:o,state:{state:"idle"},from:"summary_error"})}}async function W(e){var t;const{environment:o,blockStore:i,format:n}=e;if((null===(t=i.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===n)return;S().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:o,canUndo:!0,perform:e=>{u().zA({stores:[i],update:{transcription_summarization_format_type:n},transaction:e})}});"idle"!==(0,M().by)(i).state||(0,w().l)(i)||await O({environment:o,blockStore:i,from:"format_updated"})}function U(e){const{environment:t,blockStore:o,state:i,transaction:n,from:r}=e;(0,R().K)({environment:t,blockStore:o,state:i,transaction:n}),(0,A().u)({environment:t,event:{eventName:"transcription_state_updated",eventProperties:{from:r,block_id:o.id,space_id:o.pointer.spaceId,new_state:i.state}}})}function $(e){const{environment:t,store:o,transaction:n}=e,r=m().Wv({environment:t,type:i().xd.text,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});p().BC({parentStore:o.getContentStore(),appendStore:r,transaction:n});const s=o.getContentStores()[0];f().hc({environment:t,store:s});const a=s.getBlockTitleStore();h().setSelectionAtStart({store:a})}},277681:(e,t,o)=>{e.exports=o.p+"5b8442a649f228d6.ts"},405689:(e,t,o)=>{o.d(t,{t:()=>A});o(944114),o(816573),o(878100),o(177936),o(748140),o(821903),o(491134),o(128845),o(237467),o(444732),o(979577),o(898992),o(803949),o(581454),o(908872);var i=o(296540),n=()=>o(484714),r=()=>o(56366),s=()=>o(401497),a=()=>o(534177),c=()=>o(828634),d=()=>o(217429),l=()=>o(28834);var u=()=>o(964576),p=()=>o(964345);class m extends(()=>o(757695))().Store{constructor(){super()}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}addListener(e){super.addListener(e),this.instanceState||this.setState((0,o(673903).G)(24e3))}removeListener(e){super.removeListener(e),0===this.listenerCount()&&this.setState(void 0)}}const g=new m;var f=o(474848);const v=50,h=7e3,y=50,S=14e3,b=1.5,k=1.3;function A(e){const{fillWidth:t=!1,forceRender:o=!1,fakeSoundwave:m=!1,rootBlockId:A}=e,{isMobile:_,isIOS:w,isMac:I}=(0,n().Y0)(),x=(0,r().K8)((()=>{if(!_)return;const e=d().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain");if(w){var t;const o=null===(t=u().A.state)||void 0===t?void 0:t.label;if((0,a().O9)(o)&&"iPhone Microphone"!==o)return;return e+6}return e}),[_,w]),T=_?y:v,M=_?S:h,B=(0,i.useMemo)((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h;const o=(e+t)/2;return{frequencyRangeMin:e,frequencyRangeMax:t,frequencyLowerQuarter:(e+o)/2,frequencyUpperQuarter:(o+t)/2}}(T,M)),[T,M]),C=(0,r().K8)((()=>p().Ay.state.rootBlock&&p().Ay.state.rootBlock.id===A),[A]),D=(0,r().K8)((()=>p().Ay.state.audioRecorder),[]),R=(0,r().O$)(g),E=(0,i.useRef)(null),[j,P]=(0,i.useState)(8),[N,F]=(0,i.useState)([]),q=t?2*b:b,L=t?3*k:k;!function(e){const{isEnabled:t,numBars:o,barHeights:n,setBarHeights:r}=e,s=(0,i.useRef)(null);(0,i.useEffect)((()=>{if(s.current&&cancelAnimationFrame(s.current),!t)return;n.length!==o&&r(new Array(o).fill(3));const e={lastFrameTime:Date.now(),isSpeaking:!0,speakingBlendFactor:1,nextStateChangeTime:Date.now()+3e3+3e3*Math.random(),lastStateChangeTime:Date.now(),activityLevel:.8+.4*Math.random(),currentHeights:Array(o).fill(3)},i=Array(o).fill(0).map((()=>Math.random()*Math.PI*2)),a=Array(o).fill(0).map((()=>.85+.3*Math.random())),c=Array(o).fill(0).map((()=>.8+.4*Math.random())),d=.6+.15*Math.random(),l=.9+.2*Math.random(),u=2.8+1.2*Math.random(),p=()=>{const t=Date.now(),n=Math.min(.05,(t-e.lastFrameTime)/1e3);if(e.lastFrameTime=t,t>e.nextStateChangeTime){e.isSpeaking?e.isSpeaking=Math.random()>.85:e.isSpeaking=!0,e.lastStateChangeTime=t;const o=e.isSpeaking?1400:200,i=e.isSpeaking?3800:500,n=o+Math.random()*(i-o);e.nextStateChangeTime=t+n,e.isSpeaking&&(e.activityLevel=.9+.6*Math.random())}const m=e.isSpeaking?e.speakingBlendFactor:Math.max(.35,.45*e.speakingBlendFactor),g=e.isSpeaking?1:.4,f=e.isSpeaking?5:4.5;Math.abs(e.speakingBlendFactor-g)>.01?e.speakingBlendFactor<g?e.speakingBlendFactor=Math.min(g,e.speakingBlendFactor+n*f):e.speakingBlendFactor=Math.max(g,e.speakingBlendFactor-n*f):e.speakingBlendFactor=g;const v=.25*Math.sin(6e-4*t)+.85,h=e.activityLevel*v,y=Math.max(0,.7*Math.sin(.001*t)+.3),S=y>.55&&m>.5,b=S?1+.8*(y-.55):1,k=Array(o).fill(0).map(((r,s)=>{const p=s/(o-1),g=1-2*Math.abs(p-.5),f=Math.pow(g,.5),v=.006*t,y=Math.sin(v*a[s]+i[s])*c[s]+.5*Math.sin(2.2*v*a[(s+3)%o]+i[(s+2)%o])+.3*Math.sin(v*u*a[(s+1)%o]+i[(s+5)%o]),k=.7+.45*Math.sin(v*d+.1*s)+.35*Math.sin(v*l+i[s]),A=3+(y+1.2)*(S?6:5.5)*f*k*(m*h*b),_=A>e.currentHeights[s],w=Math.min(1,n*(_?25:16));return e.currentHeights[s]=e.currentHeights[s]*(1-w)+A*w,Math.max(3,Math.min(15,e.currentHeights[s]))}));r(k),s.current=requestAnimationFrame(p)};return s.current=requestAnimationFrame(p),()=>{s.current&&cancelAnimationFrame(s.current)}}),[t,o,n.length,r])}({isEnabled:m,numBars:j,barHeights:N,setBarHeights:F});const O=(0,i.useCallback)((()=>{if(t&&(D||o||m)&&E.current){const e=E.current.clientWidth,t=q+L,o=Math.max(1,Math.floor(e/t));P(o),F(new Array(o).fill(3))}}),[t,D,o,m,q,L]),W=(0,c().wY)(E),U=null==W?void 0:W.width;(0,i.useEffect)((()=>{U&&O()}),[U,O]),(0,i.useEffect)((()=>{if(o&&!m||!C&&D)F(new Array(j).fill(3));else if(D&&R&&!m){const e=new AbortController,t=e.signal,o=()=>{const{mediaStreams:e}=D;if(e&&e.length>0){const o=R.createChannelMerger(e.length),i=R.createAnalyser();i.fftSize=2048;const n=e.map((t=>{const i=[],n=R.createMediaStreamSource(t);if(i.push(n),(0,a().O9)(x)){const t=R.createGain();t.gain.setValueAtTime(x/e.length,R.currentTime),i.push(t)}else{var r;const e=null===(r=t.getAudioTracks().pop())||void 0===r?void 0:r.label;if(I&&e&&e.includes("Built-in")){const e=R.createGain();e.gain.setValueAtTime(6,R.currentTime),i.push(e)}}const s=R.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(B.frequencyLowerQuarter,R.currentTime),i.push(s);const c=R.createBiquadFilter();return c.type="lowpass",c.frequency.setValueAtTime(B.frequencyUpperQuarter,R.currentTime),i.push(c),i.push(o),i}));o.connect(i),n.forEach((e=>{for(let t=0;t<e.length-1;t++)e[t].connect(e[t+1])}));const r=()=>{n.forEach((e=>{e.forEach((e=>e.disconnect()))})),o.disconnect(),i.disconnect()};R.resume();const s=new Uint8Array(i.frequencyBinCount),c=()=>{if(t.aborted)return void r();i.getByteFrequencyData(s);const e=R.sampleRate/2/i.frequencyBinCount,o=Math.round(B.frequencyRangeMin/e),n=Math.round(B.frequencyRangeMax/e),a=s.slice(o,n+1),d=Math.floor(a.length/j),l=[];for(let t=0;t<j;t++){const e=a.slice(t*d,t<j-1?(t+1)*d:a.length+1),o=e.reduce(((e,t)=>e+t),0)/e.length,i=Math.max(3,Math.min(12,o/3));l.push(i)}F(l),requestAnimationFrame(c)},d=requestAnimationFrame(c);return()=>{cancelAnimationFrame(d),r()}}};let i=o();const n=()=>{"function"==typeof i&&i(),i=o()};return D.emitter.on(l().Q,n),()=>{D.emitter.off(l().Q,n),"function"==typeof i&&i(),e.abort()}}}),[D,j,R,o,x,B,m,C,I]);const $=(0,s().IS)((e=>({barStyle:{flexShrink:0,bottom:"0",width:`${q}px`,backgroundColor:e.icon.tertiary,borderRadius:t?"4px":"1px"}})),[q,t]);return(0,f.jsx)("div",{ref:E,style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:L,flex:t?1:void 0},children:N.map(((e,t)=>(0,f.jsx)("div",{style:{...$.barStyle,height:`${e}px`}},t)))})}},426175:(e,t,o)=>{o.d(t,{Ay:()=>d,X8:()=>a,dc:()=>c});o(944114),o(898992),o(354520),o(672577),o(908872);var i=()=>o(496506),n=()=>o(673903);class r extends(()=>o(757695))().Store{async updateMediaDevices(){try{const e=await async function(){const e=(0,n().E)();return(await e.enumerateDevices()).reduce(((e,t)=>{if(t.kind&&t.label&&t.deviceId&&t.groupId)switch(t.kind){case"videoinput":e.videoInput.push(t);break;case"audioinput":e.audioInput.push(t);break;case"audiooutput":e.audioOutput.push(t)}return e}),{videoInput:[],audioInput:[],audioOutput:[]})}();this.setState(e)}catch{}}constructor(){super();try{(0,n().E)().addEventListener("devicechange",(()=>{this.updateMediaDevices()}))}catch{}o(927648).Ay.addListener((()=>{this.updateMediaDevices()}))}getInitialState(){return{videoInput:[],audioInput:[],audioOutput:[]}}}const s=new r,a=new(i().ComputedStore)((()=>{var e,t;return(null===(e=s.state)||void 0===e||null===(e=e.audioInput)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>null==e?void 0:e.label)))??[]}),{debugName:"AudioInputDevicesStore"}),c=new(i().ComputedStore)((()=>{var e;const t=o(964576).A.state,i=null===(e=o(524007).d.state)||void 0===e?void 0:e.label,n=a.state.find((e=>e.label===i));return t||(n||a.state[0])}),{debugName:"SelectedAudioInputDeviceStore"}),d=s},432142:(e,t,o)=>{o.d(t,{K:()=>u,N:()=>p});o(898992),o(672577),o(737550);var i=()=>o(584262),n=()=>o(874913),r=()=>o(857783),s=()=>o(620689),a=()=>o(695625),c=()=>o(982254),d=()=>o(911063);function l(e,t){const o=a().T.findScrollToSelectablesFromIds([t]);return 0!==o.length&&(s().pb({environment:e,handle:o[0],vertical:{reveal:"top"},horizontal:void 0,animate:!0}),!0)}function u(e){const{environment:t,blockStore:o}=e;if(l(t,o.id))return;const s=(0,d().getActiveTranscriptionBlockStore)();if((null==s?void 0:s.id)===o.id)return void r().uK({environment:t,store:o,pageVisitSource:i().y8.TranscriptionBlockPopup});const a=c().A.state.tabs.find((e=>{var t;return null===(t=e.activeBlocks)||void 0===t?void 0:t.some((e=>e.pointer.id===o.id))}));a&&n().navigateToBlockInTab({tabId:a.id,pointer:o.pointer,source:i().y8.TranscriptionBlockPopup})}function p(e){const{environment:t,blockStore:o,tabId:s}=e;l(t,o.id)||(s&&s!==c().A.state.currentTab.id?n().navigateToBlockInTab({tabId:s,pointer:o.pointer,source:i().y8.TranscriptionBlockPopup}):r().uK({environment:t,store:o,pageVisitSource:i().y8.TranscriptionBlockPopup}))}},491396:(e,t,o)=>{o.r(t),o.d(t,{displayDictationGenericErrorSnackbar:()=>_,displayDictationPermissionSnackbar:()=>k,displayDictationUsageErrorSnackbar:()=>A,showTranscriptionErrorToast:()=>w});var i=o(296540),n=()=>o(532940),r=()=>o(959013),s=()=>o(534177),a=()=>o(436572),c=()=>o(812182),d=()=>o(2220),l=()=>o(765957),u=()=>o(630116),p=()=>o(484714),m=()=>o(435009),g=()=>o(104012),f=()=>o(239837),v=o(474848);function h(){const e=(0,p().v3)(),t=(0,i.useCallback)((()=>{m().oo({environment:e,url:(0,f().zv)()})}),[e]);return(0,v.jsx)(g().Ag,{onClick:t,children:(0,v.jsx)(r().sA,{defaultMessage:"Get help",id:"dictation.permission.snackbar.getHelpButton.title"})})}var y=()=>o(914649),S=()=>o(271380),b=()=>o(432142);y().JS,y().rP,y().JC;function k(e){var t;a().D6({label:(t=e,t===y().JS?(0,v.jsx)(r().sA,{defaultMessage:"No microphone permission. Allow access to your microphone in system settings",id:"dictation.permission.microphone.snackbar.error"}):t===y().rP?(0,v.jsx)(r().sA,{defaultMessage:"No microphone available. Connect your microphone in system settings",id:"dictation.unavailable.microphone.snackbar.error"}):t===y().JC?(0,v.jsx)(r().sA,{defaultMessage:"An unknown error occurred when trying to access the microphone.",id:"dictation.permission.unknown.snackbar.error"}):void(0,s().HB)(t)),right:(0,v.jsx)(h,{})})}function A(){a().D6({label:(0,v.jsx)(r().sA,{defaultMessage:"Audio usage limit reached. Try again later.",id:"dictation.usage.snackbar.error"})})}function _(){a().D6({label:(0,v.jsx)(r().sA,{defaultMessage:"Dictation failed. Please try again.",id:"dictation.generic.snackbar.error"})})}function w(e,t){const{pointer:o,tabId:i,title:s,message:a,name:p,canRestart:m}=t,g=l().AppStoreCurrentSpaceStore.state;if(!g)return;const f=u().Bv.createChildStore(g,o);if(!f.isTranscriptionBlock())return;const h={title:(0,v.jsx)(r().sA,{defaultMessage:"Go to meeting note",id:"dictation.error.toast.action.goToBlock"}),onAction:()=>{c().UW("transcription_error_notification"),(0,b().N)({environment:e,blockStore:f,tabId:i}),(0,d().u)({environment:e,event:{eventName:"error_transcription_toast_navigation_button_clicked",eventProperties:{block_id:f.id,error_name:p}}})}};c().HK({id:"transcription_error_notification",icon:n().exclamationMarkTriangleIcon,presentationType:"persistent",variant:"error",title:s,message:a,onDismiss:()=>{(0,d().u)({environment:e,event:{eventName:"error_transcription_toast_dismissed",eventProperties:{block_id:f.id,error_name:p}}})},actions:{primary:m?{title:(0,v.jsx)(r().sA,{defaultMessage:"Resume",id:"dictation.error.toast.action.resume"}),onAction:()=>{c().UW("transcription_error_notification"),(0,b().N)({environment:e,blockStore:f,tabId:i}),(0,S().startTranscription)({environment:e,blockStore:f,from:"transcription_error_toast"}),(0,d().u)({environment:e,event:{eventName:"error_transcription_toast_resume_button_clicked",eventProperties:{block_id:f.id,error_name:p}}})}}:h,secondary:m?h:void 0}})}},524007:(e,t,o)=>{o.d(t,{d:()=>i});const i=new(o(178624).R)({key:"preferred_audio_input_device",namespace:o(419494).cd,important:!0,trackingType:"preference"})},595345:(e,t,o)=>{o.d(t,{$g:()=>i().$g,qY:()=>n().getCurrentClientSessionId});var i=()=>o(262089),n=()=>o(99874)},631616:(e,t,o)=>{o.d(t,{NL:()=>a,h1:()=>s,j8:()=>c});o(16280);var i=()=>o(822124);class n extends Error{constructor(e){super(e),this.name="OPFSMeetingNotesCacheKeyVersionError"}}class r extends Error{constructor(e){super(e),this.name="OPFSMeetingNotesCacheKeyFileTypeError"}}function s(e){const[t,...o]=e.split("__");if("1"===t){const[t,n,s,a]=o;let c;for(const[e,o]of Object.entries(i().c))if(o.id===parseInt(a)){c=e;break}return c?{version:1,userId:t,blockId:n,recordingId:s,fileType:c}:new r(`invalid OPFS cache key -- unknown file type: ${e}`)}return new n(`invalid OPFS cache key -- unknown version: ${e}`)}function a(e){const{userId:t,blockId:o,recordingId:n,fileType:r}=e;return`1__${t}__${o}__${n}__${i().c[r].id}`}function c(e){return new BroadcastChannel(`opfs-meeting-notes-cache::${e}`)}},637368:(e,t,o)=>{o.r(t),o.d(t,{isExplainableTranscriptionStopReason:()=>g,showTranscriptionRecordingStoppedToast:()=>p});var i=()=>o(584262),n=()=>o(284611),r=()=>o(381349),s=()=>o(857783),a=()=>o(812182),c=()=>o(972435),d=()=>o(765957),l=()=>o(630116),u=()=>o(239837);function p(e,t){const{pointer:o,from:p}=t,f=d().AppStoreCurrentSpaceStore.state;if(!f)return;const v=l().Bv.createChildStore(f,o);if(null==v||!v.isTranscriptionBlock()||"transcribing"===(0,u().by)(v).state)return;if(!g(p))return;const h=v.pathIsAccessibleAndAlive(),y=m[p];a().Iz({id:"transcription_recording_stopped",icon:()=>(0,n().b)({color:r().Ay.invertedTextColor,height:16,width:16}),presentationType:"persistent",title:c().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.title",defaultMessage:"Your meeting has stopped recording"}),message:c().A.getIntl().formatMessage(y),actions:h?{primary:{title:c().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.action.goToMeetingNote",defaultMessage:"Go to meeting note"}),onAction:()=>{a().UW("transcription_recording_stopped"),s().uK({environment:e,store:v,pageVisitSource:i().y8.TranscriptionRecordingStoppedNotification})}}}:void 0})}const m=(0,o(959013).YK)({block_not_available:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotAvailable",defaultMessage:"You no longer have access to this meeting note."},block_not_dictatable:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotDictatable",defaultMessage:"The meeting note was deleted or is no longer accessible."},space_switch:{id:"transcriptionRecordingStopped.toast.subtitle.spaceSwitch",defaultMessage:"The meeting note is in another workspace."},missing_user_or_space:{id:"transcriptionRecordingStopped.toast.subtitle.missingUserOrSpace",defaultMessage:"Something went wrong with your account."},audio_recorder_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.audioRecorderStopped",defaultMessage:"Something went wrong while recording your audio."},transcription_block_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.transcriptionBlockStopped",defaultMessage:"The meeting note was stopped."}});function g(e){return"button"!==e&&"mobile_bar_button"!==e&&"rate_limit"!==e&&"upgrade_required"!==e&&"transcription_error"!==e&&"shortcut"!==e&&"block_action"!==e&&"topbar_menu"!==e&&"native_action"!==e&&"template_picker"!==e&&"horizontal_template_picker"!==e&&"quick_add"!==e&&"new_page_and_dictate_shortcut"!==e&&"new_page_and_dictate_action"!==e&&"transcription_block"!==e&&"forbidden"!==e&&"start_transcription_error"!==e&&"block_not_visible"!==e}},674266:(e,t,o)=>{o.d(t,{w:()=>r});o(296540);var i=()=>o(401497),n=o(474848);function r(e){let{disabled:t}=e;const o=(0,i().IS)((e=>({icon:{width:12,height:12,borderRadius:3,backgroundColor:t?e.icon.tertiary:e.icon.uiRedPrimary}})),[t]);return(0,n.jsx)("div",{style:o.icon})}},725081:(e,t,o)=>{o.r(t),o.d(t,{sendNotificationForDictationInterrupted:()=>w,sendNotificationForRunningAudioProcess:()=>_});var i=()=>o(244641),n=()=>o(662303),r=()=>o(416504),s=()=>o(959013),a=()=>o(435009),c=()=>o(2220),d=()=>o(338931),l=()=>o(972435),u=()=>o(321032),p=()=>o(523239),m=()=>o(135428),g=()=>o(379560),f=()=>o(765957),v=()=>o(217429),h=()=>o(271380),y=()=>o(432142),S=()=>o(391532);const b=(0,s().YK)({zoom:{id:"audioProcessDetectionActions.zoom",defaultMessage:"In a Zoom meeting?"},safari:{id:"audioProcessDetectionHelpers.audioProcess.safari",defaultMessage:"In a meeting?"},chrome:{id:"audioProcessDetectionHelpers.audioProcess.chrome",defaultMessage:"In a meeting?"},teams:{id:"audioProcessDetectionHelpers.audioProcess.teams",defaultMessage:"In a Teams meeting?"},edge:{id:"audioProcessDetectionHelpers.audioProcess.edge",defaultMessage:"In a meeting?"},brave:{id:"audioProcessDetectionHelpers.audioProcess.brave",defaultMessage:"In a meeting?"},arc:{id:"audioProcessDetectionHelpers.audioProcess.arc",defaultMessage:"In a meeting?"},firefox:{id:"audioProcessDetectionHelpers.audioProcess.firefox",defaultMessage:"In a meeting?"}}),k=(0,s().YK)({body:{id:"audioProcessDetectionActions.notification.body",defaultMessage:"Start AI Meeting Notes for this meeting"}}),A=(0,s().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"},allDayTimeLabel:{id:"calendarMeetingNoteNotification.allDayTimeLabel",defaultMessage:"All-day"},takeNotes:{id:"calendarMeetingNoteNotification.takeNotesBody",defaultMessage:"{startTime} · Start AI Meeting Notes"}});function _(e,t){var o,s;if(e.device.isMobile||!v().default.checkGate({gateName:"meeting_notes_audio_process_notification"}))return;if(!((null===(o=f().AppStoreCurrentSpaceViewStore.getState())||void 0===o?void 0:o.isAiMeetingNotesAudioProcessDetectionNotificationEnabled())??!0))return;const h=null===(s=g().A.getStateForCurrentSpaceView())||void 0===s?void 0:s.botId,y=g().A.getEvents(),_=(0,d()._X)(y),w=function(e){const{processName:t,event:o}=e;if(o)return o.summary||l().A.formatMessage(A.defaultEventTitle);return l().A.formatMessage(b[t])}({processName:t,event:_}),I=function(e){const{event:t}=e;if(t){const e=t.isAllDay?l().A.formatMessage(A.allDayTimeLabel):(0,m().ax)({time:i().c9.fromISO(t.start.dateTime),showAmPm:!0,locale:n().locale,timeZone:(0,r().P)()});return l().A.formatMessage(A.takeNotes,{startTime:e})}return l().A.formatMessage(k.body)}({event:_}),x=Notification.permission;(0,c().u)({environment:e,event:{eventName:"audio_process_notification_sent",eventProperties:{permission:x,calendar_bot_id:h,has_calendar_event:Boolean(_),process:t}}});new Notification(w,{body:I,silent:!0}).addEventListener("click",(()=>{_&&h?async function(e){const{environment:t}=e,o=await async function(e){const{environment:t,event:o,calendarBotId:i,from:n}=e,r=await(0,p().NC)({environment:t,botId:i,event:o,meetingNote:o.meetingNote,from:n});return"success"===r.type?r.data.page.url:void 0}(e);(0,u().R)(t,{botId:e.calendarBotId,payload:{type:"track",payload:{event:"meetingNoteClicked",eventId:e.event.id,product:"notion",from:e.from}}}),o?a().oo({environment:t,url:o,openInNew:"tab",makeTabActive:!0}):(0,S().createAndNavigateToTranscriptionBlockInNewPage)({environment:t,from:"audio_process_detection",includeTitle:!1})}({environment:e,event:_,from:"calendar_event_notification",calendarBotId:h}):(0,S().createAndNavigateToTranscriptionBlockInNewPage)({environment:e,from:"audio_process_detection",includeTitle:!1})}))}function w(e){const{environment:t,blockStore:o,title:i,message:n,canRestart:r,tabId:s}=e;if(t.device.isMobile)return;const a=new Notification(i,{body:n,silent:!1,requireInteraction:!0}),c=()=>{(0,y().N)({environment:t,blockStore:o,tabId:s})},d=r?()=>{c(),(0,h().startTranscription)({environment:t,blockStore:o,from:"resume_from_click_error_notification"})}:c;a.addEventListener("click",d)}},822124:(e,t,o)=>{o.d(t,{c:()=>i});const i={PCM_F32_16000_MONO:{id:0}}},865060:(e,t,o)=>{o.d(t,{X:()=>s});var i=()=>o(595345),n=()=>o(233124),r=()=>o(632503);function s(e,t){(0,n().K_)(e,{from_language:r().t.state,to_language:t,dictation_session_id:(0,i().qY)()}),r().t.set(e,t)}},870193:(e,t,o)=>{o.r(t),o.d(t,{AudioSessionBlockWriter:()=>Q,DictationManager:()=>ne,StreamingDictationManager:()=>le,smartToggleDictation:()=>re,startDictation:()=>se,stopDictation:()=>ae,updateActiveBlocks:()=>ce});o(16280),o(18107),o(944114),o(816573),o(878100),o(177936),o(967357),o(748140),o(821903),o(491134),o(128845),o(237467),o(444732),o(979577),o(898992),o(823215),o(354520),o(672577),o(803949),o(581454);var i=()=>o(700500),n=()=>o(857639),r=()=>o(919709),s=()=>o(220719),a=()=>o(999752),c=()=>o(319625),d=()=>o(502800),l=()=>o(534177),u=()=>o(874913),p=()=>o(44729),m=()=>o(246826),g=()=>o(319975),f=()=>o(725614),v=()=>o(751156),h=()=>o(595345),y=()=>o(262089),S=()=>o(87017),b=()=>o(186445),k=()=>o(755206),A=()=>o(972435),_=()=>o(108944),w=()=>o(765957),I=()=>o(217429),x=()=>o(148832),T=()=>o(891360),M=()=>o(233124);class B{constructor(e,t){this.id=void 0,this.lastUpdated=void 0,this.text=void 0,this.isCompleteReceived=void 0,this.transcriptions=void 0,this.id=e,this.lastUpdated=new Date,this.isCompleteReceived=Boolean(t),this.transcriptions=new Map}updateText(){let e;for(const t of this.transcriptions.values()){if("pending"===t.status)break;"complete"===t.status&&(e=t.text)}this.text=e}setTranscription(e,t){this.transcriptions.set(e,t),this.updateText(),this.lastUpdated=new Date}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getText(){return this.text}getMsSinceLastUpdate(){return(new Date).getTime()-this.lastUpdated.getTime()}isSettled(){return(new Date).getTime()-this.lastUpdated.getTime()>o(615234).Xb||this.isCompleteReceived&&this.transcriptions.values().every((e=>{let{status:t}=e;return"pending"!==t}))}}var C=()=>o(914649),D=()=>o(909557),R=()=>o(28834);function E(e){let t;const o=[];for(const n of e.segments){var i;const r=n.getText();if(!r)continue;const s=n.isSettled()||e.forceSettled||!1;(null===(i=t)||void 0===i?void 0:i.settled)!==s?(t&&o.push(t),t={text:r,settled:s,segmentId:n.getId()}):t.text=`${t.text} ${r}`}return t&&o.push(t),o.length>0&&e.indent&&(o[0].text=` ${o[0].text}`),o}o(737550);function j(e){return!!(0,r().BEe)(e)&&e[1].some(r().Si1)}var P=()=>o(74e3);const N=/([\?\!\.])\s/;function F(e){const t=e.split(N);for(let o=1;o<t.length;o++){const e=t[o];[".","?","!"].includes(e)&&(t[o-1]+=e,t[o]="")}return t.filter((function(e){return void 0!==e&&""!==e}))}var q=()=>o(239837),L=()=>o(927648),O=()=>o(964345),W=()=>o(276600);function U(e){const{environment:t,transcriptionBlockStore:i}=e,n=(0,q().y1)(i,"transcript");if(n)return n;const{performResult:r}=v().createAndCommit({userAction:"transcriptionBlockTabActions.getOrCreateTranscriptionTabBlockStore",environment:t,perform:e=>{const n=m().Wv({environment:t,type:"text",inMemoryRecordCache:i.inMemoryRecordCache,transaction:e});p().NI({transaction:e,parentStore:i,childStore:n});const r=m().Wv({environment:t,type:"text",inMemoryRecordCache:i.inMemoryRecordCache,transaction:e});return p().NI({transaction:e,parentStore:n,childStore:r}),o(896628).zA({transaction:e,stores:[i],update:{transcription_transcript_id:n.id}}),n},canUndo:!1});return r}var $=()=>o(491396);const z=[],H=(0,o(496603).nF)((()=>{const e=[...z];z.length=0,u().writeSessionLogs(e)}),1e3);function K(e){let{messages:t,...o}=e;z.push({...o,timestamp:new Date,args:Array.isArray(t)?t:[t]}),H()}function Y(e,t){I().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),n=2;n<o;n++)i[n-2]=arguments[n];K({level:"info",messages:i,processName:e,sessionId:t})}("transcriptions",e,t)}function V(e,t,o){I().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),n=2;n<o;n++)i[n-2]=arguments[n];K({level:"error",messages:i,processName:e,sessionId:t})}("transcriptions",e,{...o,error:(0,c().A)(t)})}var X;class G{constructor(){this.segments=void 0,this.segments=new Map}setSegment(e){this.segments.set(e.getId(),e)}getSegment(e){return this.segments.get(e)}getSegments(){return this.segments.values()}deleteSegment(e){this.segments.delete(e)}isSettled(){return this.getSegments().every((e=>e.isSettled()))}}class Q{constructor(e){this.id=void 0,this.env=void 0,this.rootBlockId=void 0,this.isCompleteReceived=void 0,this.blockStore=void 0,this.onUpdateBlock=void 0,this.segmentManager=void 0;const{id:t,env:o,rootBlockId:i,blockStore:n,onUpdateBlock:r}=e;this.id=t,this.env=o,this.isCompleteReceived=!1,this.rootBlockId=i,this.blockStore=n,this.onUpdateBlock=r,this.segmentManager=new G}getOrCreateSegment(e){const t=this.segmentManager.getSegment(e);if(t)return t;const o=new B(e);return this.segmentManager.setSegment(o),o}getBlockStore(){return this.blockStore}setBlockStore(e){var t;this.blockStore=e,null===(t=this.onUpdateBlock)||void 0===t||t.call(this,e)}logInsert(e){let{final:t,...o}=e;Y(this.rootBlockId,{...o,type:"insert:"+(t?"final":"temp"),sessionId:this.id,blockId:this.blockStore.id})}logDelete(e){Y(this.rootBlockId,{...e,type:"delete",sessionId:this.id,blockId:this.blockStore.id})}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}isSettled(){return this.isCompleteReceived&&this.segmentManager.isSettled()}writeToBlock(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.blockStore.getParentBlockStore();if(!this.blockStore.isDictatableBlock()||!t)return;let o=!1;const i=[],n=[];for(const r of[...this.segmentManager.getSegments()])o||!e&&!r.isSettled()?(o=!0,n.push(r)):(i.push(r),this.segmentManager.deleteSegment(r.getId()));const{serverCommitResult:s,transactionId:a}=v().createAndCommit({userAction:"dictationActions.writeToBlock",environment:this.env,canUndo:!1,perform:o=>{let s,a=0;const c=this.blockStore.getBlockTitleStore(),d=(0,r().ooo)(c.getValue());for(let e=0;e<d.length;e++){if(j(d[e])){s=e;break}a+=(0,r().WWE)(d[e])}if(void 0!==s){if(0===i.length){const t=function(e){const{tokens:t,...o}=e,i=E(o);return i.length===t.length&&i.every(((e,o)=>{let{text:i,settled:n}=e;const s=t[o];return!(j(s)?n:!n)&&i===(0,r().N8A)(s)}))}({segments:n,tokens:d.slice(s),forceSettled:e,indent:a>0});if(t)return}this.logDelete({transactionId:o.id,index:a}),g().jQ({environment:this.env,store:c,selection:{startIndex:a,endIndex:1/0},transaction:o,updateSelection:!1})}const l=function(e){const{text:t,maxLength:o=1/0,initialLength:i=0}=e;if(0===o)throw new Error("Max length must be >0");let n=i,r="";const s=[];for(const a of t)r=""===r?a:`${r} ${a}`,n=r.length,n>=o&&(s.push(r),r="",n=0);return r&&s.push(r),s}({text:F(te([...i.values()])),initialLength:a,maxLength:250});for(const e of l){const i=a>0?` ${e}`:e;if(this.logInsert({transactionId:o.id,text:i,index:a,settled:!0,final:!0}),ee({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:a,transcriptions:[{text:i,settled:!0}],transaction:o}),a+=i.length,a>250){const e=Z({environment:this.env,parentBlockStore:t,siblingBlockStore:this.blockStore,transaction:o});this.setBlockStore(e),a=0}}const u=E({segments:n,forceSettled:e,indent:a>0});0!==u.length&&(u.forEach((e=>{let{text:t,settled:i}=e;this.logInsert({transactionId:o.id,text:t,index:a,settled:i,final:!1})})),ee({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:a,transcriptions:u,transaction:o}))}});s.catch((e=>{V(this.rootBlockId,e,{type:"transactionError",transactionId:a})}))}}function J(e){return v().createAndCommit({userAction:"dictationActions.createDictationBlock",environment:e.environment,canUndo:!1,perform:t=>Z({...e,transaction:t})})}function Z(e){var t,o;const{environment:n,parentBlockStore:r,siblingBlockStore:s,transaction:a}=e,c=(null==s?void 0:s.getDictationRoleModel())??i().xd.text,d=null===(t=O().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();if(n.device.isMobile&&!d&&!r.isTranscriptionBlock()){const e=S().insertBlockBelow({environment:n,selection:s?[s]:[],createBlockItem:k().ry[c],transaction:a,analyticsFrom:"dictation",preventSetSelection:!0});return f().setSelectionAtEnd({store:e.getBlockTitleStore()}),e}const l=r.isTranscriptionBlock()?null===(o=r.getContentStores().find((e=>{const t=r.getFormat().transcription_transcript_id;return e.id===t})))||void 0===o?void 0:o.getContentStore():r.getContentStore();if(!l)throw new Error("No parent dictation content store found");const u=m().Wv({environment:n,type:c,inMemoryRecordCache:r.inMemoryRecordCache,transaction:a});return p().NI({parentStore:l,childStore:x().B.createChildStore(l,u.pointer),after:null==s?void 0:s.id,transaction:a}),u}function ee(e){var t;const{environment:o,audioSessionId:i,blockStore:n,index:s,transcriptions:a,transaction:c}=e;if(!n.isDictatableBlock())return;const d=[],l=a.filter((e=>Boolean(e.text)));for(const[p,m]of l.entries()){const{text:e,settled:t}=m,o=p===l.length-1?e:`${e} `,n=t?(0,r().Ey_)(o):(0,r().Ey_)(o,[(0,r().lf7)(C().h5,i,m.segmentId)]);d.push(n)}g().yr({environment:o,index:s,store:n.getBlockTitleStore(),tokens:d,transaction:c,updateSelection:!1});const u=null===(t=O().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();o.device.isMobile&&!u&&f().setSelectionAtEnd({store:n.getBlockTitleStore()})}function te(e){return e.map((e=>e.getText())).filter((e=>Boolean(e))).join(" ").trim()}function oe(e){return new Promise(((t,o)=>{try{const i=new Blob(e),n=new FileReader;n.readAsDataURL(i),n.onloadend=()=>{var e;const i=null===(e=n.result)||void 0===e?void 0:e.toString().split(",")[1];i?t(i):o(new Error("No base64Audio"))}}catch(i){o(i)}}))}function ie(e,t,o){if((0,l().O9)(o)&&!o.pathIsDead()&&o.id!==t.id){const i=(0,_().Nq)(t),n=(0,_().Nq)(o);if((0,l().O9)(i)&&(0,l().O9)(n)&&i.id===n.id){const i=(0,_().g7)(o);if((()=>{for(const e of i)if(e instanceof x().B){if(e.id===t.id)return!0;if(e.id===n.id)return!1}return!1})()){const t=o.getParentBlockStore();if(o.isEmptyDictatableBlock()&&[...O().Ay.state.audioSessionBlockWriters.values()].every((e=>e.getBlockStore().id!==o.id)))return o;if(t)return J({environment:e,parentBlockStore:t,siblingBlockStore:o}).performResult}}}return J({environment:e,parentBlockStore:t}).performResult}class ne{static async getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),o=Math.floor(this.audioBuffer.length/t);if(o>0){const e=o*t,i=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>oe([new Float32Array(i)])))}return!1}static getDictationAudioRecorder(e){const{environment:t,includeSystemAudio:o,blockStore:i}=e,r=O().Ay.state.audioRecorder;r&&r.destroy();const s=I().default.checkGate({gateName:"meeting_notes_save_local_recordings"})&&i.isTranscriptionBlock();return new(R().Nr)({environment:t,onDataReceived:o=>{O().gZ.state&&(this.audioBuffer.push(...o),this.getAllProcessableFramesAsBase64(96).then((o=>{if(o){const r=(0,P().$q)((0,W().F)(t.currentUser.id));(0,h().$g)({base64Audio:o,environment:t,language:r}).catch((e=>{n().log({level:"error",from:"dictationActions",type:"sendAudioDataFailed",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:i.id}}})}));const s=O().ei.state;if(s&&s.isTranscriptionBlock()){"transcribing"!==(0,q().by)(s).state&&ae({environment:e.environment,from:"transcription_block_stopped"})}}})).catch((e=>{n().log({level:"error",from:"dictationActions",type:"audioRecorderFailed",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:i.id}}})})))},onStop:e=>{e&&n().log({level:"error",from:"dictationActions",type:"audioRecorderStopped",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:i.id}}}),ae({environment:t,error:e,from:"audio_recorder_stopped"})},includeSystemAudio:o,saveAudioFiles:s,blockId:i.id})}static get dictationIsActive(){return Boolean(this.startController&&!this.startController.signal.aborted)}static async smartToggleDictation(e){var t;const o=(0,b().ao)();return this.dictationIsActive&&(null===(t=O().Ay.state.rootBlock)||void 0===t?void 0:t.id)===(null==o?void 0:o.id)?this.stopDictation(e):this.startDictation(e)}static async startDictation(e){const{environment:t,blockStore:i,from:r}=e,a=i??(0,b().ao)(),l=null==a?void 0:a.isTranscriptionBlock();try{await this.stopDictation({environment:t,from:r}),this.startController=new AbortController;const i=this.startController.signal;let m;if(O().Ay.setState({...O().Ay.state,environment:t,tabId:t.device.isElectron?o(982254).A.state.currentTab.id:void 0,loading:!0}),e.preCreateDictationBlock&&a){const{performResult:e}=J({environment:t,parentBlockStore:a});m=e,await o(908006).default.afterNextFlush((()=>{f().setSelectionAtStart({store:e.getBlockTitleStore()})}))}const g=(0,h().qY)();(0,M().uB)(t,{dictation_session_id:g,from:r});if(!((null==a?void 0:a.isPageBlock())||(null==a?void 0:a.isCollectionViewPageWithContent())||l)||!(0,o(862835).h)()&&!(0,o(878377).xIn)())throw new Error("Target is not dictatable.");const v=this.getDictationAudioRecorder({...e,blockStore:a});de.start(a.id);try{var u;await v.start();const e=L().Ay.state;if(L().Ay.setState({...e,audio:L().a3}),i.aborted)throw new Error("start dictation aborted");const n=l?null===(u=U({environment:t,transcriptionBlockStore:a}))||void 0===u?void 0:u.getContentStores().at(-1):o(502438).default.state.stores.slice(-1).pop();await(0,y().Ez)(t),O().Ay.setState({...O().Ay.state,audioRecorder:v,enabled:!0,talking:!1,rootBlock:a,block:m??ie(t,a,n),lastReceivedTranscriptionAt:Date.now()}),(0,y().rJ)({environment:t,rootBlockId:(0,s().o9)(null==a?void 0:a.id)}),(0,y().UC)((()=>{(0,y().rJ)({environment:t,rootBlockId:(0,s().o9)(null==a?void 0:a.id)})})),(0,M().D_)(t,{dictation_session_id:g,block_id:a.id})}catch(p){if(!i.aborted)try{const{audio:o}=await L().Ay.checkPermissions(e.includeSystemAudio);(0,M().rP)(t,{type:"mic_permissions",dictation_session_id:g,reason:o})}catch(p){n().log({level:"error",from:"dictationActions",type:"checkPermissionsFailed",error:(0,d().convertErrorToLog)(p),data:{miscDataToConvertToString:{dictationSessionId:g,rootBlockId:a.id}}})}if(v.destroy((0,c().A)(p)),l){const{audio:t,screenRecording:o}=await L().Ay.checkPermissions(e.includeSystemAudio);throw n().log({level:"error",from:"dictationActions",type:"dictationFailedToStart",error:(0,d().convertErrorToLog)(p),data:{miscDataToConvertToString:{dictation_session_id:g,transcription_id:a.id,audioPermissions:t,screenRecordingPermissions:o}}}),V(a.id,p,{type:"dictationStartError",from:r}),p}}}catch(p){if(this.stopDictation({environment:t,from:"start_transcription_error",error:(0,c().A)(p)}),l)throw p}finally{O().Ay.setState({...O().Ay.state,loading:!1})}}static async stopDictation(e){const t=O().Ay.state.rootBlock;if((0,y().lW)(),this.startController&&!this.startController.signal.aborted){this.startController.abort();const{environment:r,error:s,from:a}=e,c=(0,h().qY)();if((0,M().E_)(r,{dictation_session_id:c,from:a}),(0,o(637368).isExplainableTranscriptionStopReason)(a)&&!s){const f=O().Ay.state.rootBlock;f&&u().pushToastInMainTab({toastId:"transcription_recording_stopped",pointer:f.pointer,from:a})}const l=O().Ay.state.tabId;function p(e){const{canRestart:i,name:n,title:s,message:a,notificationBody:c}=e;null!=t&&t.isTranscriptionBlock()&&(u().pushToastInMainTab({toastId:"transcription_error",pointer:t.pointer,tabId:l,title:s,message:a,name:n,canRestart:i}),(0,o(725081).sendNotificationForDictationInterrupted)({environment:r,blockStore:t,title:s,message:c||a,canRestart:i&&(null==t?void 0:t.isTranscriptionBlock()),tabId:l}))}const m=O().Ay.state.audioRecorder,g=O().Ay.state.enabled;O().Ay.setState({...O().Ay.state,audioRecorder:void 0,enabled:!1,loading:!1,rootBlock:void 0,block:void 0,tabId:void 0,lastReceivedTranscriptionAt:void 0}),null==m||m.destroy(s),s&&(n().log({level:"error",from:"dictationActions",type:"dictationError",error:(0,d().convertErrorToLog)(s),data:{miscDataToConvertToString:{dictation_session_id:c,block_id:(null==t?void 0:t.id)??""}}}),t&&V(t.id,s,{type:"dictationError",from:a}),s instanceof D().XG?((0,M().rP)(r,{type:"throttle",dictation_session_id:c}),(0,$().displayDictationUsageErrorSnackbar)()):s instanceof D().eY?((0,M().rP)(r,{type:"missing_user_or_space",dictation_session_id:c,reason:s.message}),(0,$().displayDictationGenericErrorSnackbar)()):s instanceof D().d1?((0,M().rP)(r,{type:"mic_permissions",dictation_session_id:c,reason:L().Ay.state.audio}),(0,$().displayDictationPermissionSnackbar)(C().JS)):s instanceof D().Rv?((0,M().rP)(r,{type:"forbidden",dictation_session_id:c}),p({canRestart:!1,name:s.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.title",defaultMessage:"Unable to transcribe"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.message",defaultMessage:"You do not have permission to run transcription."})})):s instanceof D().Dg?((0,M().rP)(r,{type:"upgrade_required",dictation_session_id:c}),p({canRestart:!1,name:s.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.title",defaultMessage:"You have used all of your free AI Meeting Notes minutes"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.message",defaultMessage:"Upgrade your workspace for full access to AI Meeting Notes."})})):s instanceof D().E6?p({canRestart:!0,name:s.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.title",defaultMessage:"Transcription paused"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.message",defaultMessage:"We are experiencing high demand. Please wait and try again."}),notificationBody:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.notification",defaultMessage:"We are experiencing high demand. Please wait and click to resume."})}):s instanceof Error&&p({canRestart:!0,name:s.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.title",defaultMessage:"Transcription paused"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.message",defaultMessage:"Something went wrong. Please try again."}),notificationBody:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.notification",defaultMessage:"Something went wrong. Please click to resume."})}));try{await(0,y().Ep)(r)}catch(i){}finally{de.stop(null==t?void 0:t.id);const v=O().Ay.state.audioSessionBlockWriters;let S=!1;for(const b of v.values())b.writeToBlock(!0),v.delete(b.getId()),S=!0;S&&O().Ay.emit(),g&&(0,M().Im)(r,{dictation_session_id:c,block_id:(null==t?void 0:t.id)??""}),null!=t&&t.isTranscriptionBlock()&&e.environment&&o(878337).transcriptionBlockActions.ensureTranscriptionIsInActive({environment:e.environment,blockStore:t,from:e.from})}}}}async function re(e){return ne.smartToggleDictation(e)}async function se(e){return ne.startDictation(e)}async function ae(e){const{environment:t,error:o,from:i}=e;return ne.stopDictation({environment:t,error:o,from:i})}async function ce(e){const t=w().default.state.currentSpaceStore;if(!t)return;const o={};for(const n of e){var i;const e=n.pointer,r=x().B.createChildStore(t,e);if(await r.load(),!r.isTranscriptionBlock()||r.id===(null===(i=O().Ay.state.rootBlock)||void 0===i?void 0:i.id))continue;const s=(0,q().y1)(r,"transcript");if(!s)continue;await s.load();const a=s.getContentStores().at(-1);a&&(await a.load(),o[e.id]={rootBlockStore:r,dictatingBlockStore:a})}O().Ay.setState({...O().Ay.state,passiveBlockMap:{...O().Ay.state.passiveBlockMap,...o}})}ne.startController=void 0,ne.audioBuffer=[],ne.audioEncoderQueue=new(a().O)(1);class de{constructor(){if(de.instance)return de.instance;de.instance=this}static start(e){Y(e,{type:"start"}),this.listening||(this.listening=!0,y().$I.on(y().Ux,de.processTranscriptionResult),y().$I.on(y().L6,de.processVadEvent),y().$I.on(y().bH,de.processRateLimitEvent),y().$I.on(y().zz,de.processForbiddenEvent),y().$I.on(y().gA,de.processUpgradeRequiredEvent),y().$I.on(y().YE,de.processFreeTrialLimitEvent),y().$I.on(y().ZQ,de.processOpenAIErrorEvent))}static stop(e){e&&Y(e,{type:"stop"}),this.listening&&(this.listening=!1,y().$I.off(y().Ux,de.processTranscriptionResult),y().$I.off(y().L6,de.processVadEvent),y().$I.off(y().bH,de.processRateLimitEvent),y().$I.off(y().zz,de.processForbiddenEvent),y().$I.off(y().gA,de.processUpgradeRequiredEvent),y().$I.off(y().YE,de.processFreeTrialLimitEvent),y().$I.off(y().ZQ,de.processOpenAIErrorEvent))}static processOpenAIErrorEvent(e){if(429===e.status||503===e.status){var t;const{environment:o}=O().Ay.state;o&&ae({environment:o,error:new(D().E6)(e.message,e.status),from:"transcription_error"}),n().log({level:"error",from:"dictationActions",type:"openAIError",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=O().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}}static processForbiddenEvent(e){var t;const{environment:o}=O().Ay.state;o&&ae({environment:o,error:new(D().Rv)("Not eligible for dictation"),from:"forbidden"}),n().log({level:"error",from:"dictationActions",type:"forbidden",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=O().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processFreeTrialLimitEvent(e){T().W.setState({type:"available",usage:e.currentS,limit:e.limitS})}static processUpgradeRequiredEvent(e){var t,o,i;const{environment:r}=O().Ay.state;T().W.setState({type:"unavailable"}),r&&ae({environment:r,error:new(D().Dg)("Free usage used up, workspace upgrade is required"),from:"upgrade_required"}),n().log({level:"info",from:"dictationActions",type:"upgrade_required",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=O().Ay.state.rootBlock)||void 0===t?void 0:t.id,userId:null===(o=w().default.state.currentUserStore)||void 0===o?void 0:o.id,spaceId:null===(i=w().default.state.currentSpaceStore)||void 0===i?void 0:i.id}}})}static processRateLimitEvent(e){var t;const{environment:o}=O().Ay.state;T().W.setState({type:"rateLimited",retryAfterSec:e.retryAfterSec}),o&&ae({environment:o,error:new(D().XG)("Audio usage limit reached"),from:"rate_limit"}),n().log({level:"error",from:"dictationActions",type:"rateLimit",error:(0,d().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=O().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processVadEvent(e){O().Ay.setState({...O().Ay.state,talking:e.talking})}static updateDictationBlock(e){O().Ay.setState({...O().Ay.state,block:e})}static processTranscriptionResult(e){const{audioSessionId:t,segmentId:i,isSegmentComplete:n,isAudioSessionComplete:r,transcription:s}=e,{enabled:a,rootBlock:c,audioSessionBlockWriters:d,environment:l,block:u}=O().Ay.state;"complete"===s.status&&null!=c&&c.isTranscriptionBlock()&&l&&((0,o(2220).u)({environment:l,event:{eventName:"meeting_note_transcription_received",eventProperties:{block_id:c.id,audio_duration:s.audioDuration,text_length:s.text.length}}}),Y(c.id,{type:"transcription",status:s.status,sessionId:t,isSessionComplete:r,segmentId:i,isSegmentComplete:n,transcriptionId:s.id,text:s.text}));let p=!1;if(!d.has(t)&&l&&a)if(c){const e=ie(l,c,u),o=new Q({id:t,env:l,rootBlockId:c.id,blockStore:e,onUpdateBlock:e=>{t===O().Ay.state.latestSessionId&&de.updateDictationBlock(e)}});d.set(t,o),p=!0,O().Ay.setState({...O().Ay.state,block:e,latestSessionId:t})}else ae({environment:l,from:"block_not_available"});const m=d.get(t);if(m){m.setIsCompleteReceived(r);const e=m.getOrCreateSegment(i);e.setIsCompleteReceived(n),e.setTranscription(s.id,s)}for(const o of d.values())o.writeToBlock();for(const o of[...d.values()].filter((e=>e.isSettled())))d.delete(o.getId()),p=!0,a&&l&&c&&O().Ay.state.latestSessionId===o.getId()&&O().Ay.setState({...O().Ay.state,block:ie(l,c,O().Ay.state.block)});a&&O().Ay.setState({...O().Ay.state,lastReceivedTranscriptionAt:Date.now()}),p&&O().Ay.emit()}}de.instance=void 0,de.listening=!1;class le{static getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),o=Math.floor(this.audioBuffer.length/t);if(o>0){const e=o*t,i=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>oe([i])))}return Promise.resolve(!1)}static async start(e){try{await this.stop(),this.startController=new AbortController,this.env=e.environment,this.isActive=!0,this.currentTranscript="",this.segments.clear(),this.transcriptionListener=e.onTranscription,this.onErrorListener=e.onError,this.streamingSessionId=(0,h().qY)(),this.audioRecorder=new(R().Nr)({environment:e.environment,onDataReceived:t=>{this.audioBuffer=new Float32Array([...this.audioBuffer,...t]),this.getAllProcessableFramesAsBase64(96).then((t=>{if(t){const o=(0,P().$q)((0,W().F)(e.environment.currentUser.id));(0,h().$g)({base64Audio:t,environment:e.environment,language:o}).catch((()=>{}))}})).catch((()=>{}))},onStop:()=>{le.stop()},includeSystemAudio:!1}),await this.audioRecorder.start(),y().$I.on(y().Ux,this.handleTranscriptionEvent)}catch(t){this.onErrorListener&&t instanceof Error&&this.onErrorListener(t),this.stop()}}static async stop(){if(this.isActive){var e;this.isActive=!1,this.startController&&!this.startController.signal.aborted&&this.startController.abort(),y().$I.off(y().Ux,this.handleTranscriptionEvent),null===(e=this.audioRecorder)||void 0===e||e.destroy();try{await(0,y().Ep)(this.env)}catch{}this.audioRecorder=void 0,this.streamingSessionId=void 0,this.env=void 0}}}X=le,le.startController=void 0,le.env=void 0,le.audioBuffer=new Float32Array,le.audioEncoderQueue=new(a().O)(1),le.audioRecorder=void 0,le.streamingSessionId=void 0,le.isActive=!1,le.transcriptionListener=void 0,le.onErrorListener=void 0,le.segments=new Map,le.currentTranscript="",le.handleTranscriptionEvent=e=>{var t;const o=e.segmentId;let i=X.segments.get(o);i||(i=new B(o),X.segments.set(o,i)),i.setIsCompleteReceived(e.isSegmentComplete),i.setTranscription(e.transcription.id,e.transcription);const n=te(Array.from(X.segments.values()));X.currentTranscript=n,null===(t=X.transcriptionListener)||void 0===t||t.call(X,X.currentTranscript)}},870991:(e,t,o)=>{o.d(t,{bB:()=>r});o(16280),o(816573),o(878100),o(177936),o(748140),o(821903),o(491134),o(128845),o(237467),o(444732),o(979577),o(814603),o(147566),o(198721);class i{constructor(){this.remoteMeetingNotesWorker=o(681335).LV(new Worker(new URL(o.p+o.u(81561),o.b),{type:void 0}))}async readBuffer(e){return this.remoteMeetingNotesWorker.readBuffer(e)}async write(e,t){return this.remoteMeetingNotesWorker.write(e,t)}async close(){return this.remoteMeetingNotesWorker.close()}async delete(e){return this.remoteMeetingNotesWorker.delete(e)}async deleteAll(e){return this.remoteMeetingNotesWorker.deleteAll(e)}async listFiles(e){return this.remoteMeetingNotesWorker.listFiles(e)}async listFilesForUserAndBlock(e){return this.remoteMeetingNotesWorker.listFiles(`${e.userId}__${e.blockId}`)}async trimCache(e){const t=await this.listFiles();t.sort(((e,t)=>t.lastModified-e.lastModified));const o=t.slice(e);for(const i of o)await this.delete(i.name)}async enableDebug(){return this.remoteMeetingNotesWorker.enableDebug()}async disableDebug(){return this.remoteMeetingNotesWorker.disableDebug()}async download(e){const t=(0,o(631616).h1)(e);if(t instanceof Error)throw t;const i=await this.remoteMeetingNotesWorker.readBuffer(e);if("PCM_F32_16000_MONO"!==t.fileType)throw new Error(`Unsupported file type: ${t.fileType}`);{const e=function(e){const{audioBuffer:t,sampleRate:o,numChannels:i,bitDepth:n}=e,r=i*(n/8),s=new ArrayBuffer(44),a=new DataView(s),c=(e,t,o)=>{for(let i=0;i<o.length;i++)e.setUint8(t+i,o.charCodeAt(i))};c(a,0,"RIFF"),a.setUint32(4,36+t.byteLength,!0),c(a,8,"WAVE"),c(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,3,!0),a.setUint16(22,i,!0),a.setUint32(24,o,!0),a.setUint32(28,o*r,!0),a.setUint16(32,r,!0),a.setUint16(34,n,!0),c(a,36,"data"),a.setUint32(40,t.byteLength,!0);const d=new Uint8Array(s.byteLength+t.byteLength);return d.set(new Uint8Array(s),0),d.set(new Uint8Array(t),s.byteLength),d.buffer}({audioBuffer:i,sampleRate:16e3,numChannels:1,bitDepth:32}),t=new Blob([e],{type:"audio/wav"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`audio_recording_${Date.now()}.wav`,n.click(),URL.revokeObjectURL(o)}}}let n;function r(){return n||(new URL(o(277681),o.b).origin===window.location.origin?(n=new i,n):void 0)}(0,o(604341).exposeDebugValue)("OPFSMeetingNotesCache",r())},878337:(e,t,o)=>{o.r(t),o.d(t,{CurrentlyListeningTranscriptionBlockIndicator:()=>et,DictationAvatar:()=>q,DictationBubble:()=>Y,StopDictationButton:()=>_e,StopDictationButtonMobile:()=>De,StopDictationListener:()=>Le,TranscriptionSetupModal:()=>Ge,activeTranscriptionHelpers:()=>a(),audioProcessDetectionActions:()=>s(),dictationActions:()=>n(),hooks:()=>k(),idleTranscriptionActions:()=>i,transcriptionBlockActions:()=>r(),transcriptionErrorActions:()=>b(),transcriptionNewPageActions:()=>c(),transcriptionNotificationActions:()=>S()});var i={};o.r(i),o.d(i,{showIdleTranscriptionToast:()=>y});var n=()=>o(870193),r=()=>o(271380),s=()=>o(725081),a=()=>o(911063),c=()=>o(391532),d=()=>o(284611),l=()=>o(381349),u=()=>o(812182),p=()=>o(2220),m=()=>o(972435),g=()=>o(765957),f=()=>o(630116),v=()=>o(239837),h=()=>o(432142);function y(e,t){const{pointer:o}=t,i=g().AppStoreCurrentSpaceStore.state;if(!i)return;const n=f().Bv.createChildStore(i,o);null!=n&&n.isTranscriptionBlock()&&"transcribing"===(0,v().by)(n).state&&((0,p().u)({environment:e,event:{eventName:"idle_transcription_toast_shown",eventProperties:{block_id:n.id}}}),u().Iz({id:"transcription_idle_notification",icon:()=>(0,d().b)({color:l().Ay.invertedTextColor,height:16,width:16}),presentationType:"persistent",title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.title",defaultMessage:"Still there?"}),message:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.message",defaultMessage:"Notion AI is recording your audio but hasn't heard from you in a while."}),onDismiss:()=>{(0,p().u)({environment:e,event:{eventName:"idle_transcription_toast_dismissed",eventProperties:{block_id:n.id}}})},actions:{primary:{title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.stop",defaultMessage:"Stop"}),onAction:()=>{(0,h().K)({environment:e,blockStore:n}),(0,r().stopTranscription)({environment:e,blockStore:n,from:"transcription_idle_notification"}),u().UW("transcription_idle_notification"),(0,p().u)({environment:e,event:{eventName:"idle_transcription_toast_stop_button_clicked",eventProperties:{block_id:n.id}}})}},secondary:{title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.goToBlock",defaultMessage:"Go to meeting note"}),onAction:()=>{u().UW("transcription_idle_notification"),(0,h().K)({environment:e,blockStore:n}),(0,p().u)({environment:e,event:{eventName:"idle_transcription_toast_navigation_button_clicked",eventProperties:{block_id:n.id}}})}}}}))}var S=()=>o(637368),b=()=>o(491396),k=()=>o(673657),A=(o(581454),o(296540)),_=()=>o(56366),w=()=>o(496603),I=()=>o(614415),x=()=>o(645873),T=()=>o(964345),M=()=>o(484714),B=()=>o(401497),C=()=>o(959013),D=()=>o(620689),R=()=>o(783793),E=()=>o(704152),j=()=>o(859428),P=()=>o(126126),N=o(474848);const F=18;function q(e){let{enableClickToScroll:t=!1,rootStore:o,noMarginRight:i=!1,noOutline:n=!1,noTooltip:r=!1}=e;const s=(0,k().useIsDictatingToPage)(o),a=(0,M().v3)(),c=(0,A.useCallback)((e=>e.UIUserAvatarSelfBorder),[]),d=(0,P().XE)(c,!0),l=(0,B().IS)((e=>({tooltip:{color:e.text.contrastSecondary,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},avatarContainer:{width:F,height:F,borderRadius:F,backgroundColor:e.assistantCornerButtonBackground,display:"flex",alignItems:"center",justifyContent:"center"}})),[]),u=(0,_().K8)((()=>T().b.state),[]);return!s&&o?null:(0,N.jsx)(j().A,{textWrap:!0,disableTooltip:r,renderTooltip:()=>(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{children:(0,N.jsx)(C().sA,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,N.jsx)("div",{style:l.tooltip,children:(0,N.jsx)(C().sA,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const o=(0,N.jsx)("div",{style:{...d.avatarOuterOutline,...n?{outline:"none"}:{},...i?{marginRight:0}:{},width:F,height:F},children:(0,N.jsx)("div",{style:{...d.avatarBorder,...l.avatarContainer},children:(0,N.jsx)(R().o,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"})})});return t&&u?(0,N.jsx)(E().A,{...e,onClick:()=>D().BL([u],!0,a),style:d.button,hoveredStyle:d.buttonHovered,pressedStyle:d.buttonPressed,children:o}):(0,N.jsx)("div",{...e,style:{cursor:"default"},children:o})}})}o(944114),o(898992),o(803949);var L=()=>o(534177),O=()=>o(171333),W=()=>o(141333);function U(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(U(e))})),t}function $(e){let{scrollerStore:t,blockId:o,children:i,framerMotion:n}=e;const r=(0,_().K8)((()=>t.state.elementRef??{current:null}),[t]),s=(0,W().yE)(r),[a,c]=(0,A.useState)(),[d,l]=(0,A.useState)(),u=(0,O().lB)(t),p=(0,O().ht)(t),m=null==u?void 0:u.getNode(),g=null==m?void 0:m.querySelector(".notion-page-content"),f=null==g?void 0:g.querySelector(`[data-block-id="${o}"]`);(0,A.useEffect)((()=>{if(g){let e;const t=new MutationObserver((t=>{(0,L().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(g,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,L().O9)(e)&&cancelAnimationFrame(e)}}}),[g]),(0,A.useEffect)((()=>{if(m){let e;const t=new ResizeObserver((()=>{(0,L().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(m),()=>{t.disconnect(),(0,L().O9)(e)&&cancelAnimationFrame(e)}}}),[m]),(0,A.useLayoutEffect)((()=>{if(!f||!m){const e=setTimeout((()=>{l(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=f.querySelector('[data-content-editable-leaf="true"]')??f,o=U(t),i=m.getBoundingClientRect();if(o.length>0){const t=o[o.length-1];e.selectNodeContents(t),e.collapse(!1);const n=e.getBoundingClientRect(),r=n.top+s-i.top,a=n.right-i.left+5;l({top:r,left:a})}else{const e=t.getBoundingClientRect(),o=window.getComputedStyle(t),n=parseInt(o.paddingTop,10),r=isNaN(n)?0:n,a=parseInt(o.paddingBottom,10),c=isNaN(a)?0:a,d=parseInt(o.paddingRight,10),u=isNaN(d)?0:d,p=e.top+r+c+s-i.top,m=e.left-i.left+u;l({top:p,left:m})}}}),[f,m,a,s]);const v=(0,L().O9)(d);(0,A.useEffect)((()=>{if(p&&v)switch(p){case"Page":return T().Ay.setState({...T().Ay.state,blockRenderedInPage:!0}),()=>{T().Ay.setState({...T().Ay.state,blockRenderedInPage:!1})};case"PeekView":return T().Ay.setState({...T().Ay.state,blockRenderedInPeekView:!0}),()=>{T().Ay.setState({...T().Ay.state,blockRenderedInPeekView:!1})}}}),[p,v]);const h=(0,A.useRef)(null),{motion:y}=n;return d?(0,N.jsx)(y.div,{ref:h,initial:{transform:`translate(${d.left}px, ${d.top}px)`},animate:{transform:`translate(${d.left}px, ${d.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:112},children:i}):null}function z(e){const{value:t}=(0,x().fJ)(I().fM);return t?(0,N.jsx)($,{...e,framerMotion:t}):null}function H(e){const{framerMotion:t}=e,{motion:o}=t,i=(0,I().sM)(t);(0,A.useEffect)((()=>{(async()=>{await i.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[i]);const n=(0,B().IS)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,N.jsx)(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,N.jsx)(o.div,{custom:t,animate:i,style:n.dotStyle},t)))})}function K(){const{value:e}=(0,x().fJ)(I().fM);return e?(0,N.jsx)(H,{framerMotion:e}):null}function Y(e){let{scrollerStore:t}=e;const o=(0,_().K8)((()=>{const e=T().Ay.state.block&&T().Ay.state.rootBlock?[{type:"active",rootBlockId:T().Ay.state.rootBlock.id,id:T().Ay.state.block.id}]:[],t=Object.values(T().Ay.state.passiveBlockMap).map((e=>{let{dictatingBlockStore:t,rootBlockStore:o}=e;return{type:"passive",rootBlockId:o.id,id:t.id}}));return w().hS([...e,...t],"id")}),[]),i=(0,_().O$)(T().Gq),n=(0,_().O$)(T().Mq),{value:r}=(0,x().fJ)(I().fM);if(!r)return null;const{AnimatePresence:s}=r;return(0,N.jsx)(N.Fragment,{children:o.map((e=>(0,N.jsx)(z,{blockId:e.id,scrollerStore:t,children:(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,N.jsx)(q,{noMarginRight:!0,noOutline:!0,noTooltip:!0}),(0,N.jsx)(s,{children:(i||n)&&(0,N.jsx)(K,{})})]})},e.rootBlockId)))})}var V=o(440961),X=()=>o(883234),G=()=>o(197190),Q=()=>o(406699),J=()=>o(745766),Z=()=>o(592678),ee=()=>o(463830),te=()=>o(948914),oe=()=>o(712505),ie=()=>o(405689),ne=()=>o(742117),re=()=>o(133033),se=()=>o(284371),ae=()=>o(493823),ce=()=>o(760217),de=()=>o(939740),le=()=>o(89924),ue=()=>o(276600),pe=()=>o(426175),me=()=>o(524007),ge=()=>o(805952),fe=()=>o(38337),ve=()=>o(865060),he=()=>o(74e3);function ye(e){const t=(0,M().v3)(),{parent:o}=e,i=(0,_().K8)((()=>Object.keys(ge().Cu).indexOf((0,ue().F)(t.currentUser.id))),[t.currentUser.id]),n=[{key:"languages",render:e=>(0,N.jsx)(le().A,{...e,topBorder:0!==e.index}),items:(0,he().u1)().map((e=>{let[i,[n]]=e;const r={key:i,render:e=>(0,N.jsx)(ce().A,{...e,title:n}),action:()=>{(0,ve().X)(t,i),o.close()}};return r}))}];return(0,N.jsx)("div",{className:fe().OLz,style:{display:"flex",flexDirection:"column",minWidth:150,maxWidth:"max-content"},children:(0,N.jsx)(de().Ay,{type:de().Oh.Vertical,initialFocus:i,sections:n})})}function Se(e){const{languagePopupStore:t}=e,o=(0,M().v3)(),i=(0,_().K8)((()=>(0,ue().F)(o.currentUser.id)),[o.currentUser.id]);(0,A.useEffect)((()=>{pe().Ay.updateMediaDevices()}),[]);const n=(0,B().IS)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:se().Wy.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),r=(0,A.useMemo)((()=>(0,ne().V)(n.rightChevronStyle)),[n.rightChevronStyle]),s=(0,A.useMemo)((()=>(0,re().$)(n.helpIcon)),[n.helpIcon]),{value:a}=(0,x().fJ)(I().fM);if(!a)return null;const{motion:c}=a;return(0,N.jsxs)("div",{style:n.container,children:[(0,N.jsxs)("div",{style:n.microphoneSection,children:[(0,N.jsx)("div",{style:n.microphoneText,children:"Microphone"}),(0,N.jsx)(be,{})]}),(0,N.jsx)("div",{style:n.line}),(0,N.jsxs)("div",{style:n.languageSection,children:[(0,N.jsx)("div",{style:n.languageText,children:"Language"}),(0,N.jsx)(Q().Ay,{buttonPopupStore:t,renderOrigin:e=>(0,N.jsxs)(ae().p,{style:n.languageButtonStyle,...e,children:[i," ",r]}),stopClickPropagation:!0,popupType:Q().z7.Popup,render:e=>(0,N.jsx)(ye,{parent:e})})]}),(0,N.jsx)("div",{style:n.line}),(0,N.jsxs)(c.div,{style:n.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[s,(0,N.jsx)("div",{style:n.helpText,children:"Learn about Dictation"})]})]})}function be(){const e=(0,_().O$)(pe().X8),t=(0,_().O$)(pe().dc),o=(0,_().K8)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),i=[{key:"devices",render:e=>(0,N.jsx)(le().A,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:o=>(0,N.jsx)(ce().A,{...o,title:e.label,isChecked:e.deviceId===(null==t?void 0:t.deviceId)}),action:()=>{me().d.setState(e)}})))}];return(0,N.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,N.jsx)(de().Ay,{type:de().Oh.Vertical,initialFocus:o,sections:i})})}const ke=document.body;function Ae(e){let{rootStore:t,framerMotion:o}=e;const i=(0,M().WS)(),r=(0,k().useIsDictatingToPage)(t),s=(0,M().v3)(),a=(0,_().K8)((()=>T().Ay.state.audioRecorder),[]),c=(0,_().uB)(void 0,ee().A),d=(0,_().uB)(void 0,ee().A),l=(0,_().O$)(te().b),u=(0,A.useCallback)((()=>{(0,n().stopDictation)({environment:s,from:"button"})}),[s]),p=(0,A.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,Z().Vt)(e)||(d.state.open?d.reset():c.state.open?c.reset():c.setState({...c.state,open:!0}))}),[c,d]),m=(0,_().K8)((()=>"dark"===s.ThemeStore.state.mode),[s]),[g,f]=(0,A.useState)(!1),v=(0,A.useCallback)((()=>{f(!0)}),[]),h=(0,A.useCallback)((()=>{f(!1)}),[]),[y,S]=(0,A.useState)(!1),b=(0,A.useCallback)((()=>{S(!0)}),[]),w=(0,A.useCallback)((()=>{S(!1)}),[]),I=(0,B().IS)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:m?"#2D2D2D":"#F1F0EF",...(0,J().g)({noDrag:s.device.isElectron&&!l})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:y?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:g?m?e.palette.red[500]:"rgba(191, 67, 64, 1)":m?e.palette.red[700]:e.palette.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[m,s.device.isElectron,l,y,g]),x=(0,A.useMemo)((()=>(0,X()._)(I.downIcon)),[I.downIcon]),C=(0,_().K8)((()=>{var e;return oe().default.isCenterPeekOpen()&&(null===(e=oe().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),D=(0,A.useRef)(null),[R,E]=(0,A.useState)(null);(0,A.useEffect)((()=>{if(!D.current)return void E(null);const e=D.current.getBoundingClientRect();E({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[C]);const j=(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(G().A,{style:I.redSquareContainer,onClick:u,onMouseEnter:v,onMouseLeave:h,children:(0,N.jsx)("div",{style:I.redSquare})}),t?(0,N.jsx)(ie().t,{rootBlockId:null==t?void 0:t.id}):void 0,(0,N.jsx)(G().A,{className:"notion-dictation-button-up-chevron",style:I.downChevronContainer,onClick:p,onMouseEnter:b,onMouseLeave:w,children:x})]}),F=(0,P().Uo)({environment:s,isShowingTabBar:l,isShowingInPostFeed:!1}),{motion:q}=o;return r&&a&&!i?(0,N.jsx)("div",{style:{marginLeft:F.marginLeft,marginTop:F.marginTop,marginRight:.5*Number(F.marginLeft)*-1},children:(0,N.jsx)(Q().Ay,{buttonPopupStore:c,renderOrigin:()=>(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(q.div,{ref:D,className:"notion-dictation-button",style:I.dictationButtonStyle,onClick:u,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:j}),C&&(0,V.createPortal)((0,N.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...I.dictationButtonStyle,position:"fixed",top:(null==R?void 0:R.top)||0,left:(null==R?void 0:R.left)||0,zIndex:1e7},onClick:u,children:j}),ke)]}),stopClickPropagation:!0,popupType:s.device.isMobile?Q().z7.SlideUp:Q().z7.Popup,popupWrapStyle:{top:6},render:()=>(0,N.jsx)(Se,{languagePopupStore:d})})}):null}function _e(e){const{value:t}=(0,x().fJ)(I().fM);return t?(0,N.jsx)(Ae,{...e,framerMotion:t}):null}const we=(0,o(340498).wt)("stopDictation",{viewBox:"0 0 36 36",svg:(0,N.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,N.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,N.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var Ie=()=>o(140862),xe=()=>o(575301),Te=()=>o(607859),Me=()=>o(991699),Be=()=>o(110750),Ce=()=>o(594635);function De(){const e=(0,M().v3)(),{isMobileNative:t,isPhone:o}=(0,M().Y0)(),i=(0,_().K8)((()=>{const e=Te().default.state.isOnboarding,t=Me().A.state.open;return e||t}),[]),r=(0,_().K8)((()=>{var e;return!i&&T().Ay.getState().enabled&&!T().Ay.getState().loading&&!(null!==(e=T().Ay.getState().rootBlock)&&void 0!==e&&e.isTranscriptionBlock())}),[i]),s=(0,A.useCallback)((()=>{(0,n().stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,A.useEffect)((()=>{i&&s()}),[i,s]),function(e){const t=(0,_().O$)(Ce().A);(0,A.useEffect)((()=>{t&&(e(),Ce().A.reset())}),[t,e])}(s),function(e){const t=(0,M().v3)(),o=(0,_().K8)((()=>{const e=T().kj.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),i=(0,_().K8)((()=>!T().Y$.state&&T().gZ.state),[]),n=(0,_().O$)(T().ei),r=(0,A.useRef)(!0),s=(0,_().K8)((()=>(0,Be().Xz)(t.TabbedRouterStore.state)),[t]);(0,A.useEffect)((()=>{(0,L().O9)(o)&&o&&e()}),[o,e]),(0,A.useEffect)((()=>{if(i&&(0,L().O9)(n)&&!n.isTranscriptionBlock()){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[i,e,n]),(0,A.useEffect)((()=>{t.device.isMobileNative&&s&&(r.current?r.current=!1:e())}),[t,s,r,e])}(s),r&&t&&o?(0,N.jsx)(Re,{handleClick:s}):null}function Re(e){const{handleClick:t}=e,o=(0,M().v3)(),i=(0,Ie().A)(!0);!function(){const{mobileNative:e}=(0,M().v3)();(0,A.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const n=(0,xe().o_)(),[r,s]=(0,_().K8)((()=>[o.WindowSizeStore.getSafePaddingLeftPx(16),o.WindowSizeStore.getSafePaddingRightPx(16)]),[o.WindowSizeStore]),a=(0,B().IS)((e=>({container:{position:"absolute",width:"100%",bottom:n,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:s,paddingLeft:r,border:`1px solid ${e.stroke.secondary}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground}})),[n,r,s]),c=(0,A.useMemo)((()=>we({width:36,height:36,...a.icon})),[a.icon]),d=(0,_().O$)(T().Di);return(0,N.jsx)("div",{style:{...a.container,zIndex:1e7},...i,children:(0,N.jsxs)("div",{className:"notion-dictation-button",style:{...a.dictationButtonStyle},children:[(0,N.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:d?(0,N.jsx)(ie().t,{fillWidth:!0,rootBlockId:d}):void 0}),(0,N.jsx)("div",{onClick:t,children:c})]})})}var Ee=()=>o(857639),je=()=>o(874913),Pe=()=>o(615234),Ne=()=>o(866515),Fe=()=>o(249696);const qe=(0,C().YK)({title:{id:"stopDictationListener.notification.title",defaultMessage:"Meeting note stopped due to inactivity"},body:{id:"stopDictationListener.notification.body",defaultMessage:"Notion AI could not detect your audio for a while"}});function Le(){const e=(0,M().v3)(),t=(0,C().tz)(),o=(0,_().K8)((()=>T().Ay.state.tabId),[]),i=(0,_().O$)(T().ei),s=(0,_().K8)((()=>(0,L().O9)(i)&&i.isTranscriptionBlock()),[i]),a=(0,_().K8)((()=>{const e=T().kj.state;if(e&&e.isDefined())return!e.isDictatableBlock()||e.pathIsDead()}),[]),c=(0,_().K8)((()=>!T().Y$.state),[]);(0,A.useEffect)((()=>{var t,o,i,r;(0,L().O9)(a)&&a&&(Ee().log({level:"info",from:"stopDictationListener",type:"block_not_dictatable",data:{miscDataToConvertToString:{rootBlockId:null===(t=T().ei.state)||void 0===t?void 0:t.id,dictationBlockId:null===(o=T().kj.state)||void 0===o?void 0:o.id,isDictatableBlock:(null===(i=T().kj.state)||void 0===i?void 0:i.isDictatableBlock())??"undefined",isDictationBlockPathDead:(null===(r=T().kj.state)||void 0===r?void 0:r.pathIsDead())??"undefined"}}}),(0,n().stopDictation)({environment:e,from:"block_not_dictatable"}))}),[a,e]),(0,A.useEffect)((()=>{if(c&&!s){const t=setTimeout((()=>{c||(0,n().stopDictation)({environment:e,from:"block_not_visible"})}),350);return()=>{clearTimeout(t)}}}),[c,s,e]);const d=function(){const e=(0,Fe().W)(),t=(0,_().O$)(T().ei),[o,i]=(0,A.useState)(void 0),n=(0,A.useCallback)((()=>{if(null==t||!t.isTranscriptionBlock())return;const e=T().Ay.state.lastReceivedTranscriptionAt;if(!e)return;const o=Date.now()-e;o>=15*Pe().Xb?i("should_stop"):o>=Number(Pe().Xb)?i("should_notify"):i(void 0)}),[t]);return(0,Ne().n)(n,20*Pe().TD,Boolean(e&&t)),o}();return(0,A.useEffect)((()=>{if(d&&null!=i&&i.isTranscriptionBlock()&&("should_notify"===d&&je().pushToastInMainTab({toastId:"transcription_idle",pointer:i.pointer}),"should_stop"===d)){(0,r().stopTranscription)({environment:e,blockStore:i,from:"transcription_idle"});new Notification(t.formatMessage(qe.title),{body:t.formatMessage(qe.body),silent:!1}).addEventListener("click",(()=>{(0,h().N)({environment:e,blockStore:i,tabId:o})}))}}),[d,e,o,i,t]),null}o(354520);var Oe=()=>o(148307),We=()=>o(187174),Ue=()=>o(209969),$e=()=>o(297872),ze=()=>o(807683),He=()=>o(676007),Ke=()=>o(204063),Ye=()=>o(431895),Ve=()=>o(748197);const Xe=(0,C().YK)({transcriptionSetupModal:{id:"transcriptionBlock.transcriptionSetupModal.ariaLabel",defaultMessage:"AI Meeting Notes Setup"},getStarted:{id:"transcriptionBlock.transcriptionSetupModal.getStarted",defaultMessage:"AI Meeting Notes Setup"},setupDescription:{id:"transcriptionBlock.transcriptionSetupModal.setupDescription",defaultMessage:"One-time setup to capture notes effortlessly."},imageAlt:{id:"transcriptionBlock.transcriptionSetupModal.imageAlt",defaultMessage:"AI Meeting Notes setup image"}});function Ge(){const e=(0,M().Y0)(),t=(0,_().K8)((()=>Ve().c.state.transcriptionSetupModalOpen&&e.isElectron),[e]);return(0,N.jsx)(He().a,{ariaLabel:m().A.formatMessage(Xe.transcriptionSetupModal),open:t,render:()=>(0,N.jsx)(Qe,{}),transitionAppearance:"none",onDismiss:()=>{Ve().c.closeTranscriptionSetupModal()}})}function Qe(){const e=(0,B().IS)((e=>({wrapper:{display:"flex",flexDirection:"column",width:"100%",maxWidth:480,border:`1px solid ${e.regularDividerColor}`,borderRadius:12},header:{display:"flex",flexDirection:"column",gap:4,padding:"20px 25px 5px",backgroundColor:e.fill.lightGrayTertiary},title:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:24,fontWeight:600,color:e.text.primary},description:{marginBottom:15,fontSize:17,lineHeight:"24px",color:e.text.secondary},body:{display:"flex",flexDirection:"column",gap:8,padding:"25px 25px 20px",borderRadius:12,position:"relative"},controlRowContainerInvertedBorder:{backgroundColor:e.fill.lightGrayTertiary}})),[]),t=(0,M().v3)(),[o]=(0,A.useState)((0,Ye().xw)()),[i,n]=(0,A.useState)([]),[r,s]=(0,A.useState)(!1),[a]=(0,We().Yb)((async()=>{let e,r=i;const s=o.filter((e=>!i.includes(e.id)));for(const o of s){const n=await o.hasCompleted({environment:t,isConfirmation:!1});n&&!i.includes(o.id)&&(r=[...r,o.id]),n||e||(e=o)}return n(r),e}),[t,o,i]);return(0,A.useEffect)((()=>{if(a.value&&r){const e=setInterval((async()=>{const o=a.value;if(!o)return void clearInterval(e);await o.hasCompleted({environment:t,isConfirmation:!0})&&(n([...i,o.id]),clearInterval(e))}),3e3);return()=>{clearInterval(e)}}}),[a,t,r,i]),(0,N.jsx)($e().A,{capture:!0,allowUndo:!1,allowEsc:!0,allowTabUntab:!1,render:n=>(0,N.jsxs)("div",{...n,style:e.wrapper,children:[(0,N.jsxs)("div",{style:e.header,children:[(0,N.jsx)("div",{style:e.title,children:(0,N.jsx)(C().sA,{...Xe.getStarted})}),(0,N.jsx)("div",{style:e.description,children:(0,N.jsx)(C().sA,{...Xe.setupDescription})})]}),(0,N.jsxs)("div",{style:e.body,children:[(0,N.jsx)("div",{style:{...e.controlRowContainerInvertedBorder,width:"16px",height:"16px",position:"absolute",top:0,left:0,clipPath:"path('M16 0C7.16344 0 0 7.16344 0 16V0H16Z')"}}),(0,N.jsx)("div",{style:{...e.controlRowContainerInvertedBorder,width:"16px",height:"16px",position:"absolute",top:0,right:0,clipPath:"path('M0 0C8.83656 0 16 7.16344 16 16V0H0Z')"}}),o.map((e=>{var o,n;return(0,N.jsx)(Je,{step:e,isCompleted:i.includes(e.id),isFirstIncompleteStep:(null===(n=a.value)||void 0===n?void 0:n.id)===e.id,onAction:()=>{e.action({environment:t,isConfirmation:!1}),(0,p().u)({environment:t,event:{eventName:"transcription_block_setup_modal_action_clicked",eventProperties:{step:e.id}}}),s(!0)}},`${e.id}-${null===(o=a.value)||void 0===o?void 0:o.id}`)}))]})]})})}function Je(e){const{step:t,isFirstIncompleteStep:o,onAction:i,isCompleted:n}=e,r=(0,B().IS)((e=>({stepContainer:{display:"flex"},checkIcon:{width:24,height:24,marginRight:12,marginTop:3,fill:n?e.blueColor:e.icon.tertiary},content:{flex:1},stepTitle:{display:"flex",alignItems:"center",fontSize:19,fontWeight:se().Wy.semibold,marginBottom:4,color:n?e.blueColor:e.text.primary},container:{display:"flex",flexDirection:"row",alignContent:"flex-start",alignItems:"flex-start",width:"100%",gap:20},image:{width:"135px",marginTop:8,flexShrink:0,borderRadius:4},description:{display:"flex",flexDirection:"column",marginBottom:5,marginTop:5,color:e.text.secondary},actionButton:{marginTop:12,alignSelf:"flex-start"}})),[n,o]);return(0,N.jsxs)("div",{style:r.stepContainer,children:[(0,Ue().checkmarkCircleFillIcon)(r.checkIcon),(0,N.jsxs)("div",{style:r.content,children:[(0,N.jsx)("div",{style:r.stepTitle,children:(0,N.jsx)(C().sA,{...t.title})}),o?(0,N.jsxs)("div",{style:r.container,children:["microphone"===t.id||"system-audio"===t.id?(0,N.jsx)(ze().Ay,{src:Oe().A.images.aiMeetingNotes.setupPng,alt:m().A.formatMessage(Xe.imageAlt),style:r.image,placeholderLoadedStyle:{width:"auto"}}):null,(0,N.jsxs)("div",{style:r.description,children:[(0,N.jsx)(C().sA,{...t.description}),(0,N.jsx)(Ke().A,{color:"uiBlue",style:r.actionButton,onClick:i,children:(0,N.jsx)(C().sA,{...t.actionText})})]})]}):null]})]})}var Ze=()=>o(674266);function et(){const e=(0,M().v3)(),t=(0,_().K8)((()=>{var e;const t=Object.values(T().Ay.state.passiveBlockMap).map((e=>{let{rootBlockStore:t}=e;return t})),o=T().ei.state,i=[];o&&o.isTranscriptionBlock()&&i.push(o);for(const r of t)r.isTranscriptionBlock()&&i.push(r);const n=null===(e=g().default.state.currentUserStore)||void 0===e?void 0:e.id;if(n)for(const r of i){const e=(0,v().by)(r);if(!r.pathIsDead()&&"transcribing"===e.state&&e.transcriber_id===n&&!Ve().c.getVisibilityStatus(r.id))return r}}),[]),[o,i]=(0,A.useState)(!1),n=(0,B().IS)((e=>({wrapper:{borderRadius:34,background:e.buttonBackground},container:{display:"flex",alignItems:"center",justifyContent:"center",boxShadow:e.shadowSM,borderRadius:34,padding:"8px 14px 8px 12px",minWidth:100,background:e.buttonBackground,gap:6,transition:"background 0.3s ease-in-out"},hoveredStyle:{background:o?e.outlinefrontSecondaryButtonPressedBackground:e.buttonHoveredBackground}})),[o]),r=(0,A.useCallback)((()=>{t&&(0,h().K)({environment:e,blockStore:t})}),[e,t]),s=(0,_().O$)(T().gZ);return t?(0,N.jsx)(j().A,{renderTooltip:()=>o?(0,N.jsx)(C().sA,{defaultMessage:"Stop recording",id:"currentlyListeningTranscriptionBlockIndicator.stopRecording"}):(0,N.jsx)(C().sA,{defaultMessage:"Return to meeting note",id:"currentlyListeningTranscriptionBlockIndicator.returnToTranscription"}),render:e=>(0,N.jsx)("div",{style:n.wrapper,children:(0,N.jsxs)(E().A,{...e,style:n.container,hoveredStyle:n.hoveredStyle,onClick:r,children:[(0,N.jsx)(ie().t,{fillWidth:!0,fakeSoundwave:!s,rootBlockId:t.id}),(0,N.jsx)(tt,{store:t,setIsHovering:i})]})})}):null}function tt(e){const{store:t,setIsHovering:o}=e,i=(0,M().v3)(),n=(0,A.useCallback)((()=>{(0,r().stopTranscription)({environment:i,blockStore:t,from:"currently_listening_transcription_block"}),(0,h().K)({environment:i,blockStore:t})}),[i,t]);return(0,N.jsx)(E().A,{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:n,children:(0,N.jsx)(Ze().w,{disabled:!1})})}},909557:(e,t,o)=>{o.d(t,{$W:()=>s,Dg:()=>l,E6:()=>u,Rv:()=>d,Tn:()=>a,XG:()=>c,Yh:()=>r,d1:()=>n,eY:()=>p});var i=()=>o(416845);class n extends i().WXf{constructor(e){super({level:"error",status:500,name:"DictationAudioRecorderFailedError",message:e||"Audio recorder failed",retryable:!1})}}class r extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationSystemAudioFailedError",message:"System audio failed",retryable:!1})}}class s extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationSystemAudioHardwareError",message:"System audio hardware error",retryable:!1})}}class a extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationStartTimeoutError",message:"Dictation start timeout",retryable:!0})}}class c extends i().WXf{constructor(e){super({level:"error",status:429,name:"DictationRateLimitError",message:e||"Rate limit exceeded",retryable:!1})}}class d extends i().WXf{constructor(e){super({level:"error",status:403,name:"DictationForbiddenError",message:e||"Access forbidden",retryable:!1})}}class l extends i().WXf{constructor(e){super({level:"error",status:403,name:"DictationUpgradeRequiredError",message:e||"Workspace upgrade required",retryable:!1})}}class u extends i().WXf{constructor(e,t){super({level:"error",status:t&&(0,o(513416).Mh)(t)?t:500,name:"DictationOpenAIError",message:e,retryable:!0})}}class p extends i().WXf{constructor(e){super({level:"error",status:400,name:"DictationMissingUserOrSpaceError",message:e||"Missing user or space information",retryable:!1})}}},911063:(e,t,o)=>{o.r(t),o.d(t,{getActiveTranscriptionBlockStore:()=>n});var i=()=>o(964345);function n(){const e=i().ei.state;if(null!=e&&e.isTranscriptionBlock())return e}},964576:(e,t,o)=>{o.d(t,{A:()=>n});class i extends(()=>o(757695))().Store{constructor(){super()}getInitialState(){}}const n=new i},986850:(e,t,o)=>{e.exports=o.p+"dbc10b469ee58d20.js"}}]);