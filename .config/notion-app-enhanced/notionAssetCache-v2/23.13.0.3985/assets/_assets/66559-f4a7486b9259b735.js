"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[66559],{73337:(e,t,o)=>{o.d(t,{P:()=>a});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.79 14.42",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M18.507 11.112c.362 0 .655.293.655.656v4.369a.656.656 0 0 1-1.311 0V13.35l-4.997 4.997a.655.655 0 1 1-.927-.928l4.997-4.997h-2.786a.655.655 0 1 1 0-1.31z"}),(0,r.jsx)("path",{d:"M15.5 4.125c1.174 0 2.125.951 2.125 2.125v3.612h-1.25v-.987h-5.75v2.25h1.72a2 2 0 0 0-.103.448l-.01.195.01.195q.024.214.091.412h-1.708v2.25h2.33l-1.25 1.25H4.5a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zM3.625 13.75c0 .483.392.875.875.875h4.875v-2.25h-5.75zm0-2.625h5.75v-2.25h-5.75zm.875-5.75a.875.875 0 0 0-.875.875v1.375h5.75v-2.25zm6.125 2.25h5.75V6.25a.875.875 0 0 0-.875-.875h-4.875z"})]})},a=(0,o(340498).wt)("collectionArrow",n)},305961:(e,t,o)=>{o.d(t,{d:()=>n});o(296540);var r=o(474848);const n=(0,o(340498).wt)("eyePadded",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M12 17.9912C17.6055 17.9912 21.3857 13.4727 21.3857 12.0713C21.3857 10.6699 17.5986 6.1582 12 6.1582C6.47656 6.1582 2.60742 10.6699 2.60742 12.0713C2.60742 13.4727 6.46973 17.9912 12 17.9912ZM12 16.6787C7.63184 16.6787 4.15918 13.0283 4.15918 12.0713C4.15918 11.2715 7.63184 7.4707 12 7.4707C16.3613 7.4707 19.8408 11.2715 19.8408 12.0713C19.8408 13.0283 16.3613 16.6787 12 16.6787ZM12 15.7559C14.0508 15.7559 15.6914 14.0811 15.6914 12.0713C15.6914 10.0137 14.0508 8.39355 12 8.39355C9.94238 8.39355 8.29492 10.0137 8.30176 12.0713C8.31543 14.0811 9.94238 15.7559 12 15.7559ZM12 13.2607C11.3369 13.2607 10.7969 12.7275 10.7969 12.0713C10.7969 11.415 11.3369 10.8818 12 10.8818C12.6631 10.8818 13.1963 11.415 13.1963 12.0713C13.1963 12.7275 12.6631 13.2607 12 13.2607Z"})})},396350:(e,t,o)=>{o.d(t,{i:()=>a});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M12.876 7.982a.625.625 0 1 0-1.072-.644L9.25 11.595 7.815 9.92a.625.625 0 1 0-.95.813l2 2.334a.625.625 0 0 0 1.01-.085z"}),(0,r.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125zM4.375 5.25c0-.483.392-.875.875-.875h9.5c.483 0 .875.392.875.875v9.5a.875.875 0 0 1-.875.875h-9.5a.875.875 0 0 1-.875-.875z"})]})},a=(0,o(340498).wt)("checkmarkSquare",n)},490696:(e,t,o)=>{o.d(t,{C:()=>K});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(581454);var r=o(296540),n=()=>o(17022),a=()=>o(484714),i=()=>o(56366),s=()=>o(401497),l=()=>o(757695),p=()=>o(708685),c=()=>o(502856),d=()=>o(784892),u=()=>o(247331),y=()=>o(563015),m=()=>o(977345),g=()=>o(416504),h=()=>o(591779),f=()=>o(792071),S=()=>o(959013),v=()=>o(973647),x=()=>o(284371),b=()=>o(193722),j=()=>o(780054),A=()=>o(175116),C=()=>o(862292),M=()=>o(921855),P=()=>o(476492),k=()=>o(909470),w=()=>o(847743),_=()=>o(972435),T=()=>o(722872),O=()=>o(991114),B=()=>o(47170),I=()=>o(645873),F=()=>o(962730),R=()=>o(792415),D=()=>o(217429),E=()=>o(942504),V=()=>o(928600),L=()=>o(211975),z=o(474848);const U=200,G=[];function K(e){var t,o,s,l;const{property:d,disabled:S,formulas:x,getRecordModel:F,propertySchema:E,collectionStore:K,handleSave:H,handleClose:J,blockStore:$,analyticsFrom:Z}=e,q=(0,a().v3)(),N=(0,A().ET)(),{value:X}=(0,I().fJ)(C().T.formulas),[Q,ee]=(0,r.useState)(null==E||null===(t=E.formula2)||void 0===t?void 0:t.code),te=(0,h().lW)(Q,U,Object.is),[oe,re]=(0,r.useState)(),ne=(0,r.useRef)(null===(o=E.formula2)||void 0===o?void 0:o.code),ae=(0,r.useRef)(Q),ie=(0,r.useRef)(null==E||null===(s=E.formula2)||void 0===s?void 0:s.result_type),se=(0,r.useCallback)((e=>{ae.current=e,ee(e)}),[]),le=(0,r.useCallback)((e=>{ie.current=e}),[]),[pe,ce]=(0,r.useState)((()=>n().e.withListenerIgnored((()=>W.state??!1)))),[de,ue]=(0,r.useState)([]);(0,r.useEffect)((()=>()=>{const e=ne.current,t=ae.current,o=ie.current;if(t!==e||void 0!==ve){H({newValue:t,newType:(0,p().removeFunctionsFromType)(o??{type:"unknown"}),propertySchema:E,collectionStore:K,property:d});const e=(0,M().r4)(t,K);(0,b().L)(q,{...(0,P().sl)(N),property_type:E.type,action:"formula_v2_edit",from:Z,formula_char_count:e.length})}}),[]);const ye=(0,i().K8)((()=>K.pointer),[K.pointer]),me=(0,r.useMemo)((()=>{const e={type:"block",collection:ye};return{kind:u().FormulaContextValueKind.ThisRow,type:e}}),[ye]),ge=(0,i().K8)((()=>R().A.state.publicPageData),[]),he=(0,B().O)(),fe=(0,i().K8)((()=>(0,k().i)()),[]),Se=(0,r.useMemo)((()=>{if(!he)return;const e=f().h0Y.fromGetRecordModelFn(F);return{sourceProperty:d,valueTypes:[me],handleDataRequest:(0,c().MC)({collectionFeatureGates:fe,experimentService:D().default,getRecordModel:F,loadRecordModel:e}),formulaPropertyNames:Q&&(0,m().o2)(Q),publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},spaceId:he,restrictUnaccessibleProperties:"cross_space_only",featureGates:fe}}),[he,F,d,me,Q,null==ge?void 0:ge.collectionId,null==ge?void 0:ge.collectionSchema,fe]),ve=(0,i().K8)((()=>{if("v2"!==E.version&&E.formula)return x.convertCollectionFormulaToFormula2(E.formula,ye,K.getSchema())}),[ye,K,x,E.formula,E.version]),xe=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!ve||xe.current||!Se)return;const e=await x.analyzeFormula(ve,Se);let t;t=v().Q.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},xe.current=!0,se(ve),le(t)}()}),[K,x,se,le,d,E,ve,Se]);const be=(0,r.useMemo)((()=>{var e;const t="v2"===E.version?null===(e=E.formula2)||void 0===e?void 0:e.code:ve;return ne.current=t,t}),[null===(l=E.formula2)||void 0===l?void 0:l.code,E.version,ve]),je=(0,O().C)(),Ae=(0,i().K8)((()=>{ue(G);const e=null==$?void 0:$.getModel(),t=null==$?void 0:$.getRecordModel;if(!e||!te||!t||w().Pe||!X)return;const o=pe?X.evaluateRawCollectionFormula2({block:e,property:d,formulaCode:te,getRecordModel:t,intl:_().A.getIntl(),userTimeZone:(0,g().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+je,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},experimentService:D().default,collectionFeatureGates:(0,k().i)()}):X.evaluateCollectionFormula2WithoutCache({block:e,property:d,formulaCode:te,getRecordModel:t,intl:_().A.getIntl(),userTimeZone:(0,g().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+je,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,publicPageDataCollection:{id:null==ge?void 0:ge.collectionId,schema:null==ge?void 0:ge.collectionSchema},experimentService:D().default,collectionFeatureGates:(0,k().i)()});if(o){if(!v().Q.isFail(o))return re(ie.current),o.value;(0,y().eJ)(o.error)&&ue([o.error])}}),[$,te,pe,d,je,ge,X]);return Se&&he?(0,z.jsx)(V().A,{menuType:j().A.isMobile?T().gu.Modal:T().gu.Popup,height:j().A.isMobile?"100%":void 0,hideMobileTopbar:!0,width:j().A.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,z.jsx)(L().v,{initialCode:be,outputFooter:void 0!==$&&(0,z.jsx)(Y,{formulaResult:Ae,isAdvancedMode:pe,setIsAdvancedMode:ce,formulaType:oe,blockStore:$,formulaSchema:E}),formulas:x,getRecordModel:F,focus:!0,disabled:S,parentSpaceId:he,typecheckContext:Se,onCodeChange:se,onTypeChange:le,handleClose:J,parentCollectionStore:K,evaluationErrors:de})}):null}const Y=r.memo((function(e){let{formulaResult:t,formulaType:n,blockStore:a,formulaSchema:i,isAdvancedMode:c,setIsAdvancedMode:u}=e;const y=(0,s().IS)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:x().J.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:x().J.UIRegular.desktop,color:e.text.secondary,marginRight:6,marginLeft:2},type:{fontSize:x().J.UISmall.desktop,color:e.text.secondary,marginLeft:6},iconStyle:{height:16,width:16},iconButtonStyle:{marginLeft:"auto"}})),[]),m=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:d().NY.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...o(828180).Cn[d().NY.Medium]}},store:a,isEmptyStore:l().Store.createValue(!1),canEdit:!1,disabled:!1,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:c?void 0:i,trackEditBlockProperty:()=>{},format:"table",containerRef:null,collectionSchemaStore:l().Store.createValue(void 0)})),[a,i,c]),g=(0,r.useMemo)((()=>n?(0,p().getHumanReadableType)(n):o(145076).qY.unknown),[n]),h=(0,S().tz)(),f=c?h.formatMessage({id:"formulas.editor.toggleAdvancedModeOff",defaultMessage:"Hide details"}):h.formatMessage({id:"formulas.editor.toggleAdvancedModeOn",defaultMessage:"Show details"});return(0,z.jsx)(o(234359).L8.Provider,{value:m,children:(0,z.jsxs)("div",{style:y.output,children:[(0,z.jsx)("span",{style:y.equals,children:"="}),t&&(0,z.jsx)(H,{value:t,withComma:!1,blockStore:a,formulaSchema:i,isAdvancedMode:c,renderWrapper:!0}),c&&Boolean(t)&&(0,z.jsx)("span",{style:y.type,children:(0,z.jsx)(S().sA,{...g})}),(0,z.jsx)(o(859428).A,{renderTooltip:()=>f,placement:F().W.Top,alignment:F().C.Center,render:e=>(0,z.jsx)(o(285790).A,{icon:c?o(207583).F:o(305961).d,onClick:()=>{const e=!c;u(e),W.setState(e)},iconStyle:y.iconStyle,style:y.iconButtonStyle,ariaLabel:f,...e})})]})})})),H=r.memo((function e(t){let{value:n,withComma:a,blockStore:l,formulaSchema:p,isAdvancedMode:c,renderWrapper:d}=t;const[u,y]=(0,i().K8)((()=>{var e;if(!n)return[[],"text"];if("undefined"===n.type&&c)return[[E().Or],"empty"];const t=(0,o(886578).O)(n,l.getRecordModel,(0,g().P)());return[t,(null===(e=t[0])||void 0===e?void 0:e.type)??"text"]}),[l.getRecordModel,c,n]),m=(0,s().IS)((e=>({rightBracket:{color:e.text.secondary,fontSize:x().J.UISmall.desktop,marginLeft:2},leftBracket:{color:e.text.secondary,fontSize:x().J.UISmall.desktop,marginRight:2},comma:{color:e.text.secondary,fontSize:x().J.UISmall.desktop,marginRight:2}})),[]);let h;if("array"===n.type)h=(0,z.jsxs)(r.Fragment,{children:[c?(0,z.jsx)("span",{style:m.leftBracket,children:"["}):null,n.values.map(((t,o)=>(0,z.jsx)(e,{value:t,withComma:o<n.values.length-1,blockStore:l,formulaSchema:p,isAdvancedMode:c,renderWrapper:!1},o))),c?(0,z.jsx)("span",{style:m.rightBracket,children:"]"}):null,a?(0,z.jsx)("span",{style:m.comma,children:", "}):""]});else{const e=a&&!c&&(0,E().GL)(y,p);h=null==u?void 0:u.map(((t,o)=>(0,z.jsxs)(r.Fragment,{children:[(0,z.jsx)(E().yZ,{token:t,targetPropertySchema:p,blockStore:l,withComma:e,numberRightAlign:!1,shouldTruncate:!1,disableLinks:!1}),c&&a?(0,z.jsx)("span",{style:m.comma,children:", "}):null]},`${t.id}-${o}`)))}return d&&!c?(0,z.jsx)(E().Ye,{propertyType:y,rootPropertySchema:p,numberRightAlign:!1,children:h}):(0,z.jsx)(r.Fragment,{children:h})})),W=new(o(178624).R)({key:"formulas_show_details",namespace:o(419494).Bq,important:!0,trackingType:"preference"})},539148:(e,t,o)=>{o.d(t,{S:()=>m});o(296540);var r=()=>o(484714),n=()=>o(401497),a=()=>o(734410),i=()=>o(959013),s=()=>o(704152),l=()=>o(859428),p=()=>o(673730),c=()=>o(554283),d=()=>o(962730),u=o(474848);const y=(0,i().YK)({addDescriptionTooltip:{id:"database.description.addDescriptionTooltip",defaultMessage:"Add description"},editDescriptionTooltip:{id:"database.description.editDescriptionTooltip",defaultMessage:"Edit description"}});function m(e){let{onClick:t,description:o,showTooltip:m,addDescriptionText:g,editDescriptionText:h,disabled:f}=e;const{isMobile:S}=(0,r().Y0)(),[v,x]=(0,c().B)(),b=(0,i().tz)(),j=(0,n().IS)((e=>({button:{flexShrink:0,flexGrow:0,borderRadius:S?24:20,marginLeft:4},info:{width:S?18:16,height:S?18:16,fill:x&&!f?e.icon.primary:e.icon.secondary}})),[x,S,f]);return(0,u.jsx)(l().A,{renderTooltip:e=>(0,u.jsx)("div",{...e,children:Boolean(null==o?void 0:o.length)?o:g??b.formatMessage(y.addDescriptionTooltip)}),disableTooltip:!m||f,style:p().Q$,placement:d().W.Top,render:e=>(0,u.jsx)(s().A,{...e,ref:v,onClick:t,"aria-label":Boolean(null==o?void 0:o.length)?g:h??b.formatMessage(y.editDescriptionTooltip),style:j.button,disabled:f,disabledFeedback:f,children:(0,a().q)(j.info)})})}},596359:(e,t,o)=>{o.d(t,{Uk:()=>d,gc:()=>u,r$:()=>m});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var r=()=>o(970013),n=()=>o(183558),a=()=>o(831566),i=()=>o(519839),s=()=>o(972435),l=()=>o(630116),p=()=>o(901389),c=()=>o(751156);function d(e){const{modification:t,property:o,propertySchema:i,options:d,groupIndex:u,environment:m,collectionStore:g,isCollectionsStatusMissingOptionsFixEnabled:h}=e;let f,S;if("keyedObjectListRemove"===t.type)f={pointer:g.pointer,command:"keyedObjectListRemove",path:["schema",o,"options"],args:{remove:{id:t.id}}},void 0!==u&&"status"===i.type&&(S={pointer:g.pointer,command:"listRemove",path:["schema",o,"groups",u,"optionIds"],args:{id:t.id}});else{if(d){if(d.find((e=>e.value.toLowerCase()===t.newValue.toLowerCase())))return void p().f1(s().A.formatMessage(y.optionAlreadyExists))}if("keyedObjectListUpdate"===t.type)f={pointer:g.pointer,command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:{...t.option,value:t.newValue}}};else{const e=i.options||[];let a=(0,r().Zd)(e);if("status"===i.type&&void 0!==u){var v;const e=null===(v=i.groups)||void 0===v||null===(v=v[u])||void 0===v?void 0:v.color;e&&(a=e)}const s={id:(0,n().Ay)(),value:t.newValue,color:a};if("autoSortInsert"===t.type){if(!(0,r().lx)(i))return;f=(0,r().og)({collectionId:g.id,property:o,propertySchema:i,newOption:s,isAscending:"alphabetical"===i.auto_sort_options})}else"keyedObjectListBefore"===t.type?(f={pointer:g.pointer,command:"keyedObjectListBefore",path:["schema",o,"options"],args:{value:s,before:t.beforeOption}},void 0!==u&&"status"===i.type&&(S={pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:s.id}})):"keyedObjectListAfter"===t.type&&(f={pointer:g.pointer,command:"keyedObjectListAfter",path:["schema",o,"options"],args:{value:s,after:t.afterOption}},void 0!==u&&"status"===i.type&&(S={pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:s.id}}))}}(0,a().p)({environment:m,collectionStore:g,performTransaction:e=>{if(c().applyOperation({store:g,operation:f,transaction:e}),S&&c().applyOperation({store:(0,l().Oo)(g,S.pointer),operation:S,transaction:e}),"status"===i.type&&h){const t=i.options??[],r=(i.groups??[]).flatMap((e=>e.optionIds)),n=t.filter((e=>!r.includes(e.id)));for(const a of n)c().applyOperation({store:(0,l().Oo)(g,g.pointer),operation:{pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",0,"optionIds"],args:{id:a.id}},transaction:e})}}})}function u(e){const{newValues:t,property:o,schema:n,collectionStore:s,environment:p,isCollectionsStatusMissingOptionsFixEnabled:d}=e,u=n[o];let y;if("status"===(null==u?void 0:u.type)){y=[[]];for(const e of t)e.startsWith("group-header-")?y.push([]):y[y.length-1].push(e);if(d){const e=((null==u?void 0:u.options)??[]).filter((e=>!t.includes(e.value)));y[0].push(...e.map((e=>e.value)))}}else y=t;const m=(0,i().os)({newOptions:y,collectionId:s.id,property:o,schema:n});if(m){if(u&&(0,r().lx)(u)){"manual"!==(u.auto_sort_options||"manual")&&m.push({pointer:s.pointer,command:"update",path:["schema",o],args:{auto_sort_options:"manual"}})}(0,a().p)({environment:p,collectionStore:s,performTransaction:e=>{for(const t of m)c().applyOperation({store:(0,l().Oo)(s,t.pointer),operation:t,transaction:e})}})}}const y=(0,o(959013).YK)({deleteModalPrompt:{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"},acceptButtonLabel:{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"},preventDefaultStatusOptionDelete:{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"},optionAlreadyExists:{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"}});function m(e){const{option:t,propertySchema:o,property:n,collectionStore:a,statusGroup:i,environment:l,deleteMessage:c}=e;"status"!==o.type||t.value!==o.defaultOption?p().ui({showCancel:!0,keepFocus:!1,message:c??s().A.formatMessage(y.deleteModalPrompt),items:[{label:s().A.formatMessage(y.acceptButtonLabel),color:"red",onAccept:()=>{if((0,r().lx)(o)||"status"===o.type)if("status"===o.type&&i){const e=(o.groups??[]).findIndex((e=>e.id===i.id));d({modification:{type:"keyedObjectListRemove",id:t.id},property:n,propertySchema:o,environment:l,collectionStore:a,groupIndex:e})}else d({modification:{type:"keyedObjectListRemove",id:t.id},property:n,propertySchema:o,environment:l,collectionStore:a})}}]}):p().f1(s().A.formatMessage(y.preventDefaultStatusOptionDelete))}},688311:(e,t,o)=>{o.d(t,{h:()=>n});o(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.76 13.76",svg:(0,o(474848).jsx)("path",{d:"M12.718 4.625H6.313a3 3 0 0 0 0 6h7.562a1.75 1.75 0 1 1 0 3.5H7.282a2.126 2.126 0 1 0 0 1.25h6.593a3 3 0 1 0 0-6H6.313a1.75 1.75 0 1 1 0-3.5h6.405a2.126 2.126 0 1 0 0-1.25m1.157.625a.875.875 0 1 1 1.75 0 .875.875 0 0 1-1.75 0"})},n=(0,o(340498).wt)("pathRoundEnds",r)},705602:(e,t,o)=>{o.d(t,{s:()=>d,y:()=>y});var r=o(296540),n=()=>o(484714),a=()=>o(401497),i=()=>o(959013),s=()=>o(419357),l=()=>o(89924),p=()=>o(673730),c=o(474848);const d=(0,i().YK)({descriptionHeader:{id:"database.viewSettings.propertyTab.description.title",defaultMessage:"Description"},addDescription:{id:"database.viewSettings.propertyTab.description.addDescription",defaultMessage:"Add a description..."}}),u=60;function y(e){let{initialDescription:t,handleSaveDescription:o,disableAutoSection:y}=e;const[m,g]=(0,r.useState)(t??""),h=(0,r.useRef)(m),{isMobile:f}=(0,n().Y0)(),S=(0,i().tz)(),v=(0,a().IS)((e=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default",color:e.text.secondary},descriptionInput:{lineHeight:"20px",fontSize:f?14:13}})),[f]),x=(0,r.useCallback)((()=>o(h.current)),[o]);(0,r.useEffect)((()=>()=>x()),[x]);const b=(0,r.useMemo)((()=>(0,c.jsx)(s().Ay,{value:m,onChange:e=>{g(e.target.value),h.current=e.target.value},onBlur:x,onSubmit:x,placeholder:S.formatMessage(d.addDescription),focusInitial:!0,disabled:!1,inputOuterStyle:v.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:p().fy,autosize:!0,autosizeMaxHeight:u,showClearButton:!1})),[m,S,x,v.descriptionInput]);return f&&!y?(0,c.jsx)(l().A,{topBorder:!0,isInput:!0,title:(0,c.jsx)("span",{style:v.title,children:S.formatMessage(d.descriptionHeader)}),children:b}):b}},788621:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,personCircleIcon:()=>a});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M7.755 6.169C8.277 5.519 9.05 5.125 10 5.125s1.723.393 2.245 1.044c.51.635.75 1.474.75 2.346s-.24 1.71-.75 2.346c-.522.65-1.294 1.044-2.245 1.044-.95 0-1.723-.394-2.245-1.044-.51-.635-.75-1.474-.75-2.346s.24-1.711.75-2.346m.975.782c-.293.365-.475.909-.475 1.564s.182 1.198.475 1.564c.281.35.694.576 1.27.576s.989-.226 1.27-.576c.294-.366.475-.909.475-1.564s-.181-1.199-.475-1.564c-.281-.35-.693-.576-1.27-.576-.576 0-.989.225-1.27.576"}),(0,r.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 0 0-4.087 11.267c.789-1.397 2.333-2.33 4.087-2.33s3.298.933 4.087 2.33A6.375 6.375 0 0 0 10 3.625M13.049 15.6c-.547-1.049-1.697-1.789-3.05-1.789-1.351 0-2.501.74-3.048 1.789a6.35 6.35 0 0 0 3.049.775 6.34 6.34 0 0 0 3.049-.775"})]})},a=(0,o(340498).wt)("personCircle",n)},798174:(e,t,o)=>{o.d(t,{R:()=>z});o(581454);var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(401497),s=()=>o(67657),l=()=>o(970013),p=()=>o(568063),c=()=>o(955363),d=()=>o(668725),u=()=>o(688311),y=()=>o(585639),m=()=>o(959013),g=()=>o(496603),h=()=>o(534177),f=()=>o(679924);var S=()=>o(497222),v=()=>o(175116),x=()=>o(722372),b=()=>o(476492),j=()=>o(722872),A=()=>o(553965),C=()=>o(963589),M=()=>o(463830),P=()=>o(630116),k=()=>o(760217),w=()=>o(406699),_=()=>o(928600),T=()=>o(939740),O=()=>o(480095),B=()=>o(897119),I=()=>o(89924),F=()=>o(859428),R=()=>o(398217),D=()=>o(195071),E=()=>o(250202),V=()=>o(150987),L=o(474848);function z(e){let{context:t,schema:o,property:r,parentStore:s,onDismiss:l,disabled:p,analyticsFrom:d,onChange:h}=e;const f=(0,i().DP)(),v=(0,n().v3)(),x=(0,a().uB)(void 0,M().A),b=(0,a().uB)(void 0,M().A),P=(0,a().uB)(void 0,M().A),k=(0,n().Y0)(),I=(0,C().X)("rollup_on_person_property"),D=(0,a().K8)((()=>U({schema:o,property:r,parentStore:s})),[o,r,s]),E=Boolean((null==D?void 0:D.propertySchema.relation_property)||(null==D?void 0:D.propertySchema.person_property)),V=Boolean(E&&(null==D?void 0:D.propertySchema.target_property)),z=(0,a().K8)((()=>g().oE([$({environment:v,theme:f,disabled:p,sourcePropertySchema:null==D?void 0:D.sourcePropertySchema,analyticsFrom:d,relationButtonPopupStore:P,canSelectPersonProperty:I,onChange:h,schema:o,property:r}),N({isEnabled:E,environment:v,theme:f,disabled:p,renderState:D,analyticsFrom:d,targetPropertyButtonPopupStore:b,onChange:h,schema:o,property:r,parentStore:s}),Q({isEnabled:V,environment:v,theme:f,disabled:p,renderState:D,analyticsFrom:d,aggregationButtonPopupStore:x,onChange:h,schema:o,property:r,parentStore:s})])),[v,f,p,D,d,P,I,h,o,r,E,b,s,V,x]),H=(0,a().K8)((()=>x.state.open),[x]),W=(0,a().K8)((()=>P.state.open),[P]),Z=(0,a().K8)((()=>b.state.open),[b]);if(!D)return null;if("bpvOverlay"===t){let e;return e=k.isMobile?{menuType:j().gu.Modal,title:D.propertySchema.name,right:(0,L.jsx)(O().DoneMenuText,{}),onClickRight:l}:{menuType:j().gu.Popup},(0,L.jsx)(_().A,{...e,children:(0,L.jsx)(T().Ay,{type:T().Oh.Vertical,initialFocus:void 0,sections:z})})}return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(w().Ay,{popupType:k.isMobile?B().nl.SlideUp:B().nl.Popup,alignmentToOrigin:w().yP.End,renderOrigin:e=>(0,L.jsx)(S().A,{icon:c().arrowDiagonalUpRightIcon,title:I?(0,L.jsx)(m().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,L.jsx)(m().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:p,showChevron:!0,rotateChevron:W,right:D.sourcePropertySchema?(0,L.jsx)(R().mA,{propertySchema:D.sourcePropertySchema,showIcon:!0}):(0,L.jsx)(m().sA,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,L.jsx)(J,{parent:e,analyticsFrom:d,schema:o,property:r,onChange:h,canSelectPersonProperty:I}),buttonPopupStore:P}),(0,L.jsx)(F().A,{renderTooltip:()=>(0,L.jsx)(K,{}),disableTooltip:E,render:e=>(0,L.jsx)(w().Ay,{popupType:k.isMobile?B().nl.SlideUp:B().nl.Popup,alignmentToOrigin:w().yP.End,renderOrigin:t=>(0,L.jsx)(S().A,{icon:u().h,title:(0,L.jsx)("span",{style:{...!E&&{color:f.text.secondary}},children:(0,L.jsx)(m().sA,{id:"database.viewSettings.rollupOptions.targetProperty",defaultMessage:"Target property"})}),disabled:!E||p,showChevron:!0,rotateChevron:Z,right:E&&D.targetPropertySchema?(0,L.jsx)(R().mA,{propertySchema:D.targetPropertySchema,showIcon:!0}):(0,L.jsx)(m().sA,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"}),...(0,A().A)(e,t)}),render:e=>(0,L.jsx)(q,{parent:e,analyticsFrom:d,schema:o,property:r,parentStore:s,onChange:h,renderState:D}),buttonPopupStore:b})}),(0,L.jsx)(F().A,{renderTooltip:()=>(0,L.jsx)(Y,{}),disableTooltip:V,render:e=>(0,L.jsx)(w().Ay,{popupType:k.isMobile?B().nl.SlideUp:B().nl.Popup,alignmentToOrigin:w().yP.End,renderOrigin:t=>(0,L.jsx)(S().A,{icon:y().v,disabled:!V||p,title:(0,L.jsx)("span",{style:{...!V&&{color:f.text.secondary}},children:(0,L.jsx)(m().sA,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:H,right:V&&(0,L.jsx)(G,{renderState:D}),...(0,A().A)(e,t)}),render:e=>(0,L.jsx)(X,{parent:e,analyticsFrom:d,schema:o,property:r,parentStore:s,onChange:h,renderState:D}),buttonPopupStore:x})})]})}function U(e){let{schema:t,property:o,parentStore:r}=e;const n=t[o];if(!n)return;let a,i,s,c={};if("person"===n.rollup_type&&n.person_property){const e=t[n.person_property];"person"===(null==e?void 0:e.type)&&(a=e),n.target_property&&(0,p().cl)(n.target_property)&&(s=(0,p().dk)(n.target_property))}else if(n.relation_property){const e=t[n.relation_property];if("relation"===(null==e?void 0:e.type)){var d;a=e;const t=l().Nv(e);i=t?P().md.createChildStore(r,t):void 0;const o=null===(d=i)||void 0===d?void 0:d.getValue();c=o?l().Dp(o):{}}}if(i&&n.target_property){var u;s=c[(null===(u=i)||void 0===u?void 0:u.getMappedProperty(n.target_property))??n.target_property]}return{propertySchema:n,sourcePropertySchema:a,relatedCollectionStore:i,relatedCollectionSchema:c,targetPropertySchema:s}}function G(e){let{renderState:t}=e;return t?t.propertySchema.aggregation?(0,L.jsx)(L.Fragment,{children:x().zY[(0,s().ZP)(t.propertySchema.aggregation)]}):"person"===t.propertySchema.rollup_type&&(0,h().Xk)(p().$J,t.propertySchema.target_property)?(0,L.jsx)(m().sA,{id:"database.rollupProperty.aggregate.showValues",defaultMessage:"Show values"}):(0,L.jsx)(m().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function K(){return(0,L.jsx)(m().sA,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function Y(){return(0,L.jsx)(m().sA,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function H(e,t){return e?void 0:(0,d().b)({width:11,fill:t.icon.secondary})}function W(e,t,o,r,n,a,i){const s=r[n],l=r[e];if(!s||!l||"relation"!==l.type&&"person"!==l.type)return;let c;"person"===l.type?c={...s,rollup_type:"person",person_property:e,relation_property:void 0,target_property:p().Ym,target_property_type:"text",aggregation:void 0}:(c={...s,rollup_type:"relation",relation_property:e,person_property:void 0,target_property:"title",target_property_type:"title",aggregation:void 0},function(e,t){(0,f().v)(e,"configure_rollup_relation",t)}(t,{...(0,b().sl)(i),from:o})),null==a||a({propertySchema:c})}function J(e){let{parent:t,analyticsFrom:o,schema:a,property:i,onChange:s,canSelectPersonProperty:l}=e;const p=(0,n().v3)(),c=(0,v().ET)(),d=(0,r.useCallback)((e=>W(e,p,o,a,i,s,c)),[p,o,a,i,s,c]),u=(0,r.useCallback)((e=>function(e,t){return Boolean("relation"===e.type||"person"===e.type&&t)}(e,l)),[l]);return(0,L.jsx)(V().A,{schema:a,isRelationProperty:!1,onAccept:d,onClose:t.close,allowProperty:u})}function $(e){let{environment:t,theme:o,disabled:r,sourcePropertySchema:n,analyticsFrom:a,relationButtonPopupStore:i,canSelectPersonProperty:s,onChange:l,schema:p,property:c}=e;const{device:d}=t;if(c&&p)return{key:0,render:e=>(0,L.jsx)(I().A,{...e,title:s?(0,L.jsx)(m().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,L.jsx)(m().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"})}),items:[{key:0,render:e=>(0,L.jsx)(w().Ay,{popupType:d.isMobile?B().nl.SlideUp:B().nl.Popup,renderOrigin:t=>n?(0,L.jsx)(E().G,{...(0,A().A)(e,t),propertySchema:n,format:E().e.Name,right:H(r,o),disabled:r}):(0,L.jsx)(k().A,{...(0,A().A)(e,t),title:s?(0,L.jsx)(m().sA,{id:"database.rollupProperty.editSourceProperty.buttonTitle",defaultMessage:"Select a source property…"}):(0,L.jsx)(m().sA,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:H(r,o),style:{color:o.text.secondary},disabled:r}),render:e=>(0,L.jsx)(J,{parent:e,analyticsFrom:a,schema:p,property:c,onChange:l,canSelectPersonProperty:s}),buttonPopupStore:i},e.key),action:()=>{i.setState({open:!0})}}]}}function Z(e,t,o,r,n,a,i,s){const l=U({schema:r,property:n,parentStore:a});if(!l||!l.propertySchema)return;const{propertySchema:c}=l;let d,u;if("person"===c.rollup_type)(0,h().Xk)(p().$J,e)&&(u=(0,p().dk)(e).type,d={...c,target_property:e,target_property_type:u,aggregation:void 0});else if("relation"===c.rollup_type||void 0===c.rollup_type){const r=l.relatedCollectionSchema[e];r&&(u=r.type,d={...c,target_property:e,target_property_type:r.type,aggregation:void 0},function(e,t){(0,f().v)(e,"configure_rollup_target_property",t)}(t,{...(0,b().sl)(s),from:o,property_type:r.type}))}d&&u&&(null==i||i({propertySchema:d}))}function q(e){let{parent:t,analyticsFrom:o,schema:a,property:i,parentStore:s,onChange:c,renderState:d}=e;const u=(0,n().v3)(),y=(0,v().ET)(),g=(0,m().tz)(),h=(0,r.useCallback)((e=>{Z(e,u,o,a,i,s,c,y),t.close()}),[o,u,a,i,s,c,y,t]);if(!d||!d.propertySchema)return null;if("person"===d.propertySchema.rollup_type){const e=p().$J.map((e=>({key:e,render:t=>(0,L.jsx)(E().G,{...t,propertySchema:(0,p().dk)(e,g),format:E().e.Name}),action:()=>h(e)})));return(0,L.jsx)(_().A,{menuType:j().gu.Popup,children:(0,L.jsx)(T().Ay,{type:T().Oh.Vertical,sections:[{key:0,items:e,render:e=>(0,L.jsx)(I().A,{...e})}],initialFocus:void 0})})}return!d.relatedCollectionSchema||"relation"!==d.propertySchema.rollup_type&&void 0!==d.propertySchema.rollup_type?null:(0,L.jsx)(V().A,{schema:d.relatedCollectionSchema,isRelationProperty:!1,onAccept:h,allowProperty:e=>"rollup"!==e.type&&!(0,l().rK)(e.type),onClose:t.close})}function N(e){let{isEnabled:t,environment:o,theme:r,disabled:n,renderState:a,analyticsFrom:i,targetPropertyButtonPopupStore:s,onChange:l,schema:p,property:c,parentStore:d}=e;const{device:u}=o;if(a&&a.propertySchema&&p&&c&&d)return{key:1,render:e=>(0,L.jsx)(I().A,{...e,title:(0,L.jsx)(m().sA,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0}),items:[{key:0,render:e=>(0,L.jsx)(F().A,{renderTooltip:()=>(0,L.jsx)(K,{}),disableTooltip:t,render:o=>(0,L.jsx)(w().Ay,{popupType:u.isMobile?B().nl.SlideUp:B().nl.Popup,renderOrigin:i=>a.targetPropertySchema?(0,L.jsx)(E().G,{...e,propertySchema:a.targetPropertySchema,format:E().e.Name,right:H(!t||n,r),disabled:!t||n,disabledFeedback:!0}):(0,L.jsx)(k().A,{...e,...(0,A().A)(o,i),title:(0,L.jsx)(m().sA,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property…"}),right:H(!t||n,r),disabled:!t||n,disabledFeedback:!0}),render:e=>(0,L.jsx)(q,{parent:e,analyticsFrom:i,schema:p,property:c,parentStore:d,onChange:l,renderState:a}),buttonPopupStore:s})},e.key),action:()=>{s.setState({open:!0})}}]}}function X(e){let{parent:t,analyticsFrom:o,schema:a,property:i,parentStore:l,onChange:p,renderState:c}=e;const d=(0,n().v3)(),u=(0,v().ET)(),y=(0,r.useCallback)((e=>{let{aggregationType:t}=e;return function(e,t,o,r,n,a,i,l){const p=U({schema:r,property:n,parentStore:a});if(!p)return;const c={...p.propertySchema,aggregation:e,show_as:void 0};null==i||i({propertySchema:c});const d=e?(0,s().ZP)(e):void 0;!function(e,t){(0,f().v)(e,"configure_rollup_aggregation",t)}(t,{...(0,b().sl)(l),from:o,aggregation:d})}(t,d,o,a,i,l,p,u)}),[d,o,a,i,l,p,u]);if(c&&c.propertySchema.target_property){let e=c.relatedCollectionSchema;return"person"===c.propertySchema.rollup_type&&c.targetPropertySchema&&c.propertySchema.target_property&&(e={[c.propertySchema.target_property]:c.targetPropertySchema}),(0,L.jsx)(D().A,{property:c.propertySchema.target_property,schema:e,currentAggregation:c.propertySchema.aggregation?{aggregator:c.propertySchema.aggregation,property:c.propertySchema.target_property}:void 0,onChange:y,onClose:t.close,noneText:(0,L.jsx)(m().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"})}return null}function Q(e){let{isEnabled:t,environment:o,theme:r,disabled:n,renderState:a,analyticsFrom:i,aggregationButtonPopupStore:s,onChange:l,schema:p,property:c,parentStore:d}=e;const{device:u}=o;if(a&&c&&p)return{key:2,render:e=>(0,L.jsx)(I().A,{...e,title:(0,L.jsx)(m().sA,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0}),items:[{key:0,render:e=>(0,L.jsx)(F().A,{renderTooltip:()=>(0,L.jsx)(Y,{}),disableTooltip:t,render:o=>t?(0,L.jsx)(w().Ay,{popupType:u.isMobile?B().nl.SlideUp:B().nl.Popup,renderOrigin:t=>(0,L.jsx)(k().A,{...(0,A().A)(e,t),title:(0,L.jsx)(G,{renderState:a}),right:H(n,r),disabled:n}),render:e=>(0,L.jsx)(X,{parent:e,analyticsFrom:i,schema:p,property:c,parentStore:d,onChange:l,renderState:a}),buttonPopupStore:s}):(0,L.jsx)(k().A,{...(0,A().A)(e,o),title:(0,L.jsx)(m().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:H(n,r),disabled:!0,disabledFeedback:!0})},e.key),action:()=>{s.setState({open:!0})}}]}}},814777:(e,t,o)=>{o.d(t,{h:()=>z});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(784892),s=()=>o(396350),l=()=>o(748054),p=()=>o(236262),c=()=>o(519831),d=()=>o(959013),u=()=>o(381349),y=()=>o(496603),m=()=>o(284371),g=()=>o(901952),h=()=>o(193722),f=()=>o(596359),S=()=>o(901389),v=()=>o(539148),x=()=>o(705602),b=()=>o(828973),j=()=>o(175116),A=()=>o(476492),C=()=>o(722872),M=()=>o(963589),P=()=>o(838364),k=()=>o(377586),w=()=>o(831194),_=()=>o(575143),T=()=>o(419357),O=()=>o(928600),B=()=>o(939740),I=()=>o(480095),F=()=>o(897119),R=()=>o(89924),D=()=>o(893952),E=()=>o(399762),V=o(474848);const L=o(757695).Store.createClass(!1,{name:"ShowSelectDescriptionStore"});function z(e){let{onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:p,analyticsFrom:c,statusGroup:d,origin:u,open:y,alignmentToOrigin:m}=e;const g=(0,n().v3)(),h=(0,j().ET)(),f=(0,a().uB)(void 0,L),{isMobile:S}=(0,n().Y0)(),v=(0,M().X)("db_ux_mobile"),[x,b]=(0,r.useState)(""),A=(0,r.useRef)(y);(0,r.useEffect)((()=>{!A.current&&y&&b(p.value),A.current=y}),[y,p.value]);const C=(0,r.useCallback)((()=>(0,V.jsx)(U,{collectionContextStore:h,onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:p,analyticsFrom:c,statusGroup:d,renameInputValue:x,setRenameInputValue:b,showSelectDescriptionStore:f})),[h,t,o,i,s,l,p,c,d,x,b,f]),P=(0,r.useCallback)((()=>function(e,t,o,r,n,a,i,s,l,p,c){if(o(),p&&c)return;G(e,t,r,n,a,i,s,l)}(g,h,t,o,i,s,l,p,x,S,v)),[g,h,t,o,i,s,l,p,x,S,v]);return(0,V.jsx)(F().Ay,{popupType:S?v?k().n.BottomSheet:k().n.SlideUp:k().n.Popup,open:y,onDismiss:P,origin:u,render:C,alignmentToOrigin:m})}function U(e){let{collectionContextStore:t,onClose:o,collectionId:y,propertySchema:g,property:j,onChange:k,option:F,analyticsFrom:L,statusGroup:z,renameInputValue:U,setRenameInputValue:K,showSelectDescriptionStore:Y}=e;const H=(0,d().tz)(),W=(0,n().v3)(),{isMobile:J}=(0,n().Y0)(),$=(0,M().X)("db_ux_mobile"),Z=(0,a().K8)((()=>t.collectionStore()),[t]),q=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t(o)}(e,K)),[K]),N=(0,r.useCallback)((e=>(e.stopPropagation(),function(e,t,o,r,n,a,i,s,l){o(),G(e,t,r,n,a,i,s,l)}(W,t,o,y,g,j,k,F,U))),[W,t,o,y,g,j,k,F,U]),X=(0,r.useCallback)((()=>{if(Z)return function(e,t,o,r,n,a,i,s,l){f().r$({environment:e,option:t,property:n,propertySchema:r,collectionStore:i,statusGroup:s}),a(),(0,h().L)(e,{...(0,A().sl)(l),property_type:r.type,action:"select_delete_option",from:o})}(W,F,L,g,j,o,Z,z,t)}),[W,F,Z,L,g,j,o,z,t]),Q=(0,a().O$)(Y),ee=[];Q&&ee.push({key:"description",render:e=>(0,V.jsx)(R().A,{...e,desktopStyle:{paddingTop:0},title:J?H.formatMessage(x().s.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,V.jsx)(x().y,{...e,initialDescription:F.description,handleSaveDescription:e=>function(e,t,o,r,n,a,i,s){if(e===(s.description??""))return;const l={...s,description:e},p={pointer:{table:c().Vl,id:r},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:l}};o([p]),(0,h().L)(t,{property_type:a.type,action:"select_set_description",from:i})}(e,W,k,y,j,g,L,F),disableAutoSection:!0}),action:()=>{}}]});const te={key:"action",render:e=>(0,V.jsx)(R().A,{...e}),items:[]};ee.push(te),te.items.push({key:"delete",render:e=>(0,V.jsx)(_().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:p().trashIcon}),action:X}),z&&"status"===g.type&&(te.items.push({key:"setAsDefault",render:e=>(0,V.jsx)(_().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:l().M}),action:()=>async function(e,t,o,r,n,a,i,s,l){if("status"!==o.type||!l)return;if(a.value===o.defaultOption)return;if(void 0!==o.defaultOption){const{accept:e}=await S().Gh({mode:"wide",message:(0,V.jsx)(d().sA,{defaultMessage:'Change default to "{defaultValue}"?',id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:a.value}}),description:(0,V.jsx)(d().sA,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:a.value,b:e=>(0,V.jsx)("span",{style:{fontWeight:m().Wy.semibold},children:e})}}),acceptLabel:(0,V.jsx)(d().sA,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})});if(!e)return}const p={table:c().Vl,id:e},u=[],y={pointer:p,command:"update",path:["schema",t],args:{defaultOption:a.value}};u.push(y),r(u),i(),(0,h().L)(s,{property_type:o.type,action:"status_set_default",from:n,collection_id:e})}(y,j,g,k,L,F,o,W,z)}),te.items.push({key:"Group",render:e=>(0,V.jsx)("div",{...e,children:(0,V.jsx)(b().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:z.name,options:(g.groups??[]).map((e=>({key:e.name,type:"button",title:w().OR[e.name]??e.name}))),icon:s().i,onChange:e=>{!function(e,t,o,r,n,a,i,s,l){if("status"!==i.type||!l)return;const p={table:c().Vl,id:t},d=[],u=i.groups??[],y=u.findIndex((e=>e.id===l.id)),m=u.findIndex((t=>t.name===e));if(y===m)return;const g={pointer:p,command:"listRemove",path:["schema",r,"groups",y,"optionIds"],args:{id:o.id}},f={pointer:p,command:"listAfter",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}};d.push(g,f);const S=i.options??[],v=u.flatMap((e=>{const t=e.optionIds??[],o=S.filter((e=>t.includes(e.id)));return o})),x={pointer:p,command:"set",path:["schema",r,"options"],args:v};d.push(x),n(d),(0,h().L)(s,{property_type:i.type,action:"status_set_default",from:a,collection_id:t})}(e,y,F,j,k,L,g,W,z)}})}),action:()=>{}}));const oe=u().tS.map((e=>{const t={key:e,render:t=>(0,V.jsx)(D().A,{...t,color:e,isChecked:F.color===e}),action:()=>{!function(e,t,o,r,n,a,i,s){const l={...t,color:e},p={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:l}};a([p]),(0,h().L)(s,{property_type:n.type,action:"select_change_color",from:i,collection_id:o})}(e,F,y,j,g,k,L,W)}};return t})),re={key:"color",render:e=>(0,V.jsx)(R().A,{...e,title:(0,V.jsx)(d().sA,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),topBorder:!0}),items:oe};let ne;return ee.push(re),ne=J?{menuType:C().gu.Modal,title:(0,V.jsx)(E().O,{format:i().NY.Large,value:F.value,color:F.color,showRemoveButton:!1,isSingle:!0}),right:(0,V.jsx)(I().DoneMenuText,{}),onClickRight:N,scrollerStyle:$?{paddingBottom:P().Hc}:void 0}:{menuType:C().gu.Popup,width:220},(0,V.jsxs)(O().A,{...ne,children:[(0,V.jsx)(R().A,{isInput:!0,children:(0,V.jsx)(T().Ay,{focusInitial:!0,selectAll:!J,value:U,maxlength:180,onChange:q,onSubmit:N,showClearButton:!1,inputRight:(0,V.jsx)(v().S,{onClick:()=>Y.setState(!Q),description:F.description,showTooltip:!Q})})}),(0,V.jsx)(B().Ay,{type:B().Oh.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:ee})]})}function G(e,t,o,r,n,a,i,s){const l=s,p=r.options||[],u=p.find((e=>e.id!==i.id&&e.value.trim().toLowerCase()===l.trim().toLowerCase()));if(i.value!==l)if(l)if(u)S().f1((0,V.jsx)(d().sA,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const s=p.find((e=>e.id===i.id));if(!s)return;const d=l.trim(),u={...s,value:d},m={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:u}},h="status"===r.type&&i.value===r.defaultOption?{pointer:{table:c().Vl,id:o},command:"update",path:["schema",n],args:{defaultOption:d}}:void 0;a(y().oE([m,h])),(0,g().V)({environment:e,collectionContextStore:t,property:n,from:"view_settings",action:"select_rename_option",option_value_char_count:d.length})}else S().f1((0,V.jsx)(d().sA,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}},828973:(e,t,o)=>{o.d(t,{A:()=>u});o(898992),o(672577),o(581454);var r=o(296540),n=()=>o(56366),a=()=>o(496603),i=()=>o(406699),s=()=>o(939740),l=()=>o(897119),p=()=>o(89924),c=()=>o(722872),d=o(474848);const u=function(e){let{icon:t,iconStyle:u,title:y,selectedKey:m,onChange:g,onClick:h,popupStyle:f,menuItemOptionsStyle:S,menuStyle:v,disabled:x,collectionContextStore:b,openButtonPopup:j,hideCheck:A,children:C,disableParentClose:M,inputPlaceholder:P,...k}=e;const w=(0,o(484714).Y0)(),_="options"in k?k.options:a().Bq(k.sections),T=_.find((e=>a().n4(e.key,m))),O=(0,n().uB)(void 0,o(463830).A),B=(0,n().O$)(O);return(0,r.useEffect)((()=>{b&&j&&(O.setState({...O.state,open:j}),b.settingsStore.setState({...b.settingsStore.state,openButtonPopup:void 0})),T||o(857639).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(502800).convertErrorToLog)("Selected key is invalid.")})})),(0,d.jsx)(i().Ay,{popupType:w.isMobile?l().nl.SlideUp:l().nl.Popup,alignmentToOrigin:i().yP.End,placementToOrigin:i().sx.Bottom,style:f,originGap:0,buttonPopupStore:O,disabled:x,onClick:h,renderOrigin:e=>(0,d.jsx)(o(497222).A,{title:y,showChevron:!0,right:(0,d.jsx)("span",{style:o(284371).RC,children:"input"===(null==T?void 0:T.type)?T.inputValue:null==T?void 0:T.title}),rotateChevron:B.open,disabled:x,icon:t,iconStyle:u,...(0,o(553965).A)(e,k)}),render:e=>{let t;t=w.isMobile?{menuType:c().gu.ActionSheet}:{menuType:c().gu.Popup,width:250,...v};const r=(t,r)=>{if(t.hideOption)return null;let n;return n="input"===t.type?{key:r,render:r=>(0,d.jsx)(o(419357).Ay,{...r,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var r;null===(r=t.onSubmit)||void 0===r||r.call(t,t.key,e,t.inputValue),e.close()},placeholder:P,isChecked:!A&&a().n4(t.key,m)}),action:()=>{}}:{key:r,render:e=>(0,d.jsx)(o(760217).A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:S,isChecked:!A&&a().n4(t.key,m)}),action:()=>{g(t.key,e),M||e.close()}},n},n="sections"in k?k.sections.map(((e,t)=>({key:t,render:e=>(0,d.jsx)(p().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oE(e.map(r))}))):[{key:0,render:e=>(0,d.jsx)(p().A,{enableActionSheetTitle:!0,...e}),items:a().oE(_.map(r))}];return(0,d.jsxs)(o(928600).A,{...t,children:[(0,d.jsx)(s().Ay,{type:s().Oh.Vertical,sections:n,initialFocus:0,resetFocusOnMouseOut:!0}),C||null]})}})}}}]);