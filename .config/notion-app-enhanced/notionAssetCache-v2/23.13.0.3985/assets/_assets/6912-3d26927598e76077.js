"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[6912],{3259:(e,t,n)=>{n.d(t,{G8:()=>h,cZ:()=>g,yN:()=>v});n(898992),n(823215),n(672577),n(581454),n(737550);var r=()=>n(319625),o=()=>n(763824),a=()=>n(534177),i=()=>n(696706),u=()=>n(179034),s=()=>n(798880),p=()=>n(247331),l=()=>n(662358),d=()=>n(696446),c=()=>n(106714),y=()=>n(349835),m=()=>n(977345),f=()=>n(628048);function*v(e,t){if(t.depth>p().FORMULA_MAX_DEPTH)throw new(y().I3)({type:y().uW.DepthExceeded});if(t.formulaTimeoutTimestampMs&&Date.now()>t.formulaTimeoutTimestampMs)throw t.logFormulaTimeoutFn&&t.logFormulaTimeoutFn(),new(y().I3)({type:y().uW.MaxEvaluationTimeExceeded});switch(e.kind){case y().NM.Number:return{type:"number",value:parseFloat(e.text)};case y().NM.String:return{type:"text",value:[[e.text]]};case y().NM.Boolean:return{type:"checkbox",value:"true"===e.text.toLowerCase()};case y().NM.NotionToken:{const n=e.token;switch(n.type){case p().FormulaTokenType.Checkbox:return{type:"checkbox",value:n.checked};case p().FormulaTokenType.BlockProperty:return yield*(0,l().ir)({node:e,token:n,context:t,evaluateAST:v});case p().FormulaTokenType.Block:return{type:"block",value:{table:u().ev,id:n.blockId,spaceId:n.spaceId}};case p().FormulaTokenType.ContextValue:return(0,l().ym)({node:e,token:n,context:t});case p().FormulaTokenType.Date:return{type:"date",value:n.date};case p().FormulaTokenType.Person:return{type:"person",value:{table:s().oo,id:n.userId}};default:return(0,a().HB)(n)}}case y().NM.Identifier:{var n;const r=null===(n=t.values.find((t=>t.kind===p().FormulaContextValueKind.Binding&&t.id===e.text)))||void 0===n?void 0:n.value;if(void 0!==r)return r;if(f().LP.hasOwnProperty(e.text))return{type:"function",function:f().LP[e.text]};throw new(y().I3)({type:y().uW.IdentifierNotFound,node:e})}case y().NM.Array:return{type:"array",values:yield*(0,d().KZ)(e.elements.map((e=>v(e,t))))};case y().NM.Conditional:{const n=yield*v(e.condition,t);return(0,m().CL)(n)?yield*v(e.expIfTrue,t):yield*v(e.expIfFalse,t)}case y().NM.LogicalOr:return{type:"checkbox",value:(yield*(0,d().KZ)(e.elements.map((e=>v(e,t))))).map(m().CL).some((e=>e))};case y().NM.LogicalAnd:return{type:"checkbox",value:(yield*(0,d().KZ)(e.elements.map((e=>v(e,t))))).map(m().CL).every((e=>e))};case y().NM.Equality:{const[n,r]=yield*(0,d().KZ)([v(e.lhs,t),v(e.rhs,t)]),o=yield*(0,m().zV)(n,r,t),i=e.op;switch(i){case"==":return{type:"checkbox",value:o};case"!=":return{type:"checkbox",value:!o};default:return(0,a().HB)(i)}}case y().NM.Relational:{const[n,r]=yield*(0,d().KZ)([v(e.lhs,t),v(e.rhs,t)]);return yield*(0,l().MA)(e,n,r,t)}case y().NM.Additive:{const[n,r]=yield*(0,d().KZ)([v(e.lhs,t),v(e.rhs,t)]);return(0,l().LL)(e,n,r)}case y().NM.Multiplicative:{const[n,r]=yield*(0,d().KZ)([v(e.lhs,t),v(e.rhs,t)]);return(0,l().Rn)(e,n,r)}case y().NM.Exponentiation:{const[n,r]=yield*(0,d().KZ)([v(e.lhs,t),v(e.rhs,t)]);return(0,l().oj)(e,n,r)}case y().NM.Unary:{const n=yield*v(e.expression,t);return(0,l().If)(e,n)}case y().NM.Call:{const n=yield*v(e.expression,t);if("function"!==n.type)throw new(y().I3)({type:y().uW.CannotCallNonFunction,node:e,calleeType:n.type});const o=n.function,a=(0,m().ab)(o),i=void 0!==n.boundTarget?[n.boundTarget,...e.arguments]:e.arguments;if(i.length<a)throw new(y().I3)({type:y().uW.FunctionCallTooFewArguments,node:e,libraryFunction:o,numArguments:i.length});const u=yield*(0,d().KZ)(i.map(((n,r)=>function*(e,t,n,r,o){const a=(0,m().Pf)(r,n);if(void 0===a)throw new(y().I3)({type:y().uW.FunctionCallUnexpectedArgument,node:e,argument:t,libraryFunction:r,parameterIndex:n});if(!Array.isArray(a.type)&&"expression"===a.type.type)return t;const i=yield*v(t,o);return(0,l().qL)({value:i,callNode:e,argumentNode:t,parameterIndex:n,libraryFunction:r,expectedParameter:a})}(e,n,r,o,t))));try{return yield*o.eval(u,t)}catch(r){if(r instanceof y().I3)throw r;throw new(y().I3)({type:y().uW.LibraryFunctionExecutionError,node:e,libraryFunction:o,error:r})}}case y().NM.UnifiedFunctionProperty:if(f().LP.hasOwnProperty(e.name))return{type:"function",function:f().LP[e.name],boundTarget:e.expression};throw new(y().I3)({type:y().uW.UnifiedFunctionPropertyNotFound,node:e});case y().NM.MemberBlockProperty:{const n=yield*v(e.expression,t);if("undefined"===n.type)return{type:"undefined"};if("block"!==n.type)throw new(y().I3)({type:y().uW.AccessingPropertyOnNonBlock,node:e,expressionValue:n});const r=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(void 0===r)throw new(y().I3)({type:y().uW.MissingDataDependencyBlock,node:e,blockPointer:n.value});if(void 0===e.propertyToken.collection)return(0,m().ve)(r,e.propertyToken.property);const{collectionPointer:o,schema:a}=yield*(0,l().OH)(r,t);if(!o)throw new(y().I3)({type:y().uW.MissingDataDependencyBlock,node:e,blockPointer:r.pointer});if(!(0,i().Z2)(e.propertyToken.collection,o))throw new(y().I3)({type:y().uW.MemberPropertyMismatchCollection,node:e,blockCollection:o});const u=(0,m().Yi)(e.propertyToken.property),s=null==a?void 0:a[u];if(void 0===s||void 0===a)throw new(y().I3)({type:y().uW.MissingPropertyOnSchemaForMemberProperty,node:e});return yield*(0,l().PR)({block:r,property:u,parentCollectionPointer:o,schema:a,propertySchema:s,oldContext:t,evaluateAST:v})}case y().NM.RecoveryNode:throw new(y().I3)({type:y().uW.UnexpectedRecoveryNode,recovery:e});default:(0,a().HB)(e)}}function h(e,t,n){try{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+l().qU;const n=v(e,t);let r=n.next();for(;!r.done;){const e=t.handleDataRequest(r.value);r=n.next(e)}if(t.allowedValueTypes&&!b(r.value,t.allowedValueTypes))throw new(y().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:r.value,type:y().uW.DisallowedValueType});return{value:(0,l().rb)(r.value)}}catch(o){if(o instanceof y().I3){const e=o.info;return n&&(0,m().li)(e)?{error:{...e,node:(0,c().TW)(e.node,n)}}:{error:e}}return{error:{type:y().uW.UnexpectedError,error:(0,r().A)(o)}}}}function x(e,t){return"array"!==e.type?"undefined"===e.type||e.type===t.type:"array"===t.type&&e.values.every((e=>"array"===e.type?x(e,t):x(e,t.of)))}function b(e,t){return"undefined"===e.type||t.some((t=>x(e,t)))}async function g(e,t,n){try{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+l().qU;const n=performance.now();let r=0;const a=v(e,t);let i=a.next();for(;!i.done;){const e=t.handleDataRequest(i.value);let n;if((0,o().yL)(e)){const t=performance.now();n=await e,r+=performance.now()-t}else n=e;i=a.next(n)}if(t.allowedValueTypes&&!b(i.value,t.allowedValueTypes))throw new(y().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:i.value,type:y().uW.DisallowedValueType});const u=performance.now()-n-r;return{value:(0,l().rb)(i.value),formulaEvaluationStats:{syncEvaluationTimeMs:u}}}catch(a){if(a instanceof y().I3){const e=a.info;return n&&(0,m().li)(e)?{error:{...e,node:(0,c().TW)(e.node,n)}}:{error:e}}return{error:{type:y().uW.UnexpectedError,error:(0,r().A)(a)}}}}},44907:(e,t,n)=>{n.d(t,{Ps:()=>m,Q7:()=>c,TM:()=>p,_M:()=>d,p8:()=>s});n(16280),n(269479);var r=()=>n(303151),o=()=>n(496603),a=()=>n(247331),i=()=>n(349835),u=()=>n(977345);const s=o().Bj((()=>function(){const e=(0,r().Ey)({name:"AdditionOperator",pattern:r().JG.NA}),t=(0,r().Ey)({name:"UnaryOperator",pattern:r().JG.NA}),o=(0,r().Ey)({name:"Plus",pattern:/\+/,categories:e}),i=(0,r().Ey)({name:"Minus",pattern:/-/,categories:[e,t]}),s=(0,r().Ey)({name:"ExclamationPoint",pattern:/!/,categories:t}),p=(0,r().Ey)({name:"MultiplicationOperator",pattern:r().JG.NA}),l=(0,r().Ey)({name:"Multi",pattern:/\*/,categories:p}),d=(0,r().Ey)({name:"Div",pattern:/\//,categories:p}),c=(0,r().Ey)({name:"Modulo",pattern:/%/,categories:p}),y=(0,r().Ey)({name:"Caret",pattern:/\^/}),m=(0,r().Ey)({name:"BooleanLiteral",pattern:r().JG.NA}),f=(0,r().Ey)({name:"True",pattern:/true/i,categories:m}),v=(0,r().Ey)({name:"False",pattern:/false/i,categories:m}),h=(0,r().Ey)({name:"And",pattern:/and |&&/i}),x=(0,r().Ey)({name:"Or",pattern:/or |\|\|/i}),b=(0,r().Ey)({name:"Not",pattern:/not /i,categories:t}),g=(0,r().Ey)({name:"RelationalOperator",pattern:r().JG.NA}),T=(0,r().Ey)({name:"LessThan",pattern:/<=?/,categories:g}),k=(0,r().Ey)({name:"GreaterThan",pattern:/>=?/,categories:g}),w=(0,r().Ey)({name:"EqualityOperator",pattern:r().JG.NA}),M=(0,r().Ey)({name:"Equal",pattern:/==/,categories:w}),N=(0,r().Ey)({name:"NotEqual",pattern:/!=/,categories:w}),E=(0,r().Ey)({name:"LParen",pattern:/\(/}),C=(0,r().Ey)({name:"RParen",pattern:/\)/}),R=(0,r().Ey)({name:"LBracket",pattern:/\[/}),I=(0,r().Ey)({name:"RBracket",pattern:/\]/}),A=(0,r().Ey)({name:"Comma",pattern:/,/}),O=(0,r().Ey)({name:"Dot",pattern:/\./}),P=(0,r().Ey)({name:"QuestionMark",pattern:/\?/}),S=(0,r().Ey)({name:"Colon",pattern:/:/}),F=(0,r().Ey)({name:"StringLiteral",pattern:/"(?:[^\\"]|\\.)*"/,start_chars_hint:['"']}),L=(0,r().Ey)({name:"UnclosedStringLiteral",pattern:/"(?:[^\\"]|\\.)*/,start_chars_hint:['"']}),U=(0,r().Ey)({name:"NumberLiteral",pattern:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),B=(0,r().Ey)({name:"Comment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),_=(0,r().Ey)({name:"UnclosedComment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),D=(0,r().Ey)({name:"InputToken",pattern:{exec:(e,t)=>{if(!e.startsWith(a().FORMULA_TOKEN_PREFIX,t))return null;const r=e.substring(t),o=a().tokenBlockPropertyOptionalCollectionPattern.exec(r);if(null!==o){const e=[o[0]],t=(0,u().QE)(o[1]);let r;if(void 0!==o[2])r={type:a().FormulaTokenType.BlockProperty,property:t,collection:{table:n(519831).Vl,id:o[3],spaceId:o[4]}};else{if(!a().FormulaTokenSupportedBlockSystemPropertyList.includes(t))return null;r={type:a().FormulaTokenType.BlockProperty,property:t,collection:void 0}}return e.payload=r,e}const i=a().tokenBlockPropertyContextValueIdPattern.exec(r);if(null!==i){const e=[i[0]],t=(0,u().QE)(i[1]),n=(0,u().A$)(i[2]),r=(0,u().e2)(e[3]),o={contextValueId:n,property:t,type:a().FormulaTokenType.BlockProperty,valueSnapshot:r};return e.payload=o,e}const s=a().tokenBlockPattern.exec(r);if(null!==s){const e=[s[0]],t={type:a().FormulaTokenType.Block,blockId:s[1],spaceId:void 0!==s[2]?s[2].substring(1):void 0};return e.payload=t,e}const p=a().tokenPersonPattern.exec(r);if(null!==p){const e=[p[0]],t={type:a().FormulaTokenType.Person,userId:p[1]};return e.payload=t,e}const l=a().tokenCheckboxPattern.exec(r);if(null!==l){const e=[l[0]],t={type:a().FormulaTokenType.Checkbox,checked:"true"===l[1]};return e.payload=t,e}const d=a().tokenContextValuePattern.exec(r);if(null!==d){const e=[d[0]],t=(0,u().A$)(d[1]),n={type:a().FormulaTokenType.ContextValue,valueId:t};return e.payload=n,e}const c=a().tokenDatePattern.exec(r);if(null!==c){const e=[c[0]],t={type:a().FormulaTokenType.Date,date:(0,u().P_)(c[1])};return e.payload=t,e}return null}},line_breaks:!1,start_chars_hint:[a().FORMULA_TOKEN_PREFIX]}),V=(0,r().Ey)({name:"IdentifierName",pattern:(q=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const n=new RegExp(q.source,`${q.flags}y`);return n.lastIndex=t,n.exec(e)}),line_breaks:!1});var q;return{WhiteSpace:(0,r().Ey)({name:"WhiteSpace",pattern:/\s+/,group:r().JG.SKIPPED}),NumberLiteral:U,StringLiteral:F,UnclosedStringLiteral:L,Comment:B,UnclosedComment:_,InputToken:D,True:f,False:v,And:h,Or:x,Not:b,IdentifierName:V,Equal:M,NotEqual:N,Plus:o,Minus:i,ExclamationPoint:s,Multi:l,Div:d,Modulo:c,Caret:y,LParen:E,RParen:C,LBracket:R,RBracket:I,AdditionOperator:e,MultiplicationOperator:p,LessThan:T,GreaterThan:k,QuestionMark:P,Colon:S,Comma:A,Dot:O,UnaryOperator:t,EqualityOperator:w,RelationalOperator:g,BooleanLiteral:m}}()));const p=o().Bj((e=>new(r().JG)(function(e){return Object.values(e)}(e))));class l extends r().cA{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this.formulaTokens=void 0,this.c1=void 0,this.expression=this.RULE("expression",(()=>{this.SUBRULE(this.conditionalExpression)})),this.primaryExpression=this.RULE("primaryExpression",(()=>{this.OR(this.c1||(this.c1=[{ALT:()=>this.SUBRULE(this.parenthesisExpression)},{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.CONSUME(this.formulaTokens.NumberLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.StringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.UnclosedStringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.BooleanLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}]))})),this.conditionalExpression=this.RULE("conditionalExpression",(()=>{this.SUBRULE(this.logicalOrExpression,{LABEL:"condition"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.QuestionMark),this.SUBRULE2(this.logicalOrExpression,{LABEL:"expIfTrue"}),this.CONSUME(this.formulaTokens.Colon),this.SUBRULE3(this.logicalOrExpression,{LABEL:"expIfFalse"})}))})),this.logicalOrExpression=this.RULE("logicalOrExpression",(()=>{this.SUBRULE(this.logicalAndExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Or),this.SUBRULE2(this.logicalAndExpression,{LABEL:"rhs"})}))})),this.logicalAndExpression=this.RULE("logicalAndExpression",(()=>{this.SUBRULE(this.equalityExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.And),this.SUBRULE2(this.equalityExpression,{LABEL:"rhs"})}))})),this.equalityExpression=this.RULE("equalityExpression",(()=>{this.SUBRULE(this.relationalExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.EqualityOperator),this.SUBRULE2(this.relationalExpression,{LABEL:"rhs"})}))})),this.relationalExpression=this.RULE("relationalExpression",(()=>{this.SUBRULE(this.additionExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.RelationalOperator),this.SUBRULE2(this.additionExpression,{LABEL:"rhs"})}))})),this.additionExpression=this.RULE("additionExpression",(()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.AdditionOperator),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})}))})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{this.SUBRULE(this.exponentiationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.MultiplicationOperator),this.SUBRULE2(this.exponentiationExpression,{LABEL:"rhs"})}))})),this.exponentiationExpression=this.RULE("exponentiationExpression",(()=>{this.SUBRULE(this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Caret),this.SUBRULE2(this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this.CONSUME(this.formulaTokens.UnaryOperator)})),this.SUBRULE(this.primaryExpression),this.MANY((()=>{this.SUBRULE2(this.memberCallSubExpression)}))})),this.memberCallSubExpression=this.RULE("memberCallSubExpression",(()=>{this.OR([{ALT:()=>this.SUBRULE(this.dotMemberExpression)},{ALT:()=>this.SUBRULE(this.callArguments)}])})),this.dotMemberExpression=this.RULE("dotMemberExpression",(()=>{this.CONSUME(this.formulaTokens.Dot),this.OR([{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{GATE:()=>{var e;const t=this.LA(1);return t.tokenType===this.formulaTokens.InputToken&&(null===(e=t.payload)||void 0===e?void 0:e.type)===a().FormulaTokenType.BlockProperty},ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}])})),this.callArguments=this.RULE("callArguments",(()=>{this.CONSUME(this.formulaTokens.LParen),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RParen)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{this.CONSUME(this.formulaTokens.LParen),this.SUBRULE(this.expression),this.CONSUME(this.formulaTokens.RParen)})),this.arrayExpression=this.RULE("arrayExpression",(()=>{this.CONSUME(this.formulaTokens.LBracket),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RBracket)})),this.formulaTokens=e,this.performSelfAnalysis()}}const d=o().Bj((e=>new l(e)));function c(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e.message);if(null!==t)return{type:i().M9.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e.message)return{type:i().M9.UnclosedStringLiteral,offset:e.offset};if("unclosed comment"===e.message)return{type:i().M9.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e.message}`)}const y={RParen:")",RBracket:"]",Colon:":"};function m(e){const t=e.token.tokenType===r().LT?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const n=/Expecting token of type --> (.+) <-- but found/.exec(e.message);if(null!==n){const e=n[1],r=y[e];if(void 0!==r)return{type:i().M9.TokenExpected,token:r,offset:t}}break}case"NoViableAltException":{const n=e.context.ruleStack[e.context.ruleStack.length-1];switch(n){case"primaryExpression":return{type:i().M9.ExpressionExpected,offset:t};case"dotMemberExpression":return{type:i().M9.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${n}`)}case"NotAllInputParsedException":return{type:i().M9.EndOfInputExpected,offset:t}}return{type:i().M9.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}},80979:(e,t,n)=>{n.r(t),n.d(t,{FormulaParsingInstrumentation:()=>s().nM,addTypesToFormulaAST:()=>a().y,addTypesToFormulaASTAsync:()=>a()._,analyzeFormula:()=>g,analyzeFormulaSync:()=>T,cleanFormulaTypecheckerErrors:()=>h,convertCollectionFormulaToFormula2:()=>d().Jb,convertFormulaCSTToAST:()=>p().f,createFormulaDataRequestSyncHandler:()=>i().zg,evaluateCollectionFormula2:()=>c().MC,evaluateCollectionFormula2WithoutCache:()=>c().kL,evaluateFormulaASTAsync:()=>o().cZ,evaluateFormulaProperty:()=>y().L7,evaluateRawCollectionFormula2:()=>c().UJ,executeFormulaAsync:()=>b,executeFormulaSync:()=>x,findFormulaTypecheckContextValue:()=>i().IV,formulaResultAndOldFormulaValueEqual:()=>i().bW,formulaValueToCollectionFormulaValue:()=>c().Y7,getFormula2Dependencies:()=>w,getFormula2ResultCache:()=>c().wr,getFormula2Thunk:()=>c().J6,getFormulaDependencies:()=>k,hasUniformType:()=>c().dA,isUniqueFormulaEvaluatorError:()=>i().R2,mapExecuteFormulaResult:()=>c().jA,parseFormulaInputToAst:()=>s().$t,parseFormulaInputToCst:()=>s().tP,primitiveFormulaValueFromPropertySchema:()=>c().LO,processFormulaInput:()=>l().kb,propertyToFormulaValue:()=>y().ws,propertyToFormulaValueAsString:()=>y().by,setFormula2ResultCache:()=>c().wZ,setFormula2Thunk:()=>c().rV,setFormulaParsingInstrumentation:()=>s().BC,textValueToFormulaTokens:()=>i().K5,timestampToFormulaValue:()=>y().NI});var r=()=>n(973647),o=()=>n(3259),a=()=>n(844698),i=()=>n(977345),u=()=>n(501053),s=()=>n(373907),p=()=>n(958970),l=()=>n(106714),d=()=>n(420062),c=()=>n(342581),y=()=>n(383969),m=(n(581454),()=>n(534177)),f=()=>n(349835);const v=Symbol("CleanedFormulaTypecheckerErrorInfo");function h(e){return e.map((e=>{return(0,m().GV)((t=e).type===f().IA.ThisRowTypeNotFound||t.type===f().IA.ThisRowNotBlockWithCollection?{type:t.type}:t.type===f().IA.ContextVariableNotBlockWithCollection?{type:t.type,token:t.token}:t.type===f().IA.MissingPropertyOnThisRow?{type:t.type,property:t.property}:t.type===f().IA.MissingPropertyOnContextVariable?{type:t.type,property:t.property,token:t.token}:t.type===f().IA.MissingContextVariable||t.type===f().IA.MissingBlock?{type:t.type,token:t.token}:t.type===f().IA.CallingNotFunction?{type:t.type,calleeKind:t.callee.kind}:t.type===f().IA.FunctionCallTooFewArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name,numArguments:t.numArguments,minNumParameters:t.minNumParameters}:t.type===f().IA.FunctionCallUnexpectedArgument?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterIndex:t.parameterIndex}:t.type===f().IA.FunctionCallArgumentWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterName:t.expectedParameter.name}:t.type===f().IA.MemberPropertyMismatchCollection?{type:t.type,token:t.token.collection?t.token:{property:t.token.property}}:t.type===f().IA.MemberPropertyMissing?{type:t.type,textValproperty:t.property}:t.type===f().IA.MemberPropertyTargetNotBlock?{type:t.type,expressionKind:t.expression.kind}:t.type===f().IA.MemberPropertyTypeInvalid||t.type===f().IA.BlockPropertyTypeInvalid?{type:t.type,propertyName:t.propertyName,propertyType:t.propertyType}:t.type===f().IA.UndefinedIdentifier?{type:t.type,identifier:t.node}:t.type===f().IA.UnifiedFunctionCannotFindFunction?{type:t.type,name:t.name}:t.type===f().IA.UnifiedFunctionNoArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name}:t.type===f().IA.UnifiedFunctionTargetWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,expressionKind:t.expression.kind}:t.type===f().IA.CannotRelativelyCompareTypes?{type:t.type,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===f().IA.CannotDoMathOnType?{type:t.type,nodeKind:t.node.kind,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===f().IA.UnaryMinusOnNonNumber?{type:t.type,nodeKind:t.node.kind}:t.type===f().IA.IdentifierExpected?{type:t.type,startOffset:t.node.startOffset}:t.type===f().IA.FunctionCallExpected?{type:t.type,startOffset:t.node.startOffset,functionName:t.functionName}:t.type===f().IA.RenamedIdentifier?{type:t.type,identifier:t.identifier,renamedTo:t.renamedTo}:t.type===f().IA.RemovedFunction?{type:t.type,functionName:t.functionName,alternative:t.alternative}:t.type===f().IA.DisallowedReturnType?{type:t.type,startOffset:t.node.startOffset,returnType:t.returnType.type,allowedReturnTypes:t.allowedReturnTypes.map((e=>e.type))}:t.type===f().IA.CrossSpacePropertyNotSupported?{type:t.type,property:t.property}:void(0,m().HB)(t),v);var t}))}function x(e,t){const n=(0,s().$t)(e);return r().Q.isFail(n)?n:(0,o().G8)(n.value,t)}async function b(e,t){const n=(0,s().$t)(e);return r().Q.isFail(n)?n:await(0,o().cZ)(n.value,t)}async function g(e,t){const n=(0,s().$t)(e);if(r().Q.isFail(n))return{value:{parseErrors:[n.error]}};const o=await(0,a()._)(n.value,t),{node:i,errors:u}=o;return{value:{type:i.type,typeErrors:u}}}function T(e,t){const n=(0,s().$t)(e);if(r().Q.isFail(n))return{parseErrors:[n.error]};const o=(0,a().y)(n.value,t),{node:i,errors:u}=o;return{type:i.type,typeErrors:u}}function k(e){return"formula"!==e.type?[]:"v2"===e.version?e.formula2?w(e.formula2.code):[]:(0,u().kh)(e.formula)}function w(e){const t=(0,s().$t)(e);return r().Q.isFail(t)?[]:(0,i().Mu)(t.value)}},96033:(e,t,n)=>{n.d(t,{F$:()=>i,nA:()=>a,o9:()=>u});n(16280);var r=()=>n(220719);class o extends Error{constructor(e){super(`Violated invariant in the formula compiler: ${e}`)}}function a(e){return"type"in e&&"compiledCode"===e.type}function i(e){if(null!==e&&"object"==typeof e&&"type"in e&&"compiledCode"===e.type)throw new o("unexpected compiled code");return e}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected value to exist";return r().o9(e,t,void 0,o)}},197499:(e,t,n)=>{n.d(t,{xK:()=>$,Fd:()=>U,P7:()=>F,SU:()=>P,KN:()=>_,R:()=>B,Py:()=>ne,HH:()=>ie,Y2:()=>ae,pC:()=>re,hq:()=>S,_2:()=>V,iZ:()=>D,sj:()=>oe,Hx:()=>J,kk:()=>W,tr:()=>ee,m8:()=>X,qs:()=>H,ZV:()=>z,fr:()=>j});n(18107),n(944114),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(737550);var r=n.n(n(794148)),o=()=>n(381349),a=()=>n(496603),i=()=>n(713998),u=()=>n(244149),s=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(450648)),p=()=>n(919709);var l=()=>n(597777),d=()=>n(604995),c=()=>n(992437),y=()=>n(510916),m=(n(16280),()=>n(534177)),f=()=>n(179034),v=()=>n(798880),h=()=>n(349835);function x(e){if(e.kind===h().NM.Boolean||e.kind===h().NM.LogicalAnd||e.kind===h().NM.LogicalOr||e.kind===h().NM.Relational||e.kind===h().NM.Equality)return"checkbox";if(e.kind===h().NM.Number||e.kind===h().NM.Additive||e.kind===h().NM.Exponentiation||e.kind===h().NM.Multiplicative)return"number";if(e.kind===h().NM.String)return"text";if(e.kind===h().NM.Array)return"array";if(e.kind===h().NM.Unary){if("-"===e.op)return"number";if("!"===e.op||"not"===e.op)return"checkbox";(0,m().HB)(e.op)}else{if(e.kind===h().NM.Call||e.kind===h().NM.Conditional||e.kind===h().NM.Identifier||e.kind===h().NM.MemberBlockProperty||e.kind===h().NM.NotionToken||e.kind===h().NM.UnifiedFunctionProperty||e.kind===h().NM.RecoveryNode)return"undefined";(0,m().HB)(e)}}var b=()=>n(96033),g=()=>n(247331),T=()=>n(662358),k=()=>n(977345),w=()=>n(628048);class M extends Error{constructor(e){super(`Not implemented for the formula compiler: ${e}`)}}const N=new WeakMap;function E(e){switch(e.kind){case h().NM.Number:return[{type:"loadConstant",node:e,value:{type:"number",value:parseFloat(e.text)}}];case h().NM.String:return[{type:"loadConstant",node:e,value:{type:"text",value:[[e.text]]}}];case h().NM.Boolean:return[{type:"loadConstant",node:e,value:{type:"checkbox",value:"true"===e.text.toLowerCase()}}];case h().NM.NotionToken:{const t=e.token;switch(t.type){case g().FormulaTokenType.Checkbox:return[{type:"loadConstant",node:e,value:{type:"checkbox",value:t.checked}}];case g().FormulaTokenType.BlockProperty:return[{type:"loadToken",node:e,token:t}];case g().FormulaTokenType.Block:return[{type:"loadConstant",node:e,value:{type:"block",value:{table:f().ev,id:t.blockId,spaceId:t.spaceId}}}];case g().FormulaTokenType.ContextValue:return[{type:"loadToken",node:e,token:t}];case g().FormulaTokenType.Date:return[{type:"loadConstant",node:e,value:{type:"date",value:t.date}}];case g().FormulaTokenType.Person:return[{type:"loadConstant",node:e,value:{type:"person",value:{table:v().oo,id:t.userId}}}];default:return(0,m().HB)(t)}}case h().NM.Additive:return[...E(e.rhs),...E(e.lhs),{type:"add",node:e}];case h().NM.Multiplicative:return[...E(e.rhs),...E(e.lhs),{type:"multiply",node:e}];case h().NM.Equality:return[...E(e.rhs),...E(e.lhs),{type:"equality",node:e}];case h().NM.Relational:return[...E(e.rhs),...E(e.lhs),{type:"relational",node:e}];case h().NM.Exponentiation:return[...E(e.rhs),...E(e.lhs),{type:"exponentiation",node:e}];case h().NM.Unary:return[...E(e.expression),{type:"unary",node:e}];case h().NM.Array:{const t=[];for(const n of e.elements.slice().reverse())t.push(...E(n));return t.push({type:"makeArray",node:e,numberOfElements:e.elements.length}),t}case h().NM.LogicalAnd:{const t=[];for(const n of e.elements.slice().reverse())t.push(...E(n));return t.push({type:"logicalAnd",node:e,numberOfArguments:e.elements.length}),t}case h().NM.LogicalOr:{const t=[];for(const n of e.elements.slice().reverse())t.push(...E(n));return t.push({type:"logicalOr",node:e,numberOfArguments:e.elements.length}),t}case h().NM.Call:return function(e){const t=[];let n,r;if(e.expression.kind===h().NM.Identifier){if(!w().LP.hasOwnProperty(e.expression.text))throw new(h().I3)({type:h().uW.IdentifierNotFound,node:e.expression});n=e.expression.text,r=e.arguments}else{if(e.expression.kind!==h().NM.UnifiedFunctionProperty)throw new(h().I3)({type:h().uW.CannotCallNonFunction,node:e,calleeType:x(e.expression)});if(!w().LP.hasOwnProperty(e.expression.name))throw new(h().I3)({type:h().uW.UnifiedFunctionPropertyNotFound,node:e.expression});n=e.expression.name,r=[e.expression.expression,...e.arguments]}if("let"===n||"lets"===n)throw new M("let/lets");if("if"===n||"ifs"===n)throw new M("if/ifs");const o=w().LP[n],a=(0,k().ab)(o);if(r.length<a)throw new(h().I3)({type:h().uW.FunctionCallTooFewArguments,node:e,libraryFunction:o,numArguments:r.length});const i=r.map(((t,n)=>{const r=(0,k().Pf)(o,n);if(void 0===r)throw new(h().I3)({type:h().uW.FunctionCallUnexpectedArgument,node:e,argument:t,libraryFunction:o,parameterIndex:n});return Array.isArray(r.type)||"expression"!==r.type.type?E(t):[{type:"loadConstant",node:t,value:{type:"compiledCode",instructions:E(t)}}]}));return t.push(...i.reverse().flat()),t.push({type:"callLibraryFunction",node:e,libraryFunction:o,numberOfArguments:r.length,argumentNodes:r}),t}(e);default:throw new M(`compile node: ${e.kind}`)}}class C{constructor(){this.underlying=[]}push(e){this.underlying.push(e)}popValueOrCode(){return(0,b().o9)(this.underlying.pop())}popValue(){return(0,b().F$)(this.popValueOrCode())}}function R(e,t){const n=function(e){const t=N.get(e);if(t)return t;const n=E(e);return N.set(e,n),n}(e);return I(n,t)}function*I(e,t){const n=new C;let r=0;for(;r<e.length;){if(t.formulaTimeoutTimestampMs&&Date.now()>t.formulaTimeoutTimestampMs)throw t.logFormulaTimeoutFn&&t.logFormulaTimeoutFn(),new(h().I3)({type:h().uW.MaxEvaluationTimeExceeded});const a=e[r];if(r++,"loadConstant"===a.type)n.push(a.value);else if("add"===a.type){const{node:e}=a,t=n.popValue(),r=n.popValue();n.push((0,T().LL)(e,t,r))}else if("multiply"===a.type){const{node:e}=a,t=n.popValue(),r=n.popValue();n.push((0,T().Rn)(e,t,r))}else if("equality"===a.type){const{node:e}=a,r=n.popValue(),o=n.popValue(),i=yield*(0,k().zV)(r,o,t),u=e.op;switch(u){case"==":return{type:"checkbox",value:i};case"!=":return{type:"checkbox",value:!i};default:return(0,m().HB)(u)}}else if("logicalAnd"===a.type){const e=[];for(let r=0;r<a.numberOfArguments;r++)e.push(n.popValue());const t=e.map(k().CL);n.push({type:"checkbox",value:t.every((e=>e))})}else if("logicalOr"===a.type){const e=[];for(let r=0;r<a.numberOfArguments;r++)e.push(n.popValue());const t=e.map(k().CL);n.push({type:"checkbox",value:t.some((e=>e))})}else if("makeArray"===a.type){const e=[];for(let t=0;t<a.numberOfElements;t++)e.push(n.popValue());n.push({type:"array",values:e})}else if("relational"===a.type){const{node:e}=a,r=n.popValue(),o=n.popValue();n.push(yield*(0,T().MA)(e,r,o,t))}else if("exponentiation"===a.type){const{node:e}=a,t=n.popValue(),r=n.popValue();n.push((0,T().oj)(e,t,r))}else if("unary"===a.type){const{node:e}=a,t=n.popValue();n.push((0,T().If)(e,t))}else if("callLibraryFunction"===a.type){const{libraryFunction:e}=a,r=[];for(let t=0;t<a.numberOfArguments;t++){let o=n.popValueOrCode();if("compiledCode"!==o.type){const n=(0,k().Pf)(e,t);(0,m().O9)(n)&&(o=(0,T().qL)({value:o,callNode:a.node,argumentNode:a.argumentNodes[t],parameterIndex:t,libraryFunction:e,expectedParameter:n}))}r.push(o)}try{n.push(yield*e.eval(r,t))}catch(o){if(o instanceof h().I3)throw o;throw new(h().I3)({type:h().uW.LibraryFunctionExecutionError,node:a.node,libraryFunction:e,error:o})}}else if("loadToken"===a.type){const{node:e,token:r}=a;r.type===g().FormulaTokenType.BlockProperty?n.push(yield*(0,T().ir)({node:e,token:r,context:t,evaluateAST:R})):r.type===g().FormulaTokenType.ContextValue?n.push((0,T().ym)({node:e,token:r,context:t})):(0,m().HB)(r)}else(0,m().HB)(a)}return n.popValue()}var A=()=>n(3259),O=()=>n(696446);function P(e,t,n){return{name:e,eval:function*(e,t){return{type:"number",value:n}},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}()`,output:n.toString()}]],syntax:[`${e}()`],description:t}}function S(e,t,n,o){const a=o.map((t=>({input:`${e}(${t})`,output:`${n(t)}`}))),i=o.map((t=>({input:`${t}.${e}()`,output:`${n(t)}`})));return{name:e,eval:function*(e,t){const[o]=e;return r()("number"===o.type),{type:"number",value:n(o.value)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[a,i],syntax:[`${e}(number)`,`number.${e}()`],description:t}}function F(e,t,n,o){return{name:e,eval:function*(t,o){let[a,i]=t;if(g().TREAT_UNDEFINED_AS_ZERO_FNS.includes(e)){if("undefined"===a.type&&"undefined"===i.type)return{type:"number",value:0};"undefined"===a.type&&"number"===i.type?a={type:"number",value:0}:"undefined"===i.type&&"number"===a.type&&(i={type:"number",value:0})}return r()("number"===a.type&&"number"===i.type),{type:"number",value:n(a.value,i.value)}},parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}(5, 10)`,output:`${n(5,10)}`},{input:`5 ${o} 10`,output:`${n(5,10)}`}],[{input:`5.${e}(10)`,output:`${n(5,10)}`},{input:`5 ${o} 10`,output:`${n(5,10)}`}]],syntax:[`${e}(number, number)`,`number.${e}(number)`],description:t}}const L=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];function*U(e,t,n){let r=yield*(0,k().o7)(e,t);if("s"!==r.at(-1)&&(r+="s"),!L.includes(r.toLowerCase()))throw new(h().x4)({type:h().v3.DateInvalidDurationUnit,invalidUnit:r,functionName:n});return r}function B(e,t){return function*(n,o){const[a,i,u]=n;r()("date"===a.type&&"number"===i.type&&"text"===u.type);const s="datetime"===a.value.type||"datetimerange"===a.value.type?a.value.time_zone:o.userTimeZone,p=(0,d().AA)(a.value,s),l=yield*U(u.value,o,t),c=e(p.start,i.value,l),y="hours"===l||"minutes"===l||"seconds"===l||"milliseconds"===l;return{type:"date",value:"date"!==a.value.type&&"daterange"!==a.value.type||y?(0,d().KQ)(c,s):(0,d().p6)(c,s)}}}function _(e){return function*(t,n){const[o]=t;r()("date"===o.type);const a=(0,d().kW)(o.value,n.userTimeZone);return{type:"number",value:e((0,d().AA)((0,l().j1)(a),n.userTimeZone,n.intl.locale).start)}}}function*D(e,t){try{return yield*function*(e,t){return(0,b().nA)(e)?yield*I(e.instructions,t):yield*(0,A().yN)(e,t)}(e,t)}catch(n){if("info"in n&&"type"in n.info&&n.info.type===h().uW.DepthExceeded)throw n;return{type:"undefined"}}}function V(e,t,n){return(0,O().KZ)(e.map(((e,r)=>D(t,{...n,values:[{kind:g().FormulaContextValueKind.Binding,id:g().CURRENT_VALUE_NAME,value:e},{kind:g().FormulaContextValueKind.Binding,id:g().CURRENT_INDEX_NAME,value:{type:"number",value:r}},...n.values]}))))}const q={b:["b"],i:["i"],s:["s"],u:["_"],c:["c"]},Z=["b","i","s","_","c","h"];function W(e){const t=[];return e.forEach((e=>{var n;const r=null==e||null===(n=e[0])||void 0===n?void 0:n[0].toLowerCase().split(",");for(const o of r){const e=K(o);if(e)t.push(e);else{const e=q[o];e&&t.push(e)}}})),t}function $(e,t){return e.map((e=>{const n=(0,p().uPN)(e);return(0,p().Ey_)((0,p().N8A)(e),[...n,...t])}))}function H(e,t){return e.map((e=>(0,p().Ey_)((0,p().N8A)(e),(0,p().uPN)(e).filter((e=>{const n=(0,p()._XS)(e);return!Z.includes(n)||void 0!==t&&!t.some((t=>n===t[0]&&(void 0===t[1]||e[1]===t[1])))})))))}function K(e){const t=o().Wr.find((t=>t===e));return t?[p().Ifu.Highlight,t]:"green"===e?[p().Ifu.Highlight,"teal"]:"green_background"===e?[p().Ifu.Highlight,"teal_background"]:"grey"===e?[p().Ifu.Highlight,"gray"]:"grey_background"===e?[p().Ifu.Highlight,"gray_background"]:void 0}function*z(e,t){if(Q(e))return e.sort(((e,n)=>G({left:e,right:n,context:t})));const n=(0,a().oE)(e.flatMap((e=>(0,k().vu)(e)))),r=n.length?(yield{recordPointers:n}).getRecordModel:c().b.constant(void 0),o=e.map((e=>(0,u().R2)({result:e,getRecordModel:r,userTimeZone:t.userTimeZone,intl:t.intl,useImprovedSort:!0})));return(0,a().yU)(e,o).sort(((e,t)=>(0,u().a7)(e[1],t[1],{}))).map((e=>{let[t]=e;return t}))}function*j(e,t,n){const r=yield*V(e,t,n);if(Q(r)){return(0,a().yU)(e,r).sort(((e,t)=>G({left:e[1],right:t[1],context:n}))).map((e=>{let[t]=e;return t}))}const o=(0,a().oE)(r.flatMap((e=>(0,k().vu)(e)))),i=o.length?(yield{recordPointers:o}).getRecordModel:c().b.constant(void 0),s=r.map((e=>(0,u().R2)({result:e,getRecordModel:i,userTimeZone:n.userTimeZone,intl:n.intl,useImprovedSort:!0})));return(0,a().yU)(e,s).sort(((e,t)=>(0,u().a7)(e[1],t[1],{}))).map((e=>{let[t]=e;return t}))}const Y=["number","date","checkbox","undefined"];function Q(e){let t;return e.every((e=>"undefined"===e.type||(void 0===t?!!Y.includes(e.type)&&(t=e.type,!0):t===e.type)))}function G(e){const{left:t,right:n,context:r}=e;return"date"===t.type&&"date"===n.type?(0,k().i3)(t.value,n.value,r.userTimeZone):"number"===t.type&&"number"===n.type?t.value-n.value:"checkbox"===t.type&&"checkbox"===n.type?t.value===n.value?0:t.value?1:-1:"undefined"===t.type?"undefined"===n.type?0:1:"undefined"===n.type?-1:0}function J(e){const t=[];for(const n of e)if("array"===n.type){const e=J(n.values);t.push(...e)}else"number"===n.type&&t.push(n.value);return t}function X(e){const{timeZone:t,context:n}=e;if("text"===(null==t?void 0:t.type)){const e=(0,p().k4p)(t.value);if(e.startsWith("GMT")&&e.length>3){return`Etc/GMT${"-"===e[3]?"+":"-"}${e.slice(4)}`}return e}return n.userTimeZone}function*ee(e,t,n,r,o){const a=yield*te(e,o,{disableAnnotationPrefix:!1}),i=yield*te(n,o),u=Math.min(Math.floor(t),1e4),s=(0,p().AhH)(a);if(s>=t)return{type:"text",value:e};const l=(0,p().AhH)(i),d=u-s,c=l>0?Math.floor(d/l):0,y=d%l,m=[];"end"===r&&m.push(...e);for(let p=0;p<c;p++)m.push(...i);return y>0&&m.push(...(0,p().AI5)(i,0,y).tokensInsideRange),"start"===r&&m.push(...e),{type:"text",value:(0,p().__s)(m)}}function*te(e,t,n){const r=(0,i().dg)(e);return function(e){const{textValue:t,getRecordModel:n,userTimeZone:r,intl:o,seenBlocks:a=new Set,deterministic:i=!1,disableAnnotationPrefix:u=!1,disableInsertedAnnotations:l=!1,renderDateAnnotationsAsISO:d=!1,externalIntegrations:c}=e,y=[],m=u?"":"@",f=p().RQ(t);for(const v of f){const e=p().uPN(v);if(!e.length){y.push(v);continue}const u=(0,s().t2)({token:v,getRecordModel:n,userTimeZone:r,deterministic:i,intl:o,seenBlocks:a,prefix:m,disableInsertedAnnotations:l,renderDateAnnotationsAsISO:d,externalIntegrations:c}),f=(0,s().Px)(e,l);(null!=t&&t.length||f.length)&&y.push((0,p().Ey_)(u??"",f))}return y}({textValue:e,getRecordModel:r.length?(yield{recordPointers:r}).getRecordModel:c().b.constant(void 0),userTimeZone:t.userTimeZone,deterministic:!0,intl:t.intl,disableAnnotationPrefix:!0,...n})}function ne(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:e,property:e}))}function re(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:(0,y().i)(e),property:e}))}function*oe(e,t){if(e.length<3||e.length%2!=1)throw new(h().x4)({type:h().v3.NotEnoughArguments});const n={...t};for(let o=0;o<e.length-1;o+=2){const t=e[o],r=e[o+1];if(t.kind!==h().NM.Identifier)throw new(h().x4)({type:h().v3.LetBindingNameNotIdentifier,node:t});const a=yield*D(r,n);n.values=[{kind:g().FormulaContextValueKind.Binding,id:t.text,value:a},...n.values]}const r=e[e.length-1];return yield*(0,A().yN)(r,n)}function ae(e){return(0,p().wmz)((0,p().ESw)(e))}function ie(e){return(0,p().wmz)((0,p().CA$)(e))}},342581:(e,t,n)=>{n.d(t,{J6:()=>M,LO:()=>N,MC:()=>f,UJ:()=>h,Y7:()=>g,dA:()=>T,jA:()=>b,kL:()=>v,rV:()=>w,wZ:()=>E,wr:()=>C});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(581454);var r=()=>n(496603),o=()=>n(973647),a=()=>n(244149),i=()=>n(632905),u=()=>n(869190),s=()=>n(236162),p=()=>n(792071),l=()=>n(247331),d=()=>n(80979),c=()=>n(349835),y=()=>n(977345),m=()=>n(383969);function f(e){const{block:t,property:n,getRecordModel:r,formula2Error:a,resultCache:i,logFormulaStatsFn:u}=e,d=performance.now(),y=C({resultCache:i,blockId:t.id,property:n});if(void 0!==y)return null==u||u({executionTimeMs:performance.now()-d,cachedCount:1}),g(y);const m=(0,s().zN)({block:t,getRecordModel:r}),f=p().Bj6.fromValue("collection",m);if(!f)return;const h=M({blockModel:t,collectionVersion:f.getVersion(),propertyId:n});if(h){"undefined"==typeof window&&(null==u||u({error:"collection_formula_evaluator_got_thunk_on_server"}));const e=h();if(e&&e!==l().FORMULA_LOADING)return o().Q.isFail(e)?(null==u||u({executionTimeMs:performance.now()-d,cachedCount:1,error:e.error.type}),void(null===(null==a?void 0:a.error)&&(0,c().Lc)(e.error)&&(a.error=new(c().I3)(e.error)))):e.value}const x=v(e);if(null==u||u({executionTimeMs:performance.now()-d,uncachedCount:1}),!x)return;const T=b(x);return o().Q.isFail(T)?(null==u||u({error:T.error.type}),void(null===(null==a?void 0:a.error)&&(0,c().Lc)(T.error)&&(a.error=new(c().I3)(T.error)))):T.value}function v(e){const t=x(e);if(t)return b(t)}function h(e){return x(e)}function x(e){const{block:t,formulaCode:r,property:o,getRecordModel:a,intl:i,userTimeZone:u,depth:s,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,publicPageDataCollection:f,resultCache:v,regExpCache:h,formatDateCache:x,experimentService:b,collectionFeatureGates:g}=e;if(!n(80979))return;const T={values:[{kind:l().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}}],handleDataRequest:(0,y().zg)(a),intl:i,userTimeZone:u,depth:s,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,resultCache:v,regExpCache:h,formatDateCache:x,publicPageDataCollection:f,experimentService:b,spaceId:t.space_id,collectionFeatureGates:g},k=(0,d().executeFormulaSync)(r,T);return"value"in k&&E({resultCache:v,blockId:t.id,property:o,value:k.value}),k}function b(e){return o().Q.isFail(e)?e:{value:g(e.value)}}function g(e){if("function"===e.type)return{type:"undefined"};if("array"===e.type){var t;if(0===e.values.length)return{type:"undefined"};const n={type:"array",values:(0,y().U)(e).values.filter((e=>"undefined"!==e.type))};if(!T(n)){const e=r().oE(n.values.map((e=>{if("array"!==e.type)return{type:"text",value:(0,y().Ht)(e)}})));return{type:"array",values:e}}return"function"===(null===(t=n.values[0])||void 0===t?void 0:t.type)?{type:"undefined"}:n}return e}function T(e){return 0===e.values.length||e.values.every((t=>t.type===e.values[0].type))}const k=new WeakMap;function w(e){const{blockModel:t,collectionVersion:n,propertyId:r,thunkCallback:o}=e,a=k.get(t),i={collectionVersion:n,thunkCallback:o};void 0===a?k.set(t,{[r]:i}):a[r]=i}function M(e){const{blockModel:t,collectionVersion:n,propertyId:r}=e,o=k.get(t),a=null==o?void 0:o[r];return a?a.collectionVersion!==n?void delete o[r]:a.thunkCallback:void 0}function N(e){let{schema:t,property:n,blockModel:r,getRecordModel:o,intl:i,userTimeZone:s,depth:p,resultCache:l,regExpCache:d,formatDateCache:c,formulaTimeoutTimestampMs:y,visitedProperties:v,formula2Error:h,experimentService:x,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:b,collectionFeatureGates:g}=e;const T=t[n];if("v2"===T.version){if(!T.formula2)return;const e=f({block:r,property:n,formulaCode:T.formula2.code,getRecordModel:o,intl:i,userTimeZone:s,depth:p,visitedProperties:v??new Set,formulaTimeoutTimestampMs:y,formula2Error:h,resultCache:l,regExpCache:d,formatDateCache:c,experimentService:x,collectionFeatureGates:g});if(!e)return;return"date"===e.type?b?e.value:(0,u().ZF)({value:e.value,userTimeZone:s,intl:i,allowRelativeDates:!1}):(0,a().R2)({result:e,getRecordModel:o,userTimeZone:s,intl:i})}{const{formula:e}=T;if(e)return(0,m().L7)({schema:t,property:n,block:r,getRecordModel:o,collectionRequestContext:{userId:void 0,userTimeZone:s,depth:p,intl:i,resultCache:l,regExpCache:d,formatDateCache:c,visitedProperties:v??new Set,formulaTimeoutTimestampMs:y,experimentService:x,collectionFeatureGates:g},formula2Error:h})}}function E(e){let{resultCache:t,blockId:n,property:r,value:o}=e;const a=t.get(n)??new Map;a.set(`${r}:${i().A.FormulaValue2}`,o),t.set(n,a)}function C(e){var t;let{resultCache:n,blockId:r,property:o}=e;return null===(t=n.get(r))||void 0===t?void 0:t.get(`${o}:${i().A.FormulaValue2}`)}},373907:(e,t,n)=>{n.d(t,{$t:()=>f,BC:()=>m,nM:()=>c,tP:()=>l});n(16280),n(944114),n(898992),n(354520);var r=()=>n(534177),o=()=>n(857639),a=()=>n(958970),i=()=>n(247331),u=()=>n(106714),s=()=>n(44907),p=()=>n(349835);function l(e,t){const n=(0,s().p8)(),r=(0,s().TM)(n).tokenize(e),a=[];for(const o of r.errors)a.push((0,s().Q7)(o));for(const o of r.tokens.filter((e=>e.tokenType===n.UnclosedStringLiteral||e.tokenType===n.UnclosedComment)))a.push({type:o.tokenType===n.UnclosedStringLiteral?p().M9.UnclosedStringLiteral:p().M9.UnclosedComment,offset:t?(0,u().c3)(t,o.startOffset,"left"):o.startOffset});for(const o of r.tokens.filter((e=>e.tokenType===n.StringLiteral)))i().FORMULA_TOKEN_REGEX.test(o.image)&&a.push({type:p().M9.StringLiteralContainsToken,offset:t?(0,u().c3)(t,o.startOffset,"left"):o.startOffset});try{const e=(0,s()._M)(n);e.input=r.tokens;const t=e.expression();for(const n of e.errors)a.push((0,s().Ps)(n));return[t,a]}catch(l){if(l instanceof RangeError&&"Maximum call stack size exceeded"===l.message)a.push({type:p().M9.TooDeeplyNested,offset:0});else{const e=l instanceof Error?l:new Error("Unknown parsing error");o().log({level:"error",from:"parseFormulaInputToCst",type:"formulaParserUnexpectedError",error:e}),a.push({type:p().M9.UnexpectedError,offset:0,error:e})}return[{name:"",children:{}},a]}}const d=new WeakMap;class c{constructor(){this.debug=!1}logCacheResult(e,t){this.incrMetric(t?"formulas.parsing.weak_map_cache.hit":"formulas.parsing.weak_map_cache.miss")}incrMetric(e){this.debug&&console.log(e),this.incrMetricImpl(e)}}let y;function m(e){y||(y=e())}function f(e){var t;let n=d.get(e);if(null===(t=y)||void 0===t||t.logCacheResult(e,(0,r().O9)(n)),void 0!==n)return n;const[o,i]=(0,u().kb)(e),[s,p]=l(o);return n=p.length>0?{error:p[0]}:(0,a().f)(s),d.set(e,n),n}},383969:(e,t,n)=>{n.d(t,{L7:()=>x,NI:()=>w,by:()=>N,ws:()=>g});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var r=()=>n(496603),o=()=>n(534177),a=()=>n(764880),i=()=>n(713998),u=()=>n(568063),s=()=>n(632905),p=()=>n(597777),l=()=>n(869190),d=()=>n(604995),c=()=>n(792071),y=()=>n(919709),m=()=>n(80979),f=()=>n(349835),v=()=>n(565775);const h=15;function x(e){const{schema:t,property:n,block:a,getRecordModel:i,collectionRequestContext:u,formula2Error:l}=function(e){return"getRecordModel"in e?e:{...e,block:c().Bj6.fromBlock(e.block),getRecordModel:c().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{depth:d,resultCache:y,visitedProperties:m,formulaTimeoutTimestampMs:v,logFormulaTimeoutFn:x}=u,g=t[n];if(!g||"formula"!==g.type||!g.formula)return;const{formula:T}=g;if(d>h)return void(null===(null==l?void 0:l.error)&&(l.error=new(f().I3)({type:f().uW.DepthExceeded})));const k=`${a.id}:${n}`;if(m.has(k))return void(null===(null==l?void 0:l.error)&&(l.error=new(f().I3)({type:f().uW.CycleDetected})));const w=function(e){var t;let{resultCache:n,blockId:r,property:o}=e;return null===(t=n.get(r))||void 0===t?void 0:t.get(`${o}:${s().A.FormulaValue}`)}({resultCache:y,blockId:a.id,property:n});if(void 0!==w)return w;if(v&&Date.now()>v)return x&&x(),void(null===(null==l?void 0:l.error)&&(l.error=new(f().I3)({type:f().uW.MaxEvaluationTimeExceeded})));const M=new Set(m);M.add(k);try{let e=b({formula:T,schema:t,block:a,getRecordModel:i,collectionRequestContext:{...u,visitedProperties:M},formula2Error:l});if(!("date"!==T.result_type||(0,o().Gv)(e)&&(0,p().cW)(e.type)))return;if(r().Et(e)){if(!r().MI(e))return;e=r().LI(e,12)}return function(e){let{resultCache:t,blockId:n,property:r,value:o}=e;const a=t.get(n)??new Map;a.set(`${r}:${s().A.FormulaValue}`,o),t.set(n,a)}({resultCache:y,blockId:a.id,property:n,value:e}),e}catch(N){return void console.error(N)}}function b(e){const{formula:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i}=function(e){return"getRecordModel"in e?e:{...e,block:c().Bj6.fromBlock(e.block),getRecordModel:c().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{userTimeZone:u,intl:s}=a;if("conditional"===t.type)return b({formula:t.condition,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i})?b({formula:t.true,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i}):b({formula:t.false,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i});if("constant"===t.type){const{value:e,value_type:n}=t;return"string"===n?e:"number"===n?parseFloat(e):"boolean"===n?Boolean(JSON.parse(e)):void 0}if("function"===t.type){const{args:e}=t,p=(e||[]).map((e=>b({formula:e,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i}))),l=v().N9(t.name),d=v().F5(t.name);return l?l.apply(p,u,s,r):d?d.apply(p,u,s,r):void 0}if("property"===t.type)return g({property:t.id,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i});if("operator"===t.type){const{args:e,name:p}=t,l=(e||[]).map((e=>b({formula:e,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:i}))),d=v().F5(p);if(!d)return;return d.apply(l,u,s,r)}if("symbol"===t.type){const{name:e}=t;return e in v().AA?v().AA[e].value:void 0}}function g(e){const t=function(e){return"getRecordModel"in e?e:{...e,block:c().Bj6.fromBlock(e.block),getRecordModel:c().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{property:n,schema:r}=t,o=r[n];if(o)return M[o.type](t)}function T(e){const{property:t,block:n}=e,r=i().yQ(n,t)||[];return y().k4p(r)}function k(e){const{property:t,block:n}=e,r=i().yQ(n,t)||[];return i().MO(r)}function w(e){const{timestampType:t,block:n,userTimeZone:r}=e;if("created_time"===t){if(n.getCreatedTime())return d().KQ(n.getCreatedTime(),r)}else if("last_edited_time"===t){if(n.getLastEditedTime())return d().KQ(n.getLastEditedTime(),r)}else(0,o().HB)(t)}const M={title:T,text:T,url:k,email:k,phone_number:k,select:e=>{let{property:t,schema:n,block:r}=e;const o=i().yQ(r,t)||[],a=n[t].options||[];return i().L3(o,a)},multi_select:e=>{let{property:t,schema:n,block:r}=e;const o=i().yQ(r,t)||[],a=n[t].options||[];return i().o2(o,a).join(", ")},status:e=>{let{property:t,schema:n,block:r}=e;const o=i().yQ(r,t)||[],a=n[t];return i().RZ(o,a)},checkbox:e=>{let{property:t,block:n}=e;const r=i().yQ(n,t)||[];return i().wu(r)},date:e=>{let{property:t,block:r}=e;const o=i().yQ(r,t)||[];return(0,n(787626).b)(o)},person:e=>{let{property:t,block:n,getRecordModel:r,schema:o,collectionRequestContext:u}=e;const{intl:s}=u,p=i().yQ(n,t)||[],l=o[t],d=c().Bj6.fromBlock(n);return i().Y6({textValue:p,propertySchema:l,blockCreatorPointer:d.getCreatedByPointer()}).map((e=>(0,a().lR)(s,(0,a().xC)({pointer:e,getRecordModel:r})))).join(", ")},relation:e=>{let{property:t,block:n,getRecordModel:r,schema:o}=e;const a=i().yQ(n,t)||[],u=o[t];if(!u||"relation"!==u.type)return;return i().bG({relationValue:i().n(a),propertySchema:u,getRecordModel:r,includeNoAccess:!1}).map((e=>{const t=r(e);if(!t)return;const n=i().yQ(t,"title");return n?y().k4p(n):void 0})).join(", ")},rollup:e=>{const{property:t,schema:n}=e,r=n[t];if(!r||"rollup"!==r.type||!r.aggregation||"show_unique"===r.aggregation)return u().I({...e,formulasModule:m()});{const t=u().Pm({...e,formulasModule:m()});if(void 0===t)return;if("text"===t.type)return t.value;if("number"===t.type)return t.value;if("date"===t.type)return t.value;(0,o().HB)(t)}},number:e=>{let{property:t,block:n}=e;const r=i().yQ(n,t)||[];return i().Me(r)},file:e=>{let{property:t,block:n}=e;const r=i().yQ(n,t)||[];return i().pJ(r).map((e=>{let{url:t}=e;return t})).join(", ")},formula:e=>{const{intl:t,userTimeZone:r,formulaTimeoutTimestampMs:o,depth:a,visitedProperties:i,collectionFeatureGates:u}=e.collectionRequestContext;return"v2"===e.schema[e.property].version?(0,n(342581).LO)({schema:e.schema,property:e.property,blockModel:e.block,getRecordModel:e.getRecordModel,intl:t,userTimeZone:r,depth:a+1,formulaTimeoutTimestampMs:o,visitedProperties:i,formula2Error:e.formula2Error,resultCache:e.collectionRequestContext.resultCache,regExpCache:e.collectionRequestContext.regExpCache,formatDateCache:e.collectionRequestContext.formatDateCache,experimentService:e.collectionRequestContext.experimentService,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:!0,collectionFeatureGates:u}):x({...e,collectionRequestContext:{...e.collectionRequestContext,depth:e.collectionRequestContext.depth+1}})},created_time:e=>{let{block:t,collectionRequestContext:n}=e;const{userTimeZone:r}=n,o=c().Bj6.fromBlock(t);if(o.getCreatedTime())return d().KQ(o.getCreatedTime(),r)},last_edited_time:e=>{let{block:t,collectionRequestContext:n}=e;const{userTimeZone:r}=n,o=c().Bj6.fromBlock(t);if(o.getLastEditedTime())return d().KQ(o.getLastEditedTime(),r)},created_by:e=>{let{block:t,getRecordModel:n,collectionRequestContext:r}=e;const{intl:o}=r,i=c().Bj6.fromBlock(t).getCreatedByPointer();if(i)return(0,a().lR)(o,(0,a().xC)({pointer:i,getRecordModel:n}));const u=i&&n(i);return(0,a().lR)(o,u)},last_edited_by:e=>{let{block:t,getRecordModel:n,collectionRequestContext:r}=e;const{intl:o}=r,i=c().Bj6.fromBlock(t).getLastEditedByPointer();if(i)return(0,a().lR)(o,(0,a().xC)({pointer:i,getRecordModel:n}))},button:()=>"",location:()=>"",last_visited_time:()=>"",auto_increment_id:e=>{let{property:t,block:n}=e;const r=i().yQ(n,t)||[];return i().Me(r)},verification:()=>{},place:T};function N(e){const{schema:t,property:n,collectionRequestContext:o}=e,{userTimeZone:a,intl:i}=o,u=g(e),s=t[n];if(!s)throw new Error("Property not found");if(r().Et(u)){if(!r().MI(u))return;return u.toString()}return"boolean"==typeof u?u.toString():p().kC(u)?"date"===s.type?(0,l().ZF)({value:u,userTimeZone:a,allowRelativeDates:!1,intl:i}):void 0:u}},420062:(e,t,n)=>{n.d(t,{Jb:()=>d,lg:()=>s,sr:()=>u});n(16280),n(581454);var r=()=>n(681873),o=()=>n(919709),a=()=>n(565775),i=()=>n(628048);const u={slice:"substring",start:"dateStart",end:"dateEnd"},s={unaryMinus:"-",unaryPlus:"+",larger:">",largerEq:">=",smaller:"<",smallerEq:"<="},p=["add","subtract","multiply","divide","pow","mod","equal","unequal","larger","largerEq","smaller","smallerEq"];function l(e,t,n){return r=e,o=d(e,t,n),"conditional"===r.type||"function"===r.type&&(p.includes(r.name)||["unaryPlus","unaryMinus"].includes(r.name))||"operator"===r.type&&void 0!==r.args&&r.args.length>=2?[["("],...o,[")"]]:o;var r,o}function d(e,t,n){switch(e.type){case"conditional":return[["if("],...l(e.condition,t,n),[", "],...l(e.true,t,n),[", "],...l(e.false,t,n),[")"]];case"constant":switch(e.value_type){case"number":return(0,o().x9d)(`${e.value}`);case"string":const t=e.value.replace(/\n/g,"\\n").replace(/"/g,'\\"').replace(/\t/g,"\\t");return(0,o().x9d)(`"${t}"`);case"boolean":return(0,o().x9d)(""+(e.value?"true":"false"));default:throw new Error(`unexpected constant type: ${e.value_type}`)}case"function":if(p.includes(e.name)){const r="equal"===e.name?"==":"concat"===e.name?"+":a().II[e.name].operator;return[...l(e.args[0],t,n),[` ${r} `],...l(e.args[1],t,n)]}switch(e.name){case"unaryMinus":return[["-"],...l(e.args[0],t,n)];case"unaryPlus":return[["toNumber("],...d(e.args[0],t,n),[")"]];case"month":return[["month("],...d(e.args[0],t,n),[") - 1"]];case"day":return[["day("],...d(e.args[0],t,n),[") % 7"]];case"concat":return[["("],...(0,r().A)((e.args??[]).map((e=>d(e,t,n))),(()=>[[" + "]])).flat(),[")"]];case"join":return[["join("],["["],...(0,r().A)((e.args??[]).slice(1).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),["]"],[", "],...d(e.args[0],t,n),[")"]];default:if("id"===e.name)return(0,o().x9d)("id()");const a=u[e.name]??e.name;if(void 0===i().LP[a])throw new Error(`unexpected formula: ${a}`);return[[`${a}(`],...(0,r().A)((e.args??[]).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),[")"]]}case"operator":var s,c;if(1===(null===(s=e.args)||void 0===s?void 0:s.length))switch(e.operator){case"not":return[["!"],...l(e.args[0],t,n)];case"+":return[["toNumber("],...d(e.args[0],t,n),[")"]];default:return[[`${e.operator}`],...l(e.args[0],t,n)]}if(2===(null===(c=e.args)||void 0===c?void 0:c.length))return[...l(e.args[0],t,n),[` ${e.operator} `],...l(e.args[1],t,n)];if("?"===e.operator)return[...l(e.args[0],t,n),[" ? "],...l(e.args[0],t,n),[" : "],...l(e.args[0],t,n)];throw new Error(`unhandled operator: ${e.operator}`);case"symbol":switch(e.name){case"pi":return(0,o().x9d)("pi()");case"e":return(0,o().x9d)("e()");case"true":return(0,o().x9d)("true");case"false":return(0,o().x9d)("false");default:throw new Error(`unexpected constant: ${e.name}`)}case"property":{const r=n[e.id];if(void 0===r)return[[e.name]];const a=(0,o().wmz)((0,o().ESw)({collection:t,property:e.id,name:r.name}));switch(r.type){case"person":case"relation":return[["join(map("],a,[', format(current)), ", ")']];case"rollup":return r.aggregation&&"show_unique"!==r.aggregation?[a]:[["join(map("],a,[', format(current)), ",")']];case"file":case"multi_select":return[["join("],a,[', ", ")']];case"auto_increment_id":return[a,[".split('-').last().toNumber()"]];default:return[a]}}case"error":throw new Error("unexpected formula error node")}}},628048:(e,t,n)=>{n.d(t,{LP:()=>C,bq:()=>I,Qi:()=>R,Ux:()=>N,MB:()=>E});n(16280),n(18107),n(944114),n(269479),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var r=()=>n(598629),o=()=>n(244641),a=()=>n(498212),i=()=>n(534177),u=()=>n(597777),s=()=>n(604995),p=()=>n(498140),l=()=>n(264435),d=()=>n(416504),c=()=>n(919709),y=()=>n(96033),m=()=>n(247331),f=()=>n(3259),v=()=>n(696446),h=()=>n(145076),x=()=>n(349835),b=()=>n(977345),g=()=>n(197499);const T=(0,n(959013).YK)({if:{id:"database.formula2.operator.if.description",defaultMessage:"Returns the first value if the condition is true; otherwise, returns the second value."},ifs:{id:"database.formula2.operator.ifs.description",defaultMessage:"Returns the value that corresponds to the first true condition. This can be used as an alternative to multiple nested if() statements."},e:{id:"database.formula2.constant.e.description",defaultMessage:"Returns the base of the natural logarithm."},pi:{id:"database.formula2.constant.pi.description",defaultMessage:"Returns the ratio of a circle's circumference to its diameter."},add:{id:"database.formula2.operator.add.description",defaultMessage:"Returns the sum of two numbers."},at:{id:"database.formula2.operator.at.description",defaultMessage:"Returns the value at the specified index in a list."},every:{id:"database.formula2.operator.every.description",defaultMessage:"Returns true if every item in the list satisfies the given condition, and false otherwise."},filter:{id:"database.formula2.operator.filter.description",defaultMessage:"Returns the values in the list for which the condition is true."},find:{id:"database.formula2.operator.find.description",defaultMessage:"Returns the first element in the list for which the condition returns true."},first:{id:"database.formula2.operator.first.description",defaultMessage:"Returns the first item in the list."},flat:{id:"database.formula2.operator.flat.description",defaultMessage:"Flattens a list of lists into a single list."},includes:{id:"database.formula2.operator.includes.description",defaultMessage:"Returns true if the list contains the specified value, and false otherwise."},last:{id:"database.formula2.operator.last.description",defaultMessage:"Returns the last item in the list."},map:{id:"database.formula2.operator.map.description",defaultMessage:"Returns the list populated with the results of calling the expression on every item in the input list."},reverse:{id:"database.formula2.operator.reverse.description",defaultMessage:"Returns the reversed list."},slice:{id:"database.formula2.operator.slice.description",defaultMessage:"Returns the items of the list from the provided start index (inclusive) to the end index (optional and exclusive)."},findIndex:{id:"database.formula2.operator.findIndex.description",defaultMessage:"Returns the index of the first item in the list for which the condition evaluates to true."},unique:{id:"database.formula2.operator.unique.description",defaultMessage:"Returns the list of unique values in the input list."},toPlainText:{id:"database.formula2.operator.toPlainText.description",defaultMessage:"Returns the plain text representation of the input text."},toText:{id:"database.formula2.operator.toText.description",defaultMessage:"Returns the text representation of the input value."},sort:{id:"database.formula2.operator.sort.description",defaultMessage:"Returns the list in sorted order. Optionally, a provided expression can be used to determine the sorting order."},some:{id:"database.formula2.operator.some.description",defaultMessage:"Returns true if any item in the list satisfies the given condition, and false otherwise."},let:{id:"database.formula2.operator.let.description",defaultMessage:"Assigns a value to a variable and evaluates the expression using that variable."},lets:{id:"database.formula2.operator.lets.description",defaultMessage:"Assigns values to multiple variables and evaluates the expression using those variables."},sum:{id:"database.formula2.operator.sum.description",defaultMessage:"Returns the sum of its arguments."},subtract:{id:"database.formula2.operator.subtract.description",defaultMessage:"Returns the difference of two numbers."},multiply:{id:"database.formula2.operator.multiply.description",defaultMessage:"Returns the product of two numbers."},divide:{id:"database.formula2.operator.divide.description",defaultMessage:"Returns the quotient of two numbers."},pow:{id:"database.formula2.operator.pow.description",defaultMessage:"Returns the result of a base number raised to an exponent power."},mod:{id:"database.formula2.operator.mod.description",defaultMessage:"Returns the first number modulo the second number."},equal:{id:"database.formula2.operator.equal.description",defaultMessage:"Returns true if both values are equal and false otherwise."},unequal:{id:"database.formula2.operator.unequal.description",defaultMessage:"Returns false if both values are equal and true otherwise."},concat:{id:"database.formula2.function.concat.description",defaultMessage:"Returns the concatenation of multiple lists."},join:{id:"database.formula2.function.join.description",defaultMessage:"Returns the values of the list with the joiner placed between each of the values."},split:{id:"database.formula2.function.split.description",defaultMessage:"Returns the list of values created by splitting a text by a separator."},substring:{id:"database.formula2.function.slice.description",defaultMessage:"Returns the substring of the text from the start index (inclusive) to the end index (optional and exclusive)."},length:{id:"database.formula2.function.length.description",defaultMessage:"Returns the length of the text or list value."},format:{id:"database.formula2.function.format.description",defaultMessage:"Returns the value formatted as text."},style:{id:"database.formula2.function.style.description",defaultMessage:'Adds styles and colors to the text. Valid formatting styles: "b" (bold), "u" (underline), "i" (italics), "c" (code), or "s" (strikethrough). Valid colors: "gray", "brown", "orange", "yellow", "green", "blue", "purple", "pink", and "red". Add "_background" to colors to set background colors.'},unstyle:{id:"database.formula2.function.unstyle.description",defaultMessage:"Removes formatting styles from the text. If no styles are specified, all styles are removed."},link:{id:"database.formula2.function.link.description",defaultMessage:"Creates a hyperlink from the label text and the URL."},toNumber:{id:"database.formula2.function.toNumber.description",defaultMessage:"Parses a number from text."},contains:{id:"database.formula2.function.contains.description",defaultMessage:"Returns true if the search string is present in the value."},replace:{id:"database.formula2.function.replace.description",defaultMessage:"Replaces the first match of the regular expression with the replacement value."},replaceAll:{id:"database.formula2.function.replaceAll.description",defaultMessage:"Replaces all matches of the regular expression with the replacement value."},test:{id:"database.formula2.function.test.description",defaultMessage:"Returns true if the value matches the regular expression and false otherwise."},match:{id:"database.formula2.function.match.description",defaultMessage:"Returns all matches of the regular expression as a list."},empty:{id:"database.formula2.function.empty.description",defaultMessage:"Returns true if the value is empty. 0, “”, false, and [] are considered empty."},abs:{id:"database.formula2.function.abs.description",defaultMessage:"Returns the absolute value of the number."},cbrt:{id:"database.formula2.function.cbrt.description",defaultMessage:"Returns the cube root of the number."},ceil:{id:"database.formula2.function.ceil.description",defaultMessage:"Returns the smallest integer greater than or equal to the number."},exp:{id:"database.formula2.function.exp.description",defaultMessage:"Returns e^x, where x is the argument, and e is Euler's number (2.718…), the base of the natural logarithm."},floor:{id:"database.formula2.function.floor.description",defaultMessage:"Returns the largest integer less than or equal to the number."},ln:{id:"database.formula2.function.ln.description",defaultMessage:"Returns the natural logarithm of the number."},log10:{id:"database.formula2.function.log10.description",defaultMessage:"Returns the base 10 logarithm of the number."},log2:{id:"database.formula2.function.log2.description",defaultMessage:"Returns the base 2 logarithm of the number."},max:{id:"database.formula2.function.max.description",defaultMessage:"Returns the largest number of the arguments."},min:{id:"database.formula2.function.min.description",defaultMessage:"Returns the smallest number of the arguments."},mean:{id:"database.formula2.function.mean.description",defaultMessage:"Returns the arithmetic average of its arguments."},median:{id:"database.formula2.function.median.description",defaultMessage:"Returns the middle value of its arguments."},mode:{id:"database.formula2.function.mode.description",defaultMessage:"Returns the most commonly occurring value of its arguments."},round:{id:"database.formula2.function.round.description",defaultMessage:"Returns the value of a number rounded to the nearest integer."},sign:{id:"database.formula2.function.sign.description",defaultMessage:"Returns 1 if the number is positive, -1 if it is negative, and 0 if it is zero."},sqrt:{id:"database.formula2.function.sqrt.description",defaultMessage:"Returns the positive square root of the number."},start:{id:"database.formula2.function.start.description",defaultMessage:"Returns the start of the date range."},end:{id:"database.formula2.function.end.description",defaultMessage:"Returns the end of the date range."},now:{id:"database.formula2.function.now.description",defaultMessage:"Returns the current date and time."},today:{id:"database.formula2.function.today.description",defaultMessage:"Returns the current date without the time."},timestamp:{id:"database.formula2.function.timestamp.description",defaultMessage:"Returns the current Unix timestamp, representing the number of milliseconds that have elapsed since January 1, 1970."},fromTimestamp:{id:"database.formula2.function.fromTimestamp.description",defaultMessage:"Returns the date from the given Unix timestamp. The timestamp represents the number of milliseconds that have elapsed since January 1, 1970. Note: the returned date will not retain the seconds & milliseconds."},dateAdd:{id:"database.formula2.function.dateAdd.description",defaultMessage:'Adds time to the date. The unit argument can be one of: "years", "quarters", "months", "weeks", "days", "hours", or "minutes".'},dateSubtract:{id:"database.formula2.function.dateSubtract.description",defaultMessage:'Subtracts time from the date. The unit argument can be one of: "years", "quarters", "months", "weeks", "days", "hours", or "minutes".'},dateBetween:{id:"database.formula2.function.dateBetween.description",defaultMessage:'Returns the difference between two dates. The unit argument can be one of: "years", "quarters", "months", "weeks", "days", "hours", or "minutes".'},formatDate:{id:"database.formula2.function.formatDate.description",defaultMessage:'Formats the date using a custom format string and optional timezone. The format string can contain the following text to represent parts of the date: "YYYY" for year, "MM" for month, "DD" for day, "HH" for hour, "mm" for minute.'},date:{id:"database.formula2.function.date.description",defaultMessage:"Returns the day of the month from the date (1-31)."},day:{id:"database.formula2.function.day.description",defaultMessage:"Returns the day of the week of the date, between 1 (Monday) and 7 (Sunday)."},month:{id:"database.formula2.function.month.description",defaultMessage:"Returns the month of the date (1-12)."},week:{id:"database.formula2.function.week.description",defaultMessage:"Returns the ISO week of the year of the date (1-53)."},year:{id:"database.formula2.function.year.description",defaultMessage:"Returns the year of the date."},hour:{id:"database.formula2.function.hour.description",defaultMessage:"Returns the hour of the date (0-23)."},minute:{id:"database.formula2.function.minute.description",defaultMessage:"Returns the minute of the date (0-59)."},parseDate:{id:"database.formula2.function.parseDate.description",defaultMessage:"Returns the date parsed according to the ISO 8601 standard."},dateRange:{id:"database.formula2.function.dateRange.description",defaultMessage:"Returns a date range constructed from the start and end dates."},dateStart:{id:"database.formula2.function.dateStart.description",defaultMessage:"Returns the start of the date range."},dateEnd:{id:"database.formula2.function.dateEnd.description",defaultMessage:"Returns the end of the date range."},id:{id:"database.formula2.function.id.description",defaultMessage:"Returns the id of the page or person. If no page or person is provided, returns the id of the page the formula is on."},name:{id:"database.formula2.function.name.description",defaultMessage:"Returns the name of a person."},email:{id:"database.formula2.function.email.description",defaultMessage:"Returns the email address of a person."},lower:{id:"database.formula2.function.lower.description",defaultMessage:"Converts the text to lowercase."},upper:{id:"database.formula2.function.upper.description",defaultMessage:"Converts the text to uppercase."},repeat:{id:"database.formula2.function.repeat.description",defaultMessage:"Repeats the text a given number of times."},padStart:{id:"database.formula2.function.padStart.description",defaultMessage:"Returns the text padded with the provided padding string at the start until the target length is reached."},padEnd:{id:"database.formula2.function.padEnd.description",defaultMessage:"Returns the text padded with the provided padding string at the end until the target length is reached."},_wait:{id:"database.formula2.function._wait.description",defaultMessage:"Waits for the specified amount of time, then returns the result."},_unsafeCastArray:{id:"database.formula2.function.unsafeCastArray.description",defaultMessage:"Casts an array of unknown type to the type of the second array parameter"},count:{id:"database.formula2.function.count.description",defaultMessage:"Returns the number of elements in a list for which the condition is true. If no condition is provided, returns the total number of elements (equivalent to length())."}});function k(e){if(!e)throw new Error("Assertion failed in formulaLibraryFunctions")}const w={type:"undefined"},M={name:"expression",type:{type:"expression"},augmentScope:e=>{var t;const n="array"===(null===(t=e[0])||void 0===t?void 0:t.type)?e[0].of:{type:"unknown"};return{[m().CURRENT_VALUE_NAME]:n,[m().CURRENT_INDEX_NAME]:{type:"number"}}}},N={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},M]},E={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{...M,optional:!0}]},C={if:{name:"if",eval:function*(e,t){const[n,r,o]=e;return k("checkbox"===n.type),n.value?yield*(0,f().yN)((0,y().F$)(r),t):yield*(0,f().yN)((0,y().F$)(o),t)},parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}},{name:"ifFalse",type:{type:"expression"}}]},returnType:e=>{let[t,n,r]=e;return void 0!==n&&void 0!==r&&(0,b().Re)(n,r)?n:{type:"unknown"}},iconType:{type:"checkbox"},examples:[[{input:"if(true, 1, 2)",output:"1"},{input:"if(false, 1, 2)",output:"2"},{input:[(0,g().Py)("Checked"),[' == true ? "Complete" : "Incomplete"']]}],[{input:"true.if(1, 2)",output:"1"},{input:"false.if(1, 2)",output:"2"}]],syntax:["if(condition, ifTrue, ifFalse)","condition.if(ifTrue, ifFalse)"],description:T.if},ifs:{name:"ifs",parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}}],varargs:[{name:"rest",type:{type:"expression"}}]},returnType:e=>{if(e.length<2)return{type:"unknown"};const t=e[1];let n=2;for(;n<e.length-1;n+=2)if(!(0,b().Re)(e[n+1],t))return{type:"unknown"};if(n===e.length-1){const r=e[n];if(!(0,b().Re)(r,t))return{type:"unknown"}}return t},eval:function*(e,t){const n=e[0];if(k("checkbox"===n.type),n.value)return yield*(0,f().yN)((0,y().F$)(e[1]),t);for(let r=2;r<e.length-1;r+=2){const n=(0,y().F$)(e[r]);if((0,b().CL)(yield*(0,f().yN)(n,t)))return yield*(0,f().yN)((0,y().F$)(e[r+1]),t)}return e.length%2==1?yield*(0,f().yN)((0,y().F$)(e[e.length-1]),t):w},iconType:{type:"checkbox"},examples:[[{input:"ifs(true, 1, true, 2, 3)",output:"1"},{input:"ifs(false, 1, false, 2, 3)",output:"3"}],[{input:"true.ifs(1, true, 2, 3)",output:"1"},{input:"false.ifs(1, false, 2, 3)",output:"3"}]],syntax:["ifs(condition, ifTrue, condition2, ifTrue2, ..., else)","condition.ifs(ifTrue, condition2, ifTrue2, ..., else)"],description:T.ifs},and:{name:"and",eval:function*(e,t){return{type:"checkbox",value:e.every((e=>(0,b().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"and(true, true, true)",output:"true"},{input:"and(3 > 2, 2 < 3)",output:"false"}],[{input:"true.and(true, true)",output:"true"},{input:"(3 > 2).and(2 < 3)",output:"false"}]],syntax:["and(boolean, boolean, ...)","boolean.and(boolean, ...)"],description:h().Q$.and},or:{name:"or",eval:function*(e,t){return{type:"checkbox",value:e.some((e=>(0,b().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"or(true, false, false)",output:"true"},{input:"or(3 > 2, 2 < 3)",output:"true"}],[{input:"true.or(false, false)",output:"true"},{input:"(3 > 2).or(2 < 3)",output:"true"}]],syntax:["or(boolean, boolean, ...)","boolean.or(boolean, ...)"],description:h().Q$.or},not:{name:"not",eval:function*(e,t){const[n]=e;return{type:"checkbox",value:!(0,b().CL)(n)}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"not(true)",output:"false"},{input:"not(2 > 3)",output:"true"}],[{input:"true.not()",output:"false"},{input:"(2 > 3).not()",output:"true"}]],syntax:["not(boolean)","boolean.not()"],description:h().Q$.not},empty:{name:"empty",eval:function*(e,t){const[n]=e;return{type:"checkbox",value:"array"===n.type?0===n.values.length:!(0,b().CL)(n)}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"empty(0)",output:"true"},{input:"empty([])",output:"true"}],[{input:"0.empty()",output:"true"},{input:"[].empty()",output:"true"}]],syntax:["empty(value)","value.empty()"],description:T.empty},length:{name:"length",eval:function*(e,t){const[n]=e;return"array"===n.type?{type:"number",value:n.values.length}:(k("text"===n.type),{type:"number",value:n.value.reduce(((e,t)=>e+(0,c().WWE)(t)),0)})},parameters:{expected:[{name:"input",type:[{type:"text"},{type:"array",of:{type:"unknown"}}]}]},returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'length("hello")',output:"5"},{input:"length([1, 2, 3])",output:"3"}],[{input:'"hello".length()',output:"5"},{input:"[1, 2, 3].length()",output:"3"}]],syntax:["length(value)","value.length()"],description:T.length},substring:{name:"substring",eval:function*(e,t){const[n,r,o]=e;k("text"===n.type&&"number"===r.type);return{type:"text",value:[[(yield*(0,b().o7)(n.value,t)).slice(r.value,"number"===(null==o?void 0:o.type)?o.value:void 0)]]}},parameters:{expected:[{name:"target",type:{type:"text"}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'substring("Notion", 0, 3)',output:'"Not"'},{input:'substring("Notion", 3)',output:'"ion"'}],[{input:'"Notion".substring(0, 3)',output:'"Not"'},{input:'"Notion".substring(3)',output:'"ion"'}]],syntax:["substring(text, startIndex, endIndex?)","text.substring(startIndex, endIndex?)"],description:T.substring},contains:{name:"contains",eval:function*(e,t){const[n,r]=e;k("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,r.value],t);return{type:"checkbox",value:o.includes(a)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"search",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"text"},examples:[[{input:'contains("Notion", "ot")',output:"true"}],[{input:'"Notion".contains("ot")',output:"true"}]],syntax:["contains(value, search)","value.contains(search)"],description:T.contains},test:{name:"test",eval:function*(e,t){const[n,r]=e;k("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([r.value,n.value],t);return{type:"checkbox",value:O({context:t,pattern:o}).test(a)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:'test("Notion", "Not")',output:"true"},{input:'test("Notion", "\\d")',output:"false"}],[{input:'"Notion.test("Not")',output:"true"},{input:'"Notion".test("\\d")',output:"false"}]],syntax:["test(text, pattern)","text.test(pattern)"],description:T.test},match:{name:"match",eval:function*(e,t){const[n,r]=e;k("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,r.value],t),i=O({context:t,pattern:a,flags:"g"}),u=o.match(i);return u?{type:"array",values:u.map((e=>({type:"text",value:(0,c().x9d)(e)})))}:{type:"array",values:[]}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"text"},examples:[[{input:'match("Notion Notion", "Not")',output:'["Not", "Not"]'},{input:'match("Notion 123 Notion 456", "\\d+")',output:'["123", "456"]'}],[{input:'"Notion Notion".match("Not")',output:'["Not", "Not"]'},{input:'"Notion 123 Notion 456".match("\\d+")',output:'["123", "456"]'}]],syntax:["match(text, pattern)","text.match(pattern)"],description:T.match},replace:{name:"replace",eval:function*(e,t){const[n,r,o]=e;k("text"===n.type&&"text"===r.type);const[a,i,u]=yield*(0,b().h8)([n.value,r.value,"text"===(null==o?void 0:o.type)?o.value:void 0],t),s=O({context:t,pattern:i});return{type:"text",value:(0,c().x9d)(a.replace(s,u))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replace("Notion Notion", "N", "M")',output:'"Motion Notion"'}],[{input:'"Notion Notion".replace("N", "M")',output:'"Motion Notion"'}]],syntax:["replace(text, pattern, replacement?)","text.replace(pattern, replacement?)"],description:T.replace},replaceAll:{name:"replaceAll",eval:function*(e,t){const[n,r,o]=e;k("text"===n.type&&"text"===r.type);const[a,i,u]=yield*(0,b().h8)([n.value,r.value,"text"===(null==o?void 0:o.type)?o.value:void 0],t),s=O({context:t,pattern:i,flags:"g"});return{type:"text",value:(0,c().x9d)(a.replace(s,u))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replaceAll("Notion Notion", "N", "M")',output:'"Motion Motion"'},{input:'replaceAll("Notion 123", "\\d", "")',output:'"Notion"'}],[{input:'"Notion Notion".replaceAll("N", "M")',output:'"Motion Motion"'},{input:'"Notion 123".replaceAll("\\d", "")',output:'"Notion"'}]],syntax:["replaceAll(text, pattern, replacement?)","text.replaceAll(pattern, replacement?)"],description:T.replaceAll},lower:{name:"lower",eval:function*(e){const[t]=e;k("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,c().uPN)(e),n=(0,c().N8A)(e);return(0,c().Ey_)(n.toLowerCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'lower("NOTION")',output:'"notion"'}],[{input:'"NOTION".lower()',output:'"notion"'}]],syntax:["lower(text)","text.lower()"],description:T.lower},upper:{name:"upper",eval:function*(e){const[t]=e;k("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,c().uPN)(e),n=(0,c().N8A)(e);return(0,c().Ey_)(n.toUpperCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'upper("notion")',output:'"NOTION"'}],[{input:'"notion".upper()',output:'"NOTION"'}]],syntax:["upper(text)","text.upper()"],description:T.upper},repeat:{name:"repeat",eval:function*(e){const[t,n]=e;k("text"===t.type),k("number"===n.type);const r=[],o=Math.min(n.value,1e4);for(let a=0;a<o;a++)r.push(...t.value);return{type:"text",value:r}},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"count",type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'repeat("0", 4)',output:'"0000"'},{input:'repeat("~=", 10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}],[{input:'"0".repeat(4)',output:'"0000"'},{input:'"~=".repeat(10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}]],syntax:["repeat(text, count)","text.repeat(count)"],description:T.repeat},padStart:{name:"padStart",eval:function*(e,t){const[n,r,o]=e;return k("text"===n.type&&"number"===r.type&&"text"===o.type),yield*(0,g().tr)(n.value,r.value,o.value,"start",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padStart("A", 3, ".")',output:'"..A"'},{input:"padStart(123, 5, 0)",output:'"00123"'}],[{input:'"A".padStart(3, ".")',output:'"..A"'},{input:"123.padStart(5, 0)",output:'"00123"'}]],syntax:["padStart(text, targetLength, padString)","text.padStart(targetLength, padString)"],description:T.padStart},padEnd:{name:"padEnd",eval:function*(e,t){const[n,r,o]=e;return k("text"===n.type&&"number"===r.type&&"text"===(null==o?void 0:o.type)),yield*(0,g().tr)(n.value,r.value,o.value,"end",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padEnd("A", 3, ".")',output:'"A.."'},{input:"padEnd(123, 5, 0)",output:'"12300"'}],[{input:'"A".padEnd(3, ".")',output:'"A.."'},{input:"123.padEnd(5, 0)",output:'"12300"'}]],syntax:["padEnd(text, targetLength, padString)","text.padEnd(targetLength, padString)"],description:T.padEnd},link:{name:"link",eval:function*(e){const[t,n]=e;return k("text"===t.type),k("text"===n.type),{type:"text",value:(0,c().lux)(t.value,(0,c().k4p)(n.value))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"url",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'link("Notion", "https://notion.so")',output:[['"'],["Notion",[(0,c().Sez)("https://notion.so")]],['"']]}],[{input:'"Notion".link("https://notion.so")',output:[['"'],["Notion",[(0,c().Sez)("https://notion.so")]],['"']]}]],syntax:["link(text, url)","text.link(url)"],description:T.link},style:{name:"style",eval:function*(e){const[t,...n]=e;k("text"===t.type),n.forEach((e=>k("text"===e.type)));const r=n.length>0?(0,g().kk)(n.map((e=>(k("text"===e.type),e.value))).filter(i().O9)):[];return{type:"text",value:(0,g().xK)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'style("Notion", "b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'style("Notion", "blue", "gray_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}],[{input:'"Notion".style("b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'"Notion".style("blue", "blue_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}]],syntax:["style(value, styles)","value.style(styles)"],description:T.style},unstyle:{name:"unstyle",eval:function*(e){const[t,...n]=e;k("text"===t.type);const r=n.length>0?(0,g().kk)(n.map((e=>(k("text"===e.type),e.value))).filter(i().O9)):void 0;return{type:"text",value:(0,g().qs)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:[['unstyle("'],["Text",[["b"],["c"]]],['")']],output:[['"Text"']]},{input:[['unstyle("'],["Text",[["h","blue"],["b"]]],['", "blue")']],output:[['"'],["Text",[["b"]]],['"']]}],[{input:[['"'],["Text",[["b"],["c"]]],['".unstyle()']],output:[['"Text"']]},{input:[['"'],["Text",[["h","blue"],["b"]]],['".unstyle("blue")']],output:[['"'],["Text",[["b"]]],['"']]}]],syntax:["unstyle(value, styles?)","value.unstyle(styles?)"],description:T.unstyle},format:{name:"format",eval:function*(e,t){const[n]=e,r=(0,b().Ht)(n);return{type:"text",value:(0,c().x9d)(yield*(0,b().o7)(r,t))}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:"format(1234)",output:'"1234"'},{input:"format(now())",output:[['"'],[(0,l().u)(o().c9.now(),"MMMM D, Y HH:mm")],['"']]}],[{input:"1234.format()",output:'"1234"'},{input:"now().format()",output:[['"'],[(0,l().u)(o().c9.now(),"MMMM D, Y HH:mm")],['"']]}]],syntax:["format(value)","value.format()"],description:T.format},add:(0,g().P7)("add",T.add,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e+t:new(r().Big)(e).plus(t).toNumber()),"+"),subtract:(0,g().P7)("subtract",T.subtract,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e-t:new(r().Big)(e).minus(t).toNumber()),"-"),multiply:(0,g().P7)("multiply",T.multiply,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e*t:new(r().Big)(e).mul(t).toNumber()),"*"),mod:(0,g().P7)("mod",T.mod,((e,t)=>Number.isInteger(t)?e%t:new(r().Big)(e).mod(t).toNumber()),"%"),pow:(0,g().P7)("pow",T.pow,((e,t)=>!Number.isInteger(e)&&Number.isInteger(t)?new(r().Big)(e).pow(t).toNumber():e**t),"^"),divide:{name:"divide",description:T.divide,eval:function*(e,t){const[n,o]=e;return k("number"===n.type&&"number"===o.type),0===o.value?w:{type:"number",value:new(r().Big)(n.value).div(o.value).toNumber()}},returnType:{type:"number"},iconType:{type:"number"},syntax:["divide(number, number)","number.divide(number)"],parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},examples:[[{input:"divide(5, 10)",output:"0.5"},{input:"5 / 10",output:"0.5"}],[{input:"5.divide(10)",output:"0.5"},{input:"5 / 10",output:"0.5"}]]},min:{name:"min",eval:function*(e,t){const n=e,r=(0,b().U)({type:"array",values:n});if(0===r.values.length)return w;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,s().ln)(e.value,t.userTimeZone)})).filter(i().O9);if(0===e.length)return w;const n=e.indexOf(Math.min(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(i().O9);if(0===e.length)return w;return{type:"number",value:Math.min(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"min(1, 2, 3)",output:"1"},{input:"min([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].min()",output:"1"}]],syntax:["min(list)","list.min()"],description:T.min},max:{name:"max",eval:function*(e,t){const n=e,r=(0,b().U)({type:"array",values:n});if(0===r.values.length)return w;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,s().ln)(e.value,t.userTimeZone)})).filter(i().O9);if(0===e.length)return w;const n=e.indexOf(Math.max(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(i().O9);if(0===e.length)return w;return{type:"number",value:Math.max(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"max(1, 2, 3)",output:"3"},{input:"max([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].max()",output:"3"}]],syntax:["max(list)","list.max()"],description:T.max},sum:{name:"sum",eval:function*(e,t){const n=e;return{type:"number",value:(0,g().Hx)(n).reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"sum(1, 2, 3)",output:"6"},{input:"sum([1, 2, 3], 4, 5)",output:"15"}],[{input:"[1, 2, 3].sum()",output:"6"},{input:"[1, 2, 3].sum(4, 5)",output:"15"}]],syntax:["sum(list)","list.sum()"],description:T.sum},median:{name:"median",eval:function*(e,t){const n=e,o=(0,g().Hx)(n).sort(((e,t)=>e-t));if(0===o.length)return w;if(o.length%2==0){const e=o[o.length/2-1],t=o[o.length/2];return{type:"number",value:new(r().Big)(e).plus(t).div(2).toNumber()}}return{type:"number",value:o[Math.floor(o.length/2)]}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"median(1, 2, 4)",output:"2"},{input:"median([1, 2, 3], 4)",output:"2.5"}],[{input:"[1, 2, 4].median()",output:"2"},{input:"[1, 2, 3].median(4)",output:"2.5"}]],syntax:["median(list)","list.median()"],description:T.median},mean:{name:"mean",eval:function*(e,t){const n=e,o=(0,g().Hx)(n);if(0===o.length)return w;return{type:"number",value:o.reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).div(o.length).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"mean(1, 2, 3)",output:"2"},{input:"mean([1, 2, 3], 4, 5)",output:"3"}],[{input:"[1, 2, 3].mean()",output:"2"},{input:"[1, 2, 3].mean(4, 5)",output:"3"}]],syntax:["mean(list)","list.mean()"],description:T.mean},abs:(0,g().hq)("abs",T.abs,Math.abs,[10,-10]),round:{name:"round",eval:function*(e,t){const[n,r]=e;if(k("number"===n.type),void 0===r)return{type:"number",value:Math.round(n.value)};if(k("number"===r.type),0===r.value)return{type:"number",value:Math.round(n.value)};if(!Number.isInteger(r.value))throw new(x().x4)({type:x().v3.CannotRoundToNonInteger,precision:r.value});if(Math.abs(r.value)>12)throw new(x().x4)({type:x().v3.CannotRoundToTooManyDecimalPlaces,precision:r.value});const o=Math.pow(10,r.value);return{type:"number",value:Math.round(n.value*o)/o}},parameters:{varargs:[{name:"value",type:{type:"number"}},{name:"precision",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"round(1.2345)",output:"1"}],[{input:"round(1.2345, 2)",output:"1.23"}]],syntax:["round(value, precision)","value.round(precision)"],description:T.round},ceil:(0,g().hq)("ceil",T.ceil,Math.ceil,[.4,-.6]),floor:(0,g().hq)("floor",T.floor,Math.floor,[.4,-.6]),sqrt:(0,g().hq)("sqrt",T.sqrt,Math.sqrt,[4,7]),cbrt:(0,g().hq)("cbrt",T.cbrt,Math.cbrt,[9,64]),exp:(0,g().hq)("exp",T.exp,Math.exp,[1,-1]),ln:(0,g().hq)("ln",T.ln,Math.log,[Math.E,10]),log10:(0,g().hq)("log10",T.log10,Math.log10,[10,1e5]),log2:(0,g().hq)("log2",T.log2,Math.log2,[4,1024]),sign:(0,g().hq)("sign",T.sign,Math.sign,[-10,10]),pi:(0,g().SU)("pi",T.pi,Math.PI),e:(0,g().SU)("e",T.e,Math.E),toNumber:{name:"toNumber",eval:function*(e,t){const[r]=e;switch(r.type){case"number":return r;case"checkbox":return{type:"number",value:r.value?1:0};case"text":{const e=yield*(0,b().o7)(r.value,t),o=/^0[xbo]/.test(e)?Number(e):parseFloat(e);return(0,n(720665).Et)(o)?{type:"number",value:o}:w}case"date":return{type:"number",value:(0,s().AA)(r.value,t.userTimeZone).start.valueOf()};case"array":throw new(x().x4)({type:x().v3.CannotUseToNumberOnList});default:return w}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:'toNumber("2")',output:"2"},{input:"toNumber(now())",output:(0,s().ln)((0,s().T_)((0,d().P)()),(0,d().P)()).toString()},{input:"toNumber(true)",output:"1"}],[{input:'"2".toNumber()',output:"2"},{input:"now().toNumber()",output:(0,s().ln)((0,s().T_)((0,d().P)()),(0,d().P)()).toString()},{input:"true.toNumber()",output:"1"}]],syntax:["toNumber(value)","value.toNumber()"],description:T.toNumber},now:{name:"now",eval:function*(e,t){return{type:"date",value:(0,s().T_)(t.userTimeZone)}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"now()",output:[(0,c().wmz)((0,c().Ww9)((0,s().T_)((0,d().P)())))]}]],syntax:["now()"],description:T.now},today:{name:"today",eval:function*(e,t){return{type:"date",value:(0,s().lN)((0,s().ah)(t.userTimeZone))}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"today()",output:[(0,c().wmz)((0,c().Ww9)((0,s().lN)((0,s().ah)((0,d().P)()))))]}]],syntax:["today()"],description:T.today},minute:{name:"minute",eval:(0,g().KN)((e=>e.minute)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'minute(parseDate("2023-07-10T17:35Z"))',output:"35"}],[{input:'parseDate("2023-07-10T17:35Z").minute()',output:"35"}]],syntax:["minute(date)","date.minute()"],description:T.minute},hour:{name:"hour",eval:(0,g().KN)((e=>e.hour)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'hour(parseDate("2023-07-10T17:35Z"))',output:"17"}],[{input:'parseDate("2023-07-10T17:35Z").hour()',output:"17"}]],syntax:["hour(date)","date.hour()"],description:T.hour},day:{name:"day",eval:(0,g().KN)((e=>e.weekday)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'day(parseDate("2023-07-10T17:35Z"))',output:"1"}],[{input:'parseDate("2023-07-10T17:35Z").day()',output:"1"}]],syntax:["day(date)","date.day()"],description:T.day},date:{name:"date",eval:(0,g().KN)((e=>e.day)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'date(parseDate("2023-07-10T17:35Z"))',output:"10"}],[{input:'parseDate("2023-07-10T17:35Z").date()',output:"10"}]],syntax:["date(date)","date.date()"],description:T.date},week:{name:"week",eval:(0,g().KN)((e=>e.weekNumber)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'week(parseDate("2023-01-02"))',output:"1"}],[{input:'parseDate("2023-01-02").week()',output:"1"}]],syntax:["week(date)","date.week()"],description:T.week},month:{name:"month",eval:(0,g().KN)((e=>e.month)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'month(parseDate("2023-07-10T17:35Z"))',output:"7"}],[{input:'parseDate("2023-07-10T17:35Z").month()',output:"7"}]],syntax:["month(date)","date.month()"],description:T.month},year:{name:"year",eval:(0,g().KN)((e=>e.year)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"year(now())",output:o().c9.now().year.toString()}],[{input:"now().year()",output:o().c9.now().year.toString()}]],syntax:["year(date)","date.year()"],description:T.year},dateAdd:{name:"dateAdd",eval:(0,g().R)(((e,t,n)=>e.plus({[n]:t}).valueOf()),"dateAdd"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateAdd(now(), 1, "days")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().plus({days:1}))))]},{input:'dateAdd(now(), 2, "months")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().plus({months:2}))))]},{input:'dateAdd(now(), 3, "years")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().plus({years:3}))))]}],[{input:'now().dateAdd(1, "days")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().plus({days:1}))))]},{input:'now().dateAdd(2, "months")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({months:2}))))]},{input:'now().dateAdd(3, "years")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().plus({years:3}))))]}]],syntax:["dateAdd(date, num, unit)","date.dateAdd(num, unit)"],description:T.dateAdd},dateSubtract:{name:"dateSubtract",eval:(0,g().R)(((e,t,n)=>e.minus({[n]:t}).valueOf()),"dateSubtract"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateSubtract(now(), 1, "days")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({days:1}))))]},{input:'dateSubtract(now(), 2, "months")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({months:2}))))]},{input:'dateSubtract(now(), 3, "years")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({years:3}))))]}],[{input:'now().dateSubtract(1, "days")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({days:1}))))]},{input:'now().dateSubtract(2, "months")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({months:2}))))]},{input:'now().dateSubtract(3, "years")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.now().minus({years:3}))))]}]],syntax:["dateSubtract(date, num, unit)","date.dateSubtract(num, unit)"],description:T.dateSubtract},dateBetween:{name:"dateBetween",eval:function*(e,t){const[n,r,o]=e;k("date"===n.type&&"date"===r.type&&"text"===o.type);const a=(0,s().AA)(n.value,t.userTimeZone).start,i=(0,s().AA)(r.value,t.userTimeZone).start,u=yield*(0,g().Fd)(o.value,t,"dateBetween");return{type:"number",value:Math.trunc(a.diff(i,u).get(u))}},parameters:{expected:[{name:"left",type:{type:"date"}},{name:"right",type:{type:"date"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'dateBetween(now(), parseDate("2022-09-07"), "days")',output:Math.trunc(o().c9.now().diff(o().c9.fromISO("2022-09-07"),"days").days).toString()},{input:'dateBetween(parseDate("2030-01-01"), now(), "years")',output:Math.trunc(o().c9.fromISO("2030-01-01").diffNow("years").years).toString()}],[{input:'now().dateBetween(parseDate("2022-09-07"), "days")',output:Math.trunc(o().c9.now().diff(o().c9.fromISO("2022-09-07"),"days").days).toString()},{input:'parseDate("2030-01-01").dateBetween(now(), "years")',output:Math.trunc(o().c9.fromISO("2030-01-01").diffNow("years").years).toString()}]],syntax:["dateBetween(date, date, unit)","date.dateBetween(date, unit)"],description:T.dateBetween},dateRange:{name:"dateRange",eval:function*(e,t){const[n,r]=e;return k("date"===n.type&&"date"===r.type),"start_time"in n.value||"start_time"in r.value?{type:"date",value:{type:"datetimerange",start_date:n.value.start_date,start_time:"start_time"in n.value?n.value.start_time:"00:00",end_date:"end_date"in r.value?r.value.end_date:r.value.start_date,end_time:"end_time"in r.value?r.value.end_time:"start_time"in r.value?r.value.start_time:"23:59",time_zone:"time_zone"in n.value&&n.value.time_zone||"time_zone"in r.value&&r.value.time_zone||t.userTimeZone}}:{type:"date",value:{type:"daterange",start_date:n.value.start_date,end_date:"end_date"in r.value?r.value.end_date:r.value.start_date}}},parameters:{expected:[{name:"start",type:{type:"date"}},{name:"end",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateRange("],(0,g().Py)("Start Date"),[", "],(0,g().Py)("End Date"),[")"]],output:[(0,c().wmz)((0,c().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}],[{input:[(0,g().Py)("Start Date"),[".dateRange("],(0,g().Py)("End Date"),[")"]],output:[(0,c().wmz)((0,c().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}]],syntax:["dateRange(start, end)"],description:T.dateRange},dateStart:{name:"dateStart",eval:function*(e,t){const[n]=e;return k("date"===n.type),{type:"date",value:(0,u().j1)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateStart("],(0,g().Py)("Date Range"),[")"]],output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-09-07"))))]},{input:[["dateBetween(dateStart("],(0,g().Py)("Date Range"),["), dateEnd("],(0,g().Py)("Date Range"),['), "days")']],output:[["-365"]]}],[{input:[(0,g().Py)("Date Range"),[".dateStart()"]],output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-09-07"))))]},{input:[(0,g().Py)("Date Range"),[".dateStart().dateBetween("],(0,g().Py)("Date Range"),['.dateEnd(), "days")']],output:[["-365"]]}]],syntax:["dateStart(dateRange)","dateRange.dateStart()"],description:T.dateStart},dateEnd:{name:"dateEnd",eval:function*(e,t){const[n]=e;return k("date"===n.type),{type:"date",value:(0,u().mO)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateEnd("],(0,g().Py)("Date range"),[")"]],output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2023-09-07"))))]},{input:[["dateBetween(dateEnd("],(0,g().Py)("Date Range"),["), dateStart("],(0,g().Py)("Date Range"),['), "days")']],output:"365"}],[{input:[(0,g().Py)("Date Range"),[".dateEnd()"]],output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2023-09-07"))))]},{input:[(0,g().Py)("Date Range"),[".dateEnd().dateBetween("],(0,g().Py)("Date Range"),['.dateStart(), "days")']],output:"365"}]],syntax:["dateEnd(dateRange)","dataRange.dateEnd()"],description:T.dateEnd},timestamp:{name:"timestamp",eval:function*(e,t){const[n]=e;return k("date"===n.type),{type:"number",value:(0,s().ln)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"timestamp(now())",output:(0,s().ln)((0,s().T_)((0,d().P)()),(0,d().P)()).toString()}],[{input:"now().timestamp()",output:(0,s().ln)((0,s().T_)((0,d().P)()),(0,d().P)()).toString()}]],syntax:["timestamp(date)","date.timestamp()"],description:T.timestamp},fromTimestamp:{name:"fromTimestamp",eval:function*(e,t){const[n]=e;return k("number"===n.type),{type:"date",value:(0,s().KQ)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"fromTimestamp(1689024900000)",output:[(0,c().wmz)((0,c().Ww9)((0,s().KQ)(16890249e5,(0,d().P)())))]}],[{input:"1689024900000.fromTimestamp()",output:[(0,c().wmz)((0,c().Ww9)((0,s().KQ)(16890249e5,(0,d().P)())))]}]],syntax:["fromTimestamp(timestamp)","timestamp.fromTimestamp()"],description:T.fromTimestamp},formatDate:{name:"formatDate",eval:function*(e,t){const[n,r,o]=e;k("date"===(null==n?void 0:n.type)&&"text"===(null==r?void 0:r.type)),k(void 0===o||"text"===(null==o?void 0:o.type));const a=(0,g().m8)({timeZone:o,context:t});let i=(0,s().AA)((0,u().j1)(n.value),a,t.intl.locale).start;"datetime"!==n.value.type&&"datetimerange"!==n.value.type||(i=i.setZone(a));const p=yield*(0,b().o7)(r.value,t),d=`${Number(i)}:${a}:${t.intl.locale}:${p}`;let y=t.formatDateCache.get(d);return y||(y=(0,l().u)(i,p),t.formatDateCache.set(d,y)),{type:"text",value:(0,c().x9d)(y)}},parameters:{expected:[{name:"date",type:{type:"date"}},{name:"format",type:{type:"text"}},{name:"timezone",type:{type:"text"},optional:!0}]},returnType:{type:"text"},iconType:{type:"date"},examples:[[{input:'formatDate(now(), "MMMM D, Y")',output:[['"'],[(0,l().u)(o().c9.now(),"MMMM D, Y")],['"']]},{input:'formatDate(now(), "YYYY-MM-DD HH:mm")',output:[['"'],[(0,l().u)(o().c9.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'formatDate(now(), "h:mm A", "UTC+1")',output:[['"'],[(0,l().u)(o().c9.now().setZone("UTC+1"),"h:mm A")],['"']]}],[{input:'now().formatDate("MMMM D, Y")',output:[['"'],[(0,l().u)(o().c9.now(),"MMMM D, Y")],['"']]},{input:'now().formatDate("YYYY-MM-DD HH:mm")',output:[['"'],[(0,l().u)(o().c9.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'now().formatDate("h:mm A", "UTC+1")',output:[['"'],[(0,l().u)(o().c9.now().setZone("UTC+1"),"h:mm A")],['"']]}]],syntax:["formatDate(date, format, timezone?)","date.formatDate(format, timezone?)"],description:T.formatDate},parseDate:{name:"parseDate",eval:function*(e,t){const[n]=e;k("text"===n.type);const r=yield*(0,b().o7)(n.value,t),o=(0,p().zA)(r);return o?{type:"date",value:(0,p().pT)(o)}:w},parameters:{expected:[{name:"dateString",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'parseDate("2022-01-01")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-01-01"))))]},{input:'parseDate("2022-01-01T00:00Z")',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-01-01T00:00Z"))))]}],[{input:'"2022-01-01".parseDate()',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-01-01"))))]},{input:'"2022-01-01T00:00Z".parseDate()',output:[(0,c().wmz)((0,c().Ww9)((0,p().pT)(o().c9.fromISO("2022-01-01T00:00Z"))))]}]],syntax:["parseDate(dateText)","dateText.parseDate()"],description:T.parseDate},name:{name:"name",eval:function*(e,t){const[n]=e;k("person"===n.type);const r=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!r)throw new(x().x4)({type:x().v3.UserNotFound});return{type:"text",value:(0,c().x9d)(r.getDisplayName(t.intl))}},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["name("],(0,g().pC)(m().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,g().Py)("Pioneers"),['.map(name(current)).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}],[{input:[(0,g().pC)(m().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]],isCopyable:!0},{input:[(0,g().Py)("Pioneers"),['.map(current.name()).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}]],syntax:["name(person)","person.name()"],description:T.name},email:{name:"email",eval:function*(e,t){const[n]=e;k("person"===n.type);const r=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!r)throw new(x().x4)({type:x().v3.UserNotFound});return r.isUser()?{type:"text",value:(0,c().x9d)(r.getEmail())}:w},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["email("],(0,g().pC)(m().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,g().Py)("People"),['.map(email(current)).join(", ")']]}],[{input:[(0,g().pC)(m().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]],isCopyable:!0},{input:[(0,g().Py)("People"),['.map(current.email()).join(", ")']]}]],syntax:["email(person)","person.email()"],description:T.email},at:{name:"at",eval:function*(e,t){const[n,r]=e;k("array"===n.type&&"number"===r.type);const o=n.values.at(r.value);return void 0!==o?o:w},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"index",type:{type:"number"}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t.of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"at([1, 2, 3], 1)",output:"2"}],[{input:"[1, 2, 3].at(1)",output:"2"}]],syntax:["at(list, index)","list.at(index)"],description:T.at},first:{name:"first",eval:function*(e,t){const[n]=e;return k("array"===n.type),n.values.length>0?n.values[0]:w},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t.of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"first([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].first()",output:"1"},{input:"[].first()",output:"Empty"}]],syntax:["first(list)","list.first()"],description:T.first},last:{name:"last",eval:function*(e,t){const[n]=e;return k("array"===n.type),n.values.length>0?n.values[n.values.length-1]:w},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t.of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"last([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].last()",output:"3"}]],syntax:["last(list)","list.last()"],description:T.last},slice:{name:"slice",eval:function*(e,t){const[n,r,o]=e;return k("array"===n.type&&"number"===r.type),{type:"array",values:n.values.slice(r.value,"number"===(null==o?void 0:o.type)?o.value:void 0)}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t:{type:"array",of:{type:"unknown"}}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"slice([1, 2, 3], 1, 2)",output:"[2]"},{input:'slice(["a", "b", "c"], 1)',output:'["b", "c"]'}],[{input:"[1, 2, 3].slice(1, 2)",output:"[2]"},{input:'["a", "b", "c"].slice(1)',output:'["b", "c"]'}]],syntax:["slice(list, startIndex, endIndex?)","list.slice(startIndex, endIndex?)"],description:T.slice},concat:{name:"concat",eval:function*(e){return{type:"array",values:e.flatMap((e=>(k("array"===e.type),e.values.filter((e=>"undefined"!==e.type)))))}},parameters:{varargs:[{name:"arg",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{const t=null==e?void 0:e[0];if(void 0===t)return{type:"array",of:{type:"unknown"}};for(let n=1;n<e.length;n++)if(void 0!==e[n]&&!(0,b().Re)(e[n],t))return{type:"array",of:{type:"unknown"}};return t},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"concat([1, 2], [3, 4])",output:"[1, 2, 3, 4]"},{input:'concat(["a", "b"], ["c", "d"])',output:'["a", "b", "c", "d"]'}],[{input:"[1, 2].concat([3, 4])",output:"[1, 2, 3, 4]"},{input:'["a", "b"].concat(["c", "d"])',output:'["a", "b", "c", "d"]'}]],syntax:["concat(list, list2, ...)","list.concat(list2, ...)"],description:T.concat},sort:{name:"sort",eval:function*(e,t){const[n,r]=e;k("array"===n.type);const o=n.values.filter((e=>"undefined"!==e.type));return{type:"array",values:void 0!==r?yield*(0,g().fr)(o,r,t):yield*(0,g().ZV)(o,t)}},parameters:E,returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t:{type:"array",of:{type:"unknown"}}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"sort([3, 1, 2])",output:"[1, 2, 3]"},{input:"sort([1, 2, 3]).reverse()",output:"[3, 2, 1]"},{input:'sort(["Yash", "Stephen", "Paul", "Simon", "Ryo"])',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[["sort("],(0,g().Py)("Task"),[", current."],(0,g().Py)("Date"),[")"]],isCopyable:!1}],[{input:"[3, 1, 2].sort()",output:"[1, 2, 3]"},{input:"[1, 2, 3].sort().reverse()",output:"[3, 2, 1]"},{input:'["Yash", "Stephen", "Paul", "Simon", "Ryo"].sort()',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[(0,g().Py)("Task"),[".sort(current."],(0,g().Py)("Date"),[")"]],isCopyable:!1}]],syntax:["sort(list, expression?)","list.sort(expression?)"],description:T.sort},reverse:{name:"reverse",eval:function*(e,t){const[n]=e;k("array"===n.type);return{type:"array",values:[...n.values].reverse()}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t:{type:"array",of:{type:"unknown"}}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'reverse(["green", "eggs", "ham"])',output:'["ham", "eggs", "green"]'}],[{input:'["green", "eggs", "ham"].reverse()',output:'["ham", "eggs", "green"]'}]],syntax:["reverse(list)","list.reverse()"],description:T.reverse},join:{name:"join",eval:function*(e,t){const[r,o]=e;k("array"===r.type&&"text"===o.type);const a=r.values.map((e=>(0,b().Ht)(e)));return{type:"text",value:(0,c().__s)((0,n(681873).A)(a,(()=>o.value)).flat())}},parameters:{expected:[{name:"input",type:{type:"array",of:{type:"unknown"}}},{name:"joiner",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'join(["a", "b", "c"], ", ")',output:'"a, b, c"'},{input:'join(["dog", "go"], "")',output:'"doggo"'}],[{input:'["a", "b", "c"].join(", ")',output:'"a, b, c"'},{input:'["dog", "go"].join("")',output:'"doggo"'}]],syntax:["join(list, joiner)","list.join(joiner)"],description:T.join},split:{name:"split",eval:function*(e,t){const[n,r]=e;k("text"===n.type),k(void 0===r||"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,null==r?void 0:r.value],t);if(""===o)return{type:"array",values:[]};const i=" "===a||void 0===r,u=i?/\s+/:a;return{type:"array",values:o.split(u).filter((e=>!i||e.length>0)).map((e=>({type:"text",value:(0,c().x9d)(e)})))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"separator",optional:!0,type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'split("apple,pear,orange", ",")',output:'["apple", "pear", "orange"]'}],[{input:'"apple,pear,orange".split(",")',output:'["apple", "pear", "orange"]'}]],syntax:["split(text, separator)","text.split(separator)"],description:T.split},unique:{name:"unique",eval:function*(e,t){const[n]=e;k("array"===n.type);const r=[];for(const o of n.values){(yield*(0,v().KZ)(r.map((e=>(0,b().zV)(e,o,t))))).some((e=>e))||r.push(o)}return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?t:{type:"array",of:{type:"unknown"}}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"unique([1, 1, 2])",output:"[1, 2]"}],[{input:"[1, 1, 2].unique()",output:"[1, 2]"}]],syntax:["unique(list)","list.unique()"],description:T.unique},includes:{name:"includes",eval:function*(e,t){const[n,r]=e;k("array"===n.type);for(const o of n.values){if(yield*(0,b().zV)(o,r,t))return{type:"checkbox",value:!0}}return{type:"checkbox",value:!1}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"needle",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'includes(["a", "b", "c"], "b")',output:"true"},{input:"includes([1, 2, 3], 4)",output:"false"}],[{input:'["a", "b", "c"].includes("b")',output:"true"},{input:"[1, 2, 3].includes(4)",output:"false"}]],syntax:["includes(list, search)","list.includes(search)"],description:T.includes},find:{name:"find",eval:function*(e,t){const[n,r]=e;let o,a;k("array"===n.type);for(let i=0;i<n.values.length;i++)if(o=n.values[i],a=yield*(0,g().iZ)(r,{...t,values:[...A(o,i),...t.values]}),(0,b().CL)(a))return o;return{type:"undefined"}},parameters:N,returnType:e=>{let[t,n]=e;return"array"===(null==t?void 0:t.type)?t.of:{type:"unknown"}},iconType:{type:"text"},examples:[[{input:'find(["a", "b", "c"], current == "b")',output:'"b"'},{input:"find([1, 2, 3], current > 100)",output:"Empty"}],[{input:'["a", "b", "c"].find(current == "b")',output:'"b"'},{input:"[1, 2, 3].find(current > 100)",output:"Empty"}]],syntax:["find(list, condition)","list.find(condition)"],description:T.find},findIndex:{name:"findIndex",eval:function*(e,t){const[n,r]=e;let o,a;k("array"===n.type);for(let i=0;i<n.values.length;i++)if(o=n.values[i],a=yield*(0,g().iZ)(r,{...t,values:[...A(o,i),...t.values]}),(0,b().CL)(a))return{type:"number",value:i};return{type:"number",value:-1}},parameters:N,returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'findIndex(["a", "b", "c"], current == "b")',output:"1"},{input:"findIndex([1, 2, 3], current > 100)",output:"-1"}],[{input:'["a", "b", "c"].findIndex(current == "b")',output:"1"},{input:"[1, 2, 3].findIndex(current > 100)",output:"-1"}]],syntax:["findIndex(list, condition)","list.findIndex(condition)"],description:T.findIndex},filter:{name:"filter",eval:function*(e,t){const[n,r]=e;k("array"===n.type);const o=yield*(0,g()._2)(n.values,r,t);return{type:"array",values:n.values.filter(((e,t)=>(0,b().CL)(o[t])))}},parameters:N,returnType:e=>{let[t,n]=e;return"array"===(null==t?void 0:t.type)?t:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"filter([1, 2, 3], current > 1)",output:"[2, 3]"},{input:'filter(["a", "b", "c"], current == "a")',output:'["a"]'}],[{input:"[1, 2, 3].filter(current > 1)",output:"[2, 3]"},{input:'["a", "b", "c"].filter(current == "a")',output:'["a"]'}]],syntax:["filter(list, condition)","list.filter(condition)"],description:T.filter},some:{name:"some",eval:function*(e,t){const[n,r]=e;let o,a;k("array"===n.type);for(let i=0;i<n.values.length;i++)if(o=n.values[i],a=yield*(0,g().iZ)(r,{...t,values:[...A(o,i),...t.values]}),(0,b().CL)(a))return{type:"checkbox",value:!0};return{type:"checkbox",value:!1}},parameters:N,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"some([1, 2, 3], current == 2)",output:"true"},{input:'some(["a", "b", "c"], current.length > 2)',output:"false"}],[{input:"[1, 2, 3].some(current == 2)",output:"true"},{input:'["a", "b", "c"].some(current.length > 2)',output:"false"}]],syntax:["some(list, expression)","list.some(expression)"],description:T.some},every:{name:"every",eval:function*(e,t){const[n,r]=e;let o,a;k("array"===n.type);for(let i=0;i<n.values.length;i++)if(o=n.values[i],a=yield*(0,g().iZ)(r,{...t,values:[...A(o,i),...t.values]}),!(0,b().CL)(a))return{type:"checkbox",value:!1};return{type:"checkbox",value:!0}},parameters:N,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"every([1, 2, 3], current > 0)",output:"true"},{input:'every(["a", "b", "c"], current == "b")',output:"false"}],[{input:"[1, 2, 3].every(current > 0)",output:"true"},{input:'["a", "b", "c"].every(current == "b")',output:"false"}]],syntax:["every(list, condition)","list.every(condition)"],description:T.every},map:{name:"map",eval:function*(e,t){const[n,r]=e;return k("array"===n.type),{type:"array",values:yield*(0,g()._2)(n.values,r,t)}},parameters:N,returnType:e=>{let[t,n]=e;return{type:"array",of:n??{type:"unknown"}}},iconType:{type:"array",of:{type:"text"}},examples:[[{input:"map([1, 2, 3], current + 1)",output:"[2, 3, 4]"},{input:"map([1, 2, 3], current + index)",output:"[1, 3, 5]"}],[{input:"[1, 2, 3].map(current + 1)",output:"[2, 3, 4]"},{input:"[1, 2, 3].map(current + index)",output:"[1, 3, 5]"}]],syntax:["map(list, expression)","list.map(expression)"],description:T.map},flat:{name:"flat",eval:function*(e,t){const[n]=e;k("array"===n.type);const r=[];for(const o of n.values)"array"===o.type?r.push(...o.values):r.push(o);return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t]=e,n={type:"unknown"};return"array"===(null==t?void 0:t.type)&&(n="array"===t.of.type?t.of.of:t.of),{type:"array",of:n}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"flat([1, 2, 3])",output:"[1, 2, 3]"},{input:"flat([[1, 2], [3, 4]])",output:"[1, 2, 3, 4]"}],[{input:"[1, 2, 3].flat()",output:"[1, 2, 3]"},{input:"[[1, 2], [3, 4]].flat()",output:"[1, 2, 3, 4]"}]],syntax:["flat(list, list2?, ...)","list.flat(list2?, ...)"],description:T.flat},id:{name:"id",eval:function*(e,t){const[n]=e;if(!n){var r;const e=null===(r=t.values.find((e=>e.kind===m().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.value;if("block"!==(null==e?void 0:e.type))throw new(x().x4)({type:x().v3.TryingToGetIdWithoutThisRow});return{type:"text",value:(0,c().x9d)((0,a().Xw)(e.value.id))}}return k("block"===n.type||"person"===n.type),{type:"text",value:(0,c().x9d)((0,a().Xw)(n.value.id))}},parameters:{expected:[{name:"value",type:[{type:"person"},{type:"block"}],optional:!0}]},returnType:{type:"text"},iconType:{type:"text"},syntax:["id(value?)","value.id()"],examples:[[{input:"id()"},{input:[["id("],(0,g().Py)("Relation"),[".first())"]]},{input:[["id("],(0,g().Py)("Person"),[".first())"]]}],[{input:[(0,g().Py)("Relation"),[".first().id()"]]},{input:[(0,g().Py)("Person"),[".first().id()"]]}]],description:T.id},equal:{name:"equal",eval:function*(e,t){const[n,r]=e;return{type:"checkbox",value:yield*(0,b().zV)(n,r,t)}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"equal(1, 1)",output:"true"},{input:'"a" == "b"',output:"false"}],[{input:"1.equal(1)",output:"true"},{input:'"a" == "b"',output:"false"}]],syntax:["equal(value, value)","value.equal(value)"],description:T.equal},unequal:{name:"unequal",eval:function*(e,t){const[n,r]=e;return{type:"checkbox",value:!(yield*(0,b().zV)(n,r,t))}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"unequal(1, 2)",output:"true"},{input:'"a" != "a"',output:"false"}],[{input:"1.unequal(2)",output:"true"},{input:'"a" != "a"',output:"false"}]],syntax:["unequal(value, value)","value.unequal(value)"],description:T.unequal},let:{name:"let",eval:function*(e,t){const n=e.map((e=>(0,y().F$)(e)));return yield*(0,g().sj)(n,t)},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:e=>{let[t,n,r]=e;return r??{type:"unknown"}},iconType:{type:"text"},examples:[[{input:'let(name, "Doug Engelbart", "Hello, " + name + "!")',output:'"Hello, Doug Engelbart!"'},{input:"let(radius, 4, round(pi() * radius ^ 2))",output:"50"}],[{input:'name.let("Alan Kay", "Hello, " + name + "!")',output:'"Hello, Alan Kay!"'},{input:"radius.let(4, round(pi() * radius ^ 2)",output:"50"}]],syntax:["let(variable, value, expression)","variable.let(value, expression)"],description:T.let},lets:{name:"lets",eval:function*(e,t){const n=e.map((e=>(0,y().F$)(e)));return yield*(0,g().sj)(n,t)},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:e=>e[e.length-1]??{type:"unknown"},iconType:{type:"text"},examples:[[{input:'lets(a, "Hello", b, "world", a + " " + b)',output:'"Hello world"'},{input:"lets(base, 3, height, 8, base * height / 2)",output:"12"}],[]],syntax:["lets(variable, value, variable2, value2, ..., expression)","variable.lets(value, variable2, value2, ..., expression)"],description:T.lets},_unsafeCastArray:{name:"_unsafeCastArray",description:T._unsafeCastArray,eval:function*(e,t){const[n,r]=e;return k("array"===n.type),k("array"===r.type),n},parameters:{expected:[{name:"arrayToConvert",type:{type:"array",of:{type:"unknown"}}},{name:"typeTemplate",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{let[t,n]=e;return n??{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"_unsafeCastArray([1, 2, 3], [true, false])",output:"[1, 2, 3]"}]],syntax:["_unsafeCastArray(arrayToConvert, typeTemplate)"]},count:{name:"count",description:T.count,eval:function*(e,t){const[n,r]=e;if(k("array"===n.type),!(0,i().O9)(r))return{type:"number",value:n.values.length};let o=0;return yield*(0,v().KZ)(n.values.map((function*(e,n){const a=yield*(0,g().iZ)(r,{...t,values:[{kind:m().FormulaContextValueKind.Binding,id:m().CURRENT_VALUE_NAME,value:e},{kind:m().FormulaContextValueKind.Binding,id:m().CURRENT_INDEX_NAME,value:{type:"number",value:n}},...t.values]});(0,b().CL)(a)&&(o+=1)}))),{type:"number",value:o}},parameters:E,returnType:e=>{let[t]=e;return"array"===(null==t?void 0:t.type)?{type:"number"}:{type:"unknown"}},iconType:{type:"number"},examples:[[{input:"count([1, 2, 3, 4], current % 2 == 0)",output:"2"},{input:'count(["a", "b", "c"], current == "d")',output:"0"}],[{input:"[1, 2, 3, 4].count(current % 2 == 0)",output:"2"},{input:'["a", "b", "c"].count(current == "d")',output:"0"}]],syntax:["count(list, condition)","list.count(condition)"]}};const R=["block","array","person"],I=["let","lets"];function A(e,t){return[{kind:m().FormulaContextValueKind.Binding,id:m().CURRENT_VALUE_NAME,value:e},{kind:m().FormulaContextValueKind.Binding,id:m().CURRENT_INDEX_NAME,value:{type:"number",value:t}}]}function O(e){let{context:t,pattern:n,flags:r}=e;const o=`${n}|${r}`,a=t.regExpCache.get(o);if(a)return a.lastIndex=0,a;let i;if("[^T]*$"===n)try{i=new RegExp("(?<=^|T)[^T]*$",r)}catch(u){i=new RegExp(n,r)}else i=new RegExp(n,r);return t.regExpCache.set(o,i),i}},662358:(e,t,n)=>{n.d(t,{If:()=>U,LL:()=>P,MA:()=>F,OH:()=>R,PR:()=>I,Rn:()=>S,ir:()=>B,oj:()=>L,qL:()=>D,qU:()=>C,rb:()=>A,ym:()=>_});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(581454),n(737550);var r=n.n(n(598629)),o=()=>n(496603),a=()=>n(973647),i=()=>n(534177),u=()=>n(764880),s=()=>n(716016),p=()=>n(787626),l=()=>n(713998),d=()=>n(568063),c=()=>n(244149),y=()=>n(835243),m=()=>n(792071),f=()=>n(696706),v=()=>n(179034),h=()=>n(519831),x=()=>n(919709),b=()=>n(342581),g=()=>n(247331),T=()=>n(696446),k=()=>n(80979),w=()=>n(349835),M=()=>n(977345),N=()=>n(383969),E=()=>n(373907);const C=3e5;function*R(e,t){var n;const r=yield*(0,T().Xq)(e);if(r)return{collectionPointer:r.pointer,schema:r.getNormalizedSchema()};const o=e.getParentPointer();return o.table===h().Vl&&o.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?{collectionPointer:o,schema:t.publicPageDataCollection.schema}:{collectionPointer:void 0,schema:void 0}}function*I(e){const{block:t,property:n,parentCollectionPointer:r,schema:f,propertySchema:C,oldContext:R,evaluateAST:A}=e;if("rollup"===C.type){const e=`${t.id}:${n}`;if(R.visitedProperties.has(e))throw new(w().I3)({type:w().uW.CycleDetected});const a=new Set(R.visitedProperties);a.add(e);const u=(0,b().wr)({resultCache:R.resultCache,blockId:t.id,property:n});if(void 0!==u)return u;const s={...R,visitedProperties:a,depth:R.depth+1};if(C.aggregation&&"show_unique"!==C.aggregation){var O;const e=yield*(0,T().OH)(n,f),{relation_property:o}=C;if(null==e||!e.targetCollectionPointer||!o)return{type:"undefined"};const a=(0,l().n)(null===(O=t.getProperties())||void 0===O?void 0:O[o]);if(void 0===a)return{type:"undefined"};a.push(e.targetCollectionPointer),a.push(t.pointer);const{getRecordModel:i}=yield{recordPointers:a,collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:f,property:n}]},u={error:null},p=(0,d().Pm)({property:n,schema:f,block:t,getRecordModel:i,collectionRequestContext:{...s,userId:void 0},formula2Error:u,formulasModule:k()});if(null!==u.error)throw u.error;if(void 0===p)return{type:"undefined"};const c=function(e){if(void 0===e.value)return{type:"undefined"};switch(e.type){case"text":return{type:"text",value:(0,x().x9d)(e.value)};case"number":return{type:"number",value:e.value};case"date":return{type:"date",value:e.value}}}(p);return(0,b().wZ)({resultCache:s.resultCache,blockId:t.id,property:n,value:c}),c}{var P;const e=yield*(0,T().OH)(n,f),{relation_property:r}=C;if(void 0===e||void 0===r)return{type:"undefined"};if("person"===e.rollupType)return{type:"undefined"};const{relationPropertySchema:a,targetCollectionSchema:u,targetCollectionModel:p,targetProperty:d}=e,y=(0,l().n)(null===(P=t.getProperties())||void 0===P?void 0:P[r]),v=yield*(0,T().Sp)(y,a);if(0===v.length){const e={type:"array",values:[]};return(0,b().wZ)({resultCache:s.resultCache,blockId:t.id,property:n,value:e}),e}const h=yield*(0,T().KZ)(v.flatMap((e=>{const t=u[d];if(void 0===t)return[];const n={kind:g().FormulaContextValueKind.ThisRow,value:{type:"block",value:e.pointer}};return s.values=[n],[I({block:e,property:d,parentCollectionPointer:p.pointer,schema:u,propertySchema:t,oldContext:s,evaluateAST:A})]}))),x=(0,M().U)({type:"array",values:h});if(x.values.length&&"show_unique"===C.aggregation){const e=(0,b().wr)({resultCache:R.resultCache,blockId:t.id,property:n});if(void 0!==e)return e;y.push(t.pointer);const r=x.values.map((e=>"block"===e.type?e.value:void 0)).filter(i().O9);y.push(...r);const{getRecordModel:a}=yield{recordPointers:y},{getRecordModel:u}=yield{recordPointers:r.map((e=>a(e))).filter(i().O9).flatMap((e=>(0,l().dg)(e.getProperty("title"))))},p=m().b4_.tryUntilFound(a,u),d=o().hS(x.values,(e=>(0,c().R2)({result:e,getRecordModel:p,userTimeZone:s.userTimeZone,intl:s.intl}))),f={type:"array",values:d};return(0,b().wZ)({resultCache:s.resultCache,blockId:t.id,property:n,value:f}),f}const k={type:"array",values:x.values};return(0,b().wZ)({resultCache:s.resultCache,blockId:t.id,property:n,value:k}),k}}if("formula"===C.type){const e=`${t.id}:${n}`;if(R.visitedProperties.has(e))throw new(w().I3)({type:w().uW.CycleDetected});const o=new Set(R.visitedProperties);if("v2"===C.version){o.add(e);const r=(0,b().wr)({resultCache:R.resultCache,blockId:t.id,property:n});if(void 0!==r)return r}const i={...R,visitedProperties:o,depth:R.depth+1};if(void 0!==C.version){var S;const e=null===(S=C.formula2)||void 0===S?void 0:S.code;if(!e)return{type:"undefined"};const o=(0,b().wr)({resultCache:i.resultCache,blockId:t.id,property:n});if(void 0!==o)return o;const u=(0,E().$t)(e);if(a().Q.isFail(u)){if(i.throwOnDownstreamParseFailures)throw new(w().I3)({type:w().uW.DownstreamParseFailure,parserError:u.error,collectionId:r.id,property:n});return{type:"undefined"}}const s={kind:g().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}};i.values=[s];const p=yield*A(u.value,i);return(0,b().wZ)({resultCache:i.resultCache,blockId:t.id,property:n,value:p}),p}{const{getRecordModel:e}=yield{collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:f,property:n}]},o={error:null},a=(0,N().L7)({schema:f,property:n,block:t,getRecordModel:e,collectionRequestContext:{userId:void 0,userTimeZone:i.userTimeZone,intl:i.intl,depth:i.depth,resultCache:i.resultCache,regExpCache:i.regExpCache,formatDateCache:i.formatDateCache,logFormulaTimeoutFn:i.logFormulaTimeoutFn,visitedProperties:i.visitedProperties,experimentService:i.experimentService,collectionFeatureGates:i.collectionFeatureGates},formula2Error:o});if(null!==o.error)throw o.error;switch(typeof a){case"string":return{type:"text",value:(0,x().x9d)(a)};case"number":return{type:"number",value:a};case"boolean":return{type:"checkbox",value:a};case"object":return{type:"date",value:a};default:return{type:"undefined"}}}}else if((0,i().Xk)(g().FormulaTokenSupportedBlockSystemPropertyList,C.type))return(0,M().ve)(t,C.type);const F=(0,l().xr)(t,n,f),L=yield{recordPointers:[r,...null!=F&&F.eoipPointer?[F.eoipPointer]:[]]},U=(0,l().yQ)(t,n,L.getRecordModel);if("status"===C.type){const e=(0,l().RZ)(U,C);return void 0===e?{type:"undefined"}:{type:"text",value:(0,x().x9d)(e)}}if("checkbox"===C.type&&void 0===U)return{type:"checkbox",value:!1};if(("relation"===C.type||"multi_select"===C.type)&&void 0===U)return{type:"array",values:[]};if("person"===C.type&&void 0===U){const e=t.getCreatedByPointer();return"created_by"===C.default&&void 0!==e&&(0,u().Pu)(e)?{type:"array",values:[{type:"person",value:e}]}:{type:"array",values:[]}}if(void 0===U)return{type:"undefined"};switch(C.type){case"title":case"text":case"url":case"email":case"place":return{type:"text",value:U};case"phone_number":return{type:"text",value:(0,x().x9d)((0,x().k4p)(U))};case"select":{const e=(0,l().L3)(U,C.options??[]);return void 0===e?{type:"undefined"}:{type:"text",value:(0,x().x9d)(e)}}case"multi_select":return{type:"array",values:(0,l().o2)(U,C.options??[]).map((e=>({type:"text",value:(0,x().x9d)(e)})))};case"checkbox":return{type:"checkbox",value:(0,l().wu)(U)};case"date":{const e=(0,p().b)(U);return void 0===e?{type:"undefined"}:{type:"date",value:e}}case"person":return{type:"array",values:(0,l().Y6)({textValue:U,propertySchema:C,blockCreatorPointer:void 0}).map((e=>({type:"person",value:e})))};case"relation":return{type:"array",values:(yield*(0,T().Sp)((0,l().n)(U),C)).map((e=>({type:"block",value:{table:v().ev,id:e.id,spaceId:e.getSpaceId()}})))};case"number":const e=(0,l().Me)(U);return"number"==typeof e?{type:"number",value:e}:{type:"undefined"};case"auto_increment_id":{var B;const e=yield*(0,T().Xq)(t);if(!e)return{type:"undefined"};const n=(0,y().aZ)({spaceId:t.getSpaceId(),parentTable:h().Vl,parentId:e.id}),{getRecordModel:r}=yield{recordPointers:[n]},o=null===(B=r(n))||void 0===B?void 0:B.getRecordKey(),a=(0,l().Me)(U),i=(0,s().H4)(o,a);return void 0!==i?{type:"text",value:[[i]]}:{type:"undefined"}}case"file":return{type:"array",values:(0,l().pJ)(U).map((e=>{let{url:t}=e;return{type:"text",value:(0,x().x9d)(t)}}))};case"created_time":case"last_edited_time":case"created_by":case"last_edited_by":case"last_visited_time":case"button":case"location":case"verification":return{type:"undefined"};default:(0,i().HB)(C)}}function A(e){if("number"===e.type)return{type:"number",value:(0,o().LI)(e.value,12)};if("array"===e.type){return{type:"array",values:e.values.map((e=>"number"===e.type?{type:"number",value:(0,o().LI)(e.value,12)}:e))}}return e}function O(e,t,n){if("number"!==t.type&&"undefined"!==t.type)throw new(w().I3)({type:w().uW.CannotDoMathOnType,op:n,operand:e,valueType:t.type})}function P(e,t,n){if("undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"+":return"number"===t.type&&"number"===n.type?Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value+n.value}:{type:"number",value:new(r())(t.value).add(n.value).toNumber()}:{type:"text",value:(0,x().__s)((0,M().Ht)(t).concat((0,M().Ht)(n)))};case"-":if(O(e.lhs,t,e.op),O(e.rhs,n,e.op),"number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value-n.value}:{type:"number",value:new(r())(t.value).minus(n.value).toNumber()}}return{type:"undefined"}}function S(e,t,n){if(O(e.lhs,t,e.op),O(e.rhs,n,e.op),"undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"*":if("number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value*n.value}:{type:"number",value:new(r())(t.value).mul(n.value).toNumber()};break;case"/":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:{type:"number",value:new(r())(t.value).div(n.value).toNumber()};break;case"%":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:Number.isInteger(n.value)?{type:"number",value:t.value%n.value}:{type:"number",value:new(r())(t.value).mod(n.value).toNumber()}}return{type:"undefined"}}function*F(e,t,n,r){if("undefined"===t.type||"undefined"===n.type)return{type:"checkbox",value:!1};if("date"===t.type&&"date"===n.type){const o=(0,M().i3)(t.value,n.value,r.userTimeZone);switch(e.op){case"<":return{type:"checkbox",value:o<0};case"<=":return{type:"checkbox",value:o<=0};case">":return{type:"checkbox",value:o>0};case">=":return{type:"checkbox",value:o>=0}}}if("text"===t.type&&"text"===n.type){const[o,a]=yield*(0,M().h8)([t.value,n.value],r);switch(e.op){case"<":return{type:"checkbox",value:o<a};case"<=":return{type:"checkbox",value:o<=a};case">":return{type:"checkbox",value:o>a};case">=":return{type:"checkbox",value:o>=a}}}if("number"===t.type&&"number"===n.type||"checkbox"===t.type&&"checkbox"===n.type)switch(e.op){case"<":return{type:"checkbox",value:t.value<n.value};case"<=":return{type:"checkbox",value:t.value<=n.value};case">":return{type:"checkbox",value:t.value>n.value};case">=":return{type:"checkbox",value:t.value>=n.value}}throw new(w().I3)({type:w().uW.CannotRelativelyCompareTypes,lhs:e.lhs,rhs:e.rhs,lhsType:t.type,rhsType:n.type})}function L(e,t,n){if(O(e.lhs,t,e.op),O(e.rhs,n,e.op),"^"===e.op)if("number"===t.type&&"number"===n.type)return!Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:new(r())(t.value).pow(n.value).toNumber()}:{type:"number",value:t.value**n.value};return{type:"undefined"}}function U(e,t){const n=e.op;switch(n){case"-":if("number"!==t.type)throw new(w().I3)({type:w().uW.UnaryMinusOnNonNumber,node:e.expression,expressionType:t.type});return{type:"number",value:-t.value};case"!":case"not":return{type:"checkbox",value:!(0,M().CL)(t)};default:return(0,i().HB)(n)}}function*B(e){const{node:t,token:n,context:r,evaluateAST:o}=e;if((0,M().ix)(n))return yield*function*(e){const{node:t,token:n,context:r,evaluateAST:o}=e,a=r.values.find((e=>e.kind===g().FormulaContextValueKind.ContextValue&&e.id===(0,M().GH)(n.contextValueId)));if(void 0===a)throw new(w().I3)({type:w().uW.MissingContextVariable,node:t,valueId:n.contextValueId});if("block"!==a.value.type)throw new(w().I3)({type:w().uW.ContextVariableWrongType,node:t,valueId:n.contextValueId,expectedType:"block",resultType:a.value.type});const i=a.value.value,u=(yield{recordPointers:[i]}).getRecordModel(i);if(void 0===u)throw new(w().I3)({type:w().uW.MissingDataDependencyBlock,node:t,blockPointer:i});const s=(0,M().Yi)(n.property),{collectionPointer:p,schema:l}=yield*R(u,r);if(!p)throw new(w().I3)({type:w().uW.MissingDataDependencyBlock,node:t,blockPointer:u.pointer});const d=null==l?void 0:l[s];if(void 0===d||void 0===l)throw new(w().I3)({type:w().uW.MissingSchemaPropertyOnCollection,node:t,collectionId:u.getParentId(),property:s});return yield*I({block:u,parentCollectionPointer:p,property:s,schema:l,propertySchema:d,oldContext:r,evaluateAST:o})}({...e,token:n});const a=r.values.find((e=>e.kind===g().FormulaContextValueKind.ThisRow));if("block"!==(null==a?void 0:a.value.type))throw new(w().I3)({type:w().uW.MissingThisRow,node:t});const i=a.value.value,u=(yield{recordPointers:[i]}).getRecordModel(i);if(void 0===u)throw new(w().I3)({type:w().uW.MissingThisRow,node:t});if(void 0===n.collection)return(0,M().ve)(u,n.property);const{collectionPointer:s,schema:p}=yield*R(u,r);if(!s)throw new(w().I3)({type:w().uW.MissingDataDependencyBlock,node:t,blockPointer:u.pointer});if(!(0,f().Z2)(n.collection,s))throw new(w().I3)({type:w().uW.ThisRowBlockPropertyMismatchCollection,node:t,thisRowCollection:s});const l=(0,M().Yi)(n.property),d=null==p?void 0:p[l];if(void 0===d||void 0===p)throw new(w().I3)({type:w().uW.MissingSchemaPropertyOnThisRow,node:t,collectionId:u.getParentId(),property:l});return yield*I({block:u,parentCollectionPointer:s,property:l,schema:p,propertySchema:d,oldContext:r,evaluateAST:o})}function _(e){var t;const{node:n,token:r,context:o}=e,a=null===(t=o.values.find((e=>e.kind===g().FormulaContextValueKind.ContextValue&&e.id===(0,M().GH)(r.valueId))))||void 0===t?void 0:t.value;if(void 0===a)throw new(w().I3)({type:w().uW.MissingContextVariable,node:n,valueId:r.valueId});return a}function D(e){const{value:t,callNode:n,argumentNode:r,parameterIndex:o,libraryFunction:a,expectedParameter:i}=e;if(!(0,M().Hz)(t,i.type)){if(Array.isArray(i.type)?i.type.some((e=>"checkbox"===e.type)):"checkbox"===i.type.type)return{type:"checkbox",value:(0,M().CL)(t)};if(Array.isArray(i.type)?i.type.some((e=>"text"===e.type)):"expression"!==i.type.type&&"text"===(0,M().JK)(i.type).type)return"array"===t.type&&(Array.isArray(i.type)?i.type.some((e=>"array"===e.type)):"array"===i.type.type)?{type:"array",values:t.values.map((e=>({type:"text",value:(0,M().Ht)(e)})))}:"array"===t.type&&0===t.values.length?{type:"text",value:[[""]]}:{type:"text",value:(0,M().Ht)(t)};if(!g().TREAT_UNDEFINED_AS_ZERO_FNS.includes(a.name)&&!g().FLATTENS_NUMBER_ARRAY_FNS.includes(a.name))throw new(w().I3)({type:w().uW.FunctionCallArgumentWrongType,node:n,argument:r,libraryFunction:a,parameterIndex:o,argumentType:t.type})}return t}},844698:(e,t,n)=>{n.d(t,{_:()=>g,y:()=>T});n(944114),n(898992),n(672577),n(430670),n(581454),n(737550);var r=()=>n(763824),o=()=>n(534177),a=()=>n(970013),i=()=>n(696706),u=()=>n(179034),s=()=>n(247331),p=()=>n(420062),l=()=>n(563015),d=()=>n(696446),c=()=>n(106714),y=()=>n(349835),m=()=>n(977345),f=()=>n(628048);function*v(e,t){var n;const r=(yield{recordPointers:[e]}).getRecordModel(e);return r?r.getNormalizedSchema():e.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?null===(o=t.publicPageDataCollection)||void 0===o?void 0:o.schema:void 0;var o}function*h(e,t){const{valueTypes:n}=t;switch(e.kind){case y().NM.Number:return{node:{...e,type:{type:"number"},valueTypes:n},errors:[]};case y().NM.String:return{node:{...e,type:{type:"text"},valueTypes:n},errors:[]};case y().NM.Boolean:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case y().NM.NotionToken:{const i=e.token;switch(i.type){case s().FormulaTokenType.Checkbox:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case s().FormulaTokenType.BlockProperty:{var r;if((0,m().ix)(i)){const r=n.find((e=>e.kind===s().FormulaContextValueKind.ContextValue&&e.id===(0,m().GH)(i.contextValueId)));if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.MissingContextVariable,node:e,token:i}]};const o=r.type;if("block"!==o.type||void 0===o.collection)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.ContextVariableNotBlockWithCollection,node:e,token:i}]};const a=yield*v(o.collection,t),u=(0,m().Yi)(i.property),p=null==a?void 0:a[u];if(void 0===p||void 0===a){var l;const r=(null===(l=t.formulaPropertyNames)||void 0===l?void 0:l.get(u))??u;return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.MissingPropertyOnContextVariable,node:e,property:r,token:i}]}}const d=yield*(0,m().Df)(u,a,p);return{node:{...e,type:d??{type:"unknown"},valueTypes:n},errors:void 0===d?[{type:y().IA.BlockPropertyTypeInvalid,node:e,token:i,propertyName:p.name,propertyType:p.type}]:[]}}const o=null===(r=n.find((e=>e.kind===s().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.type;if(void 0===o)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.ThisRowTypeNotFound,node:e}]};if("block"!==o.type||void 0===o.collection)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.ThisRowNotBlockWithCollection,node:e}]};if(void 0===i.collection)return{node:{...e,type:s().FormulaTokenSupportedBlockSystemPropertyToType[i.property],valueTypes:n},errors:[]};const u=yield*v(o.collection,t),p=(0,m().Yi)(i.property),d=null==u?void 0:u[p];var c,x;if(void 0===d||void 0===u)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.MissingPropertyOnThisRow,node:e,property:(null===(c=t.formulaPropertyNames)||void 0===c?void 0:c.get(p))??p}]};if((0,a().CH)(t.spaceId,d,u))return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(x=t.formulaPropertyNames)||void 0===x?void 0:x.get(p))??p}]};const f=yield*(0,m().Df)(p,u,d);return{node:{...e,type:f??{type:"unknown"},valueTypes:n},errors:void 0===f?[{type:y().IA.MemberPropertyTypeInvalid,node:e,token:i,propertyName:d.name,propertyType:d.type}]:[]}}case s().FormulaTokenType.ContextValue:{var b;const t=null===(b=n.find((e=>e.kind===s().FormulaContextValueKind.ContextValue&&e.id===(0,m().GH)(i.valueId))))||void 0===b?void 0:b.type;return void 0===t?{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.MissingContextVariable,node:e,token:i}]}:{node:{...e,type:t,valueTypes:n},errors:[]}}case s().FormulaTokenType.Block:{const t={table:u().ev,id:i.blockId,spaceId:i.spaceId},r=(yield{recordPointers:[t]}).getRecordModel(t);if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:y().IA.MissingBlock,node:e,token:i}]};const o=r.getCollectionPointer();return{node:{...e,type:{type:"block",collection:o},valueTypes:n},errors:[]}}case s().FormulaTokenType.Person:return{node:{...e,type:{type:"person"},valueTypes:n},errors:[]};case s().FormulaTokenType.Date:return{node:{...e,type:{type:"date"},valueTypes:n},errors:[]};default:return(0,o().HB)(i)}}case y().NM.Array:{const r=yield*(0,d().KZ)(e.elements.map((e=>h(e,t))));let o={type:"unknown"};if(r.length>0){o=r[0].node.type;for(let e=1;e<r.length;e++)if(!(0,m().Re)(o,r[e].node.type)){o={type:"unknown"};break}}return{node:{...e,elements:r.map((e=>e.node)),type:{type:"array",of:o},valueTypes:n},errors:r.flatMap((e=>e.errors))}}case y().NM.Identifier:{var g;const t=null===(g=n.find((t=>t.kind===s().FormulaContextValueKind.Binding&&t.id===e.text)))||void 0===g?void 0:g.type;if(void 0!==t)return{node:{...e,type:t,valueTypes:n},errors:[]};const r=f().LP.hasOwnProperty(e.text)?f().LP[e.text]:void 0;if(void 0===r){const t=[{type:y().IA.UndefinedIdentifier,node:e}];return p().sr.hasOwnProperty(e.text)?t.push({type:y().IA.RenamedIdentifier,node:e,identifier:e.text,renamedTo:p().sr[e.text]}):p().lg.hasOwnProperty(e.text)&&t.push({type:y().IA.RemovedFunction,node:e,functionName:e.text,alternative:p().lg[e.text]}),{node:{...e,type:{type:"unknown"},valueTypes:n},errors:t}}return{node:{...e,type:{type:"function",libraryFunction:r,calledFromUnifiedFunctionProperty:!1},valueTypes:n},errors:[]}}case y().NM.Conditional:{const r=yield*h(e.condition,t),o=yield*h(e.expIfTrue,t),a=void 0!==e.expIfFalse?yield*h(e.expIfFalse,t):void 0;let i={type:"unknown"};return void 0===o.node.type||void 0!==(null==a?void 0:a.node.type)&&!(0,m().Re)(o.node.type,a.node.type)||(i=o.node.type),{node:{...e,condition:r.node,expIfTrue:o.node,expIfFalse:null==a?void 0:a.node,type:i,valueTypes:n},errors:[...r.errors,...o.errors??[],...(null==a?void 0:a.errors)??[]]}}case y().NM.LogicalOr:case y().NM.LogicalAnd:const w=yield*(0,d().KZ)(e.elements.map((e=>h(e,t)))),M=w.flatMap((e=>e.errors));return{node:{...e,elements:w.map((e=>e.node)),type:{type:"checkbox"},valueTypes:n},errors:M};case y().NM.Equality:case y().NM.Relational:{const r=yield*h(e.lhs,t),o=yield*h(e.rhs,t),a=[...r.errors,...o.errors];if(e.kind===y().NM.Relational){const t=r.node.type,n=o.node.type;"unknown"===t.type||"unknown"===n.type||t.type===n.type&&["number","date","text","checkbox"].includes(t.type)||a.push({type:y().IA.CannotRelativelyCompareTypes,node:e,lhsType:t,rhsType:n})}return{node:{...e,lhs:r.node,rhs:o.node,type:{type:"checkbox"},valueTypes:n},errors:a}}case y().NM.Additive:case y().NM.Multiplicative:case y().NM.Exponentiation:{const r=yield*h(e.lhs,t),o=yield*h(e.rhs,t),a=[...r.errors,...o.errors];if("+"===e.op)return"number"===r.node.type.type&&"number"===o.node.type.type?{node:{...e,lhs:r.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:a}:{node:{...e,lhs:r.node,rhs:o.node,type:["unknown","number"].includes(r.node.type.type)&&["unknown","number"].includes(o.node.type.type??"unknown")?{type:"unknown"}:{type:"text"},valueTypes:n},errors:a};const i=function(e,t,n){const r=t.type,o=(null==n?void 0:n.type)??{type:"unknown"};if(!["unknown","number"].includes(r.type)||!["unknown","number"].includes(o.type))return{type:y().IA.CannotDoMathOnType,node:e,lhsType:r,rhsType:o}}(e,r.node,o.node);return void 0!==i&&a.push(i),{node:{...e,lhs:r.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:a}}case y().NM.Unary:{const r=yield*h(e.expression,t),a=[...r.errors];let i;switch(e.op){case"-":["number","unknown"].includes(r.node.type.type)||a.push({type:y().IA.UnaryMinusOnNonNumber,node:e,expression:r.node}),i={type:"number"};break;case"!":case"not":i={type:"checkbox"};break;default:(0,o().HB)(e)}return{node:{...e,expression:r.node,type:i,valueTypes:n},errors:a}}case y().NM.Call:{const{node:r,errors:o}=yield*h(e.expression,t),a=[...o];if(r.kind===y().NM.Identifier&&("lets"===r.text||"let"===r.text)){const o=[];let i=[...n];for(let n=0;n<e.arguments.length-1;n+=2){const r=e.arguments[n],u=e.arguments[n+1];if(r.kind!==y().NM.Identifier){a.push({type:y().IA.IdentifierExpected,node:r});continue}const{node:p,errors:l}=yield*h(u,{...t,valueTypes:i});o[n+1]=p,a.push(...l);const d=r.text;i=[{kind:s().FormulaContextValueKind.Binding,id:d,name:d,type:p.type},...i],o[n]={...r,type:p.type,valueTypes:i}}const u=e.arguments[e.arguments.length-1];if(!u)return{node:{...e,expression:r,arguments:o,type:{type:"unknown"},valueTypes:i},errors:a};const{node:p,errors:l}=yield*h(u,{...t,valueTypes:i});return o[e.arguments.length-1]=p,a.push(...l),{node:{...e,expression:r,arguments:o,type:p.type,valueTypes:i},errors:a}}["function","unknown"].includes(r.type.type)||a.push({type:y().IA.CallingNotFunction,node:e,callee:r});const i="function"===r.type.type?r.type.libraryFunction:void 0,u="function"===r.type.type?r.type.boundTargetType:void 0;if(void 0!==i){const t=(0,m().ab)(i),n=e.arguments.length+(void 0!==u?1:0);n<t&&("function"===r.type.type&&r.type.calledFromUnifiedFunctionProperty?a.push({type:y().IA.FunctionCallTooFewArguments,node:e,libraryFunction:i,numArguments:n-1,minNumParameters:t-1}):a.push({type:y().IA.FunctionCallTooFewArguments,node:e,libraryFunction:i,numArguments:n,minNumParameters:t}))}const p=[],l=[];void 0!==u&&l.push(u);for(let d=0;d<e.arguments.length;d++){const r=e.arguments[d],o=void 0!==u?d+1:d,c=void 0!==i?(0,m().Pf)(i,o):void 0;if(void 0!==i&&void 0===c&&a.push({type:y().IA.FunctionCallUnexpectedArgument,node:e,libraryFunction:i,argument:r,parameterIndex:o}),void 0!==(null==c?void 0:c.augmentScope)){const e=p.map((e=>(null==e?void 0:e.type)??{type:"unknown"})),o=c.augmentScope(void 0!==u?[u,...e]:e),{node:i,errors:y}=yield*h(r,{...t,valueTypes:[...Object.entries(o).map((e=>{let[t,n]=e;return{kind:s().FormulaContextValueKind.Binding,id:t,type:n}})),...n]});p[d]=i,l.push(i.type),a.push(...y)}else{const{node:n,errors:o}=yield*h(r,t);if(p[d]=n,void 0!==i&&void 0!==c){const t="id"===i.name&&"block"===n.type.type||(0,m().CM)(n.type,c.type);"boolean"==typeof t?(l.push(n.type),t||a.push({type:y().IA.FunctionCallArgumentWrongType,node:e,libraryFunction:i,argument:n,expectedParameter:c})):l.push(t)}else l.push(n.type);a.push(...o)}}return{node:{...e,expression:r,arguments:p,type:void 0!==i?"function"==typeof i.returnType?i.returnType(l):i.returnType:{type:"unknown"},valueTypes:n},errors:a}}case y().NM.UnifiedFunctionProperty:{const r=f().LP.hasOwnProperty(e.name)?f().LP[e.name]:void 0,{node:o,errors:a}=yield*h(e.expression,t),i=[...a];let u={type:"unknown"};if(void 0===r)i.push({type:y().IA.UnifiedFunctionCannotFindFunction,node:e,name:e.name});else{const t=(0,m().Pf)(r,0);if(void 0===t)i.push({type:y().IA.UnifiedFunctionNoArguments,node:e,libraryFunction:r});else{const n="id"===r.name&&"block"===o.type.type||(0,m().CM)(o.type,t.type);"boolean"==typeof n?(u=o.type,n||i.push({type:y().IA.UnifiedFunctionTargetWrongType,node:e,expression:o,libraryFunction:r})):u=n}}return{node:{...e,expression:o,type:void 0!==r?{type:"function",boundTargetType:u,libraryFunction:r,calledFromUnifiedFunctionProperty:!0}:{type:"unknown"},valueTypes:n},errors:i}}case y().NM.MemberBlockProperty:{const{node:r,errors:o}=yield*h(e.expression,t),u=[...o];let p;if("block"===r.type.type)if(void 0===e.propertyToken.collection)p=s().FormulaTokenSupportedBlockSystemPropertyToType[e.propertyToken.property];else{const n=yield*v(e.propertyToken.collection,t),o=(0,m().Yi)(e.propertyToken.property),s=null==n?void 0:n[o];var T;if(void 0===s||void 0===n)u.push({type:y().IA.MemberPropertyMissing,node:e,property:(null===(T=t.formulaPropertyNames)||void 0===T?void 0:T[o])??o});else if(void 0!==r.type.collection){var k;if((0,a().CH)(t.spaceId,s,n))u.push({type:y().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(k=t.formulaPropertyNames)||void 0===k?void 0:k.get(o))??o});if((0,i().Z2)(e.propertyToken.collection,r.type.collection)){const t=yield*(0,m().Df)(o,n,s);p=t,void 0===t&&u.push({type:y().IA.MemberPropertyTypeInvalid,node:e,token:e.propertyToken,propertyName:s.name,propertyType:s.type})}else u.push({type:y().IA.MemberPropertyMismatchCollection,node:e,token:e.propertyToken})}}else"unknown"!==r.type.type&&u.push({type:y().IA.MemberPropertyTargetNotBlock,node:e,expression:r});return{node:{...e,expression:r,type:p??{type:"unknown"},valueTypes:n},errors:u}}case y().NM.RecoveryNode:return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[]};default:(0,o().HB)(e)}}function x(e,t){return"array"!==e.type?e.type===t.type:"array"===t.type&&("array"===e.of.type?x(e.of,t):x(e.of,t.of))}function b(e,t){return t.some((t=>x(e,t)))}async function g(e,t,n){const o=h(e,t);let a=o.next();for(;!a.done;){const e=t.handleDataRequest(a.value);a=o.next((0,r().yL)(e)?await e:e)}if(t.allowedReturnTypes&&!b(a.value.node.type,t.allowedReturnTypes)&&a.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:a.value.node,returnType:a.value.node.type,type:y().IA.DisallowedReturnType}),!n)return a.value;const i=a.value.errors.map((e=>{const t=(0,l().zf)(e);return{...e,node:(0,c().TW)(t,n)}}));return{node:a.value.node,errors:i}}function T(e,t,n){const r=h(e,t);let o=r.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=r.next(e)}if(t.allowedReturnTypes&&!b(o.value.node.type,t.allowedReturnTypes)&&o.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:o.value.node,returnType:o.value.node.type,type:y().IA.DisallowedReturnType}),!n)return o.value;const a=o.value.errors.map((e=>{const t=(0,l().zf)(e);return{...e,node:(0,c().TW)(t,n)}}));return{node:o.value.node,errors:a}}},958970:(e,t,n)=>{n.d(t,{f:()=>l});n(16280),n(898992),n(672577),n(581454);var r=()=>n(319625),o=()=>n(247331),a=()=>n(44907),i=()=>n(349835),u=()=>n(977345);const s=new RegExp(/\\([\\nt"])/g);function p(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function l(e){const t=function(){const e=(0,a().p8)(),t=(0,a()._M)(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}expression(e){return this.visit(e.conditionalExpression)}primaryExpression(e){if(void 0!==e.parenthesisExpression)return this.visit(e.parenthesisExpression);if(void 0!==e.arrayExpression)return this.visit(e.arrayExpression);if(void 0!==e.NumberLiteral)return{kind:i().NM.Number,text:e.NumberLiteral[0].image,startOffset:e.NumberLiteral[0].startOffset,endOffset:e.NumberLiteral[0].endOffset};if(void 0!==e.StringLiteral){const t=e.StringLiteral[0].image.slice(1,-1).replace(s,((e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";default:return t}}));return{kind:i().NM.String,text:t,startOffset:e.StringLiteral[0].startOffset,endOffset:e.StringLiteral[0].endOffset}}return void 0!==e.UnclosedStringLiteral?{kind:i().NM.String,text:e.UnclosedStringLiteral[0].image.substring(1,e.UnclosedStringLiteral[0].image.length),startOffset:e.UnclosedStringLiteral[0].startOffset,endOffset:e.UnclosedStringLiteral[0].endOffset}:void 0!==e.BooleanLiteral?{kind:i().NM.Boolean,text:e.BooleanLiteral[0].image,startOffset:e.BooleanLiteral[0].startOffset,endOffset:e.BooleanLiteral[0].endOffset}:void 0!==e.InputToken?{kind:i().NM.NotionToken,token:e.InputToken[0].payload,startOffset:e.InputToken[0].startOffset,endOffset:e.InputToken[0].endOffset}:void 0!==e.IdentifierName?{kind:i().NM.Identifier,text:e.IdentifierName[0].image,startOffset:e.IdentifierName[0].startOffset,endOffset:e.IdentifierName[0].endOffset}:{kind:i().NM.RecoveryNode,startOffset:-1,endOffset:-1}}conditionalExpression(e){const t=this.visit(e.condition[0]);var n,r,o,a;return void 0!==e.QuestionMark?{kind:i().NM.Conditional,condition:t,expIfTrue:this.visit(e.expIfTrue[0]),expIfFalse:void 0!==(null===(n=e.expIfFalse)||void 0===n?void 0:n[0])?this.visit(e.expIfFalse[0]):void 0,startOffset:e.condition[0].location.startOffset,endOffset:p([null===(r=e.expIfFalse)||void 0===r||null===(r=r[0].location)||void 0===r?void 0:r.endOffset,null===(o=e.Colon)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.endOffset,null===(a=e.expIfTrue[0].location)||void 0===a?void 0:a.endOffset,e.QuestionMark[0].endOffset])}:t}logicalOrExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.Or){var n,r;const o=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:i().NM.LogicalOr,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.Or[0].endOffset])}}return t}logicalAndExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.And){var n,r;const o=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:i().NM.LogicalAnd,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.And[0].endOffset])}}return t}equalityExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.EqualityOperator){var n;const r=e.rhs[0];return{kind:i().NM.Equality,op:e.EqualityOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.EqualityOperator[0].endOffset])}}return t}relationalExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.RelationalOperator){var n;const r=e.rhs[0];return{kind:i().NM.Relational,op:e.RelationalOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.RelationalOperator[0].endOffset])}}return t}additionExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.AdditionOperator)for(let r=0;r<e.AdditionOperator.length;r++){var n;const o=e.rhs[r];t={kind:i().NM.Additive,op:e.AdditionOperator[r].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=o.location)||void 0===n?void 0:n.endOffset,e.AdditionOperator[r].endOffset])}}return t}multiplicationExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.MultiplicationOperator)for(let r=0;r<e.MultiplicationOperator.length;r++){var n;const o=e.rhs[r];t={kind:i().NM.Multiplicative,op:e.MultiplicationOperator[r].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=o.location)||void 0===n?void 0:n.endOffset,e.MultiplicationOperator[r].endOffset])}}return t}exponentiationExpression(e){let t;const n=this.visit(e.lhs[0]);if(void 0!==e.Caret){var r;const o=e.Caret.length-1;let a,u=null===(r=e.rhs[o].location)||void 0===r?void 0:r.endOffset;(void 0===u||isNaN(u))&&(u=e.Caret[o].endOffset);for(let n=e.Caret.length-1;n>=0;n--){const r=e.rhs[n];t=void 0===a?this.visit(r):{kind:i().NM.Exponentiation,op:a,lhs:this.visit(r),rhs:t,startOffset:r.location.startOffset,endOffset:u},a=e.Caret[n].image}return{kind:i().NM.Exponentiation,op:a,lhs:n,rhs:t,startOffset:e.lhs[0].location.startOffset,endOffset:u}}return n}unaryExpression(e){let t=this.visit(e.primaryExpression[0]),n=e.primaryExpression[0].location.startOffset;const r=void 0!==e.UnaryOperator&&"-"===e.UnaryOperator[0].image&&t.kind===i().NM.Number;var a;if(r&&(t={kind:i().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}),isNaN(n)&&(n=null===(a=e.memberCallSubExpression)||void 0===a?void 0:a[0].location.startOffset),void 0!==e.memberCallSubExpression)for(const d of e.memberCallSubExpression){const e=d.location.endOffset;if(void 0!==d.children.callArguments){var s,p,l;const r=d.children.callArguments[0].children;t={kind:i().NM.Call,expression:t,arguments:(null===(s=d.children.callArguments[0])||void 0===s||null===(s=s.children.expression)||void 0===s?void 0:s.map((e=>this.visit(e))))??[],lParenOffset:r.LParen[0].startOffset,rParenOffset:null===(p=r.RParen)||void 0===p?void 0:p[0].startOffset,commaOffsets:(null===(l=r.Comma)||void 0===l?void 0:l.map((e=>e.startOffset)))??[],startOffset:n,endOffset:e}}else if(void 0!==d.children.dotMemberExpression){const r=d.children.dotMemberExpression[0].children;if(void 0!==r.IdentifierName){const o=r.IdentifierName[0];t={kind:i().NM.UnifiedFunctionProperty,expression:t,name:o.image,nameStartOffset:o.startOffset,nameEndOffset:o.endOffset,startOffset:n,endOffset:e}}else if(void 0!==r.InputToken){const a=r.InputToken[0],s=a.payload;if(s.type===o().FormulaTokenType.BlockProperty){if((0,u().ix)(s))throw new Error("unexpected block property context value in unaryExpression");t={kind:i().NM.MemberBlockProperty,expression:t,propertyToken:void 0===s.collection?{property:s.property,collection:void 0}:{property:s.property,collection:s.collection},propertyStartOffset:a.startOffset,propertyEndOffset:a.endOffset,startOffset:n,endOffset:e}}}}}return void 0===e.UnaryOperator||r?t:{kind:i().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase().trimEnd(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}}parenthesisExpression(e){return this.visit(e.expression[0])}arrayExpression(e){var t,n,r,o,a;return{kind:i().NM.Array,elements:(null===(t=e.expression)||void 0===t?void 0:t.map((e=>this.visit(e))))??[],lBracketOffset:e.LBracket[0].startOffset,rBracketOffset:null===(n=e.RBracket)||void 0===n?void 0:n[0].startOffset,commaOffsets:(null===(r=e.Comma)||void 0===r?void 0:r.map((e=>e.startOffset)))??[],startOffset:e.LBracket[0].startOffset,endOffset:p([null===(o=e.RBracket)||void 0===o?void 0:o[0].endOffset,null===(a=e.expression)||void 0===a||null===(a=a[e.expression.length-1])||void 0===a||null===(a=a.location)||void 0===a?void 0:a.endOffset,e.LBracket[0].endOffset])}}memberCallSubExpression(e){throw new Error("unexpected memberCallSubExpression")}dotMemberExpression(e){throw new Error("unexpected dotMemberExpression")}callArguments(e){throw new Error("unexpected callArguments")}}}();try{return{value:t.visit(e)}}catch(n){return{error:{type:i().M9.UnexpectedError,error:(0,r().A)(n),offset:0}}}}}}]);