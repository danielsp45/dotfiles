"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22542,54220],{563015:(e,t,o)=>{o.d(t,{eJ:()=>f,ew:()=>m,ml:()=>u,rA:()=>y,yI:()=>d,zf:()=>p});o(581454);var n=()=>o(496603),r=()=>o(534177),a=()=>o(708685),c=()=>o(145076),i=()=>o(349835),s=()=>o(977345);function l(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().HB)(e)}}function u(e){switch(e.type){case i().M9.InvalidCharacter:return{...c().x0.InvalidCharacter,values:{errorCharacter:e.character}};case i().M9.UnclosedStringLiteral:return c().x0.UnclosedStringLiteral;case i().M9.UnclosedComment:return c().x0.UnclosedComment;case i().M9.TokenExpected:return{...c().x0.TokenExpected,values:{expectedToken:e.token}};case i().M9.StringLiteralContainsToken:return c().x0.StringLiteralContainsToken;case i().M9.ExpressionExpected:return c().x0.ExpressionExpected;case i().M9.PropertyTokenOrFunctionExpected:return c().x0.PropertyTokenOrFunctionExpected;case i().M9.EndOfInputExpected:return c().x0.EndOfInputExpected;case i().M9.UnexpectedError:return c().x0.UnexpectedError;case i().M9.TooDeeplyNested:return c().x0.TooDeeplyNested;default:(0,r().HB)(e)}}function p(e){switch(e.type){case i().IA.FunctionCallArgumentWrongType:case i().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function y(e,t){let o;switch(t.type){case i().IA.ThisRowTypeNotFound:o=c().Xz.ThisRowTypeNotFound;break;case i().IA.ThisRowNotBlockWithCollection:o=c().Xz.ThisRowNotBlockWithCollection;break;case i().IA.MissingPropertyOnThisRow:o={...c().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case i().IA.MissingContextVariable:{const e=(0,s().ix)(t.token)?t.token.contextValueId:t.token.valueId;o={...c().Xz.MissingContextVariable,values:{valueId:e}}}break;case i().IA.MissingBlock:o={...c().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case i().IA.CallingNotFunction:o={...c().Xz.CallingNotFunction,values:{expressionType:l(t.callee.type.type)}};break;case i().IA.FunctionCallTooFewArguments:o={...c().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case i().IA.FunctionCallUnexpectedArgument:o={...c().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case i().IA.FunctionCallArgumentWrongType:o={...c().Xz.FunctionCallArgumentWrongType,values:{argumentType:l(t.argument.type.type),functionName:t.libraryFunction.name}};break;case i().IA.MemberPropertyMismatchCollection:o={...c().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case i().IA.MemberPropertyMissing:o={...c().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case i().IA.MemberPropertyTargetNotBlock:o=c().Xz.MemberPropertyTargetNotBlock;break;case i().IA.MemberPropertyTypeInvalid:o={...c().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case i().IA.UndefinedIdentifier:o={...c().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case i().IA.UnifiedFunctionCannotFindFunction:o={...c().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case i().IA.UnifiedFunctionNoArguments:o={...c().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case i().IA.UnifiedFunctionTargetWrongType:o={...c().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:l(t.expression.type.type)}};break;case i().IA.CannotRelativelyCompareTypes:o={...c().Xz.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case i().IA.CannotDoMathOnType:o={...c().Xz.CannotDoMathOnType,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case i().IA.UnaryMinusOnNonNumber:o={...c().Xz.UnaryMinusOnNonNumber,values:{type:l(t.expression.type.type)}};break;case i().IA.IdentifierExpected:o=c().Xz.IdentifierExpected;break;case i().IA.FunctionCallExpected:o={...c().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case i().IA.RenamedIdentifier:o={...c().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case i().IA.RemovedFunction:o={...c().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case i().IA.ContextVariableNotBlockWithCollection:o={...c().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case i().IA.MissingPropertyOnContextVariable:o={...c().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case i().IA.BlockPropertyTypeInvalid:o={...c().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case i().IA.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...c().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,a().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case i().IA.CrossSpacePropertyNotSupported:o={...c().Xz.CrossSpacePropertyNotSupported};break;default:(0,r().HB)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function d(e,t){let o;switch(t.type){case i().uW.MissingThisRow:o=c().X8.MissingThisRow;break;case i().uW.MissingSchemaPropertyOnThisRow:o={...c().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case i().uW.ThisRowBlockPropertyMismatchCollection:o=c().X8.ThisRowBlockPropertyMismatchCollection;break;case i().uW.MissingContextVariable:o={...c().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case i().uW.IdentifierNotFound:o={...c().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case i().uW.CannotRelativelyCompareTypes:o={...c().X8.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType),rhsType:l(t.rhsType)}};break;case i().uW.CannotDoMathOnType:o={...c().X8.CannotDoMathOnType,values:{valueType:l(t.valueType)}};break;case i().uW.CannotCallNonFunction:o={...c().X8.CannotCallNonFunction,values:{calleeType:l(t.calleeType)}};break;case i().uW.UnifiedFunctionPropertyNotFound:o={...c().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case i().uW.LibraryFunctionExecutionError:const n=t.error instanceof i().x4?t.error:void 0;o=(null==n?void 0:n.info.type)===i().v3.DateInvalidDurationUnit?{...c().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===i().v3.CannotUseToNumberOnList?{...c().gW.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===i().v3.CannotRoundToNonInteger?{...c().gW.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===i().v3.CannotRoundToTooManyDecimalPlaces?{...c().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...c().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case i().uW.FunctionCallTooFewArguments:o={...c().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case i().uW.FunctionCallUnexpectedArgument:o={...c().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case i().uW.FunctionCallArgumentWrongType:o={...c().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:l(t.argumentType)}};break;case i().uW.AccessingPropertyOnNonBlock:o=c().X8.AccessingPropertyOnNonBlock;break;case i().uW.MissingDataDependencyBlock:o={...c().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case i().uW.MissingDataDependencyPerson:o={...c().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case i().uW.MemberPropertyMismatchCollection:o=c().X8.MemberPropertyMismatchCollection;break;case i().uW.MissingPropertyOnSchemaForMemberProperty:o=c().X8.MissingPropertyOnSchemaForMemberProperty;break;case i().uW.UnaryMinusOnNonNumber:o={...c().X8.UnaryMinusOnNonNumber,values:{expressionType:l(t.expressionType)}};break;case i().uW.UnexpectedRecoveryNode:o=c().X8.UnexpectedRecoveryNode;break;case i().uW.UnexpectedError:o=c().X8.UnexpectedError;break;case i().uW.DepthExceeded:o=c().X8.DepthExceeded;break;case i().uW.CycleDetected:o=c().X8.CycleDetected;break;case i().uW.DownstreamParseFailure:o=c().X8.DownstreamParseFailure;break;case i().uW.MaxEvaluationTimeExceeded:o=c().X8.MaxEvaluationTimeExceeded;break;case i().uW.MissingSchemaPropertyOnCollection:o={...c().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case i().uW.ContextVariableWrongType:o={...c().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case i().uW.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...c().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,a().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().HB)(t)}return(0,s().li)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function m(e){const t=null==e?void 0:e.values;return[n().cJ(e,"values"),t]}function f(e){return e.type===i().uW.DepthExceeded||e.type===i().uW.CycleDetected||e.type===i().uW.MaxEvaluationTimeExceeded||e.type===i().uW.LibraryFunctionExecutionError}},791089:(e,t,o)=>{o.r(t),o.d(t,{analyzeSimpleFormulaOrFormulaSync:()=>i,executeSimpleFormulaAsyncWithStats:()=>d,filterTextValueToSimpleFormulaValueTokens:()=>T().LU,fromSimpleFormulaArrayValue:()=>T().FW,getDependenciesForSimpleFormula:()=>T().BT,getDependenciesForSimpleFormulaOrFormula:()=>T().MP,getReferencedContextValueIds:()=>T().yP,isAnnotationSimpleValueToken:()=>T().eU,setPropertyValueToFormulaReturnType:()=>T().qB,setPropertyValueToSimpleFormulaReturnType:()=>T().Iv,simpleFormulaValueTypeToFormulaReturnType:()=>T().BZ,simpleFormulaValueWithoutToken:()=>T().h0,singleSimpleValueTokenToTextToken:()=>T().ii,toSimpleFormulaArrayValue:()=>T().M0,toSimpleFormulaSingleValue:()=>T().fd,typecheckSimpleFormulaOrFormula:()=>s});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(534177),r=()=>o(919709),a=()=>o(871202),c=()=>o(80979);function i(e){const{context:t,value:o}=e;if((0,n().O9)(o)&&(0,n().O9)(o.value)){if("simple"===o.type)return function(e,t){const o=[],n=[];for(const a of e){const e=(0,r().uPN)(a);if(!(0,r().x9g)(e))continue;const i=(0,c().analyzeFormulaSync)([a],t);o.push(...i.parseErrors??[]),n.push(...i.typeErrors??[])}return{type:{type:"text"},parseErrors:o,typeErrors:n}}(o.value,t);{const e=(0,c().analyzeFormulaSync)(o.value,t);return(0,n().O9)(e.type)?e:{parseErrors:e.parseErrors,type:{type:"unknown"},typeErrors:e.typeErrors}}}return{type:{type:"unknown"}}}function s(e){const{context:t,value:o,collectionPointer:n}=e,c=performance.now(),s=i({context:t,value:o}),l=Math.trunc(performance.now()-c),u=!(s.typeErrors&&0!==s.typeErrors.length||s.parseErrors&&0!==s.parseErrors.length),p=!!u&&function(e){let{context:t,value:o,collectionPointer:n}=e;if(!o.value)return!1;let c=!1;if("formula"===o.type){(0,a().hasAccessToCode)({collectionPointer:n,context:t,depth:0,code:o.value,visitedPointers:new Set,hasAccessFn:a().hasSameSpaceAccess})||(c=!0)}else if("simple"===o.type)for(const i of o.value){const e=(0,r().uPN)(i);if(!(0,r().x9g)(e))continue;(0,a().hasAccessToCode)({collectionPointer:n,context:t,depth:0,code:[i],visitedPointers:new Set,hasAccessFn:a().hasSameSpaceAccess})||(c=!0)}return c}({context:t,value:o,collectionPointer:n});return{result:s,hasCrossSpaceError:p,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:void 0,formulaExecutionSuccess:void 0,totalFormulas:void 0,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:void 0,simpleFormulaExecutionSuccess:void 0,totalSimpleFormulas:void 0,..."simple"===o.type?{simpleFormulaTypecheckDurationMs:l,simpleFormulaTypecheckSuccess:u,totalSimpleFormulas:1}:{formulaTypecheckDurationMs:l,formulaTypecheckSuccess:u,totalFormulas:1}}}}o(898992),o(354520),o(581454);var l=()=>o(973647),u=()=>o(713998),p=()=>o(977345);function y(e){return!("number"===e.type||"text"===e.type||"checkbox"===e.type)}async function d(e){const{context:t,value:o}=e,r=performance.now(),a=await m(e),c=Math.trunc(performance.now()-r),i=l().Q.isSuccess(a);return"simple"===o.type?y(t.returnType)?{result:a,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:void 0,formulaExecutionSuccess:void 0,totalFormulas:void 0,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:c,simpleFormulaExecutionSuccess:i,totalSimpleFormulas:1}}:{result:a}:"formula"===o.type?{result:a,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:c,formulaExecutionSuccess:i,totalFormulas:1,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:void 0,simpleFormulaExecutionSuccess:void 0,totalSimpleFormulas:void 0}}:(0,n().HB)(o.type)}async function m(e){const{context:t,executeFormula:o,ignoreErrors:a,value:c}=e,{returnType:i}=t,s=c.value;if("simple"===c.type){let e=s;if(!y(i)&&v(e)){const n=await f({context:t,executeFormula:o,value:e});if(l().Q.isFail(n))return a?{value:{type:"undefined"}}:n;e=n.value}if("number"===i.type){const t=u().Me(e);return(0,n().O9)(t)&&!isNaN(t)?{value:{type:"number",value:t}}:{value:{type:"undefined"}}}if("text"===i.type)return{value:{type:"text",value:e??[]}};if("checkbox"===i.type){return{value:{type:"checkbox",value:"true"===r().q4_(e)}}}return o(t,e)}return"formula"===c.type?o(t,s):(0,n().HB)(c.type)}async function f(e){const{context:t,executeFormula:o,ignoreErrors:a,value:c}=e;if(!(0,n().O9)(c))return{value:void 0};const i=[];let s=[];for(const n of c)if(s=r().uPN(n),r().tVx(s)){const e=await o(t,[n]);if(l().Q.isFail(e)&&!a)return e;l().Q.isSuccess(e)&&i.push(...h((0,p().Ht)(e.value),s))}else if(r().TVE(s)){const e=await o(t,[n]);if(l().Q.isFail(e)&&!a)return e;l().Q.isSuccess(e)&&i.push(...h((0,p().Ht)(e.value),s))}else i.push(n);return{value:i}}function h(e,t){if(0===r().AhH(e))return e;const o=t.filter((e=>r().jcO(e)));return 0===o.length?e:r().__s(e.map((e=>{const t=r().uPN(e);return 0===t.length?r().Ey_(r().N8A(e),o):r().Ey_(r().N8A(e),r().RFR(t,o))})))}function v(e){if(!(0,n().O9)(e))return!1;let t;for(const o of e)if(t=r().uPN(o),0!==t.length&&r().x9g(t))return!0;return!1}var T=()=>o(490704)},871202:(e,t,o)=>{o.r(t),o.d(t,{hasAccessDefaultFn:()=>T,hasAccessToCode:()=>b,hasAccessToProperty:()=>k,hasReadPermissionsAccess:()=>x,hasSameSpaceAccess:()=>F,testOnly:()=>g});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=()=>o(496603),r=()=>o(763824),a=()=>o(973647),c=()=>o(534177),i=()=>o(970013),s=()=>o(247331),l=()=>o(443881),u=()=>o(977345),p=()=>o(501053),y=()=>o(373907);function*d(e){const{collectionPointer:t,context:o,propertyId:n,propertySchema:r,visitedPointers:a,hasAccessFn:c}=e,i=(0,l().G7)({...t,propertyId:n});if(a.has(i))return!0;a.add(i);const s=c({propertySchema:r,spaceId:o.spaceId});return"boolean"==typeof s?s:yield*s}function*m(e){var t,o;const{collectionPointer:r,depth:p,collectionSchema:d,context:m,propertyId:f,propertySchema:h,visitedPointers:T,hasAccessFn:x}=e;if("v2"!==h.version||p>s().FORMULA_MAX_DEPTH)return!1;const F=(0,l().G7)({...r,propertyId:f});if(T.has(F))return!0;if(T.add(F),!(0,c().O9)(null===(t=h.formula2)||void 0===t?void 0:t.code))return!0;const k=(0,y().$t)(null===(o=h.formula2)||void 0===o?void 0:o.code);if(a().Q.isFail(k))return!0;const{spaceId:b}=m,g=(0,l().zm)({formulaTypecheckContextValues:[{kind:s().FormulaContextValueKind.ThisRow,type:{collection:r,type:"block"}}],node:k.value,spaceId:b}),P=(0,n().hS)(g,(e=>(0,l().G7)(e)));if(0===P.length)return!0;const{getRecordModel:S}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:r,property:f,schema:d}],recordPointers:P.filter((e=>(0,u().T3)(e)))};for(const n of P)if((0,i().pq)(n)){const e=S(n);if(!(0,c().O9)(e))return!1;const t=n.propertyId,o=e.getSchema(),r=o[t];if(!r)continue;if((0,i().bT)(r)||(0,i().lb)(r)){if(!(yield*v({collectionPointer:n,collectionSchema:o,context:m,depth:p+1,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:x})))return!1}else if((0,i().nC)(r)){if(!(yield*v({collectionPointer:n,collectionSchema:o,context:m,depth:p,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:x})))return!1}}else if(!(0,c().O9)(S(n)))return!1;return!0}function*f(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:u,hasAccessFn:y}=e;if("v2"===c.version||o>s().FORMULA_MAX_DEPTH)return!1;const d=(0,l().G7)({...t,propertyId:a});if(u.has(d))return!0;u.add(d);const m=(0,p().kh)(c.formula);if(0===m.length)return!0;for(const s of m){const e=n[s];if(e)if((0,i().bT)(e)||(0,i().lb)(e)){if(!(yield*v({collectionPointer:t,depth:o+1,collectionSchema:n,context:r,propertyId:s,propertySchema:e,visitedPointers:u,hasAccessFn:y})))return!1}else if((0,i().nC)(e)){if(!(yield*v({collectionPointer:t,collectionSchema:n,context:r,depth:o,propertyId:s,propertySchema:e,visitedPointers:u,hasAccessFn:y})))return!1}}return!0}function*h(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:u,hasAccessFn:p}=e;if(o>s().FORMULA_MAX_DEPTH)return!1;const y=(0,l().G7)({...t,propertyId:a});if(u.has(y))return!0;if(u.add(y),!c.relation_property||!c.target_property)return!0;const d=n[c.relation_property];if(!d||"relation"!==d.type)return!0;const m=p({propertySchema:d,spaceId:r.spaceId});if(!("boolean"==typeof m?m:yield*m))return!1;const f=(0,i().Nv)(d);if(!f)return!0;const{getRecordModel:h}=yield{recordPointers:[f]},T=h(f),x=null==T?void 0:T.getNormalizedSchema();if(c.target_property_type&&x){const e=x[c.target_property];if(e&&c.target_property_type===e.type){if((0,i().lb)(e))return yield*v({collectionPointer:f,collectionSchema:x,context:r,depth:o+1,propertyId:c.target_property,propertySchema:e,visitedPointers:u,hasAccessFn:p});if((0,i().nC)(e))return yield*v({collectionPointer:f,collectionSchema:x,context:r,depth:o,propertyId:c.target_property,propertySchema:e,visitedPointers:u,hasAccessFn:p})}}return!0}function*v(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}=e;return(0,i().nC)(c)?yield*d({collectionPointer:t,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):(0,i().lb)(c)?"v2"===c.version?yield*m({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):yield*f({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):!(0,i().bT)(c)||(yield*h({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}))}function*T(e){const{propertySchema:t,spaceId:o}=e,n=(0,i().Nv)(t);if(!(0,c().O9)(n))return!0;const{getRecordModel:r}=yield{recordPointers:[n]},a=r(n);return(0,c().O9)(a)&&F({spaceId:o,propertySchema:t})}function*x(e){const{propertySchema:t}=e,o=(0,i().Nv)(t);if(!(0,c().O9)(o))return!0;const{getRecordModel:n}=yield{recordPointers:[o]},r=n(o);return(0,c().O9)(r)}function F(e){const{propertySchema:t,spaceId:o}=e;return!(0,i().o2)(o,t)}async function k(e){const{collectionPointer:t,collectionSchema:o,context:n,propertyId:a,hasAccessFn:c}=e,i=o[a];return!i||await async function(e){const{context:t}=e;try{const o=v(e);let n=o.next();for(;!n.done;){const e=t.handleDataRequest(n.value);n=o.next((0,r().yL)(e)?await e:e)}return n.value}catch(o){return!0}}({collectionPointer:t,depth:0,collectionSchema:o,context:n,propertyId:a,propertySchema:i,visitedPointers:new Set,hasAccessFn:c})}function b(e){const{context:t}=e;try{const o=function*(e){const{collectionPointer:t,depth:o,context:r,code:p,visitedPointers:d,hasAccessFn:m}=e,f=(0,y().$t)(p);if(a().Q.isFail(f))return!0;const{spaceId:h}=r,T=r.valueTypes.filter((e=>e.kind!==s().FormulaContextValueKind.ThisRow)),x=(0,l().zm)({formulaTypecheckContextValues:t?[...T,{kind:s().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:f.value,spaceId:h}),F=(0,n().hS)(x,(e=>(0,l().G7)(e)));if(0===F.length)return!0;const{getRecordModel:k}=yield{collectionBlockProperties:[],recordPointers:F.filter((e=>(0,u().T3)(e)))};for(const n of F)if((0,i().pq)(n)){const e=k(n);if(!(0,c().O9)(e))return!1;const t=n.propertyId,a=e.getSchema(),s=a[t];if(!s)continue;if((0,i().bT)(s)||(0,i().lb)(s)){if(!(yield*v({collectionPointer:n,collectionSchema:a,context:r,depth:o+1,propertyId:t,propertySchema:s,visitedPointers:d,hasAccessFn:m})))return!1}else if((0,i().nC)(s)&&!(yield*v({collectionPointer:n,collectionSchema:a,context:r,depth:o,propertyId:t,propertySchema:s,visitedPointers:d,hasAccessFn:m})))return!1}else if(!(0,c().O9)(k(n)))return!1;return!0}(e);let r=o.next();for(;!r.done;){const e=t.handleDataRequest(r.value);r=o.next(e)}return r.value}catch(o){return!0}}const g={hasAccessDefaultFn:T,hasAccessToProperty:k,hasAccessToFormula1Property:f,hasAccessToFormula2Property:m,hasAccessToRelationProperty:d,hasAccessToRollupProperty:h}}}]);