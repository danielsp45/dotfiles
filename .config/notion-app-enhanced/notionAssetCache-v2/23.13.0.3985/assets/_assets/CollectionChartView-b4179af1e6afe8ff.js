"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22],{67145:(e,t,o)=>{o.r(t),o.d(t,{DonutChart:()=>f});o(944114),o(898992),o(354520);var r=o(296540),i=()=>o(401497),a=()=>o(100594),n=()=>o(379632),l=()=>o(959013),s=()=>o(496603),u=()=>o(534177),c=()=>o(284371),d=()=>o(900983),g=()=>o(620586),p=()=>o(191446),h=()=>o(700461),m=()=>o(372976),y=o(474848);const v=14;function f(e){const t=(0,l().tz)(),o=(0,i().DP)(),f=e.chartHeight||a().bg.medium,k=e.seriesData.length>0&&e.seriesData[0].data.length>0,M=(0,r.useMemo)((()=>k?e.seriesData:[{name:"No data",data:[]}]),[k,e.seriesData]),T=(0,r.useMemo)((()=>(0,g().wW)(e.colorTheme||"auto",Boolean(e.weightColorValue),o)),[e.colorTheme,e.weightColorValue,o]),A=(0,r.useMemo)((()=>(0,a().sh)(f)),[f]),V=e.dataLabelsFormatter?.9:1,P=(A-160)*V,D=(0,r.useMemo)((()=>{const r=e.showCaption?(0,p().I)(e.caption):"";return s().h1((0,h().A)(o),{chart:{type:"pie",height:A,events:{render:function(){const r=this,i=r.container;if(i)if(k){if(e.title){var a;const e=r.title.getBBox();null===(a=r.title)||void 0===a||a.attr({y:v+r.plotTop+(r.plotHeight-e.height)/2})}}else(0,p().h)({intl:t,theme:o,chartType:"donut",container:i,hasData:k,hasBadYAxisRange:!1,isInPeekMode:Boolean(e.isInPeekMode)})},load:e.onLoadEventHandler}},time:{timezone:e.timezone},title:{useHTML:!0,floating:!0,text:void 0},series:M,...T,plotOptions:{pie:{size:P,innerSize:f===a().bg.small||f===a().bg.medium?"85%":"90%",showInLegend:!e.hideLegend,color:k?void 0:"transparent",fillColor:k?"transparent":o.tableDividerColor,states:{inactive:{opacity:1}},dataLabels:{enabled:!!e.dataLabelsFormatter,formatter:e.dataLabelsFormatter}},series:{cursor:e.onSeriesClick?"pointer":void 0,point:{events:{click:function(t){if(e.onSeriesClick){const o=(0,d().V)(e.seriesData,this.x);if(!o)return;e.onSeriesClick(o,t)}}}},marker:{enabled:!1},states:{hover:{halo:null}}}},legend:{enabled:!e.hideLegend,labelFormatter:function(){if(e.legendLabelFormatter){const t=this.index,o=M.length>0?M[0].data[t]:void 0;return e.legendLabelFormatter(this.name,o)}return this.name}},caption:{text:r},tooltip:{...e.tooltipOptions},responsive:{rules:x(P,f)}})}),[e,o,A,M,T,P,f,k,t]),L=(0,i().IS)((e=>({titleStyle:{fontWeight:500,color:e.text.primary,textAlign:"center"},subtitleStyle:{color:e.text.secondary,fontWeight:400,lineHeight:"15px",textAlign:"center",...c().RC}})),[]),_=(0,r.useCallback)(((t,o)=>{const r=o||f,i=function(e,t,o){const r=(e||"").split("").filter((e=>","!==e&&"."!==e)),i=5*r.length;if(t&&C(t,o)){const e=t/5-i;return o===a().bg.small||o===a().bg.medium?Math.max(e,S):Math.max(e,b)}if(o===a().bg.extra_large){const e=108-i;return Math.max(e,R)}if(o===a().bg.large){const e=84-i;return Math.max(e,w)}if(o===a().bg.medium){const e=72-i;return Math.max(e,b)}{const e=48-i;return Math.max(e,S)}}(e.title,t,r),l=function(e){if(!e||e===a().bg.small||e===a().bg.medium)return 12;if(e===a().bg.large)return 14;if(e===a().bg.extra_large)return 16;(0,u().HB)(e)}(r),s=function(e,t){if(e&&C(e,t))return.5*e;return t===a().bg.extra_large?400:t===a().bg.large?250:t===a().bg.medium?150:80}(t,r),c=t??200,d=c<50?"":n().A.renderToStaticMarkup((0,y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,y.jsx)("div",{style:{...L.titleStyle,fontSize:i,lineHeight:`${i+13}px`,maxWidth:s},children:e.title}),e.subtitle&&c>=200?(0,y.jsx)("div",{style:{...L.subtitleStyle,fontSize:l,lineHeight:`${l+3}px`,maxWidth:s},children:e.subtitle}):null]}));return{title:{useHTML:!0,floating:!0,text:k?d:""}}}),[f,e.title,e.subtitle,L.titleStyle,L.subtitleStyle,k]);return(0,y.jsx)(m().A,{loadingProps:e.loadingProps,chartOptions:D,containerHeight:A,getResponsiveChartOptions:_})}function x(e,t){const o=[];return t!==a().bg.extra_large&&t!==a().bg.large||o.push({condition:{maxWidth:e},chartOptions:{plotOptions:{pie:{size:void 0}}}}),o.push({condition:{maxWidth:(0,a().I9)(t)},chartOptions:{plotOptions:{pie:{size:"75%"}}}}),o}function C(e,t){return t===a().bg.extra_large?e-180<(0,a().I9)(t):t===a().bg.large?e-100<(0,a().I9)(t):e<(0,a().I9)(t)}const S=8,b=12,w=18,R=24},95441:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var r=o(474848);const i=function(e){const{title:t,href:i,analyticsFrom:a}=e,n=(0,o(484714).v3)();return(0,r.jsx)(o(187485).A,{href:i,onClick:()=>o(148024).FH(n,{from:a}),external:!0,children:(0,r.jsx)(o(497222).A,{icon:o(406533).questionMarkCircleIcon,title:t,isGray:!0})})}},668114:(e,t,o)=>{o.r(t),o.d(t,{CollectionChartView:()=>Le});var r=o(296540),i=()=>o(484714),a=()=>o(56366),n=()=>o(282339),l=()=>o(416504),s=()=>o(735695),u=()=>o(145214),c=()=>o(199896),d=()=>o(106412),g=()=>o(322638);var p=()=>o(247788),h=(o(944114),()=>o(901610)),m=()=>o(289915),y=()=>o(873050),v=()=>o(941814);var f=()=>o(525432),x=()=>o(489348),C=()=>o(765957),S=()=>o(227440),b=()=>o(714185),w=()=>o(514371),R=()=>o(264503),k=()=>o(622317),M=()=>o(100594),T=()=>o(534177),A=()=>o(75544),V=()=>o(818367),P=()=>o(496603),D=()=>o(62856),L=o(474848);var _=()=>o(708685),B=()=>o(921598),j=()=>o(713998),F=()=>o(959013),K=()=>o(2220),O=()=>o(812480),z=()=>o(476492),G=()=>o(401497),E=()=>o(133033),I=()=>o(285790),N=()=>o(859428),H=()=>o(962730);function $(e){let{message:t,tooltipMessage:o,tooltipAriaLabel:r}=e;const i=(0,G().IS)((e=>({container:{padding:"8px 4px 8px 14px",borderRadius:20,backgroundColor:e.tint.regular,width:"max-content",margin:"0 auto",marginBottom:20},text:{fontSize:12,textAlign:"center",color:e.text.secondary},iconStyle:{width:14,height:14,fill:e.text.secondary,position:"absolute",bottom:-2},iconContainer:{position:"relative",height:14,width:30}})),[]);return(0,L.jsx)("div",{style:i.container,children:(0,L.jsxs)("div",{style:i.text,children:[t,(0,L.jsx)(N().A,{renderTooltip:()=>o,placement:H().W.Top,render:e=>(0,L.jsx)(I().A,{icon:()=>(0,E().$)(i.iconStyle),ariaLabel:r,style:{...i.iconContainer},disableBackground:!0,...e})})]})})}const q=(0,F().YK)({earliestDates:{defaultMessage:"Only showing earliest {limit} {dateGroupByOption}",id:"charts.limitsWarning.earliestDates"},latestDates:{defaultMessage:"Only showing latest {limit} {dateGroupByOption}",id:"charts.limitsWarning.latestDates"},lowestNumbers:{defaultMessage:"Only showing lowest {limit} values",id:"charts.limitsWarning.lowestNumbers"},highestNumbers:{defaultMessage:"Only showing highest {limit} values",id:"charts.limitsWarning.highestNumbers"},genericLimit:{defaultMessage:"Only showing {limit} options in {propertyName}",id:"charts.limitsWarning.genericLimit"}}),W=(0,F().YK)({addFilters:{defaultMessage:"Add filters to reduce the data range.",id:"charts.limitsWarning.tooltip.addFilters"}}),Y=(0,F().YK)({column:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.columnChart"},bar:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.barChart"},line:{defaultMessage:"Max {limit} data points can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.lineChart"},donut:{defaultMessage:"Max {limit} slices can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.donutChart"},subGroups:{defaultMessage:"Max {limit} groups can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.subGroups"}});function X(e,t,o){const r=null==e?void 0:e.type;if((0,B().Ik)(t)&&"relative"===t.groupBy)return q.genericLimit;if("ascending"===o.type)switch(r){case"formula":switch((0,_().getFormulaPropertySchemaResultType)(e)){case"date":return q.earliestDates;case"number":return q.lowestNumbers;default:return q.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return q.earliestDates;case"number":return q.lowestNumbers;default:return q.genericLimit}else{if("descending"!==o.type)return q.genericLimit;switch(r){case"formula":switch((0,_().getFormulaPropertySchemaResultType)(e)){case"date":return q.latestDates;case"number":return q.highestNumbers;default:return q.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return q.latestDates;case"number":return q.highestNumbers;default:return q.genericLimit}}}function U(e){let{chartConfig:t,chartLimit:o,collectionContextStore:r}=e;const{limitType:i,limit:n}=o,l=(0,F().tz)(),s=(0,a().O$)(r.normalizedSchemaStore);if("results"===i&&"results_reducer"===t.dataConfig.type){const e=(0,j()._g)({schema:s,property:t.dataConfig.nameProperty});return e?(0,L.jsx)(F().sA,{...q.genericLimit,values:{limit:n,propertyName:e.name}}):null}if("groups"===i&&"groups_reducer"===t.dataConfig.type){const e=t.dataConfig.groupBy,o=(0,B().Kq)(e),r=(0,j()._g)({schema:s,property:e.property});if(!r)return null;const i=X(r,e,o);return(0,L.jsx)(F().sA,{...i,values:{limit:n,dateGroupByOption:(0,B().Ik)(e)?l.formatMessage(O().cS[e.groupBy]).toLocaleLowerCase():void 0,propertyName:r.name}})}if("subGroups"===i&&"groups_reducer"===t.dataConfig.type&&(0,h().m)(t)&&t.dataConfig.aggregationConfig.stackOptions){const e=t.dataConfig.aggregationConfig.stackOptions.groupBy,o=(0,B().Kq)(e),r=(0,j()._g)({schema:s,property:e.property});if(!r)return null;const i=X(r,e,o);return(0,L.jsx)(F().sA,{...i,values:{limit:n,dateGroupByOption:(0,B().Ik)(e)?e.groupBy:void 0,propertyName:r.name}})}return null}function J(e){let{chartConfig:t,chartReducerResults:o,loadingProps:n,collectionContextStore:l}=e;const s=(0,F().tz)(),u=function(e){let{chartConfig:t,chartReducerResults:o,collectionContextStore:n}=e;const l=(0,i().v3)(),s=(0,a().K8)((()=>(0,v().hk)()),[]),u=(0,a().K8)((()=>(0,v().dP)()),[]),c=(0,a().K8)((()=>(0,v().H4)()),[]),d=(0,a().K8)((()=>(0,z().sl)(n)),[n]),g=r.useMemo((()=>{let e;return"results_reducer"===t.dataConfig.type&&"results"===(null==o?void 0:o.type)&&o.blockIds.length>=u?e={limitType:"results",limit:u}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==o?void 0:o.type)&&o.results.length>=s?e={limitType:"groups",limit:s}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==o?void 0:o.type)&&o.subGroupResults&&o.subGroupResults.length>=c&&(e={limitType:"subGroups",limit:c}),e}),[t.dataConfig.type,o,s,u,c]);return r.useEffect((()=>{(0,K().u)({environment:l,event:{eventName:"charts_data_length",eventProperties:{chart_group_length:"groups"===(null==o?void 0:o.type)?o.results.length:void 0,chart_results_length:"results"===(null==o?void 0:o.type)?o.blockIds.length:void 0,chart_sub_group_length:"groups"===(null==o?void 0:o.type)&&o.subGroupResults?o.subGroupResults.length:void 0,chart_data_limit:g,...d}}})}),[g,o,d,l]),g}({chartConfig:t,chartReducerResults:o,collectionContextStore:l});if(void 0===u||n.isInitialLoading||n.isThrottledLoading)return null;const{limitType:c,limit:d}=u;return(0,L.jsx)($,{message:(0,L.jsx)(U,{chartConfig:t,collectionContextStore:l,chartLimit:u}),tooltipMessage:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{children:(0,L.jsx)(F().sA,{..."subGroups"===c?Y.subGroups:Y[t.type],values:{limit:d}})}),(0,L.jsx)("div",{children:(0,L.jsx)(F().sA,{...W.addFilters})})]}),tooltipAriaLabel:s.formatMessage("subGroups"===c?Y.subGroups:Y[t.type],{limit:d})})}o(898992),o(737550);var Q=()=>o(67657),Z=()=>o(381891),ee=()=>o(732038),te=()=>o(645873);const oe=new(te().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(6912),o.e(55717),o.e(95541),o.e(37160),o.e(22)]).then(o.bind(o,246732)))),re=(0,te()._h)(oe,(e=>e.AxisChart));var ie=()=>o(852353),ae=()=>o(622281),ne=()=>o(374136),le=(o(354520),o(581454),()=>o(202017)),se=()=>o(379632),ue=()=>o(381349),ce=()=>o(705876);const de=(0,F().YK)({noData:{defaultMessage:"No data",id:"database.chart.multipleSeriesTooltip.noData"},empty:{defaultMessage:"Empty",id:"database.chart.tooltip.empty"},clickToViewData:{defaultMessage:"Click to view data",id:"database.chart.tooltip.clickToViewData"},clickToViewDetails:{defaultMessage:"Click to view details",id:"database.chart.tooltip.clickToViewDetails"}}),ge=43;function pe(e){var t;const{chartConfig:o,schema:i,seriesData:n,isClickable:l}=e,s=(0,F().tz)(),u=(0,G().IS)((e=>({defaultContainer:{border:`1px solid ${e.palette.gray[100]}`,borderRadius:"8px",backgroundColor:e.cardContentBackground,maxHeight:"375px",maxWidth:"300px",width:"max-content",overflow:"hidden",pointerEvents:"auto",boxShadow:"0px 2px 4px rgb(0, 0, 0, 0.1)"},scrollContainer:{overflow:"auto",padding:"12px",maxHeight:l?375-ge+"px":"375px"},clickToSeeDataContainer:{padding:"12px",display:"flex",gap:"6px",alignItems:"center"},clickToSeeDataSeparator:{border:"none",borderTop:`1px solid ${e.stroke.secondary}`,margin:"0 12px"},clickToSeeDataIcon:{width:"14px",height:"14px",color:e.text.tertiary},clickToSeeDataText:{color:e.text.tertiary,fontSize:"12px",lineHeight:"16px"},containerSingleSeries:{padding:"10px 12px"},header:{fontSize:"12px",paddingBottom:"7px",color:e.text.primary,overflowX:"hidden",whiteSpace:"normal",display:"block"},row:{fontSize:"12px",lineHeight:"18px",textAlign:"left",display:"flex",justifyContent:"space-between",gap:"16px"},square:{height:"8px",width:"8px",minWidth:"8px",borderRadius:"1px",borderWidth:"0px",margin:"0 3px",verticalAlign:"top",display:"inline-block"},rowLeft:{display:"inline-block",color:e.text.secondary,overflowX:"hidden",whiteSpace:"normal"},rowLeftContainer:{display:"inline-flex",alignItems:"center",gap:"6px"},rowRight:{color:e.chartRowRightColor},noData:{color:e.text.secondary}})),[l]),c=(0,r.useMemo)((()=>s.formatMessage(de.noData)),[s]),d=(0,r.useMemo)((()=>({useHTML:!0,shadow:!1,borderWidth:0,backgroundColor:void 0,outside:!1,stickOnContact:!0,hideDelay:100})),[]),g=(0,a().K8)((()=>"donut"===(null==o?void 0:o.type)),[null==o?void 0:o.type]),p=(0,a().K8)((()=>"results_reducer"===(null==o?void 0:o.dataConfig.type)?s.formatMessage(de.clickToViewDetails):s.formatMessage(de.clickToViewData)),[null==o?void 0:o.dataConfig.type,s]),m=(0,a().K8)((()=>{var e;return("bar"===(null==o?void 0:o.type)||"column"===(null==o?void 0:o.type))&&("groups_reducer"===o.dataConfig.type&&(!!o.dataConfig.aggregationConfig.stackOptions&&"percent"===(null===(e=o.chartFormat)||void 0===e?void 0:e.axisGroupStyle)))}),[o]),y=(0,a().K8)((()=>{var e,t;if("precision_from_number_property"===(null==o||null===(e=o.chartFormat)||void 0===e?void 0:e.numberPrecisionOverride)){const e=null==o?void 0:o.dataConfig;if(!e||"results_reducer"!==e.type)return;const t=(0,j()._g)({schema:i,property:e.valueProperty});return t?(0,ne().i5)(t):void 0}return null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.numberPrecisionOverride}),[null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.numberPrecisionOverride,null==o?void 0:o.dataConfig,i]),v=(0,r.useMemo)((()=>({...d,formatter:function(){const e=this.color??this.series.color;ce().U.setCurrentTooltipPoint(this.point);const{label:t,value:r}=(0,ne().NH)({chartConfig:o,schema:i,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:s,numberPrecisionOverride:y});let a="";g&&this.point.percentage&&(a=` (${(0,ne().l9)(this.point.percentage)}%)`);const n=""===t?s.formatMessage(de.empty):t;return se().A.renderToStaticMarkup((0,L.jsxs)("div",{style:u.defaultContainer,children:[(0,L.jsx)("div",{style:u.containerSingleSeries,children:(0,L.jsxs)("div",{style:u.row,children:[(0,L.jsxs)("div",{style:u.rowLeftContainer,children:[(0,L.jsx)("div",{style:{...u.square,backgroundColor:me(e)}}),(0,L.jsx)("div",{style:u.rowLeft,children:n})]}),(0,L.jsxs)("div",{style:u.rowRight,children:[r,a]})]})}),l?(0,L.jsx)(he,{label:p,styles:u}):null]}))}})),[d,o,i,s,y,g,u,l,p]),f=(0,r.useMemo)((()=>({...d,shared:!0,formatter:function(){var e;const t=null===(e=this.points)||void 0===e?void 0:e.filter((e=>!(null==e||!e.y)&&0!==e.y));ce().U.setCurrentTooltipPoint(this.point);("line"===this.series.type||"area"===this.series.type||"areaspline"===this.series.type)&&(null==t||t.sort(((e,t)=>((null==t?void 0:t.y)??0)-((null==e?void 0:e.y)??0))));let r=this.point.name;if(o&&(0,h().m)(o)&&"groups_reducer"===o.dataConfig.type){const e=o.dataConfig,t=e.groupBy,a=(0,j()._g)({schema:i,property:e.groupBy.property});a&&(r=(0,ne().w$)({propertySchema:a,groupByFormat:t,aggregation:o.dataConfig.aggregationConfig.aggregation,highChartsLabel:this.point.name,intl:s}))}return t&&0!==t.length?se().A.renderToStaticMarkup((0,L.jsxs)("div",{style:u.defaultContainer,children:[(0,L.jsxs)("div",{style:u.scrollContainer,children:[(0,L.jsx)("div",{style:u.header,children:r}),t.map((e=>{const t=e.color??e.series.color,{label:r,value:a}=(0,ne().NH)({chartConfig:o,schema:i,highChartsLabel:e.series.name,highChartsValue:e.y??void 0,isMultiSeries:!0,intl:s,numberPrecisionOverride:y});let n="";m&&e.percentage&&(n=` (${(0,ne().l9)(e.percentage)}%)`);const l=""===r?s.formatMessage(de.empty):r;return(0,L.jsxs)("div",{style:u.row,children:[(0,L.jsxs)("div",{style:u.rowLeftContainer,children:[(0,L.jsx)("div",{style:{...u.square,backgroundColor:me(t)}}),(0,L.jsx)("div",{style:u.rowLeft,children:l})]}),(0,L.jsxs)("span",{style:u.rowRight,children:[a,n]})]},e.key)}))]}),l?(0,L.jsx)(he,{label:p,styles:u}):null]})):se().A.renderToStaticMarkup((0,L.jsxs)("div",{style:u.defaultContainer,children:[(0,L.jsxs)("div",{style:u.scrollContainer,children:[(0,L.jsx)("div",{style:u.header,children:r}),(0,L.jsx)("div",{style:{...u.row,...u.noData},children:c})]}),l?(0,L.jsx)(he,{label:p,styles:u}):null]}))}})),[d,o,u,i,s,c,y,m,l,p]);return n?1===n.length?v:f:d}function he(e){const{label:t,styles:o}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("hr",{style:o.clickToSeeDataSeparator}),(0,L.jsxs)("div",{style:o.clickToSeeDataContainer,children:[(0,le().n)(o.clickToSeeDataIcon),(0,L.jsx)("div",{style:o.clickToSeeDataText,children:t})]})]})}function me(e){const t=ue().OK.colorful[0];return e?"string"==typeof e?e:"pattern"in e?e.pattern.backgroundColor??t:t:t}var ye=()=>o(10594);function ve(e){let{collectionContextStore:t,groupedChartReducerResults:o,groupedDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const d=(0,i().v3)(),p=(0,F().tz)(),m=(0,G().DP)(),y=(0,r.useRef)(!0),{chartConfig:f,chartErrorStore:x,collectionViewStore:C,collectionViewBlockStore:S,databaseType:b,isMultiSourceView:w}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&(0,h().m)(o)&&"groups_reducer"===o.dataConfig.type?o:void 0,chartErrorStore:t.chartErrorStore,collectionViewStore:e,collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,isMultiSourceView:t.isMultiSourceView}}),[t]),R=(0,a().O$)(t.normalizedSchemaStore),k=(0,a().O$)(t.normalizedFormatStore),T=(0,a().O$)(t.normalizedQueryStore),A=(0,a().O$)(t.temporaryStateStore),V=(0,a().K8)((()=>(0,j()._g)({schema:R,property:n.groupBy.property})),[n.groupBy.property,R]),P=(0,a().K8)((()=>{if(n.aggregationConfig.aggregation.property)return(0,j()._g)({schema:R,property:n.aggregationConfig.aggregation.property})}),[n.aggregationConfig.aggregation,R]),D=(0,a().K8)((()=>null==l?void 0:l.mainSort),[null==l?void 0:l.mainSort]),_=(0,a().K8)((()=>null==l?void 0:l.axisAvatar),[null==l?void 0:l.axisAvatar]),K=(0,a().K8)((()=>{if("side_by_side"===(null==l?void 0:l.axisGroupStyle))return;if(n.aggregationConfig.stackOptions){if(null!=l&&l.axisGroupStyle)return l.axisGroupStyle;if("line"!==(null==f?void 0:f.type))return M().PC.normal}}),[null==f?void 0:f.type,null==l?void 0:l.axisGroupStyle,n.aggregationConfig]),O=(0,a().K8)((()=>V?V.name||ie().dC[V.type]:""),[V]),z=(0,a().K8)((()=>{const e=n.aggregationConfig;if((0,Q().Iq)(e.aggregation)){return(0,g().TQ)({aggregation:e.aggregation,databaseType:b,intl:p})||""}const t=(0,g().TQ)({aggregation:e.aggregation,databaseType:b,intl:p});return P?`${P.name||ie().dC[P.type]} (${t})`:""}),[n.aggregationConfig,b,p,P]),E=(0,a().K8)((()=>(0,M().q_)(f)),[f]),I=!!f&&(0,ae().hu)(f),N=(null==l?void 0:l.hideLegend)||I,H=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),$=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),q=(0,a().K8)((()=>(0,v().hk)()),[]),W=(0,a().K8)((()=>(0,v().H4)()),[]),Y=(0,a().K8)((()=>{if(o&&f)return(0,ae().CL)({groupedChartReducerResults:o,chartConfig:f,sortType:"main"})}),[o,f]),X=(0,a().K8)((()=>{if(!(o&&t&&S&&Y))return;const{result:e,xAxisType:r}=function(e){var t;let{collectionContextStore:o,groupedDataConfig:r,groupedChartReducerResults:i,chartFormat:a,timezone:n,theme:l,environment:s,intl:u,getRecordModel:c,getRecordRole:d,renderGroupsFromAggregationArgs:g,groupsLimit:p,subGroupsLimit:h,databaseType:m,schema:y,collectionViewFormat:v}=e;const f=i.aggregationResults;if(!f)return;const x=(0,ae().AY)({groupedDataConfig:r,hideEmptyGroups:Boolean(null==a?void 0:a.axisHideEmptyGroups),mainSort:null==a?void 0:a.mainSort});if("v2"===(null==i?void 0:i.version)){var C;const e=i.results.filter((e=>e.visible)).map((e=>({property:r.groupBy.property,value:e.value}))),t=r.aggregationConfig.stackOptions,a=t?null===(C=i.subGroupResults)||void 0===C?void 0:C.filter((e=>e.visible)).map((e=>({property:t.groupBy.property,value:e.value}))):[];return{result:(0,ae().Tm)({collectionContextStore:o,groupedDataConfig:r,groupResults:e,subGroupResults:a,aggregationResults:f,xAxisType:x,timezone:n,environment:s,intl:u,theme:l,groupTotals:g.groupTotals}),xAxisType:x}}const S=(0,B().oH)({schema:y,groupBy:r.groupBy});let b=(0,ye().ck)({groupBy:r.groupBy,schema:y,formatGroups:v[B().V1]||[],schemaGroups:S,reducerResults:i.results,getRecordModel:c,getRecordRole:d,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:o.collectionStoresStore.state,renderGroupsFromAggregationArgs:g});b=b.filter((e=>!(0,B().tx)(e))),b=b.slice(0,p);const w=r.aggregationConfig.stackOptions?(0,B().oH)({schema:y,groupBy:r.aggregationConfig.stackOptions.groupBy}):void 0,R=i.subGroupResults&&null!==(t=r.aggregationConfig.stackOptions)&&void 0!==t&&t.groupBy?(0,ye().ck)({groupBy:r.aggregationConfig.stackOptions.groupBy,schema:y,formatGroups:v.chart_subgroups||[],schemaGroups:w,reducerResults:i.subGroupResults,getRecordModel:c,getRecordRole:d,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:o.collectionStoresStore.state}).filter((e=>!(0,B().tx)(e))).slice(0,h):void 0;return{result:(0,ae().Tm)({collectionContextStore:o,groupedDataConfig:r,groupResults:b,subGroupResults:R,aggregationResults:f,xAxisType:x,timezone:n,environment:s,intl:u,theme:l,groupTotals:g.groupTotals}),xAxisType:x}}({collectionContextStore:t,groupedDataConfig:n,groupedChartReducerResults:o,chartFormat:l,timezone:s,theme:m,environment:d,intl:p,getRecordModel:S.getRecordModel,getRecordRole:S.getRecordRole,renderGroupsFromAggregationArgs:Y,groupsLimit:q,subGroupsLimit:W,databaseType:b,schema:R,collectionViewFormat:k})||{};if(!r)return;var i;y.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),y.current=!1);const a=o.results.some((e=>(0,Z().bv)(e)?e.visible:e.total>0));return{seriesData:null==e?void 0:e.seriesData,maxValue:(null==e?void 0:e.maxValue)??0,minValue:(null==e?void 0:e.minValue)??0,dataPointsForXAxisLabels:null==e?void 0:e.dataPointsForXAxisLabels,xAxisType:r,reverseXAxis:(0,ae().p4)({xAxisType:r,mainSort:D}),hasData:a}}),[o,q,W,t,S,n,R,k,b,D,l,s,d,p,m,Y],{useDeepEqual:!0}),U=(0,ne().gc)(null==C?void 0:C.getRecordModel,p,_===M().GL.avatar_name),J=(0,r.useMemo)((()=>V&&(0,M().fn)(V)&&(void 0===_||_===M().GL.avatar||_===M().GL.avatar_name)),[_,V]),te=(()=>{if(!V)return;if(J)return U;if((0,M().JW)(V))return(0,ne().ck)({propertySchema:V,aggregation:n.aggregationConfig.aggregation,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride});const e="formula"===n.groupBy.type?n.groupBy.groupBy:n.groupBy;return(0,B().Ik)(e)&&(0,M().i8)(V)?(0,ne().jY)({groupBy:e.groupBy,dateFormat:V.date_format,intl:p}):void 0})(),oe=(()=>{if(P)return(0,M().JW)(P)?(0,ne().ck)({propertySchema:P,aggregation:n.aggregationConfig.aggregation,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0})(),le=(e=>{const t=null===(e=n.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy;if(N||!t)return;const o="formula"===t.type?t.groupBy:t,r=t.property,i=(0,j()._g)({schema:R,property:r});return i&&(0,B().Ik)(o)&&(0,M().i8)(i)?e=>(0,ne().H$)({dateString:e,dateFormat:i.date_format,groupBy:o.groupBy,intl:p}):void 0})(),se=(0,r.useCallback)(((e,o)=>{ee().Sp({chartConfig:f,collectionViewBlockStore:S,format:k,dataPoint:e,clickEvent:o,schema:R,intl:p,query2:T,temporaryViewState:A,environment:d,collectionContextStore:t})}),[f,S,k,R,A,T,p,d,t]),ue=w?void 0:se,ce=pe({chartConfig:f,schema:R,seriesData:null==X?void 0:X.seriesData,isClickable:Boolean(ue)}),de=(0,a().K8)((()=>!(!P||!X)&&(0,ne()._G)({dataYAxisMax:X.maxValue,dataYAxisMin:X.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:P,aggregation:n.aggregationConfig.aggregation})),[X,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,n.aggregationConfig.aggregation,P]),ge=(0,a().O$)(t.isInPeekRendererStore);r.useEffect((()=>{var e;if(!C)return;const t=null==o?void 0:o.subGroupResults;if(Boolean(f&&(0,h().m)(f)&&"groups_reducer"===f.dataConfig.type&&(null===(e=f.dataConfig.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy))&&t){if(1===t.length&&!t[0].value.value){const e=new Map(x.state);return e.set(C.id,"stackBy_property_no_values"),void x.setState(e)}}const r=new Map(x.state);r.delete(C.id),x.setState(r)}),[f,C,null==o?void 0:o.subGroupResults,x]);const he=(0,r.useCallback)((()=>{t.onItemMount()}),[t]);return(0,L.jsx)(re,{axisType:c,timezone:s,seriesData:(null==X?void 0:X.seriesData)||[],hasData:Boolean(null==X?void 0:X.hasData),loadingProps:u,xAxisType:null==X?void 0:X.xAxisType,xAxisTitle:O,yAxisTitle:z,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:N,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:H,showVerticalGridLines:$,dataLabelsEnabled:E,columnStacking:K,axisHideEmptyGroups:null==l?void 0:l.axisHideEmptyGroups,tooltipOptions:ce,sortReversed:null==X?void 0:X.reverseXAxis,dataPointsForXAxisLabels:null==X?void 0:X.dataPointsForXAxisLabels,xLabelFormatter:te,disableXAxisAutoRotation:J,yLabelFormatter:oe,dataLabelFormatter:oe,stackLabelFormatter:oe,legendLabelFormatter:le,yAxisAllowDecimals:de,dataYAxisMax:null==X?void 0:X.maxValue,dataYAxisMin:null==X?void 0:X.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:he,isInPeekMode:ge,onSeriesClick:ue})}const fe=new(te().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(6912),o.e(55717),o.e(95541),o.e(37160),o.e(22)]).then(o.bind(o,67145)))),xe=(0,te()._h)(fe,(e=>e.DonutChart));var Ce=()=>o(284371);function Se(e,t){const o=(0,F().tz)(),r=(0,G().IS)((e=>({name:{maxWidth:"250px",...Ce().RC,display:"inline-block",verticalAlign:"middle"},value:{display:"inline-block",verticalAlign:"middle",marginLeft:5}})),[]),i=(0,a().K8)((()=>null==e?void 0:e.chartFormat),[e]);if((null==i?void 0:i.donutDataLabels)!==M().D0.none)return function(){const{label:a,value:n}=(0,ne().NH)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:o,numberPrecisionOverride:void 0});let l="";return this.point.percentage&&(l=` (${(0,ne().l9)(this.point.percentage)}%)`),(null==i?void 0:i.donutDataLabels)===M().D0.value?`${n}${l}`:(null==i?void 0:i.donutDataLabels)===M().D0.name?se().A.renderToStaticMarkup((0,L.jsx)("div",{style:r.name,children:a})):(null==i?void 0:i.donutDataLabels)===M().D0.name_and_value?se().A.renderToStaticMarkup((0,L.jsxs)("div",{children:[(0,L.jsx)("div",{style:r.name,children:a}),(0,L.jsx)("div",{style:r.value,children:`${n}${l}`})]})):void 0}}var be=()=>o(72135),we=()=>o(972435);const Re=(0,F().YK)({total:{id:"charts.donut.aggregationValue.total",defaultMessage:"Total"},totalPropertyName:{id:"charts.donut.aggregationValue.totalPropertyName",defaultMessage:"Total {propertyName}"},averagePropertyName:{id:"charts.donut.aggregationValue.averagePropertyName",defaultMessage:"Average {propertyName}"},minPropertyName:{id:"charts.donut.aggregationValue.minPropertyName",defaultMessage:"Min {propertyName}"},maxPropertyName:{id:"charts.donut.aggregationValue.maxPropertyName",defaultMessage:"Max {propertyName}"},medianPropertyName:{id:"charts.donut.aggregationValue.medianPropertyName",defaultMessage:"Median {propertyName}"},uniquePropertyName:{id:"charts.donut.aggregationValue.uniquePropertyName",defaultMessage:"Distinct {propertyName}"}});function ke(e,t,o,i){const a=(0,F().tz)();return(0,r.useMemo)((()=>{if(!e||!o)return;const r=e.aggregationResult,n=(0,j()._g)({schema:i,property:o});if(!r||"number"!==r.type||!n)return;let l;const s=r.value?(0,ne().EN)(r.value,2):void 0;if((0,M().JW)(n)&&"count"!==t&&"unique"!==t){const e=(0,ne().JI)(n)??"number";l=(0,be().ZV)(s,e,a,"compact")}else l=(0,be().ZV)(s,"number",a,"compact");let u;const c=n.name;switch(t){case"sum":u=we().A.formatMessage(Re.totalPropertyName,{propertyName:c});break;case"average":u=we().A.formatMessage(Re.averagePropertyName,{propertyName:c});break;case"min":u=we().A.formatMessage(Re.minPropertyName,{propertyName:c});break;case"max":u=we().A.formatMessage(Re.maxPropertyName,{propertyName:c});break;case"median":u=we().A.formatMessage(Re.medianPropertyName,{propertyName:c});break;case"unique":u=we().A.formatMessage(Re.uniquePropertyName,{propertyName:c});break;default:u=we().A.formatMessage(Re.total)}return{title:l,subtitle:u}}),[e,t,a,o,i])}function Me(e){let{collectionContextStore:t,groupedChartReducerResults:o,aggregationChartReducerResults:n,groupedDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().v3)(),g=(0,F().tz)(),p=(0,G().DP)(),h=(0,r.useRef)(!0),{collectionViewBlockStore:m,databaseType:y,chartConfig:f,isMultiSourceView:x}=(0,a().K8)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();return{collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,chartConfig:o&&"donut"===o.type&&"groups_reducer"===o.dataConfig.type?o:void 0,isMultiSourceView:t.isMultiSourceView}}),[t]),C=(0,a().O$)(t.normalizedSchemaStore),S=(0,a().O$)(t.normalizedQueryStore),b=(0,a().K8)((()=>(0,B().oH)({schema:C,groupBy:l.groupBy})),[l,C]),w=(0,a().O$)(t.normalizedFormatStore),R=(0,a().O$)(t.temporaryStateStore),k=(0,a().K8)(v().hk,[]),T=(0,a().K8)((()=>{if(o&&f)return(0,ae().CL)({groupedChartReducerResults:o,chartConfig:f,sortType:"main"})}),[o,f]),A=(0,a().K8)((()=>{const e=null==o?void 0:o.aggregationResults;if(!m||!T||!e)return;if("v2"===(null==o?void 0:o.version)){const i=o.results.filter((e=>e.visible)).map((e=>({property:l.groupBy.property,value:e.value}))),a=(0,ae().cN)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:g,theme:p,groupTotals:T.groupTotals});var r;if(h.current)null===(r=t.databaseItemsVisibleTracker)||void 0===r||r.handleItemsRenderStart(),h.current=!1;return a}let i=(0,ye().ck)({groupBy:l.groupBy,schema:C,formatGroups:w[B().V1]||[],schemaGroups:b,reducerResults:o.results,getRecordModel:m.getRecordModel,getRecordRole:m.getRecordRole,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:y,allowedCollectionStores:t.collectionStoresStore.state,renderGroupsFromAggregationArgs:T});i=i.filter((e=>!(0,B().tx)(e))),i=i.slice(0,k);const a=(0,ae().cN)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:g,theme:p,groupTotals:T.groupTotals});var n;h.current&&(null===(n=t.databaseItemsVisibleTracker)||void 0===n||n.handleItemsRenderStart(),h.current=!1);return a}),[o,l,u,d,g,t,p,m,y,C,b,k,w,T],{useDeepEqual:!0}),V=(0,a().K8)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),P=(0,a().K8)((()=>"count"===l.aggregationConfig.aggregation.aggregator?l.groupBy.property:l.aggregationConfig.aggregation.property),[l]),D=ke(n,l.aggregationConfig.aggregation.aggregator,P,C),_=(0,a().K8)((()=>null==s?void 0:s.valueLabel),[null==s?void 0:s.valueLabel])||(null==D?void 0:D.subtitle),K=(()=>{const e="formula"===l.groupBy.type?l.groupBy.groupBy:l.groupBy,t=(0,j()._g)({schema:C,property:l.groupBy.property});if(t)return(0,B().Ik)(e)&&(0,M().i8)(t)?o=>(0,ne().H$)({dateString:o.toString(),dateFormat:t.date_format,groupBy:e.groupBy,intl:g}):void 0})(),O=Se(f,C),z=(0,r.useCallback)(((e,o)=>{ee().Sp({chartConfig:f,collectionViewBlockStore:m,format:w,dataPoint:e,clickEvent:o,schema:C,intl:g,query2:S,temporaryViewState:R,environment:d,collectionContextStore:t})}),[f,m,w,C,R,S,g,d,t]),E=x?void 0:z,I=pe({chartConfig:f,schema:C,seriesData:A,isClickable:Boolean(E)}),N=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),H=(0,a().O$)(t.isInPeekRendererStore);return(0,L.jsx)(xe,{timezone:u,seriesData:A||[],title:V?null==D?void 0:D.title:void 0,subtitle:V?_:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:I,legendLabelFormatter:K,onLoadEventHandler:N,dataLabelsFormatter:O,isInPeekMode:H,onSeriesClick:E})}function Te(e){let{collectionContextStore:t,resultsChartReducerResults:o,resultsDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const d=(0,i().v3)(),g=(0,F().tz)(),p=(0,G().DP)(),m=(0,r.useRef)(!0),{chartConfig:y,collectionViewBlockStore:v,collectionViewStore:f,collectionStore:x,isMultiSourceView:C}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&(0,h().m)(o)&&"results_reducer"===o.dataConfig.type?o:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:e,collectionStore:t.collectionStore(),isMultiSourceView:t.isMultiSourceView}}),[t]),S=(0,a().O$)(t.normalizedSchemaStore),b=null==l?void 0:l.mainSort,w=(0,a().K8)((()=>{const e=n.nameProperty,t=S[e];return t?t.name||ie().dC[t.type]:""}),[n.nameProperty,S]),R=(0,a().K8)((()=>{const e=S[n.valueProperty];return e?`${e.name||ie().dC[e.type]}`:""}),[n,S]),k=!!y&&(0,ae().hu)(y),T=(null==l?void 0:l.hideLegend)||k,A=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),V=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),P=(0,a().K8)((()=>{if(!n||!t||!v)return;const e="category",r=(0,ae().UX)({collectionContextStore:t,resultsDataConfig:n,resultsChartReducerResults:o,chartType:"axis",xAxisType:e,timezone:s,environment:d,intl:g,theme:p});var i;m.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),m.current=!1);const a=o&&o.blockIds.length>0;return{seriesData:null==r?void 0:r.seriesData,maxValue:(null==r?void 0:r.maxValue)??0,minValue:(null==r?void 0:r.minValue)??0,xAxisType:e,reverseXAxis:(0,ae().p4)({xAxisType:e,mainSort:b}),hasData:a}}),[n,t,v,o,s,d,g,p,b],{useDeepEqual:!0}),D=(0,a().K8)((()=>(0,M().q_)(y)),[y]),_=(0,a().K8)((()=>(0,j()._g)({schema:S,property:n.nameProperty})),[n.nameProperty,S]),B=(0,a().K8)((()=>(0,j()._g)({schema:S,property:n.valueProperty})),[n.valueProperty,S]),K=(0,ne().wK)(null==f?void 0:f.getRecordModel,g,s),O=(()=>{if(_)return"title"===_.type?K:void 0})(),z=B?(0,ne().ck)({propertySchema:B,aggregation:void 0,intl:g,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0,E=(0,a().K8)((()=>!(!B||!P)&&(0,ne()._G)({dataYAxisMax:P.maxValue,dataYAxisMin:P.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:B,aggregation:void 0})),[P,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,B]),I=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),N=(0,r.useCallback)(((e,o)=>{ee().sw({collectionStore:x,dataPoint:e,environment:d,clickEvent:o,collectionContextStore:t})}),[x,d,t]),H=C?void 0:N,$=pe({chartConfig:y,schema:S,seriesData:null==P?void 0:P.seriesData,isClickable:Boolean(H)}),q=(0,a().O$)(t.isInPeekRendererStore);return(0,L.jsx)(re,{axisType:c,timezone:s,seriesData:(null==P?void 0:P.seriesData)||[],hasData:Boolean(null==P?void 0:P.hasData),loadingProps:u,xAxisType:null==P?void 0:P.xAxisType,xAxisTitle:w,yAxisTitle:R,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:T,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:A,showVerticalGridLines:V,dataLabelsEnabled:D,columnStacking:void 0,tooltipOptions:$,sortReversed:null==P?void 0:P.reverseXAxis,xLabelFormatter:O,dataLabelFormatter:z,yLabelFormatter:z,yAxisAllowDecimals:E,dataYAxisMax:null==P?void 0:P.maxValue,dataYAxisMin:null==P?void 0:P.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:I,isInPeekMode:q,onSeriesClick:H})}function Ae(e){let{collectionContextStore:t,resultsChartReducerResults:o,aggregationChartReducerResults:n,resultsDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().v3)(),g=(0,F().tz)(),p=(0,G().DP)(),h=(0,r.useRef)(!0),{chartConfig:m,collectionViewBlockStore:y,collectionViewStore:v,collectionStore:f,isMultiSourceView:x}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&"donut"===o.type&&"results_reducer"===o.dataConfig.type?o:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:t.collectionViewStore(),collectionStore:t.collectionStore(),isMultiSourceView:t.isMultiSourceView}}),[t]),C=(0,a().O$)(t.normalizedSchemaStore),S=(0,a().K8)((()=>{var e;if(!o||!y)return;const r=(0,ae().UX)({collectionContextStore:t,resultsDataConfig:l,resultsChartReducerResults:o,chartType:"donut",xAxisType:void 0,timezone:u,environment:d,intl:g,theme:p});var i;h.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),h.current=!1);const a=null==r||null===(e=r.seriesData)||void 0===e?void 0:e[0];return[{...a,data:(null==a?void 0:a.data)||[],type:"pie"}]}),[o,y,t,l,u,d,g,p],{useDeepEqual:!0}),b=(0,a().K8)((()=>{if(l.valueProperty)return l.valueProperty}),[l]),w=(0,a().K8)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),R=ke(n,"sum",b,C),k=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),M=(0,ne().wK)(null==v?void 0:v.getRecordModel,g,u),T=(()=>{if("title"===l.nameProperty)return M})(),A=Se(m,C),V=(0,r.useCallback)(((e,o)=>{ee().sw({collectionStore:f,dataPoint:e,clickEvent:o,environment:d,collectionContextStore:t})}),[f,d,t]),P=x?void 0:V,D=pe({chartConfig:m,schema:C,seriesData:S,isClickable:Boolean(P)}),_=(0,a().O$)(t.isInPeekRendererStore);return(0,L.jsx)(xe,{timezone:u,seriesData:S||[],title:w?null==R?void 0:R.title:void 0,subtitle:w?null==R?void 0:R.subtitle:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:D,legendLabelFormatter:T,onLoadEventHandler:k,dataLabelsFormatter:A,isInPeekMode:_,onSeriesClick:P})}function Ve(e){var t;let{collectionContextStore:o,chartConfig:i,timezone:n,reducerRequestType:l,groupedChartReducer:s,aggregationChartReducer:u,resultsChartReducer:c}=e;const{reducer:d,reducerKey:g}=(0,a().K8)((()=>"groups"===l?{reducer:s,reducerKey:k().jJ}:"results"===l?{reducer:c,reducerKey:k().wh}:void(0,T().HB)(l)),[s,l,c]),p=(0,a().K8)((()=>(0,V().x)()),[]),m=(0,A().A)({id:g,reducer:d,collectionContextStore:o,debounceWait:p}),y=(0,a().O$)(o.isFullScreenStore),v=(0,r.useMemo)((()=>{var e;const t=(null==i||null===(e=i.chartFormat)||void 0===e?void 0:e.height)||M().bg.medium;return(0,M().sh)(t)}),[null==i||null===(t=i.chartFormat)||void 0===t?void 0:t.height]),f=(0,a().K8)((()=>{var e;if(void 0!==m)return;const t=o.remoteErrorStore.state;return"msg"!==(null==t?void 0:t.requestSrc)?"RequestTimeoutCancellationError"===(null==t||null===(e=t.errorBody)||void 0===e?void 0:e.name)?"queryCollection_timeout":t?"queryCollection_generic":void 0:void 0}),[o,m]),{loadingProps:x,chartConfigToDisplay:C}=function(e){let{collectionContextStore:t,chartConfig:o,chartReducerResults:i}=e;const n=(0,r.useRef)(void 0),l=(0,r.useRef)(void 0),[s,u]=(0,r.useState)(void 0),c=(0,a().K8)((()=>t.shouldShowSpinnerStore.state),[t],{useDeepEqual:!0}),d=(0,a().K8)((()=>{var e;return void 0===i||Boolean(t.lastRemoteRequestStore.state&&t.remoteRequestStore.state&&!P().n4(null===(e=t.lastRemoteRequestStore.state.remoteRequest)||void 0===e?void 0:e.source,t.remoteRequestStore.state.source))}),[i,t]),g=(0,a().O$)(t.isFullScreenStore);(0,r.useEffect)((()=>{n.current=o,(t.isClientModeEnabledStore.state||t.isViewSpecificClientModeEnabledStore.state)&&u(o)}),[o,t]),(0,r.useEffect)((()=>{c||(l.current=n.current)}),[c]),(0,r.useEffect)((()=>{l.current=n.current,u(n.current)}),[null==o?void 0:o.type]);const{nameProperty:p,valueProperty:h}=(0,a().K8)((()=>"results_reducer"===(null==o?void 0:o.dataConfig.type)?{nameProperty:o.dataConfig.nameProperty,valueProperty:o.dataConfig.valueProperty}:{}),[null==o?void 0:o.dataConfig]);return(0,r.useEffect)((()=>{l.current=n.current,u(n.current)}),[p,h]),(0,r.useEffect)((()=>{u(c?l.current:n.current)}),[c]),{loadingProps:{isInitialLoading:d,isThrottledLoading:(0,D().A)(c,200,0),initialLoadingSvg:(0,r.useCallback)((()=>(0,L.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:g})),[null==o?void 0:o.type,g])},chartConfigToDisplay:s}}({collectionContextStore:o,chartConfig:i,chartReducerResults:m});if(f)return(0,L.jsx)(w().A,{chartError:f,collectionSettingsStore:o.settingsStore,chartType:null==i?void 0:i.type});if(C){if(i&&(0,h().m)(i)&&C&&(0,h().m)(C))return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(J,{loadingProps:x,chartConfig:C,chartReducerResults:m,collectionContextStore:o}),(0,L.jsx)(Pe,{collectionContextStore:o,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:m,loadingProps:x,timezone:n,chartHeight:v,isFullScreen:y})]});if("donut"===(null==i?void 0:i.type)&&C&&"donut"===C.type)return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(J,{loadingProps:x,chartConfig:C,chartReducerResults:m,collectionContextStore:o}),(0,L.jsx)(De,{collectionContextStore:o,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:m,timezone:n,loadingProps:x,aggregationChartReducer:u,chartHeight:v,isFullScreen:y})]})}return(0,L.jsx)("div",{style:{height:v,width:"100%"},children:(0,L.jsx)(R().z,{chartType:null==i?void 0:i.type,showCopy:y})})}function Pe(e){let{collectionContextStore:t,chartConfig:o,chartConfigToDisplay:r,chartReducerResults:i,timezone:a,loadingProps:n,chartHeight:l,isFullScreen:s}=e;if(o&&(0,h().m)(o)&&r&&(0,h().m)(r)){if("groups_reducer"===r.dataConfig.type&&(void 0===i||"groups"===(null==i?void 0:i.type)))return(0,L.jsx)(ve,{loadingProps:n,timezone:a,groupedDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,axisType:o.type});if("results_reducer"===r.dataConfig.type&&(void 0===i||"results"===(null==i?void 0:i.type)))return(0,L.jsx)(Te,{loadingProps:n,timezone:a,resultsDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,axisType:o.type})}return(0,L.jsx)("div",{style:{height:l,width:"100%"},children:(0,L.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:s})})}function De(e){let{collectionContextStore:t,chartConfig:o,chartConfigToDisplay:r,chartReducerResults:i,timezone:n,loadingProps:l,aggregationChartReducer:s,chartHeight:u,isFullScreen:c}=e;const d=(0,a().K8)((()=>(0,V().x)()),[]),g=(0,A().A)({id:k().nb,reducer:s,collectionContextStore:t,debounceWait:d});return"groups_reducer"!==r.dataConfig.type||void 0!==i&&"groups"!==(null==i?void 0:i.type)?"results_reducer"!==r.dataConfig.type||void 0!==i&&"results"!==(null==i?void 0:i.type)?(0,L.jsx)("div",{style:{height:u,width:"100%"},children:(0,L.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:c})}):(0,L.jsx)(Ae,{loadingProps:l,timezone:n,resultsDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,aggregationChartReducerResults:g}):(0,L.jsx)(Me,{loadingProps:l,timezone:n,groupedDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,aggregationChartReducerResults:g})}function Le(e){const{collectionContextStore:t,isPreviewing:o,paddingLeft:r,paddingRight:k,headingWidth:M=0}=e,T=(0,i().v3)(),{isMobile:A}=T.device,{collectionViewBlockStore:V,collectionSettingsStore:P,collectionViewStore:D,chartErrorStore:_}=(0,a().K8)((()=>({collectionViewBlockStore:t.collectionViewBlockStore(),collectionSettingsStore:t.settingsStore,collectionViewStore:t.collectionViewStore(),chartErrorStore:t.chartErrorStore})),[t]),B=(0,a().O$)(t.isFullScreenStore),j=(0,a().O$)(t.isInHomeWidgetStore),F=(0,a().K8)((()=>Boolean(t.viewsModuleContextStore.getViewModuleType())),[t]),K=(0,a().K8)((()=>V&&x().A.isBlockInTemplate(V)),[V]),O=(0,a().O$)(t.normalizedFormatStore),z=(0,a().K8)((()=>O.chart_config),[O]),G=(0,a().K8)((()=>{var e;return(null==D?void 0:D.id)&&(null===(e=t.updateFreeChartsResultStore.state.get(D.id))||void 0===e?void 0:e.isPending)}),[t.updateFreeChartsResultStore,D]),{canViewChart:E,canViewChartError:I}=(0,b().f)({collectionContextStore:t}),N=(0,a().K8)((()=>{if(!S().A.state.online)return"offline";const e=(0,n().ye)({chartConfig:z,collectionSchema:t.normalizedSchemaStore.state});if(void 0!==e)return e;const o=D?_.getState().get(D.id):void 0;if(void 0!==o)return o;let r;return K||!I&&E||(r=I??"paywall"),r}),[z,_,t.normalizedSchemaStore,D,E,I,K],{useDeepEqual:!0}),H=(0,a().K8)((()=>"sidebar"===(0,f().DN)(t,A,M)&&P.state.open),[t,P,M,A]),$=(0,a().K8)((()=>{var e;const t=null===(e=C().default.state.currentUserSettingsStore)||void 0===e?void 0:e.getSettings(),o=null==t?void 0:t.time_zone,r=(0,l().P)();return o||r}),[]),q=(0,p().x)({chartConfig:z,chartError:N,collectionContextStore:t}),W=function(e){let{chartConfig:t,chartError:o}=e;return(0,a().K8)((()=>{var e,r;if((!o||(0,n().xG)(o))&&t&&"placeholder"!==t.type)if("groups_reducer"===(null===(e=t.dataConfig)||void 0===e?void 0:e.type)){const e=(0,g().p7)(t);if(e)return{type:"aggregation",aggregation:e}}else if("results_reducer"===(null===(r=t.dataConfig)||void 0===r?void 0:r.type))return{type:"aggregation",aggregation:{aggregator:"sum",property:t.dataConfig.valueProperty}}}),[t,o],{useDeepEqual:!0})}({chartConfig:z,chartError:N}),Y=function(e){let{chartConfig:t,chartError:o,collectionContextStore:r}=e;const i=(0,a().K8)((()=>{var e;const o=(0,y().N1)({collectionContextStore:r,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}),i=t&&(0,h().m)(t)?null===(e=t.chartFormat)||void 0===e?void 0:e.axisHideEmptyGroups:void 0,a=t&&(0,h().m)(t)&&"results_reducer"===t.dataConfig.type?t.dataConfig.valueProperty:void 0;if(i&&a){const e={property:a,filter:{operator:"is_not_empty"}},t={property:a,filter:{operator:"number_does_not_equal",value:{type:"exact",value:0}}};o.push(e,t)}return(0,m().GV)(o)}),[r,t]),l=(0,a().K8)((()=>(0,v().dP)()),[]);return(0,a().K8)((()=>{if((!o||(0,n().xG)(o))&&t&&"placeholder"!==t.type&&"results_reducer"===t.dataConfig.type)return{type:"results",limit:l,filter:i}}),[o,t,i,l],{useDeepEqual:!0})}({chartConfig:z,chartError:N,collectionContextStore:t}),X=(0,a().K8)((()=>{var e,o;if(z&&"placeholder"!==z.type&&W)return"groups_reducer"===(null==z||null===(e=z.dataConfig)||void 0===e?void 0:e.type)&&q?{reducerRequestType:"groups",groupedChartReducer:q,aggregationChartReducer:W,collectionContextStore:t,chartConfig:z,timezone:$}:"results_reducer"===(null==z||null===(o=z.dataConfig)||void 0===o?void 0:o.type)&&Y?{reducerRequestType:"results",resultsChartReducer:Y,aggregationChartReducer:W,collectionContextStore:t,chartConfig:z,timezone:$}:void 0}),[z,t,q,W,Y,$]),U=(0,d().Zp)();if(!V)return null;let J;return J=N&&!(0,n().xG)(N)?"paywall"!==N||!G&&void 0!==E?(0,L.jsx)(w().A,{chartError:N,collectionSettingsStore:t.settingsStore,chartType:null==z?void 0:z.type}):(0,L.jsx)(R().z,{chartType:null==z?void 0:z.type,showCopy:B}):z&&"placeholder"!==z.type&&X?(0,L.jsx)(Ve,{...X}):(0,L.jsx)(w().A,{chartError:z?"data_model_invalid":"chart_config_not_found",collectionSettingsStore:t.settingsStore,chartType:null==z?void 0:z.type}),(0,L.jsx)("div",{style:{paddingLeft:r,paddingRight:k,paddingTop:15},children:(0,L.jsx)(c().Ay,{store:V,shouldShowHalo:!B&&!j&&!o,canSelect:!B&&!F,disablePointerEvents:null==U?void 0:U.disableAllPointerEvents,analyticsName:"chart",children:(0,L.jsx)(u().A,{animate:{width:H?`calc(100% - ${s().vE}px)`:"100%"},children:J})})})}},828973:(e,t,o)=>{o.d(t,{A:()=>g});o(898992),o(672577),o(581454);var r=o(296540),i=()=>o(56366),a=()=>o(496603),n=()=>o(406699),l=()=>o(939740),s=()=>o(897119),u=()=>o(89924),c=()=>o(722872),d=o(474848);const g=function(e){let{icon:t,iconStyle:g,title:p,selectedKey:h,onChange:m,onClick:y,popupStyle:v,menuItemOptionsStyle:f,menuStyle:x,disabled:C,collectionContextStore:S,openButtonPopup:b,hideCheck:w,children:R,disableParentClose:k,inputPlaceholder:M,...T}=e;const A=(0,o(484714).Y0)(),V="options"in T?T.options:a().Bq(T.sections),P=V.find((e=>a().n4(e.key,h))),D=(0,i().uB)(void 0,o(463830).A),L=(0,i().O$)(D);return(0,r.useEffect)((()=>{S&&b&&(D.setState({...D.state,open:b}),S.settingsStore.setState({...S.settingsStore.state,openButtonPopup:void 0})),P||o(857639).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(502800).convertErrorToLog)("Selected key is invalid.")})})),(0,d.jsx)(n().Ay,{popupType:A.isMobile?s().nl.SlideUp:s().nl.Popup,alignmentToOrigin:n().yP.End,placementToOrigin:n().sx.Bottom,style:v,originGap:0,buttonPopupStore:D,disabled:C,onClick:y,renderOrigin:e=>(0,d.jsx)(o(497222).A,{title:p,showChevron:!0,right:(0,d.jsx)("span",{style:o(284371).RC,children:"input"===(null==P?void 0:P.type)?P.inputValue:null==P?void 0:P.title}),rotateChevron:L.open,disabled:C,icon:t,iconStyle:g,...(0,o(553965).A)(e,T)}),render:e=>{let t;t=A.isMobile?{menuType:c().gu.ActionSheet}:{menuType:c().gu.Popup,width:250,...x};const r=(t,r)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:r,render:r=>(0,d.jsx)(o(419357).Ay,{...r,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var r;null===(r=t.onSubmit)||void 0===r||r.call(t,t.key,e,t.inputValue),e.close()},placeholder:M,isChecked:!w&&a().n4(t.key,h)}),action:()=>{}}:{key:r,render:e=>(0,d.jsx)(o(760217).A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:f,isChecked:!w&&a().n4(t.key,h)}),action:()=>{m(t.key,e),k||e.close()}},i},i="sections"in T?T.sections.map(((e,t)=>({key:t,render:e=>(0,d.jsx)(u().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oE(e.map(r))}))):[{key:0,render:e=>(0,d.jsx)(u().A,{enableActionSheetTitle:!0,...e}),items:a().oE(V.map(r))}];return(0,d.jsxs)(o(928600).A,{...t,children:[(0,d.jsx)(l().Ay,{type:l().Oh.Vertical,sections:i,initialFocus:0,resetFocusOnMouseOut:!0}),R||null]})}})}}}]);