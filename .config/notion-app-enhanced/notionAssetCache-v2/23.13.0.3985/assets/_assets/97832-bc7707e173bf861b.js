"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[97832],{1564:(e,o,t)=>{t.d(o,{A:()=>ne});t(517642),t(658004),t(733853),t(845876),t(432475),t(515024),t(731698),t(898992),t(354520),t(672577),t(581454);var s=t(296540),n=()=>t(908006),i=()=>t(484714),r=()=>t(56366),a=()=>t(401497),l=()=>t(919709),c=()=>t(959013),d=()=>t(496603),u=()=>t(620689),m=()=>t(725614),p=()=>t(780054),g=()=>t(478726),f=()=>t(299545),h=()=>t(953418),x=()=>t(756214),v=()=>t(695625),S=()=>t(217429),b=()=>t(630116),y=()=>t(486130),C=()=>t(245125),k=()=>t(848565),j=()=>t(369767),A=()=>t(641007),w=()=>t(133033),L=()=>t(693954),B=()=>t(284371),D=()=>t(187485),I=()=>t(265665),R=t(474848);const M="https://notion.notion.site/AI-Conflict-Detection-158efdeead058037b57efc2b77ad9c21";function _(e){let{origin:o}=e;const s=(0,a().IS)((e=>({learnMoreLink:{color:e.text.contrastPrimary}})),[]);return(0,R.jsx)(t(292379).B,{origin:o,placementToOrigin:"bottom",tutorialId:"ai-comment-onboarding",tutorialStepId:"ai-comment-onboarding-tooltip",hideActions:!0,hideInsteadOfFlip:!0,header:(0,R.jsx)(c().sA,{id:"AiCommentOnboardingTooltip.header",defaultMessage:"Check for conflicts with Notion AI"}),content:(0,R.jsx)(c().sA,{id:"AiCommentOnboardingTooltip.content",defaultMessage:"Notion AI searches across your workspace and connected apps for conflicting information, using only sources that all members can access. {learnMoreLink}",values:{learnMoreLink:(0,R.jsx)(t(285176).o,{href:M,style:s.learnMoreLink})}})})}function T(e){const{discussionLocation:o,commentStore:t}=e,s=(0,r().K8)((()=>{if(!t)return!1;const e=t.getCreatedByPointer();return!!e&&e.id===A().px.id}),[t]),n=(0,i().Y0)(),l=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"row",gap:6,width:"100%",color:e.text.tertiary,fontSize:n.isMobile?B().J.UISmall.mobile:B().J.UISmall.desktop,paddingTop:k().e4,paddingLeft:k().SM(o)+k().eQ-8},warningIcon:{width:10,height:10,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"},helpIcon:{color:e.text.tertiary,flexDirection:"row-reverse",gap:6,width:14,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto"},text:{maxWidth:200}})),[n,o]);return s?(0,R.jsxs)("div",{style:l.container,children:[(0,L().Q)(l.warningIcon),(0,R.jsx)(I().j,{style:l.text,children:(0,R.jsx)(c().sA,{id:"aiCommentHeader.conflictingContent.label",defaultMessage:"Notion AI found potential conflicts"})}),(0,R.jsx)(D().A,{href:M,external:!0,style:l.helpIcon,children:(0,w().$)({width:14,marginRight:4})})]}):null}t(430670);var F=()=>t(769617),P=()=>t(656352),U=()=>t(765957),K=()=>t(463830),E=()=>t(811879),N=()=>t(846583),W=()=>t(138873);function z(e){const{discussionStore:o,discussionContext:t,discussionLocation:n,blockStore:i,hoveringDiscussion:l,showUnreadStatusDot:u=!1}=e,m=(0,c().tz)(),[p,g]=(0,s.useState)(!1),f=(0,s.useCallback)((()=>{g(!0)}),[]),h=(0,s.useCallback)((()=>{g(!1)}),[]),x=(0,r().uB)(void 0,K().A),v=(0,r().K8)((()=>x.state.open),[x]),S=(0,r().O$)(U().AppStoreCurrentSpaceStore),y=(0,r().K8)((()=>{const e=b().Lk.getUserVisibleReactions(o),t=e.flatMap((e=>{const o=e.getCreatedTime();return e.getActorStores().map((e=>({actor:e,createdTime:o})))})),s=(0,d().hS)(t.sort(((e,o)=>o.createdTime-e.createdTime)),(e=>e.actor.id));return{reactorNames:s.map((e=>e.actor.getDisplayName(m))),reactors:s.map((e=>e.actor)),reactions:e}}),[o,m]),C=(0,r().K8)((()=>{const e=(null==y?void 0:y.reactions)??[];return p||l||v||e.length>0}),[p,l,v,y]),A=function(e){let{discussionLocation:o}=e;return(0,a().IS)((e=>({container:{flexGrow:"comment_unfurl"===o?1:void 0,paddingTop:"comment_unfurl"===o?k().ds:k().e4,paddingBottom:k().Wv},content:{position:"relative",fontSize:14,width:"100%"},authorRowContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},avatarsAndNames:{display:"flex",flexDirection:"row",alignItems:"center",fontWeight:B().Wy.medium,gap:8},reactorNames:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},reactionElementsBelowUserRow:{paddingLeft:k().FB},reactionBarWrapper:{marginTop:8},unreadStatusDot:{display:"flex",flexDirection:"row",alignItems:"center",marginRight:4},statusDot:{width:8,height:8,borderRadius:"50%",backgroundColor:e.blueColor}})),[o])}({discussionLocation:n}),w=(0,s.useRef)(null);if(!y)return null;const L=t||"updates_sidebar"===n,D=y.reactors[0],I=y.reactors[1];return(0,R.jsx)("div",{ref:w,style:A.container,onMouseMove:f,onMouseLeave:h,children:(0,R.jsxs)("div",{style:A.content,children:[(0,R.jsxs)("div",{style:A.authorRowContainer,children:[(0,R.jsxs)("div",{style:A.avatarsAndNames,children:[y.reactors.length>0&&(0,R.jsxs)("div",{children:[D&&I&&S&&(0,R.jsx)(F().v9,{frontActorStore:D,backActorStore:I,spaceStore:S}),D&&!I&&(0,R.jsx)(E().E,{authorStore:D,avatarSize:k().eQ,hasTooltip:!0,avatarStyle:{},placeholderStyle:{}},D.id)]}),(0,R.jsx)("span",{style:A.reactorNames,children:(0,R.jsx)(c().sA,{id:"reactions.blockReaction",defaultMessage:"{reactors} <regular>reacted</regular>",values:{reactors:(0,R.jsx)(P().DW,{actorNames:y.reactorNames}),regular:e=>(0,R.jsx)("span",{style:{fontWeight:B().Wy.regular},children:e})}})})]}),u&&(0,R.jsx)("div",{style:A.unreadStatusDot,children:(0,R.jsx)("div",{style:A.statusDot})})]}),(0,R.jsxs)("div",{style:A.reactionElementsBelowUserRow,children:[L&&(0,R.jsx)(N().A,{format:(0,j().discussionLocationToDiscussionFormat)(n),discussionLocation:n,store:o,blockStore:i,onClick:e=>e.stopPropagation()}),C&&(0,R.jsx)("div",{style:A.reactionBarWrapper,children:(0,R.jsx)(W().Ay,{parentStore:o,discussionLocation:n})})]})]})})}var O=()=>t(325065),H=()=>t(449729),V=()=>t(651196),G=()=>t(506327),$=()=>t(532945);var Q=()=>t(631611),J=()=>t(972435);const Y=(0,c().YK)({helpful:{id:"assistant.commentFeedback.helpful",defaultMessage:"Helpful"},notHelpful:{id:"assistant.commentFeedback.notHelpful",defaultMessage:"Not helpful"}});function X(e){const{blockStore:o}=e,s=o.id,n=function(e){const o=(0,i().v3)(),t=(0,r().K8)((()=>{const t=e.getNavigableBlockStore();if(t)return new(b().Gd)(o,{table:G().bw,id:t.id,spaceId:t.getSpaceId()})}),[o,e]);return(0,r().K8)((()=>{if(!t)return;const o=e.id,s=t.getRelatedContent().find((e=>e.targetId===o));return s?{feedback:$().A.state[s.inferenceId],inferenceId:s.inferenceId}:void 0}),[t,e.id])}(o),l=null==n?void 0:n.feedback,c=null==n?void 0:n.inferenceId,d=(0,i().v3)(),u=(0,t(47170).O)(),m=(0,a().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12,width:"100%"},buttonRow:{display:"flex",flexDirection:"row",gap:8}})),[]);return c?(0,R.jsx)(Q().hP,{surface:Q().wy.conflictingContentComment,children:(0,R.jsx)("div",{style:m.container,children:(0,R.jsxs)("div",{style:m.buttonRow,children:[(0,R.jsx)(V().Ay,{title:J().A.formatMessage(Y.helpful),variant:"tinted",icon:"thumbs_up"===l?t(886903).x:t(72275).x,onClick:()=>{if(!u||!c)return;const e=o.getNavigableBlockStore();e&&(0,H().H8)({environment:d,pageId:e.id,blockId:s,spaceId:u,inferenceId:c,thumbsUpOrDown:"up"})}}),(0,R.jsx)(V().Ay,{title:J().A.formatMessage(Y.notHelpful),variant:"tinted",icon:"thumbs_down"===l?t(592834).a:t(317658).Q,onClick:()=>{if(!u||!c)return;const e=o.getNavigableBlockStore();e&&(0,H().H8)({environment:d,pageId:e.id,blockId:s,spaceId:u,inferenceId:c,thumbsUpOrDown:"down"})}})]})})}):null}const q={block_menu:"8px 16px 0px",page_discussion:"8px 0px 0px",updates_sidebar:"4px 16px 12px",margin_comments:"8px 12px 6px",comment_unfurl:"0",post_top_level_discussion:"8px 16px 0px",updates_menu_mentions_comments:"4px 16px 12px",updates_menu_all_updates:"4px 16px 12px",updates_menu_archive:"4px 16px 12px",reply_menu_mentions_comments:"8px 16px 0px",reply_menu_all_updates:"8px 16px 0px",reply_menu_archive:"8px 16px 0px",reply_menu_updates_sidebar:"8px 16px 0px",ai_reject_all_suggestions:"0"},Z=s.forwardRef((function(e,o){const n=(0,i().v3)(),{format:l,role:c,showMoreCommentsButton:d,onMoreCommentsClick:u,inputVisible:m,blockStore:p,store:g}=e,f=(0,t(891078).i0)(p),h=c&&t(68263).h9(c)||f,x=n.currentUser.isLoggedIn(),v=(0,s.useRef)(null),S=(0,a().IS)((o=>({container:{position:"relative",padding:0,...l===j().DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}},discussionInputContainer:{padding:q[e.discussionLocation]},aiFeedbackContainer:{display:"flex",flexDirection:"row",gap:8,marginLeft:"page_discussion"===e.discussionLocation?32:24,padding:q[e.discussionLocation]}})),[l,e.discussionLocation]),b=(0,r().K8)((()=>{const e=g.getCommentStores()[0];if(!e)return!1;const o=e.getCreatedByPointer();return!!o&&o.id===A().px.id}),[g]);return x&&!h&&(d||m)?(0,R.jsxs)("div",{style:S.container,children:[d&&(0,R.jsx)(t(499512).d,{enableIcon:!0,onClick:u}),m&&(b?(0,R.jsxs)("div",{style:S.aiFeedbackContainer,ref:v,children:[(0,R.jsx)(X,{blockStore:p,location:e.discussionLocation}),(0,R.jsx)(_,{origin:v})]}):(0,R.jsx)(t(640753).A,{autoFocus:!0,showAvatar:!0,containerStyle:S.discussionInputContainer,parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:o,onFileUploaded:e.onFileUploaded}))]}):null}));var ee=()=>t(493823);function oe(e){const o=(0,a().IS)((o=>{const t=k().SM(e.discussionLocation)+k().eQ;return{moreCommentsWrapper:{color:o.text.tertiary,fontSize:14,flexGrow:1,display:"flex",alignItems:"center",paddingLeft:8},button:{borderRadius:6,fontSize:14,color:o.text.secondary,justifyContent:"space-between",padding:"14px 0",margin:`0 0 0 ${t}px`,width:`calc(100% - ${t}px - 16px)`},buttonHovered:{background:o.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:o.stroke.secondary,width:k().jw,height:"100%",top:k().e4-k().Yz,left:k().SM(e.discussionLocation)+k().im,borderRadius:2}}}),[e.discussionLocation]);return e.count<=0?null:(0,R.jsxs)("div",{style:{position:"relative"},children:[(0,R.jsx)("div",{style:o.threadLine}),(0,R.jsx)(ee().p,{isGray:!0,size:"xs",style:o.button,onClick:e.onClick,hoveredStyle:o.buttonHovered,children:(0,R.jsx)("div",{className:"discussion-show-all-button",style:o.moreCommentsWrapper,children:(0,R.jsx)(c().sA,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var te=()=>t(798995);function se(e){const{onDismiss:o}=e,A=(0,s.useRef)(null),w=(0,c().tz)(),L=(0,i().v3)(),B=(0,r().K8)((()=>"suggestion"===e.store.getType()),[e.store]),D=(0,r().K8)((()=>f().wc(e.store)),[e.store]),I=(0,r().K8)((()=>D.filter((e=>e.isDefined())).filter((e=>Boolean(e.getAlive())))),[D]),M="page_discussion"===e.discussionLocation?3:5;(0,s.useEffect)((()=>{I.length===M&&V(!0)}),[I,M]);const _=(0,s.useRef)(e.discussionInputStore||new(t(404783).A)(L,e.store.pointer.spaceId)).current,F=(0,r().K8)((()=>(0,j().inputIsEmpty)(_)),[_]),P=(0,r().K8)((()=>(0,g().fc)(e.blockStore)&&!(0,g().Cg)(e.blockStore)),[e.blockStore]),U=(0,r().K8)((()=>e.store.getResolved()),[e.store]),[K,E]=(0,s.useState)(!1),[H,V]=(0,s.useState)(void 0!==e.collapsed&&!e.collapsed),[G,$]=(0,s.useState)(!0),Q=(0,r().uB)(void 0,t(17090).A),J=(0,r().K8)((()=>Q.state.clientRect),[Q]),Y=e.format===j().DiscussionFormat.Sidebar,X=e.format===j().DiscussionFormat.Margin,q=(0,s.useRef)(null);(0,t(790748).b)(t(143857).A,(()=>({isSidebarFormat:()=>Y,isMarginFormat:()=>X,getStore:()=>e.store,getInputStore:()=>_,getNode:()=>q.current,getMarginDiscussionScrollContainer:()=>A.current})),[Y,X,e.store,_]);const ee=(0,r().K8)((()=>{if(!Y)return;return(0,j().getAndSortCommentStoresByTime)(e.store).find((o=>C().isCommentUnread({discussionStore:e.store,commentStore:o})))}),[Y,e.store]),se=(0,s.useRef)(ee),ne=(0,t(963589).X)("comment_sidebar_for_you"),re=(0,r().K8)((()=>ne&&function(e){const{discussionStore:o,navigableBlockStore:t}=e;if(!t)return!1;const s=o.userId,n=t.getSpaceId();return Boolean(s&&n&&(0,x().R)({userId:s,blockStore:t,discussionStores:[o],groupIdsUserIsIn:y()._.getSpacePermissionGroupIds({userId:s,spaceId:n})}).length)}({discussionStore:e.store,navigableBlockStore:e.blockStore.getNavigableBlockStore()})),[ne,e.store,e.blockStore]),ae=(0,r().K8)((()=>ne&&(re||e.store.hasEverBeenRead())&&Boolean(e.store.isUnread(S().default.getConfigKey("assume_comment_read","last_seen_at")))),[ne,re,e.store]),le=(0,r().K8)((()=>{if(!ne)return void 0===se.current?ee:se.current;if(!e.store.getSpaceId())return;const o=e.store.getUserSeenRecordStore();if(!o)return;const t=o.getLastSeenAt();if(!t)return ee;const s=I.find((e=>e.getCreatedTime()>t));return s||void 0}),[ne,ee,se,I,e.store]),ce=(0,s.useCallback)((()=>{var o;if(H||I.length<=M||"block_menu"===e.discussionLocation)return I;if("page_discussion"===e.discussionLocation)return d().O6(I,1);const s=[e.showAllRepliesAfterTimestamp,null===(o=se.current)||void 0===o?void 0:o.getCreatedTime(),null==ee?void 0:ee.getCreatedTime()].filter(t(534177).O9),n=s.length>0?Math.min(...s):void 0;if(n){const e=I.filter((e=>(e.getCreatedTime()||0)>n)),o=I.filter((e=>(e.getCreatedTime()||0)<=n));return o.length<=5?I:[...d().O6(o,2),...e]}return d().O6(I,2)}),[I,ee,M,e.discussionLocation,e.showAllRepliesAfterTimestamp,H]),de=(0,r().K8)((()=>{const o=ce(),t=new Set(o.map((e=>e.id))),s=I.filter((e=>!t.has(e.id)));return{commentStores:I,commentsToShow:o,commentsToCollapse:s,reactionsToShow:b().Lk.getUserVisibleReactions(e.store)}}),[I,ce,e.store],{useDeepEqual:!0}),ue=(0,s.useCallback)((()=>{if(!e.store.isDefined())return;const o=e.store.getContext();if(!o)return;const s=(0,t(601813).l8)({discussionContextData:o,discussionType:(0,t(220719).o9)(e.store.getType()),discussionId:e.store.id,intl:w});return l().JJ$(s,(o=>!l().iQL(o)||l().Orm(o)===e.store.id))}),[e.store,w]),me=(0,r().K8)((()=>{if(!Y)return;return(0,j().getAndSortCommentStoresByTime)(e.store).find((o=>C().isCommentUnread({discussionStore:e.store,commentStore:o})))}),[Y,e.store]),pe=(0,s.useRef)(null),ge=(0,s.useRef)(e.blockStore.clone()).current,fe=(0,a().IS)((o=>({discussionWrapper:{...e.format===j().DiscussionFormat.Page&&{margin:`0px ${k().Ql}px 16px`,..."post_top_level_discussion"===e.discussionLocation&&{marginLeft:-16,marginBottom:de.reactionsToShow.length>0?0:12}},...e.format===j().DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${o.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===j().DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}},reactionBarWrapper:{paddingLeft:16,paddingRight:16,..."post_top_level_discussion"===e.discussionLocation&&{display:"flex",justifyContent:"space-between"}}})),[de.reactionsToShow.length,e.discussionLocation,e.format,e.isFirst]);(0,s.useEffect)((()=>{L.KatexStore.loadIfNeeded(ue)}),[L.KatexStore,ue]);const he=(0,s.useCallback)((o=>{if(!p().A.isMobile)return;if(!e.store.isDefined())return;o.stopPropagation(),o.preventDefault(),t(883497).A.setState({open:!1});const s=d().oE(v().T.findSelectablesFromIds([e.store.getParentId()])),n=null==s?void 0:s[0];n&&u().pb({environment:L,handle:n,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[e.store,L]),xe=(0,s.useCallback)((e=>{X||(e.stopPropagation(),V(!0))}),[X]),ve=(0,s.useMemo)((()=>{const{commentStores:o,commentsToShow:s,commentsToCollapse:n}=de;if(X){const s=(0,j().lineClampForCommentCount)(o.length);if(!e.collapsed)return(0,R.jsx)(t(2143).H,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll"},ref:A,type:t(756279).A.Y,store:Q,children:o.map(((t,n)=>{const i=B&&0===n;return(0,R.jsx)(O().A,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:s,shouldShowThreadLine:n!==o.length-1,discussionContext:i?(0,R.jsx)(te().A,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,showNewBar:t.id===(null==le?void 0:le.id)&&0!==n,isSuggestionComment:i,showUnreadStatusDot:0===n&&ae,showMarkAsRead:ae},t.id)}))});const n=o[0]&&(0,R.jsx)(O().A,{store:o[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:s,collapsed:e.collapsed,shouldShowThreadLine:1!==o.length,discussionContext:B?(0,R.jsx)(te().A,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:B,showUnreadStatusDot:ae,showMarkAsRead:ae},o[0].id),i=o.length>1&&o[o.length-1]&&(0,R.jsx)(O().A,{store:o[o.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:s,collapsed:e.collapsed,shouldShowThreadLine:!1,showUnreadStatusDot:!1,showMarkAsRead:!1},o[o.length-1].id),r=o.length-2;return(0,R.jsxs)(R.Fragment,{children:[n,(0,R.jsx)(oe,{insetButton:!X,count:r,onClick:xe,discussionLocation:e.discussionLocation}),i]})}const i=n.length>0,r=s.map(((o,t)=>{const n=B&&0===t,r=0===t&&!i,a=n?(0,R.jsx)(te().A,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):r&&(e.format===j().DiscussionFormat.Menu||e.format===j().DiscussionFormat.Sidebar)&&(0,R.jsx)(N().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:he}),l="post_top_level_discussion"===e.discussionLocation?(0,j().lineClampForCommentCount)(s.length):void 0;return(0,R.jsx)(O().A,{store:o,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:a,isSuggestionComment:n,showNewBar:o.id===(null==le?void 0:le.id)&&0!==t,shouldShowThreadLine:t!==s.length-1,maxLines:l,showUnreadStatusDot:r&&ae,showMarkAsRead:ae},o.id)})),a=B,l=a?(0,R.jsx)(te().A,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):(e.format===j().DiscussionFormat.Menu||e.format===j().DiscussionFormat.Sidebar)&&(0,R.jsx)(N().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:he});return(0,R.jsxs)("div",{style:{position:"relative"},children:[!ne&&Y&&me&&(0,R.jsx)(t(709438).m,{style:ie}),i&&(0,R.jsx)(O().A,{store:o[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:l,shouldShowThreadLine:1!==o.length,isSuggestionComment:a,collapsed:e.collapsed,maxLines:"post_top_level_discussion"===e.discussionLocation&&e.collapsed?(0,j().lineClampForCommentCount)(o.length):void 0,showUnreadStatusDot:ae,showMarkAsRead:ae},o[0].id),(0,R.jsx)(oe,{insetButton:!X,count:n.length-1,onClick:xe,discussionLocation:e.discussionLocation}),r]})}),[de,X,B,e.store,e.collapsed,e.format,e.discussionLocation,e.blockStore,e.showResolveButtonByDefaultIfPossible,he,Y,me,K,ae,xe,Q,null==le?void 0:le.id,ne]),Se=(0,r().K8)((()=>e.blockStore.getRole()),[e.blockStore]),[be,ye]=(0,s.useState)(!0);(0,s.useEffect)((()=>{var e;const o=null===(e=A.current)||void 0===e?void 0:e.getNode();if(o){function t(){o&&ye(h().wU(o))}return o.addEventListener("scroll",t),()=>o.removeEventListener("scroll",t)}}),[A]);const Ce=G&&!e.collapsed&&X&&J&&!be,ke=(0,s.useCallback)((()=>{const e=v().T.findSelectableFromStore(ge);e&&u().pb({environment:L,handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[ge,L]),je=(0,s.useCallback)((()=>{_.reset()}),[_]),Ae=(0,s.useCallback)((()=>{const o=L.currentUser.id;if(!o)return;const s=f().wc(e.store).filter((e=>e.getCreatedById()===o)),n=d().HV(s);if(!n)return;if(B&&1===s.length)return;const i=t(424746).A.find((o=>o.commentId===n.id&&o.discussionLocation===e.discussionLocation));i&&(m().clear({environment:L}),i.edit())}),[e.discussionLocation,B,e.store,L]),we=(0,s.useCallback)((async()=>{if((0,j().hasCommentChanged)(_)){const{accept:e}=await t(901389).Gh({message:(0,R.jsx)(c().sA,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,R.jsx)(c().sA,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})});e?(je(),o&&o()):(await n().default.afterNextFlush(),m().setSelectionAtEnd({store:_.state.textStore}))}else je(),o&&o()}),[o,_,je]),Le=(0,s.useCallback)((()=>{n().default.afterNextFlush((()=>{var e;const o=null===(e=A.current)||void 0===e?void 0:e.getNode();o&&h().VG({element:o,environment:L,options:{top:o.scrollHeight,behavior:"smooth"}})}))}),[A,L]),Be=d().sg((()=>{setTimeout((()=>$(!0)),50)}),50),De=(0,s.useCallback)((async()=>{$(!1),t(751156).createAndCommit({userAction:"Discussion.handleSubmitReply",environment:L,canUndo:!0,perform:o=>{t(789557).lV({environment:L,discussionStore:e.store,textValue:_.state.textStore.getValue()||[],transaction:o,discussionLocation:e.discussionLocation,files:_.state.files,property_id:e.store.getPropertyId(),blockStore:e.blockStore}),S().default.checkGate({gateName:"comment_sidebar_for_you"})&&(0,t(725332).U)({transaction:o,discussionStore:e.store})}}),je(),m().clear({environment:L}),Le(),Be(),p().A.isMobile||(await n().default.afterNextFlush(),m().setSelectionAtStart({store:_.state.textStore}))}),[_,Be,e.blockStore,e.store,e.discussionLocation,Le,L,je]),Ie=(0,s.useCallback)((()=>{t(230062).A.state||E(!0)}),[]),Re=(0,s.useCallback)((()=>{E(!1)}),[]);return 0===de.commentsToShow.length&&de.reactionsToShow.length>0||"post_top_level_discussion"===e.discussionLocation&&0===de.commentsToShow.length&&de.reactionsToShow.length>0?(0,R.jsxs)("div",{ref:q,style:{...fe.discussionWrapper,...fe.reactionBarWrapper},onMouseMove:Ie,onMouseLeave:Re,children:[e.format===j().DiscussionFormat.Menu||e.format===j().DiscussionFormat.Sidebar?(0,R.jsx)(z,{discussionStore:e.store,blockStore:e.blockStore,discussionLocation:e.discussionLocation,hoveringDiscussion:K,discussionContext:(0,R.jsx)(N().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:he})}):(0,R.jsx)(W().tx,{focused:!0,disableShadow:!0,parentStore:e.store,discussionLocation:e.discussionLocation}),"post_top_level_discussion"===e.discussionLocation&&e.pageVisitStore&&e.presenceStore&&(0,R.jsx)(t(126126).hJ,{pageVisitStore:e.pageVisitStore,presenceStore:e.presenceStore,rootStore:e.blockStore,maxUsers:5,isShowingInPostFeed:!0})]}):(0,R.jsx)(t(199896).Ay,{store:ge,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:o}=e;pe.current&&await pe.current.uploadFiles(o)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,R.jsxs)("div",{ref:q,style:fe.discussionWrapper,onMouseMove:Ie,onMouseLeave:Re,children:[!e.collapsed&&(0,R.jsx)(T,{commentStore:D[0],discussionLocation:e.discussionLocation}),ve,U?(0,R.jsx)("div",{style:{height:8}}):(0,R.jsx)(Z,{ref:pe,showMoreCommentsButton:Boolean(Ce),onMoreCommentsClick:Le,inputVisible:!(P||e.collapsed&&F&&"post_top_level_discussion"!==e.discussionLocation),store:e.store,blockStore:ge,format:e.format,discussionInputStore:_,discussionLocation:e.discussionLocation,onCancel:we,onSubmit:De,onEditPreviousComment:Ae,showCtaButtons:!!X||void 0,onFileUploaded:ke,role:Se})]})})}const ne=s.memo(se),ie={marginRight:4,position:"absolute",right:16,top:14}},245125:(e,o,t)=>{t.r(o),t.d(o,{isCommentUnread:()=>r});t(898992),t(354520);var s=()=>t(765957),n=()=>t(546574),i=()=>t(369767);function r(e){var o;let{discussionStore:t,commentStore:r}=e;if(!r.isDefined())return!1;const a=null===(o=s().default.state.currentUserStore)||void 0===o?void 0:o.id;const l=n().A.state.lastInteractionTimes[t.id];if(r.getCreatedById()===a)return!1;const c=function(){if(!t.isDefined()||!a)return 0;const{pageVisitStore:e}=s().default.state,{lastViewTime:o,lastExitTime:n}=e.state;return n||o}();if(void 0===c)return!1;const d=(0,i().getAndSortCommentStoresByTime)(t).filter((e=>e.getCreatedById()===a)).reverse()[0],u=r.getCreatedTime();return!u||!(d&&u<d.getCreatedTime())&&(!(l&&u<l)&&u>c)}},285176:(e,o,t)=>{t.d(o,{o:()=>a});t(296540);var s=()=>t(401497),n=()=>t(133033),i=()=>t(959013),r=t(474848);function a(e){const{href:o,style:t}=e,a=(0,s().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,r.jsxs)("a",{href:o,target:"_blank",style:{...a.default,...t},children:[(0,n().$)({width:14,marginRight:4}),(0,r.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},325065:(e,o,t)=>{t.d(o,{A:()=>Fe});t(898992),t(354520);var s=t(296540),n=()=>t(908006),i=()=>t(484714),r=()=>t(792485),a=()=>t(56366),l=()=>t(401497),c=()=>t(68263),d=()=>t(959013),u=()=>t(284371),m=()=>t(112873),p=()=>t(901389),g=()=>t(751156),f=()=>t(331542),h=()=>t(780054),x=()=>t(299545),v=()=>t(630116),S=()=>t(789557),b=()=>t(848565),y=()=>t(369767);function C(e){return e.isFirstComment&&"comment_unfurl"!==e.discussionLocation&&"post_top_level_discussion"!==e.discussionLocation}var k=()=>t(555776),j=(t(944114),()=>t(584262)),A=()=>t(700500),w=()=>t(526278),L=()=>t(29037),B=()=>t(671089),D=()=>t(66913),I=()=>t(30626),R=()=>t(742852),M=()=>t(863522),_=()=>t(105819),T=()=>t(350124),F=t(474848);const P=(0,t(340498).wt)("reopen",{viewBox:"0 0 14 14",svg:(0,F.jsx)("path",{d:"M1.64844 7.88477C1.64844 10.791 3.98047 13.1289 6.88086 13.1289C9.78125 13.1289 12.1133 10.791 12.1133 7.88477C12.1133 7.53906 11.873 7.29297 11.5273 7.29297C11.1934 7.29297 10.9707 7.53906 10.9707 7.88477C10.9707 10.1582 9.14844 11.9805 6.88086 11.9805C4.61328 11.9805 2.79688 10.1582 2.79688 7.88477C2.79688 5.59961 4.60156 3.78906 6.86328 3.78906C7.25 3.78906 7.60742 3.81836 7.90625 3.88281L6.3125 5.46484C6.20703 5.57617 6.1543 5.69922 6.1543 5.85156C6.1543 6.17383 6.39453 6.41992 6.71094 6.41992C6.875 6.41992 7.00977 6.36719 7.10938 6.26172L9.51758 3.83594C9.64062 3.71289 9.69922 3.57227 9.69922 3.41406C9.69922 3.26172 9.63477 3.10938 9.51758 2.99219L7.10938 0.548828C7.00977 0.4375 6.875 0.378906 6.71094 0.378906C6.39453 0.378906 6.1543 0.636719 6.1543 0.953125C6.1543 1.10547 6.20703 1.24023 6.30664 1.3457L7.72461 2.74609C7.4668 2.69336 7.16797 2.66406 6.86328 2.66406C3.96875 2.66406 1.64844 4.98438 1.64844 7.88477Z"})});var U=()=>t(483690),K=()=>t(236262),E=()=>t(798880),N=()=>t(496603),W=()=>t(534177),z=()=>t(884107),O=()=>t(760217),H=()=>t(406699),V=()=>t(285790),G=()=>t(928600),$=()=>t(939740),Q=()=>t(8980),J=()=>t(89924),Y=()=>t(859428),X=()=>t(962036),q=()=>t(38337),Z=()=>t(722872),ee=()=>t(108944),oe=()=>t(836251),te=()=>t(249847),se=()=>t(963589),ne=()=>t(765957),ie=()=>t(725332);t(581454);var re=()=>t(249349),ae=()=>t(413962),le=()=>t(138873);const ce=(0,d().YK)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function de(e){const{discussionLocation:o,isFirstComment:t,blockStore:n,discussionStore:l,showMarkAsRead:u}=e,p=(0,d().tz)(),f=(0,i().v3)(),x=(0,s.useRef)(null),v=(0,r().S)(),b=(0,a().K8)((()=>Boolean(l.getResolved())),[l]),y=(0,a().K8)((()=>e.store.isDefined()),[e.store]),k=(0,te().T)(),D=(0,a().K8)((()=>{const o=e.store.getCreatedById();return e.store.getCreatedByTable()===E().oo&&k===o}),[k,e.store]),I=(0,a().K8)((()=>{var e;const o=null===(e=ne().default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return o&&c().Km(o)}),[]),T=(0,a().K8)((()=>n.getRole()),[n]),P=(0,a().K8)((()=>{var e;return null==v||null===(e=v.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==v?void 0:v.publicEditModeStore]),{isFirstCommentOfSuggestionDiscussion:U,disableAccept:V}=(0,a().K8)((()=>{var o;const t="suggestion"===l.getType()&&l.getCommentPointers()[0].id===e.store.id,s=(null===(o=n.getNavigableBlockStore())||void 0===o?void 0:o.canEdit())??!1;return{isFirstCommentOfSuggestionDiscussion:t,disableAccept:t&&!s}}),[l,n,e.store]),Y=(0,a().K8)((()=>n.pathIsDead()),[n]),ce=(0,a().K8)((()=>C({isFirstComment:t,discussionLocation:o})),[t,o]),de="comment_only"===T||"comment"===P,ue=(0,se().X)("comment_sidebar_for_you"),me=(0,s.useCallback)((()=>g().createAndCommit({userAction:"Comment.markDiscussionRead",environment:f,canUndo:!0,perform:e=>(0,ie().U)({transaction:e,discussionStore:l})})),[f,l]),ge=(0,s.useCallback)((()=>g().createAndCommit({userAction:"Comment.markDiscussionUnread",environment:f,canUndo:!0,perform:e=>function(e){const{transaction:o,discussionStore:t}=e,s=t.userId;if(!s)return;const n=t.getCommentStores().map((e=>e.getCreatedTime())),i=n.length?Math.max(...n):void 0,r=t.getUserSeenRecordStore(s);return g().applyOperation({store:r,operation:{pointer:r.pointer,path:[],command:"update",args:{user_id:s,space_id:r.pointer.spaceId,parent_id:t.id,parent_table:t.table,last_seen_at:i?i-1:void 0}},transaction:o}),t}({transaction:e,discussionStore:l})})),[f,l]);if(!y||!k)return null;const fe=()=>{g().createAndCommit({userAction:"Comment.handleReopen",environment:f,canUndo:!0,perform:o=>{S().E3({environment:f,commentStore:e.store,discussionStore:l,transaction:o,discussionLocation:e.discussionLocation})}})},he=o=>{g().createAndCommit({userAction:"Comment.handleResolve",environment:f,canUndo:!0,perform:o=>{(0,re().j)({environment:f,commentStore:e.store,discussionStore:l,transaction:o,discussionLocation:e.discussionLocation})}}),m().UP(),null==o||o.stopPropagation()},xe=()=>{g().createAndCommit({userAction:"Suggestion.handleAccept",environment:f,canUndo:!0,perform:o=>{ae()._3({action:"accept",environment:f,commentStore:e.store,discussionStore:l,transaction:o,discussionLocation:e.discussionLocation,currentPageStore:ee().fA(l)})}}),m().UP()},ve=()=>{g().createAndCommit({userAction:"Suggestion.handleReject",environment:f,canUndo:!0,perform:o=>{ae()._3({action:"reject",environment:f,commentStore:e.store,discussionStore:l,transaction:o,discussionLocation:e.discussionLocation,currentPageStore:ee().fA(l)})}}),m().UP()},Se=async()=>{var o,t;const s=e.store.getParentStore();if(!s||null==s||!s.isDefined())return null;let n=s.getParentStore();if(null===(o=n)||void 0===o||!o.isDefined())return null;var i;n.getType()===A().xd.tableRow&&(n=null===(i=n)||void 0===i?void 0:i.getParentBlockStore());if(null===(t=n)||void 0===t||!t.isDefined())return null;const r=n.getModel().getRenderUrl({baseUrl:h().A.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:s.id,pageVisitSource:j().y8.CopyLink}),a=await z().R.clipboardActions.load();a.copyString({environment:f,stringValue:r,copiedMessage:a.clipboardMessages.copiedLinkToClipboard})};if(!f.currentUser.isLoggedIn())return null;const be=T&&c().h9(T)||Y;if(be)return null;const ye=ce&&!h().A.isMobile&&!de&&!be,Ce=[];h().A.isMobile&&!de&&!be&&e.isFirstComment&&(b?Ce.push("reopen"):Ce.push("resolve")),!U&&D&&Ce.push("edit"),t&&(Ce.push("copyLink"),ue&&(u?Ce.push("markDiscussionRead"):Ce.push("markDiscussionUnread"))),U||!D&&!I||Ce.push("delete");const ke=Ce.length>0;return ke||ye||e.canShowReactions?(0,F.jsx)(H().Ay,{ref:x,popupType:h().A.isMobile?H().z7.BottomSheet:H().z7.Popup,bottomSheetInitialState:"half",buttonPopupStore:e.buttonPopupStore,placementToOrigin:H().sx.Right,stopClickPropagation:!0,renderOrigin:t=>(0,F.jsx)(pe,{buttonConfig:{resolve:{visible:ye&&!U,resolved:b,onResolve:he,onReopen:fe},react:{visible:e.canShowReactions,onReact:()=>{var t;(0,le().uJ)(f,p,e.store,(null===(t=x.current)||void 0===t?void 0:t.getAnchor())??null,o,e.handleReaction)}},accept:{visible:U&&!V&&!b,onAccept:xe},reject:{visible:U&&!b&&(!de||D),onReject:ve},moreActions:{visible:ke}},visible:e.visible,buttonPopupEvents:t,discussionLocation:e.discussionLocation,store:e.store}),render:o=>{let t;t=h().A.isMobile?{menuType:Z().gu.Modal,title:(0,F.jsx)(d().sA,{id:"comment.mobileCommentMenu.title",defaultMessage:"Comment"})}:{menuType:Z().gu.Popup};const s=Ce.map((o=>"reopen"===o?{key:"reopen",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:w().w}),title:(0,F.jsx)(d().sA,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:fe}:"resolve"===o?{key:"resolve",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:L().checkmarkIcon}),title:(0,F.jsx)(d().sA,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>he()}:"edit"===o?{key:"edit",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:_().pencilLineIcon}),title:(0,F.jsx)(d().sA,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===o?{key:"delete",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:K().trashIcon}),title:(0,F.jsx)(d().sA,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===o?{key:"copyLink",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:R().w}),title:(0,F.jsx)(d().sA,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:Se}:"markDiscussionRead"===o?{key:"markDiscussionRead",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:B().checkmarkCircleIcon}),title:(0,F.jsx)(d().sA,{id:"comment.markDiscussionRead.button",defaultMessage:"Mark as read"})}),action:me}:"markDiscussionUnread"===o?{key:"markDiscussionUnread",render:e=>(0,F.jsx)(O().A,{...e,icon:(0,F.jsx)(Q().I,{icon:M().C}),title:(0,F.jsx)(d().sA,{id:"comment.markDiscussionUnread.button",defaultMessage:"Mark as unread"})}),action:ge}:void(0,W().HB)(o)));return(0,F.jsx)("div",{className:q().Jb,children:(0,F.jsxs)(G().A,{...t,children:[(0,F.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:void 0,onAccept:o.close,sections:N().oE([s.length&&{key:0,render:e=>(0,F.jsx)(J().A,{...e}),items:s}])}),!h().A.isMobile&&(0,F.jsx)(J().A,{topBorder:!0,disableDesktopPadding:!1,children:(0,F.jsx)(X().A,{title:(0,F.jsx)(d().sA,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,oe().xS)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function ue(e){return"accept"in e}function me(e){return"resolve"in e}function pe(e){const{buttonPopupEvents:o,buttonConfig:t}=e,s=(0,d().tz)(),n=(0,l().IS)((o=>({addIcon:{height:21,width:21,fill:o.icon.secondary},container:{display:"flex",boxShadow:"0px 2px 12px 0px rgba(29, 27, 22, 0.06)",borderWidth:1,borderStyle:"solid",borderColor:o.stroke.secondary,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:o.buttonGroupBackground,right:0,...h().A.isMobile?{borderRadius:6,top:-3}:{marginRight:0,marginTop:"updates_sidebar"===e.discussionLocation?6:0,opacity:e.visible?1:0,gap:1,borderRadius:6,transition:"opacity 100ms ease-out",zIndex:1,top:-4}},iconButton:{borderRadius:4}})),[e.discussionLocation,e.visible]);return(0,F.jsxs)("div",{style:n.container,children:[ue(t)&&t.accept.visible&&(0,F.jsx)(Y().A,{renderTooltip:()=>(0,F.jsx)(d().sA,{...ce.acceptButton}),render:e=>(0,F.jsx)(V().A,{hasBackground:!1,showShadow:!1,icon:U().q,onClick:t.accept.onAccept,ariaLabel:s.formatMessage(ce.acceptButton),style:n.iconButton,...e})}),ue(t)&&t.reject.visible&&(0,F.jsx)(Y().A,{renderTooltip:()=>(0,F.jsx)(d().sA,{...ce.rejectButton}),render:e=>(0,F.jsx)(V().A,{hasBackground:!1,showShadow:!1,icon:D().V,onClick:t.reject.onReject,iconStyle:{height:18,width:18},ariaLabel:s.formatMessage(ce.rejectButton),style:n.iconButton,...e})}),t.react.visible&&(0,F.jsx)(Y().A,{renderTooltip:()=>(0,F.jsx)(d().sA,{...ce.addReaction}),render:e=>(0,F.jsx)(V().A,{ariaLabel:s.formatMessage(ce.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,T().s)(n.addIcon),onClick:t.react.onReact,style:n.iconButton,...e})}),me(t)&&t.resolve.visible&&(0,F.jsx)(Y().A,{renderTooltip:()=>(0,F.jsx)(d().sA,{...t.resolve.resolved?ce.reopenButton:ce.resolveButton}),render:e=>(0,F.jsx)(V().A,{hasBackground:!1,showShadow:!1,icon:t.resolve.resolved?P:U().q,onClick:t.resolve.resolved?t.resolve.onReopen:t.resolve.onResolve,...e,ariaLabel:s.formatMessage(t.resolve.resolved?ce.reopenButton:ce.resolveButton),style:n.iconButton})}),t.moreActions.visible&&(0,F.jsx)(Y().A,{renderTooltip:()=>(0,F.jsx)(d().sA,{...ce.moreActions}),render:e=>(0,F.jsx)(V().A,{...o,...e,hasBackground:!1,showShadow:!1,icon:I()._,ariaLabel:s.formatMessage(ce.moreActions),style:n.iconButton})})]})}var ge=()=>t(675074),fe=()=>t(453101),he=()=>t(518888),xe=()=>t(489436),ve=()=>t(973753);const Se=3;function be(e){let{stores:o,collapsed:t,shouldShowGrayFogInScroller:s,onRemoveBlockFromComment:n}=e;return 0===o.length?null:o.length<=Se?(0,F.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:o.map((e=>(0,F.jsx)(xe().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:t,onRemoveBlockFromComment:n}},e.id)))}):(0,F.jsx)(ve().A,{shouldShowGrayFog:s,children:o.map((e=>(0,F.jsx)(xe().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:t,onRemoveBlockFromComment:n}},e.id)))})}var ye=()=>t(797265),Ce=()=>t(704152);const ke=3,je=4;function Ae(e){let{stores:o,embedBlockLocation:t,onRemoveContent:s}=e;const n=(0,i().v3)();if(0===o.length)return null;if(o.length<=ke)return(0,F.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:o.map((e=>(0,F.jsx)(we,{store:e,embedBlockLocation:t,onRemoveContent:s,isLarge:!0},e.id)))});if(o.length<=je)return(0,F.jsx)("div",{style:{display:"flex",gap:4},children:o.map((e=>(0,F.jsx)(we,{store:e,embedBlockLocation:t,onRemoveContent:s,isLarge:!1},e.id)))});const r=o.slice(0,je-1),a=o[je-1],l=o.length-je+1,c=o.slice(je);return(0,F.jsxs)("div",{style:{display:"flex",gap:4},children:[r.map((e=>(0,F.jsx)(we,{store:e,embedBlockLocation:t,onRemoveContent:s,isLarge:!1},e.id))),(0,F.jsxs)("div",{children:[(0,F.jsx)(Ce().A,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:u().Wy.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{ye().iy({environment:n,blockStore:a})},children:`+${l}`}),(0,F.jsx)(we,{store:a,embedBlockLocation:t,onRemoveContent:s,isLarge:!1},a.id)]}),(0,F.jsx)("div",{style:{display:"none"},children:c.map((e=>(0,F.jsx)(we,{store:e,embedBlockLocation:t,onRemoveContent:s,isLarge:!1},e.id)))})]})}function we(e){let{store:o,isLarge:t,embedBlockLocation:s,onRemoveContent:n}=e;const i=(0,l().IS)((e=>({imageShared:{border:`1px solid ${e.stroke.secondary}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,F.jsx)(fe().Ay,{store:o,blockLocation:s,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...i.imageShared,...t?Le:Be},disableActions:!t,onRemoveBlockFromComment:t?n:void 0},o.id)}const Le={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},Be={width:48,height:48,minWidth:48,minHeight:48};var De=()=>t(773382);function Ie(e){let{store:o}=e;const t=(0,a().K8)((()=>he().default.getKeyState(he().default.getBlockKey(o.id))),[o.id]),s=(0,d().tz)(),n=(0,l().IS)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:u().Wy.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!t)return(0,F.jsxs)("div",{style:n.wrapper,children:[(0,F.jsx)("div",{style:n.icon,children:(0,F.jsx)(f().A,{})}),(0,F.jsx)("div",{style:n.fileDetails,children:(0,F.jsx)("div",{style:n.fileName,children:s.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:i,size:r,progressPercent:c,progressText:m}=t;return(0,F.jsxs)("div",{style:n.wrapper,children:[(0,F.jsx)("div",{style:n.icon,children:(0,F.jsx)(f().A,{})}),(0,F.jsx)("div",{style:{overflow:"hidden"},children:(0,F.jsxs)("div",{style:n.fileDetails,children:[(0,F.jsx)("div",{style:n.fileName,children:i}),(0,F.jsxs)("div",{style:n.sizeAndProgressContainer,children:[(0,F.jsx)("span",{style:n.fileSizeText,children:(0,y().formatFileSize)(r)}),(0,F.jsx)("span",{style:n.progressText,children:"â€”"}),(0,F.jsx)(f().A,{}),c?(0,F.jsx)(De().A,{percentage:c,style:n.progressText}):m?(0,F.jsx)("span",{children:m}):null]})]})})]})}function Re(e){let{stores:o}=e;return 0===o.length?null:(0,F.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:o.map((e=>(0,F.jsx)(Ie,{store:e},e.id)))})}function Me(e){const o=e.discussionFormat===y().DiscussionFormat.Sidebar?ge().ZO.SidebarComment:ge().ZO.PageComment,{uploading:t,images:s,embeds:n,files:i}=(0,a().K8)((()=>{const[o,t]=N().jB(e.contentStores,(e=>{const o=Boolean(he().default.getKeyState(he().default.getBlockKey(e.id))),t=(0,fe().x7)(e);return o||!t})),[s,n]=N().jB(t,(e=>e.getType()===A().xd.image)),[i,r]=N().jB(n,(e=>"video"===e.getType()));return{uploading:o,images:s,embeds:i,files:r}}),[e.contentStores]);return 0===t.length&&0===s.length&&0===n.length&&0===i.length?null:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,F.jsx)(Re,{stores:t}),(0,F.jsx)(Ae,{stores:s,embedBlockLocation:o,onRemoveContent:e.onRemoveContent}),n.length>0&&(0,F.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:n.map((t=>(0,F.jsx)(fe().Ay,{store:t,blockLocation:o,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},t.id)))}),(0,F.jsx)(be,{stores:i,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===y().DiscussionFormat.Margin||e.discussionFormat===y().DiscussionFormat.Sidebar),onRemoveBlockFromComment:e.onRemoveContent})]})}var _e=()=>t(477293);function Te(){const e="on"===(0,_e().r)("condensed_notification_ia"),o=(0,l().IS)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:u().Wy.semibold,display:"flex",alignItems:"center",margin:0,paddingTop:10,paddingBottom:10,paddingLeft:b().FB},newBarPill:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:b().jw,height:"100%",borderRadius:2,left:b().im,top:-6}})),[]),t=(0,l().IS)((e=>({newBarLine:{height:"0px",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.tint.uiBlue,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,fontSize:10,fontWeight:u().Wy.regular,display:"flex",alignItems:"center",paddingTop:10,paddingBottom:10,paddingLeft:b().FB},newBarPill:{textTransform:"uppercase",height:16,display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,whiteSpace:"nowrap",borderRadius:4,backgroundColor:e.tint.uiBlue,color:e.text.uiBluePrimary,marginLeft:12,marginRight:12},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:b().jw,height:"100%",borderRadius:2,left:b().im,top:-6}})),[]),s=e?t:o;return(0,F.jsxs)("div",{style:{position:"relative"},children:[(0,F.jsx)("div",{style:s.threadLine}),(0,F.jsxs)("div",{style:s.newBarWrapper,children:[(0,F.jsx)("div",{style:s.newBarLine}),(0,F.jsx)("div",{style:s.newBarPill,children:e?(0,F.jsx)(d().sA,{id:"comment.newBar.label",defaultMessage:"New"}):(0,F.jsx)(d().sA,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,F.jsx)("div",{style:s.newBarLine})]})]})}const Fe=function(e){const{store:o,discussionContext:j,discussionLocation:A,shouldShowThreadLine:w,discussionStore:L,blockStore:B,collapsed:D,showMarkAsRead:I}=e,R=(0,i().v3)(),[M,_]=(0,s.useState)(!1),[T,P]=(0,s.useState)(!1),[U,K]=(0,s.useState)(!1),[E,N]=(0,s.useState)(!1),[W,z]=(0,s.useState)("post_top_level_discussion"===A&&D),O=(0,a().K8)((()=>e.store.isDefined()?new(t(404783).A)(R,e.store.getSpaceId()):void 0),[R,e.store]),H=(0,a().K8)((()=>x().dd(e.store).filter((e=>(0,v().G_)(e,{table:t(179034).ev,id:e.id},"alive").getValue()))),[e.store]),V=(0,a().K8)((()=>L.getResolved()),[L]),G=(0,a().K8)((()=>null==O?void 0:O.state.files),[O]),$=(0,a().K8)((()=>null==O?void 0:O.state.textStore),[O]),Q=(0,s.useCallback)((e=>{const o=e.target;o instanceof HTMLElement&&(0,t(819121).p)(o)&&P(!0)}),[]),J=(0,s.useCallback)((()=>{P(!1)}),[]),Y=(0,s.useCallback)((()=>{t(230062).A.state||K(!0)}),[]),X=(0,s.useCallback)((()=>{K(!1)}),[]),q=(0,r().S)(),Z=(0,a().uB)(void 0,t(463830).A),ee=(0,a().K8)((()=>Z.state.open),[Z]),oe=(0,t(551619).Sm)(B),te=(0,a().K8)((()=>(0,t(252833).o7)(e.store.id)),[e.store.id]),se=(0,a().K8)((()=>{const o=e.discussionStore.getComments();return Boolean(o&&o[0]===e.store.id)}),[e.discussionStore,e.store.id]),ne=(0,a().K8)((()=>{var o;const t=B.getRole(),s=C({isFirstComment:se,discussionLocation:A}),n=B.pathIsDead(),i=t&&c().h9(t)||n,r="comment_only"===t||q&&"comment"===(null===(o=q.publicEditModeStore.state)||void 0===o?void 0:o.permission),a=s&&!h().A.isMobile&&!r&&!i;return U||T||e.hoveringDiscussion&&s||ee||h().A.isMobile||e.showResolveButtonByDefaultIfPossible&&a}),[B,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,se,A,q,U,T,ee]),ie=(0,s.useContext)(t(789550).R),re=(0,a().K8)((()=>{const e=o.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:o.getLastEditedTime(),createdTime:o.getCreatedTime(),text:o.getText(),reactions:v().Lk.getUserVisibleReactions(o)}:null}),[o]),ae=(0,a().K8)((()=>re?v().sk.createChildStore(o,re.createdByPointer):null),[re,o]),ce=function(e){const{discussionLocation:o,isCommentCollapsed:t,isDiscussionCollapsed:s,maxLines:n}=e;if("post_top_level_discussion"===o)return t?n:void 0;return s?n:void 0}({discussionLocation:A,isCommentCollapsed:W,isDiscussionCollapsed:D,maxLines:e.maxLines}),ue=(0,s.useCallback)((()=>{g().createAndCommit({userAction:"Comment.deleteComment",environment:R,canUndo:!0,perform:o=>{S().Tu({environment:R,commentStore:e.store,transaction:o,discussionLocation:A})},skipUpdatingEditedMetadata:!0})}),[R,e.store,A]),me=(0,s.useCallback)((async()=>{const{accept:e}=await p().Gh({message:(0,F.jsx)(d().sA,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,F.jsx)(d().sA,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})});e&&(ue(),m().UP(),k().A.state.overlapsExistingDiscussionMenu&&!t(372154).A.state.open&&k().A.setState({...k().A.state,overlapsExistingDiscussionMenu:!1}),t(902731).jS(R))}),[ue,R]),pe=(0,s.useCallback)((async o=>{const t=x().gp(e.store).getValue(),s=x().dd(e.store).filter((e=>e.id!==o.id)),n=t&&t.length>0,i=0===s.length;!n&&i?(await me(),_(!1)):g().createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:R,canUndo:!0,perform:t=>{S().L6({commentStore:e.store,fileBlocks:[o],transaction:t})}})}),[R,me,e.store]),ge=(0,s.useCallback)((()=>{N(!0)}),[]),fe=(0,s.useCallback)((async()=>{if(!O)return;const o=x().gp(e.store).getValue()||[],s=O.state.textStore;g().createAndCommit({userAction:"Comment.handleEditComment",environment:R,canUndo:!0,perform:e=>{t(319975).R9({environment:R,store:s,value:o,transaction:e})}}),_(!0),await n().default.afterNextFlush(),await n().default.afterNextFlush(),t(725614).setSelectionAtEnd({store:s})}),[O,R,e.store]),he=(0,s.useCallback)((async()=>{if(!O)return!1;if(!(0,y().hasCommentChanged)(O,e.store))return _(!1),!0;{const{accept:e}=await p().Gh({message:(0,F.jsx)(d().sA,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,F.jsx)(d().sA,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})});if(e)return _(!1),!0}return!1}),[O,e.store]),xe=(0,s.useCallback)((async()=>{const o=null==$?void 0:$.getValue();o&&o.length>0||G&&G.length>0?g().createAndCommit({userAction:"Comment.handleSubmitEdit",environment:R,canUndo:!0,perform:t=>{S().QA({environment:R,store:e.store,text:o||[],transaction:t,discussionLocation:A,files:G||[],property_id:L.getPropertyId(),blockStore:B})}}):await me(),_(!1)}),[$,G,R,e.store,A,L,B,me]),ve=(0,s.useCallback)((()=>{"post_top_level_discussion"===A&&z(!1)}),[A]),Se=(0,s.useRef)(null),be=(0,s.useRef)(null);(0,t(790748).b)(t(424746).A,(()=>({edit:fe,handleCancelEdit:he,getNode:()=>Se.current,isEditing:()=>M,discussionLocation:A,commentId:e.store.id})),[fe,he,M,A,e.store.id]);const ye=null==re?void 0:re.text,Ce=void 0!==ye&&ye.length>0&&t(919709).AhH(ye)>0,ke=Ce&&(0,y().isCommentAllEmojis)(ye),je=function(e){let{discussionLocation:o,isAllEmojis:t}=e;return(0,l().IS)((e=>({container:{flexGrow:"comment_unfurl"===o?1:void 0,paddingTop:"comment_unfurl"===o?b().ds:b().e4,paddingRight:"margin_comments"===o?12:16,paddingBottom:b().Wv,paddingLeft:b().SM(o)},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:b().FB},discussionInputContainer:{width:"calc(100% + 8px)"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,borderRadius:2,width:b().jw,height:b().k2,left:b().im,top:b().uG},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:"comment_unfurl"===o?u().Wy.medium:void 0,display:"block",marginBottom:-1.5,pointerEvents:"auto"},attachIcon:{width:18,height:18,fill:e.icon.secondary},text:{cursor:"comment_unfurl"!==o?"text":void 0,lineHeight:"20px",paddingTop:4,...t?{fontSize:32,lineHeight:"32px"}:{}},attachmentContainer:{display:"flex",alignItems:"center"},commentAttachment:{},authorRowContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},unreadStatusDot:{display:"flex",flexDirection:"row",alignItems:"center",marginRight:4}})),[o,t])}({discussionLocation:A,isAllEmojis:ke}),Ae=(0,s.useMemo)((()=>({type:"comment_match",commentId:e.store.id})),[e.store.id]),we="comment_unfurl"!==A,Le=we&&re&&re.reactions.length>0;if((0,s.useEffect)((()=>{E&&be.current&&Le&&(t(620689).hT({element:be.current,environment:R,scrollerContext:ie,vertical:{reveal:"closest"},horizontal:void 0,animate:!0}),N(!1))}),[R,ie,E,Le]),!O)return null;if(!re||!ae)return null;const Be=H.length>0&&(0,F.jsx)("div",{style:je.commentAttachment,children:(0,F.jsx)(Me,{contentStores:H,onRemoveContent:pe,discussionFormat:(0,y().discussionLocationToDiscussionFormat)(A),collapsed:D,discussionHovered:e.hoveringDiscussion})});return(0,F.jsxs)("div",{ref:Se,onClick:e=>M&&e.stopPropagation(),style:je.container,children:[e.showNewBar&&(0,F.jsx)(Te,{}),(0,F.jsxs)("div",{style:je.comment,onFocus:Q,onBlur:J,onMouseMove:Y,onMouseLeave:X,children:[(0,F.jsxs)("div",{style:je.authorRowContainer,children:[(0,F.jsx)(t(436683).Y,{createdTime:re.createdTime,lastEditedTime:re.lastEditedTime,location:A,isResolved:V,isSuggestionComment:e.isSuggestionComment,authorStore:ae,commentStore:o}),e.showUnreadStatusDot&&(0,F.jsx)("div",{style:je.unreadStatusDot,children:(0,F.jsx)(t(709438).m,{size:t(61548).jd})})]}),w&&(0,F.jsx)("div",{style:je.threadLine}),(0,F.jsxs)("div",{style:je.commentElementsBelowUserRow,children:[Boolean(j)&&j,M&&(0,F.jsx)("div",{style:{marginTop:4},children:(0,F.jsx)(t(640753).A,{containerStyle:je.discussionInputContainer,showAvatar:!1,parentStore:e.store,blockStore:B,onCancel:he,onSubmit:xe,discussionInputStore:O,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,y().discussionLocationToDiscussionFormat)(A),canDrop:!0})}),Ce&&!M&&(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,F.jsx)(t(447587).A,{onMore:"comment_unfurl"===A?void 0:ve,moreElement:(0,F.jsxs)(t(719147).A,{disableUnderline:!0,style:je.unfurlMoreWrapper,hoverColor:"blue",children:["â€¦","Â ",(0,F.jsx)("span",{children:(0,F.jsx)(d().sA,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:ce,children:(0,F.jsx)(t(524702).A,{style:je.text,store:x().gp(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:Ae})}),oe&&te&&(0,F.jsx)(f().A,{style:{alignSelf:"flex-end",marginRight:8,marginLeft:8}})]}),M||"comment_unfurl"===A?!Ce&&(0,F.jsxs)("div",{style:je.attachmentContainer,children:[(0,F.jsx)("div",{style:{marginRight:5},children:(0,t(819713).j)(je.attachIcon)}),(0,F.jsx)(d().sA,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:H.length},id:"comment.unfurl.attachments.title"})]}):Be,Le&&(0,F.jsx)("div",{ref:be,style:{marginTop:8},children:(0,F.jsx)(le().Ay,{parentStore:e.store,discussionLocation:A})})]}),"comment_unfurl"!==A&&!M&&!oe&&(0,F.jsx)(de,{store:e.store,discussionStore:e.discussionStore,blockStore:B,discussionLocation:A,visible:ne,isFirstComment:se,buttonPopupStore:Z,canShowReactions:we,handleEditComment:fe,handleDeleteComment:me,handleReaction:ge,showMarkAsRead:I})]})]})}},487441:(e,o,t)=>{t.d(o,{i:()=>c});t(898992),t(354520);var s=()=>t(56366),n=()=>t(955825),i=()=>t(186445),r=()=>t(963589),a=()=>t(419123),l=()=>t(217429);function c(){const e=(0,s().K8)((()=>(0,i().ao)()),[]),o=(0,a().k)({navigableBlockStore:e}),t=(0,r().X)("margin_comments_stepper");return(0,s().K8)((()=>{if(!t)return{pageSortedDiscussions:[],pageSortedUnreadDiscussions:[]};const e=Array.from(o).sort(((e,o)=>{var t,s;const i=null===(t=document.getElementsByClassName((0,n().wV)({discussionId:e.id}))[0])||void 0===t?void 0:t.getBoundingClientRect(),r=null===(s=document.getElementsByClassName((0,n().wV)({discussionId:o.id}))[0])||void 0===s?void 0:s.getBoundingClientRect();return i&&r?i.top-r.top:0})),s=l().default.getConfigKey("assume_comment_read","last_seen_at");return{pageSortedDiscussions:e,pageSortedUnreadDiscussions:e.filter((e=>e.isUnread(s)))}}),[o,t])}},536612:(e,o,t)=>{t.d(o,{A:()=>n});class s extends(()=>t(959180))().A{}const n=new s},580546:(e,o,t)=>{t.d(o,{U:()=>x,_:()=>h});t(898992),t(672577);var s=t(296540),n=()=>t(56366),i=()=>t(401497),r=()=>t(626466),a=()=>t(300905),l=()=>t(959013),c=()=>t(704152),d=()=>t(285790),u=()=>t(186445),m=()=>t(835066),p=t(474848);function g(){const e=(0,t(484714).v3)(),[o,s]=(0,t(781312).y)(),r=(0,n().K8)((()=>(0,u().ao)()),[]),a=(0,t(963589).X)("margin_comments_stepper"),{pageSortedDiscussions:l,pageSortedUnreadDiscussions:c}=(0,t(487441).i)(),d=(0,n().K8)((()=>t(372154).A.getFramePageFirstSelectedDiscussionId()),[]),g=(0,n().K8)((()=>d?c.find((e=>e.id===d)):c[0]),[d,c]),h=(0,n().K8)((()=>g?g.getParentStore():null),[g]),{discussionCount:x,currentPosition:v,handleMarkAllAsRead:S,handleStepToNextDiscussion:b,handleStepToPreviousDiscussion:y}=(0,t(970464).p)({discussionStore:g,pageSortedDiscussions:l,pageSortedUnreadDiscussions:c,isDiscussionSelected:Boolean(d)}),C=new(t(404783).A)(e,(null==r?void 0:r.pointer.spaceId)??""),k=(0,n().K8)((()=>t(749687).sidebarExpandedStore.state?(0,t(644914).kf)(e):0),[e]),j=(0,n().K8)((()=>{if(!a||0===c.length)return!1;const o=(0,u().ao)();return(!o||!(0,m().dC)(e,o))&&(!o||!(0,m().$N)(e,o))}),[a,c,e]),A=(0,i().IS)((e=>({fadeOverlay:{position:"absolute",bottom:0,left:k,right:0,zIndex:10,marginLeft:"auto",marginRight:"auto",maxWidth:708,height:s+70,background:j?`linear-gradient(to bottom, transparent 0, ${e.popoverWaxPaperBackground} 50px, ${e.popoverWaxPaperBackground} 100%)`:"transparent",pointerEvents:"none",opacity:j?1:0,transition:"opacity 250ms ease-in"},stepperContainer:{position:"absolute",bottom:20,left:k,right:0,zIndex:10,display:"flex",flexDirection:"column",justifyContent:"end",gap:8,maxWidth:708,paddingLeft:8,paddingRight:8,marginTop:0,marginBottom:0,marginLeft:"auto",marginRight:"auto",opacity:j?1:0,transition:"opacity 250ms ease-in"},discussion:{borderRadius:8,overflow:"hidden",background:e.contentBackground,boxShadow:e.shadowSM}})),[k,s,j]);return a&&g&&h?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{style:A.fadeOverlay}),(0,p.jsxs)("div",{ref:o,style:A.stepperContainer,children:[(0,p.jsx)(f,{currentPosition:v,discussionCount:x,onMarkAllAsRead:S,onStepToPrevious:y,onStepToNext:b}),(0,p.jsx)("div",{style:A.discussion,children:(0,p.jsx)(t(1564).A,{store:g,blockStore:h,format:t(369767).DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",discussionInputStore:C,collapsed:!1})})]})]}):null}function f(e){const{currentPosition:o,discussionCount:t,onMarkAllAsRead:s,onStepToPrevious:n,onStepToNext:u}=e,m=(0,l().tz)(),g=(0,i().IS)((e=>({controls:{display:"flex",alignItems:"center",gap:4},markAllAsRead:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,borderRadius:6,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6,backdropFilter:"blur(8px)"},discussionCount:{marginRight:"auto",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,borderRadius:6,paddingLeft:6,paddingRight:6,backdropFilter:"blur(8px)"},chevronButton:{backdropFilter:"blur(8px)"}})),[]);return(0,p.jsxs)("div",{style:g.controls,children:[(0,p.jsx)("div",{style:g.discussionCount,children:`${o} of ${t}`}),(0,p.jsx)(c().A,{style:g.markAllAsRead,onClick:s,children:(0,p.jsx)(l().sA,{id:"discussion.stepper.markAllAsRead",defaultMessage:"Mark all as read"})}),(0,p.jsx)(d().A,{style:g.chevronButton,icon:a().E,ariaLabel:m.formatMessage({id:"discussion.stepper.previousUnread",defaultMessage:"Previous unread discussion"}),onClick:n}),(0,p.jsx)(d().A,{style:g.chevronButton,icon:r().arrowChevronSingleDownFillIcon,ariaLabel:m.formatMessage({id:"discussion.stepper.nextUnread",defaultMessage:"Next unread discussion"}),onClick:u})]})}const h=s.memo(g),x=s.memo(f)},798995:(e,o,t)=>{t.d(o,{A:()=>h});t(581454),t(296540);var s=()=>t(484714),n=()=>t(56366),i=()=>t(401497),r=()=>t(601813),a=()=>t(797809),l=()=>t(220719),c=()=>t(959013),d=()=>t(284371),u=()=>t(719147),m=()=>t(447587),p=()=>t(712030),g=()=>t(921855),f=t(474848);function h(e){const{discussionStore:o}=e,t=(0,c().tz)(),s=(0,n().K8)((()=>o.isSuggestionDiscussion()),[o]),p=(0,n().K8)((()=>{const o=e.discussionStore.getContext();return(o?(0,r().Qe)({discussionContextData:o,discussionId:e.discussionStore.id,discussionType:(0,l().o9)(e.discussionStore.getType()),intl:t}):[])??[]}),[e.discussionStore,t]),g=(0,i().IS)((e=>({container:{marginTop:2},label:{color:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},labelDeleteColor:{color:e.text.tertiary},text:{color:e.text.uiBluePrimary,fontSize:14,lineHeight:1.29},textDeleteColor:{color:e.text.secondary},suggestionContextItem:{display:"block",marginBottom:4,whiteSpace:"pre-wrap",wordBreak:"break-word"},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:d().Wy.medium,display:"block",marginBottom:-1.5,pointerEvents:"auto"}})),[]),h=(0,a().RX)(t).title;return s&&h&&0!==p.length?(0,f.jsx)("div",{style:g.container,children:(0,f.jsx)(m().A,{maxLines:e.collapsed?1:void 0,clampOverride:{lineHeight:1.29,fontSize:14},moreElement:(0,f.jsxs)(u().A,{disableUnderline:!0,style:g.unfurlMoreWrapper,hoverColor:"blue",children:["â€¦","Â ",(0,f.jsx)("span",{children:(0,f.jsx)(c().sA,{id:"suggestion.truncated.showMoreLabel",defaultMessage:"more"})})]}),children:p.map(((e,t)=>{let{label:s,value:n,shouldUseDeleteColor:i,removeQuotationMarks:r}=e;return(0,f.jsxs)("div",{style:g.suggestionContextItem,children:[(0,f.jsxs)("span",{style:{...g.label,...i&&g.labelDeleteColor},children:[s,": "]}),(0,f.jsxs)("span",{style:{...g.text,...i&&g.textDeleteColor},children:[r?null:"â€œ",(0,f.jsx)(x,{value:n,discussionStore:o}),r?null:"â€"]})]},t)}))})}):null}function x(e){let{value:o,discussionStore:t}=e;const r=(0,s().v3)(),a=(0,i().DP)(),l=(0,n().K8)((()=>(0,g().S5)({environment:r,textValue:{value:o,spaceId:t.pointer.spaceId},parentStore:t,disableHover:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!0,disabled:!0,theme:a,emojiType:(0,p().FN)(r),katex:r.KatexStore.getKatex(),formulaValueTypes:[]})),[r,o,t,a]);return(0,f.jsx)("span",{children:l})}},970464:(e,o,t)=>{t.d(o,{p:()=>u});t(898992),t(672577),t(803949);var s=t(296540),n=()=>t(484714),i=()=>t(56366),r=()=>t(112873),a=()=>t(751156),l=()=>t(372154),c=()=>t(725332),d=()=>t(300857);function u(e){const{discussionStore:o,pageSortedDiscussions:t,pageSortedUnreadDiscussions:u,isDiscussionSelected:m}=e,p=(0,n().v3)(),g=(0,i().K8)((()=>u.length),[u]),f=(0,i().K8)((()=>o?u.findIndex((e=>e.id===o.id))+1:1),[o,u]),h=(0,i().K8)((()=>l().A.getFramePageFirstSelectedDiscussionId()),[]),x=(0,i().K8)((()=>(1===f&&void 0===h||m)&&u.length>0),[f,h,m,u]),v=(0,s.useCallback)((()=>{a().createAndCommit({userAction:"DiscussionStepper.markAllAsRead",environment:p,canUndo:!0,perform:e=>{u.forEach((o=>{(0,c().U)({transaction:e,discussionStore:o})}))}})}),[p,u]),S=(0,s.useCallback)((async()=>{if(!h&&!o){const e=t.find((e=>e.isUnread(void 0)));if(!e)return;const o=e.getParentStore();if(!o)return;return(0,d().b)({discussionId:e.id,blockId:o.id,environment:p,animate:!0}),void(await r().B4({environment:p,blockStore:o,discussionIds:[e.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}const e=t.findIndex((e=>e.id===((null==o?void 0:o.id)??h)));if(-1===e)return;const s=t.slice(e+1).find((e=>e.isUnread(void 0)))||t.slice(0,e).find((e=>e.isUnread(void 0)));if(!s)return;const n=s.getParentStore();n&&((0,d().b)({discussionId:s.id,blockId:n.id,environment:p,animate:!0}),await r().B4({environment:p,blockStore:n,discussionIds:[s.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[h,o,p,t]),b=(0,s.useCallback)((async()=>{if(!h&&!o){const e=[...t].reverse().find((e=>e.isUnread(void 0)));if(!e)return;const o=e.getParentStore();if(!o)return;return(0,d().b)({discussionId:e.id,blockId:o.id,environment:p,animate:!0}),void(await r().B4({environment:p,blockStore:o,discussionIds:[e.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}const e=t.findIndex((e=>e.id===((null==o?void 0:o.id)??h)));if(-1===e)return;const s=t.slice(0,e).reverse().find((e=>e.isUnread(void 0)))||t.slice(e+1).reverse().find((e=>e.isUnread(void 0)));if(!s)return;const n=s.getParentStore();n&&((0,d().b)({discussionId:s.id,blockId:n.id,environment:p,animate:!0}),await r().B4({environment:p,blockStore:n,discussionIds:[s.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[h,o,p,t]);return{discussionCount:g,currentPosition:f,currentlySelectedDiscussionId:h,isStepperVisible:x,handleMarkAllAsRead:v,handleStepToNextDiscussion:S,handleStepToPreviousDiscussion:b}}}}]);