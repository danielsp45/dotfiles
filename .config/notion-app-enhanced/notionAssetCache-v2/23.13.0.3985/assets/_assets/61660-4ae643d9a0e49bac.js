"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[61660],{761660:(e,o,t)=>{t.d(o,{J:()=>X});t(16280),t(581454);var a=t(296540),n=()=>t(484714),i=()=>t(56366),d=()=>t(401497),r=()=>t(728396),l=()=>t(251822),s=()=>t(145214),u=()=>t(439264),g=()=>t(218557),m=()=>t(953418),c=()=>t(170253),p=()=>t(978846),v=()=>t(970176),y=()=>t(316397),b=()=>t(933951),h=(t(18107),t(967357),t(898992),t(354520),()=>t(72645)),M=()=>t(155185),f=()=>t(959013),_=()=>t(285790),A=()=>t(859428),w=()=>t(38337),T=()=>t(104129),I=()=>t(962730),x=()=>t(160241),B=()=>t(3197),S=()=>t(937199),L=t(474848);const C=(0,f().YK)({formLayoutAddModule:{id:"addModuleHoverMenu.formLayout.add",defaultMessage:"Add question"},pageLayoutAddModule:{id:"addModuleHoverMenu.pageLayout.add",defaultMessage:"Add"}}),D=32;function k(e){if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");const o=(0,f().tz)(),{layoutStore:t,addModuleHoverMenuStore:a,currentModuleSelection:n}=(0,S().LH)(),r=(0,i().K8)((()=>{if(a.state.isOpen)return a.state.moduleId}),[a]),l=(0,i().K8)((()=>{if(!r)return;const e=T().A.findModuleContainer({layoutStore:t,moduleId:r});return e?e.getNode():void 0}),[r,t]),u=(0,i().K8)((()=>{if(!n||"new_module"===n.type)return!1;const e=t.getModuleById(n.moduleId);return"placeholder"===(null==e?void 0:e.type)}),[n,t]),g=(0,i().K8)((()=>{var o;if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");if("form_conditional_modules"===e.area)return!1;const n=t.getModules()[e.area].filter((e=>(0,M()._)(e))),i=0===n.length||(null===(o=n.at(-1))||void 0===o?void 0:o.id)===r;return a.state.isOpen&&!u&&!i}),[a,r,u,t,e.area]),m=(0,B().t)({area:e.area,afterModuleId:r}),c=(0,x().d)(),p=(0,d().IS)((e=>({bigRoundButton:{...c.button,width:D,height:D,borderTopLeftRadius:"100%",borderTopRightRadius:"100%",borderBottomLeftRadius:"100%",transform:"rotate(-45deg)"},bigRoundButtonHovered:{...c.buttonHovered},bigRoundButtonPressed:{...c.buttonPressed}})),[c]),v="form"===(0,i().K8)((()=>{var e;return null===(e=t.getModel())||void 0===e?void 0:e.getLayoutType()}),[t])?o.formatMessage(C.formLayoutAddModule):o.formatMessage(C.pageLayoutAddModule),y=l?l.offsetLeft-40:void 0,b=l?l.offsetTop+l.offsetHeight-4:void 0;return void 0===y||void 0===b?null:(0,L.jsx)(s().A,{visible:g,animate:{opacity:1,scale:1,transformOrigin:"center right"},initial:{opacity:0,scale:.3,transformOrigin:"center right"},exit:{opacity:0,scale:.3,transformOrigin:"center right"},style:{position:"absolute",left:y,top:b},children:(0,L.jsx)(A().A,{placement:I().W.Left,renderTooltip:()=>v,render:e=>(0,L.jsx)(_().A,{...e,style:p.bigRoundButton,hoveredStyle:p.bigRoundButtonHovered,className:w().kew,pressedStyle:p.bigRoundButtonPressed,onClick:m,icon:h().b,iconStyle:{width:16,height:16,transform:"rotate(45deg)"},color:"uiBluePrimary",ariaLabel:v})})})}var P=()=>t(21140),j=()=>t(612900),R=()=>t(645873);const H={BuilderAddModuleButtonEducationTooltip:new(R().O2)("BuilderAddModuleButtonEducationTooltip",(()=>t.e(63538).then(t.bind(t,889989))))},O=(0,R()._h)(H.BuilderAddModuleButtonEducationTooltip,(e=>e.default));var E=()=>t(817942);const F=(0,f().YK)({addPageModule:{id:"pageLayout.builder.addModuleToPage.button.ariaLabel",defaultMessage:"Add page module"},addQuestionModuleTooltip:{id:"pageLayout.builder.addModuleToPage.button.addQuestionModuleTooltip",defaultMessage:"Add question"},addModuleToPanelButton:{id:"pageLayout.builder.addModuleToPanel.button.label",defaultMessage:"Add to panel"}}),K=a.forwardRef((function(e,o){const{area:a}=e,{layoutStore:n}=(0,S().LH)(),r=(0,i().K8)((()=>n.getLayoutType()),[n]),l=(0,f().tz)(),s=(0,x().d)(),u=(0,d().IS)((e=>({bigRoundButton:{...s.button,width:32,height:32,borderRadius:"100%"},bigRoundButtonHovered:{...s.buttonHovered},bigRoundButtonPressed:{...s.buttonPressed},emptyModuleAreaAddButton:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 16px 8px 12px",fontSize:14,lineHeight:"20px",fontWeight:500,background:"light"===e.mode?e.palette.uiBlue[100]:e.palette.uiBlue[200],color:e.palette.uiBlue[600],borderRadius:28,transition:"background 0.2s"},emptyModuleAreaAddButtonHover:{...s.buttonHovered},emptyModuleAreaAddButtonPressed:{...s.buttonPressed}})),[s]),g=(0,B().t)("views_main_tab_modules"===a?{area:a,viewsMainTabId:e.viewsMainTabId}:{area:a});if("form_conditional_modules"===a)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const m=(0,i().K8)((()=>{var o;const t=n.getModules();return("views_main_tab_modules"===a?(null===(o=t[a])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[a]).length>0}),[n,a,e.viewsMainTabId]);return"page_details"!==a||m?(0,L.jsx)(A().A,{renderTooltip:()=>l.formatMessage(F.addQuestionModuleTooltip),disableTooltip:"form"!==r,placement:I().W.Bottom,render:e=>(0,L.jsx)(_().A,{style:u.bigRoundButton,hoveredStyle:u.bigRoundButtonHovered,pressedStyle:u.bigRoundButtonPressed,onClick:g,icon:h().b,iconStyle:{width:16,height:16},color:"uiBluePrimary",className:w().kew,ariaLabel:l.formatMessage(F.addPageModule),ref:o,...e})}):(0,L.jsxs)(t(197190).A,{style:u.emptyModuleAreaAddButton,onClick:g,hoveredStyle:u.emptyModuleAreaAddButtonHover,pressedStyle:u.emptyModuleAreaAddButtonPressed,ref:o,children:[(0,t(464699).b)({width:12,marginRight:4}),(0,L.jsx)(f().sA,{...F.addModuleToPanelButton})]})})),N=a.memo((function(e){var o;const{shouldShowTooltip:n}=(0,t(384130).J)(),{area:d}=e,r=n&&"page_main"===d,l=n&&"form_layout_schema"!==d,s=a.useRef(null),{currentModuleSelection:u,layoutStore:g,setModuleSelection:m,isPropertyTypeSearchInputDirtyStore:c}=(0,S().LH)(),p=(0,i().K8)((()=>"existing_module"===(null==u?void 0:u.type)?g.getModuleById(u.moduleId):void 0),[u,g]),v=(0,i().K8)((()=>{var o;if("form_conditional_modules"===d)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const t=g.getModules();return("views_main_tab_modules"===d?(null===(o=t[d])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[d]).length>0}),[g,d,e.viewsMainTabId]),[y,b]=a.useState(!1),h=a.useCallback((()=>{c.state||m(void 0)}),[c,m]);return"new_module"===(null==u?void 0:u.type)&&u.area===e.area?(0,L.jsx)(t(545805).A,{onUndo:h,capture:!0,priority:1,debugName:"AddPageLayoutModuleButton",children:(0,L.jsx)(z,{})}):"placeholder"===(null==p?void 0:p.type)?null:r||l?(0,L.jsxs)(P().Ye,{justifyContent:"center",style:null===(M=e.styles)||void 0===M?void 0:M.buttonContainer,className:E().hg,children:[(0,L.jsx)(j().u,{shape:"page_main"===e.area?"circle":"pill",size:"page_main"===e.area||v?32:34,onDependencyLoaded:()=>b(!0),children:(0,L.jsx)(K,{isEducationCalloutVisible:r,...e,ref:s})}),r&&y&&(0,L.jsx)(O,{buttonRef:s})]}):(0,L.jsx)(P().Ye,{justifyContent:"center",style:null===(o=e.styles)||void 0===o?void 0:o.buttonContainer,className:E().hg,children:(0,L.jsx)(K,{isEducationCalloutVisible:!1,ref:s,...e})});var M}));function z(){const e=(0,d().IS)((e=>({ghostPageModuleContainer:{paddingBottom:12},ghostPageModule:{width:"100%",height:160,background:e.palette.uiBlue[75],borderRadius:12,boxShadow:`0px 0px 0px 0px ${e.stroke.uiBlueSecondary}, inset 0px 0px 0px 1px ${e.stroke.uiBlueSecondary}`}})),[]);return(0,L.jsx)("div",{style:e.ghostPageModuleContainer,className:E().hg,children:(0,L.jsx)(j().u,{shape:"square",borderRadius:e.ghostPageModule.borderRadius,width:e.ghostPageModule.width,height:e.ghostPageModule.height,children:(0,L.jsx)("div",{style:e.ghostPageModule})})})}var Y=()=>t(496603);const q=12;function V(){const{addModuleHoverMenuStore:e}=(0,S().LH)(),o=(0,y().z)(),t=(0,a.useCallback)((t=>{const a=T().A.getMembersByDOMOrder({filter:e=>"cover"!==e.moduleType&&"form_conditional_modules"!==e.area});let n=null;for(const e of a){const a=e.getNode();if(!a)continue;const i=a.getBoundingClientRect();if(t.clientX>i.right||t.clientX<i.left&&i.left-t.clientX>300)continue;if(t.clientY<=i.bottom&&i.bottom-t.clientY<q||t.clientY>i.bottom&&t.clientY-i.bottom<q+o){n=e;break}}if(n)e.setState({isOpen:!0,moduleId:n.moduleId,menuIsOpen:!1});else{const o=e.getState();o.isOpen&&!o.menuIsOpen&&e.setState({isOpen:!1})}}),[e,o]),n=Y().nF(t,30);return(0,a.useEffect)((()=>(window.addEventListener("mousemove",n),()=>{window.removeEventListener("mousemove",n)})),[n]),null}var Q=()=>t(940186);const W={display:void 0};function X(e){const{area:o}=e;if("form_conditional_modules"===o)throw new Error("[Forms Conditional Logic] Can't render builder layout modules for nested form_conditional_modules directly.");const t=(0,n().v3)(),{sessionId:h,layoutStore:M,currentModuleSelection:f,setModuleSelection:_,canEditLayout:A,layoutBuilderModuleSelectionStore:w}=(0,S().LH)(),T=(0,a.useRef)(null),I=(0,b().ub)({layoutStore:M,pageStoreId:void 0}),x=(0,i().K8)((()=>M.isTabbedPageLayout()),[M]),B=(0,y().z)(),{nonMoveableHeaderModules:C,moveableModules:D,nonMoveableFooterModules:P}=(0,i().K8)((()=>{var t;const a="views_main_tab_modules"===o?(null===(t=I[o])||void 0===t?void 0:t[null==e?void 0:e.viewsMainTabId])||[]:I[o];return(0,l().jS)(o,a)}),[o,I,null==e?void 0:e.viewsMainTabId],{useDeepEqual:!0}),j=(0,i().K8)((()=>{const e=w.state;if(null!=e&&e.isDragging){const t=e.draggingModuleInitialArea,a=e.draggingModuleFinalArea;return{isDraggingIntoThisArea:t.area!==o&&a.area===o,isDraggingFromThisAreaToOtherArea:t.area===o&&a.area!==o,isDraggingAnyModuleList:!0,dragArea:a}}return{isDraggingIntoThisArea:!1,isDraggingFromThisAreaToOtherArea:!1,isDraggingAnyModuleList:!1,dragArea:void 0}}),[o,w]),R=(0,a.useMemo)((()=>D.map((e=>"form_layout_schema"===o?{key:e.id,draggable:"placeholder"!==e.type}:{key:e.id,draggable:!0}))),[o,D]),H=(0,a.useMemo)((()=>new(c().A)),[]),O=(0,i().K8)((()=>H.state.isDragging),[H]),F=(0,i().K8)((()=>{var e;return null===(e=M.getModel())||void 0===e?void 0:e.getLayoutType()}),[M]);(0,a.useEffect)((()=>{T.current&&j.isDraggingIntoThisArea&&(0,m().$v)({element:T.current,environment:t,additionalPadding:{top:200,bottom:200}})}),[j.isDraggingIntoThisArea,t]);const K=(0,a.useCallback)((t=>{const a="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewsMainTabId:e.viewsMainTabId}:{area:o};_({type:"existing_module",moduleId:t,isDragging:!0,draggingModuleInitialArea:a,draggingModuleFinalArea:a})}),[o,e.viewsMainTabId,_]),z=(0,a.useCallback)((e=>{e&&_({type:"existing_module",moduleId:e,isDragging:!1})}),[_]),Y=(0,a.useCallback)((()=>{const e=w.state,o=M.getLayoutType();o&&(0,r().Hc)(o)?_(void 0):null!=e&&e.isDragging&&w.setState({...e,isDragging:!1,draggingModuleInitialArea:void 0,draggingModuleFinalArea:void 0})}),[w,_,M]),q=(0,a.useCallback)((e=>{const a=w.state,n=null!=a&&a.isDragging?a.draggingModuleFinalArea:void 0;"form_conditional_modules"!==(null==n?void 0:n.area)&&(null!=e&&e.key&&n&&n.area!==o&&((0,p().E)({environment:t,position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===n.area?{area:n.area,viewId:n.viewsMainTabId}:{area:n.area}},moduleId:e.key,layoutStore:M,sessionId:h}),(0,v().z)({moduleId:e.key,layoutStore:M,environment:t})),Y())}),[w,o,Y,t,M,h]),X=(0,a.useCallback)(((a,n)=>{let{key:i,endPosition:d,startPosition:r}=n;if(j.isDraggingFromThisAreaToOtherArea)return;const l=C.length,s="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewId:e.viewsMainTabId}:{area:o};(0,p().E)({environment:t,layoutStore:M,position:{type:"absolute",index:l+d,...s},moduleId:i,sessionId:h}),(0,v().z)({moduleId:i,layoutStore:M,environment:t})}),[j.isDraggingFromThisAreaToOtherArea,C.length,o,e.viewsMainTabId,t,M,h]),$=(0,d().IS)((e=>({draggableList:{display:"flex",flexDirection:"column",gap:B,marginBottom:B},addButtonContainer:{paddingTop:"page_in_collection"===F?8:0,marginBottom:"form"===F?0:12,width:"100%"},dropzoneHalo:{background:g().to,height:g().NZ,marginTop:-g().NZ},hiddenModuleStyle:{display:"none"}})),[B,F]),J=(0,a.useCallback)((e=>{const t="existing_module"===(null==f?void 0:f.type)&&f.moduleId===e,a=t&&O;return(0,L.jsx)(Q().n,{active:t,pageModuleId:e,isDragging:a,area:o,style:a&&j.isDraggingFromThisAreaToOtherArea?$.hiddenModuleStyle:void 0},e)}),[j.isDraggingFromThisAreaToOtherArea,f,O,$.hiddenModuleStyle,o]),Z=(0,a.useMemo)((()=>C.length?C.map((e=>J(e.id))):null),[C,J]),U=(0,a.useMemo)((()=>P.length?P.map((e=>J(e.id))):null),[P,J]),G=(0,a.useMemo)((()=>({enter:{opacity:0},animate:{opacity:1},exit:{opacity:0}})),[]),ee=(0,a.useMemo)((()=>({buttonContainer:$.addButtonContainer})),[$.addButtonContainer]);if(!M)return null;let oe;return oe=!!A&&(!x||("views_main_tab_modules"===o||"page_details"===o)),(0,L.jsxs)(L.Fragment,{children:[Z,Boolean(R.length)&&(0,L.jsx)(u().Ay,{forceDragKeyIndex:j.isDraggingFromThisAreaToOtherArea?R.length-1:void 0,className:E().hg,store:H,keys:R,direction:"vertical",onDraggingKeyChanged:K,onDrop:X,onDragCancel:Y,onDragEnd:q,onClick:z,style:$.draggableList,draggingStyle:W,draggingStyleForNonDraggedItems:W,renderKey:J,disabled:!A,...x?{}:{hoverCursorStyleOverride:j.isDraggingAnyModuleList?"grabbing":void 0}}),(0,L.jsx)(s().A,{visible:j.isDraggingIntoThisArea,initial:G.enter,animate:G.animate,exit:G.exit,skip:!j.isDraggingAnyModuleList,className:"layout-content",ref:T,style:$.dropzoneHalo}),oe&&(0,L.jsx)(N,{...e,styles:ee}),"form"===F&&A&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(V,{}),(0,L.jsx)(k,{area:o})]}),U]})}}}]);