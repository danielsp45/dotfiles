"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[35537],{44907:(e,t,r)=>{r.d(t,{Ps:()=>u,Q7:()=>d,TM:()=>c,_M:()=>f,p8:()=>l});r(16280),r(269479);var n=()=>r(303151),o=()=>r(496603),s=()=>r(247331),i=()=>r(349835),a=()=>r(977345);const l=o().Bj((()=>function(){const e=(0,n().Ey)({name:"AdditionOperator",pattern:n().JG.NA}),t=(0,n().Ey)({name:"UnaryOperator",pattern:n().JG.NA}),o=(0,n().Ey)({name:"Plus",pattern:/\+/,categories:e}),i=(0,n().Ey)({name:"Minus",pattern:/-/,categories:[e,t]}),l=(0,n().Ey)({name:"ExclamationPoint",pattern:/!/,categories:t}),c=(0,n().Ey)({name:"MultiplicationOperator",pattern:n().JG.NA}),p=(0,n().Ey)({name:"Multi",pattern:/\*/,categories:c}),f=(0,n().Ey)({name:"Div",pattern:/\//,categories:c}),d=(0,n().Ey)({name:"Modulo",pattern:/%/,categories:c}),h=(0,n().Ey)({name:"Caret",pattern:/\^/}),u=(0,n().Ey)({name:"BooleanLiteral",pattern:n().JG.NA}),m=(0,n().Ey)({name:"True",pattern:/true/i,categories:u}),E=(0,n().Ey)({name:"False",pattern:/false/i,categories:u}),y=(0,n().Ey)({name:"And",pattern:/and |&&/i}),O=(0,n().Ey)({name:"Or",pattern:/or |\|\|/i}),x=(0,n().Ey)({name:"Not",pattern:/not /i,categories:t}),v=(0,n().Ey)({name:"RelationalOperator",pattern:n().JG.NA}),k=(0,n().Ey)({name:"LessThan",pattern:/<=?/,categories:v}),L=(0,n().Ey)({name:"GreaterThan",pattern:/>=?/,categories:v}),S=(0,n().Ey)({name:"EqualityOperator",pattern:n().JG.NA}),U=(0,n().Ey)({name:"Equal",pattern:/==/,categories:S}),g=(0,n().Ey)({name:"NotEqual",pattern:/!=/,categories:S}),T=(0,n().Ey)({name:"LParen",pattern:/\(/}),M=(0,n().Ey)({name:"RParen",pattern:/\)/}),A=(0,n().Ey)({name:"LBracket",pattern:/\[/}),P=(0,n().Ey)({name:"RBracket",pattern:/\]/}),N=(0,n().Ey)({name:"Comma",pattern:/,/}),R=(0,n().Ey)({name:"Dot",pattern:/\./}),C=(0,n().Ey)({name:"QuestionMark",pattern:/\?/}),I=(0,n().Ey)({name:"Colon",pattern:/:/}),B=(0,n().Ey)({name:"StringLiteral",pattern:/"(?:[^\\"]|\\.)*"/,start_chars_hint:['"']}),b=(0,n().Ey)({name:"UnclosedStringLiteral",pattern:/"(?:[^\\"]|\\.)*/,start_chars_hint:['"']}),F=(0,n().Ey)({name:"NumberLiteral",pattern:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),_=(0,n().Ey)({name:"Comment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:n().JG.SKIPPED,start_chars_hint:["/*"]}),w=(0,n().Ey)({name:"UnclosedComment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:n().JG.SKIPPED,start_chars_hint:["/*"]}),q=(0,n().Ey)({name:"InputToken",pattern:{exec:(e,t)=>{if(!e.startsWith(s().FORMULA_TOKEN_PREFIX,t))return null;const n=e.substring(t),o=s().tokenBlockPropertyOptionalCollectionPattern.exec(n);if(null!==o){const e=[o[0]],t=(0,a().QE)(o[1]);let n;if(void 0!==o[2])n={type:s().FormulaTokenType.BlockProperty,property:t,collection:{table:r(519831).Vl,id:o[3],spaceId:o[4]}};else{if(!s().FormulaTokenSupportedBlockSystemPropertyList.includes(t))return null;n={type:s().FormulaTokenType.BlockProperty,property:t,collection:void 0}}return e.payload=n,e}const i=s().tokenBlockPropertyContextValueIdPattern.exec(n);if(null!==i){const e=[i[0]],t=(0,a().QE)(i[1]),r=(0,a().A$)(i[2]),n=(0,a().e2)(e[3]),o={contextValueId:r,property:t,type:s().FormulaTokenType.BlockProperty,valueSnapshot:n};return e.payload=o,e}const l=s().tokenBlockPattern.exec(n);if(null!==l){const e=[l[0]],t={type:s().FormulaTokenType.Block,blockId:l[1],spaceId:void 0!==l[2]?l[2].substring(1):void 0};return e.payload=t,e}const c=s().tokenPersonPattern.exec(n);if(null!==c){const e=[c[0]],t={type:s().FormulaTokenType.Person,userId:c[1]};return e.payload=t,e}const p=s().tokenCheckboxPattern.exec(n);if(null!==p){const e=[p[0]],t={type:s().FormulaTokenType.Checkbox,checked:"true"===p[1]};return e.payload=t,e}const f=s().tokenContextValuePattern.exec(n);if(null!==f){const e=[f[0]],t=(0,a().A$)(f[1]),r={type:s().FormulaTokenType.ContextValue,valueId:t};return e.payload=r,e}const d=s().tokenDatePattern.exec(n);if(null!==d){const e=[d[0]],t={type:s().FormulaTokenType.Date,date:(0,a().P_)(d[1])};return e.payload=t,e}return null}},line_breaks:!1,start_chars_hint:[s().FORMULA_TOKEN_PREFIX]}),G=(0,n().Ey)({name:"IdentifierName",pattern:(D=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const r=new RegExp(D.source,`${D.flags}y`);return r.lastIndex=t,r.exec(e)}),line_breaks:!1});var D;return{WhiteSpace:(0,n().Ey)({name:"WhiteSpace",pattern:/\s+/,group:n().JG.SKIPPED}),NumberLiteral:F,StringLiteral:B,UnclosedStringLiteral:b,Comment:_,UnclosedComment:w,InputToken:q,True:m,False:E,And:y,Or:O,Not:x,IdentifierName:G,Equal:U,NotEqual:g,Plus:o,Minus:i,ExclamationPoint:l,Multi:p,Div:f,Modulo:d,Caret:h,LParen:T,RParen:M,LBracket:A,RBracket:P,AdditionOperator:e,MultiplicationOperator:c,LessThan:k,GreaterThan:L,QuestionMark:C,Colon:I,Comma:N,Dot:R,UnaryOperator:t,EqualityOperator:S,RelationalOperator:v,BooleanLiteral:u}}()));const c=o().Bj((e=>new(n().JG)(function(e){return Object.values(e)}(e))));class p extends n().cA{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this.formulaTokens=void 0,this.c1=void 0,this.expression=this.RULE("expression",(()=>{this.SUBRULE(this.conditionalExpression)})),this.primaryExpression=this.RULE("primaryExpression",(()=>{this.OR(this.c1||(this.c1=[{ALT:()=>this.SUBRULE(this.parenthesisExpression)},{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.CONSUME(this.formulaTokens.NumberLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.StringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.UnclosedStringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.BooleanLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}]))})),this.conditionalExpression=this.RULE("conditionalExpression",(()=>{this.SUBRULE(this.logicalOrExpression,{LABEL:"condition"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.QuestionMark),this.SUBRULE2(this.logicalOrExpression,{LABEL:"expIfTrue"}),this.CONSUME(this.formulaTokens.Colon),this.SUBRULE3(this.logicalOrExpression,{LABEL:"expIfFalse"})}))})),this.logicalOrExpression=this.RULE("logicalOrExpression",(()=>{this.SUBRULE(this.logicalAndExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Or),this.SUBRULE2(this.logicalAndExpression,{LABEL:"rhs"})}))})),this.logicalAndExpression=this.RULE("logicalAndExpression",(()=>{this.SUBRULE(this.equalityExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.And),this.SUBRULE2(this.equalityExpression,{LABEL:"rhs"})}))})),this.equalityExpression=this.RULE("equalityExpression",(()=>{this.SUBRULE(this.relationalExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.EqualityOperator),this.SUBRULE2(this.relationalExpression,{LABEL:"rhs"})}))})),this.relationalExpression=this.RULE("relationalExpression",(()=>{this.SUBRULE(this.additionExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.RelationalOperator),this.SUBRULE2(this.additionExpression,{LABEL:"rhs"})}))})),this.additionExpression=this.RULE("additionExpression",(()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.AdditionOperator),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})}))})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{this.SUBRULE(this.exponentiationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.MultiplicationOperator),this.SUBRULE2(this.exponentiationExpression,{LABEL:"rhs"})}))})),this.exponentiationExpression=this.RULE("exponentiationExpression",(()=>{this.SUBRULE(this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Caret),this.SUBRULE2(this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this.CONSUME(this.formulaTokens.UnaryOperator)})),this.SUBRULE(this.primaryExpression),this.MANY((()=>{this.SUBRULE2(this.memberCallSubExpression)}))})),this.memberCallSubExpression=this.RULE("memberCallSubExpression",(()=>{this.OR([{ALT:()=>this.SUBRULE(this.dotMemberExpression)},{ALT:()=>this.SUBRULE(this.callArguments)}])})),this.dotMemberExpression=this.RULE("dotMemberExpression",(()=>{this.CONSUME(this.formulaTokens.Dot),this.OR([{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{GATE:()=>{var e;const t=this.LA(1);return t.tokenType===this.formulaTokens.InputToken&&(null===(e=t.payload)||void 0===e?void 0:e.type)===s().FormulaTokenType.BlockProperty},ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}])})),this.callArguments=this.RULE("callArguments",(()=>{this.CONSUME(this.formulaTokens.LParen),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RParen)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{this.CONSUME(this.formulaTokens.LParen),this.SUBRULE(this.expression),this.CONSUME(this.formulaTokens.RParen)})),this.arrayExpression=this.RULE("arrayExpression",(()=>{this.CONSUME(this.formulaTokens.LBracket),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RBracket)})),this.formulaTokens=e,this.performSelfAnalysis()}}const f=o().Bj((e=>new p(e)));function d(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e.message);if(null!==t)return{type:i().M9.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e.message)return{type:i().M9.UnclosedStringLiteral,offset:e.offset};if("unclosed comment"===e.message)return{type:i().M9.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e.message}`)}const h={RParen:")",RBracket:"]",Colon:":"};function u(e){const t=e.token.tokenType===n().LT?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const r=/Expecting token of type --> (.+) <-- but found/.exec(e.message);if(null!==r){const e=r[1],n=h[e];if(void 0!==n)return{type:i().M9.TokenExpected,token:n,offset:t}}break}case"NoViableAltException":{const r=e.context.ruleStack[e.context.ruleStack.length-1];switch(r){case"primaryExpression":return{type:i().M9.ExpressionExpected,offset:t};case"dotMemberExpression":return{type:i().M9.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${r}`)}case"NotAllInputParsedException":return{type:i().M9.EndOfInputExpected,offset:t}}return{type:i().M9.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}},373907:(e,t,r)=>{r.d(t,{$t:()=>m,BC:()=>u,nM:()=>d,tP:()=>p});r(16280),r(944114),r(898992),r(354520);var n=()=>r(534177),o=()=>r(857639),s=()=>r(958970),i=()=>r(247331),a=()=>r(106714),l=()=>r(44907),c=()=>r(349835);function p(e,t){const r=(0,l().p8)(),n=(0,l().TM)(r).tokenize(e),s=[];for(const o of n.errors)s.push((0,l().Q7)(o));for(const o of n.tokens.filter((e=>e.tokenType===r.UnclosedStringLiteral||e.tokenType===r.UnclosedComment)))s.push({type:o.tokenType===r.UnclosedStringLiteral?c().M9.UnclosedStringLiteral:c().M9.UnclosedComment,offset:t?(0,a().c3)(t,o.startOffset,"left"):o.startOffset});for(const o of n.tokens.filter((e=>e.tokenType===r.StringLiteral)))i().FORMULA_TOKEN_REGEX.test(o.image)&&s.push({type:c().M9.StringLiteralContainsToken,offset:t?(0,a().c3)(t,o.startOffset,"left"):o.startOffset});try{const e=(0,l()._M)(r);e.input=n.tokens;const t=e.expression();for(const r of e.errors)s.push((0,l().Ps)(r));return[t,s]}catch(p){if(p instanceof RangeError&&"Maximum call stack size exceeded"===p.message)s.push({type:c().M9.TooDeeplyNested,offset:0});else{const e=p instanceof Error?p:new Error("Unknown parsing error");o().log({level:"error",from:"parseFormulaInputToCst",type:"formulaParserUnexpectedError",error:e}),s.push({type:c().M9.UnexpectedError,offset:0,error:e})}return[{name:"",children:{}},s]}}const f=new WeakMap;class d{constructor(){this.debug=!1}logCacheResult(e,t){this.incrMetric(t?"formulas.parsing.weak_map_cache.hit":"formulas.parsing.weak_map_cache.miss")}incrMetric(e){this.debug&&console.log(e),this.incrMetricImpl(e)}}let h;function u(e){h||(h=e())}function m(e){var t;let r=f.get(e);if(null===(t=h)||void 0===t||t.logCacheResult(e,(0,n().O9)(r)),void 0!==r)return r;const[o,i]=(0,a().kb)(e),[l,c]=p(o);return r=c.length>0?{error:c[0]}:(0,s().f)(l),f.set(e,r),r}},871202:(e,t,r)=>{r.r(t),r.d(t,{hasAccessDefaultFn:()=>O,hasAccessToCode:()=>L,hasAccessToProperty:()=>k,hasReadPermissionsAccess:()=>x,hasSameSpaceAccess:()=>v,testOnly:()=>S});r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520);var n=()=>r(496603),o=()=>r(763824),s=()=>r(973647),i=()=>r(534177),a=()=>r(970013),l=()=>r(247331),c=()=>r(443881),p=()=>r(977345),f=()=>r(501053),d=()=>r(373907);function*h(e){const{collectionPointer:t,context:r,propertyId:n,propertySchema:o,visitedPointers:s,hasAccessFn:i}=e,a=(0,c().G7)({...t,propertyId:n});if(s.has(a))return!0;s.add(a);const l=i({propertySchema:o,spaceId:r.spaceId});return"boolean"==typeof l?l:yield*l}function*u(e){var t,r;const{collectionPointer:o,depth:f,collectionSchema:h,context:u,propertyId:m,propertySchema:E,visitedPointers:O,hasAccessFn:x}=e;if("v2"!==E.version||f>l().FORMULA_MAX_DEPTH)return!1;const v=(0,c().G7)({...o,propertyId:m});if(O.has(v))return!0;if(O.add(v),!(0,i().O9)(null===(t=E.formula2)||void 0===t?void 0:t.code))return!0;const k=(0,d().$t)(null===(r=E.formula2)||void 0===r?void 0:r.code);if(s().Q.isFail(k))return!0;const{spaceId:L}=u,S=(0,c().zm)({formulaTypecheckContextValues:[{kind:l().FormulaContextValueKind.ThisRow,type:{collection:o,type:"block"}}],node:k.value,spaceId:L}),U=(0,n().hS)(S,(e=>(0,c().G7)(e)));if(0===U.length)return!0;const{getRecordModel:g}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:o,property:m,schema:h}],recordPointers:U.filter((e=>(0,p().T3)(e)))};for(const n of U)if((0,a().pq)(n)){const e=g(n);if(!(0,i().O9)(e))return!1;const t=n.propertyId,r=e.getSchema(),o=r[t];if(!o)continue;if((0,a().bT)(o)||(0,a().lb)(o)){if(!(yield*y({collectionPointer:n,collectionSchema:r,context:u,depth:f+1,propertyId:t,propertySchema:o,visitedPointers:O,hasAccessFn:x})))return!1}else if((0,a().nC)(o)){if(!(yield*y({collectionPointer:n,collectionSchema:r,context:u,depth:f,propertyId:t,propertySchema:o,visitedPointers:O,hasAccessFn:x})))return!1}}else if(!(0,i().O9)(g(n)))return!1;return!0}function*m(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:p,hasAccessFn:d}=e;if("v2"===i.version||r>l().FORMULA_MAX_DEPTH)return!1;const h=(0,c().G7)({...t,propertyId:s});if(p.has(h))return!0;p.add(h);const u=(0,f().kh)(i.formula);if(0===u.length)return!0;for(const l of u){const e=n[l];if(e)if((0,a().bT)(e)||(0,a().lb)(e)){if(!(yield*y({collectionPointer:t,depth:r+1,collectionSchema:n,context:o,propertyId:l,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}else if((0,a().nC)(e)){if(!(yield*y({collectionPointer:t,collectionSchema:n,context:o,depth:r,propertyId:l,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}}return!0}function*E(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:p,hasAccessFn:f}=e;if(r>l().FORMULA_MAX_DEPTH)return!1;const d=(0,c().G7)({...t,propertyId:s});if(p.has(d))return!0;if(p.add(d),!i.relation_property||!i.target_property)return!0;const h=n[i.relation_property];if(!h||"relation"!==h.type)return!0;const u=f({propertySchema:h,spaceId:o.spaceId});if(!("boolean"==typeof u?u:yield*u))return!1;const m=(0,a().Nv)(h);if(!m)return!0;const{getRecordModel:E}=yield{recordPointers:[m]},O=E(m),x=null==O?void 0:O.getNormalizedSchema();if(i.target_property_type&&x){const e=x[i.target_property];if(e&&i.target_property_type===e.type){if((0,a().lb)(e))return yield*y({collectionPointer:m,collectionSchema:x,context:o,depth:r+1,propertyId:i.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:f});if((0,a().nC)(e))return yield*y({collectionPointer:m,collectionSchema:x,context:o,depth:r,propertyId:i.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:f})}}return!0}function*y(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}=e;return(0,a().nC)(i)?yield*h({collectionPointer:t,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):(0,a().lb)(i)?"v2"===i.version?yield*u({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):yield*m({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):!(0,a().bT)(i)||(yield*E({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}))}function*O(e){const{propertySchema:t,spaceId:r}=e,n=(0,a().Nv)(t);if(!(0,i().O9)(n))return!0;const{getRecordModel:o}=yield{recordPointers:[n]},s=o(n);return(0,i().O9)(s)&&v({spaceId:r,propertySchema:t})}function*x(e){const{propertySchema:t}=e,r=(0,a().Nv)(t);if(!(0,i().O9)(r))return!0;const{getRecordModel:n}=yield{recordPointers:[r]},o=n(r);return(0,i().O9)(o)}function v(e){const{propertySchema:t,spaceId:r}=e;return!(0,a().o2)(r,t)}async function k(e){const{collectionPointer:t,collectionSchema:r,context:n,propertyId:s,hasAccessFn:i}=e,a=r[s];return!a||await async function(e){const{context:t}=e;try{const r=y(e);let n=r.next();for(;!n.done;){const e=t.handleDataRequest(n.value);n=r.next((0,o().yL)(e)?await e:e)}return n.value}catch(r){return!0}}({collectionPointer:t,depth:0,collectionSchema:r,context:n,propertyId:s,propertySchema:a,visitedPointers:new Set,hasAccessFn:i})}function L(e){const{context:t}=e;try{const r=function*(e){const{collectionPointer:t,depth:r,context:o,code:f,visitedPointers:h,hasAccessFn:u}=e,m=(0,d().$t)(f);if(s().Q.isFail(m))return!0;const{spaceId:E}=o,O=o.valueTypes.filter((e=>e.kind!==l().FormulaContextValueKind.ThisRow)),x=(0,c().zm)({formulaTypecheckContextValues:t?[...O,{kind:l().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:m.value,spaceId:E}),v=(0,n().hS)(x,(e=>(0,c().G7)(e)));if(0===v.length)return!0;const{getRecordModel:k}=yield{collectionBlockProperties:[],recordPointers:v.filter((e=>(0,p().T3)(e)))};for(const n of v)if((0,a().pq)(n)){const e=k(n);if(!(0,i().O9)(e))return!1;const t=n.propertyId,s=e.getSchema(),l=s[t];if(!l)continue;if((0,a().bT)(l)||(0,a().lb)(l)){if(!(yield*y({collectionPointer:n,collectionSchema:s,context:o,depth:r+1,propertyId:t,propertySchema:l,visitedPointers:h,hasAccessFn:u})))return!1}else if((0,a().nC)(l)&&!(yield*y({collectionPointer:n,collectionSchema:s,context:o,depth:r,propertyId:t,propertySchema:l,visitedPointers:h,hasAccessFn:u})))return!1}else if(!(0,i().O9)(k(n)))return!1;return!0}(e);let o=r.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=r.next(e)}return o.value}catch(r){return!0}}const S={hasAccessDefaultFn:O,hasAccessToProperty:k,hasAccessToFormula1Property:m,hasAccessToFormula2Property:u,hasAccessToRelationProperty:h,hasAccessToRollupProperty:E}},958970:(e,t,r)=>{r.d(t,{f:()=>p});r(16280),r(898992),r(672577),r(581454);var n=()=>r(319625),o=()=>r(247331),s=()=>r(44907),i=()=>r(349835),a=()=>r(977345);const l=new RegExp(/\\([\\nt"])/g);function c(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function p(e){const t=function(){const e=(0,s().p8)(),t=(0,s()._M)(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}expression(e){return this.visit(e.conditionalExpression)}primaryExpression(e){if(void 0!==e.parenthesisExpression)return this.visit(e.parenthesisExpression);if(void 0!==e.arrayExpression)return this.visit(e.arrayExpression);if(void 0!==e.NumberLiteral)return{kind:i().NM.Number,text:e.NumberLiteral[0].image,startOffset:e.NumberLiteral[0].startOffset,endOffset:e.NumberLiteral[0].endOffset};if(void 0!==e.StringLiteral){const t=e.StringLiteral[0].image.slice(1,-1).replace(l,((e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";default:return t}}));return{kind:i().NM.String,text:t,startOffset:e.StringLiteral[0].startOffset,endOffset:e.StringLiteral[0].endOffset}}return void 0!==e.UnclosedStringLiteral?{kind:i().NM.String,text:e.UnclosedStringLiteral[0].image.substring(1,e.UnclosedStringLiteral[0].image.length),startOffset:e.UnclosedStringLiteral[0].startOffset,endOffset:e.UnclosedStringLiteral[0].endOffset}:void 0!==e.BooleanLiteral?{kind:i().NM.Boolean,text:e.BooleanLiteral[0].image,startOffset:e.BooleanLiteral[0].startOffset,endOffset:e.BooleanLiteral[0].endOffset}:void 0!==e.InputToken?{kind:i().NM.NotionToken,token:e.InputToken[0].payload,startOffset:e.InputToken[0].startOffset,endOffset:e.InputToken[0].endOffset}:void 0!==e.IdentifierName?{kind:i().NM.Identifier,text:e.IdentifierName[0].image,startOffset:e.IdentifierName[0].startOffset,endOffset:e.IdentifierName[0].endOffset}:{kind:i().NM.RecoveryNode,startOffset:-1,endOffset:-1}}conditionalExpression(e){const t=this.visit(e.condition[0]);var r,n,o,s;return void 0!==e.QuestionMark?{kind:i().NM.Conditional,condition:t,expIfTrue:this.visit(e.expIfTrue[0]),expIfFalse:void 0!==(null===(r=e.expIfFalse)||void 0===r?void 0:r[0])?this.visit(e.expIfFalse[0]):void 0,startOffset:e.condition[0].location.startOffset,endOffset:c([null===(n=e.expIfFalse)||void 0===n||null===(n=n[0].location)||void 0===n?void 0:n.endOffset,null===(o=e.Colon)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.endOffset,null===(s=e.expIfTrue[0].location)||void 0===s?void 0:s.endOffset,e.QuestionMark[0].endOffset])}:t}logicalOrExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.Or){var r,n;const o=(null===(r=e.rhs)||void 0===r?void 0:r.map((e=>this.visit(e))))??[];return{kind:i().NM.LogicalOr,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(n=e.rhs)||void 0===n||null===(n=n[e.rhs.length-1])||void 0===n||null===(n=n.location)||void 0===n?void 0:n.endOffset,e.Or[0].endOffset])}}return t}logicalAndExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.And){var r,n;const o=(null===(r=e.rhs)||void 0===r?void 0:r.map((e=>this.visit(e))))??[];return{kind:i().NM.LogicalAnd,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(n=e.rhs)||void 0===n||null===(n=n[e.rhs.length-1])||void 0===n||null===(n=n.location)||void 0===n?void 0:n.endOffset,e.And[0].endOffset])}}return t}equalityExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.EqualityOperator){var r;const n=e.rhs[0];return{kind:i().NM.Equality,op:e.EqualityOperator[0].image,lhs:t,rhs:this.visit(n),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=n.location)||void 0===r?void 0:r.endOffset,e.EqualityOperator[0].endOffset])}}return t}relationalExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.RelationalOperator){var r;const n=e.rhs[0];return{kind:i().NM.Relational,op:e.RelationalOperator[0].image,lhs:t,rhs:this.visit(n),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=n.location)||void 0===r?void 0:r.endOffset,e.RelationalOperator[0].endOffset])}}return t}additionExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.AdditionOperator)for(let n=0;n<e.AdditionOperator.length;n++){var r;const o=e.rhs[n];t={kind:i().NM.Additive,op:e.AdditionOperator[n].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=o.location)||void 0===r?void 0:r.endOffset,e.AdditionOperator[n].endOffset])}}return t}multiplicationExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.MultiplicationOperator)for(let n=0;n<e.MultiplicationOperator.length;n++){var r;const o=e.rhs[n];t={kind:i().NM.Multiplicative,op:e.MultiplicationOperator[n].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=o.location)||void 0===r?void 0:r.endOffset,e.MultiplicationOperator[n].endOffset])}}return t}exponentiationExpression(e){let t;const r=this.visit(e.lhs[0]);if(void 0!==e.Caret){var n;const o=e.Caret.length-1;let s,a=null===(n=e.rhs[o].location)||void 0===n?void 0:n.endOffset;(void 0===a||isNaN(a))&&(a=e.Caret[o].endOffset);for(let r=e.Caret.length-1;r>=0;r--){const n=e.rhs[r];t=void 0===s?this.visit(n):{kind:i().NM.Exponentiation,op:s,lhs:this.visit(n),rhs:t,startOffset:n.location.startOffset,endOffset:a},s=e.Caret[r].image}return{kind:i().NM.Exponentiation,op:s,lhs:r,rhs:t,startOffset:e.lhs[0].location.startOffset,endOffset:a}}return r}unaryExpression(e){let t=this.visit(e.primaryExpression[0]),r=e.primaryExpression[0].location.startOffset;const n=void 0!==e.UnaryOperator&&"-"===e.UnaryOperator[0].image&&t.kind===i().NM.Number;var s;if(n&&(t={kind:i().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}),isNaN(r)&&(r=null===(s=e.memberCallSubExpression)||void 0===s?void 0:s[0].location.startOffset),void 0!==e.memberCallSubExpression)for(const f of e.memberCallSubExpression){const e=f.location.endOffset;if(void 0!==f.children.callArguments){var l,c,p;const n=f.children.callArguments[0].children;t={kind:i().NM.Call,expression:t,arguments:(null===(l=f.children.callArguments[0])||void 0===l||null===(l=l.children.expression)||void 0===l?void 0:l.map((e=>this.visit(e))))??[],lParenOffset:n.LParen[0].startOffset,rParenOffset:null===(c=n.RParen)||void 0===c?void 0:c[0].startOffset,commaOffsets:(null===(p=n.Comma)||void 0===p?void 0:p.map((e=>e.startOffset)))??[],startOffset:r,endOffset:e}}else if(void 0!==f.children.dotMemberExpression){const n=f.children.dotMemberExpression[0].children;if(void 0!==n.IdentifierName){const o=n.IdentifierName[0];t={kind:i().NM.UnifiedFunctionProperty,expression:t,name:o.image,nameStartOffset:o.startOffset,nameEndOffset:o.endOffset,startOffset:r,endOffset:e}}else if(void 0!==n.InputToken){const s=n.InputToken[0],l=s.payload;if(l.type===o().FormulaTokenType.BlockProperty){if((0,a().ix)(l))throw new Error("unexpected block property context value in unaryExpression");t={kind:i().NM.MemberBlockProperty,expression:t,propertyToken:void 0===l.collection?{property:l.property,collection:void 0}:{property:l.property,collection:l.collection},propertyStartOffset:s.startOffset,propertyEndOffset:s.endOffset,startOffset:r,endOffset:e}}}}}return void 0===e.UnaryOperator||n?t:{kind:i().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase().trimEnd(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}}parenthesisExpression(e){return this.visit(e.expression[0])}arrayExpression(e){var t,r,n,o,s;return{kind:i().NM.Array,elements:(null===(t=e.expression)||void 0===t?void 0:t.map((e=>this.visit(e))))??[],lBracketOffset:e.LBracket[0].startOffset,rBracketOffset:null===(r=e.RBracket)||void 0===r?void 0:r[0].startOffset,commaOffsets:(null===(n=e.Comma)||void 0===n?void 0:n.map((e=>e.startOffset)))??[],startOffset:e.LBracket[0].startOffset,endOffset:c([null===(o=e.RBracket)||void 0===o?void 0:o[0].endOffset,null===(s=e.expression)||void 0===s||null===(s=s[e.expression.length-1])||void 0===s||null===(s=s.location)||void 0===s?void 0:s.endOffset,e.LBracket[0].endOffset])}}memberCallSubExpression(e){throw new Error("unexpected memberCallSubExpression")}dotMemberExpression(e){throw new Error("unexpected dotMemberExpression")}callArguments(e){throw new Error("unexpected callArguments")}}}();try{return{value:t.visit(e)}}catch(r){return{error:{type:i().M9.UnexpectedError,error:(0,n().A)(r),offset:0}}}}}}]);