"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[50569],{34293:(e,t,s)=>{s.d(t,{A:()=>r});s(296540);var i=()=>s(959013),n=()=>s(824160),a=s(474848);function r(e){return(0,a.jsx)(n().A,{...e,children:"membership_admin"===e.role?(0,a.jsx)(i().sA,{id:"spacePermissionsSettings.user.membershipAdmin",defaultMessage:"Membership admin"}):(0,a.jsx)(i().sA,{id:"spacePermissionsSettings.user.workspaceOwner",defaultMessage:"Workspace owner"})})}},108414:(e,t,s)=>{s.d(t,{A:()=>n});class i extends(()=>s(757695))().Store{getInitialState(){return{open:!1}}}const n=new i},159026:(e,t,s)=>{s.d(t,{Ay:()=>r,NJ:()=>i,d5:()=>n});s(898992),s(354520),s(581454),s(737550);let i=function(e){return e.unselected="unselected",e.workspace_member="workspace_member",e.request_workspace_member="request_workspace_member",e.page_guest="page_guest",e.closed="closed",e}({}),n=function(e){return e[e.closed=0]="closed",e[e.share_page=1]="share_page",e[e.share_workspace=2]="share_workspace",e[e.request_workspace=3]="request_workspace",e}({});class a extends(()=>s(757695))().Store{getInitialState(){return{inviteStage:n.closed,selection:i.workspace_member,order:[i.workspace_member,i.page_guest],invitedUsers:[],invitedEmailToUserIdMap:{},flowId:s(206267).JW()}}startWorkspaceInvite(){this.setState({...this.state,inviteStage:n.share_workspace,order:[i.workspace_member,i.page_guest],selection:i.workspace_member})}startRequestMembership(){this.setState({...this.state,inviteStage:n.request_workspace,order:[i.request_workspace_member,i.page_guest],selection:i.request_workspace_member})}hasGuests(){return this.state.invitedUsers.some((e=>e.isGuest))}getGuestEmails(){return this.state.invitedUsers.filter((e=>e.isGuest)).map((e=>e.email))}}const r=a},266324:(e,t,s)=>{s.d(t,{A:()=>A});var i=s(296540),n=()=>s(112452),a=()=>s(959013),r=()=>s(284371),o=()=>s(962730),l=()=>s(285790),c=()=>s(859428),d=()=>s(484714),u=()=>s(56366),m=()=>s(401497),p=()=>s(449506),v=()=>s(901389),g=()=>s(436572),f=()=>s(7674),S=()=>s(107683),y=()=>s(49210),h=()=>s(84817),w=()=>s(364280),x=()=>s(554509),I=()=>s(453697),b=s(474848);function _(e){let{spaceId:t,userStore:s,onDismiss:n,onSubmit:r}=e;const o=(0,d().v3)(),l=s.id,c=(0,a().tz)(),S=(0,u().K8)((()=>s.getDisplayName(c)),[s,c]),y=(0,m().IS)((e=>({secondaryIcon:{fill:e.icon.uiBlueSecondary},primaryIcon:{fill:e.icon.uiBluePrimary},title:{color:e.text.primary,textAlign:"center",fontSize:17,fontWeight:500,lineHeight:"22px"}})),[]),_=(0,i.useCallback)((async()=>{const e=await p().callApi({eventName:"recoverUserContentInSpace",environment:o,data:{spaceId:t,userId:l}});if("failed"===e.type)throw v().Qg(e),e;r(),n(),g().D6({label:(0,b.jsx)(a().sA,{id:"restoreAccessModal.snackbarMessage",defaultMessage:"Initiated restoration of access for{nbsp}{displayName}",values:{displayName:(0,b.jsx)("b",{children:S}),nbsp:(0,b.jsx)(b.Fragment,{children:" "})}})})}),[o,t,l,S,n,r]);return(0,b.jsx)(f().tf,{header:(0,b.jsx)(f().YA,{iconAndTitle:(0,b.jsxs)(h().Y1,{align:"top-center",gap:9,children:[(0,b.jsx)(I().A,{userStore:s,size:40}),(0,b.jsx)("div",{style:y.title,children:(0,b.jsx)(a().sA,{defaultMessage:"Restore access",id:"restoreAccessModal.title"})})]}),description:(0,b.jsx)(a().sA,{id:"restoreAccessModal.subtitle",defaultMessage:"Restore additional access for members who were removed and re-added within the last 30 days"})}),footer:(0,b.jsx)(f().aO,{layout:"vertical",primaryButtons:[{buttonType:"primary",label:(0,b.jsx)(a().sA,{defaultMessage:"Restore access",id:"restoreAccessModal.restoreButton"}),onClick:_}],secondaryButtons:[{buttonType:"secondary",label:(0,b.jsx)(a().sA,{defaultMessage:"Cancel",id:"restoreAccessModal.cancelButton"}),onClick:n}]}),children:(0,b.jsxs)(w().VP,{gap:24,children:[(0,b.jsx)(x().D,{styleName:"Body-14px/Regular",colorName:"primary",customStyles:{textAlign:"center"},children:(0,b.jsx)(a().sA,{id:"restoreAccessModal.contextDescription",defaultMessage:"<b>{displayName}</b> already has access to their private pages",values:{b:e=>(0,b.jsx)("b",{children:e}),displayName:S}})}),(0,b.jsx)(x().D,{styleName:"Body-14px/Regular",colorName:"primary",customStyles:{textAlign:"center"},children:(0,b.jsx)(a().sA,{id:"restoreAccessModal.actionDescription",defaultMessage:"Would you like to restore <b>{displayName}</b>’s access to their shared pages, groups, and teamspaces?",values:{b:e=>(0,b.jsx)("b",{children:e}),displayName:S}})})]})})}function A(e){let{spaceId:t,userStore:s,onSubmit:i}=e;const r=(0,a().tz)();return(0,b.jsx)(c().A,{placement:o().W.Right,renderTooltip:()=>(0,b.jsx)(T,{}),render:e=>(0,b.jsx)(l().A,{icon:n()._,ariaLabel:r.formatMessage({id:"restoreAccessButton.aria",defaultMessage:"Restore access"}),onClick:()=>async function(e,t,s){return await y().T.showAsyncModal((i=>(0,b.jsx)(S().s,{isOpen:i.isOpen,onDismiss:i.onDismiss,onClosed:i.onClosed,areaConstraint:{width:{type:"fixed",length:380}},render:()=>(0,b.jsx)(_,{spaceId:e,userStore:t,onDismiss:i.onDismiss,onSubmit:s})})))}(t,s,i),...e})})}function T(){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{fontWeight:r().Wy.semibold},children:(0,b.jsx)(a().sA,{id:"userCell.restoreAccessTooltip.label",defaultMessage:"Restore access to teamspaces, groups, and shared pages"})}),(0,b.jsx)("div",{children:(0,b.jsx)(a().sA,{id:"userCell.restoreAccessTooltip.description",defaultMessage:"Only available if a member was removed and re-added in the last 30 days"})})]})}},475355:(e,t,s)=>{s.d(t,{Vs:()=>M,gj:()=>R,hX:()=>U,oH:()=>k,v4:()=>C});s(16280);var i=()=>s(110192),n=()=>s(857639),a=()=>s(416504),r=()=>s(206267),o=()=>s(737188),l=()=>s(179034),c=()=>s(519831),d=()=>s(854150),u=()=>s(529316),m=()=>s(797573),p=()=>s(919709),v=()=>s(946141),g=()=>s(449506),f=()=>s(413677),S=()=>s(751156),y=()=>s(972435),h=()=>s(45359),w=()=>s(37433),x=()=>s(274511),I=()=>s(406792),b=()=>s(632709),_=()=>s(765957),A=()=>s(630116),T=()=>s(108414),j=()=>s(848237);async function R(e){let{environment:t,name:s,description:i,icon:n,accessLevel:a,isDefault:r,flowId:u,createTeamHome:m,teamPermissionRole:p,spacePermissionRole:f,members:S,settings:y}=e;const{currentSpaceStore:h}=_().default.getState();if(!h)throw new Error("currentSpaceStore does not exist");const w=I().default.mark("client_create_team_latency"),x=h.id,b=await g().callApi({eventName:"createTeam",environment:t,data:{spaceId:x,name:s,description:i,icon:n,isDefault:r,accessLevel:a,teamPermissionRole:p,spacePermissionRole:f,members:S,settings:y}});if("failed"===b.type)return void(0,j().O)(b);const{teamId:T}=b.data,R=A().h4.createChildStore(h,{table:d().yK,id:T,spaceId:x});await R.load();const M=R.getSpaceId(),C=R&&M&&{id:R.id,table:c().Vl,spaceId:M},k=R&&C&&A().md.createChildStore(R,C);await(null==k?void 0:k.load());const U=R&&M&&A().Bv.createChildStore(R,{id:(0,o().t)(R.id),table:l().ev,spaceId:M});return await(null==U?void 0:U.load()),M&&await g().callApi({eventName:"createCollectionViewBlockForPosts",environment:t,data:{teamId:R.id,spaceId:M}}),m&&N({environment:t,teamStore:R}),v()._P(t,{store:R,flowId:u}),I().default.measure(w,{environment:t}),R}function M(e){var t;let{environment:s,page:i}=e;const n=r().JW(),a=(null===(t=i.getParentPointer())||void 0===t?void 0:t.table)!==d().yK?"page_to_team_nested":"page_to_team";v().H8(s,{from:a,flowId:n}),T().A.setState({open:!0,pageStore:i,flowId:n})}async function C(e){var t;let{environment:s,page:i,flowId:n,intl:r}=e;const{accessLevel:o,spacePermissionRole:l,teamPermissionRole:c,members:u}=await(0,w().sy)(i),m=(i.isDefined()?i.getModel().getRenderTitle({intl:r,userTimeZone:(0,a().P)(),getRecordModel:i.getRecordModel}):void 0)??p().q4_(i.getTitleValue()),v=await R({environment:s,name:m,icon:null===(t=i.getIcon())||void 0===t?void 0:t.icon,accessLevel:o,isDefault:!1,description:"",flowId:n,createTeamHome:!1,teamPermissionRole:c,spacePermissionRole:l,members:u});if(!v)return;const{currentSpaceViewStore:g}=_().default.state;if(!g)return;const f=await(0,x().U)();S().createAndCommit({userAction:"teamActions.movePageToCreatedTeam",environment:s,canUndo:!0,perform:e=>{f({environment:s,currentSpaceViewStore:g,transaction:e,teamStore:v,action:"move",value:{type:d().yK,id:v.id},targets:[i],location:{type:"append"}})}}),(0,j().F2)({environment:s,teamId:v.id,tab:b().p.Members,from:"create_team_from_page"}),await new Promise((e=>setTimeout((()=>(0,j().Mh)({teamStore:v,environment:s})),100)))}async function k(e){let{environment:t,name:s,description:i,icon:n,flowId:a,trackCreateTeamComplete:r}=e;const{currentSpaceStore:o}=_().default.getState();if(!o)throw new Error("currentSpaceStore does not exist");const l=o.id,c=await g().callApi({eventName:"enableTeams",environment:t,data:{spaceId:l,defaultTeamName:s,defaultTeamIcon:n,defaultTeamDescription:i}});if("failed"===c.type)return void(0,j().O)(c);const{teamId:u}=c.data,m=A().h4.createChildStore(o,{table:d().yK,id:u,spaceId:l});return await m.load(),await N({environment:t,teamStore:m}),v().b0(t,{spaceId:l,store:m,flowId:a}),r&&u&&v()._P(t,{store:m,flowId:a}),m}async function U(e){var t;let{environment:s,teamStore:n,from:a,buttonPopupStore:o}=e;if(!s.currentUser.id)return!1;const l=r().JW(),c=n.isDefault(),d=n.getTeamAccessLevel();if(c)return!1;const u=n.getName(),m=await R({environment:s,name:(0,i().Q)(u||""),description:"",icon:n.getRawIcon(),accessLevel:d,isDefault:c,createTeamHome:!0,teamPermissionRole:null===(t=n.getTeamPermission())||void 0===t?void 0:t.role,spacePermissionRole:n.getSpacePermissionRole(),members:[],settings:n.getSettings(),flowId:l});return!!m&&(v().KK(s,{store:m,from:a}),(0,j().L0)({environment:s,teamStore:m,shouldScroll:!0}),(0,j().F2)({environment:s,teamId:m.id,tab:b().p.General,from:"duplicate_team",buttonPopupStore:o}),new Promise((e=>setTimeout(e,500))).then((()=>{(0,h().jH)(u)})),!0)}async function N(e){const{environment:t,teamStore:s}=e,i=_().default.state.currentSpaceStore,a=_().default.state.currentSpaceViewStore;if(!i||!a)return n().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-SpaceOrSpaceViewStoreError"}),!1;const r=(o=y().A.getIntl(),(0,m().B)(u().wA.teamsHomepage,o));var o;return!!(await f().createTemplateInstance({environment:t,item:r,spaceStore:i,spaceViewStore:a,useMinimalTemplates:!1,type:"inTeam",teamStore:s,from:"homepage_team",isOnboarding:!1}))||(n().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-PageNotCreated"}),!1)}},495867:(e,t,s)=>{s.d(t,{BY:()=>S,Lg:()=>y,id:()=>I,nE:()=>b,xi:()=>h});s(944114),s(898992),s(430670),s(581454);var i=()=>s(857639),n=()=>s(402390),a=()=>s(68263),r=()=>s(762433),o=()=>s(449506),l=()=>s(579627),c=()=>s(436572),d=()=>s(972435),u=()=>s(765957),m=()=>s(57605),p=()=>s(159026),v=()=>s(329304),g=()=>s(47373),f=()=>s(250064);async function S(e){const{environment:t,spaceStore:s,contextualInviteStore:i}=e;!function(e){const{spaceStore:t,contextualInviteStore:s}=e,i=t.getRole();if(!i||!(0,a().NB)(i))return!1;if(!s.hasGuests())return!1;if(t.getDisableMembershipRequests())return!1;return(0,g().x3)()}({environment:t,spaceStore:s,contextualInviteStore:i})?await async function(e){const{spaceStore:t,contextualInviteStore:s,environment:i}=e,n=t.getRole();if(!n||!(0,a().vp)(n))return!1;if(!s.hasGuests())return!1;return await(0,v().Se)(i,{name:"members",spaceId:t.id,userId:t.userId,amount:1})}({environment:t,spaceStore:s,contextualInviteStore:i})?i.startWorkspaceInvite():i.setState({...i.state,inviteStage:p().d5.closed}):i.startRequestMembership()}async function y(e){const{environment:t,spaceStore:s,contextualInviteStore:n,from:a,intl:r}=e,{selection:o,flowId:d}=n.state;if("page_guest"===o||!n.hasGuests())return n.reset(),!1;const{inviteTargets:u,unknownEmails:m}=await w({environment:t,contextualInviteStore:n}),p={...n.state};n.reset();const g=await(0,v().Se)(t,{name:"non_admin_members",spaceId:s.id,userId:s.userId})?e.inviteRole??"read_and_write":"editor";try{await l().eP({environment:t,store:s,inviteTargets:u,inviteRole:g,isOnboarding:!1,invite:{inviteOrigin:a,inviteFlowId:d,disable_invite_email:!0}})}catch(f){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:I(t,e),userCount:t.length})})}(r,p.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{...p,inviteTargets:u}}}),!1}finally{m.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.unknownUserId",data:{miscDataToConvertToString:{...p,unknownEmails:m}}})}return!0}async function h(e){const{environment:t,spaceStore:s,originId:n,originType:a,reasonMessage:r,contextualInviteStore:l,intl:d}=e,{selection:u}=l.state;if("page_guest"===u||!l.hasGuests())return l.reset(),!1;const{inviteTargets:m,unknownEmails:p}=await w({environment:t,contextualInviteStore:l}),v={...l.state};l.reset();const g=[];try{const e=m.map((e=>o().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:e.value.id,spaceId:s.id,message:r,attributes:{origin_id:n,origin_type:a,origin_table:"share_menu"===a?"block":"space",add_permissions_on_approval:!1}}}).catch((()=>g.push(e)))));await Promise.all(e)}catch(f){return function(e,t){if(0===t.length)return;c().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:I(t,e)})})}(d,v.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.inviteTargets",data:{miscDataToConvertToString:{...v,inviteTargetsWithErrors:g}}}),!1}finally{p.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.unknownUserId",data:{miscDataToConvertToString:{...v,unknownEmails:p}}})}return!0}async function w(e){const{environment:t,contextualInviteStore:s}=e,{invitedEmailToUserIdMap:i}=s.state,n=[],a=[];for(const r of s.state.invitedUsers){if(!r.isGuest)continue;const e=await x(t,r,i);e?n.push({type:"existingUser",value:{id:e,email:r.email,version:1}}):a.push(r.email)}return{inviteTargets:n,unknownEmails:a}}async function x(e,t,s){const i=await async function(e,t,s){let i=t.id;if(i||(i=s[t.email]),!i){const s=await o().callApi({eventName:"findUser",environment:e,data:{email:t.email}});if("failed"!==s.type){const e=s.data;e.value&&(i=e.value.value.id)}}return i}(e,t,s);if(i)return i;const a=(0,n().H)(d().A.getIntl()),r=await o().callApi({eventName:"createEmailUser",environment:e,data:{email:t.email,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:a}});return"failed"!==r.type?r.data.userId:void 0}function I(e,t){return(0,f().l)(e.flatMap((e=>e.email||[])))}function b(e,t){var s;const{state:i}=t,n=null===(s=u().default.state.currentSpaceStore)||void 0===s?void 0:s.id,a=n?(0,r().AI)(m().A.getData(e,{spaceId:n})):void 0,o=t.getGuestEmails();return{invite_flow_id:i.flowId,user_count:o.length,user_emails:o,invite_space_role_selection:i.selection,is_bot:!1,subscription_tier:a}}},542056:(e,t,s)=>{s.d(t,{Ah:()=>k,D6:()=>C,KW:()=>T,Oo:()=>A,Pp:()=>U,St:()=>M,hQ:()=>P,iS:()=>R,kW:()=>j,l5:()=>_,lf:()=>N});s(944114),s(517642),s(658004),s(733853),s(845876),s(432475),s(515024),s(731698),s(898992),s(354520),s(803949),s(581454);var i=()=>s(842599),n=()=>s(68263),a=()=>s(96689),r=()=>s(496603),o=()=>s(763824),l=()=>s(579627),c=()=>s(495867),d=()=>s(731320),u=()=>s(743260),m=()=>s(299545),p=()=>s(37433),v=()=>s(106628),g=()=>s(765957),f=()=>s(57605),S=()=>s(159026),y=()=>s(217429),h=()=>s(630116),w=()=>s(991249),x=()=>s(475355),I=()=>s(134696),b=()=>s(449506);async function _(e){const{environment:t,store:s,sudoModeStore:a,permissionsInviteStore:r,onInviteStart:o,contextualInviteStore:c,inviteOrigin:p}=e,{tokenQuery:v}=r.state;if((0,i().DT)(v.trim())){const e={type:"newUser",value:{email:v.trim()},source:"email"};u().mQ({target:e,permissionsInviteStore:r})||r.setState({...r.state,inviteTargets:[...r.state.inviteTargets,e],tokenQuery:""})}if(r.state.inviteTargets.length>0){null==o||o();const e=r.state,{inviteRole:i,flowId:u,emailMessage:v}=e;r.reset();const g=await(0,d().hb)(s,e.inviteTargets);if((0,n().PW)(i)){const e=await l().eP({environment:t,store:s,sudoModeStore:a,inviteTargets:g,inviteRole:i,isOnboarding:!1,invite:{inviteFlowId:u,inviteMessage:v,inviteOrigin:p}});return e.success&&(null==c||c.setState({...null==c?void 0:c.state,invitedEmailToUserIdMap:e.invitedUsers})),{success:e.success,requestedUserCount:e.success?Object.keys(e.requestedUsers).length:0}}if((0,m().$R)(s)){return{success:await l().sQ({environment:t,store:s,inviteTargets:e.inviteTargets,inviteRole:i,createNewTeamFlowId:u}),requestedUserCount:0}}}return{success:!0,requestedUserCount:0}}function A(e){e.permissionsInviteStore.setState({...e.permissionsInviteStore.state,modalOpen:!1,flowId:void 0})}function T(e){const{permissionsInviteStore:t,contextualInviteStore:s}=e;if(!s)return;const i=[];t.state.inviteTargets.forEach((e=>{if("newUser"===e.type)i.push({email:e.value.email,isGuest:!0});else if("existingUser"===e.type){const t={...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};i.push(t)}})),s.setState({...s.state,invitedUsers:i})}async function j(e){const{environment:t,store:s,sudoModeStore:i,permissionsInviteStore:n,contextualInviteStore:r,onInviteClick:o,onInviteComplete:l,inviteOrigin:d,intl:u}=e,m=s.getSpaceId(),v=new(h().SL)(t,{table:a().NX,id:m}),g=m?await f().A.awaitData(t,{spaceId:m}):void 0;if((null==r?void 0:r.state.selection)===S().NJ.workspace_member&&v&&(0,p().Gx)(t,g)){if(!(await x().oH({environment:t,flowId:n.state.flowId||"",trackCreateTeamComplete:!1})))return;T({permissionsInviteStore:n,contextualInviteStore:r}),await(0,c().Lg)({environment:t,spaceStore:v,contextualInviteStore:r,from:d,intl:u})}else T({permissionsInviteStore:n,contextualInviteStore:r});let y={success:!1,requestedUserCount:0};try{y=await _({environment:t,store:s,sudoModeStore:i,permissionsInviteStore:n,contextualInviteStore:r,onInviteStart:()=>{null==o||o()},inviteOrigin:d})}catch(w){}finally{null==l||l(y.success,y.requestedUserCount)}}async function R(e){const{environment:t,permissionsInviteStore:s,from:i}=e;await u().iQ({environment:t,permissionsInviteStoreState:s.state,from:i})||s.reset()}function M(e){const{permissionsInviteStore:t,targetToRemove:s,defaultRoleForNonBot:i}=e,n=t.state.inviteTargets.filter((e=>e!==s));t.setState({...t.state,inviteTargets:n,inviteRole:i})}function C(e){const{environment:t,onUpgradeButtonClick:s,upgradeButtonName:i}=e;w().K(t,{from:i,upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}}),null==s||s()}async function k(e,t){const s=new Set(t),i=Array.from(s).map((async t=>{const s=await b().callApi({eventName:"findUser",environment:e,data:{email:t}});if("success"===s.type){const e=s.data;if(e.value){return{type:"existingUser",value:e.value.value}}}return{type:"newUser",value:{email:t},source:"email"}}));return await Promise.all(i)}async function U(e){const{environment:t,permissionsInviteStore:s,event:n}=e,a=n.target.value,{extractedEmails:r,newInputValue:o}=(0,i().Ct)(a),l=(await k(t,r)).filter((e=>!u().mQ({target:e,permissionsInviteStore:s}))),c=[...s.state.inviteTargets,...l];s.setState({...s.state,inviteTargets:c,inputFocus:"invitee",tokenQuery:o})}function N(e){const{environment:t,newRole:s,permissionsInviteStore:i}=e,{state:n}=i;I().Jy(t,{...u().oX(t,n),invite_updated_role:s}),i.setState({...n,inviteRole:s})}async function P(e){var t;const{query:s,environment:i,sectionLimit:n,intl:a,membersOnly:l,importContactType:c,shouldUseEdgeCacheRollout:d}=e,{currentSpaceStore:u}=g().default.state;if(!u)return{inviteUsers:[],inviteGroups:[]};const m=y().default.getConfigKey("search_contacts_timeout","timeoutMs"),{userLimit:p,groupLimit:f,importContactLimit:S}=n,h=await v().T.searchActions.load(),[w,x,{user:I,email:_},A]=await Promise.all([p>0?h.searchSpaceUsers({environment:i,query:s,membersOnly:l,limit:p,shouldUseEdgeCacheRollout:d}):[],f>0?h.searchSpaceGroups({query:s,intl:a}):[],h.searchEmailUser(i,s),S>0?(0,o().nQ)(m,b().callApi({eventName:"searchContacts",environment:i,data:{spaceId:u.id,limit:S,query:s,importContactType:c,includeNonNotionUsers:!l,includeUserId:!0}})):void 0]),T=w.slice(0,p).map((e=>({type:"existingUser",value:e}))),j=x.slice(0,f).map((e=>({type:"group",value:e})));I&&T.unshift({type:"existingUser",value:I}),_&&T.unshift({type:"newUser",value:{email:_},source:"email"});let R=0,M=[];var C;"success"===(null==A||null===(t=A.result)||void 0===t?void 0:t.type)&&(M=A.result.data.contacts.map((e=>({type:"newUser",value:{email:e.email,name:e.name,avatar_url:e.profile_photo,user_id:e.user_id},source:e.type}))),R=(null==A||null===(C=A.result)||void 0===C||null===(C=C.data)||void 0===C?void 0:C.totalCount)??0);return{inviteUsers:r().hS(T,(e=>e.value.email)),inviteGroups:j,importedContacts:M,totalContactsCount:R}}},623742:(e,t,s)=>{s.d(t,{A:()=>S,v:()=>f});var i=s(296540),n=()=>s(56366),a=()=>s(310442),r=()=>s(824862),o=()=>s(798880),l=()=>s(959013),c=()=>s(534177),d=()=>s(256863),u=()=>s(125565),m=()=>s(453697),p=()=>s(765957),v=s(474848);function g(e){const{actorStore:t,avatar:s,isLarge:i}=e,n=i?32:28;return t?t.table===r().GP?(0,v.jsx)(d().A,{botStore:t,size:n}):t.table===o().oo?(0,v.jsx)(m().A,{userStore:t,size:n}):t.table===a().yj?(0,v.jsx)(m().A,{userStore:void 0,size:n}):void(0,c().HB)(t):s?(0,v.jsx)(m().A,{avatar:s,size:n}):(0,v.jsx)(m().A,{userStore:void 0,size:n})}function f(e){return"membership_admin"===e?"membership_admin":"editor"===e||"admin"===e?"admin":"none"===e||"guest"===e?"guest":"team_level_guest"===e?"team_level_guest":void("member"!==e&&"read_and_write"!==e&&"no_access"!==e&&"not_in_space"!==e&&e&&(0,c().HB)(e))}const S=function(e){const t=(0,l().tz)(),{actorStore:a,avatar:r,containerStyle:c,id:d,spaceRole:m,avatarBadge:f,caption:S,isLarge:y,restorationStatus:h,hideRolePill:w}=e,x=!w&&("admin"===m||"membership_admin"===m),I="guest"===m||"team_level_guest"===m,b=!w&&I,_=(0,n().K8)((()=>a?a.getDisplayName(t):null==r?void 0:r.name),[a,r,t]),A=(0,n().K8)((()=>{const{currentUserStore:e}=p().default.state;return!!e&&(!!a&&e.id===a.id)}),[a]),T=(0,s(401497).IS)((e=>({titleYouIndicator:{color:e.text.secondary}})),[]),j=(0,n().K8)((()=>Boolean(S)?S:a?a.getDetail():null==r?void 0:r.email),[S,a,r]),R=(0,n().O$)(p().AppStoreCurrentSpaceStore),[M,C]=(0,i.useState)(!1);return(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:y?"unset":300,marginLeft:0,...c},children:[(0,v.jsxs)("div",{style:{position:"relative",...!y&&{height:28,width:28}},children:[(0,v.jsx)(g,{actorStore:a,avatar:r,isLarge:y}),f]}),(0,v.jsxs)("div",{style:{minWidth:0,marginLeft:y?10:6,marginRight:y?10:6},children:[(0,v.jsxs)("div",{id:d,style:{display:"flex",gap:4},children:[(0,v.jsx)(u().A,{children:A?(0,v.jsx)(l().sA,{id:"cellMemberAvatar.displayName.title",defaultMessage:"{userFullDisplayName} <youIndicatorText>(You)</youIndicatorText>",values:{userFullDisplayName:_,youIndicatorText:e=>(0,v.jsx)("span",{style:T.titleYouIndicator,children:e})}}):_}),x&&(0,v.jsx)(s(34293).A,{role:m}),b&&(0,v.jsx)(s(919172).Q,{labelType:m,shouldUseTabStyle:!0}),R&&h&&(0,v.jsx)(s(881753).A,{spaceStore:R,restorationStatus:h,didAttemptRecovery:M})]}),(0,v.jsx)(u().A,{isSmall:!0,style:{display:"flex"},children:(0,v.jsx)(u().A,{isSmall:!0,children:j})})]}),!I&&!M&&R&&(null==a?void 0:a.table)===o().oo&&_&&"canBeRestored"===(null==h?void 0:h.status)&&(0,v.jsx)(s(266324).A,{userStore:a,spaceId:R.id,onSubmit:()=>C(!0)})]})}},881753:(e,t,s)=>{s.d(t,{A:()=>g});s(296540);var i=()=>s(662303),n=()=>s(56366),a=()=>s(401497),r=()=>s(869190),o=()=>s(959013),l=()=>s(284371),c=()=>s(777092),d=()=>s(962730),u=()=>s(464708),m=()=>s(859428),p=()=>s(125565),v=s(474848);function g(e){let{spaceStore:t,restorationStatus:s,didAttemptRecovery:i}=e;const n=S();return(0,v.jsx)(m().A,{placement:d().W.Bottom,renderTooltip:()=>(0,v.jsx)(f,{spaceStore:t,restorationStatus:s,didAttemptRecovery:i}),render:e=>(0,v.jsx)("div",{...e,children:(0,v.jsx)(u().A,{content:(0,v.jsx)(p().A,{style:n.recentlyReaddedText,children:(0,v.jsx)(o().sA,{id:"userCell.recentlyReadded.label",defaultMessage:"Recently re-added"})}),style:n.recentlyReaddedBadge})})})}function f(e){let{spaceStore:t,restorationStatus:s,didAttemptRecovery:a}=e;const l=S(),{displayName:d,displayTime:u}=function(e){let{spaceStore:t,restorationStatus:s}=e;const a="restored"===s.status?{table:s.restoredByTable,id:s.restoredById,spaceId:t.id}:void 0,l=a?(0,c().JQ)({parentStore:t,pointer:a}):void 0,d=(0,o().tz)(),{displayName:u}=(0,n().K8)((()=>({displayName:null==l?void 0:l.getDisplayName(d)})),[l,d]),m="restored"===s.status?(0,r().W_)(s.restoredTime,"medium_with_time",i().locale):void 0;return{displayName:u,displayTime:m}}({spaceStore:t,restorationStatus:s});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:l.tooltipFirstLine,children:(0,v.jsx)(o().sA,{id:"userCell.recentlyReaddedTooltip.label",defaultMessage:"Member was removed and re-added within the last 30 days"})}),a?(0,v.jsx)("div",{style:l.tooltipSecondLine,children:(0,v.jsx)(o().sA,{id:"userCell.recentlyReaddedTooltip.inProgress.description",defaultMessage:"Restoration of access is in progress",values:{displayName:d,displayTime:u}})}):void 0,!a&&d&&u?(0,v.jsx)("div",{style:l.tooltipSecondLine,children:(0,v.jsx)(o().sA,{id:"userCell.recentlyReaddedTooltip.description",defaultMessage:"{displayName} restored their access on {displayTime}",values:{displayName:d,displayTime:u}})}):void 0]})}function S(){return(0,a().IS)((e=>({recentlyReaddedBadge:{background:e.fill.blueSecondary,marginLeft:0,maxWidth:"max-content"},recentlyReaddedText:{color:e.text.bluePrimary,fontSize:l().J.UISmall.desktop,fontStyle:"normal",fontWeight:400,lineHeight:"15px"},tooltipFirstLine:{color:e.text.contrastPrimary,fontWeight:l().Wy.semibold},tooltipSecondLine:{color:e.text.contrastSecondary}})),[])}}}]);