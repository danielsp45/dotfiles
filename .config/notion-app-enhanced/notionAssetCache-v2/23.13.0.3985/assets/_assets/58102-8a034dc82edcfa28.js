"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58102],{261164:(e,o,t)=>{t.d(o,{o:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("arrowRightRounded",{viewBox:"0 0 16 13",directional:!0,svg:(0,r.jsx)("path",{d:"M15.3828 6.85156C15.3828 7.09635 15.2917 7.3099 15.1094 7.49219L9.95312 12.6328C9.77083 12.8099 9.5651 12.8984 9.33594 12.8984C9.09635 12.8984 8.89583 12.8203 8.73438 12.6641C8.57812 12.5078 8.5 12.3125 8.5 12.0781C8.5 11.9583 8.52083 11.8464 8.5625 11.7422C8.60938 11.638 8.67188 11.5469 8.75 11.4688L10.5 9.70312L13.4141 7.04688L13.6875 7.54688L10.9766 7.70312H1.48438C1.22396 7.70312 1.01302 7.625 0.851562 7.46875C0.695312 7.30729 0.617188 7.10156 0.617188 6.85156C0.617188 6.59635 0.695312 6.39062 0.851562 6.23438C1.01302 6.07292 1.22396 5.99219 1.48438 5.99219H10.9766L13.6875 6.15625L13.4141 6.66406L10.5 4L8.75 2.22656C8.67188 2.14844 8.60938 2.0599 8.5625 1.96094C8.52083 1.85677 8.5 1.74219 8.5 1.61719C8.5 1.38281 8.57812 1.1875 8.73438 1.03125C8.89583 0.875 9.09635 0.796875 9.33594 0.796875C9.45052 0.796875 9.5599 0.820312 9.66406 0.867188C9.76823 0.914062 9.86719 0.984375 9.96094 1.07812L15.1094 6.21094C15.2917 6.39323 15.3828 6.60677 15.3828 6.85156Z"})})},343168:(e,o,t)=>{t.d(o,{A:()=>n});class r extends(()=>t(757695))().Store{getInitialState(){return{openTooltip:void 0}}}const n=new r},958102:(e,o,t)=>{t.r(o),t.d(o,{FORMS_SHARE_CALLOUT_KEY:()=>Y,changeFormClosedState:()=>ue,changeFormSubmissionPermissions:()=>ce,createAndFocusCollectionFormEditorView:()=>re,createCollectionFormEditorView:()=>ne,createDummyFormPage:()=>ve,createFormInPrivate:()=>ie,createFormQuestion:()=>se,createFormQuestionAndUpdateOrCreateModule:()=>le,createModuleForNewlyDuplicatedProperty:()=>de,createResponsesCollectionView:()=>ae,handleUpdateFormQuestionName:()=>ee,incrementAndTrackUserFormsCreated:()=>J,maybeAlertAboutUnsupportedPublicQuestions:()=>ye,maybeSyncQuestionNameToPropertyName:()=>oe,remapQuestionToNewProperty:()=>fe,toggleAnonymousFormSubmissionState:()=>me,toggleNotionBrandingState:()=>pe});t(16280),t(944114),t(898992),t(354520),t(672577),t(803949),t(581454),t(296540);var r=()=>t(401497),n=()=>t(584262),i=()=>t(700500),a=()=>t(31503),s=()=>t(970013),d=()=>t(713998),l=()=>t(110192),u=()=>t(416504),c=()=>t(261164),m=t(474848);const p=(0,t(340498).wt)("collectionForm",{viewBox:"0 0 16 16",svg:(0,m.jsx)("path",{d:"M5.50195 4.75635C5.37435 4.75635 5.26953 4.71305 5.1875 4.62646C5.10547 4.53988 5.06445 4.43734 5.06445 4.31885C5.06445 4.1958 5.10547 4.09326 5.1875 4.01123C5.26953 3.9292 5.37435 3.88818 5.50195 3.88818H10.5059C10.6289 3.88818 10.7314 3.9292 10.8135 4.01123C10.8955 4.09326 10.9365 4.1958 10.9365 4.31885C10.9365 4.43734 10.8955 4.53988 10.8135 4.62646C10.7314 4.71305 10.6289 4.75635 10.5059 4.75635H5.50195ZM5.50195 7.0874C5.37435 7.0874 5.26953 7.04639 5.1875 6.96436C5.10547 6.87777 5.06445 6.77295 5.06445 6.6499C5.06445 6.53141 5.10547 6.43115 5.1875 6.34912C5.26953 6.26709 5.37435 6.22607 5.50195 6.22607H10.5059C10.6289 6.22607 10.7314 6.26709 10.8135 6.34912C10.8955 6.43115 10.9365 6.53141 10.9365 6.6499C10.9365 6.77295 10.8955 6.87777 10.8135 6.96436C10.7314 7.04639 10.6289 7.0874 10.5059 7.0874H5.50195ZM5.50195 9.42529C5.37435 9.42529 5.26953 9.38428 5.1875 9.30225C5.10547 9.22021 5.06445 9.11995 5.06445 9.00146C5.06445 8.87842 5.10547 8.77588 5.1875 8.69385C5.26953 8.60726 5.37435 8.56396 5.50195 8.56396H7.92188C8.04948 8.56396 8.1543 8.60726 8.23633 8.69385C8.31836 8.77588 8.35938 8.87842 8.35938 9.00146C8.35938 9.11995 8.31836 9.22021 8.23633 9.30225C8.1543 9.38428 8.04948 9.42529 7.92188 9.42529H5.50195ZM2.13867 13.1577V2.84229C2.13867 2.10856 2.32552 1.55257 2.69922 1.17432C3.07292 0.791504 3.62663 0.600098 4.36035 0.600098H11.6406C12.3743 0.600098 12.9281 0.791504 13.3018 1.17432C13.6755 1.55257 13.8623 2.10856 13.8623 2.84229V13.1577C13.8623 13.896 13.6755 14.4543 13.3018 14.8325C12.9281 15.2108 12.3743 15.3999 11.6406 15.3999H4.36035C3.62663 15.3999 3.07292 15.2108 2.69922 14.8325C2.32552 14.4543 2.13867 13.896 2.13867 13.1577ZM3.48535 13.0757C3.48535 13.3901 3.56738 13.6317 3.73145 13.8003C3.89551 13.9689 4.14388 14.0532 4.47656 14.0532H11.5312C11.8639 14.0532 12.1123 13.9689 12.2764 13.8003C12.4404 13.6317 12.5225 13.3901 12.5225 13.0757V2.93115C12.5225 2.61214 12.4404 2.36833 12.2764 2.19971C12.1123 2.02653 11.8639 1.93994 11.5312 1.93994H4.47656C4.14388 1.93994 3.89551 2.02653 3.73145 2.19971C3.56738 2.36833 3.48535 2.61214 3.48535 2.93115V13.0757Z"})});var f=()=>t(29118),v=()=>t(688728),y=()=>t(235692),g=()=>t(388821),I=()=>t(450648),C=()=>t(179034),h=()=>t(869558),w=()=>t(37165),A=()=>t(144081),_=()=>t(919709),b=()=>t(959013),S=()=>t(183558),M=()=>t(284371),x=()=>t(235191),T=()=>t(901389),B=()=>t(896628),P=()=>t(246826),N=()=>t(857783),Q=()=>t(185544),O=()=>t(751156),F=()=>t(755199),E=()=>t(2220),D=()=>t(478251),U=()=>t(180762),V=()=>t(184468),R=()=>t(389658),k=()=>t(852353),L=()=>t(594794),H=()=>t(972435),z=()=>t(299487),Z=()=>t(978846),j=()=>t(33218),q=()=>t(765957),G=()=>t(217429),X=()=>t(343168),W=()=>t(611371),$=()=>t(465741);const K=(0,b().YK)({responsesViewName:{id:"formEditorActions.responsesViewName",defaultMessage:"Responses"},newFormViewName:{id:"formEditorActions.newFormViewName",defaultMessage:"Form builder"},formDatabaseTitle:{id:"newBlock.databaseInline.formDatabaseTitle",defaultMessage:"New form"}}),Y="forms_share_form_tooltip";function J(e,o){const{currentUserSettingsStore:t}=q().default.state;if(!t)return;const r=function(){const{currentUserSettingsStore:e}=q().default.state;if(!e)return;return e.getSettingsStore().getKeyStore("user_forms_created_count").getValue()??0}();void 0!==r&&(F().mJ({userSettingsStore:t,transaction:o,data:{user_forms_created_count:r+1}}),function(e,o){(0,E().u)({environment:e,event:{eventName:"form_created",eventProperties:{user_total_form_count:o.userFormsCreatedCount}}})}(e,{userFormsCreatedCount:r+1})),G().default.logEvent("form_created")}function ee(e){var o;const{questionStore:t,newName:r,environment:n,collectionStore:i,collectionSchema:a,collectionContextStore:s}=e,d=null===(o=t.getConfig())||void 0===o?void 0:o.propertyId;if(!d)throw new Error("No property ID found for question");O().createAndCommit({userAction:"formQuestion.changeName",environment:n,canUndo:!0,perform:e=>{var o,n;const l=null===(o=t.getConfig())||void 0===o?void 0:o.name;if(!l)return;const c=(0,I().r4)({textValue:l,getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,u().P)(),intl:H().A.getIntl()})===(null===(n=a[d])||void 0===n?void 0:n.name);O().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","name"],command:"set",args:[[r]]},transaction:e}),t.shouldSyncQuestionNameToPropertyName()&&(c&&!(0,k().fE)({property:d,collectionContextStore:s,newValue:r})?x().YO({collectionStore:i,property:d,name:r,transaction:e}):O().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","shouldSyncQuestionNameToPropertyName"],command:"set",args:!1},transaction:e}))}})}function oe(e){var o;const{questionStore:t,environment:r,collectionStore:n,collectionContextStore:i}=e,a=null===(o=t.getConfig())||void 0===o?void 0:o.propertyId;if(!a)throw new Error("No property ID found for question");O().createAndCommit({userAction:"formQuestion.changeName",environment:r,canUndo:!0,perform:e=>{if(!t.shouldSyncQuestionNameToPropertyName())return;const o=t.getNameStore().getValue();if(!o)return;const r=(0,I().r4)({textValue:o,getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,u().P)(),intl:H().A.getIntl()}),s=(0,k().fE)({property:a,collectionContextStore:i,newValue:r})?(0,l().Q)(r):r;x().YO({collectionStore:n,property:a,name:s,transaction:e})}})}function te(){const e=(0,r().IS)((e=>({container:{display:"flex",flexDirection:"column"},iconGroup:{display:"flex",flexDirection:"row",justifyContent:"center",color:e.icon.secondary,alignItems:"center"},dialogTitle:{fontSize:16,fontWeight:M().Wy.semibold,lineHeight:"22px",marginTop:12,marginBottom:12},dialogDescription:{color:e.text.secondary,fontSize:14,lineHeight:"20px"}})),[]);return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.iconGroup,children:[(0,f().K)({width:24}),(0,c().o)({width:16,marginLeft:16,marginRight:14}),p({width:24})]}),(0,m.jsx)("span",{style:e.dialogTitle,children:(0,m.jsx)(b().sA,{defaultMessage:"Auto-create form questions based on existing properties?",id:"NewFormOnExistingCollectionDialogTitle.message"})}),(0,m.jsx)("span",{style:e.dialogDescription,children:(0,m.jsx)(b().sA,{defaultMessage:"Only supported property types will create new questions.",id:"NewFormOnExistingCollectionDialogTitle.description"})})]})}function re(e){const{environment:o,collectionContextStore:t,transaction:r}=e,n=t.collectionViewBlockStore(),i=t.collectionStore();if(!n||!i)return;const s=t.normalizedSchemaStore.state,d=ne({environment:o,collectionViewBlockStore:n,schema:s,transaction:r,initializeWithAllDefaultQuestions:!1});if(!d)return;(0,U().t)({environment:o,collectionContextStore:t,collectionViewId:d.newViewId,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state});const l=d.layoutStore,u=Object.keys(s).filter((e=>{const o=s[e];return"title"!==e&&o&&(0,a().Sg)(o)}));u.length>0&&u.length<=$().eb&&T().ui({showCancel:!1,keepFocus:!1,message:(0,m.jsx)(te,{}),mode:"wide",items:[{label:(0,m.jsx)(b().sA,{defaultMessage:"Create {numQuestions, plural, one {1 question} other {{numQuestions} questions}}",id:"formEditorActions.createQuestions.primaryAction",values:{numQuestions:u.length}}),color:"blue",buttonType:"solid",onAccept(){O().createAndCommit({environment:o,userAction:"formActions.autoCreateFormQuestionsForExistingDatabase",canUndo:!0,perform:e=>{for(const r of u)de({type:"formQuestion",environment:o,module:void 0,transaction:e,layoutStore:l,collectionStore:i,propertyId:r,position:{type:"area_relative",area:"form_layout_schema",location:"end_moveable"},collectionContextStore:t,shouldLogEvent:!0,autoCreatedFromExistingDatabase:!0,duplicateModuleMapping:new Map,propertyIdMapping:new Map,sessionId:(0,S().Ay)()})}})}},{label:(0,m.jsx)(b().sA,{defaultMessage:"Start from scratch",id:"formEditorActions.createQuestions.secondary"}),color:"gray",buttonType:"plain",onAccept(){}}]})}function ne(e){const{environment:o,collectionViewBlockStore:t,transaction:r,schema:n,initializeWithAllDefaultQuestions:i}=e;if(!t)return;const d=t.getSpaceId(),{formBlockStore:l,layoutStore:u}=function(e){var o;const{environment:t,spaceId:r,inMemoryRecordCache:n,transaction:i,schema:d,initializeWithAllDefaultQuestions:l}=e,u=Object.keys(d).find((e=>{var o;return"multi_select"===(null===(o=d[e])||void 0===o?void 0:o.type)})),c=Boolean(l&&void 0!==u),m=(0,L().Z1)({environment:t,table:C().ev,spaceId:r}),p=(0,L().Z1)({environment:t,table:w().lo,spaceId:r}),f=c?(0,L().Z1)({environment:t,table:w().lo,spaceId:r}):void 0,v=P().Wv({id:m,environment:t,type:"form",permissions:(0,a().eb)(),inMemoryRecordCache:n,transaction:i}),g=P().eC({environment:t,table:A().zx,value:{space_id:r,parent_table:C().ev,parent_id:v.id,modules:(0,y().oP)(p,f)},inMemoryRecordCache:n,transaction:i});var I,h;B().zA({stores:[v],update:{form_layout_pointer:{id:g.id,spaceId:r,table:A().zx}},transaction:i}),se({environment:t,questionId:p,spaceId:r,layoutId:g.id,propertyId:s().rn,initialQuestionTitle:(null===(o=d[s().rn])||void 0===o?void 0:o.name)??"",inMemoryRecordCache:n,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1,logData:{area:"form_layout_schema",layoutStore:g}}),c&&f&&u&&se({environment:t,questionId:f,spaceId:r,layoutId:g.id,propertyId:u,initialQuestionTitle:(null===(I=d[u])||void 0===I?void 0:I.name)??"",existingFormQuestionConfig:{propertyId:u,name:[[(null===(h=d[u])||void 0===h?void 0:h.name)??""]],propertyTypeSpecificConfig:{multi_select:{maxSelectionCount:1}}},inMemoryRecordCache:n,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1,logData:{area:"form_layout_schema",layoutStore:g}});return{formBlockStore:v,layoutStore:g}}({environment:o,spaceId:d,inMemoryRecordCache:t.inMemoryRecordCache,transaction:r,schema:n,initializeWithAllDefaultQuestions:i}),c=(0,D().i)({environment:o,collectionViewBlockStore:t,collectionView:{type:"form_editor",parent_id:t.id,parent_table:C().ev,alive:!0,space_id:d,name:H().A.formatMessage(K.newFormViewName),format:{form_block_pointer:{id:l.id,spaceId:d,table:C().ev}}},transaction:r});return P().zv({store:l,data:{parent_id:c.id,parent_table:h().Gy,alive:!0},transaction:r}),X().A.setState({openTooltip:c.id}),z().HH(o,Y),J(o,r),{newViewId:c.id,layoutStore:u,formId:l.id}}function ie(e){const{environment:o,navigateToFormBuilder:t}=e,{currentSpaceStore:r,currentSpaceViewStore:i}=q().default.state;if(!r||!i)return;if(!(0,W().EF)(o))return void(0,W().QY)(o);if(!(r&&r.canEdit()&&i))return;const a=r.id,s=o.idCreator.getSpaceIdCreatorSync(a);O().createAndCommit({environment:o,userAction:"formActions.createAndNavigateToFormInPrivate",canUndo:!0,perform:e=>{var d;const{targetBlockStore:l}=(0,V().j)({environment:o,sourceBlockId:"root",targetBlockPointer:(0,L().zP)({environment:o,table:C().ev,spaceId:a}),sourceBlockSubtree:(0,g().partialRecordMapToRecordMap)(R().mT({isInline:!0,name:(0,_().x9d)(H().A.formatMessage(K.formDatabaseTitle))})),targetRecordCache:r.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,spaceIdCreator:s}),u=l.getCollectionStore(),c=null==u||null===(d=u.getModel())||void 0===d?void 0:d.getNormalizedSchema(),m=l;if(!c)throw new Error("Schema not found");ne({environment:o,transaction:e,collectionViewBlockStore:m,schema:c,initializeWithAllDefaultQuestions:!0}),ae({environment:o,transaction:e,collectionViewBlockStore:m,schema:c}),Q().yM({environment:o,spaceStore:r,spaceViewStore:i,pageStore:l,isPrivate:!0,transaction:e,location:{type:"prepend"}}),t&&N().uK({environment:o,store:l,pageVisitSource:n().y8.CreateFormDeepLink})}})}function ae(e){const{environment:o,collectionViewBlockStore:t,transaction:r}=e,n=t.getSpaceId(),i=Object.keys(e.schema).find((o=>{var t;return"created_by"===(null===(t=e.schema[o])||void 0===t?void 0:t.type)}));(0,D().i)({environment:o,collectionViewBlockStore:t,collectionView:{type:"table",parent_id:t.id,parent_table:C().ev,alive:!0,name:H().A.formatMessage(K.responsesViewName),space_id:n,format:{table_properties:[{property:"title",visible:!0},...i?[{property:i,visible:!0}]:[]],table_wrap:!0,collection_pointer:t.getCollectionPointer()}},transaction:r})}function se(e){const{environment:o,questionId:t,spaceId:r,layoutId:n,propertyId:i,initialQuestionTitle:a,inMemoryRecordCache:s,transaction:d,shouldSyncQuestionNameToPropertyName:l,collectionContextStore:u,shouldLogEvent:c=!0,autofocusTitle:m,existingFormQuestionConfig:p,autoCreatedFromExistingDatabase:f}=e;P().vt({environment:o,table:w().lo,args:{id:t,space_id:r,parentPointer:{id:n,table:A().zx,spaceId:r},config:{...p,propertyId:i,name:[[a]],shouldSyncQuestionNameToPropertyName:l}},inMemoryRecordCache:s,transaction:d}),c&&(0,E().u)({environment:o,event:{eventName:"add_form_question",eventProperties:{...(0,$().YA)({collectionContextStore:u,propertyId:i,questionId:t,area:e.logData.area,parentModuleId:e.logData.parentModuleId,layoutStore:e.logData.layoutStore}),auto_created_from_existing_database:Boolean(f)}}}),m&&m.autofocusedQuestionTextStore.autofocusQuestionTitle({questionId:t})}function de(e){const{type:o,module:t,environment:r,transaction:n,layoutStore:i,position:a,duplicateModuleMapping:s,shouldLogEvent:d=!0,collectionContextStore:l,sessionId:u}=e;let c;const m=t&&s.get(t.id)||(0,S().Ay)();if("formQuestion"===o){var p;const{collectionStore:o,propertyId:u,autofocusTitle:f,existingFormQuestionConfig:y,autoCreatedFromExistingDatabase:g,propertyIdMapping:I}=e,C=o.getSchema()[u];if(!C)throw new Error(`No schema found for property ${u}`);const h=y?(0,_().q4_)(null==y?void 0:y.name):C.name,A=i.getSpaceId(),b=(0,L().Z1)({environment:r,table:w().lo,spaceId:A});if(!(0,v().uW)(a.area))throw new Error("Module is not allowed in this area");se({environment:r,questionId:b,spaceId:A,layoutId:i.id,propertyId:u,initialQuestionTitle:h,inMemoryRecordCache:i.inMemoryRecordCache,transaction:n,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:d,logData:{area:a.area,parentModuleId:null==t?void 0:t.parentModuleId,layoutStore:i},collectionContextStore:l,autofocusTitle:f,existingFormQuestionConfig:y,autoCreatedFromExistingDatabase:g}),c={type:"formQuestion",id:m,formQuestionId:b,...t?{parentModuleId:s.get(t.parentModuleId??"")??t.parentModuleId,parentConditionalGroupId:t.parentConditionalGroupId,conditionalGroups:null===(p=t.conditionalGroups)||void 0===p?void 0:p.map((e=>({...e,trigger:{...e.trigger,property:I.get(e.trigger.property)??e.trigger.property},children:[]})))}:{}}}else c={type:"placeholder",id:m,parentModuleId:s.get(t.parentModuleId??""),parentConditionalGroupId:t.parentConditionalGroupId};return(0,Z().UQ)({environment:r,transaction:n,layoutStore:i,position:a,module:c,sessionId:u,isPropertyCreation:!1}),{moduleId:m}}function le(e){const{environment:o,transaction:t,layoutStore:r,propertyId:n,initialQuestionTitle:i,moduleId:a,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:d,autofocusTitle:l,area:u,sessionId:c}=e,m=r.getModel();if(!m)throw new Error("Layout model cannot be undefined");const p=r.getSpaceId(),f=(0,L().Z1)({environment:o,table:w().lo,spaceId:p});se({environment:o,questionId:f,spaceId:p,layoutId:m.id,propertyId:n,initialQuestionTitle:i,inMemoryRecordCache:r.inMemoryRecordCache,transaction:t,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:d,autofocusTitle:l,logData:{area:u,parentModuleId:"form_conditional_modules"===u?e.parentModuleId:void 0,layoutStore:r}});const v={type:"formQuestion",id:a??(0,S().Ay)(),formQuestionId:f,..."form_conditional_modules"===u?{parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:{}};return a?(0,j().UQ)({environment:o,transaction:t,layoutStore:r,position:{area:u,moduleId:a},updatedModule:v}):"form_conditional_modules"===u&&(0,Z().UQ)({environment:o,transaction:t,layoutStore:r,position:{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:e.parentConditionalGroupId,parentModuleId:e.parentModuleId},module:v,sessionId:c,isPropertyCreation:!1}),{updatedModuleId:v.id,formQuestionId:f}}function ue(e){let{environment:o,formBlockStore:t,isClosed:r}=e;t.getIsFormClosed()!==r&&O().createAndCommit({userAction:"formActions.changeFormClosedState",environment:o,canUndo:!0,perform:e=>{B().zA({stores:[t],update:{form_config:{...t.getFormConfig(),is_form_closed:r}},transaction:e})}})}function ce(e){let{environment:o,formBlockStore:t,permissions:r}=e;t.getFormSubmissionPermissions()!==r&&O().createAndCommit({userAction:"formActions.changeFormSubmissionPermissions",environment:o,canUndo:!0,perform:e=>{B().zA({stores:[t],update:{form_config:{...t.getFormConfig(),submission_permissions:r}},transaction:e})}})}function me(e){let{environment:o,formBlockStore:t}=e;const r=t.getIsFormAnonymousSubmissionEnabled();O().createAndCommit({userAction:"formActions.changeAnonymousFormSubmissionState",environment:o,canUndo:!0,perform:e=>{B().zA({stores:[t],update:{form_config:{...t.getFormConfig(),anonymous_submissions:!r}},transaction:e})}})}function pe(e){var o;let{environment:t,formBlockStore:r}=e;const n=r.getSiteStore();if(!n)return;const i=(null===(o=n.getHeader())||void 0===o?void 0:o.hideWatermark)??!1;O().createAndCommit({userAction:"formBlockStore.publicForm.toggleNotionBranding",environment:t,canUndo:!0,perform:e=>{O().applyOperation({store:n,operation:{pointer:n.pointer,path:["header","hideWatermark"],command:"set",args:!i},transaction:e})}})}function fe(e){let{environment:o,newPropertyId:t,formQuestionStore:r}=e;O().createAndCommit({userAction:"formQuestion.remapQuestionToNewProperty",environment:o,canUndo:!0,perform:e=>{O().applyOperation({store:r,operation:{pointer:r.pointer,path:["config","propertyId"],command:"set",args:t},transaction:e})}})}function ve(e){const{environment:o,collectionSchemaPropertyIds:t,temporaryRecordCache:r,spaceId:n,collectionId:a,formMode:s}=e,d={};t.forEach((e=>{d[e]=(0,_().x9d)("")}));const{performResult:l}=O().createAndCommit({environment:o,userAction:"formActions.createDummyFormPage",perform:e=>{const t=P().Wv({environment:o,type:i().xd.page,inMemoryRecordCache:r,transaction:e,spaceId:n,properties:{...d}});return P().zv({store:t,data:{alive:"viewer"===s,parent_id:a,parent_table:"collection"},transaction:e}),t},canUndo:!1});return l}async function ye(e){const{environment:o,formBlockStore:t,collectionSchema:r,theme:n,onAccept:i}=e;if(!r)return;const a=(0,$().Dx)(t),s=(null==a?void 0:a.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:r}))??[],l=[];if(s.forEach((e=>{const t=e.getPropertyId();if(!t)return;const n=(0,d()._g)({schema:r,property:t}),i=null==n?void 0:n.type;if(!i)return;(0,$().CK)({environment:o,propertyType:i,propertySchema:n,isPublicForm:!0})&&l.push(e)})),0===l.length)return void i();const c=l.map(((e,o)=>{const t=(0,I().r4)({textValue:e.getNameStore().getValue(),getRecordModel:e.getRecordModel,deterministic:!0,userTimeZone:(0,u().P)(),intl:H().A.getIntl()}),r=o===l.length-1;return(0,m.jsx)("div",{style:{fontSize:14,textAlign:"start",padding:"8px 12px",borderBottom:r?void 0:`1px solid ${n.lightDividerColor}`},children:t},e.id)})),{accept:p}=await T().Gh({message:(0,m.jsx)(b().sA,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.message",defaultMessage:"These questions are not supported in public forms and will not be shown to respondents:"}),description:(0,m.jsx)("div",{style:{borderRadius:6,border:`1px solid ${n.lightDividerColor}`,width:"calc(100% + 24px)",marginLeft:-12,marginTop:12,maxHeight:210,overflow:"auto"},children:c}),acceptLabel:(0,m.jsx)(b().sA,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.acceptLabel",defaultMessage:"Got it"}),acceptColor:"blue",cancelButtonType:"plain",mode:"wide"});p&&i()}},978846:(e,o,t)=>{t.d(o,{E:()=>g,UQ:()=>I});t(16280),t(18107),t(944114),t(967357);var r=()=>t(31503),n=()=>t(792071),i=()=>t(688728),a=()=>t(500993),s=()=>t(369186),d=()=>t(475140),l=()=>t(120997),u=()=>t(251822),c=()=>t(778781),m=()=>t(496603),p=()=>t(534177),f=()=>t(751156),v=()=>t(447934),y=()=>t(204521);function g(e){const{moduleId:o,layoutStore:t,sessionId:n,environment:a,position:s}=e,d=t.getModuleById(o);if(!d)throw new Error(`Cannot move module with id ${o} because a module with that id is not in the layout`);const l=(0,y().TR)({modulesByArea:t.getModules(),moduleId:o,newPosition:s});C({...e,module:d,userAction:"BuilderLayoutModules.moveModuleToPosition",afterUpsertTransaction:()=>{var e;const o=(0,r().Cg)({moduleId:d.id,modulesByArea:t.getModules()}).length;(0,y().Ib)({environment:a,sessionId:n,collectionId:null===(e=t.getCollectionModel())||void 0===e?void 0:e.id,layoutId:t.id,context:(0,i().We)(s.area),action:l,moduleType:d.type,area:s.area,depth:o})}})}function I(e){const{position:o,module:t,layoutStore:n,sessionId:a,environment:s}=e;if(n.getModuleById(t.id))throw new Error(`Cannot add module with id ${t.id} because a module with that id is already in the layout`);C({...e,userAction:"BuilderLayoutModules.addModuleAtPosition",performBeforeApplyUpsertOperations:e=>{const{transaction:r}=e;"page_main"!==o.area&&"page_details"!==o.area||(0,c().gx)(t)&&(0,v().HD)({environment:s,transaction:r,layoutStore:n,property:t.propertyId})},afterUpsertTransaction:()=>{var d;const l=(0,r().Cg)({moduleId:t.id,modulesByArea:n.getModules()}).length;(0,y().zb)({environment:s,module:t,sessionId:a,collectionId:null===(d=n.getCollectionModel())||void 0===d?void 0:d.id,layoutId:n.id,context:(0,i().We)(o.area),isPropertyCreation:e.isPropertyCreation,area:o.area,depth:l})}})}function C(e){const{environment:o,position:t,layoutStore:r,module:u,transaction:c,userAction:m,performBeforeApplyUpsertOperations:v,afterUpsertTransaction:y}=e,g=r.pointer,I=r.getModules(),C=r.getRawModules(),_=C&&(0,d().c7)(C,(e=>e.id===u.id))||(0,s().Lv)(u),b="page_main"===t.area||"page_details"===t.area?function(e){const{layoutPointer:o,modulesByArea:t,rawModulesByArea:r}=e,a=(0,d().EX)(t,(e=>"relationsGroup"===e.type));if("form_conditional_modules"===(null==a?void 0:a.position.area))return;const l=r&&(0,d().LC)(r,(e=>"relationsGroup"===e.type));if(!a)return;if(a&&l)return;const u=a.module;if(!u||"relationsGroup"!==u.type)throw new Error("relations group module location in normalized was incorrect, cannot backfill relations group module");return function(e){var o;const{module:t,modulesByArea:r,layoutPointer:a}=e,l=(0,d().JO)(r,(e=>e.id===t.id));if(!l)throw new Error("cannot upsert module at current position because module does not have a current position");if("form_conditional_modules"===l.area)throw new Error("[Forms Conditional Logic Not Implemented] form_conditional_modules area is not supported for adding and moving modules");const u="views_main_tab_modules"===l.area?null===(o=r.views_main_tab_modules)||void 0===o?void 0:o[l.viewId]:r[l.area];if(!u||0===u.length)throw new Error("cannot upsert module at current position in area because that area is empty");const c={module:(0,s().Lv)(t),pointer:a,..."views_main_tab_modules"===l.area?{area:i().Zm[l.area],viewId:l.viewId}:{area:i().Zm[l.area]}};if(0===l.index)return n().N4X.putModuleAfter({...c,afterId:void 0});const m=u.at(l.index+1);if(!m)return n().N4X.putModuleAfter({...c,afterId:void 0});return n().N4X.putModuleBefore({...c,beforeId:m.id})}({module:u,layoutPointer:o,modulesByArea:t})}({layoutPointer:g,modulesByArea:I,rawModulesByArea:C}):null;b&&f().createAndCommitOrAppend({environment:o,perform:e=>{f().applyOperation({transaction:e,store:r,operation:b})},canUndo:!0,transaction:c,userAction:`${m||"BuilderLayoutModules.upsert"}.preOpBackfill`});const S=[],M=function(e){const{layoutStore:o,module:t,upsertPosition:r}=e,a=o.getModules(),s=(0,d().JO)(a,(e=>t.id===e.id));if(!s)return;if("form_conditional_modules"===s.area)return n().N4X.deleteModuleInArea({pointer:o.pointer,area:s.area,moduleId:t.id});if("views_main_tab_modules"===s.area){const e="absolute"===r.type&&"views_main_tab_modules"===r.area?r.viewId:void 0,i=s.viewId;if(e===i)return;return n().N4X.deleteModuleInArea({pointer:o.pointer,area:s.area,moduleId:t.id,viewId:i})}if("page_main"===s.area||"page_details"===s.area||"form_layout_schema"===s.area||"person_profile_page_main"===s.area||"person_profile_page_details"===s.area){if(s.area===r.area)return;return n().N4X.deleteModuleInArea({pointer:o.pointer,area:i().Zm[s.area],moduleId:t.id})}(0,p().HB)(s.area)}({upsertPosition:t,module:u,layoutStore:r});M&&S.push(M);const x=function(e){const{upsertPosition:o,layoutPointer:t,modulesByArea:r,rawModuleToUpsert:s}=e;if("absolute"===o.type)return function(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:s}=e,u=(0,d().JO)(s,(e=>t.id===e.id)),{area:c}=o;if("form_conditional_modules"===c){const{parentConditionalGroupId:e,parentModuleId:i}=o;if(!(0,l().V)(t,"form_conditional_modules"))throw new Error("Can only add form question or placeholder modules to form_conditional_modules area.");const u=(0,d().Ib)({modulesByArea:s,find:e=>e.id===t.parentModuleId}),c=(0,a().A)(i,s);return n().N4X.upsertChildModule({pointer:r,module:t,previousParentModuleAndArea:u,newParentModule:{area:c.area,module:c.module,conditionalGroupId:e,index:o.index},modulesByArea:s})}const m=o.index;if(m<0)throw new Error(`Cannot upsert module with id ${t.id} to a negative position`);if("views_main_tab_modules"===c){const e=o.viewId;if(!s[c]||!s[c][e])throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");const a="views_main_tab_modules"===(null==u?void 0:u.area)&&(null==u?void 0:u.viewId)===e?u.index:void 0,d=h({modulesInArea:s[c][e],indexOfModuleToUpsertInArea:a,indexToUpsertTo:m});if(!d)return;return[n().N4X.putModuleBeforeOrAfter({pointer:r,area:i().Zm[c],viewId:e,module:t,direction:d.insertDirection,beforeOrAfterId:d.beforeOrAfterId})]}const p=s[c],f=(null==u?void 0:u.area)===c?u.index:void 0,v=h({modulesInArea:p,indexOfModuleToUpsertInArea:f,indexToUpsertTo:m});if(!v)return;return[n().N4X.putModuleBeforeOrAfter({pointer:r,area:i().Zm[c],module:t,direction:v.insertDirection,beforeOrAfterId:v.beforeOrAfterId})]}({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:r});if("module_relative"===o.type)return[w({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:r})];if("area_relative"===o.type)return[A({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:r})];(0,p().HB)(o)}({module:u,upsertPosition:t,modulesByArea:I,layoutPointer:g,rawModuleToUpsert:_});x&&S.push(...x);const T="placeholder"===u.type&&"form_layout_schema"===t.area?`form_layout_new_question_${u.id}`:void 0;f().createAndCommitOrAppend({environment:o,undoCheckpoint:T,canUndo:!0,perform:e=>{v&&v({transaction:e});for(const o of S)f().applyOperation({transaction:e,store:r,operation:o})},transaction:c,userAction:m||"BuilderLayoutModules.upsert"}),y&&y()}function h(e){const{modulesInArea:o,indexOfModuleToUpsertInArea:t,indexToUpsertTo:r}=e;if(0===r||0===o.length)return{insertDirection:"before",beforeOrAfterId:void 0};const n=o.at(r);return n?void 0===t?{insertDirection:"before",beforeOrAfterId:n.id}:t!==r?t<r?{insertDirection:"after",beforeOrAfterId:n.id}:{insertDirection:"before",beforeOrAfterId:n.id}:void 0:{insertDirection:"after",beforeOrAfterId:void 0}}function w(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:a}=e,{area:s,direction:l,relativeToModuleId:u}=o,c=i().Zm[s],m=(0,d().JO)(a,(e=>e.id===u));if(!m||m.area!==s)throw new Error(`Cannot find module with id: ${u} to add upsert relative to in ${s}`);if("views_main_tab_modules"===c){const e="views_main_tab_modules"===m.area?m.viewId:void 0;if(!e)throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");return n().N4X.putModuleBeforeOrAfter({pointer:r,area:"views_main_tab_modules",viewId:e,module:t,direction:"above"===l?"before":"after",beforeOrAfterId:u})}return n().N4X.putModuleBeforeOrAfter({pointer:r,area:c,module:t,direction:"above"===l?"before":"after",beforeOrAfterId:u})}function A(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:a}=e,{location:s}=o;if("views_main_tab_modules"===o.area){const e=o.viewId,l={pointer:r,area:i().Zm[o.area],viewId:e,module:t};if("start"===s||"end"===s)return n().N4X.putModuleBeforeOrAfter({...l,direction:"start"===s?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===s){var d;const e=_({area:o.area,modulesInArea:(null===(d=a.views_main_tab_modules)||void 0===d?void 0:d[o.viewId])??[]});return n().N4X.putModuleBeforeOrAfter({...l,direction:e.insertDirection,beforeOrAfterId:e.beforeOrAfterId})}(0,p().HB)(s)}const l={pointer:r,area:i().Zm[o.area],module:t};if("start"===s||"end"===s)return n().N4X.putModuleBeforeOrAfter({...l,direction:"start"===s?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===s){const e=a[o.area],t=_({area:o.area,modulesInArea:e});return n().N4X.putModuleBeforeOrAfter({...l,direction:t.insertDirection,beforeOrAfterId:t.beforeOrAfterId})}(0,p().HB)(s)}function _(e){const{area:o,modulesInArea:t}=e,{nonMoveableHeaderModules:r,moveableModules:n,nonMoveableFooterModules:i}=(0,u().jS)(o,t);if(n.length){const e=(0,m().HV)(n);if(!e)throw new Error("cannot find last moveable module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(r.length){const e=(0,m().HV)(r);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(i.length){const e=i.at(0);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"before",beforeOrAfterId:e.id}}return{insertDirection:"after",beforeOrAfterId:void 0}}}}]);