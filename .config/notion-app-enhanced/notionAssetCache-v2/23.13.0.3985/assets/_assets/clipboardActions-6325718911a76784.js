"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2411,5834,22542,34208,59388,69184,90871],{53592:(e,t,o)=>{o.r(t),o.d(t,{attemptServerBackedLocalDuplicate:()=>T,serverBackedLocalDuplicate:()=>M});o(944114),o(581454);var n=()=>o(857639),r=()=>o(386164),i=()=>o(388821),a=()=>o(912720),s=()=>o(199378),c=()=>o(502800),l=()=>o(763824),d=()=>o(466614),u=()=>o(449506),p=()=>o(666144),m=()=>o(751156),g=()=>o(974233),f=()=>o(611191),v=()=>o(603815),b=()=>o(261450),k=()=>o(503388),y=()=>o(966152),h=()=>o(59110),S=()=>o(605605),I=()=>o(677733);function M(e){const{environment:t,sourceBlock:o,targetInMemoryRecordCache:n,transaction:r,options:a,targetSpaceId:s,installationImprint:c,templateInstallationMetadata:d={},shouldUseSynchronousDuplicationAPI:u,stopwatch:p}=e,m=performance.now();null==p||p.mark("server_duplicate_start");const g=e.copyIndicators??(0,k().U8)({environment:t,sourceBlocks:[o],targetRecordCache:n,transaction:r,spaceId:s});null==p||p.mark("create_copy_indicators");const f=l().yX();return r.postSubmitCallbacks.push((async e=>{if(null==p||p.mark("transaction_post_submit_callback"),e)return(0,y().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:g.map((e=>e.id)),error:e,targetSpaceId:s,options:a}}),void(0,k().Jc)(e,f);(0,k().Yj)(g),null==p||p.mark("initialize_copy_indicators_progress_state");const{success:n,size:l}=await T({environment:t,sourceBlockPointer:o,targetBlockStore:g[0],options:a,templateInstallationMetadata:d,stopwatch:p});if(n)return(0,b().E)({environment:t,success:!0,time:performance.now()-m,user_action:r.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:l,method:"server_backed_local_duplication"}),null==p||p.mark("server_backed_local_duplicate_success"),(0,k().dH)(g),void f.resolve({status:"success"});const v=await(0,I().performServerDuplicate)({environment:t,copyIndicators:g,sourceBlocks:[o],targetSpaceId:s,options:a,templateInstallationMetadata:d,installationImprint:c,shouldUseSynchronousDuplicationAPI:u,stopwatch:p});if((0,k().dH)(g),!v.success)return(0,k().uC)({environment:t,copyIndicators:g}),(0,y().P0)({environment:t,type:"server_duplicate_iterator_error",data:{errorMessage:v.errorMessage}}),void f.resolve({status:"error",errorMessage:v.errorMessage,error:v.error});(0,b().E)({environment:t,success:!0,time:performance.now()-m,user_action:r.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:v.size,method:"sbld_fallback_server_duplication"}),null==p||p.mark("server_duplicate_success"),f.resolve({status:"success",recordIdMap:v.recordIdMapJson?i().RecordMapPolymorphic.create(v.recordIdMapJson):void 0})})),{blockStores:g,onComplete:f.promise}}async function T(e){const{environment:t,sourceBlockPointer:o,targetBlockStore:l,options:b,templateInstallationMetadata:k,recordLimit:I=500,targetInMemoryRecordCache:M,stopwatch:T}=e;null==T||T.mark("attempt_server_backed_local_duplicate_start"),(0,y().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate",data:{sourceBlockPointer:o,targetBlockStore:l,targetSpaceId:l.getSpaceId(),options:b}});const C=(0,f().$J)(),x=await async function(e){const{environment:t,sourceBlockPointer:o,targetBlockStore:a,targetInMemoryRecordCache:s,options:l,enableLegacyTransclusionFixing:d,recordLimit:m}=e,f=s??a.inMemoryRecordCache,b={blockId:o.id,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!l.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!l.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:d,inMemoryRecordCache:f};let k;if(k=(0,h().loadLocalSubtree)(t,b),!k.recordMap&&f===t.defaultRecordCache.inMemoryRecordCache)try{(0,y().JW)({environment:t,type:"performInexactPagePreload",data:{message:"No local subtree found, performing performInexactPagePreload",loadLocalSubtreeArgs:b}}),await(0,v().A$)(t,{table:"block",id:o.id,spaceId:o.spaceId}),k=(0,h().loadLocalSubtree)(t,b)}catch(S){n().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"persistedRecordCachePreloadError",error:(0,c().convertErrorToLog)(S),data:{message:"Failed to preload subtree from persisted record cache"}})}k.recordMap||((0,y().JW)({environment:t,type:"loadLocalSubtreeApi",data:{message:"No local subtree found from previous attempts, attemping API call to loadBlockSubtree",currentLocalSubtreeResponse:k}}),k=await async function(e){const{environment:t,sourceBlockPointer:o,recordLimit:a,targetBlockStore:s,loadLocalSubtreeArgs:l}=e;try{const e=await u().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:o.id,spaceId:o.spaceId},shallow:!1,recordCountLimit:a},headers:(0,r().WS)({spaceId:o.spaceId})});if((0,y().JW)({environment:t,type:"loadBlockSubtreeApiResult",data:{message:"Result from loadBlockSubtree API call",subtreeResult:e,apiArgs:{block:{id:o.id,spaceId:o.spaceId},shallow:!1,recordCountLimit:a}}}),"success"===e.type){const o=i().RecordMapWithRole.create(e.data.subtreeRecordMap);return await p()._O({environment:t,inMemoryRecordCache:l.inMemoryRecordCache,recordMap:o,debugSource:"load_local_subtree_from_server"}),(0,h().loadLocalSubtree)(t,l)}{const t=(0,g().V)(e);n().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"loadBlockSubtreeFailure",data:{message:"Error fetching subtree",miscDataToConvertToString:{error:t,sourceBlockPointer:o,cacheSize:s.inMemoryRecordCache.size,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}})}}catch(S){n().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,c().convertErrorToLog)(S),data:{message:"Error loading subtree",miscDataToConvertToString:{sourceBlockPointer:o,cacheSize:s.inMemoryRecordCache.size,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}})}}({environment:t,sourceBlockPointer:o,recordLimit:m,targetBlockStore:a,loadLocalSubtreeArgs:b}));k&&!k.recordMap&&n().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadFailure",data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:o,cacheSize:a.inMemoryRecordCache.size,reason:"error"===k.type?k.reason:void 0,targetBlockPointer:{id:a.id,spaceId:a.getSpaceId(),type:a.getType()},missingRecord:"error"===k.type?k.pointer:void 0}}});return k}({environment:t,sourceBlockPointer:o,targetBlockStore:l,targetInMemoryRecordCache:M,options:b,enableLegacyTransclusionFixing:C,recordLimit:I});if(null==T||T.mark("try_load_local_subtree_finished"),!x||!x.recordMap)return{success:!1,size:void 0,pageStore:l};var w;if(d().Lw({sourceSpaceId:o.spaceId,targetSpaceId:l.getSpaceId(),sourceBlockSubtree:x.recordMap}))return n().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"accessLockingWarning",data:{message:"Unable to perform local duplication",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==T||T.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(w=x.recordMap)||void 0===w?void 0:w.getSize(),pageStore:l};for(const r of x.recordMap.getTables()){var A;if(r===a().yB||r===s().SC)return n().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"invalidRecordType",data:{message:"Local duplication does not support automation tables",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==T||T.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(A=x.recordMap)||void 0===A?void 0:A.getSize(),pageStore:l}}try{var _;(0,y().JW)({environment:t,type:"server_backed_duplicate_start_transaction",data:{message:"Starting transactionActions.createAndCommit for localDuplicate",sourceBlockPointer:o,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}});const{serverCommitResult:e}=m().createAndCommit({userAction:"server_backed_local_duplicate",environment:t,canUndo:!0,isTemplateInstantiationTransaction:Boolean(k),perform:e=>(0,S().localDuplicate)({environment:t,sourceBlockId:o.id,targetBlockPointer:l.pointer,sourceBlockSubtree:x.recordMap,targetInMemoryRecordCache:l.inMemoryRecordCache,transaction:e,templateInstallationMetadata:k,stopwatch:T,options:{...b,preventLegacyTransclusions:C}})});return await e,null==T||T.mark("server_backed_local_duplicate_finished"),(0,y().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate_success",data:{targetSpaceId:l.getSpaceId(),options:b}}),{success:!0,size:null===(_=x.recordMap)||void 0===_?void 0:_.getSize(),pageStore:l,transactionPromise:e}}catch(P){var D;return n().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,c().convertErrorToLog)(P),data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),{success:!1,size:null===(D=x.recordMap)||void 0===D?void 0:D.getSize(),pageStore:l}}}},136833:(e,t,o)=>{function n(e){return Date.now()-parseInt(e.timestamp)}o.d(t,{S:()=>n})},487494:(e,t,o)=>{o.d(t,{A:()=>r});var n=function(e){return e[e.Preview=0]="Preview",e[e.Mention=1]="Mention",e[e.Link=2]="Link",e}(n||{});const r=n},552484:(e,t,o)=>{o.r(t),o.d(t,{clipboardMessages:()=>Nt,copy:()=>ko,copyDirectLinkToContent:()=>Go,copyFormattedLinkToBlock:()=>$o,copyHtml:()=>Zo,copyLinkToBlock:()=>jo,copyLinksToBlocks:()=>Jo,copyString:()=>qo,copyWithToast:()=>Yo,createSelectedMultiColumnBlockSubtree:()=>lo,cutWithMaybeConfirmation:()=>bo,getFormulaEditorInformation:()=>Lo,getInlineTextValueFromClipboardData:()=>on,getInlineTitleValueFromClipboardTextHtml:()=>wo,getNotionSelectionClipboardData:()=>ao,htmlToMultiTextSelectionClipboardData:()=>xo,insertOrTransformToCodeBlock:()=>zo,markdownToBlocks:()=>tn,multiTextSelectionToMarkdown:()=>en,paste:()=>Vo,pasteFilesForBlocks:()=>yo,pasteMarkdown:()=>To,serializeMultiTextSelectionToClipboardData:()=>mo,serializePagePropertiesAsText:()=>uo,triggerBrowserCopy:()=>Qo});var n={};o.r(n),o.d(n,{clipboardMessages:()=>Nt,copy:()=>ko,copyDirectLinkToContent:()=>Go,copyFormattedLinkToBlock:()=>$o,copyHtml:()=>Zo,copyLinkToBlock:()=>jo,copyLinksToBlocks:()=>Jo,copyString:()=>qo,copyWithToast:()=>Yo,createSelectedMultiColumnBlockSubtree:()=>lo,cutWithMaybeConfirmation:()=>bo,getFormulaEditorInformation:()=>Lo,getInlineTextValueFromClipboardData:()=>on,getInlineTitleValueFromClipboardTextHtml:()=>wo,getNotionSelectionClipboardData:()=>ao,htmlToMultiTextSelectionClipboardData:()=>xo,insertOrTransformToCodeBlock:()=>zo,markdownToBlocks:()=>tn,multiTextSelectionToMarkdown:()=>en,paste:()=>Vo,pasteFilesForBlocks:()=>yo,pasteMarkdown:()=>To,serializeMultiTextSelectionToClipboardData:()=>mo,serializePagePropertiesAsText:()=>uo,triggerBrowserCopy:()=>Qo});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(430670),o(803949),o(581454),o(908872),o(737550);var r=o.n(o(842838)),i=()=>o(208360),a=()=>o(221844),s=()=>o(908006),c=()=>o(764880),l=()=>o(584262),d=()=>o(700500),u=()=>o(970013),p=()=>o(921940),m=()=>o(304740),g=()=>o(634201),f=()=>o(856197),v=()=>o(683259),b=()=>o(107041),k=()=>o(522419),y=()=>o(80979),h=()=>o(977345),S=()=>o(857639),I=()=>o(236162),M=()=>o(416504),T=()=>o(753514),C=()=>o(206267),x=()=>o(777447),w=()=>o(945778),A=()=>o(997769),_=()=>o(128713),D=()=>o(792071),P=()=>o(134025),B=()=>o(476158),R=()=>o(754199),F=()=>o(388821),L=()=>o(696706),E=()=>o(450648),O=()=>o(861017),W=()=>o(179034),N=()=>o(519831),U=()=>o(343666),V=()=>o(161479),z=()=>o(994310),H=()=>o(919709),X=()=>o(439180),j=()=>o(191772),$=()=>o(173979),J=()=>o(708830),G=()=>o(445120),Z=()=>o(959013),q=()=>o(381349),K=()=>o(496603),Q=()=>o(498212),Y=()=>o(183558),ee=()=>o(534177),te=()=>o(939768),oe=()=>o(466614),ne=()=>o(921385),re=()=>o(807700),ie=()=>o(450510),ae=()=>o(404779),se=()=>o(413962),ce=()=>o(780054),le=()=>o(518736),de=()=>o(568131),ue=()=>o(59110),pe=()=>o(605605),me=()=>o(375078),ge=()=>o(267419),fe=()=>o(186445),ve=()=>o(951177),be=()=>o(909470),ke=()=>o(808237),ye=()=>o(492414),he=()=>o(594794),Se=()=>o(611191),Ie=()=>o(972435),Me=()=>o(231722),Te=()=>o(962845),Ce=()=>o(299545),xe=()=>o(969197),we=()=>o(53664),Ae=()=>o(906537),_e=()=>o(792002),De=()=>o(847463),Pe=()=>o(129522),Be=()=>o(301421),Re=()=>o(919878),Fe=()=>o(980914),Le=()=>o(562800),Ee=()=>o(24973),Oe=()=>o(765957),We=()=>o(673898),Ne=()=>o(227440),Ue=()=>o(77246),Ve=()=>o(217429),ze=()=>o(53137),He=()=>o(732770),Xe=()=>o(630116),je=()=>o(502438),$e=()=>o(24157),Je=()=>o(611371),Ge=()=>o(559926),Ze=()=>o(209660),qe=()=>o(812182),Ke=()=>o(755199),Qe=()=>o(680074),Ye=()=>o(522094),et=()=>o(160475);function tt(e){var t;const{originalHtmlContentSize:o,environment:n}=e;if(o<500)return;const r=(0,Qe().R$)(n),i=null==r||null===(t=r.getSettings())||void 0===t?void 0:t.adoption_entry_points,a=i?i.import_nudge_on_large_paste:void 0;if(a){const e=Ve().default.getConfigKey("adoption_entry_point_time_delta","import_nudge_on_large_paste"),t=a[a.length-1];if(!(Date.now()-t>e.view_delta))return}"nudge_on_large_paste"===Ve().default.getEligibleGroup({experimentId:"adoption_import_entry_point",defaultGroup:"control"})&&((0,et().t)({environment:n,action:"view",from:"import_nudge_on_paste"}),qe().Iz({message:Ie().A.formatMessage(ot.triggerNudgeOnPasteDescription),presentationType:"persistent",id:"nudge-on-paste",title:Ie().A.formatMessage(ot.triggerNudgeOnPasteTitle),onUserDismiss:()=>{(0,et().t)({environment:n,action:"dismiss",from:"import_nudge_on_paste"})},onDismiss:()=>{Ke().pr(n,{entryPoint:"import_nudge_on_large_paste"})},actions:{primary:{title:Ie().A.formatMessage(ot.triggerNudgeOnPastePrimaryAction),onAction:()=>{const e=Ye().A.getOrCreateFlowId();(0,et().t)({environment:n,action:"click",from:"import_nudge_on_paste"}),Ge().kY(n,{from:"import_nudge_on_paste",flowId:e}),qe().UW("nudge-on-paste"),Ze().Ow({currentTab:"imports",openedFrom:"import_nudge_on_paste"})}}}}))}const ot=(0,Z().YK)({triggerNudgeOnPasteTitle:{id:"adoption.nudgeOnPaste.title",defaultMessage:"Import content directly"},triggerNudgeOnPasteDescription:{id:"adoption.nudgeOnPaste.description",defaultMessage:"Get all your content into Notion with a click"},triggerNudgeOnPastePrimaryAction:{id:"adoption.nudgeOnPaste.primaryAction",defaultMessage:"Import now"}});var nt=()=>o(970330),rt=()=>o(679924),it=()=>o(136833);var at=()=>o(541372),st=(o(16280),o(672577),()=>o(741237)),ct=()=>o(842989),lt=()=>o(220719),dt=()=>o(44729),ut=()=>o(534402),pt=()=>o(108944),mt=()=>o(20313),gt=()=>o(695625),ft=()=>o(257216),vt=()=>o(319975),bt=()=>o(725614);function kt(e){var t;const{environment:o,clipboardData:n,transaction:r,allowPasteIntoHeaderWithoutChildren:i,selectAll:a,preventLegacyTransclusions:c}=e;if($e().default.isEditingComment()||(0,_e().X4)())return!1;if(function(e,t){return e.blockSelection.blocks.some((e=>{var o;if(!e.blockSubtree)return!0;const n=null===(o=e.blockSubtree.getModel({id:e.blockId,table:W().ev}))||void 0===o?void 0:o.spaceId;return!!(n&&t&&oe().Lw({sourceSpaceId:n,targetSpaceId:t,sourceBlockSubtree:e.blockSubtree}))||void 0}))}(n,null===(t=Oe().default.state.currentSpaceStore)||void 0===t?void 0:t.id))return!1;const l=$e().default.state;if("editing"!==l.mode)return!1;const u=l.multiSelection.start.store;if(!u.isTable(W().ev))return!1;const p=(0,xe().T)(u);if(!p)return!1;if(u!==p.getBlockTitleStore())return!1;const m=p.getType(),g=p.getFormat();if(!m)return!1;if(!((0,d().IU)(m,g)||i&&(0,d().CN)(m)))return!1;if(i&&(0,d().CN)(m)){const e=n.blockSelection.blocks[0],t=null==e?void 0:e.blockId,o=null==e?void 0:e.blockSubtree,r=t&&o?o.getModel({id:t,table:"block"}):void 0;if(Boolean(null==r?void 0:r.getContentLength()))return!1}const f=(0,mt().Ag)({includeNonSelectableListContainer:!0});if(!f)return!1;const v=(0,mt().Xs)(p,[f]);if(!v)return!1;let b=0;for(let s=v.length-1;s>=0;s--){const e=v[s].value.store,t=gt().T.findSelectableFromStore(e),o=e.getModel();if(null!=o&&o.isType(d().U6)||t&&!t.props.canSelect){b=s;break}}const k=v.slice(b);if(0===k.length)return!1;const y=k[0].value.store,h=y.pointer.spaceId,S=(0,re().l)(y);r.logDebugMessage("pasteMultiTextSelection: pasting",k,{spaceId:h,pastingIntoTemplate:S,insertionPathRootStore:y});const I=n.blockSelection.blocks.map((e=>{var t;let{blockId:n,blockSubtree:i}=e;if(!i)throw new Error("Missing data for local duplicate block during paste");const a=(null===(t=i.getModel({table:W().ev,id:n}))||void 0===t?void 0:t.getType())===d().xd.factory,s=!(S||a),l=Xe().Bv.createChildStore(y,{table:W().ev,id:n}),u=(0,pe().localDuplicate)({environment:o,sourceBlockId:n,targetBlockPointer:(0,he().zP)({environment:o,table:W().ev,spaceId:h}),sourceBlockSubtree:i,targetInMemoryRecordCache:y.inMemoryRecordCache,transaction:r,options:{addCopyName:(0,we().A)(l),allowRedundancy:!1,deepCopyTransclusionContainers:!1,preventLegacyTransclusions:c,resolveTemplateVariables:s}}),m=u.targetBlockStore.getType();return m&&nt().v(o,{from:"paste",type:m,new_page_id:"page"===m?u.targetBlockStore.id:void 0,creating_block_id:u.targetBlockStore.id,parent_collection_id:p.getParentCollectionIdUpToTwoLevels()}),u})),M=n.multiTextSelection.start.pointerPath,T=n.multiTextSelection.end.pointerPath,C=[],x=[],w=Math.max(M.length,T.length),A=(k[k.length-w]||k[0]).value.store,_=(0,J().v)({node:n.tree,recordStoreParent:A},(e=>{let{node:t,recordStoreParent:o}=e;const n=((e,t)=>{let o;for(const{originalToDuplicate:n}of I)if(o=n.get(t),o)break;if(o)return Xe().Bv.createChildStore(e,o)})(o,t.value),r=C.length<M.length?M[C.length]:void 0,i=x.length<T.length?T[x.length]:void 0;let a=!1;if((null==r?void 0:r.id)===t.value.id&&(a=!0,C.push(n)),(null==i?void 0:i.id)===t.value.id&&(a=!0,x.push(n)),!a)return{value:{store:n}};const s=(null==n?void 0:n.getContentStore())||y;return{value:{store:n},children:t.children.map((e=>({node:e,recordStoreParent:s})))}}));if(C.length!==M.length||0===C.length)throw new Error(`Failed to hydrate start path during paste (found ${C.length} of ${M.length})`);if(x.length!==T.length||0===x.length)throw new Error(`Failed to hydrate end path during paste (found ${x.length} of ${T.length})`);const D=C[C.length-1],P=x[x.length-1];if(!D||!P)throw new Error(`Failed to hydrate position during paste (${D?"":"missing start"} ${P?"":"missing end"})`);const B=(0,J().Qe)([_],(e=>e.value.store===D)),R=(0,J().Qe)([_],(e=>e.value.store===P)),F=B&&R&&ct().W.fromNearestCommonAncestor(B,R);if(!F)throw new Error(`Failed to build range for paths: ${B?"":"missing start"} ${R?"":"missing end"}`);vt().f0({environment:o,multiSelection:l.multiSelection,transaction:r});const L=$e().default.state,E="editing"===L.mode?L.multiSelection:l.multiSelection;if((0,Ce().P4)(p)&&0===n.multiTextSelection.start.textIndex){const e=D.getType();e&&(0,d().aO)(e)&&me().transformBlocks({environment:o,blocks:[p],blockType:e,transaction:r})}let O;return y.useCrdt()?(ht({transaction:r,clipboardData:n,startBlockStore:p,duplicateStartStore:D,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:y}),O=yt({environment:o,transaction:r,clipboardData:n,insertionPoint:E,textSelectionState:l,duplicateEndStore:P,pastingIntoTemplate:S}).newSelectionIndex):(O=yt({environment:o,transaction:r,clipboardData:n,insertionPoint:E,textSelectionState:l,duplicateEndStore:P,pastingIntoTemplate:S}).newSelectionIndex,ht({transaction:r,clipboardData:n,startBlockStore:p,duplicateStartStore:D,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:y})),s().default.afterNextFlush((()=>{const e=(0,mt().PY)({rootStore:y,root:f,target:F.end}),t=e&&(0,xe().aI)(e[e.length-1]);if(!t)return;const o={start:{index:a?E.start.index:O,store:a?E.start.store:t},end:{index:O,store:t}};bt().setMultiSelection({multiSelection:o})})),!0}function yt(e){const{insertionPoint:t,duplicateEndStore:o,pastingIntoTemplate:n,environment:r,transaction:i,clipboardData:a}=e;let s=0;const c=t.end.store,l=t.end.index,d=(0,xe().aI)(o);if(d){s=H().qAZ(d.getValue()).length;const e=(0,lt().o9)((0,xe().T)(c)),t=(0,lt().o9)((0,xe().T)(d));le().Le({store:c,blockStore:e})&&le().Le({store:d,blockStore:t})?(ut().X0({sourceBlockStore:e,targetBlockStore:t,splitAtGraphemeIndex:l,transaction:i,moveIntoNewBlock:!1}),i.logDebugMessage("(CRDT) pasted suffix into end",d)):(vt().jN({environment:r,sourceStore:c,sourceIndex:l,targetStore:d,targetIndex:s,transaction:i}),i.logDebugMessage("pasted suffix into end",d))}else vt().jQ({environment:r,transaction:i,store:c,selection:{startIndex:l,endIndex:1/0}}),i.logDebugMessage("no end title store to paste text into");let u=H().Uee(a.multiTextSelection.start.copiedText,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0});return n||(u=(0,$().f$)(u,{currentUserId:r.currentUser.id,currentTimeZone:(0,M().P)()})),vt().yr({environment:r,index:t.start.index,store:t.start.store,tokens:u,transaction:i}),{newSelectionIndex:s}}function ht(e){const{transaction:t,clipboardData:o,startBlockStore:n,duplicateStartStore:r,insertionPath:i,insertionPathRootStore:a,duplicates:s,range:c}=e,l=Ve().default.checkGate({gateName:"prefer_high_level_operations"});for(const p of c.iterateInsertionAt(i))(0,mt().eM)({transaction:t,treeOperation:p,deleteFrom:"tree-parent",preferHighLevelOperations:l}),st().O.applyMutable(p);if(o.blockSelection.wasContiguousSelection&&o.blockSelection.blocks.length>0&&!n.hasContent())for(const p of r.getContentStores())dt().NI({parentStore:n.getContentStore(),childStore:p,transaction:t});const d=new Set;for(const{originalToDuplicate:p}of s){const e=p.getByTable(W().ev);for(const{value:o}of e){var u;if(!o||d.has(o.id))continue;d.add(o.id);const e=Xe().Bv.createChildStore(r,o),n=(0,pt().g7)(e),i="transclusion_reference"===a.getType()?null===(u=a.getTransclusionReferenceTargetStore())||void 0===u?void 0:u.id:a.id;n.find((e=>e.id===i))||(t.logDebugMessage("disposing of unwanted duplicated block",e,e.id===r.id),ft().bn({childStore:e,parentStore:a,alive:!1,transaction:t}))}}}var St=()=>o(899038),It=()=>o(901389),Mt=()=>o(874913),Tt=()=>o(675074),Ct=()=>o(131581),xt=()=>o(813743),wt=()=>o(722101),At=()=>o(246826),_t=()=>o(797265),Dt=()=>o(778417),Pt=()=>o(436572),Bt=()=>o(4319),Rt=()=>o(538527),Ft=()=>o(751156),Lt=()=>o(633457);const Et=!1;function Ot(){if(Et){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];console.log("clipboardActions:",...t)}}const Wt=(0,Z().YK)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."},untitled:{defaultMessage:"Untitled",id:"clipboardActions.untitledMessage"}}),Nt=(0,Z().YK)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedEmailToClipboard:{id:"action.copiedEmailToClipboard.snackBarMessage",defaultMessage:"Copied email to clipboard"},copiedUserIdToClipboard:{id:"action.copiedUserIdToClipboard.snackBarMessage",defaultMessage:"Copied user ID to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"}}),Ut={...o(335098).q,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},Vt="text/_notion-blocks-v3-production",zt="text/_notion-text-production",Ht="text/_notion-multi-text-production",Xt="text/_notion-page-source-production",jt="vscode-editor-data",$t=[Vt,zt,Ht,Xt],Jt=new Set($t);const Gt={fromJson:e=>e,toJson:e=>e},Zt=Gt,qt=Gt,Kt=Gt,Qt={fromJson(e){const t=(0,J().v)(e.tree,(e=>e)),o=Yt.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:o}},toJson(e){const t=Yt.toJson(e.blockSelection);return{...e,blockSelection:t}}},Yt={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?F().RecordMap.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson():void 0})))})},eo="VirtualClipboard:production";let to;function oo(e){return e.isAndroid}function no(e,t){if(!oo(t))return e;const o=(0,ve().n8)(e.getData("text/html"));if(o){to||(to=z().A.get(eo));const t=to;if(o===(null==t?void 0:t.id)){const o=e.types.concat(Object.keys(t.mimeTypes));return{getData(o){const n=e.getData(o);return!n&&function(e){return Jt.has(e)}(o)?t.mimeTypes[o]||"":n},types:[...new Set(o)].filter((o=>{const n=t.mimeTypes[o];return""!==e.getData(o)||n&&""!==n})),items:e.items}}}return e}function ro(e,t,o,n){if(!e.clipboardData)return;const r=o.toJson(n),i=JSON.stringify(r);e.clipboardData.setData(t,i)}function io(e,t,o){try{const n=e.getData(t),r=JSON.parse(n);return o.fromJson(r)}catch(n){return}}function ao(e){const{clipboardData:t}=e,{text:o,html:n,isFromMicrosoftOffice:r,isHtmlTable:a}=function(e){const{clipboardData:t,tinyMceMicrosoftWordPasteFilter:o}=e,n=t.getData("text/uri-list"),r=t.getData("text/plain").replace(No,"\n")||n;let a=t.getData("text/html");for(const d of Uo){const e=t.getData(d);if(e){const{ops:t}=JSON.parse(e);t&&(a=new(i().Ss)(t,{}).convert())}}const s=Bo(a),{isHtmlTable:c,htmlContainsRichFormatting:l}=function(e){var t;const o=document.createElement("div");o.innerHTML=Ro(e);const n=Boolean("table"===(null===(t=o.firstElementChild)||void 0===t?void 0:t.nodeName.toLowerCase()));return{htmlContainsRichFormatting:T().HZ({node:o,window,emojiData:ge().A.state}),isHtmlTable:n}}({html:a,tinyMceMicrosoftWordPasteFilter:o});if(!l&&!function(e,t){return Wo.test(e)&&Wo.test(t)}(a,r))return{text:r,isFromMicrosoftOffice:s,isHtmlTable:c};return{text:r,html:a,isFromMicrosoftOffice:s,isHtmlTable:c}}(e);return{text:o,html:n,multiTextSelectionData:io(t,Ht,Qt),textSelectionData:io(t,zt,Zt),blockSelectionData:io(t,Vt,Yt),isFromMicrosoftOffice:r,isHtmlTable:a}}function so(e){const{blocks:t,action:o,environment:n}=e;if(0===t.length)return{action:o,blocks:[],wasContiguousSelection:!1};const r=t[0],i=r.inMemoryRecordCache,a=K().sb(K().oE(t.map((e=>e.id)))),s=r.getParentBlockStore(),c=s?s.getRenderableContentIds():[],l=c.indexOf(r.id),d=Boolean(s&&t.every(((e,t)=>c.indexOf(e.id)===l+t)));if(i.isTemplatePreview){return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ue().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d}}if(i.snapshotData){!function(e,t){(0,rt().v)(e,"history_copy",{ageMs:(0,it().S)(t)})}(n,i.snapshotData);return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ue().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!0,requireFullSubtree:!0,skipNavigableChildren:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d,wasSelectionFromSnapshot:!0}}{const e=(0,ve().x4)(t),r=e&&lo({environment:n,inMemoryRecordCache:i,multiColumnPasteInfo:e});if(e&&r){let t=!1;const s=[];for(const o of a)e.blockIds.has(o)?t||(s.push({blockId:e.columnListId,blockSubtree:r}),t=!0):s.push({blockId:o,blockSubtree:(0,ue().loadLocalSubtree)(n,{blockId:o,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap});return{blocks:s,action:o,wasContiguousSelection:d}}return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ue().loadLocalSubtree)(n,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap}))),action:o,wasContiguousSelection:d}}}function co(e){const{markdown:t,markdownOptions:o,markdownLinkifyIt:n}=e;if(n)return _().uY({...n,markdown:t,plugin:null==o?void 0:o.plugin})}function lo(e){var t;const{environment:o,multiColumnPasteInfo:n,inMemoryRecordCache:r}=e,{columnListId:i,columnIds:a,spaceId:s}=n,c=F().RecordMap.create(),l=null===(t=r.getEntry({pointer:{table:W().ev,id:i,spaceId:s},userId:o.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==l?void 0:l.type))return;const d={...l,content:(l.content||[]).filter((e=>a.has(e)))};c.setValue({table:W().ev,id:i,spaceId:s},d);for(const m of a){var u;const e=null===(u=r.getEntry({pointer:{table:W().ev,id:m,spaceId:s},userId:o.currentUser.id}))||void 0===u?void 0:u.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>n.blockIds.has(e)))};c.setValue({table:W().ev,id:m,spaceId:s},t)}const p=[c];for(const m of n.blockIds){const e=(0,ue().loadLocalSubtree)(o,{blockId:m,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;if(!e)return;p.push(e)}return F().RecordMap.merge(p)}function uo(e){const{rootBlock:t,getRecordValue:o}=e,n=o(t);if(!n)return;const r=(0,I().zN)({block:n,getRecordValue:o});if(!r)return;const i=(0,ve().M9)({rootBlock:t,getRecordValue:o,formulasModule:y()}),a=(0,u().Dp)(r),s=Object.keys(a),c=K().Ul(s,(e=>{const t=a[e];return t&&t.name||""}));let l="";for(const d of c){const e=a[d];if(e&&"title"!==d){const t=(0,v().sL)({property:d,schema:a,block:n,exportArgs:i,renderers:f().z});t&&(l+=`${e.name}: ${t}\n`)}}return l||void 0}function po(e){const{treePath:t,textPosition:o,endpoint:n}=e,{store:r,index:i}=o,a=t.map((e=>e.value.store.pointer)),s=le().SL(o.store)?["properties","title"]:o.store.path,c=H().AI5(r.getValue(),i,i);return{copiedText:"end"===n?c.tokensBeforeRange:c.tokensAfterRange,textIndex:i,attributePath:s,pointerPath:a}}function mo(e){var t;const{multiSelection:o,action:n,environment:r}=e;(0,Me().KP)(o)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const i=null===(t=(0,Te().ZS)({filterCommonAncestors:!0,multiSelection:o,focus:void 0}))||void 0===t?void 0:t.stores;if(!i)return;const a=o.start.store.inMemoryRecordCache,s=so({action:n,blocks:i,environment:r});if(0===s.blocks.length)return;const c=(0,Te().Tp)({multiSelection:o,includeNonSelectable:!1});if(!c)return;const{treeRange:l}=c,d=[],u=new Map,p=(e,t)=>{t.forEach((e=>p(e,[])));const o=u.get(e),n=o&&o.length>t.length?o:t;u.set(e,n)},m=Ve().default.checkGate({gateName:"prefer_high_level_operations"});for(const{start:y,end:h}of l.iterateAnalogousNodes()){if(y){const e=y.childrenBeforeRange.slice(-1).concat(y.childrenInsideRange);p(y.parent,e)}if(h)if(p(h.parent,h.childrenInsideRange),m)for(const e of h.childrenAfterRange)d.push({command:"removeChild",path:["content"],pointer:h.parent.value.store.pointer,args:{id:e.value.store.id}});else d.push(P().op.set({pointer:h.parent.value.store.pointer,path:["content"],args:h.childrenInsideRange.map((e=>e.value.store.id))}))}const g=po({textPosition:o.start,endpoint:"start",treePath:l.startPath}),f=po({textPosition:o.end,endpoint:"end",treePath:l.endPath});d.push(...(0,ve().Qr)(g),...(0,ve().Qr)(f));for(const y of[null===(v=s.blocks[0])||void 0===v?void 0:v.blockSubtree,null===(b=s.blocks[s.blocks.length-1])||void 0===b?void 0:b.blockSubtree]){var v,b;y&&((0,B().applyOperationsToRecordMap)({recordMap:y,operations:d,updateOnly:!0}),m&&go(r,a,y))}const k=(0,J().v)(l.commonAncestor,(e=>{const t=u.get(e);if(t)return{value:e.value.store.pointer,children:t}}));if(k)return{blockSelection:s,tree:k,multiTextSelection:{start:g,end:f},action:n};Ot("unexpected: trimming tree produced undefined")}function go(e,t,o){const n=[];for(const{model:r}of o)if(r instanceof D().zgg&&!r.alive){n.push(r.pointer);const o=(0,ue().loadLocalSubtree)(e,{blockId:r.pointer.id,inMemoryRecordCache:t,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;if(o)for(const{pointer:e}of o)n.push(e)}for(const r of n)o.delete(r)}function fo(e){const{environment:t,event:o}=e,n=C().JW();!function(e){const{environment:t,event:o,markdownLinkifyIt:n}=e;if(!o.clipboardData)return;const r=je().default.state.stores,i=$e().default.isEditingComment(),a=Ee().A.state.open,s=Fe().wg(),c="empty"!==$e().default.state.mode&&$e().default.state.multiSelection,l=t.currentUser.id,u="copy"===o.type?"copy":"cut",p=fe().ZO();p&&(0,L().Yt)(p.pointer,W().ev)&&ro(o,Xt,qt,p.pointer);const m=c&&(0,Me().H7)(c);if(m&&m.selection.startIndex!==m.selection.endIndex){const e=Ie().A.getIntl(),{store:n,selection:r}=m,i=n.inMemoryRecordCache,a=n.getValue();if(Ot("copy: copying single-store text selection"),o.preventDefault(),a&&!Lo()){const e=n.table===W().ev?(0,xe().T)(n):void 0,t=e&&K().n4(n.path,e.getBlockTitleStore().path)?e.getType():void 0,i=t&&(0,d().aO)(t)?t:void 0,s=a.filter((e=>!H().Br(e)&&!H().jR$(e)));ro(o,zt,Zt,{blockType:i,editing:s,selection:r,action:u})}const s=H().Ffo(a,r.startIndex,r.endIndex),c=D().b4_.fromGetRecordValueFn(i.makeGetRecordValueFn(l)),p=i.makeGetRecordRoleFn(l),g=(0,E().r4)({intl:e,textValue:s,getRecordModel:c,userTimeZone:(0,M().P)(),externalIntegrations:ze().A.integrations.state});o.clipboardData.setData("text/plain",(0,ve().Df)(t.device.isWindows,g));const f=(0,j().$e)({textValue:s&&{value:s,spaceId:(0,V().e)(n.pointer.spaceId)},getRecordModel:c,getRecordRole:p,userTimeZone:(0,M().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,q().x0)(),intl:e,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:ye().QN,externalIntegrations:ze().A.integrations.state,formulaValueTypes:[],emojiData:ge().A.state,isMobileNative:!1});return void o.clipboardData.setData("text/html",(0,ve().Df)(t.device.isWindows,f))}if(c&&!(0,Me().kM)(c)&&!i&&c.start.store.table===W().ev&&c.end.store.table===W().ev){const e=mo({environment:t,multiSelection:c,action:u});if(e){Ot("copy: copying multi-text selection"),o.preventDefault(),ro(o,Ht,Qt,e);const{markdown:r,html:i}=(0,ve().Ij)({clipboardData:e,multiSelection:c,currentUserId:l,isWindows:t.device.isWindows,markdownLinkifyIt:n,markdownSerializationOptions:{transformBlockMapping:{image:Ve().default.checkGate({gateName:"docs_clipboard_imagedata"})?vo:void 0}},formulasModule:y()});return r&&o.clipboardData.setData("text/plain",r),void(i&&o.clipboardData.setData("text/html",i))}}if(c&&!(0,Me().kM)(c)&&!i&&c.start.store.table===U().SN&&c.end.store.table===U().SN){Ot("copy: copying comment multi-text selection"),o.preventDefault();const e=(0,Te().$W)(c),n=Ie().A.getIntl(),r=e.map((e=>{let{store:o,selection:r}=e;if(r.startIndex===r.endIndex)return;const i=o.inMemoryRecordCache,a=D().b4_.fromGetRecordValueFn(i.makeGetRecordValueFn(l)),s=i.makeGetRecordRoleFn(l),c=H().Ffo(o.getValue(),r.startIndex,r.endIndex);return{plainText:(0,E().r4)({intl:n,textValue:c,getRecordModel:a,userTimeZone:(0,M().P)(),externalIntegrations:ze().A.integrations.state}),htmlContent:(0,j().$e)({textValue:c&&{value:c,spaceId:(0,V().e)(o.pointer.spaceId)},getRecordModel:a,getRecordRole:s,userTimeZone:(0,M().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,q().x0)(),intl:n,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:Le().SN(t),externalIntegrations:ze().A.integrations.state,formulaValueTypes:[],emojiData:ge().A.state,isMobileNative:!1}),textValue:c}})).filter(ee().O9),i=r.map((e=>e.plainText)).join("\n\n"),a=`<div>${r.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return o.clipboardData.setData("text/plain",(0,ve().Df)(t.device.isWindows,i)),void o.clipboardData.setData("text/html",(0,ve().Df)(t.device.isWindows,a))}if(r.length>0&&!i&&!s&&!a){Ot("copy: copying block selection"),o.preventDefault();const e=r[0],i=e.inMemoryRecordCache,a=so({blocks:r,environment:t,action:u});if(ro(o,Vt,Yt,a),!e.isDefined())return;const s=K().oE(r.map((e=>e.computeWithRecordValues((t=>{let{getRecordValueAndSubscribe:o}=t;return o(e)}))))),c=i.makeGetRecordValueFn(l),{markdown:d,html:p}=(0,ve().ZI)({rootBlock:{id:e.id,table:W().ev,spaceId:e.getSpaceId()},blockValues:s,getRecordValue:c,isWindows:t.device.isWindows,markdownLinkifyIt:n,formulasModule:y()});return d&&o.clipboardData.setData("text/plain",d),void(p&&o.clipboardData.setData("text/html",p))}Ot("copy: doing nothing")}(e),(0,ve().dk)(o,n),function(e){let{event:t,device:o,customEventId:n}=e;if(!t.clipboardData||!oo(o))return;const r={};for(const s of $t)r[s]=t.clipboardData.getData(s);const i=t.clipboardData.getData("text/html");t.clipboardData.setData("text/html",`${i}${(0,ve().uE)(n)}`),to={id:n,mimeTypes:r};try{z().A.set(eo,to)}catch(a){S().log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}({event:o,device:t.device,customEventId:n})}function vo(e){const{block:t,exportArgs:o}=e,{getExportedRenderAsset:n}=o,{source:r}=D().Bj6.fromBlock(t).getProperties(),i=H().q4_(r),a=function(e){if(!e.file_ids)return;const t=Pe().K.findBlockFromId(e.id);if(!t)return;const o=t.getNode();if(!(o instanceof Element))return;const n=o.querySelector("img");if(!n)return;const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const i=r.getContext("2d");if(!i)return;return i.drawImage(n,0,0,n.width,n.height),r.toDataURL()}(t)??n({fromBlockId:o.blockId,toFileURI:i}),s=_().qh(e)||_().Qw({block:t,exportArgs:o})||a;return{text:(0,m().rS)({url:i})?`![${s}](${a})`:`[${s}](${a})`,breakLines:!0,children:_().q5(e)}}async function bo(e){const{event:t,environment:o,markdownLinkifyIt:n}=e;bt().syncTextSelection();const r=je().default.state.stores,i=$e().default.isEditingComment(),a=fe().fI(),s="editing"===$e().default.state.mode&&$e().default.state.multiSelection,{phase:c}=je().default.state;if(ko({environment:o,event:t,disableSyncTextSelection:!0,markdownLinkifyIt:n}),s&&!(0,Me().kM)(s)){const e=s.start.store.getAncestorBlockStoreAtRootPath(),t=e?Ue().Uv.getMode(e):"default";Ft().createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:o,canUndo:!0,perform:n=>{if("suggest"===t){const t=se().RR(o,n,e);se().rY({environment:o,multiSelection:s,transaction:n,discussionStore:t})}else vt().f0({environment:o,multiSelection:s,transaction:n})}})}else(c===je().SelectionPhase.Selected||s)&&r.length>0&&!i&&!a&&await _t().Af({environment:o,blocks:r,shouldCheckSuggestEdit:!0});He().A.setKeyboardMode(!0)}function ko(e){const{environment:t,event:o,disableSyncTextSelection:n,markdownLinkifyIt:r}=e;n||bt().syncTextSelection(),fo({environment:t,event:o,markdownLinkifyIt:r}),He().A.setKeyboardMode(!0)}function yo(e){var t;const{environment:o,files:n,transaction:r,insertBelowBlockStore:i}=e,a=je().default.getCurrentRecordCache(),s=fe().y0(o);if(!a)return;const c=je().default.state.stores,l=Tt().$C({environment:o,files:n,inMemoryRecordCache:a,transaction:r,pageWidth:s,spaceId:0!==c.length?c[0].pointer.spaceId:null===(t=fe().ZO())||void 0===t?void 0:t.pointer.spaceId});l.forEach((e=>{const t=e.getType();t&&nt().v(o,{from:"paste",type:t,creating_block_id:e.id})})),Io({environment:o,blocks:l,transaction:r,replaceEmptyTextBlock:!0,insertBelowBlockStore:i})}function ho(e){const{environment:t,store:o,tokens:n,index:r,transaction:i,multiTextSelection:a,disableEmbedMenu:c,selectAll:l}=e,d=(0,Me().H7)(a),u=d?{value:d.store.getValue()}:void 0,p=o.getAncestorBlockStoreAtRootPath(),m=p?Ue().Uv.getMode(p):"default";let f=n;($e().default.isEditingComment()||$e().default.isEditingCaption())&&(f=function(e){const{environment:t,tokens:o}=e,n=So(o);if(n&&n.url===n.text){const e=(0,O().parseRoute)({url:n.url,baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,isMobile:t.device.isMobile,protocol:ce().A.protocol,currentUrl:window.location.href});if("page"===e.name&&e.blockId){const t=H().ld4(e.scrollToBlockId??e.blockId,void 0);return[H().wmz(t),H().Ey_(" ")]}}return o}({environment:t,tokens:n})),vt().yr({environment:t,store:o,tokens:f,index:r,transaction:i,selectAll:l,editorMode:m});const v=So(f);!c&&u&&v&&"suggest"!==m&&function(e){const{environment:t,hyperlink:o,oldTextValue:n}=e,r="editing"===$e().default.state.mode&&(0,Me().H7)($e().default.state.multiSelection),i=je().default.state;if(r&&i.stores.length>0){const e=r.store.getValue(),i=H().q4_(e),a=g().PE(i.substring(0,i.indexOf(o.text))).length,c=a+g().PE(o.text).length;if(r.store.isTable(W().ev)||r.store.isTable(U().SN)){if(Lt().p6({environment:t,blockStore:je().default.state.stores[0],textStore:r.store,textValueBeforePaste:n,url:o.url,urlSelection:{startIndex:a,endIndex:c}}))return;if(xt().Yf({environment:t,textStore:r.store,blockStore:je().default.state.stores[0],oldTextValue:n,url:o.url,urlSelection:{startIndex:a,endIndex:c}}))return}s().default.afterNextFlush((()=>{const e=o.url;Ct().p6({environment:t,textStore:r.store,oldTextValue:n,url:e,urlSelection:{startIndex:a,endIndex:c}})}))}}({environment:t,hyperlink:v,oldTextValue:u.value,transaction:i})}function So(e){if(1!==e.length)return;const t=e[0];if(!H().BEe(t))return;const[o,n]=t;if(1!==n.length)return;const r=n[0];if(!H().sh$(r))return;return{text:o,url:H().cQR(r)}}function Io(e){const{environment:t,blocks:o,transaction:n,replaceEmptyTextBlock:r,insertBelowBlockStore:i}=e,a=je().default.state.stores;if(1===a.length){const e=a[0];if(e.getType()&&e.isType(d().KK)&&function(e){if("editing"!==$e().default.state.mode||!$e().default.state.multiSelection)return!1;const t=(0,Me().H7)($e().default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const r=e.getContentStore(),i=K().o8(o).reverse().map((e=>wt().Hs({parentStore:r,prependStore:e,transaction:n}).childStore));return Dt().td({environment:t,stores:i}),i}}return _t().LE({environment:t,blocksToInsert:o,target:i?[i]:a,transaction:n,replaceEmptyTextBlock:r})}function Mo(e,t,o,n){const r=(0,fe().ZO)();if(!r)return;const i=je().default.state.stores,a=0!==i.length?i[0].pointer.spaceId:r.pointer.spaceId,c="suggest"===Ue().Uv.getMode(r,!0);let l=function(e,t){if("cut"!==t.action||!Ve().default.checkGate({gateName:"convert_cut_paste_to_move"}))return;const o="suggest"===Ue().Uv.getMode(e,!0),n=[];for(const r of t.blocks){const t=Xe().Bv.createChildStore(e,{table:W().ev,id:r.blockId});if(!t.isReady())return;const i=t.getModel();if(!i)return;if(i.getSpaceId()!==e.getSpaceId())return;if(!1!==i.alive)return;o&&!d().ei[i.getType()]||n.push(t)}return n}(r,t);if(!l){const i=JSON.stringify(t).length>De().vs;l=t.blocks.reduce(((s,l)=>{var u,p,m,g,f;let{blockId:v,blockSubtree:b}=l;const k=Xe().Bv.createChildStore(r,{table:W().ev,id:v,spaceId:null==o?void 0:o.spaceId});let y;if(k.isDefined())y=k.getModel();else{const e=null==b?void 0:b.getValue({table:W().ev,id:v});y=e&&D().Bj6.fromBlock(e)}if(c&&y&&!d().ei[y.getType()])return s;if(null!==(u=y)&&void 0!==u&&u.isCollectionView()&&(null===(p=y)||void 0===p||!p.getCollectionPointer())&&(null===(m=y)||void 0===m?void 0:m.getSpaceId())!==a){const t=At().Wv({environment:e,type:d().xd.text,inMemoryRecordCache:k.inMemoryRecordCache,transaction:n,spaceId:a});return vt().yr({environment:e,store:t.getBlockTitleStore(),tokens:[H().wmz(H().ld4(v,y.getSpaceId()))],index:0,transaction:n}),s.push(t),s}const h=!((0,re().l)(r)||Eo()||null!==(g=y)&&void 0!==g&&g.isTemplateVariableContainerBlock()),I=b&&a&&(null===(f=y)||void 0===f?void 0:f.getSpaceId())&&oe().Lw({sourceSpaceId:y.getSpaceId(),targetSpaceId:a,sourceBlockSubtree:b});if(b&&!i&&!I){const o=(0,pe().localDuplicate)({environment:e,sourceBlockId:v,targetBlockPointer:(0,he().zP)({environment:e,table:W().ev,spaceId:a}),sourceBlockSubtree:b,targetInMemoryRecordCache:k.inMemoryRecordCache,options:{addCopyName:(0,we().A)(k),allowRedundancy:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:h,preventLegacyTransclusions:(0,Se().$J)()},transaction:n,shallowCopyNavigableBlock:!!t.wasSelectionFromSnapshot&&Ve().default.checkGate({gateName:"duplicate_snapshot_navigable_blocks_by_reference"})}).targetBlockStore,r=o.getType();return r&&nt().v(e,{from:"paste",type:r,new_page_id:"page"===r?o.id:void 0,creating_block_id:o.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()}),s.push(o),s}if(t.wasSelectionFromSnapshot)return S().log({level:"warning",from:"clipboardActions",type:"pasteBlockSelection",data:{message:"Unable to locally duplicate pasted block selection from snapshot",miscDataToConvertToString:{blockId:v,blockType:k.getType(),blockSelectionTooBig:i,missingBlockSubtree:!b}}}),s;Ne().A.state.online||It().f1(Ie().A.formatMessage(Wt.offlineError));const{blockStores:M,onComplete:T}=de().duplicateBlock({environment:e,stores:[k],transaction:n,options:{addCopyName:(0,we().A)(k),allowRedundancy:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:h,convertExternalObjectInstancesToPlaceholders:!1},targetSpaceId:(0,V().e)(a),preferDuplicateLocation:"server"}),C=M[0],x=C.getType();return T.then((o=>{if("error"===o.status){const n=o.error;oe().Rk(n)?t.blocks.length>1?oe().UK(e,{product:n.clientData.metadata.product}):oe().yj({product:n.clientData.metadata.product}):It().f1(o.errorMessage)}else x&&nt().v(e,{from:"paste",type:x,new_page_id:"page"===x?C.id:void 0,creating_block_id:C.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()})})),s.push(C),s}),[])}if(c){const t=se().RR(e,n,l[0]),o=[];l.forEach((e=>{const r={type:"insert",id:C().JW(),discussionId:t.id};se().tM(n,e,r),o.push(e.id)})),n.preEnqueueActions.push((()=>{se().c3({environment:e,transaction:n,discussionStore:t,addModifiedBlockIdsAfter:o})})),Rt().Ug({environment:e,blocks:l,annotation:[H().Ifu.SuggestionInsertText,t.id],transaction:n})}Io({environment:e,blocks:l,transaction:n,replaceEmptyTextBlock:!0});const u=je().default.state.stores,p=u.length>0?u:[r],m=t.blocks.map((e=>{const t=p.length>0?p[0]:function(e){return e.isCollectionView()?e.getCollectionStore()||e:e.getContentStore()}(r);return Xe().Bv.createChildStore(t,{table:W().ev,id:e.blockId})}));s().default.afterNextFlush((async()=>{await Promise.all(p.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==d().xd.copyIndicator)}))))),await Promise.all(m.map((e=>e.load()))),o&&at().ei({environment:e,blocks:p,pageSource:o,copiedStores:m,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:r})&&at().gi({environment:e,copiedStores:m,blocks:p,pageSource:o})}))}function To(e){const{environment:t,disableEmbedMenu:o,transaction:n,overwrite:r,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,text:c,tinyMceMicrosoftWordPasteFilter:l}=e,d=c.includes("\n"),u=$e().default.state,p=Fo(u);d&&"inline"!==p||"editing"!==u.mode?r?(n.logDebugMessage("paste: pasting as markdown overwrite"),function(e){const{environment:t,text:o,transaction:n,selectAll:r,markdownOptions:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s}=e,c=co({markdown:o,markdownOptions:i,markdownLinkifyIt:a});if(!c)return;let l=xo({environment:t,html:c,wrapInEmptyBlocks:!1,tinyMceMicrosoftWordPasteFilter:s});l||(l=xo({environment:t,html:c,wrapInEmptyBlocks:!0,tinyMceMicrosoftWordPasteFilter:s}));if(!l)return;kt({environment:t,clipboardData:l,transaction:n,allowPasteIntoHeaderWithoutChildren:!0,selectAll:r,preventLegacyTransclusions:(0,Se().$J)()})}({environment:t,text:c,transaction:n,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})):c&&(n.logDebugMessage("paste: pasting as markdown append"),function(e){const{environment:t,text:o,transaction:n,markdownOptions:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=co({markdown:o,markdownOptions:r,markdownLinkifyIt:i});if(s)_o({environment:t,html:s,transaction:n,tinyMceMicrosoftWordPasteFilter:a})}({environment:t,text:c,transaction:n,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})):(n.logDebugMessage("paste: pasting as inline markdown"),function(e){const{environment:t,text:o,disableEmbedMenu:n,transaction:r,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c}=e,l="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(l){const e=(0,Me().H7)(l);if(e&&function(e){const t=$e().default.state;return"editing"===t.mode&&!(0,Me().kM)(t.multiSelection)&&(0,Me().KP)(t.multiSelection)&&A().t(e,"url")}(o))Oo({environment:t,text:o,transaction:r,editingSelection:e,selectAll:i});else if((0,_e().B1)("c")){const e=(0,xe().T)(l.start.store);vt().$D({environment:t,editorMode:e?Ue().Uv.getMode(e):"default",multiSelection:l,string:o,disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:r,selectAll:i})}else{const e=s&&_().Z4({...s,markdown:o,plugin:null==a?void 0:a.plugin});if(!e)return;Ao({environment:t,html:e,transaction:r,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:n,selectAll:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})}}}({environment:t,text:c,disableEmbedMenu:o,transaction:n,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l}))}function Co(e,t){const o=e.getValue({table:W().ev,id:t});if(!o)return;const n={table:W().ev,id:t,spaceId:o.space_id},r=(o.content??[]).map((t=>Co(e,t))).filter(ee().O9);return new(J().PH)(n,r)}function xo(e){var t,o,n,r;const i=fe().ZO(),{html:s,wrapInEmptyBlocks:c,tinyMceMicrosoftWordPasteFilter:l,environment:d}=e,u=Po({environment:d,html:s,tinyMceMicrosoftWordPasteFilter:l,useCrdt:!1});if(!u)return;const{currentUserStore:p}=Oe().default.state;if(!p)return;let{allOperations:m,rootContentIds:g}=u;if(c){const e=Do(d),t=Do(d);if(!e||!t)return;m=[e.operation,...m,t.operation],g=[e.id,...g,t.id]}const f=F().RecordMap.create();(0,B().applyOperationsToRecordMap)({recordMap:f,operations:m,updateOnly:!1});const v=[],b=function(e){const{name:t,userId:o,recordMap:n}=e,r=F().RecordMapWithRole.create();for(const{pointer:i,model:a}of n)r.setModelAndRole(i,a,"reader");return new(a().A)({name:t,data:new(G().b)({[o]:r})})}({name:"htmlToMultiTextSelectionClipboardData",userId:p.id,recordMap:f});for(const a of g){const e=(0,ue().loadLocalSubtree)(d,{blockId:a,inMemoryRecordCache:b,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Se().$J)()}).recordMap;v.push({blockId:a,blockSubtree:e})}const k=new(J().PH)({...(0,he().zP)({environment:d,table:W().ev,spaceId:null==i?void 0:i.pointer.spaceId})},g.map((e=>Co(f,e))).filter(ee().O9));if(0===k.children.length)return;const y=k.children[0],h=null===(t=(0,J().Qe)([k],(e=>e===y)))||void 0===t?void 0:t.map((e=>e.value)),S=null===(o=f.getValue(y.value))||void 0===o||null===(o=o.properties)||void 0===o?void 0:o.title,I=(0,J().wI)(k),M=null===(n=(0,J().Qe)([k],(e=>e===I)))||void 0===n?void 0:n.map((e=>e.value)),T=null===(r=f.getValue(I.value))||void 0===r||null===(r=r.properties)||void 0===r?void 0:r.title,C=T?H().q4_(T).length:0;return S&&h&&T&&M?{blockSelection:{blocks:v,wasContiguousSelection:!0,action:"copy"},tree:k,multiTextSelection:{start:{textIndex:0,copiedText:S,attributePath:["properties","title"],pointerPath:h},end:{textIndex:C,copiedText:T,attributePath:["properties","title"],pointerPath:M}},action:"copy"}:void 0}function wo(e){const{text:t,html:o,stripText:n,stripSurroundingWhitespace:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=o||(t?co({markdown:t,markdownLinkifyIt:i}):void 0);if(!s)return;if(Ve().default.checkGate({gateName:"paste_links_as_mentions"})){const e=(0,ve().Lj)(s);if(e)return[H().wmz(H().ld4(e.id,e.spaceId),[])]}const c=document.createElement("div");return c.innerHTML=Ro({html:s,tinyMceMicrosoftWordPasteFilter:a}),T().Hw({node:c,window,stripText:n,stripSurroundingWhitespace:r,emojiData:ge().A.state})}function Ao(e){const{environment:t,html:o,transaction:n,stripText:r,stripSurroundingWhitespace:i,disableEmbedMenu:a,selectAll:s,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}=e,d="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(d){const e=wo({html:o,stripText:r,stripSurroundingWhitespace:i,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l});if(!e)return;const u=(0,xe().T)(d.start.store),p=1===e.length;if(p){if(p&&(!e[0][1]||0===e[0][1].length)){n.logDebugMessage("pasteInlineHtml: insertString");const o=e[0][0];return void vt().$D({environment:t,editorMode:u?Ue().Uv.getMode(u):"default",multiSelection:d,string:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:n,selectAll:s})}const o=(0,Me().H7)(d);if(o&&!(0,Me().kM)(d)){const[,r]=e[0],i=r&&H().VtW(r);if(i){n.logDebugMessage("pasteInlineHtml: pasteLinkOverText");return void Oo({environment:t,text:H().cQR(i),transaction:n,editingSelection:o,selectAll:s})}}}n.logDebugMessage("pasteInlineHtml: delete selection and insert"),vt().f0({environment:t,multiSelection:d,transaction:n}),ho({environment:t,store:d.start.store,tokens:e,index:d.start.index,transaction:n,disableEmbedMenu:a,multiTextSelection:d,selectAll:s})}}function _o(e){const{environment:t,html:o,transaction:n,tinyMceMicrosoftWordPasteFilter:r}=e,i=fe().ZO();if(!i)return;const a=Po({environment:t,html:o,tinyMceMicrosoftWordPasteFilter:r,useCrdt:i.useCrdt()});if(!a)return;const{allOperations:c,rootContentIds:l}=a;for(const s of c)if((0,X().ph)(s)){const e=Xe().Bv.createChildStore(i,s.pointer);Ft().applyCrdtTextOperation({store:e,operation:s,invertedOperation:void 0,transaction:n})}else if((0,P().$Y)(s)){const e=(0,Xe().Oo)(i,s.pointer);Ft().applyOperation({store:e,operation:s,transaction:n})}else(0,ee().HB)(s);const u=l.map((e=>Xe().Bv.createChildStore(i,{table:W().ev,id:e})));u.forEach((e=>{const o=e.getType();o&&nt().v(t,{from:"paste",type:o,creating_block_id:e.id,parent_collection_id:e.getParentCollectionIdUpToTwoLevels()})}));const p=Io({environment:t,blocks:u,transaction:n,replaceEmptyTextBlock:!0}).slice().reverse();return s().default.afterNextFlush((()=>{const e=p.map((e=>{if(e.getType()!==d().xd.text)return;const o=So(e.getTitleValue());if(!o)return;const n=(0,O().parseRoute)({url:o.url,baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,isMobile:t.device.isMobile,protocol:ce().A.protocol,currentUrl:window.location.href});return"page"===n.name?n:void 0})).filter(ee().O9);at().T_({environment:t,rootStore:i,blocks:p,copiedLinks:e})||at().Tw({environment:t,blocks:p})})),u}function Do(e){const{currentUserStore:t}=Oe().default.state,o=fe().ZO();if(!t||!o)return;const n=t.id;if(!n)return;const r=o.id,i=o.pointer.spaceId,a=(0,he().Z1)({environment:e,table:W().ev,spaceId:i});return{operation:{pointer:{table:"block",id:a,spaceId:i},command:"set",path:[],args:{id:a,version:1,type:"text",properties:{title:[[""]]},parent_id:r,parent_table:"block",space_id:i,created_by_table:"notion_user",created_by_id:n,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:n,last_edited_time:Date.now(),alive:!0}},id:a}}function Po(e){const{environment:t,useCrdt:o,...n}=e,r=document.createElement("div");r.innerHTML=Ro(n);const{currentUserStore:i}=Oe().default.state,a=fe().ZO();if(!i||!a)return;const s=i.getValue();if(!s)return;const l=a.getSpaceId(),d=(0,he().Gx)({environment:t,spaceId:l}),u=t.idCreator.getSpaceShortIdCreator(l,d);return T().aH({actor:(0,c().A7)(s),parent:{id:a.id,table:W().ev,spaceId:l},rootNode:r,deps:{importFileMap:{},window,intl:Ie().A.getIntl(),randomID:Q().Ay,spaceIdCreator:u,randomShortID:Y().Ay,isPhoneNumber:R().W,emojiData:ge().A.state},options:{useCrdt:o,ignoreBlockCount:!1}})}function Bo(e){return/schemas-microsoft-com:office/.test(e)||/xmlns:m="http:\/\/schemas.microsoft.com\/office\/2004\/12\/omml"/.test(e)}function Ro(e){const{html:t,tinyMceMicrosoftWordPasteFilter:o}=e;return r().sanitize(o&&Bo(t)?o(t):t)}function Fo(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const o=Be().n.findEditableWithStore(t.start.store),n=null==o?void 0:o.props;return n&&!n.disabled?n.pasteBehavior:void 0}function Lo(){var e;if("editing"!==$e().default.state.mode)return;const t=$e().default.state.multiSelection.start,o=t.store.path;if("formula"!==o[o.length-1])return;const n=t.store.getRecordStoreAtRootPath();if((null==n?void 0:n.table)!==W().ev)return;const r=null==n||null===(e=n.getPropertiesStore())||void 0===e||null===(e=e.getValue())||void 0===e||null===(e=e.collection_id)||void 0===e||null===(e=e[0])||void 0===e?void 0:e[0];if(!r)return;const i={table:N().Vl,id:r,spaceId:n.getSpaceId()},a=n.getRecordModel(i);return a?{parentCollection:a,start:t,getRecordModel:n.getRecordModel}:void 0}function Eo(){const e=je().default.state.stores;if("editing"!==$e().default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=$e().default.state,o=t.start.store;if(!o.isTable(W().ev))return!1;const n=ke().E(o);return Boolean(n)}function Oo(e){const{text:t,transaction:o,environment:n,editingSelection:r,selectAll:i}=e,a=(0,O().parseRoute)({url:t,baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,isMobile:n.device.isMobile,protocol:ce().A.protocol,currentUrl:window.location.href}),s="page"===a.name&&a.blockId?(0,x().wv)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):t,c=vt().di({environment:n,store:r.store,selection:r.selection,transaction:o});vt().gw({environment:n,store:r.store,selection:c,annotationKey:"a",transaction:o,updateSelection:!1}),Rt().Mw({environment:n,store:r.store,selection:c,annotation:["a",s],transaction:o}),bt().setSelection({store:r.store,selection:{startIndex:i?c.startIndex:c.endIndex,endIndex:c.endIndex}})}const Wo=/\<\!-- wp:/;const No=/\u2028/g,Uo=["slack/texty"];function Vo(e){var t;let{environment:o,event:r,disableEmbedMenu:i,transaction:a,onPasteFiles:s,formulasModule:c,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u}=e;const p=Ve().default.checkGate({gateName:"allow_cut_copy_comment"});if(r.preventDefault(),bt().syncTextSelection(),!r.clipboardData)return;const m=no(r.clipboardData,o.device),f=Array.from(Array((null===(t=m.items)||void 0===t?void 0:t.length)??0).keys()).flatMap((e=>{var t;const o=m.items[e];if("file"!==o.kind)return[];const n=null===(t=o.getAsFile())||void 0===t||null===(t=t.name.match(/\.[^.]+$/))||void 0===t?void 0:t[0];return n?[n]:[]})),v=m.getData("text/html"),b=null==v?void 0:v.length;!function(e,t){let{source:o,types:n,fileExtensions:r,htmlContent:i}=t;const a=[...n];a.sort();const s=r.map((e=>e.toLowerCase()));(0,rt().v)(e,"paste",{source:o,types:a,file_extensions:s,original_html_content_size:i.length})}(o,{source:"editor",types:m.types||[],fileExtensions:f,htmlContent:v});const{text:k,html:y,multiTextSelectionData:S,textSelectionData:I,blockSelectionData:T,isFromMicrosoftOffice:C,isHtmlTable:x}=ao({clipboardData:m,tinyMceMicrosoftWordPasteFilter:u}),w=io(m,Xt,qt),A=function(e){return e.clipboardData?e.clipboardData.items?K().oE(Array.from(e.clipboardData.items).map((e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],t.name??Ie().A.formatMessage(Wt.untitled),{type:e.type})}))):g().PE(e.clipboardData.files):[]}(r),_=Fo($e().default.state),D=(null==T?void 0:T.action)||(null==S?void 0:S.action)||(null==I?void 0:I.action);a.annotateWithUserAction("cut"===D?"paste.from_cut":ve().Vz);const P=k.includes("\n"),B="body"===(0,_e().X4)()&&!I;if((A.length>0||T||P&&!B)&&!(0,Je().EF)(o))return;const R=function(e){const t=io(e,jt,Kt),o=null==t?void 0:t.mode;if(!o)return;return Ut[o]||"Plain Text"}(m),F=P&&R&&"inline"!==_&&!(0,_e().X4)()?zo({codeLanguage:R,environment:o,transaction:a}):void 0;Ge().oF(o,{pastedText:k,source:"editor_paste"});const L=Fe().wg(),E=Fe().KR(),O=r.clipboardData.getData(ie().sE),W=Lo();if(A.length>0&&!C&&!x)a.logDebugMessage("paste: file/image detected -> onPasteFiles"),s({environment:o,files:A,transaction:a});else if(B)a.logDebugMessage("paste: editing code block contents with no Notion text selection -> pasteRawText"),Ho(o,k,a);else if(F)a.logDebugMessage("paste: pasting code in existing empty text block with no selection or new code block after selection  -> pasteRawText"),Ho(o,k,a);else if(W){a.logDebugMessage("paste: formulaInformation detected, attempting to paste as formula");const{parentCollection:e,start:t}=W,n=[[k]],r=e;if(!r||!c)return void Ho(o,k,a);const i=$e().default.state;"multiSelection"in i&&vt().f0({environment:o,multiSelection:i.multiSelection,transaction:a});const s=(0,h().K5)({formulasModule:c,getRecordModel:W.getRecordModel,sourceCollection:r,textValue:n,featureGates:(0,be().i)()});vt().yr({environment:o,tokens:s,store:t.store,index:t.index,transaction:a})}else if("plaintext"===_)a.logDebugMessage("paste: plaintext paste behavior detected, pasting as inline html"),Ao({environment:o,html:k,transaction:a,stripText:!0,stripSurroundingWhitespace:!0,disableEmbedMenu:i,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u}),tt({environment:o,type:"plaintext",originalHtmlContentSize:b});else if(S){a.logDebugMessage("paste: multiTextSelectionData detected, attempting to paste as textselection");const e=function(e){const{environment:t,transaction:o,multiTextSelectionData:n,disableEmbedMenu:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=e.pasteBehavior||"inline",c=e.html||co({markdown:e.text,markdownLinkifyIt:i});if("editing"===$e().default.state.mode)switch(s){case"inline":return!!c&&(Ao({environment:t,html:c,transaction:o,stripText:!1,stripSurroundingWhitespace:!0,disableEmbedMenu:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}),!0);case"block":return kt({environment:t,clipboardData:n,transaction:o,preventLegacyTransclusions:(0,Se().$J)()});default:(0,ee().HB)(s)}}({multiTextSelectionData:S,environment:o,html:y,text:k,transaction:a,disableEmbedMenu:i,pasteBehavior:_,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u});e||(a.logDebugMessage("paste: could not paste as textSelection -> paste as blockSelection"),Mo(o,S.blockSelection,w,a))}else if(I&&I.editing){a.logDebugMessage("paste: textSelectionData detected, pasting text selection");const e=(0,ne().dr)(),t=(null==w?void 0:w.id)!==(null==e?void 0:e.id);!function(e){const{environment:t,textSelectionData:o,transaction:n,disableEmbedMenu:r,removeDiscussions:i}=e,a=je().default.getCurrentRecordCache(),{editing:s,selection:c}=o;let{tokensInsideRange:l}=H().AI5(s,c.startIndex,c.endIndex);l=H().Uee(l,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:i??!0});const u=(0,fe().ZO)();if(u&&!(u.isInsideTemplate()||Eo()||u.isInsideFactoryOrDuplicateBlocksAction())&&(l=(0,$().f$)(l,{currentUserId:t.currentUser.id,currentTimeZone:(0,M().P)()})),"body"===(0,_e().X4)()){const e=H().Cc8(l);e&&(l=e)}const p="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(p){if(!(0,Me().kM)(p)){const t=(0,Me().H7)(p);if(t){const n=H().Ffo(o.editing,o.selection.startIndex,o.selection.endIndex);if(1===n.length){const[o,r]=n[0],i=r&&H().VtW(r);if(i){const n=H().cQR(i);if([o,`http://${o}`,`https://${o}`].includes(n))return void Oo({environment:e.environment,text:n,transaction:e.transaction,editingSelection:t})}}}}const i=(0,xe().T)(p.start.store),a=i?Ue().Uv.getMode(i):"default";if("suggest"===a){const e=se().RR(t,n,p);se().rY({environment:t,multiSelection:p,transaction:n,discussionStore:e}),l=H().Mwp({textValue:l,selection:{startIndex:0,endIndex:1/0},annotation:[H().Ifu.SuggestionInsertText,e.id]})}else"default"===a&&vt().f0({environment:t,multiSelection:p,transaction:n});const s=$e().default.state;if("editing"===s.mode){const e=s.multiSelection;if(o.blockType&&0===c.startIndex){const r=(0,xe().T)(e.start.store);r&&"page"!==o.blockType&&(0,Ce().P4)(r)&&me().transformBlocks({environment:t,blocks:[r],blockType:o.blockType,transaction:n})}ho({environment:t,store:e.end.store,tokens:l,index:e.end.index,transaction:n,disableEmbedMenu:"suggest"===a||r,multiTextSelection:p})}}else if(a){var m;const e=je().default.state.stores,o=At().Wv({environment:t,type:d().xd.text,inMemoryRecordCache:a,transaction:n,spaceId:0!==e.length?e[e.length-1].pointer.spaceId:null===(m=fe().ZO())||void 0===m?void 0:m.pointer.spaceId}),r=o.getTitleStore();r&&vt().yr({environment:t,store:r,tokens:l,index:0,transaction:n}),Io({environment:t,blocks:[o],transaction:n,replaceEmptyTextBlock:!1}),nt().v(t,{from:"paste",type:d().xd.text,creating_block_id:o.id,parent_collection_id:o.getParentCollectionIdUpToTwoLevels()})}}({environment:o,textSelectionData:I,transaction:a,disableEmbedMenu:i,removeDiscussions:!p||("copy"===D||t)})}else if(T&&T.blocks.length>0&&"inline"!==_)a.logDebugMessage("paste: blockSelectionData detected, pasting block selection"),Mo(o,T,w,a);else if(L&&E&&O){const{simpleTableStore:e}=L.getProps(),{selection:t}=E,i=Fe().$O(e);t&&i&&Bt().GZ({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:i,event:r,transaction:a,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u})}else if(y)if(L&&E){const{simpleTableStore:e}=L.getProps(),{selection:t}=E,i=Fe().$O(e);t&&i&&(a.logDebugMessage("paste: pasting selection into simple table"),Bt().GZ({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:i,event:r,transaction:a,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u}))}else(P||x)&&"inline"!==_?(a.logDebugMessage("paste: pasting as html"),_o({environment:o,html:y,transaction:a,tinyMceMicrosoftWordPasteFilter:u}),tt({environment:o,type:"html",originalHtmlContentSize:b})):(a.logDebugMessage("paste: pasting as inline html"),Ao({environment:o,html:y,transaction:a,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:i,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u}),tt({environment:o,type:"inline_html",originalHtmlContentSize:b}));else a.logDebugMessage("paste: pasting as markdown"),To({environment:o,text:k,disableEmbedMenu:i,transaction:a,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:u}),tt({environment:o,type:"markdown",originalHtmlContentSize:b});He().A.setKeyboardMode(!0)}function zo(e){const{codeLanguage:t,environment:o,transaction:n}=e,r=$e().default.state,i="editing"===r.mode&&r.multiSelection,a=je().default.state.stores;if(!i&&0===a.length)return;let s,c,l;if(i?(s=i.start.store,c=i.end.store,l=(0,xe().T)(c)):(s=a[0],c=a[a.length-1],l=c),!l)return;let u=l;if((0,Ce().P4)(l))!function(e){const{blockStore:t,environment:o,transaction:n,codeLanguage:r}=e;me().transformBlocks({environment:o,blocks:[t],blockType:"code",transaction:n}),St().IA({blocks:[t],language:r,transaction:n})}({blockStore:l,environment:o,transaction:n,codeLanguage:t});else{const e=(0,xe().T)(l);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;u=At().Wv({environment:o,type:d().xd.code,inMemoryRecordCache:t,transaction:n,spaceId:e.pointer.spaceId}),wt().WH({parentStore:e.getContentStore(),afterStore:c,insertStore:u,transaction:n})}Ae().clear(o);const p=(0,xe().aI)(u);return p&&bt().setSelectionAtStart({store:p}),u}function Ho(e,t,o){const n="editing"===$e().default.state.mode&&$e().default.state.multiSelection;if(n){const r=(0,xe().T)(n.start.store);vt().$D({environment:e,editorMode:r?Ue().Uv.getMode(r):"default",multiSelection:n,string:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o})}}function Xo(e){const t=e.getNavigableBlockStore();if(t)return(0,ye().J8)({store:t,scrollToBlockId:t.id===e.id?void 0:e.id,fullyQualified:!0,pageVisitSource:l().y8.CopyLink,embedded:!1})}function jo(e){const{environment:t,blockStore:o,callback:n}=e;(0,ae().y)(),Re().wr();const r=Xo(o);if(r){qo({environment:t,stringValue:r,copiedMessage:o.isPageBlock()||o.isFormBlock()?Nt.copiedLinkToClipboard:Nt.copiedBlockLinkToClipboard}).then(n)}}function $o(e){const{environment:t,blockStore:o,callback:n}=e;(0,ae().y)(),Re().wr();const r=Xo(o),i=function(e,t){var o;const n=Xo(t);if(!n)return;const r=e.currentUser.id,i=(0,v()._z)({blockId:t.id,intl:Ie().A.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(r),userTimeZone:(0,M().P)()}),a=null===(o=t.getBlockIconStore())||void 0===o?void 0:o.getValue(),s=[(0,w().A)(a)?a:void 0,i].filter(ee().O9).join(" ");if(!s)return n;let c=`<a href="${n}"><span>${s}</span></a>`;return Ve().default.checkGate({gateName:"paste_links_as_mentions"})&&(c+=(0,ve().a0)({id:t.id,spaceId:t.getSpaceId()})),c}(t,o);if(r&&i){Zo({environment:t,stringValue:r,htmlValue:i,copiedMessage:o.isPageBlock()?Nt.copiedPageLinkToClipboard:o.isFormBlock()?Nt.copiedFormLinkToClipboard:Nt.copiedBlockLinkToClipboard}).then(n)}}function Jo(e){const{environment:t,blocks:o,callback:n}=e;(0,ae().y)(),Re().wr();const r=o.map(Xo).filter(ee().O9);if(r.some(Boolean)){const e=r.length>1?Nt.copiedLinksToClipboard:Nt.copiedLinkToClipboard;qo({environment:t,stringValue:r.join("\n\n"),copiedMessage:e}).then(n)}}function Go(e){const{environment:t,blocks:o,callback:n}=e,r=o[0];if(!r.isDefined())return;const i=r.getModel(),a=r.getProperties(),s=r.getFormat();let c;if(r.isType(d().xd.bookmark))c=H().q4_(a.link);else if((0,d().ie)(i.type))c=H().q4_(a.source);else if(r.isType(d().xd.externalObjectInstance)||r.isType(d().xd.externalObjectInstancePage))c=(null==s?void 0:s.original_url)||(null==s?void 0:s.uri);else if(r.isType(d().xd.collectionView)){var l;const e=null===(l=r.getCollectionStore())||void 0===l?void 0:l.getValue();var u;if(e&&(0,b().ek)(e))c=null===(u=e.format)||void 0===u?void 0:u.original_url}else{if(!r.isType(d().xd.alias))return;c=null==s?void 0:s.comment_alias_url}if(!c)return;if(k()._J(c))return void S().log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(c=te().q7(c),!c)return;(0,ae().y)(),Re().wr();qo({environment:t,stringValue:c,copiedMessage:Nt.copiedLinkToClipboard}).then(n)}function Zo(e){return Ko(e)}function qo(e){return Ko(e)}async function Ko(e){const{environment:t,htmlValue:o,stringValue:n,copiedMessage:r,showCopyModal:i}=e;function a(){Dt().IU({environment:t}),We().A.setState({...We().A.state,active:!0,stringValue:n})}if(i)a();else try{var s;if(t.device.isElectron&&null!==(s=Mt().electronApi)&&void 0!==s&&null!==(s=s.clipboard)&&void 0!==s&&s.write){const e={text:n};o&&(e.html=o),await Mt().electronApi.clipboard.write(e)}else if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(n);else{const e={"text/plain":new Blob([n],{type:"text/plain"})};o&&(e["text/html"]=new Blob([o],{type:"text/html"}));const t=new ClipboardItem(e);await navigator.clipboard.write([t])}r&&Pt().D6({label:Ie().A.formatMessage(r)})}catch{a()}}function Qo(){document.queryCommandSupported("copy")&&document.execCommand("copy")}async function Yo(e,t){let o;o="string"==typeof t?t:JSON.stringify(t),o&&await qo({environment:e,stringValue:o,copiedMessage:Nt.copiedToClipboard})}function en(e){const{environment:t,textSelection:o,markdownSerializationOptions:n,markdownLinkifyIt:r}=e,i=(0,Me().H7)(o);if(i&&i.selection.startIndex!==i.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:o,markdownSerializationOptions:n}=e,{store:r,selection:i}=o,a=t.currentUser.id,s=r.inMemoryRecordCache,c=Ie().A.getIntl(),d=r.getValue(),u=H().Ffo(d,i.startIndex,i.endIndex),m=r.getRecordStoreUIRoot().getValue();if(!m)return;const g={id:m.id,table:W().ev,spaceId:m.space_id},f=s.makeGetRecordValueFn(a);return _().ZR({textValue:u,exportArgs:{root:g,navigableBlockId:g.id,renderParentBlockId:void 0,blockId:g.id,userTimeZone:(0,M().P)(),intl:c,getRecordValue:f,getRecordModel:D().b4_.fromGetRecordValueFn(f),numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,p().A)({pageId:t,pageValue:f({table:W().ev,id:t}),baseUrl:ce().A.domainBaseUrl,pageVisitSource:l().y8.Export})},baseUrl:ce().A.domainBaseUrl,publicDomainName:ce().A.publicDomainName,transformAnnotation:null==n?void 0:n.transformAnnotation,transformBlockMapping:null==n?void 0:n.transformBlockMapping,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:Ve().default,collectionFeatureGates:(0,be().i)(),formulasModule:y()}})}({environment:t,singleStoreTextSelection:i,markdownSerializationOptions:n});const a=mo({environment:t,multiSelection:o,action:"copy"});if(!a)return;const{markdown:s}=(0,ve().Ij)({clipboardData:a,multiSelection:o,currentUserId:t.currentUser.id,isWindows:t.device.isWindows,markdownSerializationOptions:n,markdownLinkifyIt:r,formulasModule:y()});return s}function tn(e){const{environment:t,inMemoryRecordCache:o,text:n,transaction:r,markdownOptions:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s,parentPointer:l}=e,d=co({markdown:n,markdownOptions:i,markdownLinkifyIt:a});if(!d)return;const u=document.createElement("div");u.innerHTML=Ro({html:d,tinyMceMicrosoftWordPasteFilter:s});const{currentUserStore:p,currentSpaceStore:m}=Oe().default.state;if(!p||!m)return;const g=p.getValue();if(!g)return;const f=(fe().ZO()??m).id,v=m.id,b=(0,he().Gx)({environment:t,spaceId:v}),k=t.idCreator.getSpaceShortIdCreator(v,b),{allOperations:y,rootContentIds:h}=T().aH({actor:(0,c().A7)(g),parent:l??{id:f,table:W().ev,spaceId:m.id},rootNode:u,deps:{importFileMap:{},window,intl:Ie().A.getIntl(),randomID:Q().Ay,spaceIdCreator:k,randomShortID:Y().Ay,isPhoneNumber:R().W,emojiData:ge().A.state},options:{useCrdt:(0,le().D8)(m),ignoreBlockCount:!1,codePreviewFormat:o.isSyntheticAssistantData?"code":void 0}});for(const c of y)if((0,X().ph)(c)){const e=new(Xe().Bv)(t,c.pointer,{inMemoryRecordCache:o,userId:g.id});Ft().applyCrdtTextOperation({store:e,operation:c,invertedOperation:void 0,transaction:r})}else if((0,P().$Y)(c)){const e=new(Xe().pm)({environment:t,pointer:c.pointer,recordStoreOptions:{inMemoryRecordCache:o,userId:g.id}});Ft().applyOperation({store:e,operation:c,transaction:r})}else(0,ee().HB)(c);return h.map((e=>new(Xe().Bv)(t,{table:W().ev,id:e},{inMemoryRecordCache:o})))}function on(e){const{event:t,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}=e;if(!t.clipboardData)return;const{text:r,html:i,multiTextSelectionData:a,textSelectionData:s,blockSelectionData:c}=ao({clipboardData:t.clipboardData,tinyMceMicrosoftWordPasteFilter:n});if(a)return wo({text:r,html:i,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n});if(s){const{editing:e,selection:t}=s;return H().Uee(H().AI5(e,t.startIndex,t.endIndex).tokensInsideRange,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0})}return i||r?function(e){const{text:t,html:o,blockSelectionData:n,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i}=e,a=t.includes("\n");return a||n&&n.blocks.length>0?H().x9d(t):wo({text:t,html:o,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}({text:r,html:i,blockSelectionData:c,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}):void 0}},563015:(e,t,o)=>{o.d(t,{eJ:()=>f,ew:()=>g,ml:()=>d,rA:()=>p,yI:()=>m,zf:()=>u});o(581454);var n=()=>o(496603),r=()=>o(534177),i=()=>o(708685),a=()=>o(145076),s=()=>o(349835),c=()=>o(977345);function l(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().HB)(e)}}function d(e){switch(e.type){case s().M9.InvalidCharacter:return{...a().x0.InvalidCharacter,values:{errorCharacter:e.character}};case s().M9.UnclosedStringLiteral:return a().x0.UnclosedStringLiteral;case s().M9.UnclosedComment:return a().x0.UnclosedComment;case s().M9.TokenExpected:return{...a().x0.TokenExpected,values:{expectedToken:e.token}};case s().M9.StringLiteralContainsToken:return a().x0.StringLiteralContainsToken;case s().M9.ExpressionExpected:return a().x0.ExpressionExpected;case s().M9.PropertyTokenOrFunctionExpected:return a().x0.PropertyTokenOrFunctionExpected;case s().M9.EndOfInputExpected:return a().x0.EndOfInputExpected;case s().M9.UnexpectedError:return a().x0.UnexpectedError;case s().M9.TooDeeplyNested:return a().x0.TooDeeplyNested;default:(0,r().HB)(e)}}function u(e){switch(e.type){case s().IA.FunctionCallArgumentWrongType:case s().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function p(e,t){let o;switch(t.type){case s().IA.ThisRowTypeNotFound:o=a().Xz.ThisRowTypeNotFound;break;case s().IA.ThisRowNotBlockWithCollection:o=a().Xz.ThisRowNotBlockWithCollection;break;case s().IA.MissingPropertyOnThisRow:o={...a().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().IA.MissingContextVariable:{const e=(0,c().ix)(t.token)?t.token.contextValueId:t.token.valueId;o={...a().Xz.MissingContextVariable,values:{valueId:e}}}break;case s().IA.MissingBlock:o={...a().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case s().IA.CallingNotFunction:o={...a().Xz.CallingNotFunction,values:{expressionType:l(t.callee.type.type)}};break;case s().IA.FunctionCallTooFewArguments:o={...a().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().IA.FunctionCallUnexpectedArgument:o={...a().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().IA.FunctionCallArgumentWrongType:o={...a().Xz.FunctionCallArgumentWrongType,values:{argumentType:l(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().IA.MemberPropertyMismatchCollection:o={...a().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().IA.MemberPropertyMissing:o={...a().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().IA.MemberPropertyTargetNotBlock:o=a().Xz.MemberPropertyTargetNotBlock;break;case s().IA.MemberPropertyTypeInvalid:o={...a().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().IA.UndefinedIdentifier:o={...a().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().IA.UnifiedFunctionCannotFindFunction:o={...a().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().IA.UnifiedFunctionNoArguments:o={...a().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().IA.UnifiedFunctionTargetWrongType:o={...a().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:l(t.expression.type.type)}};break;case s().IA.CannotRelativelyCompareTypes:o={...a().Xz.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.CannotDoMathOnType:o={...a().Xz.CannotDoMathOnType,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.UnaryMinusOnNonNumber:o={...a().Xz.UnaryMinusOnNonNumber,values:{type:l(t.expression.type.type)}};break;case s().IA.IdentifierExpected:o=a().Xz.IdentifierExpected;break;case s().IA.FunctionCallExpected:o={...a().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().IA.RenamedIdentifier:o={...a().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().IA.RemovedFunction:o={...a().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().IA.ContextVariableNotBlockWithCollection:o={...a().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().IA.MissingPropertyOnContextVariable:o={...a().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().IA.BlockPropertyTypeInvalid:o={...a().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().IA.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));o={...a().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,i().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().IA.CrossSpacePropertyNotSupported:o={...a().Xz.CrossSpacePropertyNotSupported};break;default:(0,r().HB)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function m(e,t){let o;switch(t.type){case s().uW.MissingThisRow:o=a().X8.MissingThisRow;break;case s().uW.MissingSchemaPropertyOnThisRow:o={...a().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().uW.ThisRowBlockPropertyMismatchCollection:o=a().X8.ThisRowBlockPropertyMismatchCollection;break;case s().uW.MissingContextVariable:o={...a().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case s().uW.IdentifierNotFound:o={...a().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().uW.CannotRelativelyCompareTypes:o={...a().X8.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType),rhsType:l(t.rhsType)}};break;case s().uW.CannotDoMathOnType:o={...a().X8.CannotDoMathOnType,values:{valueType:l(t.valueType)}};break;case s().uW.CannotCallNonFunction:o={...a().X8.CannotCallNonFunction,values:{calleeType:l(t.calleeType)}};break;case s().uW.UnifiedFunctionPropertyNotFound:o={...a().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().uW.LibraryFunctionExecutionError:const n=t.error instanceof s().x4?t.error:void 0;o=(null==n?void 0:n.info.type)===s().v3.DateInvalidDurationUnit?{...a().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===s().v3.CannotUseToNumberOnList?{...a().gW.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===s().v3.CannotRoundToNonInteger?{...a().gW.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===s().v3.CannotRoundToTooManyDecimalPlaces?{...a().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...a().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallTooFewArguments:o={...a().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallUnexpectedArgument:o={...a().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallArgumentWrongType:o={...a().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:l(t.argumentType)}};break;case s().uW.AccessingPropertyOnNonBlock:o=a().X8.AccessingPropertyOnNonBlock;break;case s().uW.MissingDataDependencyBlock:o={...a().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().uW.MissingDataDependencyPerson:o={...a().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().uW.MemberPropertyMismatchCollection:o=a().X8.MemberPropertyMismatchCollection;break;case s().uW.MissingPropertyOnSchemaForMemberProperty:o=a().X8.MissingPropertyOnSchemaForMemberProperty;break;case s().uW.UnaryMinusOnNonNumber:o={...a().X8.UnaryMinusOnNonNumber,values:{expressionType:l(t.expressionType)}};break;case s().uW.UnexpectedRecoveryNode:o=a().X8.UnexpectedRecoveryNode;break;case s().uW.UnexpectedError:o=a().X8.UnexpectedError;break;case s().uW.DepthExceeded:o=a().X8.DepthExceeded;break;case s().uW.CycleDetected:o=a().X8.CycleDetected;break;case s().uW.DownstreamParseFailure:o=a().X8.DownstreamParseFailure;break;case s().uW.MaxEvaluationTimeExceeded:o=a().X8.MaxEvaluationTimeExceeded;break;case s().uW.MissingSchemaPropertyOnCollection:o={...a().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().uW.ContextVariableWrongType:o={...a().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().uW.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));o={...a().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,i().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().HB)(t)}return(0,c().li)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function g(e){const t=null==e?void 0:e.values;return[n().cJ(e,"values"),t]}function f(e){return e.type===s().uW.DepthExceeded||e.type===s().uW.CycleDetected||e.type===s().uW.MaxEvaluationTimeExceeded||e.type===s().uW.LibraryFunctionExecutionError}},568131:(e,t,o)=>{o.r(t),o.d(t,{duplicateBlock:()=>T});o(16280),o(898992),o(823215),o(581454),o(737550);var n=()=>o(179034),r=()=>o(665344),i=()=>o(854150),a=()=>o(466614),s=()=>o(970330),c=()=>o(901389),l=()=>o(863168),d=()=>o(594794),u=()=>o(611191),p=()=>o(972435),m=()=>o(494043),g=()=>o(406792);class f{constructor(e){this.environment=void 0,this.metricName=void 0,this.startMetric=void 0,this.prevLapMetric=void 0,this.extraData=void 0,this.environment=e.environment,this.metricName=e.metricName,this.startMetric=g().default.mark(e.metricName),this.prevLapMetric=g().default.mark(e.metricName),this.extraData=e.extraData??{}}mark(e){g().default.measure(this.prevLapMetric,{environment:this.environment,data:{type:e,...this.extraData},sampleDecision:"default"}),this.prevLapMetric=g().default.mark(this.metricName)}end(){g().default.measure(this.startMetric,{environment:this.environment,data:{type:"total",...this.extraData},sampleDecision:"default"})}}var v=()=>o(765957),b=()=>o(227440),k=()=>o(630116),y=()=>o(261450),h=()=>o(59110),S=()=>o(605605),I=()=>o(53592),M=()=>o(677733);function T(e){const{environment:t,stores:o,transaction:g,targetSpaceId:T,preferDuplicateLocation:C,analyticsFrom:x,options:w,installationImprint:A,shouldAttemptServerBackedLocalDuplication:_,templateInstallationMetadata:D,shouldUseSynchronousDuplicationAPI:P}=e,B=new f({environment:t,metricName:"duplicate_block_stopwatch",extraData:{duplication_type:"local"===C?"local_duplication":_?"server_backed_local_duplication":P?"server_synchronous_duplication":"server_duplication",from:x}});if(0===o.length)throw new Error("Must duplicate at least one block");const R=o[0].getSpaceId();if(!o.every((e=>e.getSpaceId()===R)))throw new Error("All stores must be in the same space");if(o.length>1&&!o.every((e=>e.isTypedCollectionViewBlock())))throw new Error("Multiple source blocks only supported for grouped typed DB duplication");!function(e){const{environment:t,stores:o,analyticsFrom:n}=e;for(const a of o){var r;const e=a.getRecordStoreAtRootPath().getValue();if(!e)continue;const{currentSpaceStore:o}=v().default.getState();let c;o&&e.parent_table===i().yK&&(c=k().h4.createChildStore(o,{table:i().yK,id:e.parent_id})),s().v(t,{from:n??"copy",type:e.type,teamStore:c,is_toggleable:(0,m().Yt)(e.type,e.format),collection_id:a.getAssociatedCollectionId()??(null===(r=a.getCollectionStore())||void 0===r?void 0:r.id),new_page_id:"page"===e.type?a.id:void 0,creating_block_id:a.id,parent_collection_id:a.getParentCollectionIdUpToTwoLevels(),form_id:a.getFirstFormIdInCollectionViewBlock()})}}({environment:t,stores:o,analyticsFrom:x}),B.mark("track_create_blocks"),w.convertExternalObjectInstancesToPlaceholders=R!==T;const F=D&&(0,r().Fe)(D.source)&&D.isListedTemplate;if("local"===C&&1===o.length&&!F){const e=function(e){const{environment:t,store:o,sourceSpaceId:r,targetSpaceId:i,transaction:s,options:c,installationImprint:p,templateInstallationMetadata:m,stopwatch:g}=e,f=(0,u().$J)(),v=(0,h().loadLocalSubtree)(t,{blockId:o.id,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!c.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!c.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:f}).recordMap;if(null==g||g.mark("load_local_subtree"),!v||a().Lw({sourceSpaceId:r,targetSpaceId:i,sourceBlockSubtree:v}))return;const{targetBlockStore:b}=(0,S().localDuplicate)({environment:t,sourceBlockId:o.id,targetBlockPointer:(0,d().zP)({environment:t,table:n().ev,spaceId:i}),sourceBlockSubtree:v,targetInMemoryRecordCache:o.inMemoryRecordCache,options:{...c,preventLegacyTransclusions:f},transaction:s,installationImprint:p,templateInstallationMetadata:m,stopwatch:g});"ai_block"===b.getType()&&l().EF.setState(b.pointer.id);return{blockStores:[b],onComplete:Promise.resolve({status:"success"})}}({environment:t,store:o[0],options:w,sourceSpaceId:R,targetSpaceId:T,transaction:g,installationImprint:A,templateInstallationMetadata:D,stopwatch:B});if(e)return B.mark("try_local_duplication_success"),B.end(),e;B.mark("try_local_duplication_failure")}const L=t.defaultRecordCache.inMemoryRecordCache;if(o.some((e=>e.inMemoryRecordCache!==L)))throw new Error("Can only server duplicate from the environment.defaultRecordCache.inMemoryRecordCache.");let E;return b().A.state.online||c().f1(p().A.formatMessage(y().V.offlineError)),E=1===o.length&&_?(0,I().serverBackedLocalDuplicate)({environment:t,sourceBlock:{id:o[0].id,spaceId:o[0].getSpaceId()},targetInMemoryRecordCache:L,transaction:g,targetSpaceId:T,installationImprint:A,templateInstallationMetadata:D,stopwatch:B,shouldUseSynchronousDuplicationAPI:P,options:w}):(0,M().serverDuplicate)({environment:t,sourceBlocks:o.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),targetInMemoryRecordCache:L,transaction:g,targetSpaceId:T,installationImprint:A,templateInstallationMetadata:D,stopwatch:B,shouldUseSynchronousDuplicationAPI:P,options:w}),async function(){const{blockStores:e,onComplete:t}=E;if("success"===(await t).status)for(const o of e)if("ai_block"===o.getType())return void l().EF.setState(o.pointer.id)}(),B.mark("duplicate_block_immediate_return"),E.onComplete.then((e=>{B.end()})),E}},663199:(e,t,o)=>{o.d(t,{W:()=>i});var n=()=>o(970013),r=()=>o(72135);function i(e){let{intl:t,propertySchema:o,value:i}=e,a=r().C4;return o&&(0,n().AM)(o)&&(a=o.number_format??r().C4),r().ZV(i,a,t)}},673898:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{active:!1,stringValue:""}}}const r=new n},735790:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.25 15.25 11.5",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},i=(0,o(340498).wt)("sliders",r)},754199:(e,t,o)=>{function n(e){return/^(\+\d{1,2}[\s.-])?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function r(e){return/^[0-9 .()\-\+]{7,}$/.test(e)}o.d(t,{W:()=>n,e:()=>r})},813743:(e,t,o)=>{o.d(t,{O8:()=>F,Yf:()=>B,fS:()=>R});var n=()=>o(221844),r=()=>o(496506),i=()=>o(700500),a=()=>o(792071),s=()=>o(861017),c=()=>o(179034),l=()=>o(197959),d=()=>o(161479),u=()=>o(919709),p=()=>o(534177),m=()=>o(246826),g=()=>o(778417),f=()=>o(725614),v=()=>o(780054),b=()=>o(97270),k=()=>o(299545),y=()=>o(906537),h=()=>o(110955),S=()=>o(487494),I=()=>o(176106),M=()=>o(525112),T=()=>o(375447),C=()=>o(630116),x=()=>o(292167),w=()=>o(437219),A=()=>o(722101),_=()=>o(666144),D=()=>o(319975),P=()=>o(751156);function B(e){const{environment:t,textStore:o,blockStore:i,url:a,oldTextValue:u,urlSelection:p}=e;if(h().A.state.open||b().A.state.open||T().Ay.state.open||I().A.state.open)return!1;const m=y().get();if(!m)return!1;const g=y().getRect(m);if(!g)return!1;const f=(0,s().parseRoute)({url:a,baseUrl:v().A.domainBaseUrl,publicDomainName:v().A.publicDomainName,isMobile:t.device.isMobile,protocol:v().A.protocol,currentUrl:window.location.href});if("page"===f.name&&Boolean(f.discussionId)&&f.discussionId){const e=f.discussionId,s=f.blockId;if(!s)return!1;const m=i.getParentBlockStore();if(!m)return!1;const v=(0,C().Oo)(m,{table:c().ev,id:s,spaceId:(0,d().e)(m.pointer.spaceId)}),b=(0,C().Oo)(v,{table:l().$Y,id:e,spaceId:(0,d().e)(i.pointer.spaceId)});if("none"===b.getRole())return!1;const y=new(r().ComputedStore)((()=>k().wc(b)[0]),{debugName:"firstCommentStore"}),h=new(n().A)({name:"internalUnfurlingMenuActions.activate",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(h);const I=i.clone(h),T=o.clone(h),x=m.clone(h);return M().A.setState({args:{commentStore:y},stores:{blockStore:i,textStore:o,parentStore:m},temporaryStores:{blockStore:I,textStore:T,parentStore:x},temporaryRecordCache:h,focusedIndex:S().A.Preview,selectionRect:g,oldTextValue:u,open:!0,url:a,urlSelection:p}),w().wQ(t,{url:a}),!0}return!1}function R(e){const{actionType:t,environment:o,commentStore:n,useTempStores:r}=e,i=M().A.state;if(!i.open)return;const{oldTextValue:s}=i,c=r?i.temporaryStores:i.stores,{textStore:l,blockStore:m,parentStore:v}=c,b=o.currentUser.id;if(b){if(r){i.temporaryRecordCache.clearCache();for(const e in i.temporaryStores){const t=i.temporaryStores[e],n={userId:b,pointer:t.pointer},r=o.defaultRecordCache.inMemoryRecordCache.getRecord(n);r?_().PC({environment:o,inMemoryRecordCache:i.temporaryRecordCache,pointer:t.pointer,model:a().Bj6.fromValue(t.pointer.table,r.value),role:r.role,updatePaths:[[]],userId:b,force:!0,debugSource:"setUnfurlType"}):_().oX({environment:o,inMemoryRecordCache:i.temporaryRecordCache,persistedRecordCache:void 0,pointer:t.pointer,userId:b})}}else o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i.temporaryRecordCache);switch(t){case S().A.Link:g().hc({environment:o,store:i.stores.blockStore}),f().setSelection({store:i.stores.textStore,selection:{startIndex:i.urlSelection.endIndex,endIndex:i.urlSelection.endIndex}}),M().A.setState({...i,focusedIndex:S().A.Link});break;case S().A.Mention:if(!n)return;const e=(0,d().e)(l.pointer.spaceId);if(!e)return;const r=n.id;P().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.mention",canUndo:!0,perform:t=>{D().R9({environment:o,store:l,value:s,transaction:t}),D().Gf({environment:o,editorMode:"default",store:l,selection:{startIndex:i.urlSelection.startIndex,endIndex:i.urlSelection.startIndex},annotation:u().hiQ(r,e),transaction:t,analyticsFrom:"block"})}}),M().A.setState({...i,focusedIndex:S().A.Mention});break;case S().A.Preview:if(!n)return;P().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.preview",canUndo:!0,perform:e=>{D().R9({environment:o,store:l,value:s,transaction:e});const t=k().eK(n);if(!t)return;if(!k().No(t)||!v||!t.getParentId())return;const r=x().s({environment:o,parentBlockStore:v,targetStore:n,transaction:e});if(A().WH({parentStore:v.getContentStore(),insertStore:r,afterStore:m,transaction:e}),0===u().q4_(i.oldTextValue).trim().length){const t=C().Bv.createChildStore(v.getContentStore(),i.stores.blockStore.pointer);A().TF({parentStore:v.getContentStore(),childToRemoveStore:t,transaction:e})}}}),M().A.setState({...i,focusedIndex:S().A.Preview});break;default:throw(0,p().HB)(t)}r||M().A.setState({open:!1})}}function F(e){var t,o;const{blockStore:n,transaction:r}=e,a=n.getType(),s=n.getFormat(),c=n.getSpaceId();if(!n.isDefined()||a!==i().xd.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const l=[u().wmz(u().hiQ(null==s||null===(o=s.alias_pointer)||void 0===o?void 0:o.id,c))];m().zv({store:n,data:{type:i().xd.text},transaction:r}),m().zv({store:n.getFormatStore(),data:{alias_pointer:null},transaction:r}),D().R9({environment:n.environment,store:n.getBlockTitleStore(),value:l,transaction:r})}}}]);