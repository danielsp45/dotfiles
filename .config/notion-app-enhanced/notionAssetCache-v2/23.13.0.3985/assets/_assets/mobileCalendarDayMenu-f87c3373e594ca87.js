"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53638],{381451:(e,t,r)=>{r.d(t,{MobileCalendarDayMenu:()=>ae});r(581454);var o=()=>r(244641),a=r(296540),n=()=>r(484714),l=()=>r(56366),i=()=>r(401497),s=()=>r(757695),c=()=>r(584262),d=()=>r(597777),u=()=>r(869190),m=()=>r(604995),f=()=>r(416504),y=()=>r(955363),p=()=>r(380048),S=()=>r(742117),g=()=>r(179034),h=()=>r(959013),v=()=>r(496603),x=()=>r(612008),b=()=>r(435009),C=()=>r(751156),k=()=>r(319357),O=()=>r(101981),j=()=>r(519839),D=()=>r(274652),M=()=>r(760217),A=()=>r(285790),_=()=>r(928600),w=()=>r(64e3),B=()=>r(480095),P=()=>r(8980),R=()=>r(89924),I=()=>r(320865),V=()=>r(484792),K=()=>r(862292),T=()=>r(492414),E=()=>r(722872),L=()=>r(645873);class z extends s().Store{getInitialState(){return{}}}const U=z;var Z=()=>r(630116),N=()=>r(465364),Q=()=>r(833880),F=(r(898992),r(354520),r(672577),()=>r(860118)),W=()=>r(740241),G=()=>r(187820),J=()=>r(909470),H=()=>r(972435),Y=()=>r(765957),q=()=>r(217429),X=r(474848);const $=function(e){let{time:t,store:o,format:n,schema:s,blockPropertyValueOverlayStore:d,collectionStore:u}=e;const m=(0,i().DP)(),f=(0,l().K8)((()=>o.getIcon()),[o]),y=(0,l().K8)((()=>Boolean(o.getIcon())||!o.isEmptyPage()),[o]),p=(0,l().K8)((()=>o.hasError()),[o]),S=(0,l().K8)((()=>o.isEmptyPage()),[o]),g=(0,l().K8)((()=>(0,G().Te)(o)),[o]),h=(0,l().K8)((()=>(0,T().Ay)({store:o,fullyQualified:!1,pageVisitSource:c().y8.LinkInPage})),[o]),v=(0,l().K8)((()=>r(299545).oC(o,{recursivelyLoadAllDiscussions:!1})),[o]),x=(0,l().K8)((()=>{var e;return(null==n?void 0:n.table_wrap)||!0===(null==n||null===(e=n.calendar_properties)||void 0===e||null===(e=e.find((e=>"title"===(null==e?void 0:e.property))))||void 0===e?void 0:e.wrap)}),[null==n?void 0:n.calendar_properties,null==n?void 0:n.table_wrap]);return(0,X.jsx)(r(187485).A,{href:h,children:(0,X.jsx)(M().A,{focused:!1,title:(0,X.jsxs)(a.Fragment,{children:[t&&(0,X.jsx)("div",{style:{display:"flex",color:m.text.secondary,fontSize:14,marginTop:8,marginBottom:6},children:t}),(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",...t&&{marginBottom:8}},children:[y&&!p&&(0,X.jsx)(G().B6,{disabled:!0,icon:f,isEmptyPage:S,iconRecordCategory:g,size:24,style:{flexShrink:0,marginRight:8,alignSelf:"baseline"}}),p&&(0,r(693954).Q)({marginLeft:2,marginRight:10,width:20,fill:m.palette.orange[500]}),(0,X.jsx)(r(16006).A,{store:o,style:{fontWeight:r(284371).Wy.semibold,whiteSpace:x?"pre-wrap":void 0}}),v>0&&(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",color:m.text.secondary,fontSize:12,marginLeft:4,flexShrink:0,alignSelf:"baseline"},children:[(0,r(965998).M)({width:12,height:12,marginRight:4,fill:m.icon.secondary}),v]})]})]}),caption:(0,X.jsx)(te,{format:n,schema:s,store:o,blockPropertyValueOverlayStore:d,collectionStore:u})})})};function ee(e){let{property:t,schema:r,store:o,blockPropertyValueOverlayStore:a,collectionStore:n}=e;return r[t]?(0,X.jsx)(W().BlockPropertyRouter,{store:o,property:t,disabled:!0,locked:!1,format:"calendar",tableWrap:!1,blockPropertyValueOverlayStore:a,collectionStore:n},t):null}function te(e){let{format:t,schema:r,store:o,blockPropertyValueOverlayStore:a,collectionStore:n}=e;const{value:i}=(0,L().fJ)(K().T.formulas),s=(0,l().K8)((()=>(t.calendar_properties?t.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).filter((e=>{var t;return(0,F().T)({block:o.getModel(),property:e,schema:r,getRecordModel:o.getRecordModel,userId:null===(t=Y().default.state.currentUserStore)||void 0===t?void 0:t.id,userTimeZone:(0,f().P)(),intl:H().A.getIntl(),experimentService:q().default,collectionFeatureGates:(0,J().i)(),formulasModule:i})}))),[t.calendar_properties,r,o,i]);return s.length>0?(0,X.jsx)("div",{style:{marginTop:8},children:s.map((e=>(0,X.jsx)(ee,{property:e,schema:r,store:o,blockPropertyValueOverlayStore:a,collectionStore:n},e)))}):null}const re=(0,h().YK)({leftArrow:{defaultMessage:"Navigate to previous day",id:"mobileCalendarDayMenu.navigation.leftArrow"},rightArrow:{defaultMessage:"Navigate to next day",id:"mobileCalendarDayMenu.navigation.rightArrow"}}),oe=s().Store.createClass(void 0,{name:"ResultStore"});function ae(e){const{collectionContextStore:t,initialStartOfDay:r,calendarBy:o,disabled:n,onDismiss:i,blockPropertyValueOverlayStore:s,schema:c,format:d}=e,u=(0,l().uB)(void 0,oe),m=(0,l().uB)(void 0,U),f=(0,l().K8)((()=>(0,Q().Sn)({collectionContextStore:t,startOfDay:ie(r,m).valueOf()})),[t,r,m]),y=(0,a.useCallback)((()=>(0,X.jsx)(ce,{collectionContextStore:t,calendarBy:o,initialStartOfDay:r,disabled:n,onDismiss:i,blockPropertyValueOverlayStore:s,schema:c,format:d,store:m,resultStore:u})),[t,o,r,n,i,s,c,d,m,u]);return f?(0,X.jsx)(O().A,{id:"calendar_day_results",reducer:f,collectionContextStore:t,render:y,resultStore:u}):null}function ne(e){let{item:t,currentStartOfDay:r,currentEndOfDay:o,schema:a,calendarBy:n,intl:l}=e;const i=a[n];if(!i||"date"!==i.type)return;const s=i.date_format||d().vz,c=i.time_format||d().CE,y=t.start,p=t.end,S=Boolean(!(r<=y&&y<=o)||p&&!(r<=p&&p<=o));if(t.end){const e=m().NC(t.start.valueOf(),t.end?t.end.valueOf():t.start.valueOf(),t.timeZone??(0,f().P)());return S?(0,u().ZF)({value:e,date_format:s,time_format:c,userTimeZone:t.timeZone,allowRelativeDates:!0,intl:l}):(0,u().sH)({start_time:e.start_time,end_time:e.end_time,time_format:c,humanReadable:!0,intl:l})}return(0,u().fU)({start_time:m().KQ(t.start.valueOf(),t.timeZone??(0,f().P)()).start_time,time_format:c,humanReadable:!0,intl:l})}function le(e){let{blockStore:t,item:r,currentStartOfDay:o,currentEndOfDay:a,disabled:n,blockPropertyValueOverlayStore:i,collectionContextStore:s,schema:c,calendarBy:d,format:u}=e;const m=(0,h().tz)(),f=(0,l().K8)((()=>s.collectionStore()),[s]);return f?(0,X.jsx)($,{store:t,time:r.includeTime?ne({schema:c,calendarBy:d,intl:m,item:r,currentStartOfDay:o,currentEndOfDay:a}):void 0,disabled:n,format:u,schema:c,blockPropertyValueOverlayStore:i,collectionStore:f},r.id):null}function ie(e,t){const{currentStartOfDay:r}=t.state;return r?o().c9.fromMillis(r):o().c9.fromMillis(e)}function se(e,t,r,o,a,n){const l=ie(o,a),i=C().createAndCommit({userAction:"MobileCalendarDayMenu.newStore",environment:e,canUndo:!0,perform:o=>{const a=(0,x().Q)({environment:e,collectionContextStore:t,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"mobile_calendar_day_menu"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(a)return N().D5({type:"timestamp",environment:e,store:a.newStore,propertyId:r,timestampMs:l.valueOf(),transaction:o}),a.newStore}});if(!i.performResult)return;!function(e,t,r){r?r(e):b().oo({environment:t,url:e})}((0,T().Ay)({store:i.performResult,pageVisitSource:c().y8.Create}),e,n)}function ce(e){let{collectionContextStore:t,calendarBy:r,initialStartOfDay:o,disabled:s,onDismiss:c,blockPropertyValueOverlayStore:d,schema:m,format:f,store:x,resultStore:b}=e;const C=(0,n().v3)(),O=(0,h().tz)(),{value:T}=(0,L().fJ)(K().T.formulas),z=(0,a.useContext)(V().n),U=(0,l().K8)((()=>t.collectionStore()),[t]),F=(0,l().K8)((()=>ie(o,x)),[o,x]),W=F.endOf("day"),G=(0,a.useCallback)((()=>se(C,t,r,o,x,z)),[C,t,r,o,x,z]),J=(0,a.useCallback)(((e,t)=>{N().D5({type:"timestamp",environment:C,store:t,propertyId:r,timestampMs:F.valueOf(),transaction:e})}),[r,F,C]),H=(0,a.useCallback)((()=>function(e,t){const r=ie(e,t);t.setState({...t.state,currentStartOfDay:r.plus({day:1}).valueOf()})}(o,x)),[o,x]),Y=(0,a.useCallback)((()=>function(e,t){const r=ie(e,t);t.setState({...t.state,currentStartOfDay:r.minus({day:1}).valueOf()})}(o,x)),[o,x]),q=(0,l().K8)((()=>function(e,t,r,o,a){const n=t.collectionStore();if(!n)return;const l=o.state,i=t.normalizedQueryStore.state,s=t.normalizedSchemaStore.state,c=i?i.calendar_by:void 0;if(!(l&&i&&c&&s))return;const d=new Map,u=new Map,m=new Map;let f=v().oE(l.blockIds.map((t=>{const o=Z().Bv.createChildStore(n,{id:t,table:g().ev});return(0,Q().S4)({blockStore:o,calendarBy:c,schema:s,getRecordValue:n.getRecordValue,userId:e.currentUser.id,intl:r,resultCache:d,regExpCache:u,formatDateCache:m,formulasModule:a})})));return i.sort||(f=v().Ul(f,(e=>e.start))),f}(C,t,O,b,T)),[C,t,O,b,T]),$=(0,l().K8)((()=>j().fG({collectionContextStore:t,environment:C,intl:O})),[t,C,O]),ee=(0,i().IS)((e=>({headerStyle:{display:"flex",alignItems:"center",height:"100%"},linkExistingButton:{color:e.text.secondary,fill:e.text.secondary}})),[]);return U?(0,X.jsxs)(_().A,{menuType:E().gu.Modal,title:(0,X.jsxs)("div",{style:ee.headerStyle,children:[(0,X.jsx)(A().A,{onClick:Y,icon:p().I,style:{marginRight:8,marginTop:2},ariaLabel:O.formatMessage(re.leftArrow)}),(0,X.jsx)("div",{children:(0,u().eV)({value:F,preset:"month_day_long"})}),(0,X.jsx)(A().A,{onClick:H,icon:S().V,style:{marginLeft:8,marginTop:2},ariaLabel:O.formatMessage(re.rightArrow)})]}),right:(0,X.jsx)(B().DoneMenuText,{}),onClickRight:c,children:[!q&&(0,X.jsx)(R().A,{children:(0,X.jsx)(I().A,{})}),q&&0===q.length&&(0,X.jsx)(R().A,{children:(0,X.jsx)(w().A,{title:(0,X.jsx)(h().sA,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})}),q&&q.length>0&&(0,X.jsx)(R().A,{children:q.map((e=>{const o=Z().Bv.createChildStore(U,{id:e.id,table:g().ev});return(0,X.jsx)(le,{disabled:s,blockPropertyValueOverlayStore:d,collectionContextStore:t,schema:m,calendarBy:r,format:f,blockStore:o,item:e,currentStartOfDay:F,currentEndOfDay:W},e.id)}))}),!s&&(0,X.jsxs)(R().A,{topBorder:!0,children:[(0,X.jsx)(D().o,{focused:!1,color:"secondary",onClick:G,title:(0,X.jsx)(h().sA,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})}),$&&(0,X.jsx)(k().O,{collectionContextStore:t,renderLinkButton:e=>(0,X.jsx)(M().A,{...e,focused:!1,title:(0,X.jsx)(h().sA,{id:"mobileCalendarDayMenu.linkExistingButton.label",defaultMessage:"Link existing"}),icon:(0,X.jsx)(P().I,{icon:y().arrowDiagonalUpRightIcon}),style:ee.linkExistingButton}),onAddOrLink:J})]})]}):null}}}]);