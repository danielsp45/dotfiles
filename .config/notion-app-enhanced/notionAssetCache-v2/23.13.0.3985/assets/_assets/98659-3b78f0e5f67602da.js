(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[98659],{181856:(e,t,r)=>{"use strict";r.d(t,{Dp:()=>F,GW:()=>l,HQ:()=>s,LN:()=>o,N8:()=>k,Qv:()=>w,RR:()=>d,S2:()=>K,SX:()=>h,TP:()=>$,Te:()=>n,Uc:()=>v,af:()=>N,bV:()=>_,dO:()=>m,gJ:()=>c,js:()=>C,kT:()=>M,nB:()=>u,nD:()=>T,oN:()=>b,oS:()=>x,qW:()=>y,u7:()=>E,w5:()=>f,wL:()=>a,xU:()=>g,yc:()=>p,yd:()=>I});r(16280),r(581454);var i=()=>r(534177);class n extends Error{constructor(e,t,r){super(t),this.type=e,this.cause=r}getMetadata(){}}class a extends n{}class o extends a{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class s extends a{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class l extends a{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class d extends a{constructor(e){const{tagName:t,unexpectedNode:r}=e;let i;i=r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?i+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(i+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(i+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(i+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",i),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=r}}class u extends a{constructor(e){const{tagName:t,unexpectedNode:r,conditionName:i,cause:n}=e;super("disallowed_child_in_condition",r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag with "${i}" condition`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag with "${i}" condition`:`Encountered an invalid child inside a <${t}> tag with "${i}" condition`),this.cause=void 0,this.cause=n}}class c extends a{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class p extends a{constructor(e){let t;(0,i().O9)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,i().HB)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class y extends a{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class g extends a{constructor(e){const{expectedIdType:t,receivedIdType:r,tagNameForErrorMessage:i,idValueForErrorMessage:n}=e;super("unexpected_id_type",i?`Expected ID ${n} in <${i}> to be of type '${t}', instead received ID of type '${r}'`:`Expected ID ${n} to be of type '${t}', instead received ID of type '${r}'`)}}class h extends a{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class m extends a{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class f extends a{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class b extends a{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class x extends a{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class k extends a{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class I extends a{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class T extends a{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class w extends a{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class v extends a{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class C extends a{constructor(e){super("invalid_query_condition",`<${e.tagName}> condition operator must be ${e.allowedOperators.map((e=>`"${e}"`)).join(" or ")}, not "${e.inputCondition}"`)}}class F extends a{constructor(e){super("children_required",`<${e.tagName}> must have children`)}}class _ extends a{constructor(e){super("only_one_child_allowed",`Only one ${e} element is allowed`)}}class $ extends a{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class E extends n{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class K extends n{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class M extends n{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class N extends n{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},242634:()=>{},805126:(e,t,r)=>{"use strict";r.d(t,{HS:()=>M,ZR:()=>$,Jz:()=>N,_R:()=>F,Hg:()=>I,zj:()=>D,Ns:()=>C,JD:()=>w,o:()=>v,A3:()=>T,d$:()=>U,tC:()=>_,sQ:()=>R,Ft:()=>B,av:()=>q,o6:()=>K,LK:()=>P,l0:()=>S,Pp:()=>j,validateConfigStringAgainstValidators:()=>O});r(18107),r(410838),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(967357),r(898992),r(823215),r(354520),r(672577),r(430670),r(581454);var i=()=>r(158489);var n=()=>r(584262),a=()=>r(753514),o=()=>r(179034),s=()=>r(869558),l=()=>r(919709),d=()=>r(496603),u=()=>r(534177),c=()=>r(865454),p=()=>r(492414),y=()=>r(299545),g=()=>r(765957),h=()=>r(630116),m=()=>r(148832),f=()=>r(915189),b=()=>r(638681);const x=b().union([b().object({required:{collectionId:b().uuid(),pageId:b().uuid(),type:b().literal("collection")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{pageId:b().uuid(),type:b().literal("page")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{siteId:b().uuid(),type:b().literal("site")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{teamId:b().uuid(),type:b().literal("teamspace")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("ai-knowledge")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("everything")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("helpdocs")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("labeler")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("notion")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("notion-none")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("slackbot")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("universal-none")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("universal-workspace")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("web")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literal("workspace")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}}),b().object({required:{type:b().literals("github","gmail","google-calendar","google-drive","jira","linear","microsoft-teams","notion-mail","outlook","sharepoint","slack")},optional:{ancestorsFilter:b().array(b().string()),createdByFilter:b().array(b().uuid()),dateRangeFilter:b().object({required:{},optional:{endDate:b().string(),startDate:b().string()}}),excludeCreatedByFilter:b().array(b().uuid()),teamspacesFilter:b().array(b().string()),titleOnlyFilter:b().boolean()}})]),k=b().object({required:{scopeForNextSearch:x,type:b().literal("search")},optional:{searchSessionId:b().string(),useWebSearch:b().boolean()}});function I(e,t){if(!t)return{cachedInferences:[],annotationInferences:[]};const{inferences:r,inferenceKeysToAnnotations:i,acceptedInferenceKeys:n}=e.getOrCreateClientAIChatThreadStore(t).state,a=new Map;for(const o of r)a.set(o.key,o);return{cachedInferences:d().oE(n.map((e=>a.get(e)))),annotationInferences:d().oE(Object.entries(i).map((e=>{let[t,r]=e;const i=a.get(t);if(i)return{...i,value:{...i.value,input:{...i.value.input,annotation:r}}}})))}}function T(e){const{clientStore:t,threadStore:r}=e,i=null==r?void 0:r.id;if(!i)return{steps:[],allReady:!1};const n=(null==r?void 0:r.getMessageStores())??[],a=n.map((e=>e.getStep())).filter(u().O9)??[],o=new Set(a.map((e=>e.id))),s=t.getOrCreateClientAIChatThreadStore(i).state.temporarySteps;return{steps:[...a.map((e=>s.find((t=>t.id===e.id))??e)),...s.filter((e=>!o.has(e.id)))].filter((e=>"title"!==e.type)),allReady:n.every((e=>e.isReady()))}}function w(e){const t=e.find(R);if(t)return t.value}function v(e){return e.find(A)}function C(e){return w(e?e.getTranscript():[])}function F(e,t){const r=t.findIndex((t=>t.id===e.id));if(-1!==r)return t.slice(0,r).findLast((e=>"user"===e.type))}function _(e){return"helpdocs"===e?"helpdoc":e}function $(e){return"helpdoc"===e?"helpdocs":"all"===e?"notion":e}function E(e){const{result:t,environment:r}=e,i={resultId:t.id,positionWithinSource:t.positionWithinSource,traceId:t.traceId};return"notion"===t.type?l().X$({...i,href:(0,p().J8)({store:new(m().B)(r,{table:"block",id:t.id}),fullyQualified:!1,pageVisitSource:n().y8.AIQna}),blockId:t.id,type:"block"}):"slack"===t.type?l().X$({...i,href:t.href,threadHref:t.href,type:"slack",domain:t.domain,baseUrl:t.baseUrl,channelId:t.channelId,messageId:t.messageId,threadTs:t.threadTs}):"google-drive"===t.type?l().X$({...i,href:t.href,type:"google-drive",messageId:t.id,url:t.url}):"github"===t.type?l().X$({...i,href:t.href,type:"github",messageId:t.id,url:t.url}):"jira"===t.type?l().X$({...i,href:t.href,type:"jira",messageId:t.id,url:t.url}):"webpage"===t.type?l().X$({...i,href:t.href,type:"webpage",url:(null==t?void 0:t.url)||""}):"helpdoc-section"===t.type?l().X$({...i,type:"helpdoc-section",href:t.href,url:t.url,parentPageHref:t.parentPageHref}):"helpdocs"===t.type?l().X$({...i,type:"helpdoc",href:t.href,url:t.url}):"gmail"===t.type?l().X$({type:"gmail",href:t.href,url:t.url,messageId:t.id}):"notion-mail"===t.type?l().X$({type:"notion-mail",href:t.href,url:t.url,messageId:t.id}):"google-calendar"===t.type?l().X$({type:"google-calendar",href:t.href,url:t.url,messageId:t.id}):"outlook"===t.type?l().X$({type:"outlook",href:t.href,url:t.url,messageId:t.id}):"linear"===t.type?l().X$({...i,type:"linear",href:t.href,url:t.url,messageId:t.url}):"sharepoint"===t.type?l().X$({...i,type:"sharepoint",href:t.href,url:t.url,messageId:t.url}):"microsoft-teams"===t.type?l().X$({...i,type:"microsoft-teams",href:t.href,url:t.url,messageId:t.url,channelId:t.channelId,threadTs:t.threadTs,threadHref:t.href,messageType:t.messageType}):void(0,u().HB)(t)}function K(e){const{results:t,spaceStore:r,environment:i,traceId:n}=e;return e=>{if(!r)return{annotations:[e],status:"missing_citation"};const o=t.flatMap(((e,t)=>((0,f().y$)(e.result,r)??[]).map((e=>({...e,position:t})))));return function(e){let{linkAnnotation:t,getRenderableSearchResultAndPositionById:r,environment:i}=e;const n=l().cQR(t);if(!n)return{annotations:[t],status:"other_link"};const o=n.indexOf("#citation:"),s=n.indexOf(a().N$);if(-1!==s){const e=r(decodeURIComponent(n.slice(s+a().N$.length)));if(!e)return{annotations:[t],status:"other_link"};const o=(0,f().OA)({result:e,environment:i});return{annotations:[(0,l().Sez)(o)],status:"other_link"}}if(-1!==o){const e=r(decodeURIComponent(n.slice(o+10)));return e?{annotations:[E({result:e,environment:i})],status:"citation"}:{annotations:[t],status:"missing_citation"}}return{annotations:[(0,l().Sez)(n)],status:"other_link"}}({linkAnnotation:e,getRenderableSearchResultAndPositionById:e=>{const t=o.find((t=>"notion"===t.type?decodeURIComponent(t.id)===e:decodeURIComponent(t.href)===e));if(t)return t?{...t,positionWithinSource:t.position,traceId:n}:void 0},environment:i})}}const M=/\[\]\((.*?)\)/g;function N(e){return e.replace(/\[([^\[\]]+?)\]\((.*?)\)/g,((e,t,r)=>`[${t}](${a().N$}${r})`)).replace(/\[\]\((.*?)\)/g,((e,t)=>`[citation](#citation:${t})`))}function B(e){let{clientStore:t,threadStore:r}=e;return Boolean(void 0!==(null==r?void 0:r.getCurrentInferenceId())||(null==r?void 0:r.id)&&t.getOrCreateClientAIChatThreadStore(r.id).state.loading)}function S(e){return"resultsBlended"===e.status||"resultsComplete"===e.status||"resultsPartial"===e.status||"generatingQuery"!==e.status&&"searching"!==e.status&&void(0,u().HB)(e)}function j(e){return"resultsComplete"===e.status||"resultsBlended"===e.status||"resultsPartial"!==e.status&&"generatingQuery"!==e.status&&"searching"!==e.status&&void(0,u().HB)(e)}function R(e){return"config"===e.type}function A(e){return"context"===e.type}function D(e){const{clientStore:t,threadStore:r}=e,i=C(r);return i||t.state.configForNewTranscripts}function O(e){if(e)try{const t=decodeURIComponent(e),r=JSON.parse(t);if(null==r||!r.type)return;if(!function(e){if(!e||!e.type)return!1;if("search"===e.type){return!(null!==k.validator(e))}return!1}(r))return;return r}catch{return}}function q(e){return!e||0===e.getMessages().length}function P(e){const{environment:t,transcript:r}=e,n=r.findLast(R);if(!n)return;if(!["workflow","mini-agent"].includes(n.value.type))return;const a=function(e){return(0,i().Uh)(e).filter((e=>"set"===e.command&&0===e.path.length)).map((e=>e.pointer))}(r),l=(0,c().L2)(t),d=function(e){const{newRecordPointers:t,environment:r,agentPreviewWrapper:i}=e;return t.filter((e=>e.table===o().ev)).map((e=>new(m().B)(r,e,{inMemoryRecordCache:i.getInMemoryRecordCacheIfIsPreviewingRecord(e,r.currentUser.id)}))).filter((e=>e.isNavigableBlock())).at(0)}({environment:t,newRecordPointers:a,agentPreviewWrapper:l});if(d){if(function(e){const{targetBlockStore:t}=e,r=g().default.state.mainEditorCurrentBlockStore;if(!r)return!1;if(!r.isCollectionView())return!1;const i=r.getCollectionStore();if(!i)return!1;const n=t.getParentStore();if(!n)return!1;return(0,y().Il)(i,n)}({targetBlockStore:d}))return;return(0,p().Ef)({environment:t,updates:{store:d}})}const u=function(e){const{newRecordPointers:t,environment:r,agentPreviewWrapper:i}=e,n=t.filter((e=>e.table===s().Gy));if(1===n.length)return new(h().pS)(r,n[0],{inMemoryRecordCache:i.getInMemoryRecordCacheIfIsPreviewingRecord(n[0],r.currentUser.id)})}({environment:t,newRecordPointers:a,agentPreviewWrapper:l});if(u){const e=u.getParentBlockStore();return(0,p().Ef)({environment:t,updates:{store:e,collectionViewId:u.id}})}}function U(e){var t;const{transcript:r}=e,i=r.findLast((e=>"context"===e.type));if(!i)return!1;return(i.value.collectionViewBlockId??i.value.blockId)!==(null===(t=g().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.id)}},832443:(e,t,r)=>{"use strict";r.d(t,{D4:()=>p,V6:()=>y,tD:()=>g});r(16280),r(944114),r(581454);var i=r.n(r(625473)),n=()=>r(496603),a=()=>r(973647),o=()=>r(534177),s=()=>r(939768),l=()=>r(242138),d=()=>r(902006),u=()=>r(181856);const c=/^\d+$/;function p(e){return!!c.test(e)}class y extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class g{generateSerializedKey(e){return i()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,r)=>a().Q.unwrap(this.mapCounterToKeyInMode(e,t,r)),this.mapCounterToKeyInMode=(e,t,r)=>g.mapCounterToKeyInMode(this,e,t,r),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:i,counter:n}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(i),n),this.counterToKeyMap.set(n,i),t.push(parseInt(n));const r=n().T9(t);this.counter="number"==typeof r?r+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((e=>{let[t,r]=e;return{key:n().mg(r),counter:t}}))}}inheritFrom(e){for(const[t,r]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,r);for(const[t,r]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,r)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const r=this.counter.toString();this.keyToCounterMap.set(t,r),this.counterToKeyMap.set(r,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},r=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=r;const i=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=i;const n=e.children.map((e=>{const r=this.mapNodeKeyToCounter(e);return r.parent=t,r}));t.children=n;const a={};for(const[e,l]of Object.entries(t.properties))a[e]=this.mapNodeKeyToCounter(l);t.properties=a;const o={};for(const[e,l]of Object.entries(t.schemas))o[e]=this.mapNodeKeyToCounter(l);t.schemas=o;const s=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=s,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},r=Object.fromEntries(Object.entries(t.properties).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));t.properties=r;const i=Object.fromEntries(Object.entries(t.schemas).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));return t.schemas=i,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("microsoftTeamsMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[i,n]of Object.entries(g.attributesToMap)){if(!n)continue;const e=t[i];if(e)if("href"===i){let n;const a=s().qg(e),o=s().Jf({str:a.href,allowNoProtocol:!0});o&&(n=r(919709).lXo({url:o,baseUrl:a.protocol?`${a.protocol}//${a.host}`:`https://${a.host??"www.notion.so"}`,publicDomainName:a.host??"www.notion.so"})),t[i]=n?this.mapKeyToCounter({type:"block",key:n}):e}else t[i]="person-id"===i?this.mapKeyToCounter({type:"person",key:e}):"database-id"===i?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new y(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":i,"current-background-page-id":n,...a}=e;return{...a,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":i,"current-background-page-id":n,...a}=e;return{...a,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:(0,d().V9)(e["current-thread-id"])})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,o().HB)(e)}static mapCounterToKeyInMode(e,t,r,i){if("block_counter"===r||"person_counter"===r||"thread_counter"===r||"collection_counter"===r||"collection_view_counter"===r||"query_database_result_counter"===r||"external_id_counter"===r||"attachment_id_counter"===r){const n=(0,a().j)((()=>e.mapCounterToKey(t)));if(a().Q.isFail(n))return n;const s=n.value;let l;return"block_counter"===r?l="block":"person_counter"===r?l="person":"thread_counter"===r?l="slack-thread":"collection_counter"===r?l="collection":"collection_view_counter"===r?l="collection-view":"query_database_result_counter"===r?l="query-database-result":"external_id_counter"===r?l="universal":"attachment_id_counter"===r?l="attachment":(0,o().HB)(r),s.type!==l?{error:new(u().xU)({receivedIdType:s.type,expectedIdType:l,tagNameForErrorMessage:i,idValueForErrorMessage:t})}:{value:s.key}}if("href_counter"===r){const r=g.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===r?{error:new(u().xU)({receivedIdType:r,expectedIdType:"href",tagNameForErrorMessage:i,idValueForErrorMessage:t})}:{value:g.mapHrefCounterToUrl(e,t)}}(0,o().HB)(r)}getTypeKeyFromCounter(e){return g.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let r;try{r=t.mapCounterToKey(e)}catch(i){if(i instanceof y)return;throw i}return r.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static mapHrefCounterToUrl(e,t){let r;try{r=e.mapCounterToKey(t)}catch(i){if(i instanceof y)return t;throw i}if("block"===r.type)return g.blockKeyToHref(r);if("url"===r.type||"slack-message"===r.type||"slack-thread"===r.type||"webpage"===r.type||"helpdoc"===r.type||"helpdoc-section"===r.type||"microsoft-teams-message"===r.type||"microsoft-teams-thread"===r.type||(0,d().SC)(r.type))return r.key;if("collection"===r.type||"collection-view"===r.type||"person"===r.type)return d().Py;if("query-database-result"===r.type||"skill"===r.type)throw new Error(`Invalid URL type: ${r.type}`);return"universal"===r.type||"attachment"===r.type?r.key:void(0,o().HB)(r.type)}removeKey(e){const t=this.generateSerializedKey(e),r=this.keyToCounterMap.get(t);if(r)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(r),r}setCounterValueForKey(e,t){const r=this.generateSerializedKey(e);this.keyToCounterMap.set(r,t),this.counterToKeyMap.set(t,e)}}g.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},g.parseAssistantHref=l().f9,g.databaseQueryHrefToDatabaseQueryResultsId=l().uP,g.blockHrefToAssistantBlockId=l().Gp},915189:(e,t,r)=>{"use strict";r.d(t,{OA:()=>x,SF:()=>f,y$:()=>m});r(16280),r(898992),r(354520),r(672577),r(581454),r(814603),r(147566),r(198721);var i=r.n(r(755373)),n=()=>r(902006),a=()=>r(241178),o=()=>r(584262),s=()=>r(832443),l=()=>r(172385),d=()=>r(179034),u=()=>r(245241),c=()=>r(496603),p=()=>r(534177),y=()=>r(492414),g=()=>r(630116);function h(e){return"notion"!==e.type||"page"===e.citationLevel}function m(e,t){if("block"===e.type||"properties"===e.type)return;if("page"===e.type){var r;const i=(null===(r=e.blocks)||void 0===r?void 0:r.map((r=>({type:"notion",citationLevel:"block",store:g().Bv.createChildStore(t,{table:d().ev,id:r.id,spaceId:t.id}),id:r.id,pageId:e.pageId??e.id,title:e.title,path:e.path,text:r.text,lastEdited:e.lastEdited,badges:void 0,highlight:void 0}))))??[];return[{type:"notion",citationLevel:e.type,store:g().Bv.createChildStore(t,{table:d().ev,id:e.id,spaceId:t.id}),id:e.id,pageId:e.pageId??e.id,title:e.title,path:e.path,text:e.text,lastEdited:e.lastEdited,badges:e.badges,highlight:e.highlight},...i]}const n=s().tD.parseAssistantHref(e.id);if(n){if("slack"===e.type){if("slack"!==n.type)throw new Error(`Expected Slack result, but got ${n.type}`);const t=`slack://?${i().stringify({base_url:n.baseUrl,channel_id:n.channelId,message_id:n.messageId,thread_ts:n.threadTs})}`,{user:r,text:a}=b(e);return[{id:e.pageId,type:"slack",href:t,threadHref:t,title:e.title,text:a,user:r,lastEdited:e.lastEdited,domain:n.domain,baseUrl:n.baseUrl,channelId:n.channelId,messageId:n.messageId,threadTs:n.threadTs,threadMessages:e.messages.map((e=>e.messageId)),highlight:{...e.highlight,text:a}}]}if("helpdoc"===e.type){if("helpdoc"!==n.type)throw new Error(`Expected helpdocs result, but got ${n.type}`);return[{type:"helpdocs",href:e.id,id:e.id,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url}]}if("helpdoc-section"===e.type){if("helpdoc-section"!==n.type)throw new Error(`Expected helpdoc-section result, but got ${n.type}`);return[{type:"helpdoc-section",href:e.id,id:e.id,parentPageHref:n.parentPageHref,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url}]}if("google-drive"===e.type){if("google-drive"!==n.type)throw new Error(`Expected google-drive result, but got ${n.type}`);return[{type:"google-drive",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,fileType:e.fileType,url:n.url,highlight:e.highlight}]}if("webpage"===e.type){if("webpage"!==n.type)throw new Error(`Expected webpage result, but got ${n.type}`);return[{type:"webpage",href:e.id,id:e.id,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url,domain:new URL(n.url).origin}]}if("github"===e.type){if("github"!==n.type)throw new Error(`Expected github result, but got ${n.type}`);return[{type:"github",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,authorName:e.authorName,statusTag:e.statusTag,githubRepoName:e.githubRepoName,fileType:e.fileType,url:n.url,highlight:e.highlight}]}if("jira"===e.type){if("jira"!==n.type)throw new Error(`Expected jira result, but got ${n.type}`);return[{type:"jira",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url,highlight:e.highlight}]}if("gmail"===e.type){if("gmail"!==n.type)throw new Error(`Expected gmail result, but got ${n.type}`);return[{type:"gmail",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,emailAddress:e.emailAddress,url:n.url}]}if("notion-mail"===e.type){if("notion-mail"!==n.type)throw new Error(`Expected notion-mail result, but got ${n.type}`);return[{type:"notion-mail",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,emailAddress:e.emailAddress,url:n.url}]}if("google-calendar"===e.type){if("google-calendar"!==n.type)throw new Error(`Expected google-calendar result, but got ${n.type}`);return[{type:"google-calendar",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,emailAddress:e.emailAddress,url:n.url}]}if("outlook"===e.type){if("outlook"!==n.type)throw new Error(`Expected outlook result, but got ${n.type}`);return[{type:"outlook",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,emailAddress:e.emailAddress,url:n.url}]}if("linear"===e.type){if("linear"!==n.type)throw new Error(`Expected linear result, but got ${n.type}`);return[{type:"linear",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url,highlight:e.highlight}]}if("sharepoint"===e.type){if("sharepoint"!==n.type)throw new Error(`Expected sharepoint result, but got ${n.type}`);return[{type:"sharepoint",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,url:n.url,highlight:e.highlight}]}if("microsoft-teams"===e.type){var a;if("microsoft-teams"!==n.type)throw new Error(`Expected microsoft-teams result, but got ${n.type}`);const{user:t,text:r}=b(e);return[{type:"microsoft-teams",href:e.id,id:e.pageId,title:e.title,text:e.text,user:t,lastEdited:e.lastEdited,messageId:n.messageId,url:n.url,channelId:n.channelId,threadHref:n.href,threadMessages:null===(a=e.messages)||void 0===a?void 0:a.map((e=>e.messageId)),threadTs:n.threadTs,messageType:n.messageType,highlight:{...e.highlight,text:r}}]}}}function f(e,t){const r=m(e,t);return r?r.filter(h):[]}function b(e){let t,r=e.text;if("slack"===e.type){var i;null!==(i=e.highlight)&&void 0!==i&&i.text&&(r=e.highlight.text);const n=e.messages.find((t=>t.messageId===e.id));t=null==n?void 0:n.user;const a=c().sb(e.messages.map((e=>e.user))),o=": ";if(r.includes(o)){const[e,...i]=r.split(o);if(e){const n=e.replace(new RegExp(`${u().$8}(.*?)${u()._x}`,"g"),"$1");if(0===a.length)r=i.join(o);else{const e=a.findIndex((e=>e===n));-1!==e&&(t=a[e],r=i.join(o))}}}}return{user:t??"",text:r}}function x(e){const{result:t,environment:r}=e;if("notion"===t.type){const e=r.RouterStore.state.route;return"chat"===e.name?(0,l().EY)({isMobile:r.device.isMobile,currentRoute:e,pageId:t.store.id,pageVisitSource:o().y8.AIQna}):(0,y().Ay)({store:t.store,fullyQualified:!1,pageVisitSource:o().y8.AIQna})}return"slack"===t.type?(0,a().mQ)({...t}):"helpdocs"===t.type||"helpdoc-section"===t.type||"webpage"===t.type||(0,n().SC)(t.type)?t.url:void(0,p().HB)(t.type)}}}]);