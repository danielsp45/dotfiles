"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[9150,46283,46990,84358],{59400:(e,t,n)=>{n.d(t,{nR:()=>c,m$:()=>s,m4:()=>l,Dy:()=>d,FZ:()=>p});n(296540);var r=()=>n(645873),a=n(474848);function o(e){const{shouldShowSpinner:t,collectionSettingsProps:r}=e;return(0,a.jsx)(n(735695).Ay,{collectionSettingsStore:r.collectionSettingsStore,fullHeight:r.fullHeight,hideDesktopHeader:r.hideDesktopHeader,children:t&&(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",overflow:"hidden",paddingBottom:20},children:(0,a.jsx)(n(331542).A,{})})})}const i=new(r().O2)("collectionSettings",(()=>Promise.all([n.e(75134),n.e(16471),n.e(58550),n.e(44711),n.e(53321),n.e(90825),n.e(96346),n.e(55373),n.e(37353),n.e(29151),n.e(78191),n.e(62475),n.e(3151),n.e(98629),n.e(92845),n.e(84468),n.e(5605),n.e(48486),n.e(95794),n.e(13677),n.e(56952),n.e(48632),n.e(75078),n.e(25497),n.e(74562),n.e(27711),n.e(4422),n.e(11341),n.e(46414),n.e(95168),n.e(28271),n.e(34877),n.e(36908),n.e(17254),n.e(84185),n.e(32421),n.e(15315),n.e(24587),n.e(78708),n.e(43777),n.e(74752),n.e(91194),n.e(81197),n.e(98659),n.e(20502),n.e(6266),n.e(8184),n.e(83884),n.e(65881),n.e(99809),n.e(93282),n.e(43678),n.e(15019),n.e(90978),n.e(3910),n.e(77213),n.e(6912),n.e(30291),n.e(19930),n.e(58102),n.e(26483),n.e(6463),n.e(40925),n.e(282),n.e(61349),n.e(62573),n.e(1440),n.e(63996),n.e(66559),n.e(35986),n.e(92924),n.e(64819),n.e(97339),n.e(55717),n.e(63797),n.e(21367),n.e(22686),n.e(99108)]).then(n.bind(n,409198)))),s=(0,r()._h)(i,(e=>e.CollectionSettings),{renderLoading:(e,t)=>(0,a.jsx)(o,{shouldShowSpinner:e,collectionSettingsProps:t})}),l=(0,r()._h)(i,(e=>e.CollectionSettingsButtonOptions)),d=(0,r()._h)(i,(e=>e.CollectionSettingsPropertyTypeMenuItem)),c=(0,r()._h)(i,(e=>e.CollectionEditButtonAutomationOption)),u=new(r().O2)("TableHeaderPropertyCreationMenu",(()=>Promise.all([n.e(75134),n.e(16471),n.e(58550),n.e(44711),n.e(53321),n.e(90825),n.e(96346),n.e(55373),n.e(37353),n.e(29151),n.e(78191),n.e(92845),n.e(84468),n.e(5605),n.e(48486),n.e(95794),n.e(13677),n.e(56952),n.e(48632),n.e(75078),n.e(25497),n.e(74562),n.e(27711),n.e(4422),n.e(11341),n.e(46414),n.e(95168),n.e(28271),n.e(34877),n.e(36908),n.e(17254),n.e(84185),n.e(32421),n.e(15315),n.e(24587),n.e(78708),n.e(43777),n.e(74752),n.e(91194),n.e(81197),n.e(98659),n.e(20502),n.e(6266),n.e(8184),n.e(83884),n.e(65881),n.e(99809),n.e(93282),n.e(43678),n.e(15019),n.e(90978),n.e(3910),n.e(77213),n.e(61349),n.e(35986),n.e(43935)]).then(n.bind(n,908800)))),p=(0,r()._h)(u,(e=>e.TableHeaderPropertyCreationMenu))},63467:(e,t,n)=>{n.d(t,{y:()=>c});var r=()=>n(637997),a=()=>n(267419);const o={ko:()=>n.e(2268).then(n.bind(n,224434)),es:()=>n.e(95264).then(n.bind(n,196425)),de:()=>n.e(35390).then(n.bind(n,653703)),fr:()=>n.e(3272).then(n.bind(n,94677)),pt:()=>n.e(27315).then(n.bind(n,766869)),zh:()=>n.e(69945).then(n.bind(n,516814)),ja:()=>n.e(77757).then(n.bind(n,824432)),da:()=>n.e(9423).then(n.bind(n,440761)),fi:()=>n.e(59337).then(n.bind(n,462135)),nb:()=>n.e(2040).then(n.bind(n,937314)),nl:()=>n.e(51106).then(n.bind(n,530897)),sv:()=>n.e(53631).then(n.bind(n,895222)),id:()=>n.e(69945).then(n.bind(n,516814)),th:()=>n.e(69945).then(n.bind(n,516814)),vi:()=>n.e(69945).then(n.bind(n,516814))};let i=!1,s=!1;async function l(e){for(const[n,a]of Object.entries(e.emojiLocaleKeywords)){var t;r().fB[n]={...r().fB[n],keywords:[...a,...(null===(t=r().fB[n])||void 0===t?void 0:t.keywords)||[]]}}await a().A.waitUntilLoaded(),a().A.update((t=>{let{emojiByName:n,...r}=t;return{...r,emojiByName:{...n,...e.emojiByName}}}))}async function d(){if(i)return;const[e]=n(662303).locale.split("-");e in o&&(await l(await o[e]()),i=!0)}const c=(0,n(279900).A)((async()=>{await async function(){s||(await l(await n.e(51872).then(n.bind(n,443716))),s=!0)}(),await d()}))},89849:(e,t,n)=>{n.r(t),n.d(t,{eyeIcon:()=>o,iconDefinition:()=>a});n(296540);var r=n(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"0.96 4.19 18.07 11.62",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.135 3.303l-.005.17a3.305 3.305 0 0 1-3.3 3.137l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17A3.307 3.307 0 0 1 10 6.69zm-.17 2.2a1.104 1.104 0 0 0 0 2.207 1.103 1.103 0 0 0 0-2.207"}),(0,r.jsx)("path",{d:"M10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.163c.126.333.126.7 0 1.033l-.073.163c-1.602 3.052-4.984 5.126-8.862 5.126-3.757 0-7.049-1.946-8.707-4.843l-.156-.283a1.46 1.46 0 0 1 0-1.359l.156-.283C2.95 6.141 6.243 4.194 10 4.194m0 1.251c-3.33 0-6.196 1.724-7.622 4.214l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214 3.437 0 6.38-1.837 7.756-4.457l.018-.048a.2.2 0 0 0 0-.1l-.018-.049C16.38 7.282 13.437 5.445 10 5.445"})]})},o=(0,n(340498).wt)("eye",a)},94701:(e,t,n)=>{n.r(t),n.d(t,{checkmarkFillIcon:()=>a,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.66 3.66 12.68 12.68",svg:(0,n(474848).jsx)("path",{d:"M15.913 3.787a.875.875 0 0 1 .3 1.2L9.658 15.914a.875.875 0 0 1-1.415.119l-4.37-5.098a.875.875 0 0 1 1.329-1.14l3.58 4.177 5.93-9.884a.875.875 0 0 1 1.2-.3"})},a=(0,n(340498).wt)("checkmarkFill",r)},124749:(e,t,n)=>{n.d(t,{$:()=>o});var r=()=>n(56366);const a=new(n(496506).ComputedStore)((()=>n(765957).default.state.currentUserStore),{debugName:"AppStoreCurrentUserStore"});function o(){return(0,r().O$)(a)}},132389:(e,t,n)=>{n.d(t,{A:()=>a});n(296540);var r=n(474848);function a(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,r.jsx)("div",{style:t})}},139274:(e,t,n)=>{n.r(t),n.d(t,{arrowUTurnUpLeftFillSmallIcon:()=>a,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"1.45 2.74 13.1 10.21",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M6.25 4.01a.75.75 0 0 0-1.06-1.06L1.67 6.47a.75.75 0 0 0 0 1.06l3.52 3.52a.75.75 0 1 0 1.06-1.06L4.01 7.75h7.19a1.85 1.85 0 1 1 0 3.7h-1.136a.75.75 0 1 0 0 1.5H11.2a3.35 3.35 0 0 0 0-6.7H4.01z"})},a=(0,n(340498).wt)("arrowUTurnUpLeftFillSmall",r)},155382:(e,t,n)=>{n.d(t,{PA:()=>h,WM:()=>m,Zh:()=>g,ji:()=>x,vW:()=>v,yX:()=>f});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var r=()=>n(56366),a=()=>n(365646),o=()=>n(939689),i=()=>n(179034),s=()=>n(519831),l=()=>n(155792),d=()=>n(496603),c=()=>n(534177),u=()=>n(58293),p=()=>n(630116);function g(){return{verticalPadding:4,horizontalPadding:8}}function f(e){const t=[];for(const n of e){const e=m(n.toolType),r=h(n);if(e)for(const n of r)n.table===i().ev&&t.push({recordPointer:n,agentAction:e})}return t}function h(e){if(!e||!e.result)return[];const{result:t}=e;if("appId"in t&&"string"==typeof t.appId)return[{table:i().ev,id:t.appId}];if("pageId"in t&&"string"==typeof t.pageId)return[{table:i().ev,id:t.pageId}];if("collectionViewBlockId"in t&&"string"==typeof t.collectionViewBlockId)return[{table:i().ev,id:t.collectionViewBlockId}];if("pageIds"in t&&Array.isArray(t.pageIds))return t.pageIds.map((e=>({table:i().ev,id:e})));if("workflowBlockId"in t&&"string"==typeof t.workflowBlockId)return[{table:i().ev,id:t.workflowBlockId}];if("entities"in t){return function(e){const t=[];for(const n of e){const e=(0,o().dw)(n);e&&t.push(e)}return d().hS(t,(e=>`${e.table}-${e.id}`))}(t.entities)}return(0,a().gY)(e,"query-data-sources")&&e.result.collectionIds?e.result.collectionIds.map((e=>({id:e,table:s().Vl}))):[]}function m(e){switch(e){case"create-database":case"create-pages":case"create-agent":return"create";case"update-database":case"update-database-data-sources":case"update-database-views":case"update-database-triggers":case"update-page":case"update-user-integrations":case"toggle-user-integration-tools":case"update-agent":return"update";case"delete-pages":case"delete-agent":return"delete";case"search":case"view":case"view-database-files":case"query-data-sources":case"error":case"result":case"edit-json":case"spawn-agent":case"mcpServer.runTool":case"slack.addReactionToMessage":case"slack.createThreadInChannel":case"slack.createThreadInDirectMessage":case"slack.findUserByEmail":case"slack.getSlackUrlFromMessageId":case"slack.getThreadsInChannelSince":case"slack.getUser":case"slack.parseSlackMessageUrlToId":case"slack.queryChannels":case"slack.removeReactionFromMessage":case"slack.replyInThread":case"slack.updateMessage":case"pipedream.action":case"github.getPullRequest":case"github.getUser":case"github.listPullRequests":case"github.listOrganizationRepositories":case"github.parseGithubUrlToParts":case"notion.sendNotification":case"codegen.run":case"codegen.runStatus":case"calendar.getEvents":case"files.getFileContent":case"files.getFileName":case"files.getFileUrl":case"zendesk.addComment":case"zendesk.addTicket":case"zendesk.getComments":case"zendesk.getTicket":case"zendesk.updateTicket":return;default:(0,c().HB)(e)}}function v(e){return"create-database"===e||"create-pages"===e||"create-agent"===e||"update-page"===e||"update-database"===e||"delete-pages"===e||"spawn-agent"===e}function x(e){let{diffResultSteps:t,threadStore:n}=e;const a=(0,u().r)(),{threadOperationStores:o,threadOperationStoreToResultStepMap:i}=(0,r().K8)((()=>{const e=[],r=new Map;if(!a)return{threadOperationStores:e,threadOperationStoreToResultStepMap:r};for(const o of t){if(!o)continue;const t=p().XV.createChildStore(n,{table:l().mS,id:o.id,spaceId:a.id});for(const n of t.getThreadOperationStores())e.push(n),r.set(n,o)}return{threadOperationStores:e,threadOperationStoreToResultStepMap:r}}),[t,a,n]);return(0,r().K8)((()=>{const e=[],t=new Set;let n=!1;for(const r of o){const a=r.getKeyValue("userAction"),o=r.getKeyValue("invertedOperations")??[];if("undo"===a&&(n=!0),"reject"!==a){e.push(...o);const n=i.get(r);n&&t.add(n)}}return{operationsToUndo:e,hasUndoneOperations:n,stepsWithOperationsToUndo:t}}),[o,i])}},160992:(e,t,n)=>{n.d(t,{K:()=>l});n(581454);var r=()=>n(484714),a=()=>n(56366),o=()=>n(186445),i=()=>n(765957),s=()=>n(174674);function l(){const e=(0,r().v3)(),t=(0,a().O$)(i().default),n=(0,a().K8)((()=>(0,o()._m)(e)),[e]);return(0,a().K8)((()=>{var e;if(!n)return[];const r=(null===(e=t.currentSpaceViewStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.agent_chat_modules)??[];return 0===r.length?[]:r.map((e=>({defaultEnabled:e.defaultEnabled,workflowModuleStore:s().P.createChildStore(n,e.pointer)})))}),[t.currentSpaceViewStore,n])}},162010:(e,t,n)=>{n.d(t,{C:()=>l});n(296540);var r=()=>n(401497),a=()=>n(962730),o=()=>n(859428),i=n(474848);const s=2;function l(e){const{percentage:t,ringWidth:n,size:l,style:d,label:c}=e,u=(0,r().DP)(),p=n??3,g=l/2-p/2,f=2*Math.PI*g,h=l/2,m=e.filledColor??u.palette.gray[500],v=e.unfilledColor??u.palette.gray[100],x=e.gapColor??"transparent",y=Math.min(Math.max(t,0),100),S=y>s&&y+2*s<95&&(0,i.jsx)("circle",{r:g,cx:h,cy:h,strokeWidth:p,stroke:x,strokeLinecap:"round",strokeDasharray:`${f} ${f*(100-(y+2*s))/100}`,strokeDashoffset:""+f*(100-(y+s))/100,fill:"transparent"}),b=e=>(0,i.jsx)("div",{role:"progressbar","aria-valuenow":y,style:{height:l,width:l,...d,pointerEvents:"auto"},...e,children:(0,i.jsxs)("svg",{viewBox:`0 0 ${l} ${l}`,color:"transparent",style:{width:"100%",height:"100%",transform:"rotate(-90deg)",transformOrigin:"50% 50%"},children:[(0,i.jsx)("circle",{r:g,cx:h,cy:h,strokeWidth:p,stroke:v,strokeLinecap:"round",fill:"transparent"}),S,(0,i.jsx)("circle",{r:g,cx:h,cy:h,strokeWidth:p,stroke:m,strokeLinecap:"round",strokeDasharray:f,strokeDashoffset:f-y/100*f,fill:"transparent"}),(0,i.jsx)("text",{x:h,y:h,textAnchor:"middle",dominantBaseline:"middle",fill:u.text.secondary,fontSize:"0.75em",style:{transformOrigin:"50% 50%",transform:"rotate(90deg)"},children:c})]})});return e.tooltip?(0,i.jsx)(o().A,{placement:a().W.Top,renderTooltip:()=>e.tooltip,render:b}):b()}},167170:(e,t,n)=>{n.d(t,{_:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.29 3.29 13.41 13.41",svg:(0,n(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},a=(0,n(340498).wt)("layout",r)},222334:(e,t,n)=>{n.r(t),n.d(t,{arrowChevronSingleRightIcon:()=>a,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"7.22 3.97 6.66 12.06",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M13.692 10.442a.625.625 0 0 0 0-.884l-5.4-5.4a.625.625 0 1 0-.884.884L12.366 10l-4.958 4.958a.625.625 0 0 0 .884.884z"})},a=(0,n(340498).wt)("arrowChevronSingleRight",r)},271084:(e,t,n)=>{n.d(t,{k:()=>a});n(581454);class r extends(()=>n(757695))().Store{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort(((e,t)=>{let[n,r]=e,[a,o]=t;return o-r})).map((e=>{let[t,n]=e;return t}))}}const a=new r;(0,n(604341).exposeDebugValue)("UserSimilarityStore",a)},279900:(e,t,n)=>{function r(e){let t,n,r;return async function(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return t?(r=o,n||(n=t.then((()=>(n=void 0,t=e(...r),t))),n)):(t=e(...o),t)}}n.d(t,{A:()=>r})},458366:(e,t,n)=>{n.d(t,{B2:()=>T,F1:()=>k,Kc:()=>I,NN:()=>M,UY:()=>b,br:()=>A,lA:()=>w,lh:()=>C,pi:()=>x,w_:()=>S,zP:()=>y});n(898992),n(737550);var r=()=>n(584262),a=()=>n(443239),o=()=>n(970013),i=()=>n(713998),s=()=>n(882262),l=()=>n(415566),d=()=>n(177256),c=()=>n(72135),u=()=>n(919709),p=()=>n(496603),g=()=>n(534177),f=()=>n(939768),h=()=>n(720665),m=()=>n(492414),v=()=>n(972435);function x(e){return Boolean(e.state.isOpen&&e.state.collectionsBulkActionsToolbarStore)}function y(e){switch(e){case"table":return"table";case"board":return"board";case"list":return"list";case"gallery":return"gallery";case"feed":return"feed";case"relation":case"relation_section":return"relation_section";case"timeline":return"timeline";case"calendar":return"calendar";case"page":return"page_properties";case"compact_page":return"compact_page";case"mini":return"mini_peek";case"form_editor":case"form_viewer":case"property_module":return"property_module";default:(0,g().HB)(e)}}function S(e){return{backgroundImage:`linear-gradient(\n\t\tto right,\n\t\t${e.darkDividerColor} 0%,\n\t\t${e.darkDividerColor} 100%\n\t)`,backgroundRepeat:"repeat-x",backgroundPosition:"0 100%",backgroundSize:"100% 1px"}}function b(e){const{store:t,property:n,propertySchema:a}=e,o=null==a?void 0:a.type;if("title"===o)return(0,m().Ay)({store:t,fullyQualified:!1,pageVisitSource:r().y8.LinkInPage});{const e=t.getPropertyValue(n);return i().UY(o,e)}}function I(e){let t=(0,u().k4p)(e);if(!t||""===t.trim()||t.trim().includes(" "))return{domain:void 0,restOfUrl:void 0};t=t.trim();let n=f().qg(t),r=n.host;if(n.protocol&&r||(n=f().qg(`http://${t}`),r=n.host),!r)return{domain:void 0,restOfUrl:void 0};r&&(r=r.replace(/^www./i,""));const a=t.toLowerCase().indexOf(r.toLowerCase());if(-1===a)return{domain:void 0,restOfUrl:void 0};r=t.slice(a,a+r.length);return{domain:r,restOfUrl:t.slice(a+r.length)}}function C(e){const{numberValue:t,numberFormat:n,numberShowAs:r}=e;if(!(p().yr(t)||h().pN(t)||"bar"!==(null==r?void 0:r.type)&&"ring"!==(null==r?void 0:r.type))){const e=v().A.getIntl();return"percent"===n?c().ZV(t,"percent",e):`${t} / ${r.maxValue}`}}function k(e){const{property:t,collectionStore:n}=e,r=n.isSyncedCollection();return Boolean(r)&&(0,a().u)(t)}function w(e,t){switch(e){case"side_peek":return{icon:d().A,tooltip:v().A.formatMessage(j.openInSidePeekTooltip),caption:t?"":v().A.formatMessage(j.openAsPageTitle)};case"center_peek":return{icon:l().q,tooltip:v().A.formatMessage(j.openInCenterPeekTooltip),caption:t?"":v().A.formatMessage(j.openAsPageTitle)};case"full_page":return{icon:s().m,tooltip:v().A.formatMessage(j.openAsPageTooltip),caption:t?"":v().A.formatMessage(j.openAsPageTitle)};default:(0,g().HB)(e)}}const j=(0,n(959013).YK)({openAsPageTitle:{defaultMessage:"Open",id:"database.actionButton.openAsPageTitle"},openAsPageTooltip:{defaultMessage:"Open as page",id:"database.actionButton.openAsPageTooltip"},openInCenterPeekTooltip:{defaultMessage:"Open in center peek",id:"database.actionButton.openInCenterPeekTooltip"},openInSidePeekTooltip:{defaultMessage:"Open in side peek",id:"database.actionButton.openInSidePeekTooltip"}});function A(e){const{store:t,additionalStores:n,collectionContextStore:r}=e,a=t.getAssociatedCollectionStore();return!("collectionTypedView"!==(null==r?void 0:r.contextType)||!a)&&n.some((e=>{var t;return(null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.id)!==a.id}))}function M(e){return"form_editor"===e||"form_viewer"===e}function T(e){return Boolean(e&&!o().dA.includes(e.type))}},471095:(e,t,n)=>{n.d(t,{i:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.95 12.05 15.66",svg:(0,n(474848).jsx)("path",{d:"M6 5.95a4 4 0 1 1 8 0v1.433a2.426 2.426 0 0 1 2.025 2.392v5.4A2.425 2.425 0 0 1 13.6 17.6H6.4a2.425 2.425 0 0 1-2.425-2.425v-5.4c0-1.203.876-2.201 2.025-2.392zm6.75 1.4v-1.4a2.75 2.75 0 1 0-5.5 0v1.4zm-2.2 5.458a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 0 0 1.1 0z"})},a=(0,n(340498).wt)("lockFill",r)},477293:(e,t,n)=>{n.d(t,{r:()=>o});var r=()=>n(56366),a=()=>n(217429);function o(e){let{disableExposureLogging:t,disableEventTrailLogging:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r().K8)((()=>a().default.getEligibleGroup({experimentId:e,defaultGroup:"control",disableExposureLogging:t,disableEventTrailLogging:n})),[e,t,n])}},557336:(e,t,n)=>{n.d(t,{q:()=>f});n(944114);var r=n(296540),a=()=>n(17022),o=()=>n(484714),i=()=>n(56366),s=()=>n(751156),l=()=>n(356983),d=()=>n(965454),c=()=>n(124749),u=()=>n(765957),p=()=>n(390898),g=()=>n(915619);function f(e){const t=(0,i().O$)(u().AppStoreCurrentSpaceStore),n=(0,c().$)(),f=(0,i().O$)(u().AppStoreCurrentSpaceViewStore),h=(0,o().v3)(),{threadStore:m,clientAiChatStore:v,setThreadStore:x,aiChatFeatureController:y,config:S}=e,b=(0,r.useCallback)((e=>{x(e),a().e.withListenerIgnored((()=>{v.getOrCreateClientAIChatThreadStore(e.id)}))}),[v,x]),I=(0,i().K8)((()=>{const e=S??v.state.configForNewTranscripts;return y.shouldSupportAttachments(e.type)}),[y,v,S]),C=Boolean(m),k=(0,i().K8)((()=>{var e;return null==m||null===(e=m.getSpaceStore())||void 0===e?void 0:e.id}),[m]),w=(0,r.useMemo)((()=>{if(t&&n&&f&&I&&(!C||k&&t.id!==k)){const e=s().createAndCommit({userAction:"AIChatInput.useUploadAttachments",environment:h,canUndo:!1,perform:e=>(0,p().aP)({environment:h,spaceStore:t,userStore:n,transaction:e})}).performResult;return b(e),e}}),[C,h,b,I,t,f,n,k]),j=m??w,A=(0,i().K8)((()=>{if(j)return v.getOrCreateClientAIChatThreadStore(null==j?void 0:j.id)}),[v,j]),M=(0,l().z)({threadClientStore:A,aiChatFeatureController:y,config:S,clientChatStore:v}),{onPasteFiles:T,uploadAttachment:R,onDropFiles:B}=(0,g().PF)({threadStore:j,spaceStore:t,config:S,clientAiChatStore:v,aiChatFeatureController:y}),D=(0,r.useCallback)((async()=>{const e=d()._.persistTemporaryThreadStoreIfExists();e&&(await e.commitResult,x(e.threadStore)),await R({file:void 0,method:"clicked_attachment_button"})}),[x,R]),O=(0,r.useCallback)((e=>{const t=d()._.persistTemporaryThreadStoreIfExists(e.transaction);t&&x(t.threadStore),e.transaction.postSubmitCallbacks.push((()=>{T(e)}))}),[T,x]),U=(0,r.useCallback)((async e=>{const t=d()._.persistTemporaryThreadStoreIfExists();t&&(await t.commitResult,x(t.threadStore)),await B(e)}),[x,B]);if(t&&n&&f&&I&&M&&j)return{onPasteFiles:O,uploadFile:D,onDropFiles:U,threadStore:j,spaceStore:t,userStore:n,spaceViewStore:f}}},607194:(e,t,n)=>{n.r(t),n.d(t,{AgentChatView:()=>hr,ToolUseConfirmationContext:()=>kr,useToolUseConfirmation:()=>wr});n(16280),n(410838),n(944114),n(898992),n(354520),n(672577),n(581454);var r=n(296540),a=()=>n(484714),o=()=>n(56366),i=()=>n(401497),s=()=>n(878456),l=()=>n(584262),d=()=>n(626466),c=()=>n(340498),u=n(474848);const p={viewBox:"0 0 16 16",fittedViewBox:"2.74 1.45 10.21 12.3",directional:!0,svg:(0,u.jsx)("path",{d:"M12.2 12.25a.75.75 0 0 1 0 1.5h-4a1.95 1.95 0 0 1-1.95-1.95V4.01L4.01 6.25a.75.75 0 0 1-1.06-1.06l3.52-3.52a.75.75 0 0 1 1.06 0l3.52 3.52a.75.75 0 1 1-1.06 1.06L7.75 4.01v7.79c0 .248.201.45.45.45z"})},g=(0,c().wt)("arrowTurnLeftUpFillSmall",p);var f=()=>n(952816),h=()=>n(996624),m=()=>n(689094);const v={viewBox:"0 0 16 16",fittedViewBox:"2.65 0.29 10.7 13.26",svg:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("path",{d:"M8.37.461a.55.55 0 0 0-.779 0l-2 2a.55.55 0 0 0 .778.778l1.081-1.08V8.8a.55.55 0 0 0 1.1 0V2.198l1.041 1.041a.55.55 0 0 0 .778-.778z"}),(0,u.jsx)("path",{d:"M6.4 4.05h-2A1.75 1.75 0 0 0 2.65 5.8v6c0 .966.783 1.75 1.75 1.75h7.2a1.75 1.75 0 0 0 1.75-1.75v-6a1.75 1.75 0 0 0-1.75-1.75h-2V8.8a1.6 1.6 0 0 1-3.2 0z"})]})},x=((0,c().wt)("squareAndArrowUpFillSmall",v),{viewBox:"0 0 16 16",fittedViewBox:"2.57 0.22 10.86 13.41",svg:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("path",{d:"M8.422.408a.625.625 0 0 0-.884 0l-2 2a.625.625 0 1 0 .884.884l.953-.953V8.8a.625.625 0 1 0 1.25 0V2.379l.913.913a.625.625 0 0 0 .884-.884z"}),(0,u.jsx)("path",{d:"M4.4 3.975A1.825 1.825 0 0 0 2.575 5.8v6c0 1.008.817 1.825 1.825 1.825h7.2a1.825 1.825 0 0 0 1.825-1.825v-6A1.825 1.825 0 0 0 11.6 3.975H9.525v1.25H11.6c.318 0 .575.257.575.575v6a.575.575 0 0 1-.575.575H4.4a.575.575 0 0 1-.575-.575v-6c0-.318.257-.575.575-.575h2.075v-1.25z"})]})});(0,c().wt)("squareAndArrowUpSmall",x);var y=()=>n(388821),S=()=>n(696706),b=()=>n(234459),I=()=>n(798880),C=()=>n(919709),k=()=>n(959013),w=()=>n(496603),j=()=>n(277942),A=()=>n(857783),M=()=>n(751156),T=()=>n(965454),R=()=>n(410930),B=()=>n(84817),D=()=>n(285790),O=()=>n(859428),U=()=>n(518598),P=()=>n(780054),F=()=>n(581495),E=()=>n(200562),L=()=>n(38337),$=()=>n(847743),z=()=>n(594794),N=()=>n(953418),_=()=>n(963589),V=()=>n(644914),H=()=>n(765957),K=()=>n(948914),W=()=>n(847),q=()=>n(790068),Y=()=>n(46986),X=()=>n(704338),G=()=>n(390898),Q=()=>n(600434),Z=()=>n(805126),J=()=>n(555102),ee=()=>n(160992);function te(e){return"applied"===e.state||"applied:error"===e.state||"confirmation:rejected"===e.state||"confirmation:confirmed"===e.state||!0===e.done}function ne(e){return"confirmation:requested"===e.state||"requested"===e.userConfirmation}function re(e){return"confirmation:rejected"===e.state||"rejected"===e.userConfirmation}function ae(e){switch(e.userConfirmation){case"requested":return"confirmation:requested";case"confirmed":return"confirmation:confirmed";case"rejected":return"confirmation:rejected";default:return e.state??"pending"}}var oe=()=>n(890754),ie=()=>n(865454);const se=new(n(178624).R)({key:"aiChatDrafts",namespace:n(419494).Bq,important:!0,trackingType:"necessary"});function le(){return se.state??(0,C().x9d)("")}function de(e){e&&(0,C().AhH)(e)>0?se.setState(e):se.setState(void 0)}function ce(){se.setState(void 0)}var ue=()=>n(217514),pe=()=>n(557336),ge=()=>n(284371),fe=()=>n(843189);const he=[{toolName:"create-pages",action:"Summarize this page"},{toolName:"create-database",action:"Create a tasks tracker"},{toolName:"search",action:"Generate ideas for this page"},{toolName:"update-page",action:"Make this page more detailed"},{toolName:"create-pages",action:"Create an action plan"}];var me=()=>n(206267),ve=()=>n(449506);const xe=["Summarize this page","Create a tasks tracker","Make this page more succinct","Generate ideas for improving this page","Tell me what Notion AI can do"];function ye(e){let{onSuggestionClick:t}=e;const n=(0,a().v3)(),[o,s]=(0,r.useState)(xe),[l,d]=(0,r.useState)(!1),c=(0,i().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:8,marginBottom:12},pill:{alignSelf:"flex-start",padding:"8px 12px",fontWeight:ge().Wy.medium,whiteSpace:"nowrap",opacity:l?.7:1}})),[l]);(0,r.useEffect)((()=>{(async()=>{const e=H().default.state.mainEditorCurrentBlockStore;if(e){d(!0);try{const t=await async function(e){const{environment:t,data:n}=e;try{const e=await ve().callApi({eventName:"getAgentSuggestedActions",environment:t,data:n});return"failed"===e.type?{actions:he}:e.data}catch(r){return{actions:he}}}({environment:n,data:{blockPointer:{table:"block",id:e.id,spaceId:e.getSpaceId()},aiSessionId:me().JW(),numActions:5}});t.actions&&t.actions.length>0&&s(t.actions.map((e=>e.action)))}catch(t){}finally{d(!1)}}})()}),[n]);const p=(0,r.useCallback)((e=>{const n=(0,C().x9d)(e);t(n)}),[t]);return(0,u.jsx)("div",{style:c.container,children:o.map(((e,t)=>(0,u.jsx)(fe().E,{style:c.pill,onClick:()=>p(e),shape:"pill",disabled:l,children:e},t)))})}var Se=()=>n(755543),be=(n(18107),n(823215),n(803949),n(737550),()=>n(750559)),Ie=()=>n(179034),Ce=()=>n(695608),ke=()=>n(534177),we=()=>n(867201),je=()=>n(28070),Ae=()=>n(493823),Me=()=>n(187820),Te=()=>n(16006),Re=()=>n(453697),Be=()=>n(13679),De=()=>n(630116),Oe=()=>n(981928),Ue=()=>n(562936),Pe=()=>n(549131),Fe=()=>n(588104),Ee=()=>n(774952),Le=()=>n(65590),$e=()=>n(726102);function ze(e){let{icon:t,content:n}=e;const r=(0,i().IS)((e=>({grid:{display:"grid",gridTemplateColumns:"20px 1fr",gridTemplateRows:"28px auto",gridTemplateAreas:'\n\t\t\t\t\t"icon step"\n\t\t\t\t\t"vertical-line step"\n\t\t\t\t',gap:"4px 0px"},icon:{gridArea:"icon",alignSelf:"center",justifySelf:"center"},content:{gridArea:"step",gridColumn:t?"2 / -1":"1 / -1",gap:8,display:"flex",flexDirection:"column",minWidth:0}})),[t]);return(0,u.jsxs)("div",{style:r.grid,children:[t&&(0,u.jsx)("div",{style:r.icon,children:t}),(0,u.jsx)("div",{style:r.content,children:n})]})}var Ne=()=>n(554509),_e=()=>n(217429);function Ve(e){let{item:t,isLastStep:n,threadStore:r}=e;const a=(0,Pe().sq)(t.step.id,r),i=(0,o().K8)((()=>{var e;return!(!t.stepComponent||!a)&&((null==r||null===(e=r.getMessageStoreById(t.step.id))||void 0===e||null===(e=e.getData())||void 0===e?void 0:e.unsatisfactory)&&_e().default.checkGate({gateName:"workflows_unsatisfactory_feedback"}))}),[t,r,a]);return(0,u.jsx)(He,{item:t,children:i&&n?(0,u.jsx)(Ne().D,{styleName:"UISmall-12px/Regular",colorName:"secondary",children:(0,u.jsx)(k().sA,{defaultMessage:"We’ve noticed that this part of the conversation may not have been helpful. Click “thumbs down” to help us improve Notion AI.",id:"workflowTranscript.unsatisfactoryFeedbackActions.info"})}):null})}function He(e){let{item:t,children:n}=e;return(0,u.jsxs)(B().Y1,{direction:"vertical",gap:10,children:[(0,u.jsx)(Ke,{item:t}),n]})}function Ke(e){let{item:t}=e;const{iconComponent:n,stepComponent:r}=t;return(0,u.jsx)(ze,{icon:n,content:r})}n(430670),n(814603),n(147566),n(198721);var We=()=>n(203066),qe=()=>n(153321),Ye=()=>n(764880),Xe=()=>n(365646),Ge=()=>n(800204),Qe=()=>n(242138),Ze=()=>n(295005),Je=()=>n(241178),et=()=>n(362750),tt=()=>n(203717),nt=()=>n(529099),rt=()=>n(682759),at=()=>n(29037),ot=()=>n(209969),it=()=>n(62616),st=()=>n(818541),lt=()=>n(300985);const dt={viewBox:"0 0 20 20",fittedViewBox:"1.59 1.59 16.81 16.81",svg:(0,u.jsx)("path",{d:"M8.498 2.222c.83-.83 2.175-.83 3.005 0l6.275 6.276c.83.83.83 2.175 0 3.005l-6.275 6.275c-.83.83-2.175.83-3.005 0l-6.276-6.275a2.125 2.125 0 0 1 0-3.005zM10 12.125a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5m0-5.875a.625.625 0 0 0-.625.625v3.5a.625.625 0 1 0 1.25 0v-3.5A.625.625 0 0 0 10 6.25"})},ct=(0,c().wt)("exclamationDiamondFill",dt);var ut=()=>n(89849),pt=()=>n(12193),gt=()=>n(167170),ft=()=>n(200582),ht=()=>n(742852),mt=()=>n(207207),vt=()=>n(105819),xt=()=>n(617668),yt=()=>n(236262),St=()=>n(637433),bt=()=>n(861017),It=()=>n(519831),Ct=()=>n(978234),kt=()=>n(499919),wt=()=>n(498212),jt=()=>n(435009),At=()=>n(760217),Mt=()=>n(720128),Tt=()=>n(135221),Rt=()=>n(331542),Bt=()=>n(678553),Dt=()=>n(460292),Ot=()=>n(958378),Ut=()=>n(89924),Pt=()=>n(457688),Ft=()=>n(751380),Et=()=>n(492414),Lt=()=>n(41508),$t=()=>n(614842),zt=()=>n(442510);function Nt(e){for(const t of Lt().zP){const n=Lt().JN[t];for(const r of n.effectsArray)if(r===e)return t}throw new Error(`Did not find effect key ${e} in any module`)}function _t(e){const t=Nt(e),n=zt().y[t].effect[e];if(!n)throw new Error(`Did not find effect definition for ${e}`);return n}var Vt=()=>n(155382),Ht=()=>n(975366),Kt=()=>n(895432);n(908872);function Wt(e){if(!e)return"";const t={};let n=0;const r=e.replace(/\[([^\]]*)\]\(([^)]*)\)/g,(e=>{const r=`__LINK_PLACEHOLDER_${n++}__`;return t[r]=e,r})).replace(/\[\^([^\]]*)\]/g,(e=>{const r=`__CITATION_PLACEHOLDER_${n++}__`;return t[r]=e,r})).replace(/{{(\^?)([^{}]+)}}/g,((e,t,n)=>`[^${n}]`));return Object.entries(t).reduce(((e,t)=>{let[n,r]=t;return e.replace(n,r)}),r)}const qt=(0,c().xh)("arrowChevronSingleRight",{default:{loader:()=>n.e(30313).then(n.bind(n,222334))},small:{loader:()=>n.e(30313).then(n.bind(n,906380))},fill:{loader:()=>n.e(30313).then(n.bind(n,944924))},fillSmall:{loader:()=>n.e(30313).then(n.bind(n,158115))}},["chevron","right","arrow","direction","forward"]);var Yt=()=>n(960715);function Xt(e){const{label:t,content:n,isExpanded:a,onChangeExpanded:o}=e,s=(0,r.useCallback)((()=>{o(!a)}),[a,o]),l=(0,i().IS)((e=>({container:{minWidth:0,marginLeft:n?0:8},expandedIndicator:{flexShrink:0,transition:"transform 0.1s ease-in-out",transform:a?"rotate(90deg)":"rotate(0deg)"},button:{display:"inline-flex",width:"fit-content",gap:3,maxWidth:"100%"}})),[a,n]);if(!n)return(0,u.jsx)(B().Y1,{height:Yt().RO.md,align:"center-left",style:l.container,padding:`0px ${Yt().mw.md}px`,children:t});const d=(0,u.jsx)(Dt().Q,{iconGroup:qt,colorName:"secondary",variantName:"small",style:l.expandedIndicator});return(0,u.jsxs)(B().Y1,{direction:"vertical",gap:6,style:l.container,width:"hug",children:[(0,u.jsxs)(Ae().p,{onClick:s,style:l.button,size:"md",children:[(0,u.jsx)("div",{style:{maxWidth:`calc(100% - ${c().CN.small}px)`},children:t}),d]}),(0,u.jsx)(We().N,{children:a&&(0,u.jsx)(qe().P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},style:{overflow:"hidden"},children:n})})]})}function Gt(e){const{isBusy:t,markdown:n,durationMs:a}=e,[o,s]=(0,r.useState)(t),[l,d]=(0,r.useState)(!1),[c,p]=(0,r.useState)(!1),g=(0,r.useRef)(null),f=(0,r.useCallback)((()=>{const e=g.current;if(!e)return;const{scrollTop:t,scrollHeight:n,clientHeight:r}=e,a=n>r,o=n-t-r<=0;d(a&&!(t<=0)),p(a&&!o)}),[]),h=(0,i().IS)((e=>({container:{position:"relative",maxHeight:175},scrollContainer:{overflowY:"auto",maxHeight:"inherit"},topGradient:{display:l?"block":"none",position:"absolute",top:0,left:0,right:0,height:24,background:"dark"===e.mode?"linear-gradient(to bottom, rgba(32,32,32, 1), transparent)":"linear-gradient(to bottom, rgba(248,248,247, 1), transparent)",pointerEvents:"none",zIndex:1},bottomGradient:{display:c?"block":"none",position:"absolute",bottom:0,left:0,right:0,height:24,background:"dark"===e.mode?"linear-gradient(to top, rgba(32,32,32, 1), transparent)":"linear-gradient(to top, rgba(248,248,247, 1), transparent)",pointerEvents:"none",zIndex:1}})),[l,c]);return(0,r.useEffect)((()=>{const e=g.current;if(e)return f(),e.addEventListener("scroll",f,{passive:!0}),()=>{e.removeEventListener("scroll",f)}}),[f,o]),(0,r.useEffect)((()=>{const e=g.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<=40;requestAnimationFrame((()=>{t&&(e.scrollTop=e.scrollHeight),f()}))}),[n,f,o]),(0,r.useEffect)((()=>{s(t)}),[t]),(0,u.jsx)(Xt,{isExpanded:o,onChangeExpanded:s,label:t?(0,u.jsx)(Kt().N,{styleName:"UIRegular-14px/Regular",animate:!0,text:"Thinking..."}):(0,u.jsx)("div",{style:{display:"flex",alignItems:"center",gap:4},children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",children:a?`Thought for ${Qt(a)}`:"Thought"})}),content:(0,u.jsxs)("div",{style:h.container,children:[(0,u.jsx)("div",{style:h.topGradient}),(0,u.jsx)("div",{style:h.bottomGradient}),(0,u.jsx)("div",{style:h.scrollContainer,ref:g,children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",children:(0,u.jsx)(Ht().hu,{markdown:Wt(n)})})})]})})}function Qt(e){const t=Math.floor(e/1e3);if(t<60)return`${t}s`;return`${Math.floor(t/60)}m ${t%60}s`}n(967357);var Zt=()=>n(769607),Jt=()=>n(803960),en=()=>n(222334),tn=()=>n(471095);const nn={viewBox:"0 0 20 20",fittedViewBox:"3.94 3.94 12.12 12.12",svg:(0,u.jsx)("path",{d:"m14.859 6.786.933-.933V5.83a1.16 1.16 0 0 0-.073-1.553 1.16 1.16 0 0 0-1.634 0l-.868.867zm-8.573 8.573 8.091-8.091-1.642-1.643-8.098 8.085c-.156.156-.264.36-.333.548l-.339 1.094-.002.01c-.105.392.257.815.686.667l1.073-.333q.319-.09.564-.337"})},rn=(0,c().wt)("pencilFill",nn);var an=()=>n(73822),on=()=>n(96897),sn=()=>n(750660),ln=()=>n(464708),dn=()=>n(939740),cn=()=>n(8980),un=()=>n(204063),pn=()=>n(162010),gn=()=>n(128295),fn=()=>n(2143),hn=()=>n(58293),mn=()=>n(756279),vn=()=>n(970585),xn=()=>n(438632),yn=()=>n(792071),Sn=()=>n(476158),bn=()=>n(142748),In=()=>n(296798),Cn=()=>n(921855);var kn=()=>n(158489),wn=()=>n(743176);const jn=20;function An(e){let{menuListItemProps:t,title:n,icon:r,agentAction:a,disabled:o}=e;const s=(0,i().IS)((e=>({menuItem:{padding:"8px 12px"},title:{color:e.text.secondary,fontSize:14,fontWeight:ge().Wy.regular,lineHeight:ge().K_.UIRegular.desktop}})),[]);return(0,u.jsx)(At().A,{...t,style:s.menuItem,title:(0,u.jsxs)(B().Y1,{direction:"horizontal",gap:8,children:[n,(0,u.jsx)(Mn,{agentAction:a})]}),titleStyle:s.title,icon:r,disabled:o})}function Mn(e){let{agentAction:t}=e;const n=(0,i().IS)((e=>({badge:{margin:0}})),[]);switch(t){case"create":return(0,u.jsx)(ln().A,{content:(0,u.jsx)(k().sA,{id:"AgentActionBadge.new",defaultMessage:"New"}),color:"blue",style:n.badge});case"update":return(0,u.jsx)(ln().A,{content:(0,u.jsx)(k().sA,{id:"AgentActionBadge.updated",defaultMessage:"Updated"}),color:"yellow",style:n.badge});case"delete":return(0,u.jsx)(ln().A,{content:(0,u.jsx)(k().sA,{id:"AgentActionBadge.deleted",defaultMessage:"Deleted"}),color:"red",style:n.badge});default:return(0,ke().HB)(t)}}function Tn(e){return(0,u.jsx)(Ut().A,{style:{padding:"4px 0px"},...e})}function Rn(e){let{threadOperations:t,theme:n}=e;const r=function(e){const t={};for(const n of e){if(n.pointer.table!==It().Vl)continue;const e=Bn(n);if(0===e.length)continue;const r=n.pointer.id;t[r]||(t[r]=[]),t[r].push(...e)}return t}((0,kn().tr)(t)),a=Object.keys(r);if(0===a.length)return;const o=a[0],i=r[o].map(((e,t)=>function(e){let{propertyChangeInfo:t,index:n,theme:r}=e;const{agentAction:a,propertySchema:o}=t;return{key:`${a}-${o.name}-${n}`,action:()=>{},render:e=>(0,u.jsx)(An,{menuListItemProps:e,title:o.name,icon:(0,u.jsx)(wn().zB,{type:o.type,icon:void 0,size:16,theme:r}),agentAction:a,disabled:!0})}}({propertyChangeInfo:e,index:t,theme:n}))).filter(ke().O9);return 0!==i.length?{key:o,items:i,render:e=>(0,u.jsx)(Tn,{...e})}:void 0}function Bn(e){const t=[];if("set"===e.command&&e.path.some((e=>"schema"===e)))t.push({agentAction:"create",propertySchema:e.args});else if("update"===e.command){const n=Object.values(e.args).map((e=>function(e){if("object"==typeof e&&null!==e&&"type"in e&&"name"in e)return e}(e))).filter(ke().O9);e.path.some((e=>"deleted_schema"===e))?t.push(...n.map((e=>({agentAction:"delete",propertySchema:e})))):e.path.some((e=>"schema"===e))&&t.push(...n.map((e=>({agentAction:"update",propertySchema:e}))))}return t}function Dn(e){let{recordDiffInfos:t,spaceStore:n,intl:r,environment:a}=e;const o=t.map(((e,t)=>function(e){let{recordDiffInfo:t,index:n,spaceStore:r,intl:a,environment:o}=e;const{recordPointer:i,agentAction:s}=t,d=De().Bv.createChildStore(r,i),c=d.getIcon(),p=d.getRenderTitle({userTimeZone:a.locale,intl:a});if(void 0===p)return;return{key:`${d.id}-${n}`,action:()=>{A().uK({environment:o,store:d,pageVisitSource:l().y8.AIChat})},render:e=>(0,u.jsx)(An,{menuListItemProps:e,title:(0,u.jsx)(Te().A,{store:d}),icon:(0,u.jsx)(Me().B6,{icon:c,isEmptyPage:Boolean(c),size:jn,disabled:!0,iconRecordCategory:(0,Me().Te)(d)}),agentAction:s})}}({recordDiffInfo:e,index:t,spaceStore:n,intl:r,environment:a}))).filter(ke().O9);if(0!==o.length)return{key:"agent-tool-preview-diff-pages",items:o,render:e=>(0,u.jsx)(Tn,{...e})}}function On(e){const{label:t,sections:n,isBusy:a}=e,s=(0,o().uB)(void 0,vn().A),[l,d]=(0,r.useState)(a);(0,r.useEffect)((()=>{d(a)}),[a]);const c=(0,i().IS)((e=>({container:{background:e.surface.elevated,boxShadow:e.shadowXS,borderRadius:6,margin:"1px 1px 6px 1px",maxHeight:200}})),[]);return(0,u.jsx)(Xt,{isExpanded:l,onChangeExpanded:d,label:t,content:null!=n&&n.length?(0,u.jsx)(fn().H,{type:mn().A.Y,style:c.container,children:(0,u.jsx)(dn().Ay,{type:dn().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:n,store:s,disableKeyboard:!0})}):void 0})}function Un(e){const{label:t,isBusy:n,right:r,state:a}=e,o=(0,i().IS)((e=>({container:{display:"flex",gap:4,width:"100%"},textContainer:{display:"flex",gap:4,overflow:"hidden",alignItems:"center"}})),[]);return(0,u.jsxs)("div",{style:o.container,children:[(0,u.jsxs)("div",{style:o.textContainer,children:[(0,u.jsx)("span",{style:{flex:"0 0 auto",maxWidth:"100%"},children:(0,u.jsx)(Kt().N,{animate:n&&"confirmation:requested"!==a,text:t,styleName:"UIRegular-14px/Regular",colorName:n?"primary":"secondary",textOverflow:"ellipsis"})}),r]}),"confirmation:rejected"===a&&(0,u.jsx)(ln().A,{content:"Canceled"})]})}function Pn(e){let{store:t,style:n}=e;const r=(0,oe().useCurrentThreadStore)(),a=(0,o().K8)((()=>{if(t)return(0,Et().Ay)({store:t,pageVisitSource:l().y8.AIChat,chatThreadId:null==r?void 0:r.id})}),[t,r]);return(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Regular",colorName:"primary",customStyles:{overflow:"hidden"},children:(0,u.jsx)(In().A,{href:a,onClick:e=>{e.stopPropagation()},children:(0,u.jsx)(Te().A,{store:t,underline:!0,maxLength:35,maxLines:1,style:{display:"block",...n}})})})}function Fn(e){let{intl:t,loading:n,numResults:r,toolName:a,toolResultStep:o,isMultiDatabaseMode:i}=e;if("search"===a){var s,l,d;const e=o&&(0,Xe().gY)(o,"search")?null===(s=o.result)||void 0===s?void 0:s.input:void 0;let r;return null!=e&&null!==(l=e.web)&&void 0!==l&&l.queries.length?r=null==e?void 0:e.web.queries[0]:null!=e&&null!==(d=e.internal)&&void 0!==d&&d.questions.length&&(r=e.internal.questions[0]),n?r?t.formatMessage({id:"AgentInferenceStepRenderer.search.loading.withQuery",defaultMessage:'Searching for "{query}"'},{query:r}):t.formatMessage({id:"AgentInferenceStepRenderer.search.loading",defaultMessage:"Searching"}):r?t.formatMessage({id:"AgentInferenceStepRenderer.search.done.withQuery",defaultMessage:'Searched for "{query}"'},{query:r}):t.formatMessage({id:"AgentInferenceStepRenderer.search.done",defaultMessage:"Searched"})}if("view"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.view.loading",defaultMessage:"Viewing"}):r<=1?t.formatMessage({id:"AgentInferenceStepRenderer.view.done",defaultMessage:"Viewed"}):t.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple",defaultMessage:"Viewed {numResults} pages"},{numResults:r});if("view-database-files"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.viewDatabaseFiles.loading",defaultMessage:"Viewing code"}):t.formatMessage({id:"AgentInferenceStepRenderer.viewDatabaseFiles.done",defaultMessage:"Viewed code"});if("create-database"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.loading",defaultMessage:"Creating database"}):t.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.done",defaultMessage:"Created"});if("update-database"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.loading",defaultMessage:"Updating database"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.done",defaultMessage:"Updated database"});if("query-data-sources"===a){var c;const e=o&&(0,Xe().gY)(o,"query-data-sources")?(null===(c=o.result)||void 0===c?void 0:c.collectionIds)??[]:[];return n?e.length?t.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.loading.withSourceIncluded",defaultMessage:"Querying"}):i?t.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.loading",defaultMessage:"Querying data sources"}):t.formatMessage({id:"AgentInferenceStepRenderer.queryDatabases.loading",defaultMessage:"Querying databases"}):e.length?t.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.done.withSourceIncluded",defaultMessage:"Queried"}):i?t.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.done",defaultMessage:"Queried data sources"}):t.formatMessage({id:"AgentInferenceStepRenderer.queryDatabases.done",defaultMessage:"Queried databases"})}if("update-database-triggers"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabaseTriggers.loading",defaultMessage:"Updating triggers"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabaseTriggers.done",defaultMessage:"Updated triggers"});if("error"===a)return t.formatMessage({id:"AgentInferenceStepRenderer.error",defaultMessage:"Error"});if("create-pages"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.createPages.loading",defaultMessage:"Creating pages"}):r<=1?t.formatMessage({id:"AgentInferenceStepRenderer.createPages.done",defaultMessage:"Created"}):t.formatMessage({id:"AgentInferenceStepRenderer.createPages.donePlural",defaultMessage:"Created {numResults} pages"},{numResults:r});if("delete-pages"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.deletePage.loading",defaultMessage:"Deleting pages"}):r<=1?t.formatMessage({id:"AgentInferenceStepRenderer.deletePage.done",defaultMessage:"Deleted page"}):t.formatMessage({id:"AgentInferenceStepRenderer.deletePage.donePlural",defaultMessage:"Deleted {numResults} pages"},{numResults:r});if("update-page"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.updatePage.loading",defaultMessage:"Updating page"}):r<=1?t.formatMessage({id:"AgentInferenceStepRenderer.updatePage.done",defaultMessage:"Updated page"}):t.formatMessage({id:"AgentInferenceStepRenderer.updatePage.donePlural",defaultMessage:"Updated {numResults} pages"},{numResults:r});if("update-database-data-sources"===a)return n?i?t.formatMessage({id:"AgentInferenceStepRenderer.updateDataSources.loading",defaultMessage:"Updating data sources"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabases.loading",defaultMessage:"Updating databases"}):i?t.formatMessage({id:"AgentInferenceStepRenderer.updateDataSources.done",defaultMessage:"Updated data sources"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateDatabases.done",defaultMessage:"Updated databases"});if("update-database-views"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.updateViews.loading",defaultMessage:"Updating views"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateViews.done",defaultMessage:"Updated views"});if("result"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.asyncSuccess.loading",defaultMessage:"Finishing task"}):t.formatMessage({id:"AgentInferenceStepRenderer.asyncSuccess.done",defaultMessage:"Finished task"});if((0,Ge().og)(a))return function(e,t){let{intl:n,isLoading:r,toolResultStep:a}=t;return _t(e).getDescription({intl:n,isLoading:r,toolResultStep:a})}(a,{intl:t,isLoading:n,toolResultStep:o});if("update-user-integrations"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"});if("toggle-user-integration-tools"===a)return o&&(0,Xe().gY)(o,"toggle-user-integration-tools")?function(e){var t,n;const{intl:r,loading:a,toolResultStep:o}=e;if(!o||!(0,Xe().gY)(o,"toggle-user-integration-tools")||!(0,ke().O9)(null===(t=o.result)||void 0===t?void 0:t.activateIntegrationCount)&&!(0,ke().O9)(null===(n=o.result)||void 0===n?void 0:n.deactivateIntegrationCount))return a?r.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"}):r.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"});const{activateIntegrationCount:i,deactivateIntegrationCount:s}=o.result??{};let l="";(0,ke().O9)(i)&&i>0&&(l=a?r.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activating {numberOfIntegrations} integration} other {Activating {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrations.loading"},{numberOfIntegrations:i}):r.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activated {numberOfIntegrations} integration} other {Activated {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrations.done"},{numberOfIntegrations:i}));let d="";(0,ke().O9)(s)&&s>0&&(d=a?r.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivating {numberOfIntegrations} integration} other {Deactivating {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrations.loading"},{numberOfIntegrations:s}):r.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivated {numberOfIntegrations} integration} other {Deactivated {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrations.done"},{numberOfIntegrations:s}));return l&&d?r.formatList([l,d.toLocaleLowerCase()],{style:"long",type:"conjunction"}):l||d}({intl:t,loading:n,toolResultStep:o}):n?t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"});if("edit-json"===a)throw new Error("edit-json tool should not be used in the UI");if("codegen.run"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.codegenRun.loading",defaultMessage:"Running codegen"}):t.formatMessage({id:"AgentInferenceStepRenderer.codegenRun.done",defaultMessage:"Ran codegen"});if("codegen.runStatus"===a)return n?t.formatMessage({id:"AgentInferenceStepRenderer.codegenRunStatus.loading",defaultMessage:"Checking codegen status"}):t.formatMessage({id:"AgentInferenceStepRenderer.codegenRunStatus.done",defaultMessage:"Checked codegen status"});if("spawn-agent"===a){if(o&&(0,Xe().gY)(o,"spawn-agent")){let e;const t=null==o?void 0:o.result;if(("progress"===(null==t?void 0:t.type)||"done"===(null==t?void 0:t.type))&&(e=t.taskSummary),e)return e}return n?t.formatMessage({id:"AgentInferenceStepRenderer.spawnAgent.loading",defaultMessage:"Task received"}):t.formatMessage({id:"AgentInferenceStepRenderer.spawnAgent.done",defaultMessage:"Task completed"})}return"create-agent"===a?n?t.formatMessage({id:"AgentInferenceStepRenderer.createAgent.loading",defaultMessage:"Creating agent"}):t.formatMessage({id:"AgentInferenceStepRenderer.createAgent.done",defaultMessage:"Created agent"}):"update-agent"===a?n?t.formatMessage({id:"AgentInferenceStepRenderer.updateAgent.loading",defaultMessage:"Updating agent"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateAgent.done",defaultMessage:"Updated agent"}):"delete-agent"===a?n?t.formatMessage({id:"AgentInferenceStepRenderer.deleteAgent.loading",defaultMessage:"Deleting agent"}):t.formatMessage({id:"AgentInferenceStepRenderer.deleteAgent.done",defaultMessage:"Deleted agent"}):void(0,ke().HB)(a)}function En(e){let{threadStore:t,step:n,toolName:s,resultStep:d,resultStepIdsToConfirm:c,isBusy:p}=e;const g=d?[d]:[],f=(0,Vt().yX)(g),h=(0,hn().r)(),m=(0,k().tz)(),v=(0,a().v3)(),x=(0,i().DP)(),b=(0,_().X)("agent_multidb_creation"),I=Fn({toolName:s,loading:Boolean(p||d&&ne(d)),numResults:f.length,intl:m,isMultiDatabaseMode:b,toolResultStep:d}),j=(0,r.useMemo)((()=>{if("spawn-agent"===s&&d&&(0,Xe().gY)(d,"spawn-agent")){const e=null==d?void 0:d.result;if("progress"===(null==e?void 0:e.type))return e.messages.at(-1);if("done"===(null==e?void 0:e.type))return e.resultSummary}}),[s,d]),A=null!=d&&d.error&&d.error!==Ge().p9?d.error:void 0,M=(0,Vt().WM)(s),T=(0,r.useMemo)((()=>{if(Boolean(A))return(0,u.jsx)(cn().I,{icon:ct,color:"uiRedPrimary"});if("spawn-agent"===s){var e;if(d&&(0,Xe().gY)(d,"spawn-agent")&&"progress"===(null===(e=d.result)||void 0===e?void 0:e.type)){const e=Math.floor(d.result.progress/d.result.total*100);return(0,u.jsx)(pn().C,{percentage:e,label:`${e}`,size:28})}return(0,u.jsx)(cn().I,{icon:Zt().aiFaceFillIcon})}return(0,u.jsx)(cn().I,{icon:$n(M)})}),[A,M,d,s]),R=(0,o().K8)((()=>{if(h&&d)return"create-database"===s||"update-database"===s?Rn({threadOperations:d.threadOperations??[],theme:x}):Dn({spaceStore:h,intl:m,environment:v,recordDiffInfos:f})}),[h,m,v,f,s,x,d]),D=function(e){const{resultSteps:t,threadStore:n,step:r}=e,s=(0,a().v3)(),d=(0,i().DP)(),c=(0,o().O$)(H().default).currentSpaceStore,{originalRecordMap:p,updatedRecordMap:g,pointersForStep:f}=(0,o().K8)((()=>{const e=y().RecordMap.create(),a=y().RecordMap.create(),o={};if(!c)return{originalRecordMap:e,updatedRecordMap:a,pointersForStep:o};for(const i of t){if(!i.threadOperations)continue;const t=i.threadOperations.filter((e=>e.persistOnServer&&e.operation.pointer.table===Ie().ev)),s=t.map((e=>e.operation.pointer)).filter((e=>e.table===Ie().ev));if(!s.length)continue;o[r.id]=s,s.forEach((t=>{const n=De().Bv.createChildStore(c,t).getModel();n&&(e.setModel(t,n),a.setModel(t,n))}));const l=n.getMessages().findIndex((e=>e===i.id)),d=n.getMessageStores().slice(l+1).map((e=>{var t;const n=e.getStep();if(n&&"agent-tool-result"===n.type&&null!==(t=n.threadOperations)&&void 0!==t&&t.length)return n})).filter(ke().O9),u=d.map((e=>{var t;return(null===(t=e.threadOperations)||void 0===t?void 0:t.map((e=>e.invertedOperations)))??[]})).flat(2).filter(ke().O9);(0,Sn().applyOperationsToRecordMap)({recordMap:e,operations:u}),(0,Sn().applyOperationsToRecordMap)({recordMap:a,operations:u}),(0,Sn().applyOperationsToRecordMap)({recordMap:e,operations:t.map((e=>e.invertedOperations)).filter(ke().O9).flat()})}return{originalRecordMap:e,updatedRecordMap:a,pointersForStep:o}}),[t,c,r,n]),h=(0,o().K8)((()=>{const e=(0,ke().WP)(f).map((e=>{let[t,r]=e;if(c)return r.map((e=>{if(e.table!==Ie().ev)return;const r=p.getModel(e),a=g.getModel(e),o=null==r?void 0:r.getProperties(),i=null==a?void 0:a.getProperties(),f=!!r&&(0,bn()._n)(e,yn().b4_.fromRecordMap(p)),h=!!a&&(0,bn()._n)(e,yn().b4_.fromRecordMap(g));let m,v=!1;null!=o&&o.title&&!h?m=(0,xn().yR)({before:o.title,after:[],insertionAnnotation:[C().Ifu.Inserted],deletionAnnotation:[C().Ifu.Deleted]}):null!=i&&i.title&&!f?(m=(0,xn().yR)({before:[],after:i.title,insertionAnnotation:[C().Ifu.Inserted],deletionAnnotation:[C().Ifu.Deleted]}),v=!0):f&&h&&null!=o&&o.title&&null!=i&&i.title&&!(0,w().n4)(o.title,i.title)&&(m=(0,xn().yR)({before:o.title,after:i.title,insertionAnnotation:[C().Ifu.Inserted],deletionAnnotation:[C().Ifu.Deleted]}),v=!0);const x=De().Bv.createChildStore(c,e),y=(0,Et().Ay)({store:x,fullyQualified:!1,pageVisitSource:l().y8.LinkInPage,chatThreadId:n.id});return m?{key:`${t}${S().L3.toKey(e)}${Math.random()}`,action:()=>{},render:e=>(0,u.jsx)(At().A,{...e,shouldWrapTitle:!0,title:(0,u.jsx)(In().A,{href:y,disabled:!v,children:Cn().S5({environment:s,textValue:{value:C().ITd(m),spaceId:c.id},parentStore:c,disableHover:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!0,disabled:!0,emojiType:"raw",theme:d,katex:void 0,formulaValueTypes:[]})})})}:void 0})).filter(ke().O9)})).flat().filter(ke().O9);if(!e.length)return;const t={key:"diffs",items:e,render:e=>(0,u.jsx)(Ut().A,{...e})};return t}),[s,p,f,c,d,n.id,g]);return h}({threadStore:t,step:n,resultSteps:g}),O=(0,o().K8)((()=>{var e;if(!h)return;const t=((null==d||null===(e=d.threadOperations)||void 0===e?void 0:e.map((e=>e.operation)))??[]).filter(on().XQ).map((e=>{const{pointer:t}=e;if(t.table!==Ie().ev)return;return"page"===De().Bv.createChildStore(h,t).getType()?{recordPointer:t,agentAction:"delete"}:void 0})).filter(ke().O9);return Dn({spaceStore:h,intl:m,environment:v,recordDiffInfos:t})}),[h,v,m,null==d?void 0:d.threadOperations]),U=(Vn[s]?[O,D]:[R]).filter(ke().O9),P=U.length>0,[F,E]=(0,r.useState)(!0),L=(0,o().uB)(void 0,vn().A),$=(0,r.useCallback)((()=>{E((e=>!e))}),[]),{hasUndoneOperations:z}=(0,Vt().ji)({diffResultSteps:g,threadStore:t});(0,r.useEffect)((()=>{z&&E(!1)}),[z]);const N=(0,i().IS)((e=>({wrapper:{border:`0.5px solid ${e.stroke.primary}`,borderRadius:10,overflow:"hidden"},border:{borderTop:`0.5px solid ${e.stroke.primary}`},contentWrapper:{overflow:"hidden"},scrollerStyle:{maxHeight:200}})),[]);return(0,u.jsxs)(B().Y1,{direction:"vertical",gap:8,children:[(0,u.jsxs)("div",{style:N.wrapper,children:[(0,u.jsx)(Ln,{recordDiffInfos:f,isExpanded:F,state:d?ae(d):void 0,isBusy:p,canExpand:P,onToggleExpanded:$,title:I,subtitle:j,icon:T,showLocationPicker:"create"===M}),(0,u.jsx)(We().N,{children:P&&F?(0,u.jsx)(qe().P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},style:N.contentWrapper,children:(0,u.jsx)("div",{style:N.border,children:(0,u.jsx)(fn().H,{type:mn().A.Y,style:N.scrollerStyle,children:(0,u.jsx)(dn().Ay,{type:dn().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:U,store:L,disableKeyboard:!0})})})}):void 0})]}),A&&(0,u.jsx)(_n,{toolName:s}),!p&&c.length>0&&(0,u.jsx)(Nn,{resultStepIdsToConfirm:c})]})}function Ln(e){let{recordDiffInfos:t,isExpanded:n,state:r,isBusy:a,canExpand:s,onToggleExpanded:l,icon:d,title:c,subtitle:p,showLocationPicker:g}=e;const f=(0,k().tz)(),h=(0,hn().r)(),m=1===t.length?t[0]:void 0,v=h&&m?De().Bv.createChildStore(h,m.recordPointer):void 0,x=(0,o().K8)((()=>void 0!==(null==v?void 0:v.getRenderTitle({userTimeZone:f.locale,intl:f}))),[v,f]),y=(0,i().IS)((e=>({button:{width:"100%",height:"auto",padding:12,textAlign:"left",borderBottomLeftRadius:n?0:void 0,borderBottomRightRadius:n?0:void 0,display:"flex",flexDirection:"column",gap:4,alignItems:"start"},titleContainer:{display:"flex",gap:4,overflow:"hidden",alignItems:"center"},recordTitleLink:{fontWeight:ge().Wy.medium},loadingDots:{marginLeft:4}})),[n]);let S=(0,u.jsxs)("div",{style:y.titleContainer,children:[(0,u.jsx)("span",{style:{flex:"0 0 auto"},children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Medium",colorName:"primary",children:c})}),v&&x&&(0,u.jsx)(Pn,{store:v,style:y.recordTitleLink}),a&&(0,u.jsx)(Tt().A,{styleParentContainer:y.loadingDots,isTriColored:!0})]});return p&&(S=(0,u.jsxs)(B().Y1,{direction:"vertical",gap:2,style:{overflow:"hidden"},children:[S,(0,u.jsx)(Ne().D,{styleName:"UISmall-12px/Regular",colorName:"tertiary",textOverflow:"ellipsis",children:p})]})),(0,u.jsxs)(Ae().p,{disabled:a||!s,onClick:l,style:y.button,children:[(0,u.jsxs)(B().Y1,{direction:"horizontal",gap:8,width:"fill",height:"hug",align:"center-left",children:[d,S,"confirmation:rejected"===r?(0,u.jsx)(ln().A,{content:(0,u.jsx)(k().sA,{id:"AgentToolUseFull.canceled",defaultMessage:"Canceled"})}):void 0,s&&(0,u.jsx)(cn().I,{icon:n?Jt().arrowChevronSingleDownIcon:en().arrowChevronSingleRightIcon,color:"tertiary",size:20,style:{marginLeft:"auto"}})]}),v&&!a&&g&&(0,u.jsx)(zn,{store:v})]})}function $n(e){if(!e)return rn;switch(e){case"create":return an().plusFillIcon;case"update":return rn;case"delete":return yt().trashIcon;default:(0,ke().HB)(e)}}function zn(e){const{store:t}=e,n=(0,a().v3)(),s=(0,r.useRef)(null),l=(0,i().IS)((e=>({button:{padding:"0px 4px",display:"flex",gap:4,alignItems:"center",borderRadius:4,color:e.text.tertiary},path:{color:e.text.tertiary,fontSize:14},lock:{width:14,fill:e.text.tertiary},chevron:{width:10,fill:e.text.tertiary}})),[]),c=(0,o().K8)((()=>{const{currentSpaceViewStore:e}=H().default.state,r=(null==e?void 0:e.getPrivatePages(n))??[];return null==r?void 0:r.some((e=>e.id===t.id))}),[n,t]),p=(0,r.useCallback)((()=>{if(!s.current)return;const e=s.current.getBoundingClientRect();sn().ho({environment:n,blocks:[t],originRect:e,moveToContext:"ai_agent"})}),[n,t]),g=(0,o().K8)((()=>(0,gn().mG)(t).filter((e=>e instanceof De().Bv||e instanceof De().h4))),[t]);let f;return c?f=(0,u.jsxs)(u.Fragment,{children:[(0,tn().i)(l.lock),(0,u.jsx)("span",{style:l.path,children:(0,u.jsx)(k().sA,{defaultMessage:"Private",id:"agent.location_picker"})}),(0,d().arrowChevronSingleDownFillIcon)(l.chevron)]}):g.length>0&&(f=(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(gn().Ay,{innerStyle:l.path,store:t}),(0,d().arrowChevronSingleDownFillIcon)(l.chevron)]})),f?(0,u.jsx)(Ae().p,{style:l.button,size:"sm",ref:s,onClick:p,children:f}):null}function Nn(e){let{resultStepIdsToConfirm:t}=e;const{confirmToolUse:n,rejectToolUse:r}=wr(),a=(0,i().IS)((e=>({wrapper:{border:`1px solid ${e.stroke.uiBlueSecondary}`,borderRadius:10,backgroundColor:e.palette.uiBlue[50],padding:"8px 8px 8px 12px"},textContainer:{flex:"0 1 auto",minWidth:0}})),[]);return(0,u.jsxs)(B().Y1,{direction:"horizontal",gap:"auto",width:"fill",align:"center",style:a.wrapper,children:[(0,u.jsx)("div",{style:a.textContainer,children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Medium",colorName:"primary",children:(0,u.jsx)(k().sA,{id:"AgentToolUseFull.confirmChanges",defaultMessage:"Confirm changes"})})}),(0,u.jsxs)(B().Y1,{direction:"horizontal",gap:8,width:"hug",children:[(0,u.jsx)(fe().E,{color:"uiBlue",onClick:r,children:(0,u.jsx)(k().sA,{id:"AgentToolUseFull.discard",defaultMessage:"Discard"})}),(0,u.jsx)(un().A,{onClick:()=>n(t),children:(0,u.jsx)(k().sA,{id:"AgentToolUseFull.continue",defaultMessage:"Continue"})})]})]})}function _n(e){let{toolName:t}=e;const n=(0,k().tz)(),r=(0,_().X)("agent_multidb_creation"),a=(0,u.jsx)("span",{style:{textTransform:"lowercase"},children:Fn({toolName:t,loading:!0,numResults:1,intl:n,isMultiDatabaseMode:r})});return(0,u.jsx)("div",{style:{paddingLeft:12,paddingRight:12,paddingBottom:8},children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Regular",colorName:"uiRedPrimary",children:(0,u.jsx)(k().sA,{id:"AgentToolUseFull.errorPrefix",defaultMessage:"Encountered an error while {toolName}",values:{toolName:a}})})})}const Vn={"update-page":!0,search:!1,view:!1,"view-database-files":!1,"create-database":!1,"update-database":!1,"update-database-data-sources":!1,"update-database-views":!1,"query-data-sources":!1,"update-database-triggers":!1,error:!1,"create-pages":!1,"delete-pages":!1,result:!1,"update-user-integrations":!1,"edit-json":!1,"spawn-agent":!1,"mcpServer.runTool":!1,"slack.addReactionToMessage":!1,"slack.createThreadInChannel":!1,"slack.createThreadInDirectMessage":!1,"slack.findUserByEmail":!1,"slack.getSlackUrlFromMessageId":!1,"slack.getThreadsInChannelSince":!1,"slack.getUser":!1,"slack.parseSlackMessageUrlToId":!1,"slack.queryChannels":!1,"slack.removeReactionFromMessage":!1,"slack.replyInThread":!1,"slack.updateMessage":!1,"pipedream.action":!1,"toggle-user-integration-tools":!1,"github.getPullRequest":!1,"github.listPullRequests":!1,"github.parseGithubUrlToParts":!1,"github.listOrganizationRepositories":!1,"github.getUser":!1,"notion.sendNotification":!1,"codegen.run":!1,"codegen.runStatus":!1,"calendar.getEvents":!1,"files.getFileContent":!1,"files.getFileName":!1,"files.getFileUrl":!1,"zendesk.addComment":!1,"zendesk.addTicket":!1,"zendesk.getComments":!1,"zendesk.getTicket":!1,"zendesk.updateTicket":!1,"create-agent":!1,"update-agent":!1,"delete-agent":!1};function Hn(e){let{environment:t,step:n,toolResultsForStep:r,threadStore:a,spaceStore:o,clientStore:i,runningInference:s,isLastStep:l,intl:d,isMultiDatabaseMode:c,aiChatFeatureController:p}=e;const g=[...(n.previousAttemptValues??[]).flatMap(et().lH).filter((e=>"tool_use"!==e.type)),...(0,et().lH)(n.value)],f=[],h=function(e){const{threadStore:t}=e,n={};return t.getMessageStores().map((e=>{const t=e.getStep();if("agent-tool-result"!==(null==t?void 0:t.type)||!(0,Xe().gY)(t,"search"))return;const r=[];for(const n of(null===(a=t.result)||void 0===a?void 0:a.internalResults)??[]){var a;for(const e of(0,ke().uv)(n))r.push(...(n[e]??[]).flat().filter(ke().O9))}for(const i of r){const e=(0,Qe().f9)(i.key);let t;try{t=(0,Je().uf)({type:i.result.type,baseUrl:P().A.domainBaseUrl,citation:e})}catch(o){}if(t&&(n[t]=i.result,"slack"===i.result.type))for(const r of i.result.messages){const e=(0,Qe().f9)(r.messageId);if("slack"!==(null==e?void 0:e.type))continue;const t=(0,Je().mQ)({...e});n[t]={...i.result,...r,id:r.messageId}}}})),n}({threadStore:a}),m=function(e){let{chunks:t,toolResultsForStep:n}=e;const r=[];for(let a=0;a<t.length;a++){const e=t[a];if("thinking"===e.type){e.content.trim()&&r.push({type:"thinking",content:e.content.trim(),isBusy:a===t.length-1})}else if("text"===e.type){e.content.trim()&&r.push({type:"text",content:e.content.trim()})}else if("tool_use"===e.type){const t=n.find((t=>t.toolCallId===e.id));if(null!=t&&t.insufficientPermissions)continue;(0,Ge().U3)(e.name)&&(0,Vt().vW)(e.name)?r.push({type:"tool_use_full",toolUseName:e.name,result:t,id:e.id}):r.push({type:"tool_use_minimal",toolUse:e,result:t,id:e.id})}}return r}({chunks:g,toolResultsForStep:r}),v=m.findLast((e=>"tool_use_full"===e.type)),x=[];for(const[y,S]of m.entries())if("thinking"===S.type){const{isBusy:e,content:t}=S;f.push({type:"agent-inference-step-item",key:`thinking-${y}`,iconComponent:e?(0,u.jsx)(Tt().A,{isTriColored:!0}):null,stepComponent:(0,u.jsx)(Gt,{isBusy:e,markdown:t,durationMs:void 0}),isFinished:!e,step:n,itemType:"thinking",thinkingContent:t})}else if("text"===S.type){const{content:e}=S;(0,Ze().I)(e).split(/\n\n\n+/).forEach(((e,t)=>{const r=e.trim();r&&f.push({type:"agent-inference-step-item",key:`text-${y}-${t}`,iconComponent:null,stepComponent:(0,u.jsx)(Ht().uH,{content:r,step:n,threadStore:a,searchContext:h,aiChatFeatureController:p}),isFinished:!0,step:n,itemType:"chat"})}))}else if("tool_use_minimal"===S.type){const{toolUse:e,result:r}=S,u=Kn({environment:t,toolUse:e,step:n,result:r,spaceStore:o,clientStore:i,threadStore:a,isLastStep:l,runningInference:s,index:y,intl:d,isMultiDatabaseMode:c});f.push(...u)}else if("tool_use_full"===S.type){const{toolUseName:e,result:t}=S;if(!s&&t&&!te(t)&&!ne(t))continue;t&&ne(t)&&x.push(t.id),f.push({type:"agent-inference-step-item",key:`tool-use-full-${y}`,iconComponent:null,stepComponent:(0,u.jsx)(En,{threadStore:a,toolName:e,resultStep:t,step:n,isBusy:s&&(!t||!te(t)),resultStepIdsToConfirm:S.id===(null==v?void 0:v.id)?x:[]}),isFinished:!0,step:n,results:t?[t]:[]})}return f}function Kn(e){const{environment:t,toolUse:n,step:r,result:a,spaceStore:o,runningInference:i,index:s,intl:l,isMultiDatabaseMode:d}=e;if((0,Ge().U3)(n.name)||a&&(0,Ge().og)(a.toolType)){const e=(0,Ge().U3)(n.name)?n.name:a&&(0,Ge().og)(a.toolType)?a.toolType:n.name,p=Boolean(i&&(!a||!te(a))||a&&ne(a)),g=(0,Vt().PA)(a),{blockStores:f}=function(e,t){const n=t.filter((e=>e.table===Ie().ev)),r=n.map((t=>De().Bv.createChildStore(e,t))),a=[],o=t.filter((e=>e.table===It().Vl));for(const c of o){const t=De().md.createChildStore(e,c);a.push(t);const n=t.getParentBlockStore();n&&r.push(n)}const i=t.filter((e=>e.table===I().oo)),s=i.map((t=>De().LU.createChildStore(e,t))),l=t.filter((e=>e.table===Ct().yM)),d=l.map((t=>De().Px.createChildStore(e,t)));return{blockStores:r,collectionStores:a,userStores:s,workflowModuleStores:d}}(o,g),h=Fn({intl:l,toolName:e,loading:p,numResults:f.length,toolResultStep:a,isMultiDatabaseMode:d});let m;var c;if(a&&(0,Xe().gY)(a,"query-data-sources"))null!==(c=a.result)&&void 0!==c&&null!==(c=c.collectionIds)&&void 0!==c&&c.length&&1===f.length&&(m=(0,u.jsx)(Pn,{store:f[0]}));else 1===f.length&&(m=(0,u.jsx)(Pn,{store:f[0]}));const v=(0,u.jsx)(Un,{label:h,right:m,isBusy:p,state:a?ae(a):void 0}),x=function(e){var t;const{environment:n,spaceStore:r,result:a}=e;if(!a)return;switch(a.toolType){case"search":if(!(0,Xe().gY)(a,"search"))return;return function(e){let{environment:t,spaceStore:n,resultStep:r}=e;if(!r.result||!te(r))return;const{webResults:a,userResults:o,internalResults:i}=r.result,s=[],l=(0,w().XQ)({},...i??[]),d=[],c=(null==a?void 0:a.flat().map((e=>({key:e.id,result:e}))))??[];d.push(...c);for(const u of(0,ke().uv)(l)){const e=l[u];e&&d.push(...e)}const p=(0,w().hS)(d,"key").map((e=>e.result)).sort(((e,t)=>(t.score??0)-(e.score??0)));s.push(...p.map((e=>{switch(e.type){case"webpage":return function(e){var t;const n=null===(t=(0,Qe().OU)(e.id))||void 0===t?void 0:t.url;if(!n)return;return{key:`web_result:${e.id}`,render:t=>{const r=e.favicon?[e.favicon]:[];try{r.push(`https://www.google.com/s2/favicons?domain=${new URL(n).hostname}&sz=64`)}catch(a){}return(0,u.jsx)(At().A,{...t,title:(0,u.jsx)(Gn,{children:e.title}),href:n,caption:(0,u.jsx)(Yn,{caption:n}),icon:(0,u.jsx)(Zn,{urls:r,alt:e.title}),external:!0})},action:()=>{}}}(e);case"slack":return function(e){const t=(0,Qe().f9)(e.id);if(!t||t.type!==e.type)return;return{key:`${e.type}:${e.id}`,render:n=>(0,u.jsx)(At().A,{...n,title:(0,u.jsx)(Qn,{highlight:e.highlight}),caption:(0,u.jsx)(Yn,{caption:`#${e.title}`}),href:(0,Je().mQ)(t),icon:(0,u.jsx)(Dt().Q,{iconGroup:tt().G[e.type],variantName:"default",style:{width:20,height:20}}),external:!0}),action:()=>{}}}(e);case"block":case"page":const r=(0,wt().uj)(e.id)?e.id:(0,kt().AF)({prefix:"pageOrCollectionViewBlock",id:e.id});return Wn({environment:t,spaceStore:n,blockId:r});case"google-calendar":case"jira":case"gmail":case"github":case"linear":case"outlook":case"helpdoc":case"sharepoint":case"properties":case"notion-mail":case"google-drive":case"helpdoc-section":case"microsoft-teams":return function(e){const t=(0,Qe().f9)(e.id);if(!t||t.type!==e.type)return;let n;switch(e.type){case"helpdoc-section":case"helpdoc":n=rt().s;break;default:n=tt().G[e.type]}return{key:`${e.type}:${e.id}`,render:r=>(0,u.jsx)(At().A,{...r,title:(0,u.jsx)(Qn,{highlight:e.highlight,fallbackText:e.text}),caption:(0,u.jsx)(Yn,{caption:e.title}),href:t.url,icon:(0,u.jsx)(Dt().Q,{iconGroup:n,variantName:"default",style:{width:20,height:20}}),external:!0}),action:()=>{}}}(e);default:(0,ke().HB)(e)}})).filter(ke().O9));for(const u of(null==o?void 0:o.flat())??[]){const e=qn({spaceStore:n,userId:(0,kt().AF)({prefix:"user",id:u.id})});e&&s.push(e)}return[{key:"search-tool-results",render:e=>(0,u.jsx)(Ut().A,{...e}),items:s.length?s:[{key:"no-results",render:()=>(0,u.jsx)(Bt().Ay,{title:(0,u.jsx)(k().sA,{id:"agent.searchToolResults.noResults",defaultMessage:"No results"})}),action:()=>{}}]}]}({environment:n,spaceStore:r,resultStep:a});case"query-data-sources":if(!(0,Xe().gY)(a,"query-data-sources"))return;const e=null===(t=a.result)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.map((e=>function(e){if("object"!=typeof e||!e)return;if("id"in e&&"string"==typeof e.id&&(0,wt().uj)(e.id))return e.id;if("url"in e&&"string"==typeof e.url){const t=(0,bt().bn)(e.url);return(0,wt().uj)(t)?t:(0,wt().ZA)(t)}return}(e))).map((e=>e?Wn({environment:n,spaceStore:r,blockId:e}):void 0)).filter(ke().O9);if(null==e||!e.length)return;return[{key:`${a.id}-results`,render:e=>(0,u.jsx)(Ut().A,{...e}),items:e}];case"result":if(!(0,Xe().gY)(a,"result"))return;return function(e){let{result:t}=e;if(!t.result)return[];const{success:n,message:r}=t.result,a=[];return a.push({key:"result-status",render:e=>(0,u.jsx)(Bt().Ay,{...e,title:"Status: "+(n?"Success":"Failed"),caption:(0,u.jsx)(Ht().hu,{markdown:r||""}),icon:n?(0,ot().checkmarkCircleFillIcon)({width:20,height:20}):(0,St().Y)({width:20,height:20})}),action:()=>{}}),[{key:"result",render:e=>(0,u.jsx)(Ut().A,{...e}),items:a}]}({result:a});case"view":case"view-database-files":case"create-database":case"update-database":case"update-database-data-sources":case"update-database-views":case"update-database-triggers":case"error":case"create-pages":case"update-page":case"delete-pages":case"create-agent":case"update-agent":case"delete-agent":case"toggle-user-integration-tools":case"update-user-integrations":case"edit-json":case"spawn-agent":case"mcpServer.runTool":case"slack.addReactionToMessage":case"slack.createThreadInChannel":case"slack.createThreadInDirectMessage":case"slack.findUserByEmail":case"slack.getSlackUrlFromMessageId":case"slack.getThreadsInChannelSince":case"slack.getUser":case"slack.parseSlackMessageUrlToId":case"slack.queryChannels":case"slack.removeReactionFromMessage":case"slack.replyInThread":case"slack.updateMessage":case"pipedream.action":case"github.getPullRequest":case"github.getUser":case"github.listOrganizationRepositories":case"github.listPullRequests":case"github.parseGithubUrlToParts":case"notion.sendNotification":case"calendar.getEvents":case"files.getFileContent":case"files.getFileName":case"files.getFileUrl":case"zendesk.addComment":case"zendesk.addTicket":case"zendesk.getComments":case"zendesk.getTicket":case"zendesk.updateTicket":return;case"codegen.run":if(!(0,Xe().gY)(a,"codegen.run"))return;return function(e){const{resultStep:t}=e;if(!t.result)return;const n=t.result,r=n.id,a=n.status,o=n.webUrl,i=n.createdAt,s=[];s.push({key:`codegen-run-status-${r}`,render:e=>(0,u.jsx)(Bt().Ay,{...e,title:`Status: ${a}`,caption:`Run ID: ${r} • Created: ${i}`,icon:(0,lt().Z)({width:20,height:20})}),action:()=>{}}),o&&s.push({key:`codegen-run-url-${r}`,render:e=>(0,u.jsx)(At().A,{...e,title:"View Codegen Run",caption:o.toString(),href:o.toString(),icon:(0,ht().w)({width:20,height:20}),external:!0}),action:()=>{}});return[{key:`codegen-run-${r}`,render:e=>(0,u.jsx)(Ut().A,{...e}),items:s}]}({environment:n,spaceStore:r,resultStep:a});case"codegen.runStatus":if(!(0,Xe().gY)(a,"codegen.runStatus"))return;return function(e){const{resultStep:t}=e;if(!t.result)return;const n=t.result,r=n.id,a=n.status,o=n.webUrl,i=n.createdAt,s=[];s.push({key:`codegen-run-status-${r}`,render:e=>(0,u.jsx)(Bt().Ay,{...e,title:`Status: ${a}`,caption:`Run ID: ${r} • Created: ${i}`,icon:(0,lt().Z)({width:20,height:20})}),action:()=>{}}),o&&s.push({key:`codegen-run-status-url-${r}`,render:e=>(0,u.jsx)(At().A,{...e,title:"View Codegen Run",caption:o.toString(),href:o.toString(),icon:(0,ht().w)({width:20,height:20}),external:!0}),action:()=>{}});return[{key:`codegen-run-status-${r}`,render:e=>(0,u.jsx)(Ut().A,{...e}),items:s}]}({environment:n,spaceStore:r,resultStep:a});default:(0,ke().HB)(a.toolType)}}({environment:t,spaceStore:o,result:a}),y=a?function(e){switch(e.state){case"confirmation:requested":return"requested";case"confirmation:confirmed":return"confirmed";case"confirmation:rejected":return"rejected";default:return e.userConfirmation}}(a):void 0;return[{type:"agent-inference-step-item",key:`tool-use-${s}-${n.id}`,iconComponent:p&&"requested"!==y?(0,u.jsx)(Tt().A,{isTriColored:!0}):(0,u.jsx)(Jn,{toolName:e,toolResult:a}),stepComponent:(0,u.jsx)(On,{label:v,isBusy:p,sections:x}),isFinished:!p,step:r,results:a?[a]:[],itemType:e}]}return[]}function Wn(e){let{environment:t,spaceStore:n,blockId:r}=e;const a=De().Bv.createChildStore(n,{id:r,table:Ie().ev});if(!a)return;const o=(0,Et().Ef)({environment:t,updates:{store:a}});return{key:`block:${r}`,render:e=>(0,u.jsx)(Xn,{store:a,...e}),action:()=>{jt().oo({environment:t,url:o})}}}function qn(e){let{spaceStore:t,userId:n}=e;const r=De().LU.createChildStore(t,{id:n,table:I().oo}).getModel();if(r)return{key:`user:${n}`,render:e=>(0,u.jsx)(Pt().A,{...e,actor:(0,Ye().D3)(r)}),action:()=>{}}}function Yn(e){const{caption:t}=e,n=(0,i().IS)((e=>({caption:{color:e.text.tertiary,fontWeight:ge().Wy.regular}})),[]);return(0,u.jsx)("span",{style:n.caption,children:t})}function Xn(e){const{store:t,...n}=e,r=(0,i().IS)((e=>({title:{color:e.text.secondary},caption:{color:e.text.tertiary}})),[]);return(0,u.jsx)(Ot().A,{store:t,...n,titleStyle:r.title,captionStyle:r.caption})}function Gn(e){const{children:t}=e,n=(0,i().IS)((e=>({text:{color:e.text.secondary,fontWeight:ge().Wy.regular}})),[]);return(0,u.jsx)("span",{style:n.text,children:t})}function Qn(e){const{highlight:t,fallbackText:n}=e,r=(0,i().IS)((e=>({textHighlight:{color:e.text.primary,fontWeight:ge().Wy.medium}})),[]),a=(null==t?void 0:t.text)??n??"",o={tokenize:()=>(0,Ft().nB)((0,Ft().Ay)(a)),style:r.textHighlight};return(0,u.jsx)(Gn,{children:(0,u.jsx)(Mt().A,{text:a,highlighter:o})})}function Zn(e){const{urls:t,alt:n}=e,[a,o]=(0,r.useState)(0),[i,s]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=new Image;e.src=t[a],e.onload=()=>{s(!0)},e.onerror=()=>{t.length>a+1?o((e=>e+1)):(d(!0),s(!0))}}),[t,a]),(0,u.jsx)(We().N,{children:i?l?(0,ht().w)({width:20,height:20}):(0,u.jsx)(qe().P.img,{src:t[a],alt:n,style:{borderRadius:4,width:20,height:20},initial:{opacity:0},animate:{opacity:1},transition:{duration:.5}}):(0,u.jsx)(Rt().A,{size:"sm"})})}function Jn(e){const{toolName:t,toolResult:n}=e,r=(0,i().IS)((e=>({icon:{fill:e.text.secondary,width:20,height:20},error:{fill:e.icon.uiRedPrimary,width:20,height:20}})),[]);if(n&&null!=n&&n.error)return ct(r.error);var a;if("search"===t)return n&&(0,Xe().gY)(n,"search")&&null!==(a=n.input)&&void 0!==a&&a.web?(0,pt().globeIcon)(r.icon):(0,mt().J)(r.icon);if("view"===t)return(0,ut().eyeIcon)(r.icon);if("view-database-files"===t)return(0,lt().Z)(r.icon);if("create-database"===t)return(0,xt().plusIcon)(r.icon);if("update-database-data-sources"===t)return(0,it().c)(r.icon);if("update-database-views"===t)return(0,gt()._)(r.icon);if("query-data-sources"===t)return(0,mt().J)(r.icon);if("update-database-triggers"===t)return(0,ft().m)(r.icon);if("error"===t)return(0,St().Y)(r.icon);if("create-pages"===t)return(0,xt().plusIcon)(r.icon);if("delete-pages"===t)return(0,yt().trashIcon)(r.icon);if("create-agent"===t)return(0,xt().plusIcon)(r.icon);if("update-agent"===t)return(0,vt().pencilLineIcon)(r.icon);if("delete-agent"===t)return(0,yt().trashIcon)(r.icon);if("update-page"===t)return(0,vt().pencilLineIcon)(r.icon);if("update-database"===t)return(0,it().c)(r.icon);if("result"===t)return(0,at().checkmarkIcon)(r.icon);if((0,Ge().og)(t))return function(e){const t=Nt(e);return _t(e).icon??$t().d.getIcon(t)}(t)(r.icon);if("update-user-integrations"===t)return(0,st().V)(r.icon);if("edit-json"===t)throw new Error("edit-json tool should not be used in the UI");return"toggle-user-integration-tools"===t?(0,st().V)(r.icon):"codegen.run"===t||"codegen.runStatus"===t?(0,lt().Z)(r.icon):"spawn-agent"===t?(0,nt().aiFaceIcon)(r.icon):void(0,ke().HB)(t)}function er(e){const{step:t}=e,[n,a]=(0,r.useState)(!1),o=(0,k().tz)(),s=(0,i().IS)((e=>({json:{whiteSpace:"pre-wrap",wordBreak:"break-word",background:e.surface.elevated,padding:12,borderRadius:6,margin:"1px 1px 6px 1px"}})),[]);return(0,u.jsx)(Fe().Q,{children:(0,u.jsx)(Xt,{isExpanded:n,onChangeExpanded:a,label:o.formatMessage({defaultMessage:"Trigger",id:"agentTranscript.triggerStep.label"}),content:(0,u.jsx)("pre",{style:s.json,children:JSON.stringify(t,null,2)})})})}n(813451);var tr=()=>n(139274),nr=()=>n(124749),rr=()=>n(616878),ar=()=>n(155792),or=()=>n(246826);function ir(e){let{transaction:t,threadStore:n,step:r,userAction:a}=e;const o=n.getSpaceId();if(!o)return;const i=De().XV.createChildStore(n,{table:ar().mS,id:r.id,spaceId:o});for(const s of i.getThreadOperationStores())or().zv({store:s,data:{userAction:a},transaction:t})}const sr=["create-database","update-database","update-database-data-sources","update-database-views","update-database-triggers","create-pages","update-page","update-page","delete-pages","create-agent","update-agent","delete-agent"];function lr(e){let{stepItems:t,userFeedbackActionsIndex:n,threadStore:a,previousStepId:s,isLastStep:l}=e;const d=(0,i().IS)((e=>({revertedText:{marginLeft:6,display:"flex",alignItems:"center"},wasThisHelpfulText:{paddingLeft:6}})),[]),c=(0,r.useMemo)((()=>t.flatMap((e=>e.results??[])).filter((e=>!re(e)&&!ne(e)&&sr.some((t=>t===e.toolName))))),[t]),p=c.at(-1),g=t.findLast((e=>e.isFinished)),f=null==g?void 0:g.results,h=null==f?void 0:f.at(-1),m=p||h||(g?g.step:void 0),v=(0,o().K8)((()=>{var e;if(a&&m)return null===(e=a.getMessageStoreById(m.id))||void 0===e||null===(e=e.getData())||void 0===e?void 0:e.inference_id}),[a,m]),{operationsToUndo:x,stepsWithOperationsToUndo:y,hasUndoneOperations:S}=(0,Vt().ji)({diffResultSteps:c,threadStore:a}),b=(0,r.useMemo)((()=>S?"reverted":x.length>0?"undo":"none"),[S,x]),I=(0,o().K8)((()=>rr().f.getState().statuses.findLastIndex((e=>"undo"===e))),[]);(0,r.useEffect)((()=>{rr().f.updateStatus({threadId:a.id,index:n,status:b,previousStepId:s})}),[n,b,a,s]);const C=c.some((e=>e.error)),w=m&&l&&v&&a,j="undo"===b&&I===n&&!C,A="reverted"===b;return w||j||A?(0,u.jsxs)(B().Y1,{direction:"horizontal",align:"center-left",children:[w&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Pe().zg,{step:m,traceId:v,feedbackType:"thumbs_up",threadStore:a,iconColor:"secondary",mode:"feedback-positive"}),(0,u.jsx)(Pe().zg,{step:m,traceId:v,feedbackType:"thumbs_down",threadStore:a,iconColor:"secondary"}),(0,u.jsx)(Ne().D,{styleName:"UISmall-12px/Regular",colorName:"secondary",customStyles:d.wasThisHelpfulText,children:(0,u.jsx)(k().sA,{id:"AgentUserFeedbackActions.wasThisHelpful",defaultMessage:"Was this chat helpful?"})})]}),(0,u.jsx)("div",{style:{flexGrow:1}}),j&&(0,u.jsx)(dr,{operationsToUndo:x,stepsWithOperationsToUndo:y}),A&&(0,u.jsx)("div",{style:d.revertedText,children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",children:(0,u.jsx)(k().sA,{id:"AgentUserFeedbackActions.changesReverted",defaultMessage:"Changes reverted"})})})]}):null}function dr(e){let{operationsToUndo:t,stepsWithOperationsToUndo:n}=e;const o=(0,i().IS)((e=>({undoIcon:{color:e.text.uiRedPrimary},undoOrCancelButton:{display:"flex",alignItems:"center",justifyContent:"center"}})),[]),[s,l]=(0,r.useState)(!1),d=(0,a().v3)(),c=(0,hn().r)(),p=(0,oe().useCurrentThreadStore)(),g=(0,nr().$)(),f=(0,r.useCallback)((()=>{const e=(0,w().mg)(t);for(const t of e)void 0===t.path&&(t.path=[]),void 0===t.args&&(t.args={});M().createAndCommit({userAction:"GroupStepRenderer.handleUndo",environment:d,canUndo:!1,isUndoTransaction:!0,perform:t=>{for(const n of e)(0,G().Hp)({transaction:t,operation:n,recordCache:null==c?void 0:c.inMemoryRecordCache,environment:d});for(const e of n)p&&ir({transaction:t,threadStore:p,step:e,userAction:"undo"});if(p&&c&&g){const e=Array.from(n).map((e=>({name:e.toolName,id:e.toolCallId}))),r=(0,J().Xw)({environment:d,spaceId:c.id,message:`The user has undone the following tools:\n${e.map((e=>`- ${e.name}${e.id?` (${e.id})`:""}`)).join("\n")}`,notificationType:"info",metadata:{action:"undo",tools:e}});(0,G().Vn)({threadStore:p,environment:d,spaceStore:c,userStore:g,addSteps:[r],transaction:t})}}})}),[c,d,p,g,t,n]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Ae().p,{size:"sm",style:o.undoOrCancelButton,onClick:()=>l(!s),children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Medium",colorName:"secondary",children:s?(0,u.jsx)(k().sA,{id:"AgentUserFeedbackActions.cancel",defaultMessage:"Cancel"}):(0,u.jsx)(k().sA,{id:"AgentUserFeedbackActions.undo",defaultMessage:"Undo"})})}),s&&(0,u.jsx)(Ae().p,{iconLeading:tr().arrowUTurnUpLeftFillSmallIcon,iconStyle:o.undoIcon,size:"sm",onClick:f,children:(0,u.jsx)(Ne().D,{styleName:"UIRegular-14px/Medium",colorName:"uiRedPrimary",children:(0,u.jsx)(k().sA,{id:"AgentUserFeedbackActions.confirmUndo",defaultMessage:"Confirm undo"})})})]})}function cr(e){const{transcript:t,spaceStore:n,threadStore:r,clientStore:i,runningInference:s,showDebugOverride:l,aiChatFeatureController:d}=e,c=(0,a().v3)(),p=(0,k().tz)(),g=(0,o().K8)((()=>i.state.showDebug),[i])||l,f=(0,_().X)("agent_multidb_creation"),h=(0,o().K8)((()=>{let e=0;const a=[],o=[];t.forEach(((l,h)=>{const m=h===t.length-1,v=t.slice(h+1).some((e=>"agent-inference"===e.type)),x=[];if("context"===l.type){const e=t.find((e=>"context"===e.type));(null==e?void 0:e.id)===l.id&&x.push({type:"context",component:(0,u.jsx)(Le().E,{step:l,displayMode:"date"},l.id)})}else if("attachment"===l.type)x.push({type:"attachment",component:(0,u.jsx)("div",{style:{display:"flex",justifyContent:"end"},children:(0,u.jsx)(je().kp,{uploadProgress:{status:"complete",fileUrl:l.fileUrl,fileName:l.fileName,contentType:l.contentType},permissionRecordOverride:{table:b().To,id:r.id,spaceId:r.getSpaceId()}})})});else if("user"===l.type){var y;if(a.some((e=>e.isFinished)))x.push({type:"user-feedback-actions",component:(0,u.jsx)(lr,{stepItems:[...a],userFeedbackActionsIndex:e,threadStore:r,previousStepId:null===(y=a.at(-1))||void 0===y?void 0:y.step.id,isLastStep:m},`user-feedback-actions-${e}`)}),e++;a.length=0,x.push({type:"user",component:(0,u.jsx)(He,{item:{type:"agent-inference-step-item",key:`user-${l.id}`,iconComponent:null,stepComponent:(0,u.jsx)($e().IT,{clientStore:i,threadStore:r,runningInference:s,step:l}),isFinished:!0,step:l}},l.id)}),!v&&s&&x.push({type:"agent-chat-item",component:(0,u.jsx)(ze,{content:(0,u.jsx)(Ee().c,{style:{marginTop:4},randomThinkingSeed:l.id})},`agent-chat-item-thinking-${l.id}`)})}else if("agent-debug-error"===l.type)x.push({type:"agent-debug-error",component:(0,u.jsx)(gr,{step:l},l.id)});else if("eval-result"===l.type)x.push({type:"eval-result",component:(0,u.jsx)(fr,{step:l},l.id)});else if("error"===l.type)x.push({type:"error",component:(0,u.jsx)(pr,{step:l,isCurrentStep:h===t.length-1,runningInference:s,threadStore:r},l.id)});else if("user-specified-context"===l.type){var S,I;const e=t.filter((e=>"user-specified-context"===e.type)),r=e.findIndex((e=>e.id===l.id)),a=e[r-1];var C;if(0===r||-1!==r&&a&&!(0,w().n4)(null===(S=a.value)||void 0===S?void 0:S.pointers,null===(I=e[r].value)||void 0===I?void 0:I.pointers))x.push({type:"user-specified-context",component:(0,u.jsx)(ur,{spaceStore:n,pointers:(null===(C=l.value)||void 0===C?void 0:C.pointers)??[]},`${l.id}-${h}`)})}else if("agent-inference"===l.type){const e=t.filter((e=>"agent-tool-result"===e.type&&e.agentStepId===l.id)),o=Hn({environment:c,step:l,toolResultsForStep:e,spaceStore:n,threadStore:r,clientStore:i,runningInference:s,isLastStep:m,intl:p,isMultiDatabaseMode:f,aiChatFeatureController:d}).filter(ke().O9);a.push(...o),x.push(...o.map(((e,t)=>({type:"agent-inference",component:(0,u.jsx)(Ve,{item:e,threadStore:r,isLastStep:m},`${e.step.id}-${t}`)}))));const g=e.length>0,h=e.every((e=>te(e))),y=e.some((e=>ne(e)));g&&h&&!v&&s&&!y&&x.push({type:"agent-chat-item",component:(0,u.jsx)(ze,{content:(0,u.jsx)(Ee().c,{style:{marginTop:4},randomThinkingSeed:l.id})},`agent-chat-item-thinking-after-tools-${l.id}`)})}else"agent-integration"===l.type&&g?x.push({type:"agent-integration",component:null}):"agent-trigger"===l.type?x.push({type:"agent-trigger",component:(0,u.jsx)(er,{step:l},l.id)}):g&&x.push({type:l.type,component:null});g?x.forEach(((e,t)=>{o.push({type:e.type,component:(0,u.jsx)(Pe().uQ,{step:l,threadStore:r,clientStore:i,children:e.component},`${l.id}-${t}-debug`)})})):o.push(...x)}));var l;a.some((e=>e.isFinished))&&!s&&(o.push({type:"user-feedback-actions",component:(0,u.jsx)(lr,{stepItems:[...a],userFeedbackActionsIndex:e,threadStore:r,previousStepId:null===(l=a.at(-1))||void 0===l?void 0:l.step.id,isLastStep:!0},`user-feedback-actions-${e}`)}),e++);return o.map((e=>e.component))}),[t,s,g,r,i,n,c,p,f,d]);return(0,u.jsx)(Be().A,{store:r,render:()=>h})}function ur(e){const t=(0,a().v3)(),n=(0,k().tz)(),{spaceStore:r,pointers:s}=e,d=(0,i().IS)((e=>({container:{display:"flex",flexWrap:"wrap",justifyContent:"end",gap:"2px 4px"},blockContainer:{color:e.text.secondary,display:"flex",maxWidth:"50%",alignItems:"center",gap:5,fontSize:ge().J.UISmall.desktop,padding:"4px 6px",borderRadius:4},blockContainerHover:{background:e.tint.regular}})),[]),c=(0,o().K8)((()=>(0,w().oE)(s.map((e=>{if(e.table===Ie().ev){const n=De().Bv.createChildStore(r,e);return(0,u.jsxs)(Ae().p,{onClick:()=>{we().Y({store:n,environment:t,pageVisitSource:l().y8.MentionInPage})},style:d.blockContainer,hoveredStyle:d.blockContainerHover,size:"sm",children:[(0,u.jsx)(Me().B6,{disabled:!0,icon:n.getIcon(),isEmptyPage:!1,size:14,iconRecordCategory:(0,Me().Te)(n)}),(0,u.jsx)(Te().A,{store:n})]},e.id)}{const t=De().LU.createChildStore(r,e),a=(0,Ce().c6)(n,t.getModel());return(0,u.jsxs)(Ae().p,{style:d.blockContainer,hoveredStyle:d.blockContainerHover,size:"sm",children:[(0,u.jsx)(Re().A,{userStore:t,size:14}),(0,u.jsx)("span",{children:a})]},e.id)}})))),[t,n,s,r,d.blockContainer,d.blockContainerHover]);return 0===s.length?null:(0,u.jsx)("div",{style:d.container,children:c})}function pr(e){const{step:t,threadStore:n,isCurrentStep:r,runningInference:a}=e;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Pe().ze,{step:t,threadStore:n,withFeedbackActions:!0}),r&&!a&&(0,u.jsx)(Pe().gR,{step:t,threadStore:n,label:"Retry",disabled:a})]})}function gr(e){const{step:t}=e,n=(0,i().IS)((e=>({container:{padding:8,marginBottom:20},icon:{width:16,height:16,fill:e.errorText},codeBlock:{padding:12,borderRadius:8,backgroundColor:e.codeBlockBackground}})),[]),a=(0,r.useMemo)((()=>JSON.stringify(t,null,2)),[t]),o=(0,w().oE)([t.fromInferenceContextType?`prompt=${t.fromInferenceContextType}`:void 0,t.fromToolName?`tool=${t.fromToolName}`:void 0]).join(", ");return(0,u.jsx)(Fe().Q,{style:n.container,children:(0,u.jsx)(Ue().b,{label:`Error ${t.errorType}: ${o}`.trim(),icon:be().f,iconStyle:n.icon,children:(0,u.jsx)("div",{style:n.codeBlock,children:(0,u.jsx)(Oe().O,{value:a,language:"json"})})})})}function fr(e){const{step:t}=e,{evalResult:n,braintrustInfo:r,evaluatedAt:a}=t;return(0,u.jsxs)("div",{style:{backgroundColor:"rgba(0, 150, 255, 0.1)",border:"1px solid rgba(0, 150, 255, 0.3)",borderRadius:8,padding:12,margin:"8px 0",fontSize:12},children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#0096ff",marginBottom:8},children:"📊 Evaluation Results"}),r.project&&(0,u.jsxs)("div",{style:{marginBottom:6,color:"#666"},children:[(0,u.jsx)("strong",{children:"Project:"})," ",r.project,(0,u.jsx)("br",{}),(0,u.jsx)("strong",{children:"Dataset:"})," ",r.dataset,(0,u.jsx)("br",{}),(0,u.jsx)("strong",{children:"ID:"})," ",r.originalInferenceId]}),Object.keys(n.scores).length>0&&(0,u.jsxs)("div",{style:{marginBottom:6},children:[(0,u.jsx)("strong",{children:"Scores:"}),(0,u.jsx)("div",{style:{marginLeft:12,marginTop:4},children:Object.entries(n.scores).map((e=>{let[t,n]=e;return(0,u.jsxs)("div",{style:{marginBottom:2},children:[t,": ",(0,u.jsx)("span",{style:{fontWeight:"bold"},children:n.toFixed(3)})]},t)}))})]}),Object.keys(n.metrics).length>0&&(0,u.jsxs)("div",{style:{marginBottom:6},children:[(0,u.jsx)("strong",{children:"Metrics:"}),(0,u.jsx)("div",{style:{marginLeft:12,marginTop:4},children:Object.entries(n.metrics).map((e=>{let[t,n]=e;return(0,u.jsxs)("div",{style:{marginBottom:2},children:[t,": ",n]},t)}))})]}),(0,u.jsxs)("div",{style:{fontSize:10,color:"#999",marginTop:8},children:["Evaluated at: ",new Date(a).toLocaleString()]})]})}function hr(e){const{aiChatFeature:t,threadStore:n,config:s,onThreadChange:l,clientStore:c,transcript:p,parentStore:g}=e,[f,h]=(0,r.useState)(n),m=(0,o().K8)((()=>(null==f?void 0:f.getParentTable())===b().To),[f]),[v,x]=(0,r.useState)(void 0);(0,r.useEffect)((()=>{h(n)}),[n]);const S=(0,Q().K)(t),k=(0,a().v3)(),A=(0,_().X)("agent_integrations"),D=(0,_().X)("agent-suggested-actions"),O=(0,o().K8)((()=>c.state.showDebug),[c]),U=(0,o().K8)(le,[]),{store:P,setValue:F}=(0,$().AI)({initialValue:U}),E=(0,r.useMemo)((()=>(0,w().sg)(de,500)),[]);(0,r.useEffect)((()=>()=>{E.cancel()}),[E]);const L=(0,r.useRef)(null),V=(0,r.useRef)(0),[K,te]=(0,r.useState)(!0),[ne,ae]=(0,r.useState)(!0),se=S.isInSidebarMode||Boolean(f),ge=(0,o().K8)((()=>{if(!f)return;const e=f.getTranscript().reverse().find((e=>"config"===e.type));return null==e?void 0:e.value.type}),[f]),fe=(0,o().K8)((()=>(0,Y().re)()),[]),he=(0,i().IS)((e=>({columnContainer:{minHeight:0,...!se&&{minHeight:void 0}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",...!se&&{justifyContent:"center",minHeight:void 0}},contentWrapper:{flex:1,scrollbarGutter:"stable",overflowY:"auto",position:"relative",...!se&&{flex:"0 1 auto"}},contentContainer:{margin:"0 auto",width:"100%",maxWidth:S.chatInputWidth,padding:16,marginLeft:"auto"},transcript:{display:"flex",flexDirection:"column",fontSize:S.chonkyStyles?16:14,marginBottom:12,gap:8},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:"agent"===t?e.surface.wash:"agent_full_page"===t?e.surface.elevated:void 0,padding:S.chonkyStyles?"0 0 24px":"0 0 12px",...!se&&{marginTop:24}},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:6,borderRadius:20,backgroundColor:"dark"===e.mode?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===e.mode?`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:S.chatInputWidth,padding:S.chatInputPadding,marginLeft:"auto"},gradientMask:{width:"100%",height:S.isAgentChat?32:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(248, 248, 247, 0), ${"agent_full_page"===t?e.surface.elevated:e.surface.wash})`},chevronDownIcon:{width:20,height:20,fill:"dark"===e.mode?"#000":e.white,transform:"translateY(1px)"},overflowContainer:{overflowY:"auto",...!se&&{overflowY:void 0}}})),[se,S,t]),me=(0,r.useCallback)((()=>{const e=L.current;if(!e)return;const t=e.scrollTop,n=t-V.current<0,r=e.scrollHeight-e.scrollTop-e.clientHeight<50;V.current=t,te(r),n&&!r&&ne&&ae(!1),"search"!==ge&&r&&!ne&&ae(!0)}),[ne,ge]);(0,r.useEffect)((()=>{const e=L.current;if(!e)return;e.addEventListener("scroll",me);const t=new MutationObserver((()=>{ne&&(e.scrollTop=e.scrollHeight),setTimeout(me,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(me,100),()=>{e.removeEventListener("scroll",me),t.disconnect()}}),[me,ne]),(0,r.useEffect)((()=>{const e=L.current;if(!e)return;if("search"===ge)return void ae(!1);const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,ae(!0)}),100);return()=>clearTimeout(t)}),[ge]);const ve=(0,r.useCallback)((()=>{const e=L.current;e&&N().VG({element:e,environment:k,options:{top:e.scrollHeight,behavior:"smooth"}})}),[k]),xe=(0,r.useCallback)((()=>{ve(),ae(!0)}),[ve]),Se=(0,o().O$)(H().AppStoreMainEditorCurrentBlockStore),be=(0,pe().q)({threadStore:f,clientAiChatStore:c,setThreadStore:h,aiChatFeatureController:S,config:s});!function(e){const{environment:t,clientStore:n}=e,a=(0,oe().useCurrentThreadStore)(),i=(0,o().K8)((()=>(0,Z().A3)({threadStore:a,clientStore:n}).steps.filter((e=>"agent-tool-result"===e.type))),[a,n]),s=(0,G().Cx)(),l=(0,o().K8)((()=>s?i.filter((e=>!function(e){return"confirmation:confirmed"===e.state||"confirmed"===e.userConfirmation}(e)&&!re(e)&&"delete-pages"!==e.toolName&&!e.error)):[]),[i,s]);(0,r.useEffect)((()=>{const e=(0,ie().L2)(t);0!==l.length?e.enter({environment:t,steps:l,transactionActions:M(),applyOperation:(n,r)=>{(0,G().Hp)({environment:t,operation:r,recordCache:e.getInMemoryRecordCache(),transaction:n})}}):e.exit(t)}),[t,l]),(0,r.useEffect)((()=>()=>{(0,ie().L2)(t).exit(t)}),[t])}({environment:k,clientStore:c});const Ie=(0,o().O$)(J().bX),Ce=(0,ee().K)(),ke=(0,r.useCallback)((e=>{var t;const{prompt:n,config:r}=e;if(c.setState({...c.state,userSelectedConfig:!0}),!n||0===n.length)return;if(!Ie)throw new Error("No inference context");const{spaceStore:a,userStore:o,spaceViewStore:i}=Ie;if(!g)throw new Error("No parent store");const s=(null===(t=T()._.persistTemporaryThreadStoreIfExists())||void 0===t?void 0:t.threadStore)??f;F(void 0),E.cancel(),ce();const d=(0,J().Kf)({environment:k,spaceStore:a,userStore:o,value:n}),u=null==s?void 0:s.getTranscript().findLast((e=>"context"===e.type)),p=(null==s?void 0:s.id)||(0,z().Z1)({environment:k,table:b().To,spaceId:a.id}),h=[],m=c.getOrCreateClientAIChatThreadStore(p),I=m.getStagedMentionPointers(),C=(0,J().BX)({environment:k,spaceId:a.id,pointers:I});C&&h.push(C);const w=null==m?void 0:m.getAndClearStagedAssistantAttachmentSteps();if(w&&h.push(...w),!s||(0,Z().av)(s)){const e=function(e){const{config:t,hasAgentIntegrationsFeatureFlag:n}=e,r="workflow"===t.type&&t.isCustomAgent;return n&&!r}({config:r,hasAgentIntegrationsFeatureFlag:A})?function(e){const{agentChatIntegrations:t,environment:n,spaceStore:r,spaceViewStore:a}=e,o=y().RecordMap.create(),i=a.getModel();if(!i)throw new Error("No space view model");o.addModel(i);const s=[];for(const l of t){const e=l.workflowModuleStore.getModel();e&&(o.addModel(e),s.push(e.pointer))}return(0,J().yQ)({activeRecordPointers:[],environment:n,inactiveRecordPointers:s,recordMap:o.getSize()>0?o:void 0,spaceStore:r})}({agentChatIntegrations:Ce,environment:k,spaceStore:a,spaceViewStore:i}):void 0,t=(0,J().Xd)({environment:k,inferenceContext:Ie,config:r,addSteps:[e,...h,d],surface:S.contextStepSurface});if(s)(0,W().addStepsToExistingThreadAndRun)({environment:k,spaceStore:a,userStore:o,threadStore:s,addSteps:t,waitForServerCommit:!0}),l(s);else{const e=(0,W().addTranscriptToNewThreadAndRun)({environment:k,spaceStore:a,transcript:t});l(e)}v&&v.length>0&&(m.updateMentionedStagedData(mr({inputMentionPointers:v,stagedMentionPointers:I})),x([]))}else{(0,G().kh)({threadStore:f,config:r,environment:k});const e=[];((null==u?void 0:u.value.collectionViewBlockId)??(null==u?void 0:u.value.blockId))!==(null==Se?void 0:Se.id)&&e.push((0,J().WM)({environment:k,inferenceContext:Ie,surface:S.contextStepSurface})),w&&e.push(...w),C&&e.push(C),e.push(d),(0,W().addStepsToExistingThreadAndRun)({environment:k,spaceStore:a,userStore:o,threadStore:s,addSteps:e,waitForServerCommit:!0}),v&&v.length>0&&(m.updateMentionedStagedData(mr({inputMentionPointers:v,stagedMentionPointers:I})),x([])),ve()}}),[c,Ie,g,f,F,k,null==Se?void 0:Se.id,ve,Ce,S.contextStepSurface,l,A,v,E]),we=(0,r.useCallback)((e=>{if(!e||!f)return E.cancel(),void ce();E(e);const t=[...C().moK(e),...C().Fbh(e).map((e=>({table:I().oo,id:e})))];if(void 0===v&&0===t.length)return;const n=c.getOrCreateClientAIChatThreadStore(f.id),r=n.getStagedMentionPointers(),a=v?mr({inputMentionPointers:v,stagedMentionPointers:r}):r;n.updateMentionedStagedData([...a,...t]),x(t)}),[c,f,v,E]),je=(0,o().K8)((()=>!e.config&&!f),[e.config,f]),Ae=(0,o().K8)((()=>{var e;const t=0===C().AhH(P.getValue()||[]),n=!f||(0,Z().av)(f),r=f?c.getOrCreateClientAIChatThreadStore(f.id):void 0,a=Boolean(null==r||null===(e=r.state.stagedData)||void 0===e||null===(e=e.attachmentStagedData)||void 0===e||null===(e=e.stagedInferenceTranscriptSteps)||void 0===e?void 0:e.length);return D&&t&&n&&!a}),[D,P,f,c]),Me=(0,o().K8)((()=>(0,Z().Ft)({threadStore:f,clientStore:c})),[f,c]),Te=(0,o().K8)((()=>(0,Y().Ke)()),[]),Re=(0,o().K8)((()=>s??(0,q().K)({store:H().default.state.mainEditorCurrentBlockStore})),[s]),Be=(0,r.useCallback)((e=>{ke({prompt:e,config:Re})}),[ke,Re]),De=fe?(0,u.jsx)("div",{children:(0,u.jsx)(j().ev,{store:P,onSubmit:ke,onChange:we,clientStore:c,threadStore:f,showInitialModePicker:je,aiChatFeatureController:S,config:s,loadAttachmentData:be})}):(0,u.jsx)(j().ev,{store:P,onSubmit:ke,onChange:we,clientStore:c,threadStore:f,showInitialModePicker:je,aiChatFeatureController:S,config:Re,loadAttachmentData:be});return(0,u.jsxs)(u.Fragment,{children:[S.supportsChatHeader&&(0,u.jsx)(vr,{aiChatFeatureController:S,threadStore:f,clientStore:c,onThreadChange:l,parentStore:g}),(0,u.jsx)(B().Y1,{height:"fill",direction:"vertical",children:(0,u.jsxs)(B().Y1,{height:"fill",direction:"horizontal",style:he.columnContainer,children:[S.supportsCollapsiblePanel&&Te?(0,u.jsx)(R().z,{isOpen:O,width:{size:515,speed:"animate"},isResizable:!0,anchorToSide:"left",minSize:300,maxSize:900,children:(0,u.jsx)(ue().m,{clientStore:c,threadStore:f})}):null,(0,u.jsx)(B().Y1,{height:"fill",direction:"vertical",style:he.overflowContainer,children:(0,u.jsxs)("div",{style:he.chatColumn,children:[(0,u.jsx)("div",{style:he.contentWrapper,ref:L,children:(0,u.jsxs)("div",{style:he.contentContainer,children:[(0,u.jsx)(jr,{threadStore:f,clientStore:c,environment:k,children:f&&(0,u.jsx)("div",{style:he.transcript,children:(0,u.jsx)(cr,{transcript:p||[],spaceStore:g,threadStore:f,clientStore:c,runningInference:Me,showDebugOverride:O,aiChatFeatureController:S})})}),(0,u.jsx)(X().q,{clientStore:c,threadStore:f,userStore:void 0})]})}),(0,u.jsxs)("div",{style:he.inputWrapper,children:[(0,u.jsx)("button",{onClick:xe,style:{...he.scrollToBottomButton,...!K&&he.scrollToBottomButtonVisible},children:(0,d().arrowChevronSingleDownFillIcon)(he.chevronDownIcon)}),"agent_full_page"===t||"agent"===t?(0,u.jsx)("div",{style:he.gradientMask}):null,!m&&(0,u.jsxs)("div",{style:he.inputContainer,children:[Ae&&(0,u.jsx)(ye,{onSuggestionClick:Be}),De]})]})]})})]})})]})}function mr(e){let{inputMentionPointers:t,stagedMentionPointers:n}=e;const r=t.map((e=>S().L3.toKey(e)));return n.filter((e=>!r.includes(S().L3.toKey(e))))}function vr(e){const{aiChatFeatureController:t,onThreadChange:n,clientStore:i,threadStore:s,parentStore:l}=e,d=(0,a().v3)(),c=(0,r.useContext)(F().eh),{isElectronWindows:p}=(0,a().Y0)(),g=(0,o().O$)(K().b),f=(0,r.useCallback)((e=>{(0,G().Wq)({environment:d,clientStore:i}),n(e)}),[i,n,d]),h=(0,o().K8)((()=>!(0,V().KB)(d)),[d]),m=(0,o().K8)((()=>(null==s?void 0:s.getParentTable())===b().To),[s]),v=d.device.isElectron&&!g,x=s&&m?(0,u.jsx)(xr,{threadStore:s}):(0,u.jsx)(Se().n,{threadStore:s,onThreadChange:f,parentStore:l});return(0,u.jsx)(B().Y1,{direction:"vertical",width:"fill",children:(0,u.jsx)(B().Y1,{className:v?L().sbV:void 0,direction:"vertical",padding:"6px 12px 8px 8px",width:"fill",gap:4,children:(0,u.jsxs)(B().Y1,{direction:"horizontal",align:"center",gap:"auto",children:[h&&t.supportsNotionSidebarButton?(0,u.jsx)("div",{style:{margin:4},children:(0,u.jsx)(E().z,{})}):null,x,(0,u.jsxs)(B().Y1,{direction:"horizontal",align:"center-right",gap:2,style:{flexShrink:0},children:[(0,u.jsx)(yr,{threadStore:s}),(0,u.jsx)(Sr,{clientStore:i}),(0,u.jsx)(br,{onNewChat:()=>f(void 0)}),c?(0,u.jsx)(Ir,{onClick:c}):null]}),p&&(0,u.jsx)(U().K,{})]})})})}function xr(e){const{threadStore:t}=e,n=(0,a().v3)(),i=(0,k().tz)(),s=Cr(),d=(0,o().O$)(H().AppStoreMainEditorCurrentBlockStore),c=(0,r.useCallback)((()=>{const e=t.getParentId();d&&A().uK({environment:n,store:d,chatThreadId:e,pageVisitSource:l().y8.AIChat})}),[n,t,d]);return(0,u.jsx)(O().A,{renderTooltip:()=>(0,u.jsx)(k().sA,{id:"aiChatView.backToParentThread.tooltip",defaultMessage:"Back to parent thread"}),render:e=>(0,u.jsx)(D().A,{...e,icon:g,iconStyle:s.iconButtonIcon,style:s.iconButton,ariaLabel:i.formatMessage({id:"aiChatView.backToParentThread.ariaLabel",defaultMessage:"Back to parent thread"}),onClick:c})})}function yr(e){const{threadStore:t}=e,n=(0,a().v3)(),l=((0,k().tz)(),(0,o().K8)((()=>{var e;return(null==t||null===(e=t.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[t]));(0,r.useCallback)((()=>{t&&M().createAndCommit({userAction:"AIChatHeader.toggleShareWithSpace",environment:n,canUndo:!0,perform:e=>{(0,G().g6)({threadStore:t,transaction:e})}})}),[t,n]),(0,i().IS)((e=>({iconButton:{width:28,height:28},iconButtonIcon:{width:16,height:16,fill:l?e.icon.uiBluePrimary:e.icon.primary}})),[l]),(0,o().K8)((()=>t&&!t.canEdit()),[t]),(0,o().K8)((()=>(0,s().q1)((null==t?void 0:t.getTranscript())??[])),[t]);return null}function Sr(e){const t=(0,k().tz)(),{clientStore:n}=e,a=Cr({active:(0,o().K8)((()=>n.state.showDebug),[n])}),i=(0,r.useCallback)((()=>{n.setState({...n.state,showDebug:!n.state.showDebug})}),[n]);return(0,o().K8)((()=>(0,Y().Ke)()),[])?(0,u.jsx)(O().A,{renderTooltip:()=>(0,u.jsx)(k().sA,{id:"aiChatView.debugTooltip",defaultMessage:"Debug"}),render:e=>(0,u.jsx)(D().A,{...e,icon:f().E,iconStyle:a.iconButtonIcon,style:a.iconButton,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:i})}):null}function br(e){let{onNewChat:t}=e;const n=(0,k().tz)(),r=Cr();return(0,u.jsx)(O().A,{renderTooltip:()=>(0,u.jsx)(k().sA,{id:"aiChatView.newChatTooltip",defaultMessage:"New chat"}),render:e=>(0,u.jsx)(D().A,{...e,icon:m().W,iconStyle:r.iconButtonIcon,style:r.iconButton,ariaLabel:n.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New chat"}),onClick:t})})}function Ir(e){const t=(0,k().tz)(),n=Cr();return(0,u.jsx)(O().A,{renderTooltip:()=>(0,u.jsx)(k().sA,{id:"chatSidebar.close",defaultMessage:"Close"}),render:r=>(0,u.jsx)(D().A,{...r,icon:h().a,iconStyle:n.iconButtonIcon,style:n.iconButton,ariaLabel:t.formatMessage({id:"chatSidebar.close",defaultMessage:"Close"}),onClick:e.onClick})})}function Cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i().IS)((t=>({iconButton:{width:28,height:28},iconButtonIcon:{width:16,height:16,fill:e.active?t.icon.uiBluePrimary:t.icon.primary}})),[e.active])}const kr=(0,r.createContext)({confirmToolUse:()=>{},rejectToolUse:()=>{}});function wr(){return(0,r.useContext)(kr)}function jr(e){let{threadStore:t,clientStore:n,environment:a,children:o}=e;const i=(0,r.useCallback)((e=>{t&&(0,G().WE)({environment:a,clientStore:n,threadStore:t,confirmToolStepIds:e})}),[t,n,a]),s=(0,r.useCallback)((()=>{t&&(0,G().WE)({environment:a,clientStore:n,threadStore:t,confirmToolStepIds:[]})}),[t,n,a]),l=(0,r.useMemo)((()=>({confirmToolUse:i,rejectToolUse:s})),[i,s]);return(0,u.jsx)(kr.Provider,{value:l,children:o})}kr.displayName="ToolUseConfirmationContext"},612900:(e,t,n)=>{n.d(t,{u:()=>o});var r=()=>n(645873);const a=new(r().O2)("PulsingWrapper",(async()=>n.e(45248).then(n.bind(n,673962)))),o=(0,r().jQ)(a,(e=>e.PulsingWrapper),{renderLoading:(e,t)=>t.children})},637433:(e,t,n)=>{n.d(t,{Y:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.26",svg:(0,n(474848).jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25m2.817 4.808a.625.625 0 0 1 0 .884L10.884 10l1.933 1.933a.625.625 0 1 1-.884.884L10 10.884l-1.933 1.933a.625.625 0 1 1-.884-.884L9.116 10 7.183 8.067a.625.625 0 1 1 .884-.884L10 9.116l1.933-1.933a.625.625 0 0 1 .884 0"})},a=(0,n(340498).wt)("xMarkCircleFill",r)},701751:(e,t,n)=>{n.d(t,{p:()=>o});n(296540);var r=n(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.94 14.91 15.66",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,r.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},o=(0,n(340498).wt)("lockOpen",a)},704338:(e,t,n)=>{n.d(t,{q:()=>o});var r=()=>n(645873);const a=new(r().O2)("WorkflowSetupInstructions",(async()=>await Promise.all([n.e(75134),n.e(16471),n.e(58550),n.e(44711),n.e(53321),n.e(90825),n.e(96346),n.e(55373),n.e(37353),n.e(29151),n.e(78191),n.e(62475),n.e(3151),n.e(98629),n.e(92845),n.e(84468),n.e(5605),n.e(48486),n.e(95794),n.e(13677),n.e(56952),n.e(48632),n.e(75078),n.e(25497),n.e(74562),n.e(27711),n.e(4422),n.e(11341),n.e(46414),n.e(95168),n.e(28271),n.e(34877),n.e(36908),n.e(17254),n.e(84185),n.e(32421),n.e(15315),n.e(24587),n.e(78708),n.e(43777),n.e(74752),n.e(91194),n.e(81197),n.e(98659),n.e(20502),n.e(6266),n.e(8184),n.e(83884),n.e(65881),n.e(99809),n.e(93282),n.e(43678),n.e(15019),n.e(90978),n.e(3910),n.e(77213),n.e(6912),n.e(30291),n.e(54220),n.e(19930),n.e(81768),n.e(52836),n.e(26483),n.e(31276),n.e(40863),n.e(25957),n.e(42510),n.e(97132)]).then(n.bind(n,652305)))),o=(0,r()._h)(a,(e=>e.WorkflowSetupInstructions))},748539:(e,t,n)=>{n.d(t,{f:()=>r});const r=new(n(645873).O2)("pageCovers",(async()=>{const{pageCovers:e}=await n.e(40198).then(n.bind(n,519737));return e}))},755543:(e,t,n)=>{n.d(t,{n:()=>w});n(944114),n(898992),n(803949),n(581454),n(908872);var r=n(296540),a=()=>n(56366),o=()=>n(401497),i=()=>n(803960),s=()=>n(94701),l=()=>n(274570),d=()=>n(234459),c=()=>n(959013),u=()=>n(493823),p=()=>n(760217),g=()=>n(406699),f=()=>n(331542),h=()=>n(928600),m=()=>n(939740),v=()=>n(554509),x=()=>n(89924),y=()=>n(722872),S=()=>n(765957),b=()=>n(630116),I=()=>n(918052),C=n(474848);const k=(0,c().YK)({new_chat_title:{id:"WorkflowEditorTranscript.historyDropdown.newChatTitle",defaultMessage:"New chat"}});function w(e){const{threadStore:t,onThreadChange:n,parentStore:w}=e,j=(0,c().tz)(),A=(0,a().K8)((()=>{var e;const n=null==t||null===(e=t.getData())||void 0===e?void 0:e.title;return n||j.formatMessage(k.new_chat_title)}),[j,t]),M=Boolean(t),T=(0,o().IS)((e=>({checkIcon:{width:14},chevronDownIcon:{width:16,marginLeft:6,fill:e.icon.secondary,flexShrink:0},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{width:24,opacity:.2},threadTitleButton:{flexShrink:1,paddingRight:6},threadTitleInDropdown:{maxWidth:"250px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",flexShrink:1}})),[]),{status:R,value:B}=(0,I().s)({parentStore:w,threadStore:t}),D=(0,r.useCallback)((()=>(0,C.jsx)("div",{style:T.loadingStateContainer,children:(0,C.jsx)(f().A,{})})),[T.loadingStateContainer]),O=(0,r.useCallback)((()=>(0,C.jsx)("div",{style:T.loadingStateContainer,children:(0,l().clockIcon)(T.clockIcon)})),[T.loadingStateContainer,T.clockIcon]),U=(0,r.useCallback)((e=>{if("pending"===R)return[{key:"loading",render:e=>(0,C.jsx)(x().A,{...e,title:"Previous chats",shouldShowBottomDivider:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,C.jsx)(D,{})}]}];if(!B||0===B.length)return[{key:"empty",render:e=>(0,C.jsx)(x().A,{...e,title:"Previous chats"}),items:[{key:"empty-item",action:()=>{},render:()=>(0,C.jsx)(O,{})}]}];const r=[];let a=!1;const o=B.reduce(((e,t)=>{const n=new Date(t.created_at),r=new Date;r.setHours(0,0,0,0);const a=new Date(r);a.setDate(a.getDate()-1);const o=new Date(r);o.setDate(o.getDate()-7);const i=new Date(r);let s;return i.setDate(i.getDate()-30),s=n>=r?"today":n>=a?"yesterday":n>=o?"previous7days":n>=i?"previous30days":"older",e[s]||(e[s]=[]),e[s].push(t),e}),{});return[{key:"today",label:j.formatMessage({id:"aiInferenceTranscript.today",defaultMessage:"Today"})},{key:"yesterday",label:j.formatMessage({id:"aiInferenceTranscript.yesterday",defaultMessage:"Yesterday"})},{key:"previous7days",label:j.formatMessage({id:"aiInferenceTranscript.previous7days",defaultMessage:"Previous 7 days"})},{key:"previous30days",label:j.formatMessage({id:"aiInferenceTranscript.previous30days",defaultMessage:"Previous 30 days"})},{key:"older",label:j.formatMessage({id:"aiInferenceTranscript.older",defaultMessage:"Older"})}].forEach((i=>{let{key:l,label:c}=i;const u=o[l];if(null==u||!u.length)return;const g=a;a=!1,r.push({key:`history-${l}`,render:e=>(0,C.jsx)(x().A,{...e,title:c,topBorder:g}),items:u.map((r=>({key:r.id,action:()=>{const t=S().default.state.currentSpaceStore;if(!t)return;const a=b().Ei.createChildStore(t,{table:d().To,id:r.id,spaceId:t.id});n(a),e.close()},render:e=>(0,C.jsx)(p().A,{...e,title:r.title||j.formatMessage(k.new_chat_title),right:(null==t?void 0:t.id)===r.id?(0,s().checkmarkFillIcon)(T.checkIcon):void 0})})))})})),r}),[R,B,t,D,O,T.checkIcon,n,j]);return(0,C.jsx)(g().Ay,{popupType:g().z7.Popup,placementToOrigin:g().sx.Bottom,alignmentToOrigin:g().yP.Start,renderOrigin:e=>(0,C.jsxs)(u().p,{"aria-label":"history",...e,size:"md",style:T.threadTitleButton,children:[(0,C.jsx)(v().D,{styleName:"UIRegular-14px/Medium",style:T.threadTitleInDropdown,children:M?A:j.formatMessage(k.new_chat_title)}),(0,C.jsx)(C.Fragment,{children:(0,i().arrowChevronSingleDownIcon)(T.chevronDownIcon)})]}),render:e=>(0,C.jsx)(h().A,{menuType:y().gu.Popup,width:300,children:(0,C.jsx)(m().Ay,{type:m().Oh.Vertical,initialFocus:0,sections:U(e)})})})}},769607:(e,t,n)=>{n.r(t),n.d(t,{aiFaceFillIcon:()=>o,iconDefinition:()=>a});n(296540);var r=n(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"3.9 2.27 13.75 15.12",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M9.112 2.863a4.17 4.17 0 0 0-4.92.468.875.875 0 0 0 1.167 1.304 2.42 2.42 0 0 1 3.44.22.875.875 0 0 0 1.322-1.146 4.2 4.2 0 0 0-1.01-.846m1.248 2.563a4.167 4.167 0 0 1 7.173.037.875.875 0 1 1-1.511.883 2.417 2.417 0 0 0-4.16-.02l-5.21 8.697 3.828.62a.875.875 0 0 1-.28 1.728l-5.102-.827a.875.875 0 0 1-.61-1.313zM6.51 9.204a1.416 1.416 0 1 0 .452-2.795 1.416 1.416 0 0 0-.453 2.795"}),(0,r.jsx)("path",{d:"M12.72 10.21a1.416 1.416 0 1 0 .453-2.795 1.416 1.416 0 0 0-.453 2.795"})]})},o=(0,n(340498).wt)("aiFaceFill",a)},882262:(e,t,n)=>{n.d(t,{m:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.23 3.23 13.54 13.53",svg:(0,n(474848).jsx)("path",{d:"M4.485 8.86V5.369l4.073 4.073a.625.625 0 0 0 .884-.884L5.369 4.485h3.49a.625.625 0 1 0 0-1.25h-5a.625.625 0 0 0-.624.625v5a.625.625 0 0 0 1.25 0m10.146 6.655-4.07-4.07a.625.625 0 0 1 .884-.884l4.07 4.07V11.14a.625.625 0 1 1 1.25 0v5c0 .345-.28.625-.625.625h-5a.625.625 0 1 1 0-1.25z"})},a=(0,n(340498).wt)("arrowExpandDiagonal",r)},915619:(e,t,n)=>{n.d(t,{PF:()=>A,Wn:()=>w,Yo:()=>j});n(581454);var r=n(296540),a=()=>n(484714),o=()=>n(56366),i=()=>n(401497),s=()=>n(370657),l=()=>n(609616),d=()=>n(234459),c=()=>n(155792),u=()=>n(959013),p=()=>n(436572),g=()=>n(2220),f=()=>n(624652),h=()=>n(28070),m=()=>n(128555),v=()=>n(515692),x=()=>n(356983),y=()=>n(285790),S=()=>n(859428),b=()=>n(594794),I=()=>n(140862),C=()=>n(805126),k=n(474848);function w(e){const{loadAttachmentsData:t,style:n}=e,{isMobile:o}=(0,a().Y0)(),s=(0,u().tz)(),d=(0,r.useCallback)((async()=>{t&&await t.uploadFile()}),[t]),c=(0,I().A)(!0),p=s.formatMessage({id:"assistantRichTextInput.insertAttachment.button.tooltip",defaultMessage:"Attach file"}),g=(0,i().IS)((e=>({tooltipSecondaryText:{color:e.text.contrastSecondary}})),[]);return(0,k.jsx)(S().A,{renderTooltip:()=>(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{children:p}),(0,k.jsx)("div",{style:g.tooltipSecondaryText,children:(0,k.jsx)(u().sA,{id:"assistantRichTextInput.insertAttachment.tooltip.supportedFormats",defaultMessage:"Most images and PDFs"})})]}),render:e=>(0,k.jsx)(y().A,{ariaLabel:p,icon:l().o,iconStyle:{width:o?19:20,height:o?19:20},style:{marginLeft:0,marginRight:0,width:(0,v().h6)(o),height:(0,v().h6)(o),...n},onClick:d,...e,...c})})}function j(e){const{loadAttachmentsData:{threadStore:t},clientStore:n}=e,a=(0,i().IS)((e=>({filePreviewWrapper:{width:"100%",paddingTop:4,paddingBottom:4,marginLeft:4}})),[]),s=(0,o().K8)((()=>n.getOrCreateClientAIChatThreadStore(t.id)),[n,t.id]),l=(0,o().K8)((()=>s.getStagedAttachmentUploadStoreIfExists()),[s]),d=(0,h().Jp)(l),c=(0,r.useCallback)((e=>{l&&(l.onDeleteFileUpload(e),s.unstageAttachmentInferenceTranscriptStep({fileId:e}))}),[l,s]);return d&&0!==d.length?(0,k.jsx)("div",{style:a.filePreviewWrapper,children:d.map((e=>{const{fileName:n}=e;return(0,k.jsx)(h().kp,{uploadProgress:e,permissionRecordOverride:t.pointer,onDeleteFile:"complete"===e.status?()=>c(e.fileUrl):void 0},n)}))}):null}function A(e){const{clientAiChatStore:t,threadStore:n,spaceStore:i,config:l,aiChatFeatureController:h}=e,v=(0,a().v3)(),y=(0,o().K8)((()=>{if(n&&t)return t.getOrCreateClientAIChatThreadStore(n.id)}),[t,n]),S=(0,o().K8)((()=>null==y?void 0:y.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore),[y]),I=(0,r.useCallback)((e=>{if(!y||!i)return;const t=y.getTemporaryAttachmentStagedDataOrInstantiate(),n=(0,b().Z1)({environment:v,table:c().mS,spaceId:i.id}),r=(0,s().jx)({uploadedFileData:e,id:n});y.stageAttachmentInferenceTranscriptStep({step:r}),t.stagedAttachmentUploadStore.onFileUploadCompleted(e.uploadIdentifier,e),(0,g().u)({environment:v,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:r.contentType,source:"custom_upload",framework:"inference_transcript"}}})}),[y,v,i]),k=(0,o().K8)((()=>h.analyticsSource(n)),[h,n]),w=(0,o().K8)((()=>(0,C().zj)({threadStore:n,clientStore:t})),[t,n]),j=(0,f().X)({currentSpaceId:null==i?void 0:i.id,progressOverrides:{threadPointer:n&&i?{spaceId:i.id,table:d().To,id:null==n?void 0:n.id}:void 0,onSuccess:I,progressStore:S},analyticsArgs:{configType:w.type,source:k}}),A=(0,x().z)({threadClientStore:y,config:l,clientChatStore:t,aiChatFeatureController:h}),M=(0,u().tz)(),T=(0,r.useCallback)((e=>{0!==e.files.length&&(A.canUpload?j({file:e.files[0],method:"paste"}):p().D6({label:M.formatMessage(m().E[A.reason])}))}),[A,M,j]),R=(0,r.useCallback)((async e=>{0!==e.length&&(A.canUpload?(await j({file:e[0],method:"paste"}),e.length>1&&p().D6({label:M.formatMessage({id:"aiInferenceTranscript.multipleFilesNotSupported",defaultMessage:"Only one attachment is supported at this time."})})):p().D6({label:M.formatMessage(m().E[A.reason])}))}),[A,M,j]);return{uploadAttachment:j,onPasteFiles:T,onDropFiles:R}}},937199:(e,t,n)=>{n.d(t,{LH:()=>o,Op:()=>a,bi:()=>l,sf:()=>s,v$:()=>i});n(16280);var r=n(296540);const a=(0,r.createContext)(null);function o(){const e=(0,r.useContext)(a);if(!e)throw new Error("usePageLayoutEditorContext must be used inside BaseLayoutEditorContext.Provider");return e}function i(){return(0,r.useContext)(a)}a.displayName="BaseLayoutEditorContext";const s=(0,r.createContext)(null);function l(){const e=(0,r.useContext)(s);if(!e)throw new Error("usePageLayoutEditorContext must be used inside PageLayoutEditorContextProvider");return e}s.displayName="PageLayoutEditorContext"},952816:(e,t,n)=>{n.d(t,{E:()=>a});n(296540);var r=n(474848);const a=(0,n(340498).wt)("bug",{viewBox:"0 0 64 64",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"m32,8c-5.55,0-9,3.83-9,10h18c0-6.17-3.45-10-9-10Z"}),(0,r.jsx)("path",{d:"m48,36h12v-4h-12v-6.01c2.74-.06,4.78-.94,6.76-2.92l4.24-4.24-2.83-2.83-4.24,4.24c-1.3,1.3-2.41,1.76-4.24,1.76h-13.69v32c6.15,0,10.63-3.12,12.7-8.47l1.54,1.54c1.3,1.3,1.76,2.41,1.76,4.24v2.69h4v-2.69c0-2.9-.88-5.02-2.93-7.07l-3.26-3.26c.12-.95.19-1.94.19-2.98v-2Z"}),(0,r.jsx)("path",{d:"m12.07,20.24l-4.24-4.24-2.83,2.83,4.24,4.24c1.98,1.98,4.02,2.85,6.76,2.92v6.01H4v4h12v2c0,1.04.07,2.03.19,2.98l-3.26,3.26c-2.05,2.05-2.93,4.17-2.93,7.07v2.69h4v-2.69c0-1.83.46-2.95,1.76-4.24l1.54-1.54c2.08,5.35,6.55,8.47,12.7,8.47V22h-13.69c-1.83,0-2.95-.46-4.24-1.76Z"})]})})},975366:(e,t,n)=>{n.d(t,{hu:()=>P,uH:()=>U});n(898992),n(354520),n(581454);var r=n(296540),a=()=>n(17022),o=()=>n(221844),i=()=>n(484714),s=()=>n(56366),l=()=>n(401497),d=()=>n(1295),c=()=>n(242138),u=()=>n(902006),p=()=>n(663760),g=()=>n(388821),f=()=>n(179034),h=()=>n(798880),m=()=>n(919709),v=()=>n(534177),x=()=>n(319975),y=()=>n(751156),S=()=>n(108184),b=()=>n(188158),I=()=>n(960432),C=()=>n(143016),k=()=>n(261237),w=()=>n(493733),j=()=>n(780054),A=()=>n(492414),M=()=>n(836251),T=()=>n(58293),R=()=>n(630116),B=()=>n(155382),D=()=>n(549131),O=n(474848);function U(e){let{step:t,threadStore:n,content:a,searchContext:o,aiChatFeatureController:i}=e;const[s,d]=(0,r.useState)(!1),{verticalPadding:c,horizontalPadding:u}=(0,B().Zh)(),p=(0,l().IS)((e=>({container:{position:"relative",margin:`0 -${u}px`,padding:`${c}px ${u}px`,borderRadius:8,backgroundColor:"transparent",transition:"background-color 0.1s ease",...s&&{backgroundColor:e.tint.regular}},feedbackActions:{pointerEvents:s?"auto":"none",opacity:s?1:0,backgroundColor:e.buttonGroupBackground,position:"absolute",top:-16,right:10,border:"none",boxShadow:`0 0 0 0.5px ${e.stroke.secondary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.04)`,borderRadius:7,display:"flex",justifyContent:"center",padding:"2px"}})),[s,u,c]);return(0,O.jsxs)("div",{style:p.container,onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},children:[(0,O.jsx)(P,{markdown:a,searchContext:o,aiChatFeatureController:i}),(0,O.jsx)("div",{style:p.feedbackActions,children:(0,O.jsx)("div",{style:{display:"flex",marginLeft:0},children:(0,O.jsx)(D().Ot,{step:t,threadStore:n,textContent:a})})})]})}function P(e){const t=(0,T().r)();return t?(0,O.jsx)(F,{...e,spaceStore:t}):null}function F(e){const{markdown:t,spaceStore:n,searchContext:l,aiChatFeatureController:T}=e,B=(0,i().v3)(),D=n.id,U=(0,s().K8)((()=>B.idCreator.getSpaceIdCreatorSync(D)),[B.idCreator,D]),P=(0,r.useMemo)((()=>{if(!t)return;const e=B.currentUser.id;if(!e)return;const n={table:h().oo,id:e},r=U.idInSavedSpace(f().ev),i=(0,p().h)(t),s=(0,d().i)({pageId:r,recordMap:g().RecordMap.create(),updates:[{action:"insert",blocks:i}],spaceId:D,useCrdt:!1,idCreator:U,actorPointer:n,uriContext:{baseUrl:j().A.domainBaseUrl,publicDomainName:j().A.publicDomainName},options:{citationFormat:"citation"}});return a().e.withListenerIgnored((()=>{const e=new(o().A)({name:"AIChatTranscript.NotionFlavoredMarkdownChatStep",isTemporaryData:!0}),t=y().createAndCommit({userAction:"AIChatTranscript.NotionFlavoredMarkdownChatStep.markdownToBlocks",environment:B,canUndo:!1,perform:t=>{const n=new(R().pm)({environment:B,pointer:{table:f().ev,id:r,spaceId:D},recordStoreOptions:{inMemoryRecordCache:e,userId:B.currentUser.id},path:["content"]});for(const e of s)y().applyOperation({store:(0,R().Oo)(n,e.pointer),operation:e,transaction:t});const a=(n.getValue()||[]).map((e=>R().Bv.createChildStore(n,{table:f().ev,id:e})));if(a)return(0,S().postProcessAICreatedStores)(B,a),function(e,t,n,r){for(const a of e){const e=a.getTitleStore(),o=null==e?void 0:e.getValue();if(!e||!o)continue;const i=(0,m().RQ)(o).map((e=>{const n=e[1];if(!n)return e;const o=(0,m().g2K)(n),i=null==o?void 0:o[1];let s;if("url"===(null==i?void 0:i.type)){const n=(0,M().wU)(i.href);if(n){const r=R().Bv.createChildStore(a,{id:n,table:f().ev,spaceId:a.getSpaceId()}),o=(0,m().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,m().bZo)(e))),(0,m().X$)({type:"block",href:(0,A().Ef)({environment:t,updates:{store:r}}),blockId:n})]);return o}const o=null==r?void 0:r[i.href];if(!o)return e;const l=(0,c().f9)(o.id);l&&("slack"===l.type?s=(0,m().X$)({...l,type:"slack",href:i.href,threadHref:i.href}):"block"===l.type?s=(0,m().X$)({type:"block",href:i.href,blockId:l.blockId}):"google-drive"===l.type?s=(0,m().X$)({type:"google-drive",href:i.href,url:l.url,messageId:l.url}):"github"===l.type?s=(0,m().X$)({type:"github",href:i.href,url:l.url,messageId:l.url}):"jira"===l.type?s=(0,m().X$)({type:"jira",href:i.href,url:l.url,messageId:l.url}):"gmail"===l.type?s=(0,m().X$)({type:"gmail",href:i.href,url:l.url,messageId:l.url}):"linear"===l.type?s=(0,m().X$)({type:"linear",href:i.href,url:l.url,messageId:l.url}):"outlook"===l.type?s=(0,m().X$)({type:"outlook",href:i.href,url:l.url,messageId:l.url}):"helpdoc"===l.type?s=(0,m().X$)({type:"helpdoc",href:i.href,url:l.url}):"webpage"===l.type?s=(0,m().X$)({type:"webpage",href:i.href,url:l.url}):"sharepoint"===l.type?s=(0,m().X$)({type:"sharepoint",href:i.href,url:l.url,messageId:l.url}):"notion-mail"===l.type?s=(0,m().X$)({type:"notion-mail",href:i.href,url:l.url,messageId:l.url}):"microsoft-teams"===l.type?s=(0,m().X$)({type:"microsoft-teams",href:i.href,url:l.url,messageId:l.url,threadHref:i.href,threadTs:l.threadTs,channelId:l.channelId,messageType:l.messageType}):"google-calendar"===l.type?s=(0,m().X$)({type:"google-calendar",href:i.href,url:l.url,messageId:l.url}):"helpdoc-section"===l.type?s=(0,m().X$)({type:"helpdoc-section",href:i.href,url:l.url,parentPageHref:l.parentPageHref}):"citation_unsupported"===l.type||"database_query_results"===l.type?s=void 0:(0,v().HB)(l.type))}return s?(0,m().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,m().bZo)(e))),s]):e}));x().R9({environment:t,store:e,value:i,transaction:n})}}(a,B,t,l),(0,S().wrapTemporaryBlocksInList)({environment:B,stores:a,inMemoryRecordCache:e,listId:r,transaction:t})}}).performResult;return e.addCacheFallback(B.defaultRecordCache.inMemoryRecordCache),t}))}),[t,B,U,D,l]),F=(0,r.useCallback)((e=>{const t=null==l?void 0:l[e];if(!t)return;const n=(0,c().f9)(t.id);if(n){if("slack"===n.type)return{...n,title:t.title,text:t.text,lastEdited:t.lastEdited};if("block"!==n.type)return"google-drive"===n.type?{...n,type:"google-drive",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"github"===n.type?{...n,type:"github",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"jira"===n.type?{...n,type:"jira",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"gmail"===n.type?{...n,type:"gmail",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href),threadHref:(0,u().V9)(n.href)}:"linear"===n.type?{...n,type:"linear",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"outlook"===n.type?{...n,type:"outlook",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"helpdoc"===n.type?{...n,type:"helpdoc",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().h5)(n.href)}:"webpage"===n.type?{...n,type:"webpage",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().RW)(n.href)}:"sharepoint"===n.type?{...n,type:"sharepoint",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"notion-mail"===n.type?{...n,type:"notion-mail",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"microsoft-teams"===n.type?{...n,type:"microsoft-teams",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"google-calendar"===n.type?{...n,type:"google-calendar",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().V9)(n.href)}:"helpdoc-section"===n.type?{...n,type:"helpdoc-section",url:n.url,title:t.title,text:t.text,lastEdited:t.lastEdited,href:(0,u().w3)(n.href)}:void("database_query_results"!==n.type&&"citation_unsupported"!==n.type&&(0,v().HB)(n.type))}}),[l]),L=(0,r.useRef)(null),$=(0,s().uB)(void 0,C().D);return(0,b().c2)({containerRef:L,citationHoverStore:$,parentStore:n,evaluatorState:void 0}),P?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(k().c,{displayName:"AIChatTranscript.MarkdownChatStep",disabled:!0,ref:L,children:(0,O.jsx)(w().A,{store:P,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0,overrideHeaderFontSizes:E})}),(0,O.jsx)(I().cE,{containerRef:L,hoverStore:$,parentStore:P,getPayloadDataForHref:F,useCompactWebPreview:!0,isSearchChat:(null==T?void 0:T.chonkyStyles)??!0})]}):null}const E={header:1.375,subHeader:1.25,subSubHeader:1.125}},990402:(e,t,n)=>{n.d(t,{m:()=>a});var r=()=>n(46986);function a(e){return("workflow"===e.getType()||e.isCollectionView()&&e.getWorkflowStore())&&e.canEdit()&&!e.isSystemBlock()&&(0,r().re)()}},996624:(e,t,n)=>{n.d(t,{a:()=>a});n(296540);var r=n(474848);const a=(0,n(340498).wt)("doubleChevronRight",{viewBox:"0 0 16 16",directional:!0,svg:(0,r.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})}}]);