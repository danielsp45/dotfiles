"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2411,5834,34208,59388],{53592:(e,t,r)=>{r.r(t),r.d(t,{attemptServerBackedLocalDuplicate:()=>f,serverBackedLocalDuplicate:()=>B});r(944114),r(581454);var o=()=>r(857639),a=()=>r(386164),c=()=>r(388821),n=()=>r(912720),i=()=>r(199378),s=()=>r(502800),l=()=>r(763824),d=()=>r(466614),p=()=>r(449506),u=()=>r(666144),m=()=>r(751156),g=()=>r(974233),v=()=>r(611191),_=()=>r(603815),k=()=>r(261450),y=()=>r(503388),S=()=>r(966152),b=()=>r(59110),I=()=>r(605605),h=()=>r(677733);function B(e){const{environment:t,sourceBlock:r,targetInMemoryRecordCache:o,transaction:a,options:n,targetSpaceId:i,installationImprint:s,templateInstallationMetadata:d={},shouldUseSynchronousDuplicationAPI:p,stopwatch:u}=e,m=performance.now();null==u||u.mark("server_duplicate_start");const g=e.copyIndicators??(0,y().U8)({environment:t,sourceBlocks:[r],targetRecordCache:o,transaction:a,spaceId:i});null==u||u.mark("create_copy_indicators");const v=l().yX();return a.postSubmitCallbacks.push((async e=>{if(null==u||u.mark("transaction_post_submit_callback"),e)return(0,S().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:g.map((e=>e.id)),error:e,targetSpaceId:i,options:n}}),void(0,y().Jc)(e,v);(0,y().Yj)(g),null==u||u.mark("initialize_copy_indicators_progress_state");const{success:o,size:l}=await f({environment:t,sourceBlockPointer:r,targetBlockStore:g[0],options:n,templateInstallationMetadata:d,stopwatch:u});if(o)return(0,k().E)({environment:t,success:!0,time:performance.now()-m,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:l,method:"server_backed_local_duplication"}),null==u||u.mark("server_backed_local_duplicate_success"),(0,y().dH)(g),void v.resolve({status:"success"});const _=await(0,h().performServerDuplicate)({environment:t,copyIndicators:g,sourceBlocks:[r],targetSpaceId:i,options:n,templateInstallationMetadata:d,installationImprint:s,shouldUseSynchronousDuplicationAPI:p,stopwatch:u});if((0,y().dH)(g),!_.success)return(0,y().uC)({environment:t,copyIndicators:g}),(0,S().P0)({environment:t,type:"server_duplicate_iterator_error",data:{errorMessage:_.errorMessage}}),void v.resolve({status:"error",errorMessage:_.errorMessage,error:_.error});(0,k().E)({environment:t,success:!0,time:performance.now()-m,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:_.size,method:"sbld_fallback_server_duplication"}),null==u||u.mark("server_duplicate_success"),v.resolve({status:"success",recordIdMap:_.recordIdMapJson?c().RecordMapPolymorphic.create(_.recordIdMapJson):void 0})})),{blockStores:g,onComplete:v.promise}}async function f(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:l,options:k,templateInstallationMetadata:y,recordLimit:h=500,targetInMemoryRecordCache:B,stopwatch:f}=e;null==f||f.mark("attempt_server_backed_local_duplicate_start"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate",data:{sourceBlockPointer:r,targetBlockStore:l,targetSpaceId:l.getSpaceId(),options:k}});const M=(0,v().$J)(),C=await async function(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:n,targetInMemoryRecordCache:i,options:l,enableLegacyTransclusionFixing:d,recordLimit:m}=e,v=i??n.inMemoryRecordCache,k={blockId:r.id,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!l.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!l.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:d,inMemoryRecordCache:v};let y;if(y=(0,b().loadLocalSubtree)(t,k),!y.recordMap&&v===t.defaultRecordCache.inMemoryRecordCache)try{(0,S().JW)({environment:t,type:"performInexactPagePreload",data:{message:"No local subtree found, performing performInexactPagePreload",loadLocalSubtreeArgs:k}}),await(0,_().A$)(t,{table:"block",id:r.id,spaceId:r.spaceId}),y=(0,b().loadLocalSubtree)(t,k)}catch(I){o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"persistedRecordCachePreloadError",error:(0,s().convertErrorToLog)(I),data:{message:"Failed to preload subtree from persisted record cache"}})}y.recordMap||((0,S().JW)({environment:t,type:"loadLocalSubtreeApi",data:{message:"No local subtree found from previous attempts, attemping API call to loadBlockSubtree",currentLocalSubtreeResponse:y}}),y=await async function(e){const{environment:t,sourceBlockPointer:r,recordLimit:n,targetBlockStore:i,loadLocalSubtreeArgs:l}=e;try{const e=await p().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:n},headers:(0,a().WS)({spaceId:r.spaceId})});if((0,S().JW)({environment:t,type:"loadBlockSubtreeApiResult",data:{message:"Result from loadBlockSubtree API call",subtreeResult:e,apiArgs:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:n}}}),"success"===e.type){const r=c().RecordMapWithRole.create(e.data.subtreeRecordMap);return await u()._O({environment:t,inMemoryRecordCache:l.inMemoryRecordCache,recordMap:r,debugSource:"load_local_subtree_from_server"}),(0,b().loadLocalSubtree)(t,l)}{const t=(0,g().V)(e);o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"loadBlockSubtreeFailure",data:{message:"Error fetching subtree",miscDataToConvertToString:{error:t,sourceBlockPointer:r,cacheSize:i.inMemoryRecordCache.size,targetBlockPointer:{id:i.id,spaceId:i.getSpaceId(),type:i.getType()}}}})}}catch(I){o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,s().convertErrorToLog)(I),data:{message:"Error loading subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:i.inMemoryRecordCache.size,targetBlockPointer:{id:i.id,spaceId:i.getSpaceId(),type:i.getType()}}}})}}({environment:t,sourceBlockPointer:r,recordLimit:m,targetBlockStore:n,loadLocalSubtreeArgs:k}));y&&!y.recordMap&&o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadFailure",data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:n.inMemoryRecordCache.size,reason:"error"===y.type?y.reason:void 0,targetBlockPointer:{id:n.id,spaceId:n.getSpaceId(),type:n.getType()},missingRecord:"error"===y.type?y.pointer:void 0}}});return y}({environment:t,sourceBlockPointer:r,targetBlockStore:l,targetInMemoryRecordCache:B,options:k,enableLegacyTransclusionFixing:M,recordLimit:h});if(null==f||f.mark("try_load_local_subtree_finished"),!C||!C.recordMap)return{success:!1,size:void 0,pageStore:l};var P;if(d().Lw({sourceSpaceId:r.spaceId,targetSpaceId:l.getSpaceId(),sourceBlockSubtree:C.recordMap}))return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"accessLockingWarning",data:{message:"Unable to perform local duplication",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==f||f.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(P=C.recordMap)||void 0===P?void 0:P.getSize(),pageStore:l};for(const a of C.recordMap.getTables()){var L;if(a===n().yB||a===i().SC)return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"invalidRecordType",data:{message:"Local duplication does not support automation tables",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==f||f.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(L=C.recordMap)||void 0===L?void 0:L.getSize(),pageStore:l}}try{var T;(0,S().JW)({environment:t,type:"server_backed_duplicate_start_transaction",data:{message:"Starting transactionActions.createAndCommit for localDuplicate",sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}});const{serverCommitResult:e}=m().createAndCommit({userAction:"server_backed_local_duplicate",environment:t,canUndo:!0,isTemplateInstantiationTransaction:Boolean(y),perform:e=>(0,I().localDuplicate)({environment:t,sourceBlockId:r.id,targetBlockPointer:l.pointer,sourceBlockSubtree:C.recordMap,targetInMemoryRecordCache:l.inMemoryRecordCache,transaction:e,templateInstallationMetadata:y,stopwatch:f,options:{...k,preventLegacyTransclusions:M}})});return await e,null==f||f.mark("server_backed_local_duplicate_finished"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate_success",data:{targetSpaceId:l.getSpaceId(),options:k}}),{success:!0,size:null===(T=C.recordMap)||void 0===T?void 0:T.getSize(),pageStore:l,transactionPromise:e}}catch(R){var w;return o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,s().convertErrorToLog)(R),data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),{success:!1,size:null===(w=C.recordMap)||void 0===w?void 0:w.getSize(),pageStore:l}}}},735790:(e,t,r)=>{r.d(t,{M:()=>c});r(296540);var o=r(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.25 15.25 11.5",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,o.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},c=(0,r(340498).wt)("sliders",a)}}]);