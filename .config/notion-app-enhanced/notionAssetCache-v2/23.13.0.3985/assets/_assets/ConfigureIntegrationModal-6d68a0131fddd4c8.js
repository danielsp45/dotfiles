"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[15780],{236190:(e,t,o)=>{o.d(t,{c:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("minus",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.037 8.844h9.92a.705.705 0 00.368-.103.825.825 0 00.28-.28.73.73 0 000-.773.752.752 0 00-.28-.28.705.705 0 00-.369-.102H3.037a.705.705 0 00-.369.102.824.824 0 00-.28.28.73.73 0 000 .772.914.914 0 00.28.281.705.705 0 00.37.103z"})})},802512:(e,t,o)=>{o.r(t),o.d(t,{ConfigureIntegrationModal:()=>Z});o(16280),o(581454);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),s=()=>o(66913),l=()=>o(332393),d=()=>o(798880),c=()=>o(606219),g=()=>o(20498),u=()=>o(959013),h=()=>o(496603),p=()=>o(973647),f=()=>o(515402),b=()=>o(901389),v=()=>o(436572),x=()=>o(633457),m=()=>o(847307),y=()=>o(972435),k=()=>o(836251),w=()=>o(963589),M=()=>o(962730),A=()=>o(765957),j=()=>o(561585),I=()=>o(217429),S=()=>o(630116),C=(o(898992),o(354520),()=>o(851979)),T=()=>o(987555),L=()=>o(236190),U=()=>o(689094),B=()=>o(493823),K=()=>o(285790),P=()=>o(623580),H=()=>o(125565),R=()=>o(101919),V=o(474848);const _=(0,u().YK)({remove:{id:"integrations.configureIntegrationModal.webhookHeadersRemove",defaultMessage:"Remove"},toggleSecretVisibility:{id:"integrations.configureIntegrationModal.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function W(e){const{headers:t,onChange:o}=e,i=N(),a=(0,n.useCallback)(((e,n)=>{const i=t.map(((t,o)=>o===n?e:t));o(i)}),[t,o]),r=(0,n.useCallback)((e=>{const n=t.filter(((t,o)=>o!==e));o(n)}),[t,o]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(R().A,{style:{display:"flex",alignItems:"center",marginTop:24},children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersInput",defaultMessage:"Webhook Headers"})}),(0,V.jsxs)("div",{style:{maxHeight:"30vh",overflow:"auto",width:"100%"},children:[t.length>0&&(0,V.jsxs)("div",{style:i.headerRow,children:[(0,V.jsx)(H().A,{style:i.columnLabel,isSmall:!0,children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersKey",defaultMessage:"Key"})}),(0,V.jsx)(H().A,{style:{...i.columnLabel,marginLeft:8,marginRight:32},isSmall:!0,children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersValue",defaultMessage:"Value"})})]}),t.map(((e,t)=>(0,V.jsx)(D,{header:e,onChange:a,onDelete:r,index:t},t)))]}),(0,V.jsx)(B().p,{style:{marginTop:8},isGray:!0,iconLeading:U().W,onClick:()=>{o([...t,{key:"",value:""}])},children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersAdd",defaultMessage:"New"})})]})}function D(e){const{header:t,index:o,onChange:i,onDelete:a}=e,r=N(),[s,l]=n.useState(!1);return(0,V.jsxs)("div",{style:r.headerRow,children:[(0,V.jsx)(P().A,{value:t.key,onChange:e=>{i({key:e.target.value,value:t.value},o)}}),(0,V.jsx)(P().A,{style:r.valueColumn,value:t.value,onChange:e=>{i({key:t.key,value:e.target.value},o)},type:s?"text":"password",right:(0,V.jsx)("div",{style:{display:"flex"},children:(0,V.jsx)(K().A,{icon:s?C().h:T().T,onClick:()=>l(!s),ariaLabel:y().A.formatMessage(_.toggleSecretVisibility),color:"uiBluePrimary",iconStyle:{height:18,width:18},style:{height:18}})})}),(0,V.jsx)(K().A,{style:r.removeButton,onClick:()=>{a(o)},icon:L().c,ariaLabel:y().A.formatMessage(_.remove)})]})}function N(){return(0,r().IS)((e=>({removeButton:{width:28,height:28,marginLeft:4},headerRow:{marginTop:8,display:"flex"},valueColumn:{marginLeft:8},columnLabel:{width:"100%",textAlign:"start"}})),[])}const z=(0,u().YK)({toggleSecretVisibility:{id:"integrations.configureIntegrationShowSecret.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function E(e){const{secret:t,onChange:o,submit:i,placeholder:a}=e,[r,s]=n.useState(!1);return(0,V.jsx)(P().A,{type:r?"text":"password",value:t,onChange:o,placeholder:a,style:{padding:"4px 8px"},focusInitial:!1,onKeyDown:e=>{"Enter"===e.key&&i()},right:t&&(0,V.jsx)("div",{style:{display:"flex"},children:(0,V.jsx)(K().A,{icon:r?C().h:T().T,onClick:()=>{s(!r)},ariaLabel:y().A.formatMessage(z.toggleSecretVisibility),color:"uiBluePrimary",iconStyle:{height:18,width:18},style:{height:18}})})})}var F=()=>o(346934),O=()=>o(148375),X=()=>o(331542),Y=()=>o(204063),q=()=>o(859428),G=()=>o(126001),Q=()=>o(641514),$=()=>o(690197);const J=(0,u().YK)({webhookUrlPlaceholder:{id:"integrations.configureIntegrationModal.webhookUrlInput.placeholder",defaultMessage:"Paste webhook URL"},webhookSecretPlaceholder:{id:"integrations.configureIntegrationModal.webhookSecretInput.placeholder",defaultMessage:"Paste token"},updateButton:{id:"integrations.configureIntegrationModal.submitButton.update",defaultMessage:"Update"},createButton:{id:"integrations.configureIntegrationModal.submitButton.create",defaultMessage:"Connect"},errorOccurred:{id:"integrations.configureIntegrationModal.error.dialog",defaultMessage:"Failed to connect {integration}. Please contact support."},closeModalAriaLabel:{id:"integrations.configureIntegrationModal.closeButtonLabel",defaultMessage:"Close integration configuration modal"}});function Z(){const e=(0,i().v3)(),t=(0,r().IS)((e=>({errorText:{color:e.errorText,fontSize:12},input:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:360},helpInfo:{display:"inline-flex",marginLeft:1}})),[]),o=(0,O().useConnectIntegrationModalStyles)(),C=(0,a().K8)((()=>j().A.state.open),[]),T=(0,a().K8)((()=>j().A.state.open?j().A.state.integrationId:void 0),[]),L=(0,a().K8)((()=>j().A.state.open?j().A.state.webhookSubscriptionId:void 0),[]),U=(0,a().O$)(A().AppStoreCurrentSpaceStore),B=T&&U?S().CX.createChildStore(U,{id:T,table:l().Li}):void 0,H=L&&U?S().Pr.createChildStore(U,{id:L,table:c().TF,spaceId:U.id}):void 0;(0,n.useEffect)((()=>{const{webhookUrl:e,webhookSecret:t,webhookCustomization:o}={webhookUrl:(null==H?void 0:H.getWebhookUrl())||"",webhookSecret:(null==H?void 0:H.getWebhookSecret())||"",webhookCustomization:(null==H?void 0:H.getWebhookCustomization())||void 0};D(e),z(t);const n=(null==o?void 0:o.headers)||{},i=Object.entries(n).map((e=>{let[t,o]=e;return{key:t,value:o}})).sort(((e,t)=>e.key.localeCompare(t.key)));ee(i)}),[H]);const[_,D]=n.useState(""),[N,z]=n.useState(""),[Z,ee]=n.useState([]),[te,oe]=n.useState(!1),[ne,ie]=n.useState(!1),[ae,re]=n.useState(!1),[se,le,de,ce]=(0,a().K8)((()=>{if(!B)return[void 0,void 0,void 0,void 0];const e=B.getModel();return[e,null==e?void 0:e.name,null==e?void 0:e.type,("internal"!==(null==e?void 0:e.type)&&(null==e?void 0:e.getInfo().developer_name))??"Unknown"]}),[B]),ge=(0,g().D4)(T),ue=h().h1({},g().bX,null==ge?void 0:ge.customization).headers.hmac,he=(0,w().X)("allow_customize_integration_headers"),pe=(0,n.useCallback)((e=>{if("internal"===(null==se?void 0:se.type))throw new Error("internal integrations are not supported");e&&(re(!1),b().f1(y().A.formatMessage(J.errorOccurred,{integration:ce})))}),[se,ce]),fe=(0,n.useCallback)((async()=>{if(!ae){if(!ge||!(0,g().Nl)({env:"production",integrationConfig:ge,webhookUrlToValidate:_,experimentService:I().default,actor:{table:d().oo,id:e.currentUser.id||""},spaceId:(null==U?void 0:U.id)||""}))return oe(!0),void re(!1);if(oe(!1),ue&&!N)return ie(!0),void re(!1);if(re(!0),se){const t=await m().v({environment:e,integration:se,webhookUrl:_,webhookSecret:N,webhookHeaders:Z,webhookSubscriptionId:L,onError:pe,onSuccess:()=>v().D6({label:(0,V.jsx)(u().sA,{id:"configureIntegrationModal.snackbar.title",defaultMessage:"Added {integrationName} to your workspace",values:{integrationName:le}})})});if(p().Q.isFail(t))return void re(!1);await x().oX({environment:e}),await f().g({environment:e}),xe()}}}),[e,pe,se,le,ae,N,Z,ue,L,_,ge,U]),be=(0,n.useCallback)((e=>z(e.target.value)),[]),ve=(0,n.useCallback)((e=>{ee(e)}),[]),xe=()=>{j().A.setState({open:!1}),D(""),z(""),oe(!1),ie(!1),re(!1)};return se&&ge&&U&&"internal"!==de?(0,V.jsx)(Q().A,{innerStyle:o.modal,isOpen:C,onDismiss:xe,render:()=>(0,V.jsxs)("div",{style:o.mobileModal,children:[(0,V.jsxs)("div",{style:o.innerModal,children:[(0,V.jsx)(K().A,{icon:s().V,onClick:xe,style:o.cancelButton,hoveredStyle:o.hovered,ariaLabel:y().A.formatMessage(J.closeModalAriaLabel)}),(0,V.jsx)(F().K,{integrationModel:se,integrationConfig:ge,spaceStore:U}),(0,V.jsxs)("div",{style:t.input,children:[(0,V.jsxs)(R().A,{style:{display:"flex",alignItems:"center",marginTop:40},children:[(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookUrlInput",defaultMessage:"Webhook URL"}),(0,V.jsx)(q().A,{placement:M().W.Bottom,render:e=>(0,V.jsx)($().A,{...e,href:(0,k().xS)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookUrlInput.tooltip",defaultMessage:"Enter the webhook URL provided by {integrationName}",values:{integrationName:ce}})})]}),(0,V.jsx)(P().A,{type:"text",style:{padding:"4px 8px"},value:_,onChange:e=>{D(e.target.value),oe(!1)},placeholder:y().A.formatMessage(J.webhookUrlPlaceholder),focusInitial:!0,onKeyDown:async e=>{"Enter"===e.key&&await fe()}}),te?(0,V.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.invalidUrl",defaultMessage:"Invalid webhook URL"})}):null]}),ge.acceptsSecretToken&&(0,V.jsxs)("div",{style:t.input,children:[(0,V.jsxs)(R().A,{style:{display:"flex",alignItems:"center",marginTop:24},children:[(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookSecretInput",defaultMessage:"Token"}),(0,V.jsx)(q().A,{placement:M().W.Bottom,render:e=>(0,V.jsx)($().A,{...e,href:(0,k().xS)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookTokenInput.tooltip",defaultMessage:"Enter the token provided by {integrationName}",values:{integrationName:ce}})})]}),(0,V.jsx)(E,{secret:N,onChange:be,submit:fe,placeholder:y().A.formatMessage(J.webhookSecretPlaceholder)}),ne?(0,V.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,V.jsx)(u().sA,{id:"integrations.configureIntegrationModal.invalidSecret",defaultMessage:"Webhook secret is required."})}):null]}),ge.acceptsCustomHeaders&&he&&(0,V.jsx)("div",{style:t.input,children:(0,V.jsx)(W,{headers:Z,onChange:ve})}),(0,V.jsx)(Y().A,{style:o.connect,onClick:fe,disabled:""===_||ue&&""===N,children:ae?(0,V.jsx)(X().A,{}):(0,V.jsx)("span",{children:L?y().A.formatMessage(J.updateButton):y().A.formatMessage(J.createButton)})})]}),ge.website_url&&(0,V.jsx)(G().r,{signupUrl:ge.signupUrl??ge.website_url})]})}):null}}}]);