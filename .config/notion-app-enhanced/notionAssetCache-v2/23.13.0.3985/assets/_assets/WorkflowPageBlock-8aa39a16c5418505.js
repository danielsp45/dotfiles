"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[87700],{74831:(e,t,a)=>{a.d(t,{G:()=>r});a(898992),a(354520);class r extends(()=>a(757695))().Store{getInitialState(){return{originalFileUrlToSuccessfullyUploadedFiles:new Map,inProgressUploadFileIdsToProgress:new Map}}setValueForUploadedFile(e,t){this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles).set(e,t)})}setValueForUploadingFile(e,t){const a=new Map(this.state.inProgressUploadFileIdsToProgress);a.set(e,t),this.setState({...this.state,inProgressUploadFileIdsToProgress:a})}deleteValueForUploadingFile(e){const t=new Map(this.state.inProgressUploadFileIdsToProgress);t.delete(e),this.setState({...this.state,inProgressUploadFileIdsToProgress:t})}deleteValueForUploadedFile(e){const t=new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles);t.delete(e),this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:t})}onFileUploadPercentageChanged(e){const{fileId:t,fileName:a,percentage:r,contentType:i}=e;this.setValueForUploadingFile(t,{type:"uploading",fileName:a,progress:r,contentType:i})}onFileUploadFailed(e){const{error:t}=e,{fileId:a,fileName:r}=t;this.setValueForUploadingFile(a,{type:"error",error:t,fileName:r})}onFileUploadCompleted(e,t){this.deleteValueForUploadingFile(e),this.setValueForUploadedFile(t.originalFileUrl,t)}setCompletedFileForRetry(e){this.setValueForUploadedFile(e.originalFileUrl,e)}onDeleteFileUpload(e){this.deleteValueForUploadedFile(e)}isUploadInProgress(){return Array.from(this.state.inProgressUploadFileIdsToProgress.values()).filter((e=>"error"!==e.type)).length>0}doesCurrentChatHaveUpload(){return this.isUploadInProgress()||this.state.originalFileUrlToSuccessfullyUploadedFiles.size>0}}},81986:(e,t,a)=>{a.d(t,{MI:()=>i,QT:()=>r,VD:()=>n});a(16280),a(898992),a(737550);const r=[{featureGates:["agent_automations"],id:"agent_automations",label:"Automations"},{featureGates:["custom_agents"],id:"custom_agents",label:"Custom agents"},{featureGates:["agent_spawn"],id:"agent_spawn",label:"Spawn agents"},{featureGates:["agent_integrations","workflows_mail_module_available","workflows_zendesk_module_available"],id:"agent_integrations",label:"Integrations"},{featureGates:["workflows_github_module_available","workflows_mcp_server_module_available","workflows_pipedream_module_available"],id:"experimental_integrations",label:"Experimental integrations"},{featureGates:["agent_multidb_creation"],id:"agent_multidb_creation",label:"Multi-source databases"},{featureGates:["agent_codegen_integration"],id:"agent_codegen_integration",label:"Codegen Integration"}];function i(e,t){return e.featureGates.some((e=>t(e)))}function n(e){const t=r.find((t=>t.id===e));if(!t)throw new Error(`Feature gate group with id ${e} not found`);return t}},166442:(e,t,a)=>{a.d(t,{JF:()=>s,Kd:()=>c,YF:()=>o});var r=()=>a(757695);a(898992),a(354520);const i={acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,stopInferencePromise:void 0,temporarySteps:[],inferences:[],traceId:void 0,requestInfo:void 0,loading:!1,stagedData:{}};class n extends r().Store{getInitialState(){return i}resetState(){var e;null===(e=this.state.abortController)||void 0===e||e.abort(),this.setState(i)}getTemporaryAttachmentStagedDataOrInstantiate(){const e=this.state.stagedData;if(null!=e&&e.attachmentStagedData)return e.attachmentStagedData;const t={stagedAttachmentUploadStore:new(a(74831).G),stagedClientSteps:[],stagedEngineSteps:[],stagedInferenceTranscriptSteps:[]};return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:t}}),t}getStagedAttachmentUploadStoreIfExists(){var e;const t=this.state.stagedData;return null==t||null===(e=t.attachmentStagedData)||void 0===e?void 0:e.stagedAttachmentUploadStore}stageAttachmentInferenceTranscriptStep(e){const{step:t}=e,a=this.getTemporaryAttachmentStagedDataOrInstantiate(),r={...a,stagedInferenceTranscriptSteps:[...a.stagedInferenceTranscriptSteps,t]};this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:r}})}unstageAttachmentInferenceTranscriptStep(e){var t;const{fileId:a}=e,r=null===(t=this.state.stagedData)||void 0===t?void 0:t.attachmentStagedData;if(!r)return;const i=r.stagedInferenceTranscriptSteps.filter((e=>"attachment"!==e.type||e.fileUrl!==a));this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:{...r,stagedInferenceTranscriptSteps:i}}})}getAndClearStagedAssistantAttachmentSteps(){var e;const t=null===(e=this.state.stagedData)||void 0===e?void 0:e.attachmentStagedData;if(!t)return;const{stagedInferenceTranscriptSteps:a}=t;return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:void 0}}),a}getStagedMentionPointers(){const{mentionStagedData:e}=this.state.stagedData;return e?[...e]:[]}updateMentionedStagedData(e){this.setState({...this.state,stagedData:{...this.state.stagedData,mentionStagedData:new(a(728272).d)(e)}})}}const o={type:"search",scopeForNextSearch:{type:"everything"}},s=new(a(178624).R)({key:"agentModelPicker",namespace:a(419494).Bq,important:!0,trackingType:"preference"});class l extends r().Store{getInitialState(){const e=a(17022).e.withListenerIgnored((()=>a(217429).default.checkGate({gateName:"workflows_inference_replay"})));return{showHistory:!1,showDebug:!1,loading:!1,configForNewTranscripts:o,userSelectedConfig:void 0,agentModelConfig:void 0,model:void 0,debugOverrides:{usePromptCache:e?"s3":void 0},threadRegistry:{},isAIChatTranscriptSidePanelVisible:!1,threadToStagedData:{}}}setState(e){var t;const a=null===(t=this.state)||void 0===t?void 0:t.agentModelConfig;super.setState(e),e.agentModelConfig!==a&&s.setState({agentModelConfig:e.agentModelConfig})}getOrCreateClientAIChatThreadStore(e){if(!this.state.threadRegistry[e]){const t=new n;return this.setState({...this.state,threadRegistry:{...this.state.threadRegistry,[e]:t}}),t}return this.state.threadRegistry[e]}removeClientAIChatThreadStore(e){const{threadRegistry:t}=this.state,a={...t};delete a[e],this.setState({...this.state,threadRegistry:a})}}const c=new l;(0,a(604341).exposeDebugValue)("clientAiChatStore",c)},324577:(e,t,a)=>{a.d(t,{Y:()=>i});var r=()=>a(56366);function i(e){return(0,r().K8)((()=>null==e?void 0:e.getWorkflowStore()),[e])}},631611:(e,t,a)=>{a.d(t,{Ui:()=>d,hP:()=>_,jw:()=>U,wy:()=>k});a(16280);var r,i=a(296540),n=a(474848);const o={fullPage:!0,mobileNative:!0,mobileWeb:!0,commandSearch:!0,mobileNativeTab:!0,searchPane:!0,mobileSearch:!1,writer:!1,corner:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!1},s={fullPage:!0,mobileNative:!0,mobileWeb:!0,mobileNativeTab:!0,commandSearch:!1,searchPane:!1,mobileSearch:!1,writer:!1,corner:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!1},l={mobileNative:!0,mobileWeb:!0,mobileSearch:!0,mobileWriter:!0,mobileNativeTab:!0,fullPage:!1,writer:!1,corner:!1,searchPane:!1,commandSearch:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!1},c={writer:!0,mobileWriter:!0,mobileWeb:!1,mobileNative:!1,mobileSearch:!1,fullPage:!1,corner:!1,searchPane:!1,commandSearch:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1};function d(e){return c[e]}const m={corner:!0,searchPane:!0,fullPage:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,commandSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},h={corner:!0,searchPane:!0,fullPage:!0,mobileNative:!0,mobileWeb:!0,mobileSearch:!0,commandSearch:!0,mobileNativeTab:!0,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!1},g={corner:!0,searchPane:!0,fullPage:!0,mobileNative:!0,mobileNativeTab:!0,commandSearch:!0,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!0},u={corner:!0,searchPane:!0,fullPage:!0,commandSearch:!0,writer:!0,mobileWriter:!0,workflowEditor:!0,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},b={corner:!0,searchPane:!0,commandSearch:!0,mobileNative:!0,mobileSearch:!0,mobileWeb:!0,writer:!1,fullPage:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},f={corner:!0,writer:!0,mobileWriter:!0,fullPage:!1,searchPane:!1,commandSearch:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},p={corner:!0,fullPage:!0,searchPane:!0,mobileNative:!0,mobileNativeTab:!0,commandSearch:!0,mobileWeb:!0,mobileSearch:!0,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,inferenceTranscriptChatView:!1},w={corner:!0,fullPage:!0,searchPane:!1,mobileNative:!1,commandSearch:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},S={corner:!0,fullPage:!0,commandSearch:!1,searchPane:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},C={fullPage:!0,writer:!0,corner:!0,commandSearch:!1,searchPane:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},v={corner:!0,fullPage:!1,writer:!1,commandSearch:!1,searchPane:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},T={fullPage:!0,writer:!1,corner:!1,commandSearch:!1,searchPane:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},P={writer:!0,fullPage:!1,corner:!1,commandSearch:!1,searchPane:!1,mobileNative:!1,mobileWeb:!1,mobileSearch:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},y={corner:!0,fullPage:!1,searchPane:!1,mobileNative:!1,commandSearch:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},N={corner:!0,fullPage:!0,searchPane:!1,mobileNative:!1,commandSearch:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},F={fullPage:!0,corner:!1,searchPane:!1,mobileNative:!1,commandSearch:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},W={fullPage:!0,corner:!1,searchPane:!1,mobileNative:!1,commandSearch:!1,mobileWeb:!1,mobileSearch:!1,writer:!1,mobileWriter:!1,workflowEditor:!1,conflictingContentComment:!1,mobileNativeTab:!1,inferenceTranscriptChatView:!1},I={commandSearch:!1,searchPane:!1,fullPage:!0,writer:!0,corner:!0,mobileNative:!0,mobileWeb:!0,mobileSearch:!0,mobileWriter:!0,workflowEditor:!0,conflictingContentComment:!0,mobileNativeTab:!0,inferenceTranscriptChatView:!0};class k{constructor(e){this.type=e}get renderAsFullPage(){return o[this.type]}get renderChatHistoryAsFullPage(){return s[this.type]}get isCommandSearchOrSearchPane(){return this.isType("commandSearch")||this.isType("searchPane")}get isQuickSearchMode(){return this.isType("commandSearch")}get isMobile(){return l[this.type]}get isWriter(){return c[this.type]}isType(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.includes(this.type)}get shouldShowExpandToFullPageChat(){return m[this.type]}get isValidSurfaceForAttachmentUploads(){return g[this.type]}get shouldShowChatHistory(){return h[this.type]}get canUseCurrentPageContext(){return u[this.type]}get showCloseButton(){return b[this.type]}get surfaceSupportsContextWithSelection(){return f[this.type]}get surfaceSupportsParameterization(){return p[this.type]}get surfaceSupportsTutorialAction(){return w[this.type]}get surfaceSupportsShareAnswerAction(){return S[this.type]}get canShowNewChonkifiedInput(){return C[this.type]}canShowSessionStarterInContext(e){return k[e.from].isWriter===this.isWriter}get canUseUpdatedSkillDisplayFormat(){return y[this.type]}get canUseGetAiConnectorScopeMenuFooter(){return N[this.type]}get canShowNewFullPageWelcomeState(){return T[this.type]}get canShowNewWriterDesign(){return P[this.type]}get canShowNewCornerChatWelcomeState(){return v[this.type]}get supportsStartingNewChatAsInferenceTranscript(){return F[this.type]}get supportsChatHistoryWithInferenceTranscripts(){return W[this.type]}get shouldOpenAssistantMenuOnRestoreChatSession(){return I[this.type]}}r=k,k.fullPage=new r("fullPage"),k.corner=new r("corner"),k.searchPane=new r("searchPane"),k.commandSearch=new r("commandSearch"),k.mobileNative=new r("mobileNative"),k.mobileNativeTab=new r("mobileNativeTab"),k.writer=new r("writer"),k.mobileWeb=new r("mobileWeb"),k.mobileSearch=new r("mobileSearch"),k.mobileWriter=new r("mobileWriter"),k.workflowEditor=new r("workflowEditor"),k.inferenceTranscriptChatView=new r("inferenceTranscriptChatView"),k.conflictingContentComment=new r("conflictingContentComment");const D=i.createContext(void 0);function _(e){return(0,n.jsx)(D.Provider,{value:e.surface,children:e.children})}function U(){const e=i.useContext(D);return e||k.corner}D.displayName="AssistantSurfaceContext"},683821:(e,t,a)=>{a.d(t,{l:()=>l});var r=()=>a(56366),i=()=>a(234459),n=()=>a(890754),o=()=>a(765957),s=()=>a(630116);function l(e){const{threadId:t}=e,a=(0,r().O$)(o().AppStoreCurrentSpaceStore);if(a&&t&&t!==n().NEW_CHAT_THREAD_ID)return s().Ei.createChildStore(a,{table:i().To,id:t,spaceId:a.id})}},790068:(e,t,a)=>{a.d(t,{K:()=>o});var r=()=>a(81986),i=()=>a(915671),n=()=>a(217429);function o(e){const{store:t,searchScopes:a}=e,o=(0,r().MI)((0,r().VD)("custom_agents"),s),l=(0,r().MI)((0,r().VD)("agent_automations"),s),c=n().default.checkGate({gateName:"agent_codegen_integration"}),d=(0,r().MI)((0,r().VD)("agent_spawn"),s),m=(0,r().MI)((0,r().VD)("agent_multidb_creation"),s);return{type:"workflow",enableAgentAutomations:l,enableAgentIntegrations:(0,r().MI)((0,r().VD)("agent_integrations"),s),enableAgentSpawn:d,enableCodegenIntegration:c,enableCustomAgents:o,enableExperimentalIntegrations:(0,r().MI)((0,r().VD)("experimental_integrations"),s),enableMultiSourceDatabases:m,searchScopes:a??i().R2,workflowBlockId:"workflow"===(null==t?void 0:t.getType())?t.id:void 0}}function s(e){return n().default.checkGate({gateName:e})}},885789:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var r=a(296540),i=()=>a(56366),n=()=>a(166442),o=()=>a(631611),s=a(474848);const l=function(e){const t=(0,a(401497).IS)((e=>({wrap:{width:"100%",height:"100%",overflow:"hidden",padding:"36px 96px 48px 96px",fontSize:14,display:"flex",flexDirection:"column",alignItems:"start"},container:{width:"100%",flexGrow:1},agentName:{fontSize:16,fontWeight:600,color:e.text.primary,marginBottom:12}})),[]),[l,c]=(0,r.useState)(void 0),d=(0,r.useCallback)((e=>{c(null==e?void 0:e.id)}),[]),m=(0,a(324577).Y)(e.store),h=(0,a(58293).r)(),g=(0,i().K8)((()=>{if(!m||!e.store)return;if(!m.getData())return;return{...(0,a(790068).K)({store:e.store}),isCustomAgent:!0}}),[m,e.store]),u=(0,a(683821).l)({threadId:l}),b=(0,i().K8)((()=>u&&u.isDefined()&&!1===u.getAlive()),[u]),f=(0,i().K8)((()=>{if(!u)return[];const{steps:e}=(0,a(805126).A3)({clientStore:n().Kd,threadStore:u});return e}),[u]),p=(0,i().K8)((()=>{var e;return(null==m||null===(e=m.getData())||void 0===e?void 0:e.name)||"Notion AI"}),[m]);return g&&h&&!b?(0,s.jsx)(a(297872).A,{capture:!0,debugName:"WorkflowPageBlock",render:e=>(0,s.jsxs)("div",{style:t.wrap,...e,children:[(0,s.jsx)("div",{style:t.agentName,children:p}),(0,s.jsx)("div",{style:t.container,children:(0,s.jsx)(o().hP,{surface:o().wy.inferenceTranscriptChatView,children:(0,s.jsx)(a(277942).NV,{aiChatFeature:"custom_agent",threadStore:u,transcript:f,config:g,onThreadChange:d,clientStore:n().Kd,parentStore:h})})})]})}):null}},915671:(e,t,a)=>{a.d(t,{R2:()=>i,ZB:()=>r});const r={},i=[{type:"everything"}]}}]);