"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[7717],{45135:(e,t,i)=>{i.r(t),i.d(t,{ExperimentSettings:()=>z,ExperimentSettingsSection:()=>_});i(898992),i(354520),i(803949),i(581454);var r=i(296540),n=()=>i(484714),l=()=>i(56366),o=()=>i(523930),s=()=>i(715256),a=()=>i(831310),d=()=>i(668725),p=()=>i(735384),m=()=>i(959013),x=()=>i(381349),c=()=>i(534177),g=()=>i(284371),u=()=>i(449506),h=()=>i(722872),v=()=>i(217429),y=()=>i(686594),S=()=>i(493823),f=()=>i(760217),I=()=>i(406699),A=()=>i(285790),j=()=>i(297872),E=()=>i(623580),C=()=>i(187485),w=()=>i(331542),b=()=>i(928600),T=()=>i(939740),O=()=>i(864943),k=()=>i(824160),U=()=>i(228927),G=()=>i(89924),B=()=>i(843878),N=()=>i(8178),R=()=>i(702723),L=()=>i(987017),M=()=>i(317182),P=()=>i(401497);var F=i(474848);function z(){const e=(0,n().v3)(),[t,i]=(0,r.useState)(""),[a,d]=(0,r.useState)(void 0),[p,m]=(0,r.useState)([]),[x,h]=(0,r.useState)(0),[S,f]=(0,r.useState)(20),I=(0,l().K8)((()=>v().default.isStatsigEnabled()),[]),A=(0,l().K8)((()=>v().default.checkGate({gateName:"replace_local_overrides_with_statsig",disableExposureLogging:!0})),[]),j=(0,l().K8)((()=>I?function(){const e=new Map,t=y().A.getStatsigClient();return s().T_.forEach((i=>{var r;const n=null==t?void 0:t.getExperiment(i,{disableExposureLog:!0});e.set(i,{experimentId:i,group:v().default.getEligibleGroup({experimentId:i,defaultGroup:s().CJ,disableExposureLogging:!0}),hasStatsigUserOverride:(null==n||null===(r=n.ruleID)||void 0===r?void 0:r.endsWith(":userID:id_override"))||!1,groups:[...(0,s().XZ)(i),"control",s().CJ],statsigOption:"EXPERIMENT",isActive:y().A.getIsExperimentActive(i)})})),o().GI.forEach((i=>{var r;const n=null==t?void 0:t.getFeatureGate(i,{disableExposureLog:!0});e.set(i,{experimentId:i,group:v().default.checkGate({gateName:i,disableExposureLogging:!0}).toString(),hasStatsigUserOverride:(null==n||null===(r=n.ruleID)||void 0===r?void 0:r.endsWith(":id_override"))||!1,groups:["true","false"],statsigOption:"FEATUREGATE",isActive:!0})})),e}():new Map),[I]),C=(0,r.useMemo)((()=>[...j.values()]),[j]),b=(0,r.useMemo)((()=>C.filter((e=>e.hasStatsigUserOverride||p.includes(e.experimentId)))),[C,p]),T=(0,r.useMemo)((()=>C.filter((e=>!t||0===t.length||e.experimentId.includes(t))).sort(((e,t)=>e.experimentId>t.experimentId?1:-1))),[C,t]),k=(0,r.useMemo)((()=>C.filter((e=>!e.isActive)).length),[C]),G=(0,r.useMemo)((()=>T.filter((e=>!e.isActive))),[T]),{gate:B={},experiment:R={}}=y().A.getAllLocalOverrides()??{},M=[...Object.keys(B).map((e=>j.get(e))),...Object.keys(R).map((e=>j.get(e)))].filter(c().O9),z=(0,r.useCallback)((async(e,t)=>{m(e.map((e=>e.experimentId)));for(const i of e)"EXPERIMENT"===i.statsigOption&&i.group?await u().callApi({eventName:"setStatsigExperimentUserOverride",environment:t,data:{experimentName:i.experimentId,group:i.group}}):"FEATUREGATE"===i.statsigOption&&await u().callApi({eventName:"setStatsigGateUserOverride",environment:t,data:{gateName:i.experimentId,enabled:"true"===i.group}});y().A.removeAllLocalOverrides()}),[m]);(0,r.useEffect)((()=>{A&&M.length>0&&z(M,e)}),[A,e,z]);const _=(0,P().IS)((e=>({containerStyle:{width:"100%",overflow:"hidden"},filterContainerStyle:{marginLeft:"auto",flexGrow:1,maxWidth:300},description:{display:"flex",alignItems:"flex-start",cursor:"pointer",width:"100%",flexWrap:"wrap",fontSize:12,color:e.text.secondary,marginTop:2,marginBottom:16},headerContainer:{fontSize:14,display:"flex",alignItems:"center",paddingBottom:4},overridesHeaderContainer:{fontSize:14,display:"flex",alignItems:"center",paddingBottom:4,height:25},resetButtonContainerStyle:{marginLeft:"auto"}})),[]);return(0,F.jsxs)("div",{style:_.containerStyle,children:[(0,F.jsxs)(N().A,{large:!0,divider:"full",style:{marginBottom:4,paddingBottom:4,display:"flex"},children:["Experiments",(0,F.jsx)("div",{style:{marginLeft:"auto"},children:(0,F.jsx)(O().A,{style:{fontWeight:g().Wy.regular},size:"sm",onClick:()=>{const e=T.map((e=>{const t=e.group;return`${`${e.statsigOption}:${e.experimentId}`}\t${t}`})).join("\n");console.log(e)},children:null!=a&&a.reset?(0,F.jsx)(w().A,{}):"Print all to console"})})]}),(0,F.jsxs)("div",{style:_.description,children:[(0,F.jsx)("div",{children:A?"Set overrides for your user that affect the client and server. If setting an override is still showing old data, try refreshing the page.":"For server-side/production configs, go to console.statsig.com."}),(0,F.jsx)("div",{children:"If an experiment is marked as 'STALE', it is likely no longer active and should be cleaned up!"})]}),A?void 0:(0,F.jsxs)("div",{style:{marginBottom:20},children:[(0,F.jsxs)("div",{style:_.overridesHeaderContainer,children:[(0,F.jsx)("div",{style:{fontWeight:g().Wy.medium},children:"Local overrides"}),M.length>0?(0,F.jsx)("div",{style:_.resetButtonContainerStyle,children:(0,F.jsx)(O().A,{size:"sm",onClick:()=>{d({reset:!0}),y().A.removeAllLocalOverrides(),d(void 0)},children:null!=a&&a.reset?(0,F.jsx)(w().A,{}):"Clear overrides"})}):null]}),(0,F.jsx)(D,{experimentSettings:M,emptyPlaceholder:"No overridden values",experimentUpdatingState:a,setExperimentUpdatingState:d,overrideUpdates:p,setOverrideUpdates:m})]}),A?(0,F.jsxs)("div",{style:{marginBottom:20},children:[(0,F.jsx)("div",{style:_.overridesHeaderContainer,children:(0,F.jsx)("div",{style:{fontWeight:g().Wy.medium},children:"Statsig overrides"})}),(0,F.jsx)(D,{experimentSettings:b,emptyPlaceholder:"No overridden values from statsig",experimentUpdatingState:a,setExperimentUpdatingState:d,overrideUpdates:p,setOverrideUpdates:m,showDelete:!0})]}):void 0,(0,F.jsx)("div",{style:{..._.headerContainer,height:void 0},children:(0,F.jsx)(L().Ay,{style:{paddingLeft:0},tabs:[(0,F.jsx)("div",{children:`All (${C.length})`},"all"),(0,F.jsx)("div",{style:{display:"flex",alignItems:"center"},children:`Stale (${k})`},"stale")],selectedIndex:x,onChange:e=>h(e),right:(0,F.jsx)("div",{style:_.filterContainerStyle,children:(0,F.jsx)(E().A,{placeholder:"Search...",value:t,showClearButton:!0,autoCapitalize:"off",autoComplete:"off",onChange:e=>{i(e.target.value)}})})})}),(0,F.jsx)(D,{experimentSettings:"stale"===["all","stale"][x]?G:T,emptyPlaceholder:"No results",experimentUpdatingState:a,setExperimentUpdatingState:d,overrideUpdates:p,setOverrideUpdates:m,maxRenderSize:S,showStale:!0,hideTopBorderForFirstRow:!0}),(0,F.jsx)(U().A,{onChange:e=>{e<200&&f(S+50)}})]})}function D(e){let{experimentSettings:t,emptyPlaceholder:i,experimentUpdatingState:r,setExperimentUpdatingState:n,overrideUpdates:l,setOverrideUpdates:o,maxRenderSize:s,showDelete:a,showStale:d,hideTopBorderForFirstRow:p}=e;const m=(0,P().IS)((e=>({emptyState:{borderTop:`1px solid ${e.regularDividerColor}`,paddingTop:12,paddingLeft:10,paddingBottom:14,color:e.text.secondary,fontSize:12},experimentNameCell:{paddingLeft:10,paddingRight:10,flexGrow:1,flexShrink:1,overflow:"hidden"},experimentOverrideCell:{paddingLeft:10,paddingRight:10,display:"inline-flex",justifyContent:"space-between",flexGrow:1,flexShrink:0},tableStyle:{display:"block"},tableBodyStyle:{display:"block"},rowStyle:{overflow:"hidden",display:"flex",alignItems:"center"},tableExperimentIDHeaderStyle:{width:"auto"},tableExperimentGroupHeaderStyle:{width:"auto",textAlign:"right"}})),[]),x=[{key:"name",header:"Name",style:m.tableExperimentIDHeaderStyle},{key:"value",header:"Value",style:m.tableExperimentGroupHeaderStyle}];if(!t.length)return(0,F.jsx)("div",{style:m.emptyState,children:i});const c=s?t.slice(0,s):t;return(0,F.jsx)(M().A,{tableStyle:{borderTop:void 0,...m.tableStyle},tableBodyStyle:m.tableBodyStyle,rowStyle:m.rowStyle,cellStyle:e=>{let{columnIndex:t}=e;return 0===t?m.experimentNameCell:m.experimentOverrideCell},columns:x,hideHeader:!0,hideTopBorderForFirstRow:p,rows:c.map((e=>({key:e.experimentId,columns:[(0,F.jsx)(W,{name:e.experimentId,statsigType:e.statsigOption,isStale:d&&!e.isActive},`${e.experimentId}-title`),(0,F.jsx)($,{experiment:e,experimentUpdatingState:r,onUpdate:e=>{n(e),null!=e&&e.experimentId&&o([...l,null==e?void 0:e.experimentId])},onRefresh:()=>{o([]),window.location.reload()},refreshNeeded:l.includes(e.experimentId),showDelete:a,showStale:d},`${e.experimentId}-value`)]})))})}function _(e){const t=(0,P().IS)((e=>({PlainButtonStyle:{marginTop:12,marginBottom:4}})),[]);return(0,F.jsx)(R().A,{type:"custom",isMobile:!0,title:"Experiments",disableSettingsItemClick:!0,caption:"Locally toggle experiments.",shouldHighlight:!1,customButton:(0,F.jsx)(I().Ay,{popupType:I().z7.BottomSheet,renderOrigin:e=>(0,F.jsx)(O().A,{...e,size:"lg",style:t.PlainButtonStyle,children:"View Experiments"}),render:e=>{const t={menuType:h().gu.Modal,whiteBackground:!0,title:"Experiments",right:(0,F.jsx)(m().sA,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:e.close};return(0,F.jsx)(j().A,{capture:!0,allowEsc:!0,render:()=>(0,F.jsx)(b().A,{...t,children:(0,F.jsx)(B().Ay,{disableScroller:!0,children:(0,F.jsx)(z,{})})})})}})})}function W(e){const{statsigType:t,name:i,isStale:r}=e,l=function(e,t,i){return(0,P().IS)((r=>({experimentId:{flexShrink:1,marginRight:5,maxWidth:e?215:300,...g().RC,color:t?r.text.tertiary:void 0},experimentInfo:{display:"flex",flexDirection:e?"column":"row",alignItems:"center"},stalePill:{background:r.redBadgeBackground,color:"white"},typePill:{background:"FEATUREGATE"===i?r.palette.blue[100]:r.palette.green[100]}})),[e,t,i])}((0,n().Y0)().isMobile,r,t);return(0,F.jsxs)("div",{style:l.experimentInfo,children:[(0,F.jsx)("span",{style:l.experimentId,children:i}),t?(0,F.jsx)(k().A,{innerStyle:l.typePill,children:(0,F.jsx)(C().A,{href:`https://console.statsig.com/6TSma7coh47E7CjMbuSVCO/${"FEATUREGATE"===t?"gates":"experiments"}/${i}`,external:!0,children:`${t}`})}):void 0,(0,F.jsx)("div",{style:{marginLeft:4},children:r?(0,F.jsx)(k().A,{innerStyle:l.stalePill,children:"Stale"}):void 0})]})}function $(e){const{experiment:t,experimentUpdatingState:i,onUpdate:r,showDelete:o,showStale:c,refreshNeeded:j,onRefresh:E}=e,C=(0,m().tz)(),O=(0,n().v3)(),k=(0,n().Y0)().isMobile,U=(0,l().K8)((()=>v().default.checkGate({gateName:"replace_local_overrides_with_statsig",disableExposureLogging:!0})),[]),B=function(e,t,i){return(0,P().IS)((r=>({experimentGroup:{maxWidth:e?90:300,...g().RC,color:t&&i&&!i.isActive?r.text.tertiary:void 0},experimentGroupButtonCheckContainerStyle:{width:e?16:14},experimentGroupButtonChevronStyle:{width:10,marginLeft:4,fill:r.icon.tertiary},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left"},experimentGroupContainerStyle:{width:"100%",display:"flex",justifyContent:"flex-end",alignItems:"center"},refreshNeededText:{color:r.palette.red[500]},deleteIcon:{stroke:r.palette.red[400]}})),[e,t,i])}(k,c,t),N=(null==i?void 0:i.experimentId)===t.experimentId;return U&&!N&&j?(0,F.jsx)("div",{style:B.experimentGroupContainerStyle,children:(0,F.jsx)(S().p,{style:B.experimentGroupButtonStyle,onClick:async()=>{var e;const i=y().A.getStatsigClient(),n=null==i||null===(e=i.getContext())||void 0===e?void 0:e.user;i&&n&&(r({experimentId:t.experimentId,group:s().CJ}),await new Promise((e=>{setTimeout(e,5e3)})),await i.updateUserAsync(n),E&&E(),y().A.emit(),r(void 0))},children:(0,F.jsxs)("div",{style:B.refreshNeededText,children:["Refresh to update"," "]})})}):(0,F.jsxs)("div",{style:B.experimentGroupContainerStyle,children:[(0,F.jsx)(I().Ay,{popupType:k?I().z7.BottomSheet:I().z7.Popup,disabled:N,renderOrigin:e=>(0,F.jsx)(S().p,{...e,style:B.experimentGroupButtonStyle,children:N?(0,F.jsx)(w().A,{}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("span",{style:B.experimentGroup,children:t.group??"unknown"}),(0,d().b)(B.experimentGroupButtonChevronStyle)]})}),render:e=>{let n;n=k?{menuType:h().gu.Modal,title:t.experimentId,right:(0,F.jsx)(m().sA,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:e.close}:{menuType:h().gu.Popup,width:250};const l=t.groups.map((n=>{const l={key:n,action:()=>{var i;let l;U?"EXPERIMENT"===t.statsigOption?l=u().callApi({eventName:"setStatsigExperimentUserOverride",environment:O,data:{experimentName:t.experimentId,group:n}}):"FEATUREGATE"===t.statsigOption&&(l=u().callApi({eventName:"setStatsigGateUserOverride",environment:O,data:{gateName:t.experimentId,enabled:"true"===n}})):"EXPERIMENT"===t.statsigOption?l=new Promise((e=>{y().A.updateLocalOverrideConfig(t.experimentId,n),e(n)})):"FEATUREGATE"===t.statsigOption&&(l=new Promise((e=>{y().A.updateLocalOverrideGate(t.experimentId,"true"===n),e(n)}))),r({experimentId:t.experimentId,group:n}),e.close(),null===(i=l)||void 0===i||i.then((()=>{r(void 0)}))},render:e=>{const r=n===s().CJ;return(0,F.jsx)(f().A,{...e,title:n,right:i&&i.experimentId===t.experimentId&&i.group===n?(0,F.jsx)("div",{style:B.experimentGroupButtonCheckContainerStyle,children:(0,F.jsx)(w().A,{})}):n!==t.group||i?void 0:(0,F.jsx)("div",{style:B.experimentGroupButtonCheckContainerStyle,children:(0,a().o)()}),disabled:r,style:{...r&&{color:x().Ay.mediumTextColor}}})}};return l}));return(0,F.jsx)(b().A,{...n,children:(0,F.jsx)(T().Ay,{type:T().Oh.Vertical,initialFocus:void 0,sections:[{key:t.experimentId,render:e=>(0,F.jsx)(G().A,{...e}),items:l}]})})}}),o?(0,F.jsx)(A().A,{icon:p().I,iconStyle:B.deleteIcon,ariaLabel:C.formatMessage({id:"experimentSettings.deleteOverride",defaultMessage:"Delete override for {experimentId}"},{experimentId:t.experimentId}),onClick:async()=>{r({experimentId:t.experimentId,group:s().CJ}),"EXPERIMENT"===t.statsigOption?await u().callApi({eventName:"deleteStatsigExperimentUserOverride",environment:O,data:{experimentName:t.experimentId}}):"FEATUREGATE"===t.statsigOption&&await u().callApi({eventName:"deleteStatsigGateUserOverride",environment:O,data:{gateName:t.experimentId}}),r(void 0)}}):null]})}}}]);