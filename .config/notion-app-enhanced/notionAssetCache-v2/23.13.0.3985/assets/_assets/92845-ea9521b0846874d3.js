"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[92845],{192845:(e,t,o)=>{o.d(t,{G:()=>y,n:()=>R});o(944114),o(898992),o(354520),o(737550);var i=o.n(o(794148)),r=()=>o(496603),a=()=>o(534177),n=()=>o(300525),l=()=>o(443881),c=()=>o(792071),s=()=>o(696706),p=()=>o(728272),u=()=>o(179034),v=()=>o(519831);function d(e,t){i()(e.table===t,`Expected space shard record pointer of table ${t} but got ${e.table}`),i()((0,a().O9)(e.spaceId),"Expected space shard record pointer but missing spaceId")}const f={complete_sprint:e=>{const{config:t,preventClearingConfig:o,visitors:i}=e,n=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:n};const l=(0,r().mg)(t);if(t.sprint_collection){const e=i.visitRecordPointer(t.sprint_collection);if("replace"===e.type){if(e.value)d(e.value,v().Vl),n.add(e.value),l.sprint_collection=e.value;else if(!(0,a().O9)(e.value)&&!o)return{config:void 0,remappedRecordPointers:n}}else"keep"===e.type||(0,a().HB)(e)}if(t.task_collection){const e=i.visitRecordPointer(t.task_collection);if("replace"===e.type){if(e.value)d(e.value,v().Vl),n.add(e.value),l.task_collection=e.value;else if(!(0,a().O9)(e.value)&&!o)return{config:void 0,remappedRecordPointers:n}}else"keep"===e.type||(0,a().HB)(e)}return{config:l,remappedRecordPointers:n}},create_page:e=>{const{config:t,preventClearingConfig:o,visitors:i}=e;let n=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:n};const c=(0,r().mg)(t),f=c.collection;if(c.collection){const e=i.visitRecordPointer(c.collection);"replace"===e.type?e.value?(d(e.value,v().Vl),n.add(e.value),c.collection=e.value):(0,a().O9)(e.value)||(c.collection=void 0):"keep"===e.type||(0,a().HB)(e)}if(!o&&!c.collection)return{config:void 0,remappedRecordPointers:n};if(c.template_page_id){const e=c.template_page_id,t=i.visitRecordPointer(s().L3.fromPointerLike({id:c.template_page_id,table:u().ev}));"replace"===t.type?t.value?(d(t.value,u().ev),n.add(t.value),c.template_page_id=t.value.id):(0,a().O9)(t.value)||(c.template_page_id=void 0):"keep"===t.type||(0,a().HB)(t);(0,a().O9)(f)&&(0,a().O9)(c.collection)&&!s().L3.isEqualIdTable(f,c.collection)&&e===c.template_page_id&&(c.template_page_id=void 0)}if(c.properties&&c.properties.length>0){const e=[];for(const t of c.properties){const o=i.visitCollectionProperty(t);"replace"===o.type?(0,a().O9)(o.value)&&e.push(o.value):"keep"===o.type?e.push(t):(0,a().HB)(o)}c.properties=e}if(c.values){const t={};for(const[o,s]of Object.entries(c.values)){var m;const c=i.visitCollectionProperty(o),p="keep"===c.type?o:c.value;if(!p)continue;const u=(0,r().mg)(s);if((0,a().O9)(null==u||null===(m=u.value)||void 0===m?void 0:m.value)){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:u.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:i});u.value.value=o,n=n.union(t)}t[p]=u}c.values=t}return{config:c,remappedRecordPointers:n}},define_variables:e=>{const{config:t}=e;let o=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:o};const i=(0,r().mg)(t);if(!i.values)return{config:i,remappedRecordPointers:o};for(const r of Object.values(i.values)){if(!(0,a().O9)(r.value)||!r.value.value)continue;const{remappedRecordPointers:t,value:i}=(0,l().RI)({baseUrl:e.baseUrl,formula:r.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});r.value.value=i,o=o.union(t)}return{config:i,remappedRecordPointers:o}},duplicate_blocks:e=>({config:e.config,remappedRecordPointers:new(p().d)}),http_request:e=>({config:e.config,remappedRecordPointers:new(p().d)}),modal_confirmation:e=>{const{config:t}=e;let o=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:o};const i=(0,r().mg)(t);if(!i.text||!i.text.value)return{config:i,remappedRecordPointers:o};const{remappedRecordPointers:a,value:n}=(0,l().RI)({baseUrl:e.baseUrl,formula:i.text.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});return i.text.value=n,o=o.union(a),{config:i,remappedRecordPointers:o}},open_page:e=>{const{config:t,visitors:o}=e,i=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:i};const n=(0,r().mg)(t);if(!n.target)return{config:n,remappedRecordPointers:i};if("variable"===n.target.type){const e=o.visitFormulaContextValue(n.target.id);"replace"===e.type&&(e.value?n.target.id=e.value:n.target=void 0)}else if("page"===n.target.type){const e=o.visitRecordPointer(n.target.page);if("replace"===e.type){const t=e.value;t?(d(t,u().ev),i.add(t),n.target.page=t):n.target=void 0}}else"url"===n.target.type||(0,a().HB)(n.target);return{config:n,remappedRecordPointers:i}},publish_site:e=>({config:e.config,remappedRecordPointers:new(p().d)}),query_collection:e=>{const{config:t,preventClearingConfig:o,visitors:i}=e,l=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:l};const c=(0,r().mg)(t);if(!c.collection)return{config:void 0,remappedRecordPointers:l};const s=i.visitRecordPointer(c.collection);if("replace"===s.type){const e=s.value;e?(d(e,v().Vl),l.add(e),c.collection=e):c.collection=void 0}if(!o&&!c.collection)return{config:void 0,remappedRecordPointers:l};if(null!=c&&c.filter&&((0,n().w)(c.filter,(e=>{const t=i.visitRecordPointer(e);if("replace"===t.type){if((0,a().O9)(t.value))return l.add(t.value),t.value.id}else{if("keep"===t.type)return e.id;(0,a().HB)(t)}})),(0,n().d)(c.filter,(t=>{const o=e.visitors.visitCollectionProperty(t);return"replace"===o.type?o.value:"keep"===o.type?t:void(0,a().HB)(o)}))),null!=c&&c.sort&&c.sort.length>0){const t=[];for(const o of c.sort){const i=e.visitors.visitCollectionProperty(o.property);"replace"===i.type?(0,a().O9)(i.value)&&t.push({...o,property:i.value}):"keep"===i.type?t.push({...o}):(0,a().HB)(i)}c.sort=t}return{config:c,remappedRecordPointers:l}},send_gmail_notification:e=>{var t,o,i,a,n,c,s;const{config:u}=e;let v=new(p().d);if(!u)return{config:void 0,remappedRecordPointers:v};const d=(0,r().mg)(u);if(null!==(t=d.to)&&void 0!==t&&null!==(t=t.value)&&void 0!==t&&t.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.to.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.to.value.value=o,v=v.union(t)}if(null!==(o=d.cc)&&void 0!==o&&null!==(o=o.value)&&void 0!==o&&o.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.cc.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.cc.value.value=o,v=v.union(t)}if(null!==(i=d.bcc)&&void 0!==i&&null!==(i=i.value)&&void 0!==i&&i.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.bcc.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.bcc.value.value=o,v=v.union(t)}if(null!==(a=d.reply_to)&&void 0!==a&&null!==(a=a.value)&&void 0!==a&&a.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.reply_to.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.reply_to.value.value=o,v=v.union(t)}if(null!==(n=d.from_name)&&void 0!==n&&n.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.from_name.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.from_name.value=o,v=v.union(t)}if(null!==(c=d.email_subject)&&void 0!==c&&c.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.email_subject.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.email_subject.value=o,v=v.union(t)}if(null!==(s=d.email_body)&&void 0!==s&&s.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:d.email_body.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});d.email_body.value=o,v=v.union(t)}return{config:d,remappedRecordPointers:v}},send_in_app_notification:e=>{const{config:t,visitors:o}=e;let i=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:i};const n=(0,r().mg)(t);if(n.target){const t=n.target;if("property"===t.type){if(t.propertyId&&t.collectionPointer){const e=o.visitCollectionPropertyPointer({...t.collectionPointer,propertyId:t.propertyId});if("replace"===e.type){const t=e.value;if(t){d(t,v().Vl);const e=s().L3.fromSpaceShardRecordId({id:t.id,spaceId:t.spaceId},t.table);i.add(e),n.target={collectionPointer:e,propertyId:t.propertyId,type:"property"}}else(0,a().O9)(t)||(n.target=void 0)}else"keep"===e.type||(0,a().HB)(e)}}else if("formula"===t.type){if(t.value&&t.value.value){const{remappedRecordPointers:o,value:r}=(0,l().RI)({baseUrl:e.baseUrl,formula:t.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});t.value.value=r,i=i.union(o)}}else(0,a().HB)(t)}if(n.notification_message&&n.notification_message.value){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:n.notification_message.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});n.notification_message.value=o,i=i.union(t)}return{config:n,remappedRecordPointers:i}},slack_notification:e=>{const{sourceSpaceId:t,targetSpaceId:o}=e,i=new(p().d);return t!==o?{config:void 0,remappedRecordPointers:i}:{config:e.config,remappedRecordPointers:i}},update_pages:e=>{const{config:t,visitors:o}=e;let i=new(p().d);if(!t)return{config:void 0,remappedRecordPointers:i};const c=(0,r().mg)(t);if(!c.target)return{config:void 0,remappedRecordPointers:i};if(c.target)if("variable"===c.target.type){const e=o.visitFormulaContextValue(c.target.id);"replace"===e.type&&(e.value?c.target.id=e.value:c.target=void 0)}else if("page"===c.target.type){const e=o.visitRecordPointer(c.target.page);if("replace"===e.type){const t=e.value;t?(d(t,u().ev),i.add(t),c.target.page=t):c.target=void 0}}else if("collection"===c.target.type){var s,f;const t=o.visitRecordPointer(c.target.collection);if("replace"===t.type){const e=t.value;e?(d(e,v().Vl),i.add(e),c.target.collection=e):c.target=void 0}else"keep"===t.type||(0,a().HB)(t);if(null!==(s=c.target)&&void 0!==s&&s.filter&&((0,n().w)(c.target.filter,(e=>{const t=o.visitRecordPointer(e);if("replace"===t.type){if((0,a().O9)(t.value))return i.add(t.value),t.value.id}else{if("keep"===t.type)return e.id;(0,a().HB)(t)}})),(0,n().d)(c.target.filter,(t=>{const o=e.visitors.visitCollectionProperty(t);return"replace"===o.type?o.value:"keep"===o.type?t:void(0,a().HB)(o)}))),null!==(f=c.target)&&void 0!==f&&f.sort&&c.target.sort.length>0){const t=[];for(const o of c.target.sort){const i=e.visitors.visitCollectionProperty(o.property);"replace"===i.type?(0,a().O9)(i.value)&&t.push({...o,property:i.value}):"keep"===i.type?t.push({...o}):(0,a().HB)(i)}c.target.sort=t}}else(0,a().HB)(c.target);if(!e.preventClearingConfig&&!c.target)return{config:void 0,remappedRecordPointers:i};if(c.properties&&c.properties.length>0){const t=[];for(const o of c.properties){const i=e.visitors.visitCollectionProperty(o);"replace"===i.type?(0,a().O9)(i.value)&&t.push(i.value):"keep"===i.type?t.push(o):(0,a().HB)(i)}c.properties=t}if(c.values){const t={};for(const[o,n]of Object.entries(c.values??{})){var m;const c=e.visitors.visitCollectionProperty(o),s="keep"===c.type?o:c.value;if(!s)continue;const p=(0,r().mg)(n);if((0,a().O9)(null==p||null===(m=p.value)||void 0===m?void 0:m.value)){const{remappedRecordPointers:t,value:o}=(0,l().RI)({baseUrl:e.baseUrl,formula:p.value.value,publicDomainName:e.publicDomainName,spaceId:e.sourceSpaceId,visitors:e.visitors});p.value.value=o,i=i.union(t)}t[s]=p}c.values=t}return{config:c,remappedRecordPointers:i}}};function m(e){const{automationActionModel:t,baseUrl:o,preventClearingConfig:i,publicDomainName:r,sourceSpaceId:a,visitors:n}=e,l=t.getType(),c=t.getConfig(),s=function(e){return f[e]}(l);return s({baseUrl:o,config:c,preventClearingConfig:i,publicDomainName:r,sourceSpaceId:a,targetSpaceId:t.space_id,visitors:n})}function g(){return{type:"keep"}}function y(e){const{automationActionModel:t,baseUrl:o,preventClearingConfig:i,publicDomainName:r,sourceSpaceId:a,visitors:n}=e,l={visitCollectionProperty:n.visitCollectionProperty??g,visitCollectionPropertyPointer:n.visitCollectionPropertyPointer??g,visitFormulaContextValue:n.visitFormulaContextValue??g,visitFormulaPageProperty:n.visitFormulaPageProperty??g,visitRecordPointer:n.visitRecordPointer??g},{config:s,remappedRecordPointers:p}=m({automationActionModel:t,baseUrl:o,preventClearingConfig:i,publicDomainName:r,sourceSpaceId:a,visitors:l}),{model:u}=c().RUD.create({alive:!0,config:s??{},id:t.id,parent_id:t.parent_id,parent_table:t.parent_table,space_id:t.space_id,type:t.type,version:t.getVersion()});return{remappedRecordPointers:p,value:u}}const P={button:e=>({config:e.config,remappedRecordPointers:new(p().d)}),event:e=>{const{config:t,visitors:i}=e,l=new(p().d),c=(0,r().mg)(t);if(!c.event.source)return{config:c,remappedRecordPointers:l};if("collection"===c.event.source.type){const e=i.visitRecordPointer(c.event.source.pointer);if("replace"===e.type){const t=e.value;t?(d(t,v().Vl),l.add(t),c.event.source={pointer:t,type:"collection"}):c.event.source=void 0}}else if("collection_view"===c.event.source.type){const e=i.visitRecordPointer(c.event.source.pointer);if("replace"===e.type){const t=e.value;t?(d(t,o(869558).Gy),l.add(t),c.event.source={pointer:t,type:"collection_view"}):c.event.source=void 0}}else"filter"===c.event.source.type||(0,a().HB)(c.event.source);if("some"===c.event.pagePropertiesEdited.type){const t=[];for(const o of c.event.pagePropertiesEdited.some??[]){const l=(0,r().mg)(o),c=i.visitCollectionProperty(l.property);if("replace"===c.type){if(!(0,a().O9)(c.value))continue;l.property=c.value}else"keep"===c.type||(0,a().HB)(c);if("changes_to_any"!==l.filter.operator){const t={property:l.property,filter:l.filter};(0,n().w)(t,(e=>{const t=i.visitRecordPointer(e);if("replace"===t.type){if((0,a().O9)(t.value))return t.value.id}else{if("keep"===t.type)return e.id;(0,a().HB)(t)}})),(0,n().d)(t,(t=>{const o=e.visitors.visitCollectionProperty(t);return"replace"===o.type?o.value:"keep"===o.type?t:void(0,a().HB)(o)}))}t.push(l)}c.event.pagePropertiesEdited.some=t}else if("all"===c.event.pagePropertiesEdited.type){const t=[];for(const o of c.event.pagePropertiesEdited.all??[]){const l=(0,r().mg)(o),c=i.visitCollectionProperty(l.property);if("replace"===c.type){if(!(0,a().O9)(c.value))continue;l.property=c.value}else"keep"===c.type||(0,a().HB)(c);if("changes_to_any"!==l.filter.operator){const t={property:l.property,filter:l.filter};(0,n().w)(t,(e=>{const t=i.visitRecordPointer(e);if("replace"===t.type){if((0,a().O9)(t.value))return t.value.id}else{if("keep"===t.type)return e.id;(0,a().HB)(t)}})),(0,n().d)(t,(t=>{const o=e.visitors.visitCollectionProperty(t);return"replace"===o.type?o.value:"keep"===o.type?t:void(0,a().HB)(o)}))}t.push(l)}c.event.pagePropertiesEdited.all=t}else"none"===c.event.pagePropertiesEdited.type||"any"===c.event.pagePropertiesEdited.type||(0,a().HB)(c.event.pagePropertiesEdited);return{config:c,remappedRecordPointers:l}},recurrence:e=>({config:e.config,remappedRecordPointers:new(p().d)})};function b(e){const{automationModel:t,visitors:o}=e,i=t.getTriggerType(),r=t.getTrigger(),a=function(e){return P[e]}(i);return a({config:r,visitors:o})}function R(e){const{automationModel:t,visitors:o}=e,i={visitCollectionProperty:o.visitCollectionProperty??g,visitRecordPointer:o.visitRecordPointer??g},{remappedRecordPointers:r,config:a}=b({automationModel:t,visitors:i}),{model:n}=c().R$j.create({alive:!0,createdBy:t.getCreatedByPointer(),id:t.id,lastEditedBy:t.getLastEditedByPointer(),parent_id:t.parent_id,parent_table:t.parent_table,space_id:t.space_id,status:t.getStatus(),trigger:a,version:t.getVersion()});return{remappedRecordPointers:r,value:n}}},300525:(e,t,o)=>{o.d(t,{d:()=>l,w:()=>n});o(898992),o(354520),o(803949),o(581454);var i=()=>o(534177),r=()=>o(289915),a=()=>o(179034);function n(e,t){if(r().dU(e)){(e.filters||[]).forEach((e=>n(e,t)))}if(r().yX(e)){if(r().Pq(e.filter)){const o=e.filter;if("relation_contains"===o.operator||"relation_does_not_contain"===o.operator)if(Array.isArray(o.value)){const e=o.value.map((e=>{const o=e.type;if("exact"===o){const o=e.value;return{type:"exact",value:o&&t({table:a().ev,id:o})||o}}if("relative"===o)return e;(0,i().HB)(o)}));o.value=e}else{const e=o.value.type;if("exact"===e){const e=o.value.value;o.value.value=e&&t({table:a().ev,id:e})||e}else{if("relative"===e)return;(0,i().HB)(e)}}}if(r().s1(e.filter)){const o=e.filter.subfilter;if(r().Pq(o)){const e=o;if("relation_contains"===e.operator||"relation_does_not_contain"===e.operator)if(Array.isArray(e.value)){const o=e.value.map((e=>{const o=e.type;if("exact"===o){const o=e.value;return{type:"exact",value:o&&t({table:a().ev,id:o})||o}}if("relative"===o)return e;(0,i().HB)(o)}));e.value=o}else{const o=e.value.type;if("exact"===o){const o=e.value.value;e.value.value=o&&t({table:a().ev,id:o})||o}else{if("relative"===o)return;(0,i().HB)(o)}}}}}}function l(e,t){if(r().dU(e)){(e.filters||[]).forEach((e=>l(e,t)))}if(r().yX(e)){const o=t(e.property);o&&(e.property=o)}}}}]);