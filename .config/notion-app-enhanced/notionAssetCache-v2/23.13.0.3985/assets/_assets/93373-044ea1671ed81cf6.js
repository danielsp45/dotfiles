"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[93373],{217514:(e,t,n)=>{n.d(t,{m:()=>Be});n(16280),n(944114),n(898992),n(354520),n(672577),n(581454);var r=n(296540),a=()=>n(484714),o=()=>n(56366),s=()=>n(401497),i=()=>n(370657),l=()=>n(218602),d=()=>n(878456),c=()=>n(187174),p=()=>n(973238),u=()=>n(465505),m=()=>n(340498),g=n(474848);const h={viewBox:"0 0 20 20",fittedViewBox:"4.75 3.52 11.53 12.95",svg:(0,g.jsx)("path",{d:"m7.006 16.267 8.523-4.971a1.5 1.5 0 0 0 0-2.592L7.006 3.733A1.5 1.5 0 0 0 4.75 5.028v9.944a1.5 1.5 0 0 0 2.256 1.295"})},x=(0,m().wt)("mediaPlayFill",h);var f=()=>n(863330),y=()=>n(86465),v=()=>n(724639),b=()=>n(959013),j=()=>n(532659),C=()=>n(496603),T=()=>n(449506),S=()=>n(84817),k=()=>n(493823),I=()=>n(760217),A=()=>n(406699),w=()=>n(285790),M=()=>n(623580),O=()=>n(331542),R=()=>n(928600),B=()=>n(939740),N=()=>n(73332),P=()=>n(89924),D=()=>n(859428),L=()=>n(722872),z=()=>n(962730),E=()=>n(981928),F=()=>n(562936),K=()=>n(459129),W=()=>n(805126),$=()=>n(800204);var q=()=>n(236262),_=()=>n(377586);function V(e){const t=(0,b().tz)(),{expectations:n,onChange:a,transcript:o}=e,[i,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!1),p=(0,s().IS)((e=>({container:{padding:12,marginTop:16,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,backgroundColor:e.contentBackground},section:{marginBottom:16},sectionTitle:{fontSize:14,fontWeight:600,marginBottom:12,color:e.text.primary},topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,marginBottom:12},expectationItem:{display:"flex",flexDirection:"column",gap:4,marginBottom:8,padding:6,backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:4},expectationItemHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},formRow:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},formField:{display:"flex",alignItems:"center",gap:3,minWidth:"fit-content"},formLabel:{fontSize:13,color:e.darkTextColor,fontWeight:500,minWidth:30,flexShrink:0},select:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.contentBackground,color:e.text.primary,fontSize:13,minWidth:80},numberInput:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.contentBackground,color:e.text.primary,fontSize:13,width:50},textInput:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.contentBackground,color:e.text.primary,fontSize:13,width:"100%",minWidth:120},descriptionRow:{display:"flex",alignItems:"center",gap:3,width:"100%"},testButton:{display:"flex",alignItems:"center",gap:4},addButton:{display:"flex",alignItems:"center",gap:4},emptyState:{fontSize:12,color:e.darkTextColor,fontStyle:"italic",padding:8},testResultsPopup:{padding:12,width:400,minWidth:400,maxWidth:"none",maxHeight:300,overflowY:"auto"},testResultItem:{marginBottom:16,fontSize:13,color:e.darkTextColor,whiteSpace:"pre-wrap"},testResultTitle:{fontWeight:600,marginBottom:8,fontSize:14},failedTestButton:{backgroundColor:"#ffebee",color:"#d32f2f",padding:"4px 8px",borderRadius:4},successTestButton:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"4px 8px",borderRadius:4}})),[]),u=r.useMemo((()=>[...n.expect||[]]),[n.expect]),m=(0,r.useCallback)((()=>{const e={...n,expect:[...u,{toolType:"search",minTimes:0,maxTimes:void 0,description:""}]};a(e)}),[n,a,u]),h=(0,r.useCallback)((e=>{const t=[...u];t.splice(e,1);const r={...n,expect:t.length>0?t:void 0};a(r)}),[n,a,u]),x=(0,r.useCallback)(((e,t,r)=>{const o=[...u];o[e]={...o[e],[t]:r};const s={...n,expect:o};a(s)}),[n,a,u]),f=(0,r.useCallback)((()=>{if(o&&n.expect&&0!==n.expect.length){c(!0),l(null);try{const e=function(e,t){if(!e.expect||0===e.expect.length)return;const n={};for(const s of t)"agent-tool-result"===s.type&&s.toolType&&(0,$().U3)(s.toolType)&&(n[s.toolType]=(n[s.toolType]||0)+1);let r=0,a=0;const o=[];for(const s of e.expect){const e=n[s.toolType]||0,t=s.minTimes??0,i=s.maxTimes;r++;let l=!1;if(l=0===i?0===e:!(void 0!==i&&t>i)&&e>=t&&(void 0===i||e<=i),l)a++;else{let n;n=0===i?"never":void 0!==i?`${t}-${i} times`:`at least ${t} times`,o.push(`Expected ${s.toolType} ${n}, got ${e}${s.description?` (${s.description})`:""}`)}}return{score:a/r,maxScore:1,totalExpectations:r,metExpectations:a,violations:o,toolCounts:n}}(n,o);l(e||null)}catch(e){}finally{c(!1)}}}),[n,o]);return(0,g.jsxs)("div",{style:p.container,children:[(0,g.jsx)("div",{style:p.sectionTitle,children:"Expected Tools Editor"}),(0,g.jsxs)("div",{style:p.topbar,children:[(0,g.jsx)(k().p,{onClick:m,style:p.addButton,children:"Add Expected"}),(0,g.jsx)("div",{style:{display:"flex",gap:8},children:o&&u.length>0&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(k().p,{onClick:f,style:p.testButton,disabled:d,children:d?(0,g.jsx)(O().A,{}):"Test"}),i&&(0,g.jsx)(A().Ay,{renderOrigin:e=>(0,g.jsxs)(k().p,{...e,style:1===i.score?p.successTestButton:p.failedTestButton,children:[1===i.score?"✅ Test score: ":"❌ Test score: ",i.score.toFixed(2)]}),popupType:_().n.Popup,placementToOrigin:z().W.Bottom,render:()=>(0,g.jsxs)("div",{style:p.testResultsPopup,children:[(0,g.jsx)("div",{style:p.testResultTitle,children:"Test Results"}),(0,g.jsxs)("div",{style:p.testResultItem,children:[(0,g.jsx)("strong",{children:"Score: "}),`${i.score.toFixed(2)} (${i.metExpectations}/${i.totalExpectations} expectations met)`]}),i.violations.length>0&&(0,g.jsxs)("div",{style:p.testResultItem,children:[(0,g.jsx)("strong",{children:"Violations:"}),"\n",i.violations.map(((e,t)=>`• ${e}\n`)).join("")]}),(0,g.jsxs)("div",{style:p.testResultItem,children:[(0,g.jsx)("strong",{children:"Tool Counts:"}),"\n",Object.entries(i.toolCounts).length>0?Object.entries(i.toolCounts).map((e=>{let[t,n]=e;return`${t}: ${n}`})).join(", "):"none"]})]})})]})})]}),(0,g.jsx)(F().b,{label:"Visual editor",defaultOpen:!0,children:(0,g.jsx)("div",{style:p.section,children:u&&u.length>0?u.map(((e,n)=>(0,g.jsxs)("div",{style:p.expectationItem,children:[(0,g.jsxs)("div",{style:p.expectationItemHeader,children:[(0,g.jsxs)("div",{style:p.formField,children:[(0,g.jsx)("div",{style:p.formLabel,children:"Tool:"}),(0,g.jsx)("select",{style:p.select,value:e.toolType,onChange:e=>{const t=e.target.value;(0,$().U3)(t)&&x(n,"toolType",t)},children:[...$().yu].sort().map((e=>(0,g.jsx)("option",{value:e,children:e},e)))})]}),(0,g.jsx)(w().A,{icon:q().trashIcon,onClick:()=>h(n),ariaLabel:t.formatMessage({id:"aiInferenceTranscript.agentToolExpectationsEditor.removeExpectation",defaultMessage:"Remove tool expectation"})})]}),(0,g.jsxs)("div",{style:p.formRow,children:[(0,g.jsxs)("div",{style:p.formField,children:[(0,g.jsx)("div",{style:p.formLabel,children:"Min:"}),(0,g.jsx)("input",{type:"number",style:p.numberInput,value:e.minTimes??"",placeholder:"0",onChange:e=>x(n,"minTimes",e.target.value?parseInt(e.target.value):void 0)})]}),(0,g.jsxs)("div",{style:p.formField,children:[(0,g.jsx)("div",{style:p.formLabel,children:"Max:"}),(0,g.jsx)("input",{type:"number",style:p.numberInput,value:e.maxTimes??"",placeholder:"∞",onChange:e=>x(n,"maxTimes",e.target.value?parseInt(e.target.value):void 0)})]})]}),(0,g.jsxs)("div",{style:p.descriptionRow,children:[(0,g.jsx)("div",{style:p.formLabel,children:"Desc:"}),(0,g.jsx)("input",{type:"text",style:p.textInput,value:e.description??"",placeholder:"Description (optional)",onChange:e=>x(n,"description",e.target.value)})]})]},n))):(0,g.jsx)("div",{style:p.emptyState,children:"No tool expectations defined. Click 'Add Expectation' to add one."})})}),(0,g.jsx)(F().b,{label:"JSON editor",defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify({...n,expect:u.length>0?u:void 0},null,2)})})]})}n(430670);var G=()=>n(627503),J=()=>n(416726),U=()=>n(884107),H=()=>n(452558),X=()=>n(553965);const Y=(0,b().YK)({copy:{id:"aiInferenceTranscript.debug.copy",defaultMessage:"Copy"},copyTooltip:{id:"aiInferenceTranscript.debug.copyTooltip",defaultMessage:"Copy..."},input:{id:"aiInferenceTranscript.debug.copyInput",defaultMessage:"Input"},output:{id:"aiInferenceTranscript.debug.copyOutput",defaultMessage:"Output"},metadata:{id:"aiInferenceTranscript.debug.copyMetadata",defaultMessage:"Metadata"},tool:{id:"aiInferenceTranscript.debug.copyTool",defaultMessage:"Tool input"}});function Z(e){const{inference:t}=e,n=(0,a().v3)(),o=(0,b().tz)(),s="transcript"in t.input&&Array.isArray(t.input.transcript)?t.input.transcript:void 0,i=(0,r.useMemo)((()=>C().oE(null==s?void 0:s.flatMap((e=>{if("agent-inference"===e.type&&Array.isArray(e.value))return e.value.filter((e=>"tool_use"===e.type)).map((e=>({tool:e.name,input:e.content})))})))),[s]),l=async e=>{const t=await U().R.clipboardActions.load();t.copyString({environment:n,stringValue:e,copiedMessage:t.clipboardMessages.copiedToClipboard})},d=[(0,J().gy)({key:"copy",render:e=>(0,g.jsx)(P().A,{...e}),actions:C().oE([(0,J().Ls)({key:"input",displayName:Y.input,analyticsName:Y.input.defaultMessage,action:()=>l(JSON.stringify(t.input,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,g.jsx)(I().A,{...e,title:o.formatMessage(Y.input)})}),(0,J().Ls)({key:"output",displayName:Y.output,analyticsName:Y.output.defaultMessage,action:()=>l(JSON.stringify(t.expected,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,g.jsx)(I().A,{...e,title:o.formatMessage(Y.output)})}),(0,J().Ls)({key:"metadata",displayName:Y.metadata,analyticsName:Y.metadata.defaultMessage,action:()=>l(JSON.stringify(t.metadata,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,g.jsx)(I().A,{...e,title:o.formatMessage(Y.metadata)})}),i.length>0&&(0,J().uk)({key:"tools",displayName:Y.tool,analyticsName:"tools",validators:[],initialFocus:void 0,subActions:()=>[(0,J().gy)({key:"tools",render:e=>(0,g.jsx)(P().A,{...e}),actions:i.map((e=>({key:e.tool,displayName:e.tool,searchName:e.tool,shortcuts:void 0,analyticsName:e.tool,action:()=>l(e.input),validators:[],closeParentMenu:!0,render:t=>(0,g.jsx)(I().A,{...t,title:e.tool})})))})]})])})];return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:e=>(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("div",{children:o.formatMessage(Y.copyTooltip)}),placement:z().W.Top,render:t=>(0,g.jsx)(w().A,{...(0,X().A)(e,t),icon:G().a,ariaLabel:o.formatMessage(Y.copy)})}),render:e=>(0,g.jsx)(R().A,{menuType:L().gu.Popup,minWidth:220,children:(0,g.jsx)(H().A,{context:{blocks:[],environment:n,publicEditMode:void 0},sections:d,initialFocus:void 0})})})}var Q=()=>n(29037),ee=()=>n(589407),te=()=>n(554509);const ne=(0,b().YK)({debugOptions:{id:"aiInferenceTranscript.debugOverrides.title",defaultMessage:"Debug options"},showErrors:{id:"aiInferenceTranscript.debugOverrides.showErrors",defaultMessage:"Show errors"},skipFunctionTests:{id:"aiInferenceTranscript.debugOverrides.skipFunctionTests",defaultMessage:"Skip function tests"},promptCache:{id:"aiInferenceTranscript.debugOverrides.promptCache",defaultMessage:"Prompt cache"},none:{id:"aiInferenceTranscript.debugOverrides.none",defaultMessage:"None"},redis:{id:"aiInferenceTranscript.debugOverrides.redis",defaultMessage:"Redis"},s3:{id:"aiInferenceTranscript.debugOverrides.s3",defaultMessage:"S3"}});function re(e){const{clientStore:t}=e,n=(0,a().v3)(),i=(0,b().tz)(),l=(0,s().IS)((e=>({iconButton:{width:20,height:20,fill:e.icon.primary}})),[]),d=(0,o().K8)((()=>t.state.debugOverrides),[t]),c=(0,r.useCallback)((()=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,emitDebugErrors:!t.state.debugOverrides.emitDebugErrors}})}),[t]),p=(0,r.useCallback)((()=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,fastWorkflowBuilds:!t.state.debugOverrides.fastWorkflowBuilds}})}),[t]),u=(0,r.useCallback)((e=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,usePromptCache:"none"===e?void 0:e}})}),[t]),m=d.usePromptCache||"none",h=[(0,J().gy)({key:"debug",render:e=>(0,g.jsx)(P().A,{...e}),actions:[(0,J().Ls)({key:"emitDebugErrors",displayName:ne.showErrors,analyticsName:ne.showErrors.defaultMessage,action:()=>c(),validators:[],closeParentMenu:!1,render:e=>(0,g.jsx)(I().A,{...e,title:i.formatMessage(ne.showErrors),right:d.emitDebugErrors&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,J().Ls)({key:"fastWorkflowBuilds",displayName:ne.skipFunctionTests,analyticsName:ne.skipFunctionTests.defaultMessage,action:()=>p(),validators:[],closeParentMenu:!1,render:e=>(0,g.jsx)(I().A,{...e,title:i.formatMessage(ne.skipFunctionTests),right:d.fastWorkflowBuilds&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,J().uk)({key:"promptCache",displayName:ne.promptCache,analyticsName:"promptCache",validators:[],initialFocus:void 0,right:(0,g.jsx)(te().D,{colorName:"tertiary",children:"none"===m?(0,g.jsx)(b().sA,{...ne.none}):"redis"===m?(0,g.jsx)(b().sA,{...ne.redis}):(0,g.jsx)(b().sA,{...ne.s3})}),subActions:()=>[(0,J().gy)({key:"cache",render:e=>(0,g.jsx)(P().A,{...e}),actions:[(0,J().Ls)({key:"none",displayName:ne.none,analyticsName:ne.none.defaultMessage,action:()=>u("none"),validators:[],closeParentMenu:!1,render:e=>(0,g.jsx)(I().A,{...e,title:i.formatMessage(ne.none),right:"none"===m&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,J().Ls)({key:"redis",displayName:ne.redis,analyticsName:ne.redis.defaultMessage,action:()=>u("redis"),validators:[],closeParentMenu:!1,render:e=>(0,g.jsx)(I().A,{...e,title:i.formatMessage(ne.redis),right:"redis"===m&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,J().Ls)({key:"s3",displayName:ne.s3,analyticsName:ne.s3.defaultMessage,action:()=>u("s3"),validators:[],closeParentMenu:!1,render:e=>(0,g.jsx)(I().A,{...e,title:i.formatMessage(ne.s3),right:"s3"===m&&(0,Q().checkmarkIcon)({width:12,height:12})})})]})]})]})];return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:e=>(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("div",{children:"Debug options"}),placement:z().W.Top,render:t=>(0,g.jsx)(w().A,{...(0,X().A)(e,t),icon:ee().L,iconStyle:l.iconButton,ariaLabel:i.formatMessage(ne.debugOptions)})}),render:e=>(0,g.jsx)(R().A,{menuType:L().gu.Popup,minWidth:220,children:(0,g.jsx)(H().A,{context:{blocks:[],environment:n,publicEditMode:void 0},sections:h,initialFocus:void 0})})})}n(803949);var ae=n(440961),oe=()=>n(805751);function se(e){const{collapseAll:t,collapseAgentMessages:n,uncollapseAll:r,allMessagesCollapsed:a,agentMessagesCollapsed:o,hasCollapsedMessages:s}=e,i=e=>({padding:"4px 8px",border:"1px solid #ddd",backgroundColor:e?"#f5f5f5":"white",color:e?"#999":"#666",borderRadius:4,fontSize:11,cursor:e?"not-allowed":"pointer",userSelect:"none",opacity:e?.6:1});return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{style:i(a),onClick:a?void 0:t,type:"button",title:a?"All messages are already collapsed":"Collapse all messages",disabled:a,children:"Collapse all"}),(0,g.jsx)("button",{style:i(o),onClick:o?void 0:n,type:"button",title:o?"All agent messages are already collapsed":"Collapse only agent and tool messages",disabled:o,children:"Collapse agent messages"}),(0,g.jsx)("button",{style:i(!s),onClick:s?r:void 0,type:"button",title:s?"Expand all messages":"No messages are collapsed",disabled:!s,children:"Uncollapse all"})]})}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(737550);function ie(e){const{messages:t}=e,[n,a]=(0,r.useState)((()=>{const e=new Set;return t.forEach(((t,n)=>{if("user"!==t.type.toLowerCase()&&e.add(n),"content"in t&&Array.isArray(t.content)){t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type))&&e.add(n)}})),e})),o=(0,r.useCallback)((e=>{a((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),i=(0,r.useCallback)((()=>{const e=new Set;t.forEach(((t,n)=>{e.add(n)})),a(e)}),[t]),l=(0,r.useCallback)((()=>{const e=new Set;t.forEach(((t,n)=>{const r=t.type.toLowerCase();if("assistant"!==r&&"system"!==r||e.add(n),"content"in t&&Array.isArray(t.content)){t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type))&&e.add(n)}})),a(e)}),[t]),d=(0,r.useCallback)((()=>{a(new Set)}),[]),c=n.size>0,p=(0,r.useMemo)((()=>t.some(((e,t)=>!n.has(t)))),[t,n]),u=(0,r.useMemo)((()=>{let e=!1,r=!1;return t.forEach(((t,a)=>{const o=t.type.toLowerCase(),s="assistant"===o||"system"===o,i="content"in t&&Array.isArray(t.content)&&t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type)),l=s||i,d=n.has(a);l&&!d&&(e=!0),!l&&d&&(r=!0)})),e||r}),[t,n]),{onCollapseStateChange:m}=e;r.useEffect((()=>{m&&m({collapseAll:i,collapseAgentMessages:l,uncollapseAll:d,allMessagesCollapsed:!p,agentMessagesCollapsed:!u,hasCollapsedMessages:c})}),[m,i,l,d,p,u,c]);const h=(0,s().IS)((e=>({chatContainer:{display:"flex",flexDirection:"column",gap:12,height:"100%",overflow:"visible",padding:12},messageContainer:{display:"flex",flexDirection:"column",gap:4},messageHeader:{display:"flex",alignItems:"center",gap:8,fontSize:12,fontWeight:600,cursor:"pointer",padding:"4px 0",borderRadius:4},messageHeaderClickable:{background:"none",border:"none",padding:0,margin:0,display:"flex",alignItems:"center",gap:8,cursor:"pointer",width:"100%",textAlign:"left"},messageRole:{padding:"2px 6px",borderRadius:4,fontSize:10,fontWeight:600,textTransform:"uppercase",cursor:"pointer",userSelect:"none"},systemRole:{backgroundColor:e.regularDividerColor,color:e.text.secondary},userRole:{backgroundColor:"#2563eb",color:"white"},assistantRole:{backgroundColor:"#16a34a",color:"white"},toolResultRole:{backgroundColor:"#ea580c",color:"white"},toolUseRole:{backgroundColor:"#eab308",color:"white"},unknownRole:{backgroundColor:e.text.secondary,color:e.contentBackground},toolName:{fontWeight:"bold",marginLeft:8,color:e.text.primary},messageContent:{fontSize:13,lineHeight:1.4,color:e.text.primary,whiteSpace:"pre-wrap",backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,padding:8,overflow:"scroll"},cacheIndicator:{fontSize:10,color:e.text.secondary,fontStyle:"italic"},collapsedIndicator:{fontSize:10,color:e.text.secondary,fontStyle:"italic",marginLeft:8,background:"none",border:"none",padding:0,cursor:"pointer"},multiContentItem:{display:"flex",flexDirection:"column",gap:4,marginBottom:8},contentType:{fontSize:10,color:e.text.secondary,fontFamily:"monospace"}})),[]),x=function(e){let t=arguments.length>2?arguments[2]:void 0;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&t)switch(t){case"tool_result":return{...h.messageRole,...h.toolResultRole};case"tool_use":return{...h.messageRole,...h.toolUseRole};default:return{...h.messageRole,...h.unknownRole}}switch(e.toLowerCase()){case"system":return{...h.messageRole,...h.systemRole};case"user":return{...h.messageRole,...h.userRole};case"assistant":return{...h.messageRole,...h.assistantRole};default:return{...h.messageRole,...h.unknownRole}}},f=e=>{try{if("tool_use"===e.type)return JSON.stringify(JSON.parse(e.content),null,2)}catch(t){}return"content"in e?e.content:JSON.stringify(e,null,2)};return t&&0!==t.length?(0,g.jsxs)("div",{style:h.chatContainer,children:[t.map(((e,t)=>{var a,s,i;const l=n.has(t),d=function(e){const{type:t}=e;if(t&&"toolName"in e&&e.toolName)return{type:t,name:e.toolName};if(t&&"name"in e&&e.name)return{type:t,name:e.name};if(t&&"content"in e&&Array.isArray(e.content)){const n=e.content.filter((e=>"tool_result"===e.type||"tool_use"===e.type)).map((e=>({type:e.type,name:"name"in e&&e.name||"toolName"in e&&e.toolName||void 0})));if(n.length>0)return{type:t,toolItems:n}}return{type:t}}(e);return(0,g.jsxs)("div",{style:h.messageContainer,children:[(0,g.jsx)("button",{style:h.messageHeaderClickable,onClick:()=>o(t),type:"button",children:(0,g.jsxs)("div",{style:h.messageHeader,children:[!(null!==(a=d.toolItems)&&void 0!==a&&a.length)&&(0,g.jsx)("span",{style:{...x(d.type),border:"none"},children:d.type}),d.name&&!(null!==(s=d.toolItems)&&void 0!==s&&s.length)&&(0,g.jsx)("span",{style:h.toolName,children:d.name}),null===(i=d.toolItems)||void 0===i?void 0:i.map(((e,t)=>(0,g.jsxs)(r.Fragment,{children:[(0,g.jsx)("span",{style:{...x("",!0,e.type),border:"none",marginLeft:t>0?8:0},children:"tool_result"===e.type?"Tool result":"Tool use"}),e.name&&(0,g.jsx)("span",{style:h.toolName,children:e.name})]},t))),e.do_cache&&(0,g.jsx)("span",{style:h.cacheIndicator,children:"• cached"}),l&&(0,g.jsx)("span",{style:h.collapsedIndicator,children:"Collapsed"})]})}),!l&&(c=e.content,"string"==typeof c?(0,g.jsx)("div",{style:h.messageContent,children:c}):Array.isArray(c)?(0,g.jsx)("div",{style:h.messageContent,children:c.map(((e,t)=>(0,g.jsxs)("div",{style:h.multiContentItem,children:[(0,g.jsxs)("div",{style:h.contentType,children:["Type: ",e.type,"name"in e?`: ${e.name}`:"","toolName"in e?`: ${e.toolName}`:""]}),(0,g.jsx)("div",{children:f(e)})]},t)))}):(0,g.jsx)("div",{style:h.messageContent,children:"Invalid content format"}))]},t);var c})),(0,g.jsx)("div",{style:{height:24},children:" "})]}):(0,g.jsx)("div",{style:h.chatContainer,children:(0,g.jsx)("div",{style:{color:"#666",fontStyle:"italic"},children:"No messages to display - currently not supported for live transcripts, you may need to load from a log"})})}function le(e){var t,n,a,o,i;const{inference:d,trigger:c}=e,[p,u]=(0,r.useState)(!1),m=(0,r.useRef)(null),[h,x]=(0,r.useState)(void 0),f=(0,r.useCallback)((()=>u(!0)),[]),y=(0,r.useCallback)((()=>u(!1)),[]);(0,r.useEffect)((()=>{if(!p)return;const e=e=>{"Escape"===e.key&&y()};return document.addEventListener("keydown",e),m.current&&m.current.focus(),()=>{document.removeEventListener("keydown",e)}}),[p,y]);const v=(0,s().IS)((e=>({backdrop:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center",padding:20},dialogContainer:{width:"95vw",maxWidth:1400,height:"90vh",backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},header:{padding:"16px 20px",borderBottom:`1px solid ${e.regularDividerColor}`,fontSize:16,fontWeight:600,color:e.text.primary,display:"flex",alignItems:"center",justifyContent:"space-between"},headerTitle:{flex:"0 0 auto"},headerControls:{display:"flex",gap:8,alignItems:"center"},content:{display:"flex",height:"100%",overflow:"hidden"},leftPanel:{flex:"0 0 60%",display:"flex",flexDirection:"column",borderRight:`1px solid ${e.regularDividerColor}`,minWidth:0},rightPanel:{flex:"0 0 40%",display:"flex",flexDirection:"column",overflow:"auto",padding:"16px 20px",gap:16,minWidth:0},transcriptContainer:{flex:1,overflow:"auto",padding:"16px 20px",minHeight:0},section:{display:"flex",flexDirection:"column",gap:8},sectionTitle:{fontSize:14,fontWeight:600,color:e.text.primary,borderBottom:`1px solid ${e.regularDividerColor}`,paddingBottom:4},toggle:{border:"none",padding:0,margin:0},metadataGrid:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px 16px",fontSize:12,fontFamily:"monospace"},metadataKey:{color:e.text.secondary,fontWeight:600},metadataValue:{color:e.text.primary,wordBreak:"break-all"},braintrustLink:{color:e.text.primary,textDecoration:"underline",cursor:"pointer",wordBreak:"break-all"},toolsList:{display:"flex",flexDirection:"column",gap:2}})),[]),b=(0,r.useMemo)((()=>d.metadata||{}),[d.metadata]),j=(0,r.useMemo)((()=>{if(b.renderedPrompt&&Array.isArray(b.renderedPrompt)){const t=[...b.renderedPrompt];return d.expected&&t.push({type:"assistant",content:(e=d.expected,"string"==typeof e||Array.isArray(e)?e:JSON.stringify(e,null,2)),name:"Output"}),t}var e;return null}),[b,d.expected]),C=(0,r.useMemo)((()=>b.tools||[]),[b]),T=(0,r.useCallback)((e=>`https://www.braintrust.dev/app/Notion/p/${(0,l().W)({environmentName:"production",suffix:"workflow"})}/logs?r=${e}`),[]),S=(0,r.useCallback)((e=>{const t=T(e);window.open(t,"_blank")}),[T]),k=(0,r.useMemo)((()=>{const e="transcript"in d.input&&Array.isArray(d.input.transcript)?d.input.transcript:void 0,t=new Map;return null==e||e.forEach((e=>{"agent-tool-result"===e.type&&e.toolName&&t.set(e.toolName,(t.get(e.toolName)||0)+1)})),t}),[d.input]),I=p?(0,g.jsx)("div",{style:v.backdrop,onClick:e=>{e.target===e.currentTarget&&y()},role:"presentation",children:(0,g.jsx)(oe().A,{debugName:"InferenceMetadataDialog",capture:!0,allowEsc:!0,allowSearch:!1,children:(0,g.jsxs)("div",{ref:m,style:v.dialogContainer,role:"dialog","aria-label":"Inference Details",tabIndex:-1,children:[(0,g.jsxs)("div",{style:v.header,children:[(0,g.jsx)("div",{style:v.headerTitle,children:"Inference Details"}),(0,g.jsx)("div",{style:v.headerControls,children:h&&(0,g.jsx)(se,{collapseAll:h.collapseAll,collapseAgentMessages:h.collapseAgentMessages,uncollapseAll:h.uncollapseAll,allMessagesCollapsed:h.allMessagesCollapsed,agentMessagesCollapsed:h.agentMessagesCollapsed,hasCollapsedMessages:h.hasCollapsedMessages})})]}),(0,g.jsxs)("div",{style:v.content,children:[(0,g.jsx)("div",{style:v.leftPanel,children:(0,g.jsx)("div",{style:v.transcriptContainer,children:(0,g.jsx)(ie,{messages:j??[],onCollapseStateChange:x})})}),(0,g.jsxs)("div",{style:v.rightPanel,children:[(0,g.jsxs)("div",{style:v.section,children:[(0,g.jsx)("div",{style:v.sectionTitle,children:"Basic Information"}),(0,g.jsxs)("div",{style:v.metadataGrid,children:[(0,g.jsx)("div",{style:v.metadataKey,children:"ID:"}),(0,g.jsx)("div",{style:v.metadataValue,children:d.id||"N/A"}),(0,g.jsx)("div",{style:v.metadataKey,children:"Input Type:"}),(0,g.jsx)("div",{style:v.metadataValue,children:(null===(t=d.input)||void 0===t?void 0:t.type)||"N/A"}),(null==b?void 0:b.aiSessionId)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:v.metadataKey,children:"AI Session ID:"}),(0,g.jsx)("div",{style:v.metadataValue,children:String(b.aiSessionId)})]}),(null==b?void 0:b.aiTraceId)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:v.metadataKey,children:"AI Trace ID:"}),(0,g.jsx)("button",{style:{...v.braintrustLink,background:"none",border:"none",padding:0,textAlign:"left",font:"inherit"},onClick:()=>S(String(b.aiTraceId)),title:"Click to open in Braintrust",type:"button",children:String(b.aiTraceId)})]}),(null==b?void 0:b.modelInfo)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:v.metadataKey,children:"Model:"}),(0,g.jsx)("div",{style:v.metadataValue,children:(null===(n=b.modelInfo)||void 0===n?void 0:n.notionName)||(null===(a=b.modelInfo)||void 0===a?void 0:a.vendorName)||"N/A"})]}),(null==b||null===(o=b.completionMetrics)||void 0===o?void 0:o.tokens)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:v.metadataKey,children:"Input Tokens:"}),(0,g.jsx)("div",{style:v.metadataValue,children:String(b.completionMetrics.tokens.inputTokens)||"N/A"}),(0,g.jsx)("div",{style:v.metadataKey,children:"Output Tokens:"}),(0,g.jsx)("div",{style:v.metadataValue,children:String(b.completionMetrics.tokens.outputTokens)||"N/A"})]}),(null==b||null===(i=b.completionMetrics)||void 0===i?void 0:i.finishReason)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:v.metadataKey,children:"Finish Reason:"}),(0,g.jsx)("div",{style:v.metadataValue,children:(e=>{const t=String(b.completionMetrics.finishReason),n=null==b||null===(e=b.completionMetrics)||void 0===e?void 0:e.toolName;return"tool_use"===t&&n?`${t}: ${n}`:t})()})]})]})]}),C&&C.length>0&&(0,g.jsxs)("div",{style:v.section,children:[(0,g.jsx)("div",{style:v.sectionTitle,children:"Tools"}),(0,g.jsx)("div",{style:v.toolsList,children:C.map(((e,t)=>{const n=(null==e?void 0:e.name)||`Tool ${t+1}`,r=k.get(n)||0;return(0,g.jsx)(F().b,{label:n,right:r>0?(0,g.jsx)("span",{style:{fontSize:10,fontWeight:"bold",color:"#666"},children:1===r?"(ran)":`(ran x${r})`}):void 0,style:v.toggle,defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(e,null,2)})},t)}))})]}),(0,g.jsxs)("div",{style:v.section,children:[(0,g.jsx)("div",{style:v.sectionTitle,children:"Raw Values"}),(0,g.jsx)(F().b,{label:"Input",style:v.toggle,defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(d.input,null,2)})}),d.expected&&(0,g.jsx)(F().b,{label:"Output",style:v.toggle,defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(d.expected,null,2)})}),b&&Object.keys(b).length>0&&(0,g.jsx)(F().b,{label:"Raw Metadata",style:v.toggle,defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(b,null,2)})})]})]})]})]})})}):null;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{onClick:f,style:{cursor:"pointer",background:"none",border:"none",padding:0,margin:0,flexGrow:1,textAlign:"left",display:"flex"},type:"button","aria-label":"Open inference metadata dialog",children:c}),I&&(0,ae.createPortal)(I,document.body)]})}n(823215),n(908872);var de=()=>n(735384),ce=()=>n(725614),pe=()=>n(297872);function ue(e){const[t,n]=(0,r.useState)(!1),o=(0,a().v3)(),{onFocus:s,onBlur:i,...l}=e,d=e=>{ce().clear({environment:o}),n(!0),null==s||s(e)},c=e=>{n(!1),null==i||i(e)};return(0,g.jsx)(pe().A,{capture:t,render:e=>(0,g.jsx)(M().A,{...l,...e,onFocus:d,onBlur:c})})}function me(e){const t=(0,b().tz)(),{request:n,memories:o,clientStore:i,onChange:l}=e,d=(0,a().v3)(),[c,p]=(0,r.useState)(!1),[u,m]=(0,r.useState)(0),h=(0,s().IS)((e=>({topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},status:{marginRight:2},formContainer:{display:"flex",flexDirection:"column",gap:12,padding:"12px 0"},formRow:{display:"flex",flexDirection:"column",gap:4},formLabel:{fontSize:12,color:e.darkTextColor,fontWeight:500},popupContent:{padding:16,minWidth:300},buttonRow:{display:"flex",gap:8},container:{padding:12,marginTop:16,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,backgroundColor:e.contentBackground},sectionTitle:{fontSize:14,fontWeight:600,marginBottom:12,color:e.text.primary},testResultsPopup:{padding:12,width:400,minWidth:400,maxWidth:"none",maxHeight:300,overflowY:"auto"},testResultItem:{marginBottom:16,fontSize:13,color:e.darkTextColor,whiteSpace:"pre-wrap"},testResultTitle:{fontWeight:600,marginBottom:8,fontSize:14},failedTestButton:{backgroundColor:"#ffebee",color:"#d32f2f",padding:"4px 8px",borderRadius:4},successTestButton:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"4px 8px",borderRadius:4},memorySelector:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},memorySelect:{padding:"4px 8px",borderRadius:4,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.contentBackground,color:e.text.primary},addMemoryButton:{display:"flex",alignItems:"center",gap:4}})),[]),[x,f]=(0,r.useState)(""),y=(0,r.useCallback)(((e,t)=>{const n=[...o];n[u]={...n[u],[e]:t},l(n)}),[o,u,l]),v=(0,r.useCallback)((()=>{const e=o.filter(((e,t)=>t!==u));l(e),m(Math.min(u,e.length-1))}),[o,u,l]),j=(0,r.useCallback)((()=>{l([...o,{testTitle:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],originalOutput:"",feedback:"",correctedOutputs:[],verified:!1,isOptional:!1}]),m(o.length)}),[o,l]),C=(0,r.useCallback)((async()=>{x.trim()&&(p(!0),await(0,K().Wd)({environment:d,request:n,memory:{...o[u],feedback:x},clientStore:i,onChange:e=>{const t=[...o];t[u]=e,l(t)}}),f(""),p(!1))}),[d,n,o,u,i,l,x]),T=(0,r.useCallback)((async()=>{p(!0),await(0,K().VZ)({environment:d,request:n,memory:o[u],clientStore:i,onChange:e=>{const t=[...o];t[u]=e,l(t)}}),p(!1)}),[d,n,o,u,i,l]),S=o[u];return(0,g.jsxs)("div",{style:h.container,children:[(0,g.jsx)("div",{style:h.sectionTitle,children:"Memory Editor"}),(0,g.jsxs)("div",{style:h.memorySelector,children:[(0,g.jsx)("select",{style:h.memorySelect,value:u,onChange:e=>m(Number(e.target.value)),children:o.map(((e,t)=>{return(0,g.jsxs)("option",{value:t,children:["Memory ",t+1,": ",(n=e.testTitle||"Untitled",n.length>24?`${n.slice(0,24)}...`:n)]},t);var n}))}),(0,g.jsx)(k().p,{onClick:j,style:h.addMemoryButton,children:"Add Memory"})]}),S&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{style:h.topbar,children:[(0,g.jsx)("div",{style:h.status,children:c?(0,g.jsx)(O().A,{}):S.originalOutputTestResults.length>0?(0,g.jsx)(A().Ay,{renderOrigin:e=>(0,g.jsxs)(k().p,{...e,style:S.originalOutputTestResults.every((e=>1===e.score))?h.successTestButton:h.failedTestButton,children:[S.originalOutputTestResults.every((e=>1===e.score))?"✅ Test score: ":"❌ Test score: ",(S.originalOutputTestResults.reduce(((e,t)=>e+t.score),0)/S.originalOutputTestResults.length).toFixed(2)]}),popupType:_().n.Popup,placementToOrigin:z().W.Bottom,render:()=>(0,g.jsx)("div",{style:h.testResultsPopup,children:S.originalOutputTestResults.map(((e,t)=>(0,g.jsxs)("div",{style:h.testResultItem,children:[(0,g.jsxs)("div",{style:h.testResultTitle,children:["Test Result ",t+1," - Score: ",e.score]}),e.reasoning]},t)))})}):null}),(0,g.jsxs)("div",{style:h.buttonRow,children:[(0,g.jsx)(A().Ay,{renderOrigin:e=>(0,g.jsx)(k().p,{...e,children:"Auto-generate"}),popupType:_().n.Popup,placementToOrigin:z().W.Bottom,render:e=>(0,g.jsxs)("div",{style:h.popupContent,children:[(0,g.jsxs)("div",{style:h.formRow,children:[(0,g.jsx)("div",{style:h.formLabel,children:"Feedback"}),(0,g.jsx)(ue,{value:x,placeholder:"Enter feedback to generate memory",onChange:e=>f(e.target.value),textarea:!0,autosize:!0})]}),(0,g.jsx)(k().p,{onClick:()=>{C(),e.close()},disabled:!x.trim(),children:"Generate"})]})}),(0,g.jsx)(k().p,{onClick:T,children:"Test"}),(0,g.jsx)(w().A,{icon:de().I,onClick:v,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.memoryEditor.deleteMemory",defaultMessage:"Delete memory"})})]})]}),(0,g.jsx)(F().b,{label:"Visual editor",defaultOpen:!0,children:(0,g.jsxs)("div",{style:h.formContainer,children:[(0,g.jsxs)("div",{style:h.formRow,children:[(0,g.jsx)("div",{style:h.formLabel,children:"Test Title"}),(0,g.jsx)(ue,{value:S.testTitle,placeholder:"Enter test title",onChange:e=>y("testTitle",e.target.value)})]}),(0,g.jsxs)("div",{style:h.formRow,children:[(0,g.jsx)("div",{style:h.formLabel,children:"Input Summary"}),(0,g.jsx)(ue,{value:S.inputSummary,placeholder:"Enter input summary",onChange:e=>y("inputSummary",e.target.value),textarea:!0,autosize:!0})]}),(0,g.jsxs)("div",{style:h.formRow,children:[(0,g.jsx)("div",{style:h.formLabel,children:"Prompt Feedback"}),(0,g.jsx)(ue,{value:S.promptFeedback,placeholder:"Enter prompt feedback",onChange:e=>y("promptFeedback",e.target.value),textarea:!0,autosize:!0})]}),(0,g.jsxs)("div",{style:h.formRow,children:[(0,g.jsx)("div",{style:h.formLabel,children:"Test Instructions"}),(0,g.jsx)(ue,{value:S.testInstructions,placeholder:"Enter test instructions",onChange:e=>y("testInstructions",e.target.value),textarea:!0,autosize:!0})]}),(0,g.jsx)("div",{style:h.formRow,children:(0,g.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,g.jsx)("input",{type:"checkbox",checked:S.originalOutputPassesTest,onChange:e=>y("originalOutputPassesTest",e.target.checked)}),(0,g.jsx)("span",{style:h.formLabel,children:"Original Output Passes Test"})]})}),(0,g.jsx)("div",{style:h.formRow,children:(0,g.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,g.jsx)("input",{type:"checkbox",checked:S.isOptional,onChange:e=>y("isOptional",e.target.checked)}),(0,g.jsx)("span",{style:h.formLabel,children:"Optional Memory"})]})})]})}),(0,g.jsx)(F().b,{label:"JSON editor",defaultOpen:!1,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(S,null,2)})})]})]})}var ge=()=>n(284371),he=()=>n(704152),xe=()=>n(88291);function fe(e){const t=e.model,n=(0,a().v3)(),r=(0,s().IS)((e=>({badge:{fontSize:12,fontWeight:500,padding:"1px 6px",backgroundColor:e.cardHoveredBackground,color:e.text.tertiary,borderRadius:4,...ge().RC}})),[]),i=(0,o().K8)((()=>xe().$.getData(n,{})||[]),[n]),l=e.model?ye[e.model]||e.model:"Default model";return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:t=>(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("div",{children:"Select a model"}),placement:z().W.Bottom,alignment:z().C.Center,render:n=>"button"===e.format?(0,g.jsx)(k().p,{...(0,X().A)(t,n),children:l}):(0,g.jsx)(he().A,{...(0,X().A)(t,n),ignoreLocalHoverState:!0,children:(0,g.jsx)("div",{style:r.badge,children:l})})}),render:n=>(0,g.jsx)(R().A,{menuType:L().gu.Popup,children:(0,g.jsx)(B().Ay,{type:B().Oh.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,g.jsx)(P().A,{...e,title:"Models",shouldShowBottomDivider:!0}),items:i.map((r=>({key:r,action:()=>{e.setModel(r),n.close()},render:e=>(0,g.jsx)(I().A,{...e,title:ye[r]||r,isChecked:r===t})})))}]})})})}const ye={default:"Default model","openai-gpt-4o":"OpenAI GPT-4o","openai-chatgpt-4o-latest":"OpenAI ChatGPT-4o-latest","openai-gpt-4o-mini":"OpenAI GPT-4o-mini","openai-o1":"OpenAI o1","openai-o1-mini":"OpenAI o1-mini","openai-o3-mini":"OpenAI o3-mini","openai-o3":"OpenAI o3","openai-o4-mini":"OpenAI o4-mini","openai-gpt-4.1":"OpenAI GPT-4.1","openai-gpt-4.1-mini":"OpenAI GPT-4.1-mini","openai-gpt-4.1-nano":"OpenAI GPT-4.1-nano","anthropic-haiku":"Anthropic Haiku","anthropic-sonnet-3.5":"Anthropic Sonnet 3.5","anthropic-sonnet-3.7":"Anthropic Sonnet 3.7","anthropic-sonnet-4":"Anthropic Sonnet 4","anthropic-opus-4":"Anthropic Opus 4","anthropic-opus":"Anthropic Opus","vertex-gemini-1.5-pro":"Vertex Gemini 1.5 Pro","vertex-gemini-1.5-flash":"Vertex Gemini 1.5 Flash","vertex-gemini-2.0-flash":"Vertex Gemini 2.0 Flash","vertex-gemini-2.5-pro":"Vertex Gemini 2.5 Pro","vertex-gemini-2.5-flash":"Vertex Gemini 2.5 Flash","groq-gemma2-9b-it":"Groq Gemma2 9b It","groq-gemma-7b-it":"Groq Gemma 7b It","groq-llama-70b":"Groq Llama 70b","groq-llama-8b":"Groq Llama 8b","groq-mixtral":"Groq Mixtral","fireworks-llama3.1-405b":"Llama 3.1 405b","fireworks-llama3.1-70b":"Llama 3.1 70b","fireworks-llama3.3-70b":"Llama 3.3 70b","fireworks-llama3.3-70b-dedicated":"Llama 3.3 70b Dedicated","fireworks-llama3.1-8b":"Llama 3.1 8b","fireworks-llama3-70b":"Llama 3.70b","fireworks-mixtral-22b":"Mixtral 22b","fireworks-mixtral-7b":"Mixtral 7b","fireworks-ft-router-101":"FT Router 101","fireworks-ft-router-102":"FT Router 102","fireworks-deepseek-v3":"DeepSeek V3","fireworks-deepseek-r1":"DeepSeek R1","fireworks-deepseek-r1-0528":"DeepSeek R1 0528","fireworks-llama-8b-finetune-v07-p50-cru6bgc4":"Llama 8b Finetune V07 P50 (Iowa)","cerebras-llama3.1-8b":"Cerebras Llama 3.1 8b","cerebras-llama3.3-70b":"Cerebras Llama 3.3 70b","cerebras-deepseek-r1-distill-llama-70b":"Cerebras DeepSeek R1 Distill Llama 70b","bedrock-nova-pro":"Bedrock Nova Pro","bedrock-nova-lite":"Bedrock Nova Lite","bedrock-nova-micro":"Bedrock Nova Micro","bedrock-anthropic-sonnet-3.7":"Bedrock Anthropic Sonnet 3.7","bedrock-anthropic-sonnet-3.5":"Bedrock Anthropic Sonnet 3.5","bedrock-anthropic-haiku-3.5":"Bedrock Anthropic Haiku"},ve={viewBox:"0 0 16 16",fittedViewBox:"2.97 2.12 10.06 11.76",svg:(0,g.jsx)("path",{d:"M8 2.125a.625.625 0 0 0-.625.625v7.128L5.378 7.881a.625.625 0 1 0-.884.884l3.064 3.064c.244.244.64.244.884 0l3.065-3.064a.625.625 0 0 0-.884-.884L8.625 9.878V2.75A.625.625 0 0 0 8 2.125m-4.403 10.5a.625.625 0 1 0 0 1.25h8.806a.625.625 0 1 0 0-1.25z"})},be=(0,m().wt)("arrowLineDownSmall",ve);var je=()=>n(668725),Ce=()=>n(763884),Te=()=>n(419357),Se=()=>n(864943);function ke(e){const{scopeKey:t,inference:n,defaultState:r}=e,a=(0,b().tz)();return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:e=>(0,g.jsx)(D().A,{renderTooltip:()=>"Save to dataset",placement:z().W.Top,render:t=>(0,g.jsx)("div",{...(0,X().A)(t,e),children:(0,g.jsx)(w().A,{icon:be,ariaLabel:a.formatMessage({defaultMessage:"Retry",id:"aiInferenceTranscript.debug.retry"})})})}),render:e=>(0,g.jsx)(Ie,{scopeKey:t,inference:n,buttonPopupParent:e,defaultState:r})})}function Ie(e){const{scopeKey:t,inference:n,buttonPopupParent:o,defaultState:i}=e,l=(0,a().v3)(),d=(0,s().IS)((e=>({menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.text.primary}})),[]),c=(0,r.useMemo)((()=>function(e){const{environment:t,scopeKey:n,defaultState:r}=e,a=Re(n),o=Ce().K.get({userId:t.currentUser.id,key:a});if(!o&&r)return r;return o||{project:void 0,dataset:void 0,tags:[]}}({environment:l,scopeKey:t,defaultState:i})),[l,i,t]),[p,u]=(0,r.useState)(c),m=(0,r.useCallback)((e=>{u(e),function(e){const{environment:t,scopeKey:n,state:r}=e,a=Re(n);Ce().K.set({userId:t.currentUser.id,key:a,value:r})}({environment:l,scopeKey:t,state:e})}),[l,t]),h=(0,r.useCallback)((e=>{m({...p,project:e,dataset:void 0})}),[m,p]),x=(0,r.useCallback)((e=>{m({...p,dataset:e})}),[m,p]),f=(0,r.useCallback)((e=>{m({...p,tags:e})}),[m,p]),y=(0,r.useCallback)((()=>{const{project:e,dataset:t,tags:r}=p;e&&t&&(0,K().wm)({environment:l,inference:{...n,tags:r},project:e.name,dataset:t})}),[l,n,p]);return(0,g.jsx)(R().A,{menuType:L().gu.Popup,...o,children:(0,g.jsxs)("div",{style:d.menuContent,children:[(0,g.jsx)("div",{style:d.label,children:"Project"}),(0,g.jsx)(Ae,{project:p.project,setProject:h}),p.project&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:d.label,children:"Dataset"}),(0,g.jsx)(we,{project:p.project.name,dataset:p.dataset,onChange:x})]}),p.project&&p.dataset&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:d.label,children:"Tags"}),(0,g.jsx)(Oe,{tags:p.tags,onChange:f}),(0,g.jsx)(Se().A,{size:"lg",onClick:y,children:"Save"})]})]})})}function Ae(e){const t=e.project,[n,o]=(0,r.useState)([]),s=(0,a().v3)();return(0,c().Yb)((async()=>{const e=await T().callApi({eventName:"getBraintrustProjects",environment:s,data:{}});if("failed"===e.type)throw e.error;o(e.data.projects.map((e=>{let{id:t,name:n}=e;return{id:t,name:n}})))}),[s]),(0,g.jsx)(Me,{items:n.sort(((e,t)=>e.name.localeCompare(t.name))),selectedItem:t,onSelect:e.setProject,renderItem:e=>e.name,isFiltered:(e,t)=>e.name.toLowerCase().includes(t.toLowerCase()),placeholder:"Select project"})}function we(e){const{project:t,dataset:n,onChange:o}=e,s=(0,a().v3)(),[i,l]=(0,r.useState)([]),d=(0,r.useCallback)((async()=>{if(!t)return;const e=await T().callApi({eventName:"getBraintrustDatasetsForProject",environment:s,data:{project:t}});if("failed"===e.type)throw e.error;const n=e.data.datasets.map((e=>e.name));n.sort(),l(n)}),[s,t]);return(0,c().Yb)((async()=>{await d()}),[d]),(0,g.jsx)(Me,{items:i,selectedItem:n,onSelect:o,renderItem:C().D_,isFiltered:(e,t)=>e.toLowerCase().includes(t.toLowerCase()),placeholder:"Select dataset"})}function Me(e){const{items:t,selectedItem:n,onSelect:a,renderItem:o,placeholder:i,isFiltered:l}=e,d=(0,s().IS)((e=>({chevron:{width:10,marginLeft:4,fill:e.icon.tertiary},buttonWrapper:{display:"flex",alignItems:"center"}})),[]),[c,p]=(0,r.useState)(""),u=(0,r.useCallback)((e=>{p(e.target.value)}),[]),m=t.filter((e=>l(e,c)));return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:e=>(0,g.jsx)(k().p,{...e,children:(0,g.jsxs)("div",{style:d.buttonWrapper,children:[n?o(n):i||"",(0,je().b)(d.chevron)]})}),render:e=>(0,g.jsxs)(R().A,{menuType:L().gu.Popup,children:[(0,g.jsx)(Te().Ay,{value:c,onChange:u,autoFocus:!0}),(0,g.jsx)(B().Ay,{type:B().Oh.Vertical,initialFocus:0,sections:[{key:"items",render:e=>(0,g.jsx)(P().A,{...e}),items:m.map(((t,r)=>({key:r,action:()=>{a(t),e.close()},render:e=>(0,g.jsx)(I().A,{...e,title:o(t),isChecked:t===n})})))}]})]})})}function Oe(e){const{tags:t,onChange:n}=e,a=(0,s().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8}})),[]),o=(0,r.useCallback)((e=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}),[n,t]);return(0,g.jsx)("div",{style:a.container,children:(0,g.jsx)("div",{style:a.tagsContainer,children:i().d7.map((e=>(0,g.jsxs)(k().p,{onClick:()=>o(e),style:{display:"flex",alignItems:"center",gap:4},children:[(0,g.jsx)(N().T,{checked:t.includes(e),size:14}),(0,g.jsx)("span",{children:e})]},e)))})})}function Re(e){return`ai-inference-transcript-save-to-dataset-${e}`}function Be(e){const{clientStore:t,threadStore:n}=e,a=(0,s().IS)((e=>({topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:14},inferencesWrap:{display:"flex",flexDirection:"column",gap:12,fontSize:14},header:{fontSize:14}})),[]),i=(0,o().K8)((()=>null==n?void 0:n.id),[n]),l=(0,o().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.inferences.length:0),[t,i]),d=(0,o().K8)((()=>Boolean(i&&t.getOrCreateClientAIChatThreadStore(i).state.loading||void 0!==(null==n?void 0:n.getCurrentInferenceId()))),[t,n,i]),c=(0,o().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.inferences:[]),[t,i]),p=(0,o().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.requestInfo:void 0),[t,i]),u=(0,r.useCallback)((()=>{if(!i)return;const e=t.getOrCreateClientAIChatThreadStore(i),{acceptedInferenceKeys:n}=e.state;n.length>0?e.setState({...e.state,acceptedInferenceKeys:[]}):e.setState({...e.state,acceptedInferenceKeys:e.state.inferences.map((e=>e.key))})}),[t,i]),m=(0,o().K8)((()=>t.state.configForNewTranscripts),[t]),h=(0,o().K8)((()=>t.state.debugOverrides),[t]),x=(0,o().K8)((()=>t.state.model),[t]),f=(0,r.useCallback)((e=>{t.setState({...t.state,model:e})}),[t]),y=(0,o().K8)((()=>(0,W().av)(n)),[n]);return(0,g.jsxs)(S().Y1,{direction:"vertical",height:"fill",width:"fill",children:[(0,g.jsxs)(S().Y1,{direction:"horizontal",gap:8,padding:"8px 12px",height:46,align:"center",children:[d&&(0,g.jsx)(O().A,{}),!y&&n&&(0,g.jsx)(Ee,{clientStore:t,threadStore:n},n.id),(0,g.jsx)("div",{style:{flexGrow:1}}),(0,g.jsx)(fe,{model:x,setModel:f,format:"badge"}),(0,g.jsx)(re,{clientStore:t})]}),(0,g.jsxs)(S().Y1,{direction:"vertical",gap:16,padding:"8px 12px",height:"fill",style:{overflowY:"auto"},children:[p&&(0,g.jsx)(Ne,{requestInfo:p,clientStore:t,threadStore:n}),y&&m&&(0,g.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(0,g.jsx)(Fe,{debugOverrides:h,clientStore:t,configType:m.type})}),(0,g.jsxs)("div",{style:a.inferencesWrap,children:[c.length>0&&(0,g.jsxs)("div",{style:a.topBar,children:[(0,g.jsx)("div",{style:a.header,children:"Inferences"}),(0,g.jsx)("div",{style:{flexGrow:1}}),l>0&&(0,g.jsx)("div",{children:`${l} inference${1===l?"":"s"}`}),!d&&l>0&&(0,g.jsx)(k().p,{onClick:u,children:"Toggle all"})]}),c.map(((e,r)=>(0,g.jsx)(De,{inference:e,clientStore:t,threadStore:n},`${e.key}-${r}`)))]})]})]})}function Ne(e){var t;const{requestInfo:n,clientStore:a,threadStore:l}=e,c=(0,o().K8)((()=>null==l?void 0:l.id),[l]),p=(0,s().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:4,padding:"4px 2px",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:4,alignItems:"center",padding:"0 6px"},toggle:{border:"none",padding:0,margin:0}})),[]),{request:m,response:h,memories:x}=n,y=m.transcript.find((e=>"config"===e.type)),v=(0,r.useCallback)((()=>{if(!h)throw new Error("Response is required");if(!c)return;const e=a.getOrCreateClientAIChatThreadStore(c);e.setState({...e.state,requestInfo:{...n,memories:[{...i().s8,originalOutput:h}]}})}),[a,n,h,c]),j=(0,r.useCallback)((e=>{if(!c)return;const t=a.getOrCreateClientAIChatThreadStore(c);t.setState({...t.state,requestInfo:{...n,memories:e}})}),[a,n,c]),C=(0,r.useCallback)((e=>{if(!c)return;const t=a.getOrCreateClientAIChatThreadStore(c);t.setState({...t.state,requestInfo:{...n,expectedAgentTools:e}})}),[a,n,c]),T=(0,r.useCallback)((e=>{var t,n;if(!c)return;const r=a.getOrCreateClientAIChatThreadStore(c),o=(null===(t=e.metadata)||void 0===t?void 0:t.memories)||[],s=null===(n=e.metadata)||void 0===n?void 0:n.expectedAgentTools;e.input.type===d().uF&&r.setState({...r.state,requestInfo:{request:e.input,response:e.expected,memories:o,expectedAgentTools:s}})}),[a,c]),S=(0,r.useCallback)((()=>{if(!c)return;const e=a.getOrCreateClientAIChatThreadStore(c);e.setState({...e.state,requestInfo:{...n,expectedAgentTools:{expect:[{toolType:"search",minTimes:void 0,maxTimes:void 0,description:""}]}}})}),[a,n,c]),k=(0,o().K8)((()=>function(e){if(!e)return;const t=e.getMessageStores(),n=t.map((e=>e.getStep())).filter((e=>"eval-result"===(null==e?void 0:e.type)));if(0===n.length)return;const r=n[n.length-1],a=null==r?void 0:r.braintrustInfo;if(null==a||!a.project||null==a||!a.dataset||null==a||!a.originalInferenceId)return;return{project:a.project,dataset:a.dataset,exampleId:a.originalInferenceId}}(l)),[l]),I=(0,r.useMemo)((()=>({id:(null==k?void 0:k.exampleId)||m.traceId,input:{type:d().uF,...m},expected:h,metadata:{memories:x.map((e=>{let{originalOutput:t,...n}=e;return n})),...n.expectedAgentTools&&{expectedAgentTools:n.expectedAgentTools}}})),[m,h,x,k,n.expectedAgentTools]),A=(0,r.useMemo)((()=>{if(!n.response)return;return{type:"inferenceTranscript",request:n.request,response:n.response}}),[n]),M=(0,b().tz)();return(0,g.jsxs)("div",{style:p.wrap,children:[(0,g.jsxs)("div",{style:p.header,children:[(0,g.jsxs)("span",{style:{flexGrow:1},children:["Request",k&&(0,g.jsx)("a",{href:`https://www.braintrust.dev/app/Notion/p/${k.project}/datasets/${k.dataset}?r=${k.exampleId}`,target:"_blank",rel:"noopener noreferrer",style:{marginLeft:8,fontSize:12,color:"inherit"},children:"View in Braintrust"})]}),0===x.length&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(D().A,{renderTooltip:()=>"Add memory for this inference",placement:z().W.Top,render:e=>(0,g.jsx)("div",{...e,children:(0,g.jsx)(w().A,{icon:f().plusSmallIcon,onClick:v,ariaLabel:M.formatMessage({defaultMessage:"Add memory",id:"aiInferenceTranscript.debug.addMemory"})})})}),(0,g.jsx)(Ke,{onLoadExample:T,datasetInfo:k})]}),(!n.expectedAgentTools||!n.expectedAgentTools.expect||0===n.expectedAgentTools.expect.length)&&(0,g.jsx)(D().A,{renderTooltip:()=>"Add agent tool expectations",placement:z().W.Top,render:e=>(0,g.jsx)("div",{...e,children:(0,g.jsx)(w().A,{icon:u().P,onClick:S,ariaLabel:M.formatMessage({defaultMessage:"Add agent tool expectations",id:"aiInferenceTranscript.debug.addAgentToolExpectations"})})})}),I&&(0,g.jsx)(ke,{inference:I,scopeKey:`inferenceTranscript-${null==y?void 0:y.value.type}`})]}),(0,g.jsx)(F().b,{label:"Input",style:p.toggle,children:(0,g.jsx)(E().X,{language:"json",value:JSON.stringify(n.request,null,2)})}),n.response?(0,g.jsx)(F().b,{label:"Output",style:p.toggle,children:(0,g.jsx)(E().X,{value:JSON.stringify(n.response,null,2),language:"json"})}):null,A&&x.length>0&&(0,g.jsx)(me,{request:A,memories:x,onChange:j,clientStore:a}),n.expectedAgentTools&&n.expectedAgentTools.expect&&n.expectedAgentTools.expect.length>0&&(0,g.jsx)(V,{expectations:n.expectedAgentTools,onChange:C,transcript:null===(t=n.response)||void 0===t?void 0:t.transcript})]})}function Pe(e){const{inference:t,clientStore:n,threadStore:l}=e,c=t.key,p=(0,a().v3)(),u=(0,o().K8)((()=>null==l?void 0:l.id),[l]),m=(0,s().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:4,padding:"4px 2px",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,whiteSpace:"pre-wrap",fontSize:14},header:{padding:"0 6px",display:"flex",gap:4,alignItems:"center"},annotation:{padding:"0 6px"},toggle:{border:"none",padding:0,margin:0},typeLabel:{flexGrow:1,marginLeft:4,fontSize:12,fontFamily:"monospace"}})),[]),h=(0,o().K8)((()=>u?n.getOrCreateClientAIChatThreadStore(u).state.inferenceKeysToAnnotations[c]:void 0),[n,c,u]),y=(0,r.useCallback)((e=>{if(!u)return;const t=n.getOrCreateClientAIChatThreadStore(u),r=e.target.value,a={...t.state.inferenceKeysToAnnotations,[c]:r};t.setState({...t.state,inferenceKeysToAnnotations:a})}),[n,c,u]),v=(0,o().K8)((()=>{if(!u)return!1;const{acceptedInferenceKeys:e}=n.getOrCreateClientAIChatThreadStore(u).state;return e.includes(c)}),[n,c,u]),j=(0,r.useCallback)((e=>{if(!u)return;const t=n.getOrCreateClientAIChatThreadStore(u),{acceptedInferenceKeys:r,inferences:a}=t.state,o=e.shiftKey;if(r.includes(c))if(o){const e=a.findIndex((e=>e.key===c)),n=a.slice(0,e+1).map((e=>e.key));t.setState({...t.state,acceptedInferenceKeys:C().sb(r.filter((e=>!n.includes(e))))})}else t.setState({...t.state,acceptedInferenceKeys:r.filter((e=>e!==c))});else if(o){const e=a.findIndex((e=>e.key===c)),n=a.slice(0,e+1).map((e=>e.key)),o=C().sb([...r,...n]);t.setState({...t.state,acceptedInferenceKeys:o})}else t.setState({...t.state,acceptedInferenceKeys:C().sb([...r,c])})}),[n,c,u]),T=(0,r.useMemo)((()=>{const e=null==t?void 0:t.value.expected;if(!e)return"";if("string"!=typeof e)return JSON.stringify(e,null,2);try{return e.trim().startsWith("{")?JSON.stringify(JSON.parse(e),null,2):e}catch(n){return e}}),[t]),S=(0,o().K8)((()=>{if(u)return n.getOrCreateClientAIChatThreadStore(u).state.inferenceKeysToMemories[c]}),[n,c,u]),k=(0,r.useMemo)((()=>({type:"inference",inference:t.value})),[t]),I=(0,r.useCallback)((async()=>{u&&await(0,K().Ou)({environment:p,clientStore:n,inference:t,threadId:u})}),[n,p,t,u]),A=(0,r.useCallback)((e=>{if(!u)return;const t=n.getOrCreateClientAIChatThreadStore(u);t.setState({...t.state,inferenceKeysToMemories:{...t.state.inferenceKeysToMemories,[c]:e[0]}})}),[n,c,u]),M=(0,r.useCallback)((()=>{if(!u)return;if(!t.value.expected)throw new Error("Expected output is required");const e=n.getOrCreateClientAIChatThreadStore(u);e.setState({...e.state,inferenceKeysToMemories:{...e.state.inferenceKeysToMemories,[c]:{...i().s8,originalOutput:t.value.expected}}})}),[n,c,t,u]),O=(0,r.useMemo)((()=>({...t.value,metadata:{...t.value.metadata,memories:C().oE([S])}})),[t,S]),R=(0,b().tz)();return t?(0,g.jsxs)("div",{style:m.wrap,children:[(0,g.jsxs)("div",{style:m.header,children:[(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"Checking this will 'freeze' this inference. When the request is retried, instead of running the inference again, the original output will be used."}),placement:z().W.Top,render:e=>(0,g.jsx)("div",{...e,children:(0,g.jsx)(N().T,{checked:v,size:14,onClick:j})})}),(0,g.jsx)(le,{inference:t.value,trigger:(0,g.jsx)("span",{style:{...m.typeLabel,cursor:"pointer",textDecoration:"underline",textDecorationStyle:"dotted"},children:Le(t.value.input)})}),(0,g.jsx)(D().A,{renderTooltip:()=>"Retry inference",placement:z().W.Top,render:e=>(0,g.jsx)("div",{...e,children:(0,g.jsx)(w().A,{icon:x,onClick:I,ariaLabel:R.formatMessage({defaultMessage:"Retry",id:"aiInferenceTranscript.debug.retry"})})})}),(0,g.jsx)(Z,{inference:t.value}),!S&&(0,g.jsx)(D().A,{renderTooltip:()=>"Add memory for this inference",placement:z().W.Top,render:e=>(0,g.jsx)("div",{...e,children:(0,g.jsx)(w().A,{icon:f().plusSmallIcon,onClick:M,ariaLabel:R.formatMessage({defaultMessage:"Add memory",id:"aiInferenceTranscript.debug.addMemory"})})})}),(0,g.jsx)(ke,{inference:O,scopeKey:`inference-${t.value.input.type}`,defaultState:{project:d().vK,dataset:t.value.input.type,tags:[]}})]}),(0,g.jsx)(ze,{input:t.value.input}),(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is passed as 'context.annotation' when this inference is retried. Typically, this is rendered as a final user step in the prompt used to 'nudge' the model."}),placement:z().W.Right,render:e=>(0,g.jsx)("div",{...e,style:m.annotation,children:(0,g.jsx)(ue,{value:h,placeholder:"Set annotation",onChange:y,textarea:!0,autosize:!0})})}),(0,g.jsx)(F().b,{label:"Input",style:m.toggle,children:(0,g.jsx)(E().X,{disabled:!0,language:"json",value:JSON.stringify({...t.value.input,examples:void 0},null,2)})}),t.value.expected?(0,g.jsx)(F().b,{label:"Output",style:m.toggle,children:(0,g.jsx)(E().X,{disabled:!0,value:T,language:"json"})}):null,t.value.metadata?(0,g.jsx)(F().b,{label:"Metadata",style:m.toggle,children:(0,g.jsx)(E().X,{disabled:!0,value:JSON.stringify(t.value.metadata,null,2),language:"json"})}):null,S&&(0,g.jsx)(me,{request:k,memories:[S],onChange:A,clientStore:n})]}):null}const De=r.memo(Pe);function Le(e){let t=e.type;"fileName"in e&&(t+=` – ${e.fileName}`),"testName"in e&&(t+=` – ${e.testName}`),"functionKey"in e&&(t+=` – ${e.functionKey}`),"key"in e&&(t+=` – ${e.key}`);const n=["retries","validationRetries"];for(const r of n)if(r in e&&e[r].length>0){t+=` (${e[r].filter((e=>"assistant"!==e.type)).length} error steps)`}return t}function ze(e){const{input:t}=e,n="transcript"in t&&Array.isArray(t.transcript)?t.transcript:void 0,a=(0,r.useMemo)((()=>C().oE(null==n?void 0:n.map((e=>"agent-tool-result"===e.type?e.toolName:void 0)))),[n]),o=(0,s().IS)((e=>({container:{fontSize:12,color:e.text.secondary,padding:"0 6px 4px 6px"}})),[]);return 0===a.length?null:(0,g.jsxs)("div",{style:o.container,children:["Tools: ",a.join(", ")]})}function Ee(e){const t=(0,b().tz)(),{clientStore:n,threadStore:i}=e,d=(0,o().K8)((()=>null==i?void 0:i.id),[i]),p=(0,a().v3)(),u=(0,s().IS)((e=>({button:{fontSize:14}})),[]),m=(0,o().K8)((()=>i.getSpaceId()),[i]),h=(0,o().K8)((()=>{const e=i.getMessageStores().map((e=>{const t=e.getStep();if(t&&"config"===t.type)return t.value.type}));return C().oE(e)[0]}),[i]),[{value:x},f]=(0,c().Yb)((async()=>{if(!m||!h)return;const e=(0,l().W)({environmentName:"production",suffix:h});return await T().callApi({eventName:"getBraintrustLogsForThread",environment:p,data:{project:e,threadId:i.id,spaceId:m}})}),[p,m,i,h]),j=(0,r.useMemo)((()=>{if(!x||"failed"===x.type)return;const e=x.data.logs,t=[],n=new Map;for(const r of e)if(r.span_id===r.root_span_id)t.push(r);else if(r.root_span_id){const e=n.get(r.root_span_id)||[];e.push(r),n.set(r.root_span_id,e)}for(const r of n.values())r.sort(((e,t)=>{var n,r;return((null===(n=e.metadata)||void 0===n?void 0:n.index)||0)-((null===(r=t.metadata)||void 0===r?void 0:r.index)||0)}));return t.sort(((e,t)=>{const n=new Date(e.created||"");return new Date(t.created||"").getTime()-n.getTime()})),{rootSpans:t,subSpanGroups:n}}),[x]),S=(0,r.useCallback)((e=>{if(!e.span_id)return;if(!d)return;const t=null==j?void 0:j.subSpanGroups.get(e.span_id);if(!t)return;const r=n.getOrCreateClientAIChatThreadStore(d);r.setState({...r.state,requestInfo:{request:e.input,response:e.output,memories:[]},inferences:t.filter((e=>{var t;return"number"==typeof(null===(t=e.metadata)||void 0===t?void 0:t.index)})).map((e=>{var t;const n=null===(t=e.metadata)||void 0===t?void 0:t.index;if("number"!=typeof n)throw new Error("Index is not a number");return{type:"inference",key:(0,v().$A)(e.input),index:n,value:{id:e.id,input:e.input,expected:e.output,metadata:e.metadata}}}))})}),[n,j,d]),M=(0,r.useCallback)((()=>{var e;if(!d)return;const t=null===(e=n.getOrCreateClientAIChatThreadStore(d).state.requestInfo)||void 0===e||null===(e=e.request)||void 0===e?void 0:e.traceId;if(!h||!t)return;const r=(0,l().W)({environmentName:"production",suffix:h});window.open(`https://www.braintrust.dev/app/Notion/p/${r}/logs?r=${t}`,"_blank")}),[n,h,d]);return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.Start,renderOrigin:e=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(k().p,{...e,style:u.button,children:"failed"===(null==x?void 0:x.type)?"Failed to load logs":j?`View logs (${j.rootSpans.length})`:"Loading logs"}),(0,g.jsx)(D().A,{renderTooltip:()=>(0,g.jsx)("span",{children:"Open in Braintrust"}),render:e=>(0,g.jsx)(w().A,{...e,icon:y().N,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.openInBraintrust",defaultMessage:"Open in Braintrust"}),onClick:M})})]}),render:e=>(0,g.jsx)(R().A,{menuType:L().gu.Popup,children:(0,g.jsx)(B().Ay,{type:B().Oh.Vertical,initialFocus:0,sections:[{key:"refresh",render:e=>(0,g.jsx)(P().A,{...e}),items:[{key:"refresh",render:e=>(0,g.jsx)(I().A,{...e,title:"Refresh"}),action:()=>{f()}}]},{key:"dates",render:e=>(0,g.jsx)(P().A,{...e,shouldShowBottomDivider:!0}),items:((null==j?void 0:j.rootSpans)||[]).map((t=>({key:t.id,render:e=>(0,g.jsx)(I().A,{...e,title:t.created||"No date"}),action:()=>{e.close(),S(t)}})))||[]}]})})})}function Fe(e){const{clientStore:t,configType:n,debugOverrides:a}=e,l=function(e){if("researcher"===e)return"researchModeDebugOptions"}(n),d=(0,o().K8)((()=>function(e){return"researcher"===e?i().vW:{}}(n)),[n]),c=(0,s().IS)((e=>({wrap:{margin:"12px 0",display:"flex",flexDirection:"column",gap:8},title:{fontSize:16,color:e.text.secondary,fontWeight:500},row:{display:"flex",alignItems:"center",gap:8,color:e.text.secondary,fontSize:12},input:{width:200,backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,fontSize:12,color:e.text.secondary}})),[]),p=(0,r.useCallback)((e=>{l&&t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,[l]:{...t.state.debugOverrides[l]??{},...e}}})}),[t,l]);if(!l)return null;const u=a[l]??{},m=Object.entries(d).filter((e=>{let[t,n]=e;return"type"!==t&&("boolean"==typeof n||"string"==typeof n||"number"==typeof n)})).map((e=>{let[t,n]=e;return[t,u[t]??n]}));if(0===m.length)return null;const h=m.map((e=>{let[t,n]=e;return((e,t)=>"boolean"==typeof t?(0,g.jsxs)("div",{style:c.row,children:[(0,g.jsx)("span",{children:e}),(0,g.jsx)(N().T,{checked:t,onClick:()=>p({[e]:!t}),size:12})]},e):"string"==typeof t?(0,g.jsxs)("div",{style:c.row,children:[(0,g.jsx)("span",{children:e}),(0,g.jsx)(M().A,{value:t.toString(),onChange:t=>{p({[e]:t.target.value})},style:{width:200}})]},e):"number"==typeof t?(0,g.jsxs)("div",{style:c.row,children:[(0,g.jsx)("span",{children:e}),(0,g.jsx)(M().A,{type:"number",value:t.toString(),onChange:t=>{p({[e]:Number(t.target.value)})},style:{...c.input,width:65}})]},e):null)(t,n)}));return h.length>0?(0,g.jsxs)("div",{style:c.wrap,children:[(0,g.jsx)("div",{style:c.title,children:"Debug overrides"}),(0,g.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:h})]}):null}function Ke(e){const{onLoadExample:t,datasetInfo:n}=e,o=(0,b().tz)(),i=(0,a().v3)(),[l,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[x,f]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!1);r.useEffect((()=>{n&&!y&&(n.project&&d(n.project),n.dataset&&u(n.dataset),n.exampleId&&h(n.exampleId),v(!0))}),[n,y]);const C=(0,s().IS)((e=>({form:{display:"flex",flexDirection:"column",gap:8,padding:12,minWidth:300},row:{display:"flex",flexDirection:"column",gap:4},label:{fontSize:12,fontWeight:500,color:e.text.secondary},input:{fontSize:12,padding:6},buttons:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8}})),[]),S=(0,r.useCallback)((async e=>{if(l.trim()&&c.trim()&&m.trim()){f(!0);try{const n=await T().callStreamApi({eventName:"getBraintrustDataset",environment:i,data:{project:l.trim(),dataset:c.trim()}});if("success"!==n.type)throw new Error("Failed to get dataset stream");let r=null;if(j().hS.is(n.data))for await(const e of n.data){const{inference:t}=e;if(t.id===m.trim()){r=t;break}}if(!r)return void window.alert(`Example ${m} not found in ${l}/${c}`);t(r),e()}catch(n){window.alert("Failed to load example from Braintrust")}finally{f(!1)}}}),[l,c,m,t,i]);return(0,g.jsx)(A().Ay,{popupType:A().z7.Popup,placementToOrigin:A().sx.Bottom,alignmentToOrigin:A().yP.End,renderOrigin:e=>(0,g.jsx)(D().A,{renderTooltip:()=>"Load memories and tool expectations from Braintrust example",placement:z().W.Top,render:t=>(0,g.jsx)("div",{...t,children:(0,g.jsx)(w().A,{...e,icon:p().arrowInCircleDownIcon,ariaLabel:o.formatMessage({defaultMessage:"Load from Braintrust",id:"aiInferenceTranscript.debug.loadFromBraintrust"})})})}),render:e=>(0,g.jsxs)("div",{style:C.form,children:[(0,g.jsxs)("div",{style:C.row,children:[(0,g.jsx)("div",{style:C.label,children:"Project"}),(0,g.jsx)(ue,{value:l,onChange:e=>d(e.target.value),placeholder:"Enter Braintrust project name",style:C.input})]}),(0,g.jsxs)("div",{style:C.row,children:[(0,g.jsx)("div",{style:C.label,children:"Dataset"}),(0,g.jsx)(ue,{value:c,onChange:e=>u(e.target.value),placeholder:"Enter Braintrust dataset name",style:C.input})]}),(0,g.jsxs)("div",{style:C.row,children:[(0,g.jsx)("div",{style:C.label,children:"Example ID"}),(0,g.jsx)(ue,{value:m,onChange:e=>h(e.target.value),placeholder:"Enter Braintrust example ID",style:C.input})]}),(0,g.jsxs)("div",{style:C.buttons,children:[(0,g.jsx)(k().p,{onClick:()=>e.close(),children:"Cancel"}),(0,g.jsx)(k().p,{onClick:()=>{S(e.close)},disabled:x||!l.trim()||!c.trim()||!m.trim(),children:x?(0,g.jsx)(O().A,{}):"Load from Braintrust"})]})]})})}},627503:(e,t,n)=>{n.d(t,{a:()=>a});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"1.37 1.37 13.25 13.25",svg:(0,n(474848).jsx)("path",{d:"M3.25 1.375c-1.036 0-1.875.84-1.875 1.875v6c0 1.036.84 1.875 1.875 1.875h1.625v1.625c0 1.036.84 1.875 1.875 1.875h6c1.036 0 1.875-.84 1.875-1.875v-6c0-1.036-.84-1.875-1.875-1.875h-1.625V3.25c0-1.036-.84-1.875-1.875-1.875zM2.625 3.25c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v1.625H6.75c-1.036 0-1.875.84-1.875 1.875v3.125H3.25a.625.625 0 0 1-.625-.625zm3.5 3.5c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v6c0 .345-.28.625-.625.625h-6a.625.625 0 0 1-.625-.625z"})},a=(0,n(340498).wt)("duplicateSmall",r)},800204:(e,t,n)=>{n.d(t,{U3:()=>s,og:()=>i,p9:()=>l,yu:()=>o});n(898992),n(354520);var r=()=>n(534177);const a=["calendar.getEvents","codegen.run","codegen.runStatus","files.getFileContent","files.getFileName","files.getFileUrl","github.getPullRequest","github.getUser","github.listOrganizationRepositories","github.listPullRequests","github.parseGithubUrlToParts","notion.sendNotification","mcpServer.runTool","pipedream.action","slack.addReactionToMessage","slack.createThreadInChannel","slack.createThreadInDirectMessage","slack.findUserByEmail","slack.getSlackUrlFromMessageId","slack.getThreadsInChannelSince","slack.getUser","slack.parseSlackMessageUrlToId","slack.queryChannels","slack.removeReactionFromMessage","slack.replyInThread","slack.updateMessage","zendesk.addComment","zendesk.addTicket","zendesk.getComments","zendesk.getTicket","zendesk.updateTicket"],o=["search","view","view-database-files","create-database","update-database","update-database-data-sources","update-database-views","query-data-sources","update-database-triggers","error","create-pages","update-page","delete-pages","result","toggle-user-integration-tools","update-user-integrations","edit-json","spawn-agent","create-agent","update-agent","delete-agent",...a];function s(e){if("string"!=typeof e)return!1;for(const t of o)if(e===t)return!0;return!!i(e)}function i(e){return!!(0,r().Xk)(a,e)}const l="REJECTED_BY_USER"},965454:(e,t,n)=>{n.d(t,{_:()=>o});n(16280);var r=()=>n(234459),a=()=>n(751156);const o=new class{constructor(){this.tempThreadCache=void 0,this.tempThreadPointer=void 0,this.environment=void 0,this.userStore=void 0,this.spaceStore=void 0,this.tempThreadCache=new(n(221844).A)({name:"TemporaryAiThreadCache",isTemporaryData:!0})}createTemporaryThreadStore(e){let{environment:t,spaceStore:r,userStore:o}=e;if(this.environment=t,this.userStore=o,this.spaceStore=r,this.tempThreadPointer)return n(630116).Ei.createChildStore(r,this.tempThreadPointer);t.defaultRecordCache.inMemoryRecordCache.addCacheFallback(this.tempThreadCache);return a().createAndCommit({environment:t,canUndo:!1,perform:e=>this.performCreateThread({transaction:e,inMemoryRecordCache:this.tempThreadCache,environment:t,spaceStore:r,userStore:o}),userAction:"TemporaryAiThreadManager.createTemporaryThread"}).performResult}persistTemporaryThreadStoreIfExists(e){var t;if(!(this.environment&&this.userStore&&this.spaceStore&&this.tempThreadPointer))return;let n,r;if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheFallback(this.tempThreadCache),this.tempThreadCache.clearCache(),e)n=this.performCreateThread({transaction:e,inMemoryRecordCache:this.environment.defaultRecordCache.inMemoryRecordCache,environment:this.environment,spaceStore:this.spaceStore,userStore:this.userStore,pointer:this.tempThreadPointer});else{if(r=a().createAndCommit({environment:this.environment,canUndo:!1,perform:e=>{if(this.environment&&this.userStore&&this.spaceStore&&this.tempThreadPointer)return this.performCreateThread({transaction:e,inMemoryRecordCache:this.environment.defaultRecordCache.inMemoryRecordCache,environment:this.environment,spaceStore:this.spaceStore,userStore:this.userStore,pointer:this.tempThreadPointer})},userAction:"TemporaryAiThreadManager.createTemporaryThread"}),!r.performResult)throw new Error("Expected to be able to persist");n=r.performResult}return this.reset(),{threadStore:n,commitResult:null===(t=r)||void 0===t?void 0:t.serverCommitResult}}reset(){this.environment=void 0,this.spaceStore=void 0,this.userStore=void 0,this.tempThreadPointer=void 0}performCreateThread(e){let{environment:t,spaceStore:a,userStore:o,inMemoryRecordCache:s,pointer:i,transaction:l}=e;const d=(null==i?void 0:i.id)??(0,n(594794).Z1)({environment:t,table:r().To,spaceId:a.id});return this.tempThreadPointer={id:d,table:r().To,spaceId:a.id},(0,n(390898).aP)({environment:t,userStore:o,spaceStore:a,transcript:[],transaction:l,threadId:d,inMemoryRecordCache:s})}}}}]);