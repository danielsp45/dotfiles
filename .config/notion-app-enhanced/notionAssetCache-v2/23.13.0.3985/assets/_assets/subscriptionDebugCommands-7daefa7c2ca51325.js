"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[99355],{846398:(e,t,n)=>{n.r(t),n.d(t,{SubscriptionDebugCommands:()=>x});n(16280),n(898992),n(672577),n(737550);var r=n(296540),a=()=>n(466103),i=()=>n(484714),o=()=>n(56366),s=()=>n(604341),c=()=>n(386164),u=()=>n(762433),d=()=>n(47273),l=()=>n(323063),m=()=>n(76118),p=()=>n(496603),f=()=>n(449506),S=()=>n(44729),g=()=>n(246826),v=()=>n(751156),b=()=>n(755199),h=()=>n(108184),y=()=>n(47170),A=()=>n(765957),I=()=>n(975971),_=()=>n(1346),w=()=>n(779795),C=()=>n(411341),k=()=>n(324561),U=()=>n(807778),D=()=>n(134217),B=()=>n(668721),E=()=>n(749240);function x(){const e=(0,i().v3)(),t=(0,y().O)(),n=(0,o().O$)(A().AppStoreCurrentSpaceStore),[a,c]=(0,r.useState)(!1);return(0,s().exposeDebugValue)("subscriptions",{updateSubscription:async function(){var t;let{billingInterval:r="month",products:i=["plus"],cancelImmediately:o=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n)return;if(a)return;const s=await(0,w().p_)({environment:e,spaceId:n.id}),m=await(0,k().OD)({environment:e,spaceId:n.id});if(!m||"admin"!==m.type)return;const f=i[0],S=(0,u().lQ)(m),g=(0,d().j8)(S)??"USD",v=(null===(t=(0,u().KH)(m,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,b=(0,d().GB)({spaceId:n.id,logFunction:()=>{},subscriptionState:S}),h=(0,u().yB)({spaceId:n.id,logFunction:()=>{},billingData:m}),y=b??h??1;let A;if("free"===f)A=(0,l().gL)(S,"plan");else{if(!g||!r)throw new Error("Trying to update plan on a subscription with no items");{const e=(0,U().Le)();A=(0,l().ef)({state:S,prices:s,quantities:{numSeats:y,numCustomHostnames:v},params:{currency:g,interval:r},products:[f],flags:{isMay13PackagingChangesEnabled:e}})}}if(!p().n4(S,A)){c(!0);try{await(0,C().updateSubscription)({environment:e,spaceStore:n,desiredState:A,from:"subscription_debug_commands",paymentData:{type:"paymentMethodId",value:"pm_card_visa"},performImmediately:o})}finally{c(!1)}}},getAiUsage:()=>{const e=B().A.state;if(!e)throw Error("AI usage store not found");return{spaceUsage:e.spaceUsage,spaceUsageLimit:e.spaceLimit,userUsage:e.userUsage,userUsageLimit:e.userLimit}},getBlockUsage:()=>{const n=E().subscriptionDataStoreInstance.state;if(!n||!t)throw Error("Subscription data store not found");return{blockLimitCount:(0,D().hr)(e,n,t)}},resetDeleteBlocksModal:()=>{const t=A().default.state.currentSpaceViewStore;t&&v().createAndCommit({userAction:"DeleteBlocksModal.showDeleteBlocksModal",environment:e,canUndo:!0,perform:e=>{v().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings"],command:"update",args:{...t.getSettings(),seen_delete_blocks_modal:!1}},transaction:e})}})},resetStudentAiPopup:()=>{const t=A().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"dismissedStudentAiPopup.reset",environment:e,canUndo:!0,perform:e=>{b().mJ({transaction:e,userSettingsStore:t,data:{dismissed_student_ai_popup:!1}})}})},resetReverseTrialSidebarAlert:()=>{const t=A().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"ReverseTrialSidebarAlert.resetDismissal",environment:e,canUndo:!0,perform:e=>{b().mJ({transaction:e,userSettingsStore:t,data:{reverse_trial_sidebar_alert_dismissed_at:void 0}})}})},sendMemberRequestForAddOn:()=>{const t=A().default.state.currentSpaceStore;t&&_().jB({environment:e,spaceStore:t,from:"ai_qna_limit_in_app"})},recordAIUsage:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=A().default.state.currentSpaceStore;n&&(await f().callApi({eventName:"recordAIUsage",environment:e,data:{spaceId:n.id,usage:t}}),await(0,h().maybeUpdateAiEligibility)(e,n.id,!0))},recordBlockUsage:e=>{E().subscriptionDataStoreInstance.update((t=>t&&"blockUsage"in t?{...t,blockUsage:e}:t))},resetReachBlockLimitTime:()=>{const t=A().default.state.currentSpaceStore;t&&v().createAndCommit({userAction:"SubscriptionDebugCommands.resetReachBlockLimitTime",environment:e,canUndo:!0,perform:e=>{g().zv({store:t,data:{settings:{...t.getSettings(),reach_block_limit_time:void 0}},transaction:e})}})},addOfferToCustomer:async(t,n)=>{var r;const a=A().default.state.currentSpaceStore,i=null===(r=A().default.state.currentUserStore)||void 0===r?void 0:r.id;if(!a||!i)throw new Error("Missing space store or current user ID");await f().callApi({eventName:"recordOfferStatuses",environment:e,data:{spaceId:a.id,currentOfferCampaign:t,previousClaimedCampaigns:n}})}}),null}function N(e,t,r,a){v().createAndCommit({userAction:"SubscriptionDebugCommands.addBlocksToPage",environment:r,canUndo:!0,perform:i=>{p().Hn(e,(()=>{const e=g().Wv({environment:r,type:"text",inMemoryRecordCache:t.inMemoryRecordCache,transaction:i,properties:{title:[[a||"money team is the best team"]]}});S().NI({parentStore:t.getContentStore(),childStore:n(630116).Bv.createChildStore(t.getContentStore(),e.pointer),transaction:i})}))}})}function P(e,t,n){const r=t.getContentStores().slice(-e);v().createAndCommit({userAction:"SubscriptionDebugCommands.removeBlocksFromPage",environment:n,canUndo:!0,perform:e=>{for(const n of r)S().zz({parentStore:t.getContentStore(),childStore:n,transaction:e})}})}(0,a().exposeDebugEnvironmentValue)("getStripeLinks",(e=>function(){var t,r;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=null===(t=A().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!i)return"No space id found";const o=n(57605).A.getData(e,{spaceId:i});if(!o)return"No billing data found";const s=a?"https://dashboard.stripe.com/test":"https://dashboard.stripe.com";return{customer:o.externalId?`${s}/customers/${o.externalId}`:"No customer id found",subscription:null!==(r=o.subscription)&&void 0!==r&&r.externalId?`${s}/subscriptions/${o.subscription.externalId}`:"No subscription id found"}})),(0,a().exposeDebugEnvironmentValue)("addBlocksToPage",(e=>(t,n)=>{const r=A().default.state.currentSpaceStore,a=A().default.state.mainEditorCurrentBlockStore;r&&a&&(t<100?N(t,a,e,n):p().Hn(t/100,(()=>{N(100,a,e,n)})))})),(0,a().exposeDebugEnvironmentValue)("removeBlocksFromPage",(e=>t=>{const n=A().default.state.currentSpaceStore,r=A().default.state.mainEditorCurrentBlockStore;n&&r&&(t<100?P(t,r,e):p().Hn(t/100,(()=>{P(100,r,e)})))})),(0,a().exposeDebugEnvironmentValue)("testPremiumFeatureAvailability",(e=>async t=>{const n=A().default.state.currentSpaceStore;if(!n)return"No active space";const r=m().R0[t];if(!r)return`Unknown feature: ${t}`;let a;a="check"===r.type?"true":"unlimited",await(0,C().updateSubscription)({environment:e,spaceStore:n,from:"subscription_debug_commands",desiredState:{items:[],trialEnd:void 0},performImmediately:!0});const i=n.id,o=await f().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:i,feature:t,featureValue:a},headers:(0,c().WS)({cellId:void 0,spaceId:i})});return await I().A.resetData(e,{spaceId:i}),"success"===o.type?`Successfully enabled premium feature: ${t}`:"Something went wrong"})),(0,a().exposeDebugEnvironmentValue)("testPremiumFeatureUnavailability",(e=>async t=>{const n=A().default.state.currentSpaceStore;if(!n)return"No active space";const r=m().R0[t];if(!r)return`Unknown feature: ${t}`;let a;a="check"===r.type?"false":"0";const i=await(0,w().p_)({environment:e,spaceId:n.id}),o=["enterprise","ai"].map((e=>({quantity:1,price:i.find((t=>t.product===e&&"month"===t.billingInterval))})));if(o.some((e=>!e.price)))return"Could not find prices for all items";await(0,C().updateSubscription)({environment:e,spaceStore:n,desiredState:{items:o,trialEnd:void 0},from:"subscription_debug_commands",paymentData:{type:"paymentMethodId",value:"pm_card_visa"}});const s=n.id,u=await f().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:s,feature:t,featureValue:a},headers:(0,c().WS)({cellId:void 0,spaceId:s})});return await I().A.resetData(e,{spaceId:s}),"success"===u.type?`Successfully disabled premium feature: ${t}`:"Something went wrong"}))}}]);