"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943],{8741:(e,t,o)=>{o.r(t),o.d(t,{arrowDiagonalUpRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.65 3.66 8.68 8.68",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M5.603 3.663a.625.625 0 1 0 0 1.25h4.6l-6.37 6.371a.615.615 0 0 0 .013.87.616.616 0 0 0 .87.014l6.371-6.372v4.601a.625.625 0 1 0 1.25 0v-6.11a.625.625 0 0 0-.625-.624z"})},r=(0,o(340498).wt)("arrowDiagonalUpRightSmall",n)},63467:(e,t,o)=>{o.d(t,{y:()=>d});var n=()=>o(637997),r=()=>o(267419);const i={ko:()=>o.e(2268).then(o.bind(o,224434)),es:()=>o.e(95264).then(o.bind(o,196425)),de:()=>o.e(35390).then(o.bind(o,653703)),fr:()=>o.e(3272).then(o.bind(o,94677)),pt:()=>o.e(27315).then(o.bind(o,766869)),zh:()=>o.e(69945).then(o.bind(o,516814)),ja:()=>o.e(77757).then(o.bind(o,824432)),da:()=>o.e(9423).then(o.bind(o,440761)),fi:()=>o.e(59337).then(o.bind(o,462135)),nb:()=>o.e(2040).then(o.bind(o,937314)),nl:()=>o.e(51106).then(o.bind(o,530897)),sv:()=>o.e(53631).then(o.bind(o,895222)),id:()=>o.e(69945).then(o.bind(o,516814)),th:()=>o.e(69945).then(o.bind(o,516814)),vi:()=>o.e(69945).then(o.bind(o,516814))};let l=!1,s=!1;async function a(e){for(const[o,r]of Object.entries(e.emojiLocaleKeywords)){var t;n().fB[o]={...n().fB[o],keywords:[...r,...(null===(t=n().fB[o])||void 0===t?void 0:t.keywords)||[]]}}await r().A.waitUntilLoaded(),r().A.update((t=>{let{emojiByName:o,...n}=t;return{...n,emojiByName:{...o,...e.emojiByName}}}))}async function c(){if(l)return;const[e]=o(662303).locale.split("-");e in i&&(await a(await i[e]()),l=!0)}const d=(0,o(279900).A)((async()=>{await async function(){s||(await a(await o.e(51872).then(o.bind(o,443716))),s=!0)}(),await c()}))},73223:(e,t,o)=>{o.r(t),o.d(t,{dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>g,tutorialGoToNextStep:()=>a,tutorialGoToPrevStep:()=>c});var n=()=>o(541235),r=()=>o(751156),i=()=>o(755199),l=()=>o(739135),s=()=>o(765957);function a(e,t){var o;const{currentUserSettingsStore:n}=s().default.state;if(!n)return;const r=null===(o=n.getSettings())||void 0===o?void 0:o.tutorials;m({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{i().mJ({userSettingsStore:n,transaction:e,data:{tutorials:{...r,[t]:(0,l().i9)(n,t)}}})},userId:n.id})}function c(e,t){var o;const{currentUserSettingsStore:n}=s().default.state;if(!n)return;const r=null===(o=n.getSettings())||void 0===o?void 0:o.tutorials;m({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{i().mJ({userSettingsStore:n,transaction:e,data:{tutorials:{...r,[t]:(0,l().KD)(n,t)}}})},userId:n.id})}function d(e,t){var o;const{currentUserSettingsStore:r}=s().default.state;if(!r)return;const l=null===(o=r.getSettings())||void 0===o?void 0:o.tutorials;(null==l?void 0:l[t])!==n().YD&&m({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{i().mJ({userSettingsStore:r,transaction:e,data:{tutorials:{...l,[t]:n().YD}}})},userId:r.id})}function u(e){const{currentUserSettingsStore:t}=s().default.state;t&&m({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{i().mJ({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,o){var r;const{currentUserSettingsStore:a}=s().default.state;if(!a||(0,l().x$)(a,t))return;const c=(0,l().gt)(a,t);n().c$[t].steps.findIndex((e=>e.id===c))>=n().c$[t].steps.findIndex((e=>e.id===o))||i().mJ({userSettingsStore:a,transaction:e,data:{tutorials:{...null===(r=a.getSettings())||void 0===r?void 0:r.tutorials,[t]:o}}})}function g(e,t,o){if((0,l().ll)(o))return;const n=(0,l().tb)(t,o);n&&p(e,t,n)}function m(e){return r().createAndCommit({...e,canUndo:!1})}},74513:(e,t,o)=>{o.d(t,{V:()=>n});const n=32},99600:(e,t,o)=>{o.d(t,{A:()=>V});var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(401497),s=()=>o(449552),a=()=>o(701751),c=()=>o(340498),d=o(474848);const u=(0,c().wt)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,d.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),p=(0,c().wt)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,d.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})});var g=()=>o(105819);const m=(0,c().wt)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,d.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var S=()=>o(798880),h=()=>o(695608),f=()=>o(959013),y=()=>o(679924);function v(e,t){(0,y().v)(e,"edit_lock_toggle",t)}var x=()=>o(896628),b=()=>o(751156),C=()=>o(722872),w=()=>o(377586),k=()=>o(455425),R=()=>o(712505),A=()=>o(630116),I=()=>o(575143),T=()=>o(704152),j=()=>o(406699),_=()=>o(928600),B=()=>o(939740),P=()=>o(89924),M=()=>o(859428),F=()=>o(198688);const V=function(e){let{store:t,disableTooltip:o,hideText:n,isInlineCollection:i,buttonStyle:l}=e;const{isMobile:s}=(0,r().Y0)();return s?(0,d.jsx)(W,{store:t,hideText:n}):(0,d.jsx)(H,{store:t,disableTooltip:o,hideText:n,isMobile:s,isInlineCollection:i,buttonStyle:l})};function L(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function O(e,t,o,n,r){return{...L(e,n,r),color:o.text.tertiary,fill:o.icon.tertiary}}function E(e,t,o,n,r){return{...L(e,n,r),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function D(e){let{store:t}=e;const o=(0,l().DP)(),n=(0,i().K8)((()=>t.getFormat().block_locked_by),[t]),r=(0,f().tz)(),s=(0,i().K8)((()=>n&&(0,h().c6)(r,A().sk.createChildStore(t,{table:S().oo,id:n}).getModel())),[n,r,t]);return n?(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,d.jsx)("b",{children:s}),br:(0,d.jsx)("br",{}),prompttext:e=>(0,d.jsx)("span",{style:{color:o.text.contrastSecondary},children:e})}})}):null}function z(e,t){k().$.relockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!0,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}function K(e){let{store:t,close:o}=e;const i=(0,r().v3)(),l=(0,n.useCallback)((()=>{!function(e,t){k().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),s=(0,n.useCallback)((()=>{!function(e,t){b().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:o=>{x()._l({environment:e,store:t,isLocked:!1,transaction:o})}});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),c=[{key:"temp_unlock",render:e=>(0,d.jsx)(I().A,{...e,svg:g().pencilLineIcon,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{l()}},{key:"perm_unlock",render:e=>(0,d.jsx)(I().A,{...e,svg:a().p,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{s()}}];return(0,d.jsx)(_().A,{menuType:C().gu.Popup,children:(0,d.jsx)(B().Ay,{type:B().Oh.Vertical,onAccept:o,sections:[{key:"unlock_options",render:e=>(0,d.jsx)(P().A,{...e}),items:c}],initialFocus:void 0})})}function H(e){let{store:t,disableTooltip:o,hideText:a,isMobile:c,isInlineCollection:u,buttonStyle:p}=e;const g=(0,l().DP)(),S=(0,r().v3)(),h=(0,n.useCallback)((()=>z(S,t)),[S,t]),y=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),v=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),x=(0,i().K8)((()=>R().default.state.open&&R().default.state.targetStore.id===t.id),[t.id]);return y?v?(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(F().A,{}),(0,d.jsxs)(T().A,{style:E(c,0,g,u,p),onClick:h,hoveredStyle:{background:g.outlineBlueButtonHoveredBackground},pressedStyle:{background:g.outlineBlueButtonPressedBackground},children:[m({width:16,marginRight:a?void 0:4}),!a&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,d.jsx)(M().A,{renderTooltip:()=>(0,d.jsx)(D,{store:t}),disableTooltip:o,render:e=>(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(F().A,{}),(0,d.jsx)(j().Ay,{popupType:w().n.Popup,renderOrigin:t=>{let{onClick:o}=t;return(0,d.jsxs)(T().A,{style:O(c,0,g,u,p),onClick:o,...e,children:[(0,s().g)({width:16,marginRight:a?void 0:4}),!a&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}})]})}):null}function W(e){let{store:t,hideText:o}=e;const s=(0,l().DP)(),a=(0,r().v3)(),c=(0,n.useCallback)((()=>z(a,t)),[a,t]),g=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),m=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),{WindowSizeStore:S}=a,h=(0,i().K8)((()=>S.getSafePaddingLeftCSS(10)),[S]),y=(0,i().K8)((()=>S.getSafePaddingRightCSS(14)),[S]);return g?m?(0,d.jsxs)(T().A,{onClick:c,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:h,paddingRight:y,color:s.blueColor,fill:s.blueColor},children:[p({width:20,height:16,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,d.jsx)(j().Ay,{popupType:w().n.Popup,renderOrigin:e=>{let{onClick:t}=e;return(0,d.jsxs)(T().A,{onClick:t,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:h,paddingRight:y},children:[u({width:20,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}}):null}},105819:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineIcon:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.63 4.12 14.99 11.76",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},r=(0,o(340498).wt)("pencilLine",n)},114641:(e,t,o)=>{o.d(t,{H:()=>r});var n=()=>o(679924);function r(e){const{collectionContextStore:t,environment:o,incrementLimitArgs:r}=e;t.groupsStore.incrementLimit(e.incrementLimitArgs),t.loadingDetailsStore.setState({type:"load_more_blocks",group:r.groupsPointer}),(0,n().v)(o,"collection_load_more_blocks")}},124311:(e,t,o)=>{o.d(t,{K:()=>r});var n=()=>o(679924);function r(e){(0,n().v)(e,"inline_collection_load_more_click")}},132389:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);function r(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},157071:(e,t,o)=>{o.d(t,{PH:()=>v,Un:()=>b,V_:()=>C,hn:()=>A,lY:()=>k,v7:()=>R,zU:()=>w});var n=()=>o(584262),r=()=>o(970330),i=()=>o(522986),l=()=>o(612008),s=()=>o(857783),a=()=>o(281948),c=()=>o(778417),d=()=>o(725614),u=()=>o(714574),p=()=>o(573451),g=()=>o(357643),m=()=>o(519839),S=()=>o(862292),h=()=>o(476492),f=()=>o(996494),y=()=>o(372267);function v(e){(0,u().P)({store:e})}function x(e,t,o,n,r){if("title"===e){i().VN({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();c().hc({environment:r,store:t}),(0,p().C)({store:t}),d().setSelectionAtEnd({store:e})}else e?(i().VN({environment:r,blockPropertyValueOverlayStore:o}),i().ho({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:"list",collectionContextStore:n})):i().VN({environment:r,blockPropertyValueOverlayStore:o});v(t)}async function b(e,t,o,n,r,i,l){const s=await S().T.formulas.load();x((0,y().cO)(e,t,o,n,r,l,s),o,t,i,e)}async function C(e,t,o,n,r,i,l){const s=await S().T.formulas.load();x((0,y().o6)(e,t,o,n,r,l,s),o,t,i,e)}function w(e,t){v(e),t()}function k(e,t,o){i().VN({environment:e,blockPropertyValueOverlayStore:t}),c().Lt({environment:e,store:o}),v(o)}function R(e){const{environment:t,newStore:o,previousStore:n}=e;c().hc({environment:t,store:o}),(0,p().C)({store:o}),f().A.setState({store:o,editMode:"new",previousStore:n})}function A(e){var t;const{transaction:o,environment:i,results:c,collectionContextStore:d,isFullScreen:u,groupsPointer:p,insertAtIndex:S,editInPeek:f,from:y}=e;d.searchQueryStore.state&&(0,g().S)({searchQuery:"",collectionContextStore:d,isFullScreen:u});const v=null===(t=d.groupsStore.getGroupState(p))||void 0===t?void 0:t.resultsStore;if(!v)return;let x;S>0&&(x=c[S]);const b=(0,l().Q)({environment:i,collectionContextStore:d,groupsPointer:p,insertAtIndex:S,shouldCoerce:!0,templateStore:d.defaultPageTemplateStore.state,transaction:o,from:{createBlock:y},inMemoryRecordCache:i.defaultRecordCache.inMemoryRecordCache});if(!b)return;const C=b.coercionSucceeded,w=b.newStore;return i.device.isMobile?s().uK({environment:i,store:w,pageVisitSource:n().y8.Create}):C&&!f?R({environment:i,newStore:w,previousStore:x}):a().VU({environment:i,store:w,peekMode:(0,m().hH)(d),resultsStore:v,collectionContextStore:d,pageVisitSource:n().y8.Create}),r().v(i,{from:y,type:"page",new_page_id:w.id,creating_block_id:w.id,...(0,h().sl)(d)}),w}},170356:(e,t,o)=>{o.d(t,{NS:()=>u,Pq:()=>m,Z3:()=>d,sw:()=>p});o(296540);var n=()=>o(484714),r=()=>o(297872),i=()=>o(928600),l=()=>o(678553),s=()=>o(480095),a=()=>o(722872),c=o(474848);const d=8,u=8,p=32,g={height:p+d-2,paddingTop:d-2};function m(e){let{title:t,helpButton:o,onCancel:l,desktopMinWidth:d,desktopMaxWidth:u,desktopWidth:p,children:g}=e;const{device:m}=(0,n().v3)();return(0,c.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=m.isMobile?{menuType:a().gu.Modal,title:t,right:(0,c.jsx)(s().DoneMenuText,{}),onClickRight:l,...e}:{menuType:a().gu.Popup,...d&&{minWidth:d},...u&&{maxWidth:u},...p&&{width:p},...e},(0,c.jsx)(i().A,{...n,header:t&&(0,c.jsx)(S,{title:t,helpButton:o}),children:g})}})}function S(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,c.jsx)(l().Ay,{style:g,title:t,right:o})}},171559:(e,t,o)=>{o.d(t,{Fp:()=>a,ML:()=>s,Pe:()=>i});var n=()=>o(645873);const r=new(n().O2)("formEditorActionButtons",(()=>Promise.all([o.e(75134),o.e(9304),o.e(16471),o.e(58550),o.e(44711),o.e(53321),o.e(90825),o.e(96346),o.e(55373),o.e(37353),o.e(29151),o.e(78191),o.e(92845),o.e(84468),o.e(5605),o.e(48486),o.e(95794),o.e(13677),o.e(56952),o.e(48632),o.e(75078),o.e(74562),o.e(27711),o.e(4422),o.e(11341),o.e(46414),o.e(95168),o.e(28271),o.e(34877),o.e(36908),o.e(17254),o.e(84185),o.e(32421),o.e(15315),o.e(24587),o.e(78708),o.e(43777),o.e(74752),o.e(91194),o.e(81197),o.e(98659),o.e(20502),o.e(6266),o.e(8184),o.e(83884),o.e(65881),o.e(99809),o.e(93282),o.e(43678),o.e(90978),o.e(77213),o.e(21194),o.e(39541),o.e(45620),o.e(58102),o.e(9066),o.e(51859),o.e(69095)]).then(o.bind(o,22039)))),i=(0,n().jQ)(r,(e=>e.default)),l=new(n().O2)("conditionalLogicTooltip",(()=>o.e(16130).then(o.bind(o,879022)))),s=(0,n()._h)(l,(e=>e.ConditionalLogicTooltip)),a=(0,n()._h)(l,(e=>e.ConditionalLogicUpsellTooltip))},198688:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(){const e=(0,o(401497).IS)((e=>({separator:{height:14,width:1,marginLeft:6,marginRight:6,background:e.darkDividerColor}})),[]);return(0,n.jsx)("div",{style:e.separator})}},207207:(e,t,o)=>{o.d(t,{J:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.62 2.62 15.26 15.26",svg:(0,o(474848).jsx)("path",{d:"M8.875 2.625a6.25 6.25 0 1 0 3.955 11.09l3.983 3.982a.625.625 0 1 0 .884-.884l-3.983-3.982a6.25 6.25 0 0 0-4.84-10.205m-5 6.25a5 5 0 1 1 10 0 5 5 0 0 1-10 0"})},r=(0,o(340498).wt)("magnifyingGlass",n)},222334:(e,t,o)=>{o.r(t),o.d(t,{arrowChevronSingleRightIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"7.22 3.97 6.66 12.06",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M13.692 10.442a.625.625 0 0 0 0-.884l-5.4-5.4a.625.625 0 1 0-.884.884L12.366 10l-4.958 4.958a.625.625 0 0 0 .884.884z"})},r=(0,o(340498).wt)("arrowChevronSingleRight",n)},271084:(e,t,o)=>{o.d(t,{k:()=>r});o(581454);class n extends(()=>o(757695))().Store{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort(((e,t)=>{let[o,n]=e,[r,i]=t;return i-n})).map((e=>{let[t,o]=e;return t}))}}const r=new n;(0,o(604341).exposeDebugValue)("UserSimilarityStore",r)},279900:(e,t,o)=>{function n(e){let t,o,n;return async function(){for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return t?(n=i,o||(o=t.then((()=>(o=void 0,t=e(...n),t))),o)):(t=e(...i),t)}}o.d(t,{A:()=>n})},285176:(e,t,o)=>{o.d(t,{o:()=>s});o(296540);var n=()=>o(401497),r=()=>o(133033),i=()=>o(959013),l=o(474848);function s(e){const{href:t,style:o}=e,s=(0,n().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...s.default,...o},children:[(0,r().$)({width:14,marginRight:4}),(0,l.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},286367:(e,t,o)=>{o.d(t,{D:()=>T});o(898992),o(354520);var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(401497),s=()=>o(955363),a=()=>o(340498),c=()=>o(959013),d=()=>o(284371),u=()=>o(436696),p=()=>o(896628),g=()=>o(246826),m=()=>o(725614),S=()=>o(751156),h=o(474848);const f=function(e){const{store:t,titleStyle:n,actionButton:r,addViewButton:l}=e,s=(0,i().K8)((()=>t.getParentBlockStore()),[t]);return(0,h.jsx)("div",{children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,h.jsx)(o(599945).c,{step:"demo_collection",store:s,children:(0,h.jsx)(o(16006).A,{store:t,style:n})}),l,r]})})};var y=()=>o(760217),v=()=>o(939740),x=()=>o(8980),b=()=>o(897119),C=()=>o(187820),w=()=>o(89924),k=()=>o(722872),R=()=>o(963589),A=()=>o(46986);const I=(0,c().YK)({actionsButtonAriaLabel:{defaultMessage:"Collection actions",id:"database.source.actionsButtonAriaLabel"},editIconTitle:{defaultMessage:"Edit data source icon",id:"database.source.editIcon.title"}}),T=n.memo((function(e){const{isHovered:t,collectionContextStore:n,addViewButton:r,showHoverActionsStore:s,titleStyle:a,iconStyle:c,iconSize:u}=e,[p,g,m]=(0,i().K8)((()=>[n.collectionStore(),n.collectionViewBlockStore(),n.permissionScopesStore.state]),[n]),S=(0,i().K8)((()=>n.viewsModuleContextStore.isInLayoutBuilder()),[n]),y=(0,i().K8)((()=>{const e=n.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,o(792002).j_)(t))}),[n]),v=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==g?void 0:g.id))}),[p,g]),x=(0,i().K8)((()=>Boolean(null==p?void 0:p.isSyncedCollection())),[p]),b=(0,o(106412).Zp)(),C=(v||y)&&m.canConfigureCollection&&!(null!=b&&b.disableEditingName)&&!x,w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,display:"flex",alignItems:"center",...d().RC},titleStyle:{fontWeight:d().Wy.bold,fontSize:22,...y?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},marginRight:4,...a}})),[y,a]);return p&&(null!=b&&b.disableAllPointerEvents||S)?(0,h.jsxs)("div",{style:w.container,children:[(0,h.jsx)(B,{collectionContextStore:n,disabled:!0,iconStyle:c,iconSize:u}),(0,h.jsx)(f,{store:p,titleStyle:w.titleStyle})]}):C?(0,h.jsx)(_,{isHovered:t,collectionContextStore:n,showHoverActionsStore:s,titleStyle:w.titleStyle,iconStyle:c,iconSize:u,addViewButton:r}):(0,h.jsx)(j,{isHovered:t,addViewButton:r,collectionContextStore:n,showHoverActionsStore:s,titleStyle:w.titleStyle,iconStyle:c,iconSize:u})})),j=n.memo((function(e){const{isHovered:t,collectionContextStore:s,showHoverActionsStore:a,titleStyle:c,iconStyle:p,iconSize:g,addViewButton:m}=e,S=(0,r().v3)(),{collectionStore:y,collectionViewBlockStore:v}=(0,i().K8)((()=>({collectionStore:s.collectionStore(),collectionViewBlockStore:s.collectionViewBlockStore()})),[s]),{isSystemCollection:x,href:b}=(0,i().K8)((()=>{const e=Boolean(null==y?void 0:y.isSystemCollection());return{isSystemCollection:e,href:e?void 0:(0,o(519839).t2)(s)}}),[s,y]),C=(0,R().X)("db_ux_chrome"),w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,...d().RC},containerInner:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:6},containerHovered:{...C&&{background:"none"}}})),[C]),k=(0,n.useCallback)((()=>{(0,u().X)({environment:S,collectionContextStore:s,action:"click_collection_name_link_button"})}),[S,s]);return y&&v?(0,h.jsxs)(o(296798).A,{disabled:x,style:w.container,innerStyle:w.containerInner,hoveredStyle:w.containerHovered,href:b,onClick:k,children:[(0,h.jsx)(B,{collectionContextStore:s,disabled:!0,iconStyle:p,iconSize:g}),(0,h.jsx)(f,{addViewButton:t?m:void 0,actionButton:t?(0,h.jsx)(P,{showHoverActionsStore:a,collectionContextStore:s}):void 0,store:y,titleStyle:c})]}):null})),_=n.memo((function(e){const{isHovered:t,collectionContextStore:s,addViewButton:a,showHoverActionsStore:d,titleStyle:p,iconStyle:g,iconSize:S}=e,f=(0,r().v3)(),y=(0,c().tz)(),v=(0,A().x6)(),x=(0,i().K8)((()=>s.collectionStore()),[s]),b=(0,i().K8)((()=>s.collectionViewBlockStore()),[s]),C=(0,i().K8)((()=>null==x?void 0:x.getNameStore()),[x]),w=(0,i().K8)((()=>(0,o(697650).BN)({collectionStore:x,intl:y,isWorkflowsContainerWithCreationEnabled:v})),[x,y,v]),k=(0,R().X)("content_reskin_v2"),I=(0,l().IS)((e=>({container:{display:"flex",alignItems:"center",...k?{}:{marginLeft:4,marginRight:4}},titleIcons:{display:"flex",alignItems:"center",opacity:t?1:0},text:p,placeholder:{WebkitTextFillColor:e.pageTitlePlaceholderTextColor,cursor:"text"}})),[p,t,k]),T=(0,n.useMemo)((()=>(0,h.jsxs)("div",{style:I.titleIcons,children:[a,(0,h.jsx)(P,{showHoverActionsStore:d,collectionContextStore:s})]})),[a,s,d,I.titleIcons]),j=(0,n.useCallback)((()=>{o(778417).IU({environment:f})}),[f]),_=(0,n.useCallback)((()=>{const e=!Boolean(null==C?void 0:C.getValue());o(780054).A.isMobile&&C&&e&&m().selectAllText({environment:f,store:C,canSelectAllBlocks:!1}),(0,u().X)({environment:f,collectionContextStore:s,action:"click_collection_name_input"})}),[C,f,s]);return x&&b&&C?(0,h.jsxs)("div",{style:I.container,children:[(0,h.jsx)(B,{collectionContextStore:s,disabled:!1,iconStyle:g,iconSize:S}),(0,h.jsx)(o(524702).A,{store:C,style:I.text,disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:w,onEnter:j,onEsc:j,onClick:_,disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:o(792540).Os.none,placeholderStyle:I.placeholder},C.id),T]}):null})),B=n.memo((function(e){const{disabled:t,collectionContextStore:a,iconStyle:c,iconSize:d=22}=e,u=(0,r().v3)(),{collectionStore:p,collectionViewBlockStore:m}=(0,i().K8)((()=>({collectionStore:a.collectionStore(),collectionViewBlockStore:a.collectionViewBlockStore()})),[a]),f=(0,i().K8)((()=>null==p?void 0:p.getIcon()),[p]),y=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==m?void 0:m.id))}),[p,m]),v=(0,i().K8)((()=>null==m?void 0:m.getType()),[m]),b=(0,l().IS)((e=>({iconStyle:{width:d,height:d,marginRight:4,...c},container:{position:"relative",width:d+2,height:d+2,marginRight:4,display:"flex",alignItems:"center",justifyContent:"center"},arrowContainer:{width:20,marginRight:4},pageLinkIndicatorIcon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.text.primary:"#3E3C38",stroke:"dark"===e.mode?e.surface.wash:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[c,d]),w=(0,n.useCallback)((e=>{const t=p&&p.getIconStore();t&&S().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:u,canUndo:!0,perform:o=>{g().KY({store:t,value:e,transaction:o})}})}),[p,u]);return p&&m?f||y?f?(0,h.jsxs)("div",{style:b.container,children:[t?(0,h.jsx)(C().B6,{disabled:!0,bucket:"secure",store:p,icon:f,iconRecordCategory:"collection",isEmptyPage:!1,style:b.iconStyle,size:d}):(0,h.jsx)(C().B6,{disabled:!1,bucket:"secure",store:p,icon:f,iconRecordCategory:"collection",isEmptyPage:!1,style:b.iconStyle,size:d,iconLoggingData:{recordTable:p.table,source:"inline_collection",block_type:v,collection_id:p.id},onChange:w}),!y&&(0,o(500066).G)(b.pageLinkIndicatorIcon)]}):null:(0,h.jsx)("div",{style:b.arrowContainer,children:(0,h.jsx)(x().I,{icon:s().arrowDiagonalUpRightIcon})}):null})),P=n.memo((function(e){const{showHoverActionsStore:t,collectionContextStore:s}=e,{isMobile:d}=(0,r().Y0)(),u=(0,c().tz)(),p=(0,i().O$)(t),g=(0,l().IS)((()=>({container:{display:"flex"},buttonPopup:{width:240},iconStyle:{width:a().Ev.sm,height:a().Ev.sm}})),[]),m=(0,n.useCallback)((e=>(0,h.jsx)(o(285790).A,{icon:o(126617).Y,iconStyle:g.iconStyle,ariaLabel:u.formatMessage(I.actionsButtonAriaLabel),...e})),[u,g.iconStyle]),S=(0,n.useCallback)((e=>(0,h.jsx)(M,{parent:e,collectionContextStore:s})),[s]);return(0,h.jsx)(o(145214).A,{visible:p,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:g.container,children:(0,h.jsx)(o(406699).Ay,{popupType:d?b().nl.SlideUp:b().nl.Popup,render:S,renderOrigin:m,style:g.buttonPopup,originGap:4})})})),M=n.memo((function(e){const{parent:t,collectionContextStore:l}=e,a=(0,r().v3)(),{isMobile:d}=(0,r().Y0)(),f=(0,c().tz)(),b=(0,R().X)("db_ux_chrome"),T=(0,A().Y4)(),{collectionStore:j,collectionViewStore:_}=(0,i().K8)((()=>({collectionStore:l.collectionStore(),collectionViewStore:l.collectionViewStore()})),[l]),B=(0,o(955450).K)({collectionContextStore:l}),P=(0,R().X)("notion_calendar_db_integration_non_time_views"),M=(0,o(637096).W)({collectionContextStore:l,entrypoint:"view_menu"}),F=(0,i().O$)(l.permissionScopesStore),V=(0,i().K8)((()=>null==j?void 0:j.isSyncedCollection()),[j]),L=(0,i().K8)((()=>{var e,t;const o=Boolean(null==j?void 0:j.isSystemCollection()),n=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.id,r=null==j||null===(t=j.getParentBlockStore())||void 0===t?void 0:t.id,i=r&&n&&r===n;return(!(l.isFullScreenStore.state&&i)||!T)&&!o}),[l,j,T]),O=(0,i().K8)((()=>{var e;return(null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.hasMultipleOwnedOrLinkedCollections())??!1}),[l]),E=(0,i().uB)(void 0,o(663173).A),D=(0,n.useRef)(null),z=(0,n.useMemo)((()=>{const e=e=>{const t=null==j?void 0:j.getIconStore();t&&t.getValue()!==e&&(S().createAndCommit({userAction:"updateCollectionIcon",environment:a,canUndo:!0,perform:o=>{g().KY({store:t,value:e,transaction:o})}}),o(383594).I())},n=[...L?[{key:"view",render:e=>(0,h.jsx)(y().A,{...e,title:(0,h.jsx)(c().sA,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,h.jsx)(x().I,{icon:s().arrowDiagonalUpRightIcon})}),action:e=>{(0,o(239529).q)({environment:a,collectionContextStore:l,event:e.event,buttonPopupParent:t})}}]:[],...F.canConfigureCollection&&!V?[{key:"edit_name",render:e=>(0,h.jsx)(y().A,{...e,title:T&&O?(0,h.jsx)(c().sA,{id:"database.source.editDataSourceTitle.title",defaultMessage:"Edit data source title"}):(0,h.jsx)(c().sA,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,h.jsx)(x().I,{icon:o(105819).pencilLineIcon})}),action:()=>{const e=null==j?void 0:j.getNameStore();e&&(m().selectAllText({environment:a,store:e,canSelectAllBlocks:!1}),t.close(),(0,u().X)({environment:a,collectionContextStore:l,action:"click_source_edit_title"}))}},...T?[{key:"edit_icon",render:e=>(0,h.jsx)(y().A,{...e,ref:e=>{D.current=e},title:(0,h.jsx)(c().sA,{...I.editIconTitle}),icon:(0,h.jsx)(x().I,{icon:o(424139).emojiFaceIcon})}),action:()=>{D.current&&j&&(0,C().sg)({node:D.current,currentTab:"emoji",fileUploadParams:{bucket:"secure",store:j},environment:a,intl:f,disabled:!1,fileUploadStore:E,onChange:e})}}]:[],...B&&P?[{key:"calendar",render:e=>(0,h.jsx)(o(187391).N,{...e}),action:()=>{M()}}]:[]]:[]];return n.filter((e=>null!==e))}),[L,F.canConfigureCollection,V,a,l,t,j,O,f,T,E,B,P,M]),K=(0,n.useMemo)((()=>({key:"show_title",render:e=>(0,h.jsx)(y().A,{...e,icon:(0,h.jsx)(x().I,{icon:o(566910).e}),title:T&&O?(0,h.jsx)(c().sA,{id:"database.source.hideDataSourceTitles.title",defaultMessage:"Hide data source titles"}):(0,h.jsx)(c().sA,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{S().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:a,canUndo:!0,perform:e=>{if(!_)return;p().zA({stores:[_],update:{hide_linked_collection_name:!0},transaction:e});const t=l.collectionViewBlockStore();b&&t&&p().zA({stores:[t],update:{hide_inline_collection_name:!0},transaction:e})}}),t.close(),(0,u().X)({environment:a,collectionContextStore:l,action:"click_source_hide_title"})}})),[l,_,a,t,b,O,T]),H=(0,n.useMemo)((()=>[z.length>0?{key:"actions",render:e=>(0,h.jsx)(w().A,{...e}),items:z}:null,F.canConfigureBlock?{key:"show_title",render:e=>(0,h.jsx)(w().A,{...e,topBorder:!0}),items:[K]}:null].filter((e=>null!==e))),[z,K,F.canConfigureBlock]);return j?(0,h.jsx)(o(928600).A,{menuType:d?k().gu.ActionSheet:k().gu.Popup,children:(0,h.jsx)(v().Ay,{type:v().Oh.Vertical,onAccept:t.close,sections:H,initialFocus:void 0})}):null}))},286993:(e,t,o)=>{o.d(t,{c:()=>c});o(581454),o(296540);var n=()=>o(56366),r=()=>o(496603),i=()=>o(812119),l=()=>o(175116),s=()=>o(62856),a=o(474848);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().Ks)(),g=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,s().A)(!0,0,100))return null;let m=1;void 0!==u?m=u:o||c||d||(m=t?10:3);const S=m>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().Hn(m).map((e=>(0,a.jsx)(i().J,{isInHomeWidget:g,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:g?8:3},children:h})}},316369:(e,t,o)=>{o.d(t,{w:()=>w});o(581454),o(296540);var n=()=>o(484714),r=()=>o(56366),i=()=>o(651124),l=()=>o(30626),s=()=>o(959013),a=()=>o(496603),c=()=>o(436696),d=()=>o(896628),u=()=>o(751156),p=()=>o(722872),g=()=>o(760217),m=()=>o(406699),S=()=>o(285790),h=()=>o(928600),f=()=>o(939740),y=()=>o(897119),v=()=>o(89924),x=o(474848);const b=(0,s().j4)((function(e){const{limit:t}=e;return(0,x.jsx)(s().sA,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})})),C=(0,s().YK)({firstLoadLimitActionButtonAriaLabel:{defaultMessage:"Load limit settings menu",id:"database.firstLoadLimitActionButton.ariaLabel"}});function w(e){let{format:t,collectionContextStore:o}=e;const i=(0,n().v3)(),{device:a}=i,p=(0,s().tz)(),g=(0,r().K8)((()=>{var e;return(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType())??"unknown"}),[o]);return a.isMobile?null:(0,x.jsx)(m().Ay,{popupType:y().nl.Popup,renderOrigin:e=>(0,x.jsx)(S().A,{icon:l()._,style:{marginLeft:4,marginRight:4},ariaLabel:p.formatMessage(C.firstLoadLimitActionButtonAriaLabel),...e}),alignmentToOrigin:m().yP.End,placementToOrigin:m().sx.Bottom,originGap:8,render:e=>(0,x.jsx)(R,{currentLimit:k({format:t,viewType:g}),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;if(!n.getType())return;u().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{d().zA({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),(0,c().X)({environment:o,collectionContextStore:t,action:"set_first_load_limit"})}(e,o,i),onClose:e.close,showTitle:!0})})}function k(e){const{format:t,viewType:o}=e;return(0,i().i3)({limit:t.inline_collection_first_load_limit,isGrouped:Boolean(t.collection_group_by),viewType:o})}function R(e){const t=(0,n().v3)(),{device:o}=t,{currentLimit:r,onAccept:l,onClose:c,showTitle:d}=e,u=(0,a().oE)(i().X9.map(((e,t)=>{const o={key:t,render:t=>(0,x.jsx)(g().A,{...t,disabled:!1,title:(0,x.jsx)(b,{limit:e}),isChecked:(0,a().n4)(r,e)}),action:()=>l(e)};return o}))),m=[{key:0,render:e=>(0,x.jsx)(v().A,{enableActionSheetTitle:!0,title:d&&(0,x.jsx)(s().sA,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:u}];let S;return S=o.isMobile?{menuType:p().gu.ActionSheet}:{menuType:p().gu.Popup,width:200},(0,x.jsx)(h().A,{...S,children:(0,x.jsx)(f().Ay,{type:f().Oh.Vertical,sections:m,onAccept:c,initialFocus:void 0})})}},350646:(e,t,o)=>{o.d(t,{k:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.27 3.53 17.42 12.94",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.375 6.775c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,n.jsx)("path",{d:"M4.066 8.914a6.477 6.477 0 0 1 12.859 1.029 3.494 3.494 0 0 1-1.725 6.532H5.121a3.855 3.855 0 0 1-1.056-7.56m6.384-4.14a5.226 5.226 0 0 0-5.2 4.716l-.047.482-.48.075a2.605 2.605 0 0 0 .406 5.178H15.2a2.244 2.244 0 0 0 .853-4.32l-.41-.169.024-.443q.008-.146.008-.293a5.225 5.225 0 0 0-5.225-5.225"})]})},i=(0,o(340498).wt)("cloudExclamation",r)},372267:(e,t,o)=>{o.d(t,{NK:()=>h,cO:()=>x,nq:()=>m,o6:()=>v,uM:()=>f});o(898992),o(354520),o(672577);var n=()=>o(584262),r=()=>o(713998),i=()=>o(416504),l=()=>o(496603),s=()=>o(519839),a=()=>o(458366),c=()=>o(909470),d=()=>o(492414),u=()=>o(972435),p=()=>o(765957),g=()=>o(217429);function m(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===e?{height:30}:{minHeight:30}}}function S(e,t){return(0,a().B2)(t[e])}function h(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=p().default.state;return s().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function f(e){return(0,d().Ay)({store:e,fullyQualified:!1,pageVisitSource:n().y8.LinkInPage})}function y(e,t,o,n,l,s){return t.isDefined()?n.filter((n=>{const a="title"!==n&&l;return!r().r8({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,i().P)(),intl:u().A.getIntl(),experimentService:g().default,collectionFeatureGates:(0,c().i)(),formulasModule:s})||a})):[]}function v(e,t,o,n,r,i,s){const a=t.state,c=a.isOpen?a.property:"title",d=y(e,o,n,r,i,s),u=d.findIndex((e=>e===c)),p=l().Uk(d,((e,t)=>t<u&&S(e,n)));return p||(i?"title":function(e,t){return l().Uk(e,(e=>S(e,t)))}(d,n))}function x(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=y(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=c.find(((e,t)=>t>d&&S(e,n)));return u||(i?"title":function(e,t){return e.find((e=>S(e,t)))}(c,n))}},403733:(e,t,o)=>{o.d(t,{g:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.05 2.12 9.9 11.76",svg:(0,o(474848).jsx)("path",{d:"M8 2.125a.61.61 0 0 0-.625.599v9.017L4.122 8.488a.625.625 0 1 0-.884.884l4.32 4.32c.244.244.64.244.884 0l4.32-4.32a.625.625 0 0 0-.884-.884l-3.253 3.253V2.724A.61.61 0 0 0 8 2.125"})},r=(0,o(340498).wt)("arrowStraightDownSmall",n)},406533:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,questionMarkCircleIcon:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},i=(0,o(340498).wt)("questionMarkCircle",r)},425981:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(941541);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=e=>{let{value:t,passThroughData:o}=e,n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},477293:(e,t,o)=>{o.d(t,{r:()=>i});var n=()=>o(56366),r=()=>o(217429);function i(e){let{disableExposureLogging:t,disableEventTrailLogging:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n().K8)((()=>r().default.getEligibleGroup({experimentId:e,defaultGroup:"control",disableExposureLogging:t,disableEventTrailLogging:o})),[e,t,o])}},500733:(e,t,o)=>{o.d(t,{I:()=>l});o(581454);var n=()=>o(496603),r=()=>o(751156),i=()=>o(654062);function l(e){const{collectionContextStore:t,environment:o,query:l,property:s,newAggregation:a}=e,c=t.collectionViewStore();if(!c)return;let d=l.aggregations?[...l.aggregations]:[];const u=(l.aggregations||[]).findIndex((e=>e.property===s));d=u<0?n().oE([...d,a]):n().oE(d.map(((e,t)=>u===t?a:e)));const p={...l,aggregations:d};!t.isClientModeEnabledStore.state&&a&&t.asyncAggregationStatusStore.setState({calculating:!0,aggregation:a,changingType:!0}),r().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:o,canUndo:!0,perform:e=>{(0,i().F)({collectionViewStore:c,update:{query2:p},transaction:e})}})}},505776:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},523389:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.03 3.22 12.19 9.61",svg:(0,o(474848).jsx)("path",{d:"M11.243 3.457a.803.803 0 0 0-1.13 0l-.554.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .107 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.02-1.11m-2.246 1.22a.075.075 0 0 0-.106 0l-6.336 6.326a1.1 1.1 0 0 0-.237.393l-.27.87v.002c-.062.232.153.466.389.383l.863-.267q.221-.061.397-.239l6.332-6.331a.075.075 0 0 0 0-.106zm-3.355 6.898a.08.08 0 0 0-.053.022l-1.1 1.1a.075.075 0 0 0 .053.128h9.06a.625.625 0 1 0 0-1.25z"})},r=(0,o(340498).wt)("pencilLineSmall",n)},527580:(e,t,o)=>{o.d(t,{TK:()=>s,YC:()=>l,ui:()=>i});var n=()=>o(645873);const r={pageVerification:new(n().O2)("pageVerification",(()=>Promise.all([o.e(58550),o.e(11341),o.e(29252),o.e(94891)]).then(o.bind(o,80826)))),pageVerificationBadge:new(n().O2)("pageVerificationBadge",(()=>Promise.all([o.e(75134),o.e(58550),o.e(92845),o.e(84468),o.e(5605),o.e(48486),o.e(95794),o.e(13677),o.e(56952),o.e(25497),o.e(74562),o.e(27711),o.e(11341),o.e(30291),o.e(12913),o.e(6463),o.e(93449),o.e(29252),o.e(74357),o.e(41412)]).then(o.bind(o,161901)))),pageVerificationMenuRenderer:new(n().O2)("pageVerificationMenuRenderer",(()=>Promise.all([o.e(75134),o.e(58550),o.e(92845),o.e(84468),o.e(5605),o.e(48486),o.e(95794),o.e(13677),o.e(56952),o.e(25497),o.e(74562),o.e(27711),o.e(11341),o.e(30291),o.e(12913),o.e(6463),o.e(93449),o.e(29252),o.e(74357),o.e(26207)]).then(o.bind(o,196770))))},i=(0,n()._h)(r.pageVerification,(e=>e.PageAddVerificationButton)),l=(0,n()._h)(r.pageVerificationBadge,(e=>e.PageVerificationBadge)),s=(0,n()._h)(r.pageVerificationMenuRenderer,(e=>e.PageVerificationMenuRenderer))},541235:(e,t,o)=>{o.d(t,{YD:()=>i,c$:()=>n,q_:()=>r});const n={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]}},r="completed",i="dismissed"},550487:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>of,CollectionViewBlockWithErrorBoundary:()=>nf});var n=o(296540),r=(o(898992),o(581454),o(908872),o(737550),()=>o(244641)),i=()=>o(17022),l=()=>o(402014),s=()=>o(908006),a=()=>o(484714),c=()=>o(852507),d=()=>o(118884),u=()=>o(56366),p=()=>o(401497),g=()=>o(757695),m=()=>o(107041),S=()=>o(763884),h=()=>o(921997),f=()=>o(558842),y=()=>o(919709),v=()=>o(496603),x=()=>o(534177),b=()=>o(436696),C=()=>o(686526),w=()=>o(557281),k=()=>o(661920),R=()=>o(257615),A=()=>o(778417),I=()=>o(725614),T=()=>o(751156),j=()=>o(865454),_=()=>o(679924),B=()=>o(2220),P=()=>o(450510),M=()=>o(928530),F=(o(672577),()=>o(493260)),V=()=>o(519839),L=()=>o(760077);var O=()=>o(799954),E=()=>o(556048),D=()=>o(478726),z=()=>o(747100),K=()=>o(953418),H=()=>o(963589),W=()=>o(712505),G=o(474848);const N=n.memo((function(e){const{store:t,collectionContextStore:r,isFullScreen:i,canEdit:l,showHoverActionsStore:s,paddingLeft:c,addViewButton:d}=e,g=(0,H().X)("db_ux_chrome"),m=(0,a().v3)(),[S,h]=(0,n.useState)(!1),f=(0,u().K8)((()=>{const e=W().default.state;return(0,z().RX)(t)||!(0,z().cq)(t)&&e.open&&e.isClosing}),[t]),y=(0,u().K8)((()=>r.collectionStore()),[r]),v=(0,u().K8)((()=>r.collectionViewBlockStore()),[r]),x=(0,u().K8)((()=>Boolean(null==y?void 0:y.isSyncedCollection())),[y]),b=(0,u().K8)((()=>Math.min(D().x6,m.WindowSizeStore.state.width)),[m.WindowSizeStore]),C=(0,H().X)("content_reskin_v2"),w=(0,p().IS)((()=>({containerHoverArea:{flexGrow:g?1:void 0},container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:f?b:"100%",boxSizing:f?"content-box":void 0,...g?{padding:`4px 0 4px ${(i?c??0:0)+(C?O().dE.paddingLeft:0)}px`}:{paddingTop:8,...C?{paddingLeft:O().dE.paddingLeft}:{}},...(i||f)&&(0,K().z4)(m)&&{position:"sticky",left:0}},flex:{display:"flex"},button:{margin:0},syncedContainer:{paddingLeft:4}})),[m,i,f,g,b,c,C]),k=(0,n.useCallback)((()=>{h(!0)}),[]),R=(0,n.useCallback)((()=>{h(!1)}),[]);return y&&v?(0,G.jsxs)("div",{onMouseEnter:k,onMouseLeave:R,style:w.containerHoverArea,children:[(0,G.jsxs)("div",{style:w.container,children:[(0,G.jsx)(o(286367).D,{collectionContextStore:r,showHoverActionsStore:s,addViewButton:d,isHovered:S}),x?(0,G.jsx)("div",{style:w.flex,children:(0,G.jsx)(o(66858).A,{canEdit:l,store:v,buttonStyle:w.button})}):null]}),(0,G.jsxs)("div",{style:w.syncedContainer,children:[(0,G.jsx)(o(948049).A,{collectionStore:y,collectionContextStore:r}),(0,G.jsx)(E().GL,{store:y})]})]}):null}));o(18107),o(967357),o(803949);var $=()=>o(179034),U=()=>o(741496),X=()=>o(388821),q=()=>o(951177);const Y=new(o(178624).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function Q(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,q().hB)(e);Y.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void Y.setState({});const{recordMaps:l,...s}=i;Y.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...s,recordMapsJson:ee(l)}})}function Z(e){const t=Y.getState(),o=(0,q().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{Y.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:s}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:s||!1,value:{...l,recordMaps:J(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:J(r.recordMapsJson)}}):Promise.resolve(void 0)}function J(e){return new Map(e.map((e=>{let[t,o]=e;return[t,X().RecordMap.create(o)]})))}function ee(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var te=()=>o(884107),oe=()=>o(60867),ne=()=>o(899453),re=()=>o(797265),ie=()=>o(675925),le=()=>o(545805),se=()=>o(175116),ae=()=>o(659602),ce=()=>o(335722),de=()=>o(855801),ue=()=>o(405417),pe=()=>o(504836),ge=()=>o(645873),me=()=>o(630116),Se=()=>o(502438),he=()=>o(24157);const fe=n.memo((function(){const e=(0,a().v3)(),t=(0,se().ET)(),{value:r}=(0,ge().fJ)(ae().g),{value:i}=(0,ge().fJ)(ce().S),l=(0,u().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),c=(0,u().K8)((()=>{if(he().default.isEditingStore.state)return!1;const e=Se().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,ue().oC)(e))return!1;const n=(0,o(236162).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===l}),[l]),d=n.useCallback((async o=>{(await te().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=Se().default.state.stores;Q(o,{lastActionWasCut:!1,valuePromise:ye(e).then((o=>{const{result:r,status:i}=o;if("failed"===i)return;for(const n of r){var l;(0,U().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const s=r.length>0;for(const c of n){var a;(0,U().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:s,collection_id:null===(a=t.collectionStore())||void 0===a?void 0:a.id})}return ve({environment:e,subitems:r})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await te().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,pe().pB)())return;const i=Se().default.state.stores,s=ye(e),a=ye(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,U().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:l});const r=o.length>0;for(const s of i)(0,U().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:s.id,block_type:s.getType(),isBulk:r,collection_id:l});return ve({environment:e,subitems:o})}));await Q(o,{lastActionWasCut:!0,valuePromise:a});const c=Se().default.getState().stores,d=(await s).result;await oe().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,l,e,r]),g=n.useCallback((async o=>{var n,a,c,d;const u=await te().R.clipboardActions.load(),p=await Z(o),g=await de().VI.loadLocalSubtree.load(),m=await de().VI.localDuplicate.load();if(Y.setState({...Y.getState(),lastActionWasCut:!1}),!p){T().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{var n;(0,ie().o)(e,{action:"paste",block_type:null===(n=C[0])||void 0===n?void 0:n.getType(),from:"collection_view_keyboard_shortcut"},(n=>{u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:t,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i}),n()}))}});const t=Se().default.state.stores[0];if(void 0===t)return;return void(0,U().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:l})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,pe().pB)())return;const{recordMaps:f,subitemFormat:y,childRelationSchema:v,parentRelationSchema:x}=p.value;if(!(f&&y&&v&&x))return;const b=[...f.entries()].map((e=>{let[t]=e;return me().Bv.createChildStore(h,{table:$().ev,id:t})}));await Promise.all(b.map((e=>e.load())));const C=Se().default.getState().stores,w=!(p.lastActionWasCut&&function(e,t){const o=t.map((t=>me().Bv.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,b));let k=[],R=ue().n9(t),I=null===(n=R)||void 0===n?void 0:n.parentRelationProperty,j=null===(a=R)||void 0===a?void 0:a.childRelationSchema,_=null===(c=R)||void 0===c?void 0:c.parentRelationSchema,B=null===(d=R)||void 0===d?void 0:d.subitemFormat;const P=t.permissionScopesStore.state.canConfigureCollection;for(const t of b)(0,U().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:p.value.isBulk,collection_id:l});if(T().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:n=>{if(!B&&P){oe().VI({transaction:n,collectionContextStore:t,environment:e})&&(R=ue().n9(t),R&&(I=R.parentRelationProperty,j=R.childRelationSchema,_=R.parentRelationSchema,B=R.subitemFormat))}var l;if(!(I&&j&&_&&B))return void(0,ie().o)(e,{action:"paste",block_type:null===(l=C[0])||void 0===l?void 0:l.getType(),from:"collection_view_keyboard_shortcut"},(t=>{u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:n,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i}),t()}));const s=w?oe().B2({blocks:b,environment:e,transaction:n,recordMaps:f,migrateSubitemFormat:{from:y,to:B},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:v,parentRelationSchema:x},analyticsFrom:p.lastActionWasCut?"cut":"copy",loadLocalSubtreeModule:g,localDuplicateModule:m}):oe().fA({blocks:b,transaction:n,from:y,to:B,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,s=i.collectionStore();if(!s)return;const a=o.at(-1),c=ue().Px(n,r);if(0===c.length)return;if(a){const e=ue().W5(i,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof me().Bv&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{oe().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l}),o&&ne().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{oe().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:C,blocksToInsert:s,subitemFormat:B,collectionContextStore:t,transaction:n}),re().LE({environment:e,blocksToInsert:s,target:C,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),k=s}}),!(I&&j&&_&&B))return;const M=ue().BK({blocks:k,parentRelationProperty:I,parentRelationSchema:_,collectionViewBlockStore:S});s().default.afterNextFlush((()=>{s().default.afterNextFlush((()=>{A().td({environment:e,stores:M})}))}))}),[t,l,e,r,i]);return(0,G.jsx)(le().A,{debugName:`CollectionViewKeyboardArea-${l}`,capture:!0,priority:c?0:-1,onCopy:d,onCut:p,onPaste:g})}));function ye(e){const t=Se().default.getState().stores;return oe().zM({environment:e,blocks:t})}function ve(e){let{subitems:t,environment:n}=e;const r=Se().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,ue().oC)(i);if(!l)return;const s=[...r,...t],a=v().oE(s.map((e=>{const t=(0,o(59110).loadLocalSubtree)(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(a),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}var xe=()=>o(892008);const be=new(ge().O2)("lazyCreateHasSchemaChangedForQueryStore",(async()=>await o.e(42050).then(o.bind(o,366518))));function Ce(e){const{collectionContextStore:t,previewContext:o,isPlaceholderExternalCollection:n}=e;return(0,u().K8)((()=>{var e,r,i;return Boolean(!n&&!(null!=o&&o.hideViewBlockSource)&&t.shouldShowSourceStore.state&&!t.isUnlistedViewStore.state&&(null===(e=t.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(r=t.collectionViewStore())||void 0===r?void 0:r.getType())&&"chat"!==(null===(i=t.collectionViewStore())||void 0===i?void 0:i.getType()))}),[t,o,n])}var we=()=>o(835066),ke=()=>o(780054),Re=()=>o(106412),Ae=()=>o(157856),Ie=()=>o(789550),Te=()=>o(862292);async function je(e){const t=await Te().T.formulas.load();t.setFormulaParsingInstrumentation((()=>{class n extends t.FormulaParsingInstrumentation{constructor(){super(...arguments),this.pendingMetricsMap={},this.throttledFlushMetrics=v().nF((()=>{this.flushMetrics()}),15*o(615234).TD,{trailing:!0})}flushMetrics(){0!==Object.keys(this.pendingMetricsMap).length&&((0,B().u)({environment:e,event:{eventName:"collections_formula_parsing_cache_stats",eventProperties:(0,o(720665).MU)((0,x().WP)(this.pendingMetricsMap).map((e=>{let[t,o]=e;return[n.metricNameToEventProperty[t],o??0]})))}}),this.pendingMetricsMap={})}incrMetricImpl(e){this.pendingMetricsMap[e]=(this.pendingMetricsMap[e]??0)+1,this.throttledFlushMetrics()}}return n.metricNameToEventProperty={"formulas.parsing.weak_map_cache.hit":"weak_map_cache_hit","formulas.parsing.weak_map_cache.miss":"weak_map_cache_miss"},new n}))}var _e=()=>o(186445),Be=()=>o(38337),Pe=()=>o(921855),Me=()=>o(476492),Fe=()=>o(525432),Ve=()=>o(69447),Le=()=>o(638146),Oe=()=>o(728611),Ee=()=>o(807054),De=()=>o(592678),ze=()=>o(347320),Ke=()=>o(891078),He=()=>o(406792),We=()=>o(117296),Ge=()=>o(665579),Ne=()=>o(644914),$e=()=>o(962730),Ue=()=>o(463830),Xe=()=>o(414834),qe=()=>o(227440),Ye=()=>o(230062),Qe=()=>o(961581),Ze=()=>o(666803),Je=()=>o(977390),et=()=>o(606932),tt=()=>o(865241),ot=()=>o(472090),nt=()=>o(611371),rt=()=>o(845094),it=()=>o(671593),lt=()=>o(666144);async function st(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,x().WP)(t).map((async t=>{let[o,n]=t;return lt().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:$().ev,id:o},userId:e.currentUser.id,minimumVersion:n})})))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}var at=()=>o(638681);const ct=at().union([at().isUndefined(),at().object({required:{blockIdToVersion:at().record(at().string(),at().number())},optional:{hasMore:at().boolean()}})]);class dt{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.handleCollectionSchemaChange=e=>{if(!this.collectionContextStore.isClientModeEnabledStore.state&&e.state){var t,o;const e=`${null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.id}:${null===(o=this.collectionContextStore.collectionStore())||void 0===o||null===(o=o.getModel())||void 0===o?void 0:o.getVersion()}`;this.throttledRefetch({src:"change_schema",trigger:e})}},this.isServerQueryCollectionRequiredForCollectionEmit=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,it().Xj)(ct,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,x().WP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,it().Xj)(ct,e)&&!e.hasMore)},this.throttledRefetch=(0,o(279900).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,x().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await st({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,M().M)(this.environment,this.collectionContextStore,e),(0,o(763824).wR)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,it().Xj)(ct,o)&&null!=o&&o.blockIdToVersion&&(0,x().WP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequiredForCollectionEmit(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}subscribeToSchemaChanges(e){e.addListener(this.handleCollectionSchemaChange)}unsubscribeFromSchemaChanges(){var e;null===(e=this.collectionContextStore.hasSchemaChangedForQueryStore)||void 0===e||e.removeListener(this.handleCollectionSchemaChange)}}var ut=()=>o(155004),pt=()=>o(297872),gt=()=>o(199896),mt=()=>o(425981),St=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(354520),()=>o(66689)),ht=()=>o(59674),ft=()=>o(713998),yt=()=>o(236262),vt=()=>o(959013),xt=()=>o(416726),bt=()=>o(548218),Ct=()=>o(44729),wt=()=>o(334684),kt=()=>o(109488),Rt=()=>o(454305),At=()=>o(852353);o(944114);function It(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,v().E$)(e,Se().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[s,a]of i.entries())a.state.includes(s)||l.push(s);l.length&&A().DN({stores:(0,v().R9)(Se().default.state.stores,l)})}var Tt=()=>o(972435),jt=()=>o(765957);class _t extends g().Store{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===y().q4_(o)}))}}var Bt=()=>o(145214),Pt=()=>o(704152),Mt=()=>o(285790),Ft=()=>o(859428),Vt=()=>o(398217);const Lt=32;function Ot(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Et=(0,vt().YK)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Dt(e){const{marginLeft:t}=e,r=(0,a().v3)(),i=(0,n.useRef)(null),l=(0,n.useRef)(void 0),s=(0,se().ET)(),c=(0,u().K8)((()=>s.collectionViewBlockStore()),[s]),d=(0,u().uB)(void 0,_t),[g,m]=(0,n.useState)(!1),{selectedItems:S,selectedItemCount:h}=(0,u().K8)((()=>{const e=Se().default.state.stores;return{selectedItems:e,selectedItemCount:e.length}}),[]),f=(0,u().K8)((()=>d.getNumberOfTextStoresBeingEdited()),[d]),y=(0,u().K8)((()=>{var e;return!!(0,V().f5)({collectionContextStore:s})&&(!S.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(f>0||S.length>=1&&(0,V().Rd)(S,null===(e=s.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[s,f,S]);(0,u().K8)((()=>{const e=_e().jQ().state;e.isOpen?l.current=e.property:l.current&&It({collectionContextStore:s,property:l.current,blockStores:S})}),[s,S],{debugName:"cleanUpSelection"});const v=(0,u().K8)((()=>c&&"suggest"!==o(77246).Uv.getMode(c)),[c]),x=(0,n.useCallback)((e=>{e||m(!1)}),[]),b=(0,p().IS)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:Lt},outer:{position:"sticky",top:1,left:t??0,zIndex:999,visibility:g?"visible":"hidden",width:"fit-content"},outerLayoutAdjust:{marginBottom:-Lt},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.text.primary},trashButton:{borderRadius:0,height:"100%",border:0,...Ot(e),width:28},trashButtonIcon:{width:20},trashButtonIconHovered:{fill:e.icon.redPrimary}})),[g,t]);return(0,G.jsx)(kt().A,{capture:y,render:e=>(0,G.jsxs)(Bt().A,{visible:y,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:x,ref:i,...e,style:b.outer,children:[(0,G.jsx)(ut().s,{allowSelectionWithin:!1,style:{width:"fit-content"},children:(0,G.jsxs)("div",{style:b.inner,children:[(0,G.jsx)(zt,{selectedItemCount:h,numTextStoresBeingEdited:f}),(0,G.jsx)(Ut,{collectionsBulkActionsToolbarStore:d,selectedItems:S,marginLeft:t,setIsReadyToRender:m,outerContainerRef:i}),v&&(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)("div",{children:Tt().A.formatMessage(Et.delete)}),render:e=>(0,G.jsx)(Mt().A,{...e,ariaLabel:Tt().A.formatMessage(Et.delete),icon:()=>(0,yt().trashIcon)(b.trashButtonIcon),style:b.trashButton,hoveredStyle:b.trashButtonIconHovered,hasBackground:!0,color:"primary",showShadow:!0,onClick:async()=>{var e;(0,U().N)(r,{analyticsName:xt().AY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=s.collectionStore())||void 0===e?void 0:e.id}),await re().Af({environment:r,blocks:S,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,t)=>{var o,n;(null===(o=e.getAssociatedCollectionStore())||void 0===o?void 0:o.id)===(null===(n=s.collectionStore())||void 0===n?void 0:n.id)&&Ct().by({childStore:e,transaction:t})}})}}),placement:$e().W.Top}),(0,G.jsx)(o(496889).A,{store:S[0],fadeIn:!1,style:b.blockActionMenuButton,hoveredStyle:b.blockActionMenuButton,iconStyle:b.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,G.jsx)("div",{style:b.outerLayoutAdjust})]})})}function zt(e){const{selectedItemCount:t,numTextStoresBeingEdited:o}=e,r=(0,a().v3)(),i=(0,n.useMemo)((()=>o>0?o:Math.max(1,t)),[o,t]),l=(0,n.useCallback)((()=>A().IU({environment:r})),[r]),s=(0,p().IS)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Ot(e)}})),[]);return(0,G.jsx)(Pt().A,{style:s.button,onClick:l,children:(0,G.jsx)(vt().sA,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const Kt=6,Ht=450,Wt=2,Gt=32,Nt=150,$t=new Set(["title","rollup","formula","button"]);function Ut(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,s=(0,se().ET)(),a=(0,n.useRef)(null),c=(0,n.useRef)([]),d=(0,u().O$)(s.normalizedSchemaStore),g=(0,u().K8)((()=>s.databaseType===St().TC&&r.some((e=>e.getPropertyValue(ht().y.MeetingNoteToCalendarEventRelation)))),[s,r]),m=!(0,u().O$)(qe().e),S=(0,u().K8)((()=>{var e;const t=s.normalizedFormatStore.state;return((null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=s.collectionStore(),{property:o,visible:n}=e,i=d[o];return!(m&&(0,x().O9)(i)&&(0,wt().$)({propertyType:i.type,propertySchema:i,allowAIProperty:!0}))&&((0,ft()._f)(null==t?void 0:t.getModel(),o)?!g:n&&i&&!$t.has(i.type)&&(0,At().g2)({propertySchema:i,property:o,blockStores:r,collectionSchema:d,collectionStore:t,spaceStore:jt().default.state.currentSpaceStore}))})))??[]).slice(0,Kt)}),[s,d,r,g,m]),[h,f]=(0,n.useState)(Kt),[y,b]=(0,n.useState)(!1);(0,n.useEffect)((()=>{c.current.length>0&&c.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[c]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:s,setHiddenButtonsIndex:a}=e;(0,n.useEffect)((()=>{const e=v().sg((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,g=d-Nt;let m=r.current.findIndex((e=>e.rightEdge>g));m=-1!==m?m:Kt;let S=r.current.findIndex(((e,t)=>p+t*Gt>g));S=-1!==S?S:Kt;const h=m<Wt||u<=Ht;s(h),a(h?S:m),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,a,l,s])}({propertyButtonsContainerRef:a,propertyButtonRefs:c,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:f,setShowIconsOnly:b});const C=(0,p().IS)((()=>({container:{display:"flex"}})),[]);return(0,G.jsx)("div",{ref:a,style:C.container,children:S.map(((e,t)=>{var r;let i=null===(r=c.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();c.current[t]={element:e,rightEdge:0},i=e}const l=t>=h;return(0,G.jsx)("div",{ref:i,children:(0,G.jsx)(Xt,{collectionsBulkActionsToolbarStore:o,schema:d,property:e.property,isHidden:l,showIconsOnly:y},e.property)},e.property)}))})}function Xt(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,s=(0,H().X)("db_ux_mobile"),c=(0,a().v3)(),d=(0,se().ET)(),g=(0,n.useRef)(null),m=(0,u().uB)(void 0,Rt().A),S=o[t],h=(0,u().K8)((()=>!(d.permissionScopesStore.state.canEditContent||"collectionTypedView"===d.contextType)),[d]),f=(0,p().IS)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:Lt,alignItems:"center",...Ot(e)},property:{maxWidth:"250px",textOverflow:"ellipsis"},icon:{fill:e.text.primary}})),[i]),y=(0,n.useCallback)((async e=>{var o,n;if(!g.current)return;const i=Se().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=g.current)||void 0===o?void 0:o.getBoundingClientRect();if(i.length<1)return;const a=i[0].getAssociatedCollectionStore();d&&l&&a&&await bt().V({environment:c,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:"table",collectionStore:a,blockPropertyValueOverlayStore:_e().jQ(),collectionContextStore:d,statusSetCheckbox:"checkbox"===(null===(n=d.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:m,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r,isDBUXMobileEnabled:s})}),[g,d,c,t,m,r,s]),v=(0,n.useCallback)((()=>null==S?void 0:S.name),[S]),x=(0,n.useCallback)((e=>S?(0,G.jsx)(Pt().A,{...e,ariaLabel:S.name,ref:g,style:f.button,disabled:h,onClick:y,children:(0,G.jsx)(Vt().mA,{style:f.property,propertySchema:S,hideName:l,showIcon:!0,property:t,iconStyle:f.icon})}):null),[y,h,t,S,l,f.button,f.icon,f.property]);return S?(0,G.jsx)(Ft().A,{renderTooltip:v,render:x,disableTooltip:!l,placement:$e().W.Top}):null}const qt=n.memo((function(e){const{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e,i=(0,se().ET)(),l=(0,u().K8)((()=>(0,V().f5)({collectionContextStore:i,overrideViewType:r})),[i,r]),s=(0,u().K8)((()=>{var e;if(!l)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)-2}),[l,n,o,t]);return l?(0,G.jsx)(Dt,{marginLeft:s}):null}));var Yt=()=>o(661179),Qt=()=>o(689094);const Zt=new(ge().O2)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(1440),o.e(47536)]).then(o.bind(o,201440)))),Jt=(0,ge()._h)(Zt,(e=>e.CollectionTasksEmptyStateModal));var eo=()=>o(162674),to=()=>o(610101),oo=()=>o(920773),no=()=>o(132389);const ro="noWritableDbs";function io(e){const{collectionContextStore:t,onAddTaskClick:r,from:i}=e,l=(0,a().v3)(),s=(0,n.useRef)(null),c=(0,u().O$)(t.isInHomeWidgetStore),d=(0,u().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),g=(0,u().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),m=(0,u().K8)((()=>(0,V().h6)(t)),[t]),S=(0,u().K8)((()=>!t.isFullScreenStore.state),[t]),h=(0,n.useCallback)((e=>{C().Ub({environment:l,handleAddItemClick:r,buttonRef:s,event:e})}),[l,r,s]),f=(0,p().IS)((e=>({container:{width:"100%",height:S?"calc(100% - 4px)":void 0,paddingTop:S?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.text.tertiary},icon:(0,Ge().Xx)(e)})),[S]),y=(0,n.useMemo)((()=>d?(0,G.jsx)(Ft().A,{disableTooltip:g,placement:$e().W.Bottom,renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,G.jsx)("br",{})}}),render:e=>(0,G.jsx)(oo().p,{...e,isBlue:!0,ref:s,disabled:!g,disabledFeedback:!g,onClick:e=>{(0,eo().bS)({environment:l,from:i}),h(e)},iconLeading:e=>(0,Qt().W)(e),children:m})}):(0,G.jsx)(oo().p,{isBlue:!0,onClick:()=>{(0,eo().bS)({environment:l,from:i}),to().A.setState(!0)},children:(0,G.jsx)(vt().sA,{defaultMessage:"Don’t see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[d,g,m,l,i,h]);return c&&!d?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(Jt,{from:i}),(0,G.jsx)(We().Ww,{feature:"tasks",onSetup:()=>{(0,eo().bS)({environment:l,from:i}),to().A.setState(!0)}})]}):(0,G.jsxs)("div",{style:f.container,children:[(0,G.jsx)(Jt,{from:i}),(0,o(370873).p)(f.icon),(0,G.jsx)(no().A,{size:16}),g?(0,G.jsx)(vt().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,G.jsx)(vt().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,G.jsx)(no().A,{size:16}),y]})}var lo=()=>o(11048),so=()=>o(710149);function ao(e){let t,{store:o,collectionViewStore:n,collectionContextStore:r}=e,i=n.getFormat().page_pointer;const l=r.viewsModuleContextStore;if(!i&&"viewsMain"===(null==l?void 0:l.getViewModuleType())){const e=l.currentPageStore();e&&(i=e.pointer,t=e)}if(i)return t??=o.id===i.id?o:me().Bv.createChildStore(o,{table:i.table,id:i.id,spaceId:i.spaceId}),t.isPageBlock()||t.isCollectionView()?t:void 0}var co=()=>o(222299),uo=()=>o(551619);const po=new(ge().O2)("views-main-builder-modules",(()=>Promise.all([o.e(44711),o.e(53321),o.e(92845),o.e(84468),o.e(95794),o.e(46414),o.e(28271),o.e(17254),o.e(58102),o.e(40186),o.e(61660),o.e(70605)]).then(o.bind(o,984318)))),go=(0,ge()._h)(po,(e=>e.ViewsMainBuilderModules));var mo=()=>o(778781),So=()=>o(548821),ho=()=>o(729923),fo=()=>o(9768);const yo=n.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:s,pageLayoutRef:c,collectionContextStore:d,editorContentContainerRef:p}=e,g=(0,a().v3)(),m=(0,u().K8)((()=>r.getSchema()),[r]),S=(0,u().K8)((()=>(0,o(577814).A)({environment:g,store:n,pageViewBlockStore:void 0})),[g,n]),h=(0,G.jsx)(G.Fragment,{children:t.map((e=>(0,G.jsx)(vo,{module:e,store:n,context:i,disabled:l,collectionSchema:m,collectionStore:r,modules:t,templatePickerMenuListStore:s,pageLayoutRef:c,pageDiscussionsRenderState:S,editorContentContainerRef:p},e.id)))});return d?(0,G.jsx)(se().RI,{value:d,children:h}):h}));function vo(e){let{module:t,store:r,context:i,disabled:l,collectionSchema:s,collectionStore:c,modules:d,templatePickerMenuListStore:p,pageLayoutRef:g,pageDiscussionsRenderState:m,editorContentContainerRef:S}=e;const h=(0,a().v3)(),f=(0,fo().Br)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:s,collectionStore:c,pageMainModules:d,showDetailsPanelToggleButtonBelowTitle:!1}),y=(0,fo().Jh)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:s,collectionStore:c,showDetailsPanelToggleButtonBelowTitle:!1,modules:d}),v=(0,u().K8)((()=>!(0,o(864994).g)({environment:h,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:i})),[h,t.type,i]);return(0,o(120997).p)(t,"views_main_tab_modules")?(0,mo().gx)(t)?(0,G.jsx)(o(483832).v,{context:i,disabled:l,propertyId:t.propertyId,store:r,pageModule:t,wrapper:y,stackPropertyLabelAndValue:v},`${t.id}-${r.id}`):(0,mo().i_)(t)?(0,G.jsx)(n.Fragment,{children:(0,G.jsx)(o(793282).h,{context:i,disabled:l,store:r,wrapper:y,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:v,disableContainerPadding:!0,disableLastRowBottomPadding:v},showDefaultTitle:!0})},`${t.id}-${r.id}`):"editor"===t.type?(0,G.jsx)(ho().p,{context:i,disabled:l,handlePlaceholderWrapClick:e=>co().YB(e,r,h),pageBlockStore:r,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:p,pageViewBlockAccessor:()=>(null==g?void 0:g.current)??null,editorWrapper:i===So().Rr.DraftPostInInlineComposer?void 0:y,ref:S}):"relationsGroup"===t.type?(0,G.jsx)(o(996262).z,{pageStore:r,wrapper:y,disabled:l,context:i,showDefaultTitle:f}):"deleted_property"===t.type?null:"discussions"===t.type?(0,G.jsx)(o(257502).d,{store:r,wrapper:y,showDefaultTitle:f,discussionLocation:"page_discussion",pageDiscussionsRenderState:m}):void(0,x().HB)(t):null}var xo=()=>o(817942),bo=()=>o(255824);const Co=n.memo((function(e){const{store:t,canEdit:r,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:s,isFullScreen:c,editorContentContainerRef:d}=e,p=(0,a().v3)(),g=(0,a().Y0)(),m=(0,n.useRef)(null),S=(0,u().K8)((()=>t.isNonEditableState()),[t]),h=(0,bo().a)(),f=(0,se().ET)(),y=(0,o(933951).sS)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:v,viewsMainTabId:x}=(0,u().K8)((()=>{const e=null==y?void 0:y.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==s?void 0:s.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[s,y]),b=(0,uo().n$)(),C=(0,u().K8)((()=>(0,z().cq)(t)?So().Rr.PeekView:f.isFullScreenStore.state?So().Rr.CollectionPageViewFullScreen:So().Rr.CollectionPageView),[f,t]),w=(0,Ke().VE)(t),k=(0,u().K8)((()=>{const e=o(129522).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),R=(0,u().K8)((()=>(0,o(299772).NS)(w,t,C,g)),[w,t,C,g]),A=!r||S||h,I=h&&x?(0,G.jsx)("div",{style:{paddingTop:24,paddingRight:4},children:(0,G.jsx)(go,{viewsMainTabId:x,pageLayoutType:R})}):v&&l?(0,G.jsx)(xo().Mx,{ref:m,type:R,suppressMargin:!0,style:{paddingTop:12,paddingBottom:c?b:void 0},children:(0,G.jsx)(yo,{context:C,modules:v,store:t,disabled:A,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:m,collectionContextStore:k,editorContentContainerRef:d})}):(0,G.jsx)(xo().Mx,{ref:m,type:R,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?b:void 0},children:(0,G.jsx)(ho().p,{context:C,disabled:A,handlePlaceholderWrapClick:e=>co().YB(e,t,p),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>m.current,ref:d})});return(0,G.jsx)(lo().A,{name:"PageView",children:I})})),wo=n.memo(n.forwardRef((function(e,t){let{store:r,collectionViewStore:i,style:l,isFullScreen:s,editorContentContainerRef:a,templatePickerMenuListStore:c,isViewsModule:d}=e;const p=(0,se().ET)(),g=(0,u().K8)((()=>p.collectionStore()),[p]),m=(0,u().K8)((()=>"collectionSystemView"===p.contextType),[p]),S=(0,u().K8)((()=>ao({store:r,collectionViewStore:i,collectionContextStore:p})),[r,i,p]),h=!(0,Ke().bx)(S,m);return(0,n.useEffect)((()=>{"rendered"!==jt().default.state.renderPhase&&jt().default.setState({...jt().default.state,renderPhase:"rendered"})}),[]),d?S?(0,G.jsx)("div",{style:l,children:(0,G.jsx)(Co,{canEdit:!h,disabled:h,store:S,collectionViewStore:i,templatePickerMenuListStore:c,collectionStore:g,isFullScreen:s,editorContentContainerRef:a})}):null:(0,G.jsx)(o(261237).c,{disabled:!1,displayName:"CollectionPagePageContent",ref:t,style:l,children:(0,G.jsx)(lo().A,{name:"CollectionPageView",children:S?(0,G.jsx)(Co,{canEdit:!h,disabled:h,store:S,collectionViewStore:i,templatePickerMenuListStore:c,collectionStore:g,isFullScreen:s,editorContentContainerRef:a}):null})})})));var ko=()=>o(735695),Ro=()=>o(236030),Ao=()=>o(690471),Io=()=>o(836251),To=()=>o(756279),jo=()=>o(2143);function _o(e){const{style:t,children:o}=e,n=(0,p().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,G.jsx)(jo().H,{type:To().A.Y,style:n.scroller,children:o})}function Bo(e){let{store:t,children:r,isFullScreen:i,currentViewType:l,isInPeek:s,isInHomeWidget:c,handleEditorClick:d,isRootOrDirectChild:p,leftRightPaddingStore:g,paddingBottom:m,viewSettingsPlacementStore:S,paddingLeft:h,format:f,isMyTasksEmpty:y,isHomeCustomDbEmpty:v,isInFrameWhenSidePeekOpen:b,handleHorizontalScrollerMount:C,handleEditorMouseDown:w,isUnlistedView:k,isPreviewing:R}=e;const A=(0,se().ET)(),I=(0,Re().Zp)(),T=(0,a().v3)(),{isPhone:j}=(0,a().Y0)(),_=(0,H().X)("disable_rectangular_selection_for_database_horizontal_scroll"),B=(0,u().K8)((()=>(0,Io().w6)(T)),[T]),M=(0,u().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:s}=e;return r&&r.enableHorizontalScroll?To().A.X:r&&!r.enableHorizontalScroll||"page"===s||"feed"===s?To().A.None:i?To().A.All:n||l?To().A.X:o&&(0,K().z4)(t)?To().A.None:To().A.X}({environment:T,isFullScreen:i,isPreviewing:!!R&&{enableHorizontalScroll:(null==I?void 0:I.enableHorizontalScroll)??!1},isInPeek:s,isUnlistedView:Boolean(k),isSettingsView:"collectionSettings"===A.contextType,collectionViewType:l})),[k,T,i,R,s,A,l,I]),F=(0,u().K8)((()=>!("collectionSystemView"===A.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"chat":return!0;case"calendar":case"map":case"feed":case"custom":return!1;default:return(0,x().HB)(e)}}(l)),[A,c,l]),V=(0,u().K8)((()=>P().B2({blockStore:t,isFullScreen:i,collectionContextStore:A})),[t,i,A]),L=(0,u().K8)((()=>{const e=g.state,o=A.settingsStore.state.open,n=A.isInHomeWidgetStore.state&&A.isEditableHomeCollectionStore.state;let r={};return k&&(r=j?{height:B?Ro().gK:Ro().NH,width:void 0}:{height:Ro().PN,width:void 0}),{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===l&&A.collectionStore()&&!i&&!(0,Ao().Od)({environment:T,format:f,isFullScreen:i,isRootChild:p})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:m},...o&&!i&&"sidebar"===S.state&&{minHeight:ko().iZ},...n?{paddingRight:8,paddingLeft:"list"===l?8:16}:{},...c&&!F?{maxHeight:"inherit"}:{},...y||v||!F?{height:"100%"}:{},...!b||"timeline"===l||c||k?{}:{position:"sticky",left:0,paddingLeft:h,width:(0,Ne().Uh)(T)},..."chart"===l&&b&&!c?{paddingLeft:h}:{},..."page"===l?{zIndex:86}:{},...V&&{marginLeft:-Ro().Fh},...r,..."custom"===l&&{height:"100%"}}}),[g,A,p,t,l,i,T,f,m,S,c,F,y,v,b,h,V,k,j,B]),O=(0,bo().a)(),E=(0,u().K8)((()=>O&&"page"===l?To().A.All:s||c?To().A.None:o(620689).u5(T)),[T,s,c,O,l]),D=(0,n.useCallback)((e=>{d(e,l)}),[d,l]),z=(0,G.jsx)(jo().H,{type:M,className:Be().ohG,onMouseDown:_?void 0:w,preventType:E,onClick:D,style:L,ref:C,children:r});return F?(0,G.jsx)(_o,{style:{..."list"===l?{paddingBottom:8}:"timeline"===l?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==l?{paddingTop:12}:{}},children:z}):z}var Po=()=>o(340498);const Mo=(0,Po().wt)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,G.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,G.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,G.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,G.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,G.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})});var Fo=()=>o(284371),Vo=()=>o(584262),Lo=()=>o(921598),Oo=()=>o(183558),Eo=()=>o(873050),Do=()=>o(10594),zo=()=>o(217429),Ko=()=>o(916260);function Ho(e){const{environment:t,groupsFormatKey:o,collectionContextStore:n,currentGroups:r}=e;if(zo().default.checkGate({gateName:"collection_group_reducer_visible"}))return;const i=n.normalizedFormatStore.state;if(""!==n.searchQueryStore.state)return;if((0,Eo().I6)(n))return;const l=i[o]||[];if(!n.permissionScopesStore.state.canConfigureBlock)return;if(0===r.length)return;const s=r.slice(0,Do()._9),a=l.slice(0,Do()._9);v().n4(s,a)||T().createAndCommit({userAction:"collectionGroupActions.persistFormatGroups",environment:t,canUndo:!1,perform:e=>{(0,Ko().o)({collectionContextStore:n,newGroups:r,groupsFormatKey:o,transaction:e})}})}var Wo=()=>o(896628),Go=()=>o(246826),No=()=>o(857783),$o=()=>o(281948),Uo=()=>o(312296),Xo=()=>o(970013),qo=()=>o(863330),Yo=()=>o(206267),Qo=()=>o(821062);const Zo=5;function Jo(e){return e?6:Zo}const en=10,tn=7;function on(e){return e?8:tn}const nn=tn+32;var rn=()=>o(553965),ln=()=>o(493823),sn=()=>o(406699);const an=30,cn=4,dn=4,un=(0,vt().YK)({addGroup:{defaultMessage:"New group",id:"database.boardView.addGroupButtonTitle"}}),pn=n.memo((function(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:s,groupsLimitStore:c,collectionContextStore:d,parentStore:g,onAccept:m,paddingLeft:S,stickyLeft:h,disabled:f}=e;const y=(0,a().v3)(),v=(0,p().DP)(),C=(0,H().X)("collection_group_reducer_visible"),w=(0,H().X)("db_ux_chrome"),k=(0,vt().tz)(),R=(0,u().uB)(void 0,Ue().A),A=s[i.property],I=(0,u().K8)((()=>(0,Do().$e)({environment:y,groupFormat:void 0,schema:s,format:d.normalizedFormatStore.state,theme:v})),[d,y,s,v]),T=(0,p().IS)((e=>{const t=Jo(w);return{plusIcon:{fill:e.text.tertiary,width:16,height:16},iconButtonWrapper:{width:35,marginRight:t,height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},iconButton:{width:24,height:24,borderRadius:6,background:null==I?void 0:I.backgroundColor,...r}}}),[null==I?void 0:I.backgroundColor,w,r]),j=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:s,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,Lo().Eg)(u))return;if((0,b().X)({environment:s,collectionContextStore:i,action:"board_add_group"}),a.reset(),Xo().lx(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:Yo().JW(),value:d.value,color:(0,Xo().Zd)(e)},i=[...e,r],s={...u,options:i},a={...t,[o.property]:s},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Do().DF)(n,c,p),newSchema:a,newGroup:c})}if("person"===u.type||"relation"===u.type||(0,Lo().Vs)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Do().DF)(n,e,p),newPage:c.newPage,newGroup:e})}if((0,Lo()._o)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,x().HB)(u.type)}({schema:s,groupBy:i,currentGroups:l,groupsLimitStore:c,collectionContextStore:d,onAccept:m,environment:y,buttonPopupStore:R,update:e})}),[R,d,l,y,i,c,m,s]),_=(0,n.useCallback)((()=>{!function(e){e.reset()}(R)}),[R]),B=(0,n.useCallback)((()=>(0,G.jsx)(o(330557).p,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:s,onChange:j,onClose:_,parentStore:g})),[l,i,j,_,g,s]),P=n.useCallback((e=>(0,G.jsx)(ln().p,{isLightGray:!0,iconLeading:qo().plusSmallIcon,iconStyle:{width:16,height:16,marginRight:8},style:{display:"flex",marginTop:cn,marginBottom:dn,width:"max-content",position:h?"sticky":void 0,...r},disabled:f,...e,children:k.formatMessage(un.addGroup)})),[f,k,h,r]);return A&&(0,Lo().Eg)(A)?(0,G.jsx)(sn().Ay,{render:B,buttonPopupStore:R,popupType:y.device.isMobile?sn().z7.BottomSheet:sn().z7.Popup,renderOrigin:e=>"board"===t?C?P(e):(0,G.jsx)("div",{style:T.iconButtonWrapper,children:(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"New group",id:"CollectionAddGroupButton.newGroupTooltip"}),render:t=>(0,G.jsx)(Mt().A,{ariaLabel:k.formatMessage(un.addGroup),icon:e=>(0,qo().plusSmallIcon)({...e,...T.plusIcon}),style:T.iconButton,disabled:f,...(0,rn().A)(t,e)})})}):P(e)}):null}),Qo().A);var gn=()=>o(403733),mn=()=>o(126617),Sn=()=>o(325383),hn=()=>o(331542);const fn=n.memo((function(e){const{type:t,groupsDisplayState:o,groupsLimitStore:n,schema:r,collectionContextStore:i,style:l}=e,s=(0,a().v3)(),c=(0,p().DP)(),d=(0,H().X)("collection_group_reducer_visible"),g=(0,H().X)("db_ux_chrome"),m=(0,u().O$)(i.normalizedFormatStore),S=(0,u().K8)((()=>(0,Sn().Mw)({collectionContextStore:i,isForColumnGroups:"board"===t})),[i,t]),h=(0,u().K8)((()=>"board"===t?(0,Do().$e)({environment:s,groupFormat:void 0,schema:r,format:m,theme:c}):void 0),[s,m,r,c,t]),f="v2"===o.version?void 0:Math.min(Do().B2,o.total-o.hiddenGroups.length-o.visibleGroups.length),y=(0,p().IS)((e=>{const o=Jo(g);return{hovered:{background:e.whiteButtonBackground},icon:{width:16,height:16,fill:e.text.tertiary,..."default"===t?{marginRight:8}:{}},button:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2,paddingRight:8,color:e.text.tertiary,fontWeight:Fo().Wy.regular,..."board"===t?{...d?{background:void 0,marginRight:2*o,width:"fit-content"}:{background:null==h?void 0:h.backgroundColor,paddingLeft:8,height:"100%",marginRight:2*o,borderRadius:en,width:90},...l}:{height:28,marginTop:4,marginBottom:4}}}}),[null==h?void 0:h.backgroundColor,g,d,l,t]);return"default"===t?(0,G.jsxs)(ln().p,{onClick:()=>function(e,t,o){o.setState(o.state+Do().B2),t.loadingDetailsStore.setState({type:"load_more_groups"}),yn(e)}(s,i,n),onMouseDown:Oe().tr,disabled:S,hoveredStyle:S?y.hovered:{},style:{...y.button,...l},children:[(0,gn().g)(y.icon),d?(0,G.jsx)(vt().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more"}):(0,G.jsx)(vt().sA,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:f}}),S&&(0,G.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,G.jsx)(hn().A,{size:"sm"})})]}):(0,G.jsxs)(ln().p,{onClick:()=>function(e,t,o){o.setState(o.state+Do().B2),t.loadingDetailsStore.setState({type:"load_more_columns"}),yn(e)}(s,i,n),onMouseDown:Oe().tr,disabled:S,hoveredStyle:S?y.hovered:{},style:y.button,children:[d?(0,G.jsx)("div",{style:{marginRight:8},children:S?(0,G.jsx)("div",{style:{marginLeft:4},children:(0,G.jsx)(hn().A,{size:"sm"})}):(0,mn().Y)(y.icon)}):null,(0,G.jsx)("span",{style:{flexGrow:1},children:d?(0,G.jsx)(vt().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"Load more groups"}):(0,G.jsx)(vt().sA,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:f}})}),d?null:S?(0,G.jsx)("div",{style:{marginLeft:4},children:(0,G.jsx)(hn().A,{size:"sm"})}):(0,mn().Y)(y.icon)]})}),Qo().A);function yn(e){(0,_().v)(e,"collection_load_more_groups")}var vn=()=>o(395361),xn=()=>o(700500),bn=()=>o(519831),Cn=()=>o(797535),wn=()=>o(187899),kn=()=>o(901389);const Rn=(0,vt().YK)({optionAlreadyExists:{id:"handleCollectionAddGroupButtonAccept.optionAlreadyExists",defaultMessage:"Option already exists"}});async function An(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:s}=e,a=l[s.property];if(!a)return;const c="relation"===a.type&&(0,Xo().zO)(a),d=c&&new(me().md)(i,{table:bn().Vl,id:c});d&&await d.load(),T().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups){if(t.newGroup){const e=t.newGroup;if((0,Xo().DQ)(a)){var l;const t="select"===e.value.type||"multi_select"===e.value.type?e.value.value:"status"===e.value.type&&"by_option"===(null===(l=e.value.value)||void 0===l?void 0:l.type)?e.value.value.option:void 0;if(t){var s;if(null===(s=a.options)||void 0===s?void 0:s.find((e=>e.value.toLowerCase()===t.toLowerCase())))return void kn().f1(Tt().A.formatMessage(Rn.optionAlreadyExists))}}}(0,Ko().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),wn().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})}if(t.newSchema&&(0,Cn().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===a.type&&d){const o=(0,y().x9d)(t.newPage.name),n=Go().Wv({environment:i,id:t.newPage.id,type:xn().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});Ct().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&w().n5({title:{text:o},environment:i,store:me().Bv.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var In=()=>o(101981),Tn=()=>o(9151),jn=()=>o(396671);class _n extends g().Store{getInitialState(){return!1}}const Bn=_n;class Pn extends g().Store{getInitialState(){}}const Mn=Pn;var Fn=()=>o(787812);var Vn=()=>o(588316),Ln=()=>o(30626),On=()=>o(970330),En=()=>o(612008),Dn=(o(823215),o(430670),()=>o(9559)),zn=()=>o(416504),Kn=()=>o(708830),Hn=()=>o(909470),Wn=()=>o(337567),Gn=()=>o(861841),Nn=()=>o(722101),$n=()=>o(73223),Un=()=>o(317001),Xn=()=>o(520861),qn=()=>o(716728),Yn=()=>o(976405),Qn=()=>o(592269),Zn=()=>o(394653);function Jn(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const s=i.normalizedSchemaStore.state,a=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,u=new Map,p=new Map;for(const g of n){const e=Qn().jV({block:o.getModel(),schema:s,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,zn().P)(),userStartOfWeek:_e().XX.state},group:g,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:Tt().A.getIntl(),relativeVariableResult:a,currentPageInRelatedCollection:c,resultCache:d,regExpCache:u,formatDateCache:p,experimentService:zo().default});(0,Zn().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var er=()=>o(755673),tr=()=>o(656432);function or(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r}=e,i=[];return t.forEach((e=>{var t,l;const s=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],a=null==o||null===(l=o.collectionStore())||void 0===l?void 0:l.getSchema(),c=new Map,d=new Map,u=new Map,p=n.flatMap((t=>{const o=t.getModel();if(s&&a&&o)return(0,Dn().W)({property:e.property,schema:a,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,zn().P)(),depth:0,intl:Tt().A.getIntl(),visitedProperties:new Set,resultCache:c,regExpCache:d,formatDateCache:u,experimentService:zo().default,collectionFeatureGates:(0,Hn().i)()},exportedFilePaths:!1,formulasModule:r})})).filter((e=>!v().b0(e)));i.push(...p)})),v().Mp(i,v().n4)}function nr(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:s,droppedDirection:a,droppedStores:c,transaction:d,duplicate:u,collectionContextStore:p,groupsPointer:g,subitemPath:m,formulasModule:S,duplicateActions:h}=e;if(!p.permissionScopesStore.state.canEditContent)return;if(c.some((e=>(0,Wn().pQ)(e.id))))return;if(c.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:s,duplicateActions:a}=e,c=i.collectionStore(),d=i.collectionViewStore(),u=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),p=u&&u.id===(null==c?void 0:c.id),g=i.hasSingleCollection()&&r,m=(0,Xn().T)({environment:o,droppedStores:n,duplicate:g,transaction:s,collectionStore:c,duplicateActions:a});for(const S of m){const e=c??S.getAssociatedCollectionStore();e&&(0,Un().j)({environment:o,store:S,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:s})}d&&(0,er().z)({resultIds:m.map((e=>e.id)),collectionViewStore:d,collectionContextStore:i,transaction:s}),s.postSubmitCallbacks.push((async e=>{!e&&c&&(p||await oe().Bz({droppedStores:n,createdStores:m,collectionStore:c,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:p,groupsPointer:g,droppedStores:c,duplicate:u,transaction:d,duplicateActions:h}),!s)return;const f=p.collectionViewStore();if(!f)return;const y=null===(t=c[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),x=y&&y.id===(null==l?void 0:l.id),b=null===(o=p.groupsStore.getGroupState(g))||void 0===o?void 0:o.groupUiParentStore;if(!b)return;const C=or({groupsPointer:g,collectionContextStore:p,blocks:c,formulasModule:S}),w=(null===(n=p.groupsStore.getGroupState(g))||void 0===n?void 0:n.resultsStore.state)||[],k=c.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=c[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),R=p.hasSingleCollection()&&(k||u);if(a===Gn().bH.Onto){A().IU({environment:i});const e=s.getContentStore(),t=(0,Xn().T)({environment:i,droppedStores:c,duplicate:R,transaction:d,collectionStore:l,duplicateActions:h});for(const o of t)Nn().BC({parentStore:e,appendStore:o,transaction:d});return[]}let I=!1,T=[];if(!R&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,tr().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===bn().Vl||l.getAssociatedCollectionStore())return;if(!Ct().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:c,collectionStore:l,transaction:d});I=void 0!==e,T=e??[]}const j=(0,ue().kY)([...(null==m?void 0:m.map((e=>e.value.store.pointer)))??[]]),_=p.subitemExpandedStore.state.get(j),B=m&&m.length>1||(null==_?void 0:_.isExpanded)&&a===Gn().bH.Below,P=p.groupsStore.getAllGroupStates();c.forEach((e=>{const t=P.find((t=>t.resultsStore.state.includes(e)));t&&!B&&Jn({environment:i,store:e,collectionContextStore:p,groupsPointer:t.groupsPointer,transaction:d})}));const M=(0,Xn().T)({environment:i,droppedStores:c,duplicate:R,transaction:d,collectionStore:l,duplicateActions:h});I||(T=(0,tr().K)({environment:i,stores:M,spaceId:s.getSpaceId(),transaction:d})),d.postSubmitCallbacks.push((async e=>{!e&&l&&(x||await oe().Bz({droppedStores:c,createdStores:M,collectionStore:l,environment:i,collectionContextStore:p,groupsPointer:g,alreadyMovedToCollection:I,shouldDuplicate:R}))}));for(const v of T){const e=l??v.getAssociatedCollectionStore();e&&(0,Un().j)({environment:i,store:v,collectionStore:e,collectionContextStore:p,groupsPointer:Boolean(B)?[]:g,shouldCoerce:!0,transaction:d,alreadyMovedToCollection:I})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:s,collectionStore:a,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:g,transaction:m}=e,S=s.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,f=h&&s.normalizedSchemaStore.state[h],y=null==S?void 0:S.property,v=y&&s.normalizedSchemaStore.state[y],x=null===(t=s.collectionViewStore())||void 0===t?void 0:t.getType(),b=null===(o=s.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=s.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection()&&(0,pe().pB)())return;const C=(null==b?void 0:b.subitem_display_mode)??"show",w=S&&x&&(0,ue().qS)(x)&&f&&(0,Xo().nC)(f)&&"flattened"!==C&&"disabled"!==C,k=(0,ue().oC)(c[0]);null!=k&&k.subitemFormat&&S&&v&&(0,Xo().nC)(v)&&oe().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:m,subitemRelationSchema:v,relationPropertyCollectionId:a.id});const R=S?(0,ue().Ku)(d,S):void 0,A=R?d.filter(((e,t)=>R.includes(t))):[];for(const I of A){if(w){const e=(0,ue().eO)({store:I,subitemFormat:S,propertySchema:f});for(const t of e){const e=me().Bv.createChildStore(I,t);ne().c3({environment:r,sourceStore:e,destStore:I,propertyWithInverse:S,transaction:m})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,qn().i)({environment:r,collectionContextStore:s,collectionStore:a,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(Kn().PH)((0,ue().f5)(g),[])],store:g,before:"into"===e,insertBlockStore:I,insertDirection:e,transaction:m})}}}({environment:i,isInsertingAsSubitem:Boolean(B),shouldDuplicate:R,collectionContextStore:p,collectionStore:l,droppedStores:c,wrappedStores:T,targetSubitemExpandedState:_,subitemPath:m,targetStore:s,transaction:d});const F=w.filter((e=>!M.includes(e))),V=F.indexOf(s),L=a===Gn().bH.Above||a===Gn().bH.Left?V:V+1,O=[...F.slice(0,L),...T,...F.slice(L)];(0,er().z)({resultIds:O.map((e=>e.id)),collectionViewStore:f,collectionContextStore:p,transaction:d});const E=or({groupsPointer:g,collectionContextStore:p,blocks:M,formulasModule:S}),D=v().n4(C.sort(),E.sort());zo().default.checkGate({gateName:"intelligent_collections_sort_modal"})?x&&D&&(0,Yn().f)({environment:i,collectionContextStore:p}):(0,Yn().f)({environment:i,collectionContextStore:p});if(!p.collectionViewBlockStore())return;const z=B?s:b,K=T.map((e=>me().Bv.createChildStore(z,{table:$().ev,id:e.id})));return A().td({environment:i,stores:K}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===St().Lu&&"sprint_board"===(null===(n=jt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&$n().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(p,d),K}var rr=()=>o(751086);function ir(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:s}=e,a=o.collectionStore();!(0,Lo().OF)(n.value,r.value)&&a&&(0,rr().a)({environment:t,collectionStore:a,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:s});const c=l.map((e=>(0,Lo().OF)(n.value,e.value)?r:e));(0,Ko().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:s})}function lr(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:s,environment:a}=e,c=n[o.property];if(!c)return;if(!(0,Lo().Eg)(c))return;const d=o.value;if((0,Xo().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],u=t.value,p=e.map((e=>e.value===d.value?{...e,value:u}:e)),g={...c,options:p},m={...n,[o.property]:g},S={...o,value:{...d,value:u}};T().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:e=>{ir({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:S,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,Cn().I)({environment:a,collectionStore:s,update:{schema:m},transaction:e})}})}else if("person"!==c.type)if((0,Lo().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};T().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{ir({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else"status"===c.type||(0,Lo()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,x().HB)(c.type);else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};T().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{ir({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var sr=()=>o(357643),ar=()=>o(89849),cr=()=>o(566910),dr=()=>o(871151),ur=()=>o(381349),pr=()=>o(161479);const gr=(0,o(583835).Dv)("deleteGroup");var mr=()=>o(357625);var Sr=()=>o(939466),hr=()=>o(654062),fr=()=>o(314660),yr=()=>o(722872),vr=()=>o(575143),xr=()=>o(928600),br=()=>o(939740),Cr=()=>o(480095),wr=()=>o(89924),kr=()=>o(893952);const Rr="color";const Ar=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:s,currentGroups:c,groupsLimitStore:d,schema:p}=e;const g=(0,a().v3)(),m=(0,vt().tz)(),{device:S}=g,h=(0,H().X)("collection_group_reducer_visible"),f=(0,u().O$)(qe().e),y=(0,u().K8)((()=>v().oE([jr({environment:g,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:s,currentGroups:c,groupsLimitStore:d,isGroupsReducerV2:h,intl:m,isOnline:f}),Tr(g,p,o,r)])),[g,o,r,i,l,s,c,d,h,m,p,f]),x=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(Rr)||t.close()}),[t]);let b;return b=S.isMobile?{menuType:yr().gu.Modal,title:(0,G.jsx)(vt().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:t.close}:{menuType:yr().gu.Popup},(0,G.jsx)(xr().A,{...b,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:0,sections:y,onAccept:x})})};async function Ir(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const s=n.value;if("relation"===s.type&&(0,Lo().WO)(s.value)){const e=me().Bv.createChildStore(l,{id:s.value.id,table:$().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}T().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:s=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:s,transaction:a,intl:c}=e,d=o.getSchema(),u=d[i.property],p=l.filter((e=>!(0,Lo().OF)(i.value,e.value)));(0,Ko().o)({collectionContextStore:s,newGroups:p,groupsFormatKey:n,transaction:a});const g=i.value;if(u&&(0,Xo().lx)(u)&&g.type===u.type&&o){const e=(u.options||[]).filter((e=>e.value!==g.value)),n={...u,options:e},r={...d,[i.property]:n};(0,Cn().I)({environment:t,collectionStore:o,update:{schema:r},transaction:a})}const m=t.currentUser.id,S=new Map,h=new Map,f=new Map;o.inMemoryRecordCache.forEachRecord(m,(async e=>{let{model:n}=e;if(n.table!==$().ev)return;const i=me().Bv.createChildStore(o,n.pointer);if(Qn().xw({block:n,groupBy:s.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:g,intl:c,timeZone:(0,zn().P)(),getRecordModel:o.getRecordModel,resultCache:S,regExpCache:h,formatDateCache:f,experimentService:zo().default,collectionFeatureGates:(0,Hn().i)()}))if(n.parent_id===o.id)Ct().by({childStore:i,transaction:a});else{const e=i.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===i.getType()||"collection_view_page"===i.getType()&&!i.isCollectionViewPageWithContent())&&await re().Af({environment:t,blocks:[i],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&a.postSubmitCallbacks.push((async e=>{const n=await mr().UT(t,gr,{collection:{id:o.id,spaceId:(0,pr().e)(o.pointer.spaceId)},property:r,value:g},{spaceIds:[]}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:s,intl:i})}}),(0,b().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function Tr(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const s=ur().tS.map((r=>{const i={key:`${Rr}_${r}`,render:e=>(0,G.jsx)(kr().A,{...e,color:r,isChecked:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!Xo().lx(i))return;const l=r.collectionStore();if(!l)return;const s=o.value;if(s.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),c={...i,options:a},d={...n,[o.property]:c};T().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,Cn().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,b().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,G.jsx)(wr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s}}function jr(e){const{environment:t,groupFormat:o,collectionContextStore:n,groupsFormatKey:r,format:i,query:l,currentGroups:s,groupsLimitStore:a,isGroupsReducerV2:c,intl:d,isOnline:u}=e,p=[],g=zo().default.checkGate({gateName:"db_ux_properties"}),m=o.value,S=n.permissionScopesStore.state,h="board_columns"===r?void 0===l.aggregations:void 0===i.collection_group_aggregation;u&&g&&p.push({key:"editGroups",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Edit groups",id:"database.collectionGroupActionMenu.editGroupsTitle"}),svg:dr().p}),action:()=>{C().a2({collectionSettingsStore:n.settingsStore,item:{type:"group",groupByKey:"collection_groups"===r?"collection_group_by":"board_columns_by",groupsFormatKey:r}})}}),u&&(h?p.push({key:"addAggregation",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:ar().eyeIcon}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[Lo().VR]};T().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,hr().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else T().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Wo().zA({stores:[r],update:{collection_group_aggregation:Lo().VR},transaction:e})}})}(t,r,l,n)}):p.push({key:"removeAggregation",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:cr().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};T().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,fr().f)({collectionViewStore:r,update:t,transaction:e})}})}else T().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Wo().zA({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(t,r,l,n)})),(0,Lo().tx)(o)?p.push({key:"show",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:ar().eyeIcon}),action:()=>{c?(0,Sr().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r,i){const l={...t,hidden:!1},s=(0,Do().DF)(r,l,i.state);T().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{(0,Ko().o)({collectionContextStore:o,newGroups:s,groupsFormatKey:n,transaction:e})}}),(0,b().X)({environment:e,collectionContextStore:o,action:"show_group"})}(t,o,n,r,s,a)}}):p.push({key:"hide",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:cr().e}),action:()=>{c?(0,Sr().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,Do().LS)(r,i);T().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{(0,Ko().o)({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),(0,b().X)({environment:e,collectionContextStore:o,action:"hide_group"})}(t,o,n,r,s)}}),void 0===m.value||!S.canEditContent||S.isSyncedCollection||"collectionTypedView"===n.contextType||S.isExternallyImportedAndSyncedCollection||p.push({key:"delete",render:e=>(0,G.jsx)(vr().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:yt().trashIcon}),action:()=>function(e,t,o,n,r,i){kn().ui({message:(0,G.jsx)(vt().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Ir(e,t,o,n,r,i)}]})}(t,n,s,o,r,d)});const f={key:"collection group",render:e=>(0,G.jsx)(wr().A,{...e}),items:p};return f}var _r=()=>o(67657),Br=()=>o(478184),Pr=()=>o(722372);function Mr(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,v().n4)(t,n):o}function Fr(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,u().K8)((()=>({isCalculating:Mr(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),s=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,G.jsx)(hn().A,{}):(0,G.jsx)("span",{style:{opacity:.5},children:s??r}):(0,G.jsx)(G.Fragment,{children:r})}var Vr=()=>o(509060);const Lr=(0,vt().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var Or=()=>o(760217),Er=()=>o(662971);function Dr(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l,groupsResultStore:s}=e;const c=(0,a().Y0)(),d=(0,H().X)("collection_group_reducer_visible"),g=(0,u().K8)((()=>n[r]||{aggregator:"count"}),[n,r]),m=(0,u().K8)((()=>({type:"aggregation",filter:(0,Qn().Yy)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,zn().P)(),experimentService:zo().default}),aggregation:g})),[i,t,o,g]),S=(0,p().IS)((e=>({button:{fontWeight:Fo().Wy.medium,color:e.text.tertiary,height:24}})),[]);return(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(qr,{schema:t,collectionContextStore:i,aggregation:g}),render:e=>(0,G.jsx)(sn().Ay,{popupType:c.isMobile?sn().z7.BottomSheet:sn().z7.Popup,renderOrigin:n=>(0,G.jsx)(ln().p,{disabled:l,style:S.button,...(0,rn().A)((0,rn().A)(e,n),{onClick:Oe().kV}),children:d?(0,G.jsx)(Xr,{collectionContextStore:i,schema:t,aggregation:g,groupFormat:o,groupsResultStore:s}):(0,G.jsx)(Ur,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:g,reducer:m})}),disabled:l,render:e=>(0,G.jsx)($r,{aggregation:g,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function zr(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=Pr().cx[t];return(0,G.jsx)(Ft().A,{placement:$e().W.Right,delayThreshold:0,render:e=>(0,G.jsx)(Or().A,{title:n,isChecked:o,...(0,rn().A)(e,r)}),renderTooltip:()=>(0,G.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,G.jsx)("img",{src:(0,Br().L)(i),style:{borderRadius:6,width:140,marginTop:4}}),Pr().fp[t]]})},r.key)}function Kr(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),T().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,hr().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,b().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function Hr(e,t,o,n,r,i,l){const s=Pr().zY[o];return{key:o,render:t=>(0,G.jsx)(zr,{isSelected:e,aggregationType:o,label:s,props:t}),action:()=>{Kr({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function Wr(e,t,o,n,r){const{enforceMaxAggregationLimit:i,disabled:l}=(0,Pr().NT)(e),s={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,G.jsx)(Vr().A,{on:i,disabled:l,menuListItemProps:e}),action:()=>Kr(s,t,o,n,r)}}function Gr(e,t,o,n,r,i,l,s){const{device:a}=n,c=Pr().zY[t],d=v().oE(o.map((o=>function(e,t,o,n,r,i,l,s,a){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,G.jsx)(zr,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{Kr({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,s,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,_r().AS)(t))&&e.enforceMaxAggregationLimit,n,r,i,l,s)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,G.jsx)(Er().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,G.jsx)(Or().A,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:yr().gu.Modal,title:c,right:a.isPhone?(0,G.jsx)(Cr().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:yr().gu.Popup,width:200,...e},(0,G.jsx)(xr().A,{...n,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,G.jsx)(wr().A,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function Nr(e,t,o,n,r,i){const l={};for(const u of _r().VD)l[u]=Hr(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,_r().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const u of _r().CG)"show_unique"!==u&&(l[u]=Gr(e,u,s,t,i,o,n,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,_r().OC)(o)}))}(i);if(a.length>0)for(const u of _r().Sn)l[u]=Gr(e,u,a,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,_r().fo)(o)}))}(i);if(c.length>0)for(const u of _r().zE)l[u]=Gr(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,_r().s_)(o)}))}(i);if(d.length>0)for(const u of _r().QO)l[u]=Gr(e,u,d,t,i,o,n,r);return l}function $r(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const s=(0,a().v3)(),{device:c}=s,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,s=[];let a=0,c=0;const d=Nr(e,t,o,n,r,i);let u=0;return Object.entries(_r().Kn).forEach((i=>{let[p,g]=i;const m=[];for(const t of g)d[t]&&(m.push(d[t]),e.aggregator===t&&(a=u,c=m.length-1));const S=[];if("count_aggregations"===p&&S.push({key:"limitToggleSection",render:e=>(0,G.jsx)(wr().A,{...e}),items:[Wr(e,t,o,n,r)]}),S.push({key:"aggregations",render:e=>(0,G.jsx)(wr().A,{topBorder:!0,...e}),items:m}),m.length>0){u++;const e=Pr().jA[p],t={key:e,render:(t,o)=>(0,G.jsx)(Er().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,G.jsx)(Or().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:yr().gu.Modal,title:e,right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:yr().gu.Popup,width:250,...t},(0,G.jsx)(xr().A,{...r,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:c,sections:S,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};s.push(t)}})),{actions:s,initialFocus:a}}(t,s,n,r,i,l);let p;return p=c.isMobile?{menuType:yr().gu.Modal,title:(0,G.jsx)(vt().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:o.close}:{menuType:yr().gu.Popup,width:200},(0,G.jsx)(xr().A,{...p,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,G.jsx)(wr().A,{...e}),items:d}],onAccept:o.close})})}function Ur(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,G.jsx)(In().A,{id:`group_aggregation:${(0,Lo().Ix)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,_r().G9)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,G.jsx)(Fr,{aggregation:r,collectionContextStore:o,children:n?(0,Pr().rv)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,zn().P)(),value:n.aggregationResult,numberPrecision:void 0}):"–"})}}):null}function Xr(e){const t=(0,u().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Lo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,_r().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,G.jsx)(Fr,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Pr().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,zn().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}function qr(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,vt().tz)(),i=Pr().zY[(0,_r().V1)(n)],l=(0,u().K8)((()=>Mr(o,n)),[o,n]);if((0,_r().G9)(n)){const e=t[n.property];if(e){const t=e.name;return(0,G.jsx)(G.Fragment,{children:r.formatMessage(Lr.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,G.jsx)(G.Fragment,{children:r.formatMessage(Lr.aggregationType,{aggregationType:i,calculating:l})})}var Yr=()=>o(632537),Qr=()=>o(852302),Zr=()=>o(606273);function Jr(e){const{onMount:t,isInPeekRenderer:r,style:i,paddingTop:l,disabled:s,stickyStyle:c,transitionStickyStyle:d,groupFormat:g,collectionContextStore:m,format:S,groupAggregationKey:h,stickyWrapStyle:f}=e,[y,v]=(0,n.useState)(void 0),x=(0,a().v3)(),b=(0,Re().Zp)(),C=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=m.collectionViewBlockStore();e&&v(new(me().Bv)(x,{table:$().ev,id:e.id}))}),[m,x]);const w=(0,u().K8)((()=>m.groupsStore.getGroupState(g)),[m.groupsStore,g]),k=(0,n.useMemo)((()=>{if((0,Lo().D1)(g.value)&&(0,Lo().WO)(g.value.value))return new(me().Bv)(x,g.value.value)}),[x,g.value]),R=(0,u().K8)((()=>Boolean((null==k?void 0:k.isReady())&&!(null!=k&&k.canRead()))),[k]),I=(0,u().K8)((()=>null==w?void 0:w.toggleStateStore.state),[w]),j=(0,u().O$)(m.permissionScopesStore),_=(0,u().K8)((()=>!s&&m.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!R),[m,s,R]),B=(0,u().O$)(m.isInHomeWidgetStore),P=(0,u().K8)((()=>void 0!==S[h]&&!(null!=b&&b.isPreviewing)),[S,h,b]),M=(0,V().Oz)(m),F=(0,u().K8)((()=>B?"transparent":(null==M?void 0:M.background)||void 0),[M,B]),L=(0,u().O$)(m.isUnlistedViewStore),O=(0,p().IS)((t=>{const o=L?t.surface.elevated:r?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===F?o:F,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:l,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!I&&{marginBottom:e.toggleClosedMarginBottom},...f}}}),[F,r,I,l,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,f,L]),E=(0,n.useCallback)((()=>{if(!w)return;A().IU({environment:x});const e=!I;(0,o(294917).J)({environment:x,groupFormat:g,toggleStateStore:w.toggleStateStore,newValue:e,collectionContextStore:m})}),[m,x,g,w,I]),D=(0,n.useCallback)((()=>(0,G.jsx)(Zr().f,{isSidebar:!1,open:I??!1,fill:!0,onClick:E,onMouseDown:Oe().tr,style:{flexShrink:0}})),[E,I]),{value:z}=(0,ge().fJ)(de().VI.duplicateActions),K=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=C.current;if(!(n&&n instanceof Element))return;const r=await Te().T.formulas.load();T().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:x,canUndo:!0,perform:e=>nr({environment:x,collectionContextStore:m,groupsPointer:[g],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r,duplicateActions:z})})}),[m,z,x,g]),H=(0,n.useMemo)((()=>({...c,paddingLeft:e.paddingLeft-2})),[c,e.paddingLeft]);return w&&y?(0,G.jsx)(Qr().g,{stickyAttachPoint:B?"no-stick":"ceiling",stickyStyle:H,transitionStickyStyle:d,nodeRef:C,children:(0,G.jsxs)("div",{style:O.topLevelDiv,ref:C,children:[(0,G.jsx)("div",{style:O.stickyWrapStyle,children:(0,G.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,G.jsxs)(gt().Ay,{store:y,canDropOnto:!s&&!I,onSelectableDrop:K,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[g],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[D(),(0,G.jsx)(ni,{collectionGroupHeaderProps:e}),P&&(0,G.jsx)(ti,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!s&&j.canConfigureBlock&&(0,G.jsx)(oi,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),_&&(0,G.jsx)(ri,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const ei=n.memo(Jr);function ti(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupsResultStore:l,groupAggregationKey:s}=e;const a=!(0,u().O$)(qe().e),c=(0,u().K8)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return a?null:(0,G.jsx)(Dr,{groupsResultStore:l,groupFormat:i,disabled:t||!c,groupAggregationKey:s,format:o,schema:n,collectionContextStore:r})}function oi(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:s,isGroupHoveredStore:c}=e;const d=(0,vt().tz)(),g=(0,a().Y0)(),m=(0,u().K8)((()=>l.groupsLimitStore),[l]),S=(0,u().O$)(c),[h,f]=(0,Vn().A)(),y=(0,p().IS)((()=>({button:{transition:g.isMobile?void 0:"opacity 100ms ease-in-out",opacity:g.isMobile?void 0:S||f?1:0}})),[g.isMobile,f,S]);return(0,G.jsx)(sn().Ay,{popupType:g.isMobile?sn().z7.SlideUp:sn().z7.Popup,renderOrigin:e=>(0,G.jsx)(Mt().A,{ariaLabel:d.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:h,icon:Ln()._,style:y.button,...e}),onClick:Oe().kV,render:e=>(0,G.jsx)(Ar,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:s,groupsLimitStore:m})})}function ni(e){let{collectionGroupHeaderProps:t}=e;const o=(0,a().v3)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:s,collectionContextStore:c}=t,d=(0,u().O$)(c.permissionScopesStore);return(0,G.jsx)(Yr().d,{groupBy:s,groupFormat:n,currentGroups:l,schema:r,disabled:i||!d.canConfigureCollection||d.isSyncedCollection||"formula"===s.type,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(lr({...e,environment:t,collectionStore:r,...o}),(0,b().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:c,source:"collection_group_header"})}function ri(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,vt().tz)(),r=(0,a().Y0)(),i=(0,a().v3)(),l=(0,u().O$)(o),[s,c]=(0,Vn().A)(),d=(0,p().IS)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||c?1:0}})),[r.isMobile,c,l]);return(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,G.jsx)(Mt().A,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:s,icon:qo().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,nt().EF)(e)&&(n.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),T().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,En().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),On().v(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,Me().sl)(n)}))}}))}(i,t),style:d.button,...e})})}var ii=()=>o(498212),li=()=>o(155129),si=()=>o(141333),ai=()=>o(970560),ci=()=>o(150866),di=()=>o(725976);const ui=0;function pi(e){let{nodeRef:t,width:o,isFirst:r,children:i,clipLeftExtra:l}=e;const s=(0,n.useMemo)(ii().Ay,[]),[a,c]=(0,n.useState)(0),[d,p]=(0,n.useState)(0),{ceiling:g,floor:m,stickyHorizontally:S}=(0,n.useContext)(di().m),h=(0,n.useContext)(ai().e),f=(0,n.useContext)(ci().j8),y=(0,n.useRef)(null),v=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(null),[C,w]=(0,n.useState)("in"),[k,R]=(0,n.useState)("in"),A=(0,n.useCallback)((e=>{for(const t of e)if(t.target===y.current||t.target===b.current){(t.target===y.current?w:R)((e=>{var o;return t.isIntersecting?"in":t.boundingClientRect.y<((null===(o=t.rootBounds)||void 0===o?void 0:o.y)||0)?"above":"below"}))}}),[y]);(0,n.useEffect)((()=>{if(!f.current||!y.current||!b.current)return;const e=new IntersectionObserver(A,{root:f.current,threshold:[0,1],rootMargin:`${-1*((null==h?void 0:h.stickyCeilingPortalsHeight)||0)}px 0px ${-1*(d+ui)}px 0px`});e.observe(y.current);const t=new IntersectionObserver(A,{root:f.current,threshold:[0,1],rootMargin:-1*(a+ui+((null==h?void 0:h.stickyCeilingPortalsHeight)||0))+"px 0px 0px 0px"});return t.observe(b.current),()=>{e.disconnect(),t.disconnect()}}),[A,null==h?void 0:h.stickyCeilingPortalsHeight,f,a,d]);const I="above"===(r&&h?h.topMarkerState:C)&&"above"!==k,T="below"!==C&&"below"===k,j=!I&&"above"===(r&&h?h.topMarkerState:C),_=!T&&"below"===k,B=(0,n.useCallback)(((e,t)=>{("ceiling"===e?c:p)((e=>e+t))}),[]),P=(0,n.useRef)([]),M=(0,n.useRef)([]),F=(0,n.useCallback)(((e,t)=>{const o="ceiling"===e?P:M;return o.current.push(t),()=>{o.current.splice(o.current.indexOf(t),1)}}),[]),V=(0,n.useMemo)((()=>({id:s,ceilingIsSticky:I,ceilingIsTransitioning:j,containerNode:t,floorIsSticky:T,floorIsTransitioning:_,topMarkerState:C,provideHeight:B,ceilingTransitionRef:v,floorTransitionRef:x,stickyCeilingPortalsHeight:a,registerPortal:F})),[s,I,j,T,t,B,C,v,x,_,a,F]),L=-1*(0,n.useContext)(li().X),{horizontalScroller:O}=(0,n.useContext)(Ie().R)||{},E=(0,u().K8)((()=>null==O?void 0:O.getStore().state.elementRef),[O]),D=(0,si().Xg)(E??{current:null}),z=E?`${D}px`:"100%";return(0,n.useEffect)((()=>{if(!g||!m||!t.current||S)return;const e=P.current;for(let t=0;t<e.length;t++)e[t].parentElement.style.width=I?z:"initial";const o=M.current;for(let t=0;t<o.length;t++)o[t].parentElement.style.width=T?z:"initial"}),[I,g,s,T,m,t,z,S]),(0,n.useEffect)((()=>{if(!t.current||!f.current||S)return;const e=t.current.closest(`.${Be().XGs}.${Be().Dkd}`),o=t.current.closest(`.${Be().XGs}.${Be().RYy}`);if(!e||!o)return;const n=e.closest(".layout");let r=null;const i=e=>{e.target===n&&s(e)},s=function(){r||(r=requestAnimationFrame((()=>{r=null;const t=e.scrollLeft,n=e.getBoundingClientRect(),i=o.getBoundingClientRect(),s=n.x-i.x,a=t-s;if(I&&g){const e=P.current,o=void 0===l||0===l?0:l-s;for(let r=0;r<e.length;r++)e[r].style.marginLeft=-1*a+"px",e[r].style.marginRight=`${a}px`,e[r].style.clipPath=`rect(-100px ${t+n.width}px calc(100% + 100px) ${t+o}px)`,e[r].style.setProperty("--sticky-horizontal-offset",(0===o?-1*s:0)+"px")}else{const e=P.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath="",e[t].style.removeProperty("--sticky-horizontal-offset")}if(T&&m){const e=M.current;for(let o=0;o<e.length;o++)e[o].style.marginLeft=-1*a+"px",e[o].style.marginRight=`${a}px`,e[o].style.clipPath=`rect(-10px ${t+n.width}px calc(100% + 10px) ${t}px)`}else{const e=M.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath=""}})))};s(),e.addEventListener("scroll",s,{passive:!0});const a=new ResizeObserver(s);return a.observe(f.current),a.observe(e),a.observe(o),null==n||n.addEventListener("transitionend",i),()=>{e.removeEventListener("scroll",s),r&&cancelAnimationFrame(r),null==n||n.removeEventListener("transitionend",i),a.disconnect()}}),[s,I,T,t,f,j,g,m,S,l,L]),(0,G.jsxs)(ai().e.Provider,{value:V,children:[(0,G.jsx)("div",{ref:x,style:{position:"absolute",zIndex:999,width:"100%"}}),(0,G.jsx)("div",{ref:y,style:{height:ui,marginTop:-1*ui,pointerEvents:"none",width:o}}),i,(0,G.jsx)("div",{ref:b,style:{height:ui,marginTop:-1*ui,pointerEvents:"none",width:o,clear:"both",transform:`translateY(${ui}px)`}}),(0,G.jsx)("div",{ref:v,style:{position:"absolute",zIndex:999,width:"100%",transform:`translateY(-${a}px)`}})]})}const gi=g().Store.createClass(!1,{name:"IsGroupHoveredStore"});function mi(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:s,groupsResultStore:c,format:d,schema:g,query:m,collectionContextStore:h,onGroupHeaderAddItem:f,renderHeader:y,getGroupStyle:v,stickyLeft:x,paddingLeft:b,isFullScreen:C,index:w,isRootChild:k,isInPeekRenderer:R,groupBy:A,isLast:I}=e;const T=(0,a().v3)(),j=(0,n.useRef)(null),_=(0,u().uB)(void 0,gi),[B,P,M,F,V]=(0,u().K8)((()=>{const e=h.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,a=!!n&&n.state?t(o):null,u={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:s,groupsResultStore:c,format:d,schema:g,query:m,collectionContextStore:h,isFullScreen:C,isInPeekRenderer:R,onGroupHeaderAddItem:f,stickyLeft:x,index:w,paddingLeft:b,isRootChild:k,groupBy:A,isGroupHoveredStore:_},p=y?y(u):(0,G.jsx)(ei,{...u});return[e,n,v&&n?v({groupFormat:o,index:w,isLast:I,toggleStateStore:n,isFullScreen:C,groupsDisplayState:r}):void 0,a,p]}),[h,o,t,r,i,l,s,c,d,g,m,C,R,f,x,w,b,k,A,_,y,v,I]);(0,n.useEffect)((()=>{!function(e){const{environment:t,groupFormat:o,collectionContextStore:n}=e,r=n.collectionViewStore();if(!r)return;const i=n.groupsStore.getGroupState(o);if(!i)return;const l=S().K.get({userId:t.currentUser.id,key:(0,Fn().i)(r.id,o)});i.toggleStateStore.setState(l??!0)}({environment:T,collectionContextStore:h,groupFormat:o})}),[]);const L=(0,n.useCallback)((()=>{_.setState(!0)}),[_]),O=(0,n.useCallback)((()=>{_.setState(!1)}),[_]),E=(0,p().IS)((()=>({container:{width:"100%",position:"relative",...M}})),[M]);return B&&P?(0,G.jsx)("div",{style:E.container,onMouseEnter:L,onMouseLeave:O,ref:j,children:(0,G.jsxs)(pi,{nodeRef:j,isFirst:0===w,children:[V,F]})}):null}function Si(e){return(0,V().rq)(e.board_cover_size)}function hi(e){const{disableBoardColorColumns:t,isInHomeWidget:o,isMobile:n,isDBUXChromeEnabled:r}=e;if(o)return 0;return(t?4:8)+(r&&n?12:0)}function fi(e){const{displayState:t,format:o,permissionScopes:n}=e,{visibleGroups:r}=t,i=o.board_columns_by;return!!i&&(0!==r.length&&(n.canConfigureBlock&&!n.isSyncedCollection&&(0,Lo().pP)(i,n.canConfigureCollection)))}function yi(e){const{format:t,visibleGroups:o,isDBUXChromeEnabled:n}=e,r=Jo(n),i=on(n);return o.length*(Si(t)+2*i+2*r)}var vi=()=>o(668725);const xi=30,bi=4,Ci=10;function wi(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,u().O$)(t);return(0,G.jsx)(ln().p,{onClick:function(){t.setState(!t.state)},onMouseDown:Oe().tr,style:{height:xi,marginBottom:bi,...e.style},iconLeading:e=>(0,vi().b)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,G.jsx)(vt().sA,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function ki(e){const{format:t,columnsDisplayState:o}=e,n=(0,H().X)("db_ux_chrome"),r=(0,p().IS)((()=>({container:{display:"flex",minWidth:yi({format:t,visibleGroups:o.visibleGroups,isDBUXChromeEnabled:n})}})),[o.visibleGroups,t,n]);return(0,G.jsx)("div",{style:r.container,children:(0,G.jsx)(wi,{...e})})}function Ri(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,a().v3)(),l=(0,u().K8)((()=>(0,Ao().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),s=(0,u().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),c=(0,u().K8)((()=>(0,Ao().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Ao().HV:n),[i,t,o,r,n]);return l||s?null:(0,G.jsx)("div",{style:{width:"100%",height:an+dn+cn,display:"flex"},children:(0,G.jsx)(pn,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?c:32,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Ai(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:s}=e,c=(0,a().v3)(),d=(0,u().K8)((()=>(0,Ao().iw)({environment:c,format:t,isFullScreen:o,isRootChild:n})),[c,t,o,n]),p=(0,u().K8)((()=>(0,Ao().Od)({environment:c,isRootChild:n,isFullScreen:o,format:t})?Ao().HV:r),[c,t,o,n,r]);return d?null:(0,G.jsx)("div",{style:{width:"100%",height:xi+bi+Ci,display:"flex"},children:(0,G.jsx)(wi,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...s}})})}function Ii(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,a().v3)(),i=(0,u().K8)((()=>(0,Ao().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,u().K8)((()=>(0,Ao().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?Ao().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,G.jsx)(fn,{type:"default",groupsDisplayState:e.groupsDisplayState,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:32,width:"max-content",paddingLeft:4,paddingRight:8}})}var Ti=()=>o(8741),ji=()=>o(112412),_i=()=>o(522986),Bi=()=>o(895876),Pi=()=>o(319357),Mi=()=>o(205682),Fi=()=>o(77238),Vi=()=>o(13679);const Li=(0,vt().YK)({editGroups:{id:"collectionView.emptyState.editGroups",defaultMessage:"Edit groups"},clearSearch:{id:"collectionView.emptyState.clearSearch",defaultMessage:"Clear search"},editFilters:{id:"collectionView.emptyState.editFilter",defaultMessage:"Edit filters"}});const Oi=n.memo((function(e){const{collectionContextStore:t,paddingLeft:r,paddingRight:i,groupByKeyToOpen:l,headerWidth:s,groupsPointer:c}=e,d=(0,H().X)("db_ux_empty_states"),g=(0,a().v3)(),m=ke().A.isMobile,S=(0,u().O$)(t.isFullScreenStore),h=(0,u().O$)(t.viewsModuleContextStore),f=(0,u().K8)((()=>t.getViewType()),[t]),{value:y}=(0,ge().fJ)(de().VI.duplicateActions),v=""!==(0,u().O$)(t.searchQueryStore),x=(0,u().K8)((()=>(0,Eo().N1)({collectionContextStore:t,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[t]),b=(0,u().K8)((()=>(0,nt().EF)(g)&&t.permissionScopesStore.state.canEditContent),[g,t.permissionScopesStore]),C=(0,u().K8)((()=>t.collectionViewBlockStore()),[t]),w=n.useCallback((async e=>{const o=await Te().T.formulas.load();T().createAndCommit({userAction:"CollectionViewEmptyState.handleDrop",environment:g,canUndo:!0,perform:n=>{const r=t.collectionStore();if(!r||!C)return;const i=(0,Lo().H2)(t.normalizedFormatStore.state,"board"===f?"board_columns_by":"collection_group_by","board"===f?"board_columns":"collection_groups");let l;if(i){const e=t.normalizedSchemaStore.state[i.property];if(e&&(0,Lo().Eg)(e)){const t=(0,Lo().ro)(e);t&&(l={property:i.property,value:t})}}nr({environment:g,collectionContextStore:t,collectionStore:r,targetStore:C,droppedDirection:Gn().bH.Above,groupsPointer:c??(l?[l]:[]),droppedStores:e.droppedStores,duplicate:e.duplicate,collapsedGroup:!1,formulasModule:o,transaction:n,duplicateActions:y})}})}),[g,t,C,f,c,y]),k=(0,p().IS)((()=>{const e=(t={isFullScreen:S,isMobile:Boolean(m),isInViewsModule:Boolean(h),groupsPointer:c}).groupsPointer&&t.groupsPointer.length>0?72:t.isFullScreen||t.isMobile||t.isInViewsModule?144:72;var t;return{container:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",alignContent:"center",gap:m?16:12,..."timeline"===f?{position:"relative",width:"100%",height:c?e:"100%"}:{position:"sticky",left:r,height:e,width:s-r-i,marginLeft:"gallery"===f?void 0:`-${r}px`,marginRight:"gallery"===f?void 0:`-${i}px`}}}}),[S,m,h,f,c,r,s,i]),R=n.useMemo((()=>{if(!C)return"collection_view_empty_state";return c&&1===c.length?`collection_view_empty_state_${C.id}_${(0,Lo().Ix)(c.at(0))}`:`collection_view_empty_state_${C.id}`}),[C,c]);return!d&&"board"!==f||!C?null:(0,G.jsx)(Vi().A,{store:C,droppable:b,render:()=>(0,G.jsxs)(o(218557).Tl,{dropTargetKey:R,style:k.container,canNativeDropOnto:!1,keepTextSelectionOnDrop:!0,shouldShowDropZone:b,canAcceptDrop:()=>b,canDropOnto:b,onSelectableDrop:w,className:Be()._XL,children:[(0,G.jsx)(Ei,{collectionContextStore:t,viewType:f,hasSearchQuery:v,hasFilter:x,groupByKeyToOpen:l}),b?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(Di,{collectionContextStore:t,groupsPointer:c,viewType:f}),(0,G.jsx)(zi,{collectionContextStore:t})]}):null]})})}));function Ei(e){const{collectionContextStore:t,viewType:o,hasSearchQuery:r,hasFilter:i,groupByKeyToOpen:l}=e,s=(0,vt().tz)(),a=ke().A.isMobile,c=l??"collection_group_by",d=(0,V().xY)(o),g=(0,u().K8)((()=>t.collectionViewStore()),[t]),{title:m,onClick:S,iconLeading:h}=n.useMemo((()=>g?d?{title:s.formatMessage(Li.editGroups),onClick:()=>{C().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:c,groupsFormatKey:Lo().Hw[c]}})},iconLeading:dr().p}:r?{title:s.formatMessage(Li.clearSearch),onClick:()=>{t.searchQueryStore.setState("")},iconLeading:void 0}:i?{title:s.formatMessage(Li.editFilters),onClick:()=>{C().R8({collectionSettingsStore:t.settingsStore,item:{type:"filters"}})},iconLeading:ji().$}:{title:s.formatMessage(Li.editGroups),onClick:()=>{C().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Lo().V1}})},iconLeading:dr().p}:{title:void 0,onClick:void 0,iconLeading:void 0}),[g,d,r,i,s,t.settingsStore,t.searchQueryStore,c]),f=(0,p().IS)((e=>({plainButton:{fontSize:a?17:14,border:`1px solid ${e.stroke.secondary}`}})),[a]);return(0,G.jsx)(ln().p,{onClick:S,isLightGray:!0,style:f.plainButton,size:a?"xl":void 0,iconLeading:h,iconStyle:{width:16,height:16},children:m})}function Di(e){const{collectionContextStore:t,viewType:r,groupsPointer:i}=e,l=(0,a().v3)(),s=ke().A.isMobile,c=(0,u().O$)(t.isFullScreenStore),d=(0,u().O$)(t.viewsModuleContextStore),g=(0,u().O$)(t.isInPeekRendererStore),m=(0,u().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[t]),S=n.useCallback((()=>{let e=t.collectionViewBlockStore(),n=t;if(null!=d&&d.collectionViewBlockStore){e=d.collectionViewBlockStore;const t=(0,o(799832).U)(e);t&&(n=t)}e&&(t.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:t,isFullScreen:c}),T().createAndCommit({userAction:"CollectionViewEmptyState.handleAddPage",environment:l,canUndo:!0,perform:s=>{let a;const c=t.isMultiSourceView?"center_peek":(0,V().hH)(t);if((0,V().lO)(r)||"timeline"===r){const e=(0,En().Q)({environment:l,collectionContextStore:t,groupsPointer:i??[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:s,from:{createBlock:"collection_view_empty_state"},inMemoryRecordCache:l.defaultRecordCache.inMemoryRecordCache});if(!e)return;if(a=e.newStore,e.coercionSucceeded){const e=()=>{a&&_i().ho({isNewBlock:!0,environment:l,blockPropertyValueOverlayStore:g?Fi().A:Mi().A,store:a,property:"title",format:"table",collectionContextStore:t})};t.registerCallbackForItemMounted(a,e)}else $o().VU({environment:l,store:a,peekMode:c,collectionContextStore:t,pageVisitSource:Vo().y8.Create,resultsStore:void 0})}else a=(0,o(248662).T)({transaction:s,store:e,collectionContextStore:n,environment:l,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,from:{createBlock:"collection_view_empty_state"},showMoveTo:!1,peekModeOverride:c}),a&&On().v(l,{from:"collection_view_empty_state",type:"page",new_page_id:a.id,creating_block_id:e.id,...(0,Me().sl)(t)})}}))}),[t,d,l,c,r,i,g]),h=(0,p().IS)((e=>({plainButton:{fontSize:s?17:14,border:`1px solid ${e.stroke.secondary}`}})),[s]),f=s?"xl":void 0;return(0,G.jsx)(ln().p,{onClick:S,isLightGray:!0,iconLeading:qo().plusSmallIcon,iconStyle:{width:16,height:16},style:h.plainButton,size:f,children:(0,G.jsx)(vt().sA,{defaultMessage:"New {itemType}",id:"collectionView.emptyState.addNewPage",values:{itemType:(0,Bi().$O)(m)}})})}function zi(e){const{collectionContextStore:t}=e,o=(0,a().v3)(),n=(0,vt().tz)(),r=ke().A.isMobile,i=(0,u().K8)((()=>(0,V().fG)({collectionContextStore:t,environment:o,intl:n})),[t,o,n]),l=(0,p().IS)((e=>({plainButton:{fontSize:r?17:14,border:`1px solid ${e.stroke.secondary}`}})),[r]);return i?(0,G.jsx)(Pi().O,{collectionContextStore:t,groupFormat:void 0,onAddOrLink:void 0,renderLinkButton:e=>{const t=r?"xl":void 0;return(0,G.jsx)(ln().p,{...e,isLightGray:!0,iconLeading:Ti().arrowDiagonalUpRightSmallIcon,iconStyle:{width:16,height:16},style:l.plainButton,size:t,children:(0,G.jsx)(vt().sA,{defaultMessage:"Link existing",id:"collectionView.emptyState.linkExisting"})})}}):null}const Ki=(0,Po().wt)("collectionGroupAccordion",{svg:(0,G.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});var Hi=()=>o(721908),Wi=()=>o(114641),Gi=()=>o(228927),Ni=()=>o(569912);class $i extends g().Store{getInitialState(){return{}}}const Ui=$i;var Xi=()=>o(860118);const qi=Object.freeze({fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:Fo().Wy.medium,width:"auto"}),Yi=Object.freeze({fontSize:15,lineHeight:1.5,minHeight:22.5,fontWeight:Fo().Wy.medium,width:"auto"}),Qi=Object.freeze({fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:Fo().Wy.medium,width:"auto"}),Zi=Object.freeze({fontSize:17,lineHeight:1.5,minHeight:25.5,fontWeight:Fo().Wy.medium,width:"auto"});function Ji(e){const{isMobile:t,isDBUXChromeEnabled:o}=e;return o?t?Zi:Yi:t?Qi:qi}function el(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,At().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==Xo().rn||(0,Xi().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,zn().P)(),intl:Tt().A.getIntl(),experimentService:zo().default,collectionFeatureGates:(0,Hn().i)(),formulasModule:r})))}function tl(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,At().qI)(o,t)}return!1}var ol=()=>o(645099),nl=()=>o(955363),rl=()=>o(435009),il=()=>o(777045),ll=()=>o(484792),sl=()=>o(492414);const al=n.memo(n.forwardRef((function(e,t){const{groupsPointer:r,groupFormat:i,collectionContextStore:l,isSingleColumn:s,isButtonOnOwnRow:c,coverHeight:d,hasVisibleProperties:g,isFullScreen:m}=e,S=(0,a().v3)(),h=(0,H().X)("db_ux_chrome"),f=(0,vt().tz)(),y=(0,n.useContext)(ll().n),v=(0,u().K8)((()=>V().fG({collectionContextStore:l,environment:S,intl:f})),[l,S,f]),x=(0,n.useCallback)((e=>{y?y(e):rl().oo({environment:S,url:e})}),[S,y]),b=(0,n.useCallback)((()=>{if(!(0,nt().EF)(S))return void(0,nt().QY)(S);const e=l.groupsStore.getGroupState(r);e&&T().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:S,canUndo:!0,perform:t=>{const{mainEditorCurrentBlockStore:o}=jt().default.state,n=(0,En().Q)({environment:S,collectionContextStore:l,groupsPointer:r,shouldCoerce:!0,templateStore:l.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"gallery"},inMemoryRecordCache:S.defaultRecordCache.inMemoryRecordCache});if(!n)return;const i=V().wy({environment:S,store:n.newStore,mainEditorCurrentBlockStore:o,collectionContextStore:l})??(0,sl().Ay)({store:n.newStore,pageVisitSource:Vo().y8.Create});x(i),k().Ey({collectionContextStore:l,resultsStore:e.resultsStore}),On().v(S,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:n.newStore.id,creating_block_id:n.newStore.id,...(0,Me().sl)(l)})}})}),[S,l,r,x]),C=(0,p().IS)((e=>{const{fontSize:t}=Ji({isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:h}),o=V().rU({isMobile:Boolean(ke().A.isMobile)}),n=d>0&&m&&!s&&!c,r=n&&g?d+o:n?d:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t,borderRadius:en,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:ke().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",minHeight:r,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t,borderRadius:en,padding:ke().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.icon.tertiary},buttonIcon:{width:t,height:t,marginLeft:s?void 0:-1,marginRight:6,fill:e.icon.tertiary}}}),[h,d,m,s,c,g]),w=(0,n.useCallback)((e=>(0,G.jsx)(Pt().A,{style:C.linkExistingButton,...e,children:(0,G.jsxs)("div",{style:C.buttonContent,children:[(0,nl().arrowDiagonalUpRightIcon)(C.buttonIcon),(0,G.jsx)(vt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})),[C]);return(0,G.jsxs)("div",{ref:t,style:C.wrapper,children:[(0,G.jsx)(Pt().A,{onClick:b,onMouseDown:Oe().tr,style:C.addItemButton,children:(0,G.jsxs)("div",{style:C.buttonContent,children:[(0,o(617668).plusIcon)(C.buttonIcon),(0,G.jsx)(il().w,{collectionContextStore:l})]})}),v?(0,G.jsx)(Pi().O,{collectionContextStore:l,groupFormat:i,renderLinkButton:w}):null]})})));var cl=()=>o(573451),dl=()=>o(690825),ul=()=>o(522419),pl=()=>o(675074);function gl(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:s,groupsPointer:a,formulasModule:c,duplicateActions:d}=e,u=s.collectionViewStore(),p=_e().y0(t);if(!u)return;const g=o.inMemoryRecordCache,m=pl().$C({environment:t,files:i,inMemoryRecordCache:g,pageWidth:p,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],s=Go().Wv({environment:t,type:"page",inMemoryRecordCache:g,properties:{title:(0,y().x9d)(ul().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return Nn().BC({parentStore:s.getContentStore(),appendStore:e,transaction:l}),s}));nr({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:s,groupsPointer:a,droppedStores:m,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c,duplicateActions:d})}var ml=()=>o(187174);var Sl=()=>o(97059),hl=()=>o(851802),fl=()=>o(645302),yl=()=>o(315221),vl=()=>o(843306),xl=()=>o(544073),bl=()=>o(945895);function Cl(e){const{analyticsName:t,belowDropZoneMargin:o,blockPropertyValueOverlayStore:r,canDrag:i,canDrop:l,collectionContextStore:s,direction:c,disabled:d,disableScrollToRevealHorizontal:g,disableSelectable:m,dropzoneGap:S,getItemSelectableStyle:h,groupsPointer:f,handleOpenPeekPage:y,isLast:v,itemSelectableHaloStyle:x,onSelectableEnter:b,onSelectableInsertRow:C,passesFilter:w,resultComponent:R,resultProps:A,store:I,subitemPath:j,toggleButton:_,touchDragOnly:B}=e,P=(0,a().v3)(),M=(0,Re().Zp)(),{value:F}=(0,ge().fJ)(de().VI.duplicateActions),L=(0,u().K8)((()=>(0,Sl().W)(P,I.id)),[I,P]),O=(0,u().K8)((()=>I.canEdit()),[I]),E=(0,u().K8)((()=>I.getAssociatedCollectionStore()),[I]),D=(0,u().K8)((()=>{var e;return null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType()}),[s]),z=(0,u().K8)((()=>"collectionTypedView"===s.contextType),[s]),K=(0,u().K8)((()=>{const e=s.groupsStore.getGroupState(f);return null==e?void 0:e.resultsStore}),[s,f]),H=(0,u().K8)((()=>V().NM(I)),[I]),W=(0,u().K8)((()=>V().f5({collectionContextStore:s})?60:void 0),[s]),N=(0,u().K8)((()=>{const e=bl().A.state;return e.isActive&&e.store===I}),[I]),$=!d&&O&&!L,U=e.shouldShowHoverMenu&&$,X=c!==Tl.Vertical&&l,q=c!==Tl.Vertical&&l,Y=c===Tl.Vertical&&l,Q=(0,p().IS)((e=>({haloStyle:{...V().wh(e,H),...("board"===D||"gallery"===D)&&{borderRadius:en},...x}})),[D,x,H]),Z=(0,n.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return E?(0,yl().D)({environment:P,collectionStore:E,collectionContextStore:s,groupsPointer:f,insertStores:t,store:I,before:!1,transaction:o}):[]}),[E,s,P,f,I]),J=(0,n.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return E?(0,yl().D)({environment:P,collectionStore:E,collectionContextStore:s,groupsPointer:f,insertStores:t,store:I,before:!0,transaction:o}):[]}),[E,s,P,f,I]),ee=(0,n.useCallback)((async e=>{const{droppedDirection:t,duplicate:o}=e;if(!E)return[];const n=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:P,getData:()=>Me().tv({collectionContextStore:s,is_native_drop:!1,is_empty:!1})});const r=t!==Gn().bH.Onto?(0,Do().f0)({stores:e.droppedStores,collectionContextStore:s}):e.droppedStores;if(0===r.length&&z)return void kn().f1((0,G.jsx)(vt().sA,{...Do().K0.unsupportedGroupAction}));const i=await Te().T.formulas.load();T().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:P,canUndo:!0,perform:e=>{!nr({environment:P,collectionStore:z?void 0:E,targetStore:I,droppedDirection:t,collectionContextStore:s,groupsPointer:f,droppedStores:r,duplicate:o,transaction:e,subitemPath:j,collapsedGroup:!1,formulasModule:i,duplicateActions:F})&&z&&kn().f1((0,G.jsx)(vt().sA,{...Do().K0.unsupportedGroupAction}))}})}),[E,s,F,P,f,z,I,j]),te=(0,n.useCallback)((async e=>{const{files:t,droppedDirection:o}=e;if(!E)return[];const n=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:P,getData:()=>Me().tv({collectionContextStore:s,is_native_drop:!0,is_empty:!1})});const r=await Te().T.formulas.load();T().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:P,canUndo:!0,perform:e=>{gl({environment:P,collectionStore:E,targetStore:I,droppedDirection:o,collectionContextStore:s,groupsPointer:f,files:t,transaction:e,formulasModule:r,duplicateActions:F})}})}),[E,s,F,P,f,I]),oe=(0,n.useCallback)((e=>t=>{let{transaction:o}=t;if(!E)return[];const n=(0,vl().u)({environment:P,collectionContextStore:s,groupsPointer:f,store:I,before:"above"===e,collectionStore:E,transaction:o,subitemPath:j,subitemInsertDirection:"below"});if(On().v(P,{...Me().sl(s),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==n?void 0:n.id,creating_block_id:null==n?void 0:n.id}),n&&C&&C(I,n),n&&r){const e=()=>{_i().ho({isNewBlock:!0,environment:P,blockPropertyValueOverlayStore:r,store:n,property:"title",format:"table",collectionContextStore:s})};s.registerCallbackForItemMounted(n,e)}}),[E,r,s,P,f,C,I,j]),ne=(0,n.useCallback)((e=>{oe("above")(e)}),[oe]),re=(0,n.useCallback)((e=>{oe("below")(e)}),[oe]),ie=(0,n.useCallback)((()=>{const e=s.collectionViewStore();He().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),null==y||y(),k().Ey({collectionContextStore:s,resultsStore:K});const t=null==e?void 0:e.getType();if(t){const e=s.normalizedFormatStore.state.collection_peek_mode,o=e||xl().C9[t];fl().bn(P,{is_peek:!0,from:t,peek_mode:o})}}),[s,P,y,K]),le=(0,n.useCallback)((e=>{const{transaction:t}=e;f.length>0&&Jn({store:I,transaction:t,groupsPointer:f,collectionContextStore:s,environment:P}),Ct().by({childStore:I,transaction:t})}),[s,P,f,I]),se=(0,u().K8)((()=>h?h(v):void 0),[h,v]);(0,n.useEffect)((()=>{s.onItemMount(I)}),[I,s]);const ae=n.createElement(R,{handleOpenPeekPage:ie,collectionContextStore:s,...A,...L?{disabled:!0}:{},store:I,key:I.id,isLast:v,toggleButton:_,subitemPath:j,passesFilter:w});return m?ae:(0,G.jsx)(gt().Ay,{analyticsName:t,belowDropZoneMargin:o,canDrag:i,canDropBelow:Y,canDropLeft:X,canDropOnto:l,canDropRight:q,canInsertAbove:l,canInsertBelow:l,canNativeDropBelow:Y&&!z,canNativeDropLeft:X&&!z,canNativeDropRight:q&&!z,canSelect:$,canTriggerContextMenu:$,className:Be().E4t,disableScrollToRevealHorizontal:g,dropzoneGap:S,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,groupsPointer:f,haloStyle:Q.haloStyle,isLastItem:v,onEnter:b,onInsertAbove:J,onInsertBelow:Z,onInsertRowAbove:ne,onInsertRowBelow:re,onNativeDrop:te,onRemove:le,onSelectableDrop:ee,shouldForceRenderSelectionHalo:H,shouldShowCommentMenu:!1,shouldShowDropZone:l,shouldShowHalo:!(N||null!=M&&M.isPreviewing),shouldShowHoverMenu:U,showBlockMenuInput:!0,store:I,style:se,touchDragOnly:B,verticalDropZoneExtraLeftEdgeOffset:W,children:ae})}const wl=n.memo(Cl,Qo().A);function kl(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:s,getItemSelectableStyle:c}=e,d=(0,a().v3)(),{isMobile:g}=(0,a().Y0)(),{value:m}=(0,ge().fJ)(Te().T.formulas),S=(0,p().DP)(),{currentSubitemFormatStoreForUiDisplayStore:h,subitemExpandedStore:f,subitemTreeStore:y}=r,x=(0,u().K8)((()=>V().Dj({store:t,collectionContextStore:r})),[r,t]),b=(0,u().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),C=(0,u().K8)((()=>r.isSystemCollection()),[r]),w=(0,u().K8)((()=>i&&i.length>0?i:(0,Kn().Qe)(y.state.children,(e=>e.value.store===t))),[i,y,t],{useDeepEqual:!0}),k=(0,n.useMemo)((()=>w?(0,ue().kY)(w.map((e=>e.value.store))):""),[w]),R=(0,u().K8)((()=>f.state.get(k)),[f,k]),I=Boolean(null==R?void 0:R.isExpanded),T=(0,u().O$)(h),j=(0,u().K8)((()=>{if(!x||!T)return;const e=x.getSchema()[T.property];return void 0!==e&&(0,Xo().nC)(e)?e:void 0}),[x,T]),B=(0,u().K8)((()=>{var e;return j&&"relation"===j.type&&(0,Xo().zO)(j)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&j.property}),[r,j]),P=(0,u().K8)((()=>{const e=!B||b&&(0,ue().qS)(b)?void 0:{property:B,filter:{operator:"is_empty"}};return!(!T||!x)&&(0,ue().Ch)({store:t,collectionStore:x,subitemFormat:T,subitemPathKey:k,collectionContextStore:r,propertyFilters:[...e&&B?[{id:B,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:d.currentUser.id,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,formulasModule:m}).length>0}),[r,b,d.currentUser.id,B,x,k,t,T,m]),M=(0,u().K8)((()=>!(!x||!T)&&(P||I||g||"timeline"===b||C&&t.canEdit()&&(void 0===l||0===l))),[x,T,P,I,g,b,l,C,t]),F=(0,u().K8)((()=>!(!x||!T)&&hl().A.getState().hoveredStore===t),[x,t,T]),L=(0,u().K8)((()=>{const e=(0,Eo().AU)({collectionContextStore:r,collectionStore:x,environment:d});if(e)return(0,o(289915).oR)(e)}),[r,x,d]),O=(0,n.useCallback)((()=>{const e=f.state;if(I){e.delete(k);const o=Se().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&A().DN({stores:(0,v().R9)(Se().default.state.stores,o)}),function(e,t){(0,_().v)(e,"subitem_toggle_block_close",t)}(d,{...(0,Me().sl)(r),depth:(null==w?void 0:w.length)||0}),f.emit()}else e.set(k,{isExpanded:!0,limit:20}),function(e,t){(0,_().v)(e,"subitem_toggle_block_open",t)}(d,{...(0,Me().sl)(r),depth:(null==w?void 0:w.length)||0}),L&&e&&j&&T?(0,ue().eI)({blockStore:t,subitemExpandedStore:f,subitemFormat:T,propertySchema:j,compiledFilter:L,pathKey:k,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map}).then((()=>{f.emit()})):f.emit()}),[f,I,k,d,r,null==w?void 0:w.length,t,L,j,T]),E=(0,u().K8)((()=>{const o=y.state;return o&&w&&o.children.length>0?(0,ue().ag)(o).value.store===t:e.isLast}),[y,e.isLast,t,w]),D=(0,o(991114).C)(),z=(0,u().K8)((()=>{var e;const o=t.getModel();if(!L||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return L({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+D,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:zo().default,formulasModule:m})}),[t,L,D,m]),K=(0,u().K8)((()=>(0,Sl().W)(d,t.id)),[d,t]),H=(0,u().K8)((()=>c&&!z||K?()=>({...c?c(E):{},...z?{}:{opacity:.5},...K?{opacity:.5}:{}}):c),[c,z,E,K]);(0,ml().Yb)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!M||!e||!L||!j||!o||!T||z)return;(0,ue().eO)({store:t,subitemFormat:T,propertySchema:j}).length>0||(await(0,ue().eI)({blockStore:t,subitemExpandedStore:f,subitemFormat:T,propertySchema:j,compiledFilter:L,pathKey:k,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map}),f.emit())}),[M,L,z,k,t,f,T,j]);const W=(0,G.jsx)(wl,{...e,passesFilter:z,isLast:E,getItemSelectableStyle:H,subitemPath:w,toggleButton:M||F?(0,G.jsx)(Zr().f,{isSidebar:!1,open:I,fill:!0,onClick:O,color:P||I?S.icon.primary:S.icon.secondary,disabled:w&&w.length>=ue().x2}):void 0});if(!I||!w||0===w.length||w.length>=ue().x2)return W;const N=w[w.length-1].children,$=x&&void 0!==s,U=R&&N.length>0&&N.length===R.limit;return(0,G.jsxs)(G.Fragment,{children:[W,N.map((t=>{const o=t.value.store;return(0,n.createElement)(Rl,{...e,key:o.id,store:o,subitemPath:[...w,t]})})),$?s({store:t,parentStore:x,subitemPath:w,indentLevel:w.length,titleColumnIndex:l}):null,U?(0,G.jsx)(Al,{collectionContextStore:r,pathKey:k,titleColumnIndex:l,limit:R.limit,indentLevel:w.length}):null]})}const Rl=n.memo(kl,Qo().A),Al=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,s=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),a=(0,u().K8)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),c=(0,p().IS)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,P().si)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:a}),fontSize:14,lineHeight:Fo().K_.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},buttonHovered:{background:e.tableRowHoveredBackground},icon:{width:Po().Ev.sm,height:Po().Ev.sm,marginRight:6,fill:e.icon.tertiary},label:{color:e.text.tertiary}})),[r,l,a]);return(0,G.jsxs)(Pt().A,{onClick:s,onMouseDown:Oe().tr,style:c.button,hoveredStyle:c.buttonHovered,children:[(0,gn().g)(c.icon),(0,G.jsx)("span",{style:c.label,children:(0,G.jsx)(vt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})),Il=n.createContext(null);Il.displayName="CollectionGroupContainerContext";let Tl=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function jl(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:s,canDrop:c,canDrag:d,groupsPointer:p,loadContentCover:g,emptyDroppableSize:m,emptyDroppableStyle:S,virtualizeResults:h,timelineType:f,paddingLeft:y,paddingRight:x,headerWidth:b,shouldShowShimmer:C}=e,w=(0,a().v3)(),k=(0,H().X)("db_ux_empty_states"),R=(0,u().K8)((()=>t.getViewType()),[t]),A=(0,u().K8)((()=>t.collectionViewBlockStore()),[t]),I=(0,n.useMemo)((()=>{if(A)return new(me().Bv)(w,A.pointer)}),[A,w]),{groupState:T,reducer:j}=(0,u().K8)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=v().oE(p.map((e=>(0,Qn().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,zn().P)()}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:g}}}),[t,p,g]),_=(0,u().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),B=(0,u().K8)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),P=(0,u().K8)((()=>{const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p]),M=i===Tl.Vertical;var F;_.length>0&&(null===(F=t.databaseItemsVisibleTracker)||void 0===F||F.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const L=""!==(0,u().O$)(t.searchQueryStore),O=(0,u().K8)((()=>(0,Eo().N1)({collectionContextStore:t,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[t]),E=m||void 0,D=V().lO(R),z=V().xY(R),K=p.length>0,W=0===_.length,N=f&&"table"===f,$=k&&!C&&!z&&!(K&&!(D||N))&&W&&(N||D&&(L||O));return(0,G.jsxs)(G.Fragment,{children:[$?(0,G.jsx)(Oi,{collectionContextStore:t,paddingLeft:y,paddingRight:x,headerWidth:b,groupsPointer:p}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{...M?{height:E}:{width:E},...S},children:(0,G.jsx)(Bl,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:c,groupsPointer:p,instanceCollectionViewBlockStore:I,resultStores:_,droppedIntoCollectionStore:B,onSelectableEnter:s})}),h?(0,G.jsx)(Ml,{collectionContextStore:t,groupsPointer:p,resultComponentProps:e,canDrag:d&&!P,groupState:T,resultStores:_}):_.map(((t,o,n)=>(0,G.jsx)(Vl,{store:t,isLast:o===n.length-1,...e,canDrag:d&&!P},t.id)))]}),(0,G.jsx)(Ll,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:j})]})}const _l=n.memo(jl,Qo().A);function Bl(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:s,groupsPointer:c,instanceCollectionViewBlockStore:d,resultStores:p,droppedIntoCollectionStore:g}=e,m=(0,a().v3)(),S=(0,u().K8)((()=>"collectionTypedView"===t.contextType),[t]),h=(0,u().O$)(t.isInHomeWidgetStore),f=(0,u().K8)((()=>V().f5({collectionContextStore:t})?60:void 0),[t]),{value:y}=(0,ge().fJ)(de().VI.duplicateActions),v=(0,n.useCallback)((async e=>{const o=await Te().T.formulas.load();return function(e,t,o,n,r,i,l){const{droppedDirection:s,duplicate:a}=e,c=o.collectionViewBlockStore();if(!c)return;const d=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Me().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const u="collectionTypedView"===o.contextType,p=(0,Do().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===p.length&&u)return void kn().f1(Tt().A.formatMessage(Do().K0.unsupportedGroupAction));T().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!nr({environment:t,collectionStore:l,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n,droppedStores:p,duplicate:a,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})&&u&&kn().f1(Tt().A.formatMessage(Do().K0.unsupportedGroupAction))}})}(e,m,t,c,o,y,g)}),[t,g,y,m,c]),x=(0,n.useCallback)((async t=>{const o=await Te().T.formulas.load();return function(e,t,o,n,r,i,l){const{files:s,droppedDirection:a}=e;if(!l)return;const c=o.collectionViewBlockStore();if(!c)return;const d=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Me().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),T().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{gl({environment:t,collectionStore:l,targetStore:c,droppedDirection:a,collectionContextStore:o,groupsPointer:n,files:s,transaction:e,formulasModule:r,duplicateActions:i})}})}(t,m,e.collectionContextStore,e.groupsPointer,o,y,g)}),[g,y,m,e.collectionContextStore,e.groupsPointer]);if(!d)return null;const b=i!==Tl.Vertical&&(!o&&0===p.length),C=i===Tl.Vertical&&!o;return(0,G.jsx)(gt().Ay,{store:d,canSelect:!1,canEditText:!1,shouldShowHalo:!h,canDrag:!1,canDropLeft:s&&b,canNativeDropLeft:s&&b&&!S,canDropBelow:s&&C,canNativeDropBelow:s&&C&&!S,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:v,onNativeDrop:x,analyticsName:r,shouldShowDropZone:s,onEnter:l,groupsPointer:c,verticalDropZoneExtraLeftEdgeOffset:f,style:i===Tl.Vertical?void 0:{width:"100%",height:"100%"}})}function Pl(e){var t;let{collectionContextStore:o,groupsPointer:r,resultComponentProps:i,canDrag:l,groupState:s,resultStores:c}=e;const d=0!==r.length,p=d,[g,m]=(0,n.useState)(!p),[S,h]=(0,n.useState)(0),f=(0,n.useContext)(Ie().R),y=(0,n.useRef)(null),v=(0,n.useRef)(null),x=c.length<=0,b=(0,n.useContext)(Il);(0,n.useEffect)((()=>{if(!d)return;const e=new ResizeObserver((()=>{var e;null===(e=v.current)||void 0===e||e.call(v)}));if(null!=b&&b.current)return e.observe(b.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[b,d]);const C=(0,u().K8)((()=>{var e;return null==f||null===(e=f.verticalScroller)||void 0===e?void 0:e.getStore().state.element}),[null==f?void 0:f.verticalScroller]);(0,n.useEffect)((()=>{if(y.current&&p&&!g&&!x){if(null==C||!C.deref())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&m(!0)}),{root:C.deref(),rootMargin:"300px 0px 300px 0px"});return e.observe(y.current),()=>e.disconnect()}}),[g,x,C,p]);const w=(0,n.useCallback)((e=>{if(y.current=e,null==C||!C.deref())return;const t=()=>{let t=e,o=0;for(;t&&t!==document.body&&t!==C.deref();)o+=t.offsetTop,t=t.offsetParent;h(o)};t(),v.current=t}),[C]),k=(0,n.useCallback)((e=>c[e].id),[c]),R=(0,dl().Te)({count:c.length,estimateSize:()=>34,scrollMargin:S,getScrollElement:()=>(null==C?void 0:C.deref())??null,getItemKey:k,overscan:g?10:1,initialOffset:null==C||null===(t=C.deref())||void 0===t?void 0:t.scrollTop});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),s=(0,a().v3)(),c=t.getVirtualItems(),d=o.length+1,p=(0,u().K8)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{if(null!=i&&i.groupsPointer.length)return;const{fetching:e,previousTotal:t}=l.current;e&&t!==d&&(l.current={fetching:!1,previousTotal:0})}),[null==i?void 0:i.groupsPointer.length,d]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||i.groupsPointer.length>0||l.current.fetching)return;const[e]=c.slice(-1);!e||d<=0||e.index-t.options.overscan>.67*d&&(l.current={fetching:!0,previousTotal:d},r.infiniteScrollLongTaskObserver.observe(),(0,Wi().H)({collectionContextStore:r,environment:s,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,s,null==i?void 0:i.groupsPointer,p,o.length,d,c,t.options.overscan])}({virtualizer:R,resultsStores:c,collectionContextStore:o,groupState:s}),(0,n.useEffect)((()=>{o.virtualizedModule.setRowVirtualizer({virtualizer:R,groupsPointer:r})}),[o,R,r]),x?null:(0,G.jsx)("div",{ref:w,style:{height:R.getTotalSize(),width:"100%",position:"relative"},children:R.getVirtualItems().map((e=>{const t=c[e.index],o=c.length-1===e.index;return(0,G.jsx)("div",{"data-index":e.index,ref:R.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-R.options.scrollMargin}px)`},children:(0,G.jsx)(Vl,{store:t,isLast:o,...i,canDrag:l},t.id)},e.key.toString())}))})}const Ml=n.memo(Pl,Qo().A);function Fl(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:s,shouldShowHoverMenu:a,canDrag:c,disabled:d,format:p,getItemSelectableStyle:g,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:h,direction:f,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:R,nestedCreateSubitemButton:A,itemSelectableHaloStyle:I}=e,T=(0,u().K8)((()=>V().Dj({store:e.store,collectionContextStore:o})),[o,e.store]),j=(0,n.useMemo)((()=>[]),[]);return T?(0,G.jsx)(Rl,{getItemSelectableStyle:g,itemSelectableHaloStyle:I,store:e.store,canDrag:c,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:s,shouldShowHoverMenu:a,canDrop:v&&!d,format:p,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:h,disabled:d,direction:f,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:j,titleColumnIndex:R,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:A}):null}const Vl=n.memo(Fl,Qo().A);function Ll(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,H().X)("collection_group_reducer_visible"),l=(0,u().K8)((()=>t.groupsStore.getGroupState(o)),[t,o]),s=(0,u().K8)((()=>zo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),a=i&&o.length>0;return n||!r||!l||a?null:(0,G.jsx)(In().A,{id:o.length>0?`results:${(0,Lo().Hm)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:l.reducerResultStore,debounceWait:s})}var Ol=()=>o(932210),El=()=>o(244091),Dl=()=>o(743147),zl=()=>o(164124),Kl=()=>o(296798),Hl=()=>o(231722),Wl=()=>o(34556),Gl=()=>o(739041),Nl=()=>o(458366);function $l(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,At().yT)(t);A().hc({environment:e,store:t}),I().setSelectionAtEnd({store:l}),(0,cl().C)({store:t}),r&&(0,Gl().u)(e,"board_item_edit_mode_enter",{...(0,Me().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function Ul(e,t,o,n,r,i,l,a){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=el(t,o,r,l,a).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let g;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,Nl().B2)(c[e])))||u.find(((e,t)=>!l&&(0,Nl().B2)(c[e])));g=e}else{const e=v().Uk(u,((e,t)=>t<p&&(0,Nl().B2)(c[e])))||v().Uk(u,((e,t)=>!l&&(0,Nl().B2)(c[e])));g=e}g?s().default.afterNextFlush((()=>{_i().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:g,format:"page",collectionContextStore:r})})):l&&s().default.afterNextFlush((()=>{$l(t,o,r,i)})),_i().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Xl(e,t,o,n,r,i,l,s){const a=n.normalizedSchemaStore.state,c=el(t,o,n,l,s).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=v().Uk(c,((e,t)=>{const o=a[e];return(0,Nl().B2)(o)}))}d&&_i().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:"page",collectionContextStore:n}),i.preventEmptyDelete()}function ql(e,t,n,r){const i=t.getViewType();"board"!==i&&"gallery"!==i||((0,o(299709).E)({environment:e,collectionContextStore:t,block_id:n.id,property:"title",property_type:"text",from:i}),r.preventEmptyDelete())}class Yl extends g().Store{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),bl().A.state.isActive&&bl().A.setState({...bl().A.state,transient:!1}))}}const Ql=Yl;var Zl=()=>o(8980),Jl=()=>o(453101);function es(e){const t=(0,a().v3)(),n=(0,a().Y0)(),{value:r}=(0,ge().fJ)(Te().T.formulas),i=(0,u().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,u().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),s=(0,u().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),c=(0,u().K8)((()=>bl().A.state.isActive&&bl().A.state.store===e.store),[e.store]),d=(0,u().K8)((()=>s.canEditContent&&e.store.canEdit()),[s.canEditContent,e.store]),p=(0,u().K8)((()=>W().default.state.open&&W().default.state.targetStore.id===e.store.id),[e.store.id]),g=(0,u().K8)((()=>{const t=(0,V().hH)(e.collectionContextStore);return(0,Nl().lA)(t,!1)}),[e.collectionContextStore]),m=(0,u().K8)((()=>(0,V().wy)({environment:t,store:e.store,mainEditorCurrentBlockStore:jt().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),S=(0,u().K8)((()=>tl(e.collectionContextStore)),[e.collectionContextStore]),h=(0,u().K8)((()=>{const o=l?(0,At().Wp)({viewType:l,format:i,visible:!0}):[],n=el(t,e.store,e.collectionContextStore,c,r);return o.length>0&&o.length!==n.length}),[t,i,c,e.collectionContextStore,e.store,l,r]),f=(0,u().K8)((()=>{var t;const o=he().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Hl().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,At().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),y=(0,u().K8)((()=>!(s.isLocked||!s.canEditContent||s.isSyncedCollection||s.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[s.canEditContent,s.isExternallyImportedAndSyncedCollection,s.isLocked,s.isSyncedCollection,e.collectionContextStore,e.store]),v=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&d,x=y&&!c&&!f&&(S||h),b=c&&!p&&!e.disablePeekButton,C=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return n.isMobile?null:(0,G.jsxs)(o(608581).A,{isVisible:e.controlArgs.isVisible,position:"top",children:[v&&!e.controlArgs.isRepositioning&&(0,G.jsx)(Pt().A,{style:Jl().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,G.jsx)(vt().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),v&&e.controlArgs.isRepositioning&&(0,G.jsx)(Pt().A,{style:Jl().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,G.jsx)(vt().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),v&&e.controlArgs.isRepositioning&&(0,G.jsx)(Pt().A,{style:Jl().k,onClick:e.controlArgs.handleCancelClick,children:(0,G.jsx)(vt().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),x&&(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:n=>(0,G.jsx)(Pt().A,{style:Jl().k,onClick:()=>{$l(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...n,children:(0,G.jsx)(Zl().I,{icon:o(523389).pencilLineSmallIcon,size:"sm"})})}),b&&(0,G.jsx)(Ft().A,{renderTooltip:()=>g.tooltip,render:o=>(0,G.jsx)(Pt().A,{style:Jl().k,onClick:()=>{m&&(rl().oo({environment:t,url:m}),e.editModeStore.preventEmptyDelete())},...o,children:(0,G.jsx)(Zl().I,{icon:g.icon,size:"sm"})})}),C&&(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:n=>(0,G.jsx)(Pt().A,{style:Jl().k,onClick:n=>{A().Lt({environment:t,store:e.store}),o(901265).it({environment:t,stores:Se().default.state.stores,left:n.clientX,top:n.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...n,children:(0,G.jsx)(Zl().I,{icon:mn().Y,size:"sm"})})})]})}const ts=n.memo(es);var os=()=>o(740241);function ns(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:s,isCardSelected:c}=e;const d=(0,a().v3)(),{value:p}=(0,ge().fJ)(Te().T.formulas),{collectionStore:g,canEdit:m}=(0,u().K8)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:S,collectionViewStore:h,isTableWrapped:f}=(0,u().K8)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),y=(0,u().K8)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),v=(0,n.useCallback)((()=>Ul("tab",d,o,r,i,s,c,p)),[d,o,r,i,s,c,p]),x=(0,n.useCallback)((()=>Ul("untab",d,o,r,i,s,c,p)),[d,o,r,i,s,c,p]),b=(0,n.useCallback)((()=>function(e,t,o,n){_i().VN({environment:e,blockPropertyValueOverlayStore:t}),A().Lt({environment:e,store:o}),n.preventEmptyDelete()}(d,r,o,s)),[d,r,o,s]);if(!g)return null;const C="gallery"===S?"gallery":"board";return(0,G.jsx)(os().BlockPropertyRouter,{store:o,property:t.property,disabled:l||!m,locked:y,format:C,tableWrap:f||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:g,showIfEmpty:c,onEnter:b,onEsc:b,onBgClick:b,onTab:v,onUntab:x,collectionViewStore:h},t.property)}const rs=n.memo(ns);var is=()=>o(532940),ls=()=>o(187820),ss=()=>o(46986),as=()=>o(819527);const cs=(0,vt().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}}),ds=n.memo((function(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:s,blockPropertyValueOverlayStore:c,isCardSelected:d}=e,g=(0,a().v3)(),{isMobile:m}=(0,a().Y0)(),S=(0,H().X)("db_ux_chrome"),h=(0,vt().tz)(),f=(0,ss().x6)(),{value:y}=(0,ge().fJ)(Te().T.formulas),{collectionViewBlockId:v,collectionViewId:x,viewType:b}=(0,u().K8)((()=>{var e,t;return{collectionViewId:null===(e=r.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null===(t=r.collectionViewBlockStore())||void 0===t?void 0:t.id,viewType:r.getViewType()}}),[r]),C=(0,u().K8)((()=>el(g,t,r,d,y)),[g,t,r,d,y]),w=(0,u().K8)((()=>(0,ue().Kk)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:k,icon:R,isEmptyPage:j,hasError:_}=(0,u().K8)((()=>({titleStore:(0,At().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),B=(0,u().K8)((()=>(0,ls().Te)(t)),[t]),P=(0,u().K8)((()=>(Boolean(t.getIcon())||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),M=(0,u().K8)((()=>{var e;return d?h.formatMessage(cs.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,zn().P)(),intl:h,isWorkflowsContainerWithCreationEnabled:f}))||h.formatMessage(cs.untitledBlock)}),[d,h,t,f]),F=(0,u().K8)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),V=(0,n.useCallback)((()=>{Xl("tab",g,t,r,c,i,d,y)}),[g,t,r,i,c,d,y]),L=(0,n.useCallback)((()=>{Xl("untab",g,t,r,c,i,d,y)}),[g,t,r,i,c,d,y]),O=(0,n.useCallback)((()=>{(0,Wl().x)(),I().clear({environment:g});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?s(t):A().Lt({environment:g,store:t}),i.preventEmptyDelete())}),[g,t,r.permissionScopesStore,i,l,s]),E=(0,n.useCallback)((()=>{(0,Wl().x)();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):A().Lt({environment:g,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,g]),D=(0,n.useCallback)((()=>{ql(g,r,t,i)}),[g,t,r,i]),z=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&T().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:g,canUndo:!0,perform:t=>{Go().KY({store:o,value:e,transaction:t})}})}),[g,t]),K=(0,p().IS)((e=>{const t=C.length>0;return{titleWrap:{position:"relative",width:"gallery"===b?"100%":"auto",display:"flex",alignItems:"center",paddingLeft:as().w_,paddingRight:as().w_,paddingBottom:t?6:m?12:8,paddingTop:w?4:m?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...m?{marginTop:0,marginRight:4}:{marginTop:S?0:2,marginRight:4}},warningIcon:{fill:e.palette.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...m?{width:Po().Ev.default,marginLeft:S?0:2,marginRight:4}:{width:Po().Ev.sm,marginLeft:S?0:4,marginRight:6}},text:{pointerEvents:d?void 0:"none",cursor:d?"text":void 0,flexGrow:1,...S?{padding:"0 1px"}:{padding:"2px 1px"},whiteSpace:"pre-wrap",...Ji({isMobile:m,isDBUXChromeEnabled:S})}}}),[d,S,m,w,C.length,b]),W=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:x,collectionViewBlockId:v})),[v,x]),N=(P||d)&&!_;return(0,G.jsxs)("div",{style:K.titleWrap,children:[N?F?(0,G.jsx)(ls().B6,{disabled:!1,bucket:"secure",style:K.recordIcon,progressContainerStyle:K.recordIcon,icon:R,iconRecordCategory:B,store:t,size:m?24:20,isEmptyPage:j,onChange:z}):(0,G.jsx)(ls().B6,{disabled:!0,icon:R,iconRecordCategory:B,isEmptyPage:j,size:m?24:20,style:K.recordIcon,isInCollectionView:S}):null,_?(0,is().exclamationMarkTriangleIcon)(K.warningIcon):null,(0,G.jsx)(o(524702).A,{store:k,disabled:!d,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:O,onEsc:E,onTab:V,onUntab:L,onChange:D,placeholder:M,style:K.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:W})]})}));function us(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:s,collectionContextStore:d,blockPropertyValueOverlayStore:p}=e,g=(0,a().v3)(),m=(0,n.useRef)(null),{value:S}=(0,ge().fJ)(Te().T.formulas),h=(0,u().uB)(void 0,Rt().A),f=(0,u().uB)(void 0,Ql),y=(0,u().r6)((()=>{const t=bl().A.state;return t.isActive&&t.store===e.store}),[e.store]),v=(0,u().O$)(y),x=(0,u().K8)((()=>Se().default.state.stores.includes(o)),[o]),b=(0,u().K8)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=jt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=d.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===St().Lu&&o.getFormat().app_config_uri===St().e4&&"sprint_board"===(null===(n=jt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,d]),C=(0,u().K8)((()=>{const e=jt().default.state.mainEditorCurrentBlockStore;return(0,V().wy)({environment:g,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:d,fullyQualified:!1})}),[g,d,o]),w=(0,n.useCallback)((()=>{$l(g,o,d,f,"space")}),[g,o,d,f]),k=(0,n.useCallback)((()=>{(0,Wl().x)(),f.preventEmptyDelete()}),[f]),R=(0,n.useCallback)((()=>{i(o)}),[i,o]),A=(0,n.useCallback)((()=>{Ul("tab",g,o,p,d,f,v,S)}),[g,o,p,d,f,v,S]),I=(0,n.useCallback)((()=>{Ul("untab",g,o,p,d,f,v,S)}),[g,o,p,d,f,v,S]),j=(0,n.useCallback)((()=>{T().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:g,canUndo:!0,perform:e=>{l({blocks:Se().default.state.stores,transaction:e})}})}),[g,l]),_=(0,n.useCallback)((()=>{"new_empty"!==f.state||v||d.defaultPageTemplateStore.state||(r(o),y.removeListener(_))}),[d.defaultPageTemplateStore,f,v,y,r,o]);return(0,c().l)((()=>{var t;const o=he().default.state,n=bl().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Hl().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,At().yT)(e.store);i&&r?f.setState("new_empty"):i?f.setState("new"):f.setState("existing")})),(0,n.useEffect)((()=>(y.state&&"new_empty"===f.state&&y.addListener(_),()=>{y.removeListener(_)})),[f,y,_]),(0,Ke().NW)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>m.current,activate:()=>{C&&(s(),rl().oo({environment:g,url:C}))}})),[g,s,C,o]),(0,G.jsx)(le().A,{debugName:"CollectionViewCardItem",capture:v,onEsc:k,onEnter:R,onSpace:w,onTab:A,onUntab:I,children:(0,G.jsxs)(le().A,{debugName:"CollectionViewCardItem",capture:x,onShiftEnter:j,onSpace:e=>e.stopPropagation(),children:[(0,G.jsx)(gs,{...e,ref:m,mouseStore:h,editModeStore:f,isCardSelected:v,peekUrl:C}),b&&(0,G.jsx)(El().Ni,{origin:m})]})}))}const ps=n.memo(n.forwardRef(us)),gs=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:s,handleOpenPeekPage:c,collectionContextStore:d,blockPropertyValueOverlayStore:g,mouseStore:m,isCardSelected:S,coverFormat:h,coverAspectFormat:f,colorStyle:y,coverSizeFormat:v,coverWidth:x,coverHeight:b}=e,C=(0,a().v3)(),w=(0,a().Y0)().isMobile,k=(0,Re().Zp)(),{value:R}=(0,ge().fJ)(Te().T.formulas),[A,I]=(0,n.useState)(void 0),j=(0,u().K8)((()=>(0,Sl().W)(C,r.id)),[C,r]),_=(0,u().K8)((()=>m.state.mouseEntered),[m]),{viewType:B,isInHomeWidget:P}=(0,u().K8)((()=>({viewType:d.getViewType(),isInHomeWidget:d.isInHomeWidgetStore.state})),[d]),M=(0,u().K8)((()=>(0,sl().Ay)({store:r,fullyQualified:!1,pageVisitSource:Vo().y8.LinkInPage})),[r]),F=(0,u().K8)((()=>tl(d)),[d]),V=(0,u().K8)((()=>el(C,r,d,S,R)),[C,r,d,S,R]),L=(0,u().K8)((()=>(0,ue().xC)({collectionContextStore:d,blockStore:r})),[d,r]),O=(0,u().K8)((()=>(0,ue().Kk)({collectionContextStore:d,blockStore:r})),[d,r]),E=(0,u().K8)((()=>(0,o(299545).oC)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),D=(0,n.useCallback)((e=>{I(e)}),[I]),z=(0,n.useCallback)((e=>{c(),s.preventEmptyDelete()}),[s,c]),K=(0,n.useCallback)((()=>{Ye().A.state||m.setState({...m.state,mouseEntered:!0})}),[m]),H=(0,Hi().d)(K,100),W=(0,n.useCallback)((()=>{m.setState({...m.state,mouseEntered:!1})}),[m]),N=(0,vn().Y)(W,100),$=(0,n.useCallback)((e=>{T().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:C,canUndo:!0,perform:t=>{Wo().G8({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[C,r]),U=(0,n.useCallback)((e=>j||null!=k&&k.disableAllPointerEvents?null:(0,G.jsx)(ts,{store:r,collectionContextStore:d,blockPropertyValueOverlayStore:g,coverFormat:h,coverAspectFormat:f,lastProxiedUrl:A,editModeStore:s,controlArgs:e,disablePeekButton:null==k?void 0:k.disablePageLinks,disableMoreButton:null==k?void 0:k.disablePageLinks})),[g,d,k,f,h,s,A,r,j]),X=(0,p().IS)((e=>{const t="board"===B?(null==y?void 0:y.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:en,position:_?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===B?{marginBottom:w?10:8}:{height:"100%"},...P?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.shadowXS}},linkBoxInner:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===B?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHovered:P?o:{background:(null==y?void 0:y.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:P?o:{background:(null==y?void 0:y.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:F?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===B?{paddingBottom:6}:{paddingBottom:8,...P&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:E?4:8,paddingLeft:!E||O||F?10:4,paddingTop:"gallery"===B&&0===V.length?8:0,marginTop:"board"===B&&E?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.text.tertiary,fill:e.text.tertiary,fontWeight:Fo().Wy.medium,fontSize:12}}}),[B,y,_,w,P,S,E,O,F,V.length]);return"board"!==B&&"gallery"!==B?null:(0,G.jsxs)(Kl().A,{ref:t,href:M,metaHref:w?M:l,onMouseEnter:H,onMouseMove:H,onMouseLeave:N,onClick:z,style:X.linkBox,innerStyle:X.linkBoxInner,hoveredStyle:S?{background:X.linkBox.background}:X.linkBoxHovered,pressedStyle:S?{background:X.linkBox.background}:X.linkBoxPressed,disableForOffline:j,children:[(0,G.jsx)(o(801678).A,{store:r,source:B,mouseStore:m,renderControl:U,small:"small"===v,onFlushTemporaryPosition:$,render:e=>{let{imagePosition:t}=e;return h&&(0,G.jsx)(o(358006).z,{variant:"gallery",store:r,coverWidth:x,coverHeight:b,coverFormat:h,coverAspectFormat:f,coverSizeFormat:v,coverPosition:t,showEmptyGalleryCover:"gallery"===B,onLoadProxiedImage:D,isInHomeWidget:d.isInHomeWidgetStore.state})}}),L&&(0,G.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,G.jsx)(Dl().n,{blockStore:r,collectionContextStore:d})}),F?(0,G.jsx)(ds,{collectionContextStore:d,store:r,blockPropertyValueOverlayStore:g,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}):null,V.length>0&&(0,G.jsx)("div",{style:X.propertiesWrapper,children:V.map((e=>(0,G.jsx)(rs,{store:r,disabled:i,blockPropertyValueOverlayStore:g,collectionContextStore:d,editModeStore:s,isCardSelected:S,propertyFormat:e},e.property)))}),(E||O)&&(0,G.jsxs)("div",{style:X.iconsWrapper,children:[O&&(0,G.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,G.jsx)(zl().W,{blockStore:r,collectionContextStore:d})}),(0,G.jsx)(Ol().g,{store:r,iconStyle:X.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:O?-3:0}})]})]})})));var ms=()=>o(599945);const Ss=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:m,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,G.jsx)(ms().c,{store:t,step:"demo_collection_record",children:(0,G.jsx)(ps,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:m,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,colorStyle:void 0,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})})};function hs(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:s,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:d,isSingleColumn:p,paddingLeft:g,paddingRight:m,headerWidth:S,shouldShowShimmer:h}=e;const f=(0,a().v3)(),v=(0,n.useMemo)((()=>o?[o]:[]),[o]),x=(0,u().O$)(t.permissionScopesStore),b=(0,u().K8)((()=>s.canEdit()&&("collectionTypedView"===t.contextType||x.canEditContent)),[t,x.canEditContent,s]),C=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();A().hc({environment:f,store:e}),I().setSelectionAtEnd({store:o}),(0,cl().C)({store:e})}}),[f]),w=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;y().q4_(n.getValue())?A().Lt({environment:f,store:e}):o&&T().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:f,canUndo:!0,perform:t=>{Ct().by({childStore:e,transaction:t})}})}),[t,f]),k=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:R,gallery_cover_aspect:j,gallery_cover_size:_}=r,B=!l&&b&&!x.isSyncedCollection,{coverHeight:P,coverWidth:M}=(0,u().K8)((()=>{const{coverHeight:e,coverWidth:t}=d.state;return{coverHeight:e,coverWidth:t}}),[d]),F=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:w,onTextEsc:w,onShiftEnter:C,disabled:l,coverFormat:R,coverAspectFormat:j,coverSizeFormat:_,coverHeight:P,coverWidth:M,blockPropertyValueOverlayStore:c,collectionContextStore:t})),[c,t,P,M,j,R,_,l,r,C,w,i]);return(0,G.jsx)(_l,{collectionContextStore:t,groupsPointer:v,format:r,canDrag:B,onSelectableEnter:C,resultProps:F,resultComponent:Ss,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?Tl.Vertical:Tl.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:k,loadContentCover:R&&"page_content"===R.type,paddingLeft:g,paddingRight:m,headerWidth:S,shouldShowShimmer:h})}const fs=n.memo(hs);var ys=()=>o(62856);function vs(e){const t=e.minHeight||Rs,o=(0,p().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,G.jsx)(so().A,{style:o.card})}function xs(e){const{hasPartialResults:t}=e;if(!(0,ys().A)(!0,0,100))return null;const n=e.coverHeight??o(963575).A.card.desktop.medium.height,r=t?void 0:n+40,i=t?1:3,l=v().Hn(i,(e=>(0,G.jsx)(vs,{minHeight:r},e)));return(0,G.jsx)(G.Fragment,{children:l})}const bs=n.memo((function(e){var t;const{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:s,schema:a,blockPropertyValueOverlayStore:c,isFullScreen:d,collectionGalleryViewStore:g,headerWidth:m,paddingLeft:S,paddingRight:h}=e,f=(0,H().X)("db_ux_chrome"),y=(0,n.useRef)(null),v=(0,n.useRef)(null),[x,b]=(0,n.useState)(!1),C=(0,n.useMemo)((()=>o?[o]:[]),[o]),w=m<=ks,k=(0,u().K8)((()=>s.groupsStore.anyGroupHasResults()),[s]),R=(0,u().K8)((()=>s.groupsStore.getGroupState(C)),[s,C]),{coverHeight:A}=(0,u().O$)(g),{reducerResult:I,hasPartialResults:T}=(0,u().K8)((()=>{const e=null==R?void 0:R.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[R]),j=(0,u().K8)((()=>(0,Sn().iv)({collectionContextStore:s,groupsPointer:C,hasPartialResults:T})),[s,C,T]),_=(0,u().K8)((()=>V().XQ({collectionContextStore:s,reducerResult:I,isFullScreen:d})),[s,I,d]),{canEditContent:B,isSyncedCollection:P}=(0,u().O$)(s.permissionScopesStore),M=(0,u().K8)((()=>r.isSystemBlock()),[r]),F=(0,u().K8)((()=>r.canEdit()&&("collectionTypedView"===s.contextType||B)),[r,s,B]),L=(0,u().O$)(s.isInHomeWidgetStore);(0,n.useEffect)((()=>v.current&&y.current?b(v.current.offsetTop>y.current.offsetTop):b(!1)),[v,y,null==I?void 0:I.blockIds]);const O=(0,p().IS)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,{fontSize:r}=Ji({isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:f});return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${w?"100%":`${V().rq(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...L?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,f,L,w]);if(!R)return null;const E=void 0!==o,D=!L&&k&&!l&&F&&!P&&(T||!j)&&!M,z=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,G.jsxs)("div",{style:O.container,children:[(0,G.jsxs)("div",{style:O.resultsWrapper,children:[(0,G.jsx)(fs,{collectionContextStore:s,groupFormat:o,format:i,schema:a,disabled:l,store:r,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:g,isSingleColumn:w,paddingLeft:S,paddingRight:h,headerWidth:m,shouldShowShimmer:j}),(0,G.jsx)("div",{ref:y,style:{display:"none"}}),j?(0,G.jsx)(xs,{hasGroups:E,hasPartialResults:T,coverHeight:A}):null,D?(0,G.jsx)(al,{ref:v,collectionContextStore:s,groupsPointer:C,groupFormat:o,isSingleColumn:w,isButtonOnOwnRow:x,coverHeight:i.gallery_cover&&A?A:0,hasVisibleProperties:z,isFullScreen:d}):null]}),_?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:O.renderLoadMoreButtonDivider}),(0,G.jsx)(ol().jJ,{groupsPointer:C,store:r,collectionContextStore:s,format:i,isFullScreen:d,incrementLimitsInRelatedGroups:!1,style:O.loadMoreButton,iconStyle:O.loadMoreButtonIcon})]}):null]})})),Cs=n.memo((function(e){const{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,paddingLeft:d,paddingRight:u,isRootChild:g,headerWidth:m,collectionGalleryViewStore:S}=e,h=(0,H().X)("db_ux_chrome"),f=(0,p().DP)(),y=(0,a().v3)(),{isMobile:v}=(0,a().Y0)(),x=(0,n.useCallback)((e=>(0,G.jsx)(ws,{args:e})),[]),b=(0,n.useCallback)((e=>{if(v)No().uK({environment:y,store:e,pageVisitSource:Vo().y8.Create});else{const o="collectionTypedView"===t.contextType;$o().VU({environment:y,store:e,peekMode:V().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:Vo().y8.Create})}}),[t,y,v]),C=(0,n.useCallback)((e=>(0,G.jsx)(bs,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,collectionGalleryViewStore:S,groupFormat:e,headerWidth:m,paddingLeft:d,paddingRight:u})),[o,r,i,t,l,s,c,S,m,d,u]),w=(0,n.useCallback)((e=>h||0===e.index?{}:{borderTop:`1px solid ${f.tableDividerColor}`}),[h,f.tableDividerColor]);return(0,G.jsx)(Ds,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:c,isRootChild:g,paddingLeft:d,paddingRight:u,stickyLeft:!1,renderHeader:x,onGroupHeaderAddItem:b,renderGroup:C,getGroupStyle:w,headerWidth:m})}));function ws(e){let{args:t}=e;const o=(0,u().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,p().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,G.jsx)(ei,{...t,height:o?At().ag:48,stickyStyle:n})}const ks=480,Rs=40;function As(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:s,blockPropertyValueOverlayStore:c,disabled:d,schema:g,paddingBottom:m,paddingLeft:S,paddingRight:h,minWidth:f,headerWidth:y}=e,v=(0,a().v3)(),{isMobile:x}=(0,a().Y0)(),b=(0,n.useRef)(null),C=(0,u().uB)(void 0,Ui);(0,u().O$)(C);const{coverWidth:w,coverHeight:k}=(0,u().O$)(C),R=(0,u().K8)((()=>V().mM(r,i)),[r,i]),A=(0,u().O$)(r.isInHomeWidgetStore),I=(0,u().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),T=(0,n.useCallback)((()=>{if(b.current){const e=b.current.getNode();if(e){const t=e.querySelector(`.${Be().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return V().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),j=(0,n.useCallback)((e=>{C.setState({coverHeight:k,coverWidth:e||T()})}),[C,k,T]),_=(0,n.useCallback)((()=>T()*(9/16)),[T]),B=(0,n.useCallback)((e=>{C.setState({coverWidth:w,coverHeight:e||_()})}),[C,w,_]),P=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<Xe().A.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&(0,Wi().H)({collectionContextStore:r,environment:v,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,v,i]),M=(0,n.useCallback)((()=>{const e=_(),t=T();k!==e&&B(e),w!==t&&j(t)}),[_,T,k,w,B,j]),F=(0,vn().Y)(M,100),L=(0,Hi().d)(M,100);(0,n.useEffect)((()=>{j(T()),B()}),[T,B,j,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,Oe().P4)(window,"resize",L),x&&(0,Oe().P4)(window,"orientationchange",F),()=>{(0,Oe().Ol)(window,"resize",L),x&&(0,Oe().Ol)(window,"orientationchange",F)})),[F,L,x]);const O=(0,p().IS)((()=>({container:{paddingBottom:m,paddingLeft:S,paddingRight:h,minWidth:f}})),[f,m,S,h]),E=o.collection_group_by,D=(0,Re().Zp)();return(0,Ni().A)((e=>(0,G.jsxs)("div",{style:O.container,className:Be().wx0,children:[(0,G.jsx)(gt().Ay,{store:t,shouldShowHalo:!i&&!A&&!l,canSelect:!i&&!I,disablePointerEvents:null==D?void 0:D.disableAllPointerEvents,analyticsName:"gallery",...e,ref:b,children:E?(0,G.jsx)(Cs,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:d,format:o,isFullScreen:i,isRootChild:s,paddingLeft:S,paddingRight:h,headerWidth:y,schema:g,store:t}):(0,G.jsx)(bs,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:d,format:o,groupFormat:void 0,isFullScreen:i,headerWidth:y,schema:g,store:t,paddingLeft:S,paddingRight:h})}),!R&&(0,G.jsx)(Gi().A,{onChange:P})]})))}const Is=n.memo(As);function Ts(e){const{width:t}=e,o=(0,a().v3)(),n=(0,u().K8)((()=>o.WindowSizeStore.state.width<=ks),[o]),r=(0,p().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,G.jsxs)("div",{style:r.container,children:[(0,G.jsxs)("div",{style:r.groupContainer,children:[(0,G.jsx)("div",{style:r.iconContainer,children:Ki(r.icon)}),(0,G.jsx)(so().A,{style:r.groupShimmer})]}),(0,G.jsxs)("div",{style:r.itemsContainer,children:[(0,G.jsx)(vs,{}),(0,G.jsx)(vs,{}),(0,G.jsx)(vs,{})]})]})}function js(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,V().rq)(o),i=v().Hn(n,(e=>(0,G.jsx)(Ts,{width:r},e)));return(0,G.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function _s(){const e=(0,p().IS)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,G.jsxs)("div",{style:e.container,children:[(0,G.jsxs)("div",{style:e.groupContainer,children:[(0,G.jsx)("div",{style:e.iconContainer,children:Ki(e.icon)}),(0,G.jsx)(so().A,{style:e.groupShimmer})]}),(0,G.jsxs)("div",{style:e.rowsContainer,children:[(0,G.jsxs)("div",{style:e.rowContainer,children:[(0,G.jsxs)("div",{style:e.firstColumn,children:[(0,G.jsx)(so().A,{style:e.circleShimmer}),(0,G.jsx)(so().A,{style:e.rowShimmerShort})]}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmerShort})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmerShort})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmerShort})})]}),(0,G.jsxs)("div",{style:e.rowContainer,children:[(0,G.jsxs)("div",{style:e.firstColumn,children:[(0,G.jsx)(so().A,{style:e.circleShimmer}),(0,G.jsx)(so().A,{style:e.rowShimmerLong})]}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})})]}),(0,G.jsxs)("div",{style:e.lastRowContainer,children:[(0,G.jsxs)("div",{style:e.firstColumn,children:[(0,G.jsx)(so().A,{style:e.circleShimmer}),(0,G.jsx)(so().A,{style:e.rowShimmerLong})]}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})}),(0,G.jsx)("div",{style:e.column,children:(0,G.jsx)(so().A,{style:e.rowShimmer})})]})]})]})}function Bs(e){const{isFullScreen:t}=e,o=t?2:1,n=v().Hn(o,(e=>(0,G.jsx)(_s,{},e)));return(0,G.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function Ps(){const e=(0,p().IS)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,G.jsxs)("div",{style:e.rowsContainer,children:[(0,G.jsx)("div",{style:e.rowContainer,children:(0,G.jsx)(so().A,{style:e.rowShimmerShort})}),(0,G.jsx)("div",{style:e.rowContainer,children:(0,G.jsx)(so().A,{style:e.rowShimmer})})]})}var Ms=()=>o(812119);function Fs(){const e=(0,p().IS)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,se().Ks)(),o=(0,u().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,G.jsx)(Ms().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,G.jsxs)("div",{style:e.container,children:[(0,G.jsxs)("div",{style:e.groupContainer,children:[(0,G.jsx)("div",{style:e.iconContainer,children:Ki(e.icon)}),(0,G.jsx)(so().A,{style:e.groupShimmer})]}),(0,G.jsx)("div",{style:e.rowsContainer,children:n})]})}function Vs(e){const{isFullScreen:t}=e,o=t?2:1,n=v().Hn(o,(e=>(0,G.jsx)(Fs,{},e)));return(0,G.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function Ls(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,ys().A)(!0,0,100))return null;switch(t){case"table":return(0,G.jsx)(Bs,{isFullScreen:o});case"list":return(0,G.jsx)(Vs,{isFullScreen:o});case"gallery":return(0,G.jsx)(js,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,G.jsx)(Ps,{});default:return null}}const Os=new Set(["dropzone","table"]),Es=new Set(["item","table"]),Ds=n.memo((function(e){const{collectionContextStore:t,timelineProps:r,headerWidth:i}=e,l=(0,a().v3)(),s=(0,a().Y0)().isMobile,c=(0,H().X)("collection_group_reducer_visible"),d=(0,u().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),p=(0,u().O$)(t.permissionScopesStore),g=(0,u().O$)(t.normalizedFormatStore),m=null==g?void 0:g.collection_group_by,S=null==g?void 0:g.board_columns_by,h=(0,u().O$)(t.groupsLimitStore),f=(0,u().O$)(t.normalizedSchemaStore),y=(0,u().K8)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),v=(0,u().K8)((()=>{if(c&&"board"===d&&m&&S)return;if(!m||!g)return;if(null!=r&&r.type&&Os.has(null==r?void 0:r.type))return;const e=(0,Tn().m)({collectionContextStore:t,isMobile:s,groupBy:m});return(0,Tn().p)({groupBy:m,schema:f,format:g,groupsFormatKey:Lo().V1,limit:h,aggregation:g.collection_group_aggregation,blockResults:e})}),[c,d,m,S,g,null==r?void 0:r.type,t,s,f,h]),x=(0,u().uB)(e.groupsResultStore,Mn),b=(0,u().O$)(x),C=(0,u().uB)(null==r?void 0:r.hiddenGroupsVisibleStore,Bn),w=(0,u().O$)(C),[k,R]=(0,jn().d)({collectionContextStore:t,groupBy:m,groupsFormatKey:Lo().V1,reducerResult:b,groupsLimit:h}),[A]=(0,jn().d)({collectionContextStore:t,groupBy:S,groupsFormatKey:"board_columns",reducerResult:b,groupsLimit:h}),[I]=(0,jn().d)({collectionContextStore:t,groupBy:"board"===d?void 0:m,subGroupBy:"board"===d?m:void 0,groupsFormatKey:Lo().V1,reducerResult:b,groupsLimit:h}),T=c?I:k,j=n.useCallback((()=>{Ho({environment:l,groupsFormatKey:Lo().V1,collectionContextStore:t,currentGroups:R.state.currentGroups})}),[t,l,R]),_=(0,vn().U)(j,5e3);(0,n.useEffect)((()=>{if(null==r||!r.type||!Os.has(null==r?void 0:r.type))return R.addListener(_),()=>{R.removeListener(_),_.cancel()}}),[R,_,r]);const B=(0,u().K8)((()=>R.state.hiddenGroups.slice(0,Do().RP)),[R]),P=(0,u().K8)((()=>!((null==r?void 0:r.type)&&Es.has(null==r?void 0:r.type))&&(0,Sn().c_)({collectionContextStore:t,displayState:T})),[t,T,r]),M=(0,u().K8)((()=>{const{visibleGroups:e}=T;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,T]),F=(0,u().K8)((()=>(0,Do().Zl)(T,e.collectionContextStore,!1)),[T,e.collectionContextStore]),V=(0,u().K8)((()=>!e.disabled&&!p.isLocked&&p.canConfigureBlock&&!P&&m&&(0,Lo().pP)(m,p.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,o(443239).u)(m.property)&&M),[M,t,p.canConfigureBlock,p.canConfigureCollection,p.isLocked,e.disabled,m,P]),L=(0,u().K8)((()=>zo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),O=(0,H().X)("db_ux_empty_states"),E="board"===d||"dropzone"===(null==r?void 0:r.type)||"item"===(null==r?void 0:r.type);if(!g)return null;const D=!E&&!P&&"v2"===T.version&&0===T.visibleGroups.length&&0===T.pinnedGroups.groups.length&&O?(0,G.jsx)(Oi,{collectionContextStore:t,paddingLeft:e.paddingLeft,paddingRight:e.paddingRight,headerWidth:i}):(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)(zs,{groups:T.visibleGroups,groupBy:m,groupsDisplayState:T,groupsResultStore:x,format:g,schema:f,query:y,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem}),P&&(0,G.jsx)(Ls,{viewType:d,isFullScreen:e.isFullScreen,galleryCoverSize:g.gallery_cover_size}),c?(0,G.jsxs)("div",{style:{display:"flex",flexDirection:Boolean(null==r?void 0:r.type)?"column":"row",marginTop:"board"===d?-12:void 0,marginBottom:8},children:[F&&(0,G.jsx)(Ks,{timelineType:null==r?void 0:r.type,collectionContextStore:e.collectionContextStore,schema:f,format:g,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),V&&(0,G.jsx)(Hs,{timelineType:null==r?void 0:r.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:f,format:g,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:m})]}):(0,G.jsxs)(G.Fragment,{children:[F&&(0,G.jsx)(Ks,{timelineType:null==r?void 0:r.type,collectionContextStore:e.collectionContextStore,schema:f,format:g,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),B.length>0&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(Ws,{reducerId:e.reducerId,timelineType:null==r?void 0:r.type,format:g,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:A,hiddenGroups:B,hiddenGroupsVisibleStore:C}),w&&(0,G.jsx)(zs,{groups:B,groupBy:m,groupsDisplayState:T,groupsResultStore:x,format:g,schema:f,query:y,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem})]}),V&&(0,G.jsx)(Hs,{timelineType:null==r?void 0:r.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:f,format:g,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:m})]})]});return v?(0,G.jsx)(In().A,{id:e.reducerId,reducer:v,collectionContextStore:e.collectionContextStore,resultStore:x,render:()=>D,debounceWait:L}):D}),Qo().A),zs=n.memo((function(e){const{groups:t,groupBy:o,groupsDisplayState:n,groupsResultStore:r,format:i,schema:l,query:s,collectionContextStore:a,disabled:c,isFullScreen:d,isRootChild:p,paddingLeft:g,stickyLeft:m,renderGroup:S,getGroupStyle:h,renderHeader:f,onGroupHeaderAddItem:y}=e,v=(0,u().O$)(a.isInPeekRendererStore);return(0,G.jsx)(G.Fragment,{children:t.map(((e,u)=>o?(0,G.jsx)(mi,{collectionContextStore:a,groupsDisplayState:n,groupFormat:e,groupBy:o,groupsResultStore:r,disabled:c,groupsFormatKey:Lo().V1,groupAggregationKey:Lo().FJ,format:i,schema:l,query:s,isInPeekRenderer:v,isFullScreen:d,isRootChild:p,paddingLeft:g,stickyLeft:m,renderGroup:S,renderHeader:f,onGroupHeaderAddItem:y,getGroupStyle:h,index:u,isLast:u===t.length-1},(0,Lo().Ix)(e)):null))})}));function Ks(e){return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,G.jsx)(Ii,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,G.jsx)("div",{style:{display:"flex"},children:(0,G.jsx)(fn,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function Hs(e){const t=(0,a().v3)(),o=(0,u().K8)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&An({update:e,collectionContextStore:o,groupsFormatKey:Lo().V1,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,G.jsx)(Ri,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,G.jsx)(pn,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function Ws(e){return"board_collection_groups"===e.reducerId?(0,G.jsx)(ki,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,G.jsx)(Ai,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:Ci}}):(0,G.jsx)("div",{style:{display:"flex"},children:(0,G.jsx)(wi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:Ci,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}var Gs=()=>o(439264);const Ns=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i,disabled:l}=e;const s=(0,a().v3)(),c=(0,u().K8)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===c?null:(0,G.jsx)(pn,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e){const{update:t,collectionContextStore:o,schema:n,format:r,environment:i}=e,l=o.collectionStore();if(!l)return;const s=r.board_columns_by;if(!s)return;An({update:t,collectionContextStore:o,groupsFormatKey:"board_columns",collectionStore:l,schema:n,groupBy:s,environment:i})}({update:e,collectionContextStore:n,schema:o,format:t,environment:s}),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));const $s=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,G.jsx)(In().A,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,G.jsx)(G.Fragment,{children:t()})}));var Us=()=>o(920188);const Xs=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,s=(0,u().O$)(t.permissionScopesStore),a=t.settingsStore,c=(0,n.useCallback)((()=>{C().Ow({collectionContextStore:t,collectionSettingsStore:a}),C().a2({collectionSettingsStore:a,item:{type:"properties",timelineViewTab:"table"}})}),[t,a]);return(0,G.jsx)(Us().Ay,{title:(0,G.jsx)(vt().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,G.jsx)(vt().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,G.jsx)(Us().P6,{onClick:c,children:e})}}):(0,G.jsx)(vt().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function qs(e,t){(0,_().v)(e,"board_item_delete_newly_created",t)}function Ys(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:s,from:a,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,En().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:s,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:a},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,g=u.newStore;if(n.device.isMobile)No().uK({environment:n,store:g,pageVisitSource:Vo().y8.Create});else if(p){const e=g.getBlockTitleStore();A().hc({environment:n,store:g}),I().setSelectionAtEnd({store:e}),(0,cl().C)({store:g,transient:c})}else{const e="collectionTypedView"===r.contextType;$o().VU({environment:n,store:g,peekMode:(0,V().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:Vo().y8.Create})}On().v(n,{from:a,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,Me().sl)(r)})}var Qs=()=>o(751735);const Zs=n.memo((function(e){const{collectionContextStore:t,color:o,groupsPointer:r,isFullScreen:i,shouldShowSpinner:l}=e,s=(0,a().v3)(),c=(0,H().X)("db_ux_chrome"),d=(0,p().IS)((e=>{const t=o||e.text.tertiary,{fontSize:n}=Ji({isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:c});return{addItemButton:{width:"100%",color:t,borderRadius:en,boxShadow:Js({theme:e,isDBUXChromeEnabled:c,color:o}),...c?{paddingLeft:as().w_,paddingRight:as().w_}:{padding:"12px 16px 12px 16px"},minHeight:(0,V().rU)({isMobile:Boolean(ke().A.isMobile)}),fontSize:n},plusIcon:{width:Boolean(ke().A.isMobile)?20:16,height:Boolean(ke().A.isMobile)?20:16,fill:t,marginLeft:2,marginRight:9},spinner:{margin:"0 0 0 auto"}}}),[o,c]),u=(0,n.useCallback)((()=>{(0,nt().EF)(s)?T().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:s,canUndo:!0,perform:e=>{Ys({transaction:e,environment:s,collectionContextStore:t,isFullScreen:i,groupsPointer:r,from:"board_group_add_item_bottom",transient:!1})}}):(0,nt().QY)(s)}),[t,s,r,i]);return(0,G.jsxs)(ln().p,{iconLeading:qo().plusSmallIcon,iconStyle:d.plusIcon,isLightGray:!0,size:"lg",style:d.addItemButton,onClick:u,onMouseDown:Oe().tr,children:[(0,G.jsx)(il().w,{collectionContextStore:t}),l?(0,G.jsx)("div",{style:d.spinner,children:(0,G.jsx)(hn().A,{size:"sm"})}):null]})}));function Js(e){const{theme:t,isDBUXChromeEnabled:o,color:n}=e,r=function(e,t){if(void 0===e)return"";try{return(0,Qs().X4)(e,t)}catch(o){return""}}(n,.1);return o&&""!==r?`${r} 0px 0px 0px 1px`:"dark"===t.mode?`${ur().Ay.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${t.regularDividerColor} 0px 0px 0px 1px`}const ea=n.memo((function(e){const{color:t,collectionContextStore:o,groupFormat:r,isHovered:i}=e,l=(0,H().X)("db_ux_chrome"),s=(0,p().IS)((e=>{const o=t||e.text.tertiary,{fontSize:n}=Ji({isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:l});return{linkButton:{visibility:i?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:en,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,l,i]),a=(0,n.useCallback)((e=>(0,G.jsx)(ln().p,{iconLeading:nl().arrowDiagonalUpRightIcon,iconStyle:s.icon,isLightGray:!0,size:"lg",style:s.linkButton,...e,children:(0,G.jsx)(vt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})),[s.icon,s.linkButton]);return(0,G.jsx)(Pi().O,{collectionContextStore:o,groupFormat:r,renderLinkButton:a})})),ta=n.memo((function(e){const{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:s,coverSizeFormat:a,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:g,hideContent:m,isFirstItem:S,isLastItem:h,isQuickFind:f,numberedListCounterStore:y,onShiftEnter:v,onTextEnter:x,onTextEsc:b,store:C,style:w}=e;return(0,G.jsx)(ps,{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:s,coverHeight:void 0,coverSizeFormat:a,coverWidth:void 0,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:g,hideContent:m,isFirstItem:S,isLastItem:h,isQuickFind:f,numberedListCounterStore:y,onShiftEnter:v,onTextEnter:x,onTextEsc:b,store:C,style:w})}),Qo().A);function oa(e){const t=e.minHeight||Rs,o=(0,p().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:en,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,G.jsx)(so().A,{style:o.card})}function na(){return(0,ys().A)(!0,0,100)?(0,G.jsx)(oa,{}):null}const ra=n.memo((function(e){const{groupsPointer:t,schema:o,format:r,collectionContextStore:i,store:s,disabled:c,blockPropertyValueOverlayStore:d,isFullScreen:g,anyGroupHasResults:m,hoveredGroupStore:S,paddingLeft:h,paddingRight:f,headerWidth:y}=e,x=(0,p().DP)(),b=(0,a().v3)(),{isMobile:C}=(0,a().Y0)(),w=(0,H().X)("db_ux_chrome"),k=(0,vt().tz)(),A=(0,u().K8)((()=>{const e=t.at(-1);return(0,Do().$e)({environment:b,groupFormat:e,schema:o,format:r,theme:x})}),[t,o,r,b,x]),I=(0,u().K8)((()=>{const e=i.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,i]),j=(0,u().K8)((()=>i.groupsStore.getGroupState(t)),[i,t]),_=(0,u().K8)((()=>(0,V().mM)(i,g)),[i,g]),B=(0,u().K8)((()=>null==j?void 0:j.reducerResultStore.state),[j]),P=(0,u().O$)(i.permissionScopesStore),M=(0,u().O$)(i.isInHomeWidgetStore),F=(0,u().K8)((()=>!c&&I&&i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!M})),[c,I,i,M]),L=(0,u().K8)((()=>(0,V().XQ)({reducerResult:B,collectionContextStore:i,isFullScreen:g})),[B,i,g]),O=(0,u().K8)((()=>(0,Sn().iv)({collectionContextStore:i,groupsPointer:t,hasPartialResults:m})),[i,t,m]),E=(0,u().K8)((()=>m&&i.shouldShowSpinnerStore.state&&"load_general"===i.loadingDetailsStore.state.type),[i,m]),D=(0,u().K8)((()=>(0,V().fG)({collectionContextStore:i,environment:b,intl:k})),[b,i,k]),z=(0,u().K8)((()=>ke().A.isMobile||(0,Lo().Mn)(S.state,t.at(-1))),[S,t]),K=(0,n.useCallback)((e=>{const{target:t}=e;!C&&t instanceof HTMLElement&&(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:b,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[b,C]),W=(0,n.useCallback)((()=>{const e=t.at(-1);e&&S.state!==e&&S.setState(e)}),[t,S]),N=on(w),$=(0,p().IS)((()=>{const e=Boolean(r.collection_group_by),t=Jo(w);return{container:{flex:"none",paddingLeft:N,paddingRight:N,paddingBottom:N,marginRight:2*t,marginBottom:16,boxSizing:"content-box",width:sa(r),height:e?void 0:"max-content",...A&&I&&{backgroundColor:A.backgroundColor,...e?{borderRadius:en}:{borderBottomLeftRadius:en,borderBottomRightRadius:en}}},loadMoreButton:{borderRadius:en,fontSize:ke().A.isMobile?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:ke().A.isMobile?16:14,height:ke().A.isMobile?16:14}}}),[N,A,r,w,I]);if(!j)return null;const U=function(e){return e?e.board_cover:void 0}(r),X=!c&&!P.isSyncedCollection,q=Boolean(r.collection_group_by),Y=!m&&q&&O;return(0,G.jsxs)("div",{className:Be().mVR,style:$.container,onMouseDown:K,onClick:ca,onMouseMove:W,children:[(0,G.jsx)(_l,{collectionContextStore:i,groupsPointer:t,format:r,canDrag:X,paddingLeft:h,paddingRight:f,headerWidth:y,shouldShowShimmer:Y,onSelectableEnter:e=>da(e,t,i,g,b),resultProps:{format:r,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,nt().EF)(i)||!o.collectionStore())return ua(e,o,r,t,i);const l=aa(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))+1;T().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{Ys({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}})}(e,t,i,g,s,b),onShiftEnter:e=>da(e,t,i,g,b),coverFormat:U,coverAspectFormat:ia(r),coverSizeFormat:la(r),colorStyle:A,onTextEsc:e=>ua(e,i,s,t,b),disabled:c,blockPropertyValueOverlayStore:d,collectionContextStore:i},canDrop:!0,resultComponent:ta,disabled:c,direction:Tl.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:q?N:3,analyticsName:"board",loadContentCover:U&&"page_content"===U.type}),Y?(0,G.jsx)(na,{}):null,L?(0,G.jsx)(ol().jJ,{groupsPointer:t,store:s,collectionContextStore:i,format:r,isFullScreen:g,incrementLimitsInRelatedGroups:!0,style:$.loadMoreButton,iconStyle:$.loadMoreButtonIcon}):null,F&&(0,G.jsxs)(G.Fragment,{children:[L&&(0,G.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${x.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,G.jsx)(Zs,{groupsPointer:t,collectionContextStore:i,isFullScreen:g,color:null==A?void 0:A.textColor,shouldShowSpinner:E})]}),D&&(0,G.jsx)(ea,{groupFormat:v().HV(t),collectionContextStore:i,color:null==A?void 0:A.textColor,isHovered:z}),!_&&(0,G.jsx)(Gi().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),s=null==l?void 0:l.reducerResultStore.state;e<Xe().A.incrementScrollOffset&&!i&&s&&s.hasMore&&((0,Wi().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,i,g,t,b)})]})}));function ia(e){return e?e.board_cover_aspect:void 0}function la(e){return e?e.board_cover_size:void 0}function sa(e){const t=e.board_cover_size;return(0,V().rq)(t)}function aa(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function ca(e){(0,l().SQ)({event:e,context:l().y$.Click,callback:()=>{}})}function da(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const s=i[0];if(!(0,nt().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=aa(t,o);if(!a)return;Ys({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===s))+1,from:"board_group_enter_add_item",transient:!0})}function ua(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if((0,y().q4_)(l.getValue()))A().Lt({environment:r,store:e});else if(i){const i=aa(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),a=t.collectionViewBlockStore();if(s&&a&&qs(r,{...(0,Me().sl)(t),block_id:o.id}),T().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{Ct().by({childStore:e,transaction:t})}}),l>=0){const e=i.state[l];A().Lt({environment:r,store:e})}}}function pa(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r,disableBoardColorColumns:i,isInHomeWidget:l}=e,{isMobile:s}=(0,a().Y0)(),c=e.numBoardColumns||3,d=(0,H().X)("db_ux_chrome"),u=(0,p().IS)((e=>{const t=on(d),a=(0,V().rq)(o)+2*t;return{container:{display:"flex",alignItems:"flex-start",paddingTop:hi({disableBoardColorColumns:i,isMobile:s,isInHomeWidget:l,isDBUXChromeEnabled:d})},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginRight:10,width:"100%",minWidth:a}}}),[r,o,i,d,l,s,n]);return(0,G.jsx)("div",{style:u.container,children:Array.from({length:c},((e,o)=>(0,G.jsxs)("div",{style:u.group,children:[(0,G.jsx)(so().A,{style:u.groupHeader}),(0,G.jsx)(oa,{minHeight:t})]},o)))})}var ga=()=>o(607517);const ma=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,s=(0,a().v3)(),{isMobile:c}=(0,a().Y0)(),d=c?{menuType:yr().gu.Modal,title:(0,G.jsx)(vt().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:o.close}:{menuType:yr().gu.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let s=0,a=0;const c=function(e,t,o,n,r){const i={};for(const s of _r().VD)i[s]=va(e.aggregator===s,e.enforceMaxAggregationLimit??!1,s,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,_r().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const s of _r().CG)"show_unique"!==s&&(i[s]=ya(e,s,l,t,r,o,n));return ha.forEach((l=>{let{supportCheck:s,aggregationTypes:a}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&s(t)}));if(c.length>0)for(const d of a)i[d]=ya(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(_r().Kn).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(s=d,a=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,G.jsx)(wr().A,{...e}),items:[fa(e,o)]}),p.push({key:"aggregations",render:e=>(0,G.jsx)(wr().A,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=Pr().jA[n],t={key:e,render:(t,o)=>(0,G.jsx)(Er().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,G.jsx)(Or().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:yr().gu.Modal,title:e,right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:yr().gu.Popup,width:250,...t},(0,G.jsx)(xr().A,{...r,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:a,sections:p,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:s}}(t,s,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,G.jsx)(wr().A,{...e}),items:e}],initialFocus:o}}),[i,s,r,l,t]);return(0,G.jsx)(xr().A,{...d,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),Sa=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=Pr().cx[t],s=(0,p().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),a=(0,n.useCallback)((e=>(0,G.jsx)(Or().A,{title:r,isChecked:o,...(0,rn().A)(e,i)})),[o,i,r]),c=(0,n.useCallback)((()=>(0,G.jsxs)("div",{style:s.container,children:[l&&(0,G.jsx)("img",{src:(0,Br().L)(l),style:s.image}),Pr().fp[t]]})),[l,s.container,s.image,t]);return(0,G.jsx)(Ft().A,{placement:$e().W.Right,delayThreshold:0,render:a,renderTooltip:c})}));const ha=[{supportCheck:_r().OC,aggregationTypes:_r().Sn},{supportCheck:_r().fo,aggregationTypes:_r().zE},{supportCheck:_r().s_,aggregationTypes:_r().QO}];function fa(e,t){const{enforceMaxAggregationLimit:o,disabled:n}=(0,Pr().NT)(e),r={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,G.jsx)(Vr().A,{on:o,disabled:n,menuListItemProps:e}),action:()=>{t(r)}}}function ya(e,t,o,n,r,i,l){const{device:s}=n,a=Pr().zY[t],c=v().oE(o.map((o=>function(e,t,o,n,r,i,l,s){const a=r[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,G.jsx)(Sa,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{xa({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,_r().AS)(t))&&e.enforceMaxAggregationLimit,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,G.jsx)(Er().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,G.jsx)(Or().A,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:yr().gu.Modal,title:a,right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:yr().gu.Popup,width:200,...e},(0,G.jsx)(xr().A,{...n,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,G.jsx)(wr().A,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function va(e,t,o,n,r,i){const l=Pr().zY[o];return{key:o,render:t=>(0,G.jsx)(Sa,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{xa({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function xa(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,b().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const ba=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,groupsResultStore:i,collectionContextStore:l,disabled:s,color:c,onChange:d}=e,{isMobile:g}=(0,a().Y0)(),m=(0,H().X)("collection_group_reducer_visible"),S=!(0,u().O$)(qe().e),h=(0,p().IS)((e=>({button:{fontWeight:Fo().Wy.regular,color:c||e.text.tertiary,padding:"0 6px",minHeight:20,minWidth:20,borderRadius:4,height:void 0,lineHeight:void 0}})),[c]),f=(0,n.useCallback)((()=>(0,G.jsx)(Ca,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),y=(0,n.useCallback)((e=>(0,G.jsx)(sn().Ay,{popupType:g?sn().z7.BottomSheet:sn().z7.Popup,renderOrigin:n=>(0,G.jsx)(ln().p,{disabled:s,style:h.button,...(0,rn().A)(e,n),children:m?(0,G.jsx)(ka,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r,groupsResultStore:i}):(0,G.jsx)(wa,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r})}),disabled:s,render:e=>(0,G.jsx)(ma,{parent:e,selectedAggregation:t,onChange:d,collectionContextStore:l,schema:o})})),[g,s,h.button,m,o,t,l,r,i,d]);return S?null:(0,G.jsx)(Ft().A,{renderTooltip:f,render:y})}));function Ca(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,u().K8)((()=>!!Boolean(t)&&Mr(n,t)),[n,t]);if(t){const e=Pr().zY[(0,_r().V1)(t)];if((0,_r().G9)(t)){const n=o[t.property];if(n){const t=n.name;return(0,G.jsx)(G.Fragment,{children:Tt().A.formatMessage(Lr.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,G.jsx)(G.Fragment,{children:Tt().A.formatMessage(Lr.aggregationType,{aggregationType:e,calculating:r})})}return(0,G.jsx)(vt().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function wa(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,u().K8)((()=>({type:"aggregation",filter:(0,Qn().Yy)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,zn().P)(),experimentService:zo().default}),aggregation:o})),[r,o,t,i]),{numberFormat:s,numberPrecision:a}=(0,n.useMemo)((()=>{if(!(0,_r().G9)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,_r().FM)(o)?n:void 0}}return{}}),[o,t]),c=(0,n.useMemo)((()=>{if(!(0,_r().G9)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),d=(0,n.useCallback)((e=>{const t=e.state;return(0,G.jsx)(Fr,{aggregation:o,collectionContextStore:r,children:t?(0,Pr().rv)({numberFormat:s,dateFormat:c,aggregation:o,userTimeZone:(0,zn().P)(),value:t.aggregationResult,numberPrecision:a}):"-"})}),[o,r,c,s,a]);return l?(0,G.jsx)(In().A,{id:`board:${(0,Lo().Ix)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:d}):null}function ka(e){const t=(0,u().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Lo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,_r().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,G.jsx)(Fr,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Pr().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,zn().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}const Ra=n.memo((function(e){const{hoveredGroupStore:t,groupFormat:o,schema:r,format:i,groupsResultStore:l,collectionContextStore:s,disabled:c,hidden:d,isPopup:g,query:m,currentGroups:S,isFullScreen:h}=e,f=(0,p().DP)(),y=(0,H().X)("db_ux_chrome"),v=(0,a().v3)(),x=(0,vt().tz)(),b=(0,Re().Zp)(),C=(0,u().K8)((()=>!!ke().A.isMobile||(0,Lo().Mn)(t.state,o)),[t,o]),w=(0,u().K8)((()=>(0,Do().$e)({environment:v,groupFormat:o,schema:r,format:i,theme:f})),[o,r,i,v,f]),k=(0,u().O$)(s.permissionScopesStore),R=(0,n.useMemo)((()=>{if((0,Lo().D1)(o.value)&&(0,Lo().WO)(o.value.value))return new(me().Bv)(v,o.value.value)}),[v,o.value]),A=(0,u().K8)((()=>Boolean((null==R?void 0:R.isReady())&&!(null!=R&&R.canRead()))),[R]),I=(0,u().K8)((()=>s.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!A),[s,A]),T=(0,u().K8)((()=>(0,V().fG)({collectionContextStore:s,environment:v,intl:x})),[s,v,x]),j=(0,u().K8)((()=>{const e=s.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==b||!b.isPreviewing)&&(m.aggregations&&m.aggregations.length>0)}),[s,m,b]),_=(0,n.useCallback)((()=>{t.state!==o&&t.setState(o)}),[o,t]),B=(0,p().IS)((()=>{const e=Si(i),t=Boolean(i.collection_group_by),o=Jo(y),n=on(y);return{container:{display:"flex",alignItems:"center",fontSize:14,width:e,paddingLeft:n,paddingRight:n,marginRight:2*o,marginBottom:d?4:0,boxSizing:"content-box",flexShrink:0,...g&&{padding:ke().A.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:e},...w&&!d&&{backgroundColor:w.backgroundColor,...t?{borderRadius:en}:{borderTopLeftRadius:en,borderTopRightRadius:en}}},spacer:{flexGrow:1}}}),[w,i,d,y,g]);return(0,G.jsxs)("div",{style:B.container,onMouseMove:_,children:[(0,G.jsx)(Aa,{boardGroupHeaderProps:e}),j?(0,G.jsx)(Ia,{groupsResultStore:l,disabled:c,query:m,schema:r,collectionContextStore:s,groupFormat:o,hidden:d,boardSelectStyle:w}):null,(0,G.jsx)("div",{style:B.spacer}),!c&&k.canConfigureBlock?(0,G.jsx)(Ta,{hidden:d,groupFormat:o,currentGroups:S,format:i,schema:r,query:m,collectionContextStore:s,boardSelectStyle:w,isHovered:C}):null,I?(0,G.jsx)(ja,{format:i,groupFormat:o,collectionContextStore:s,isFullScreen:h,hidden:d,isHovered:C,boardSelectStyle:w}):null,T?(0,G.jsx)(_a,{groupFormat:o,collectionContextStore:s,hidden:d,isHovered:C,boardSelectStyle:w}):null]})}));function Aa(e){const{boardGroupHeaderProps:t}=e,{groupFormat:o,schema:r,disabled:i,currentGroups:l,format:s,groupBy:c,collectionContextStore:d}=t,g=(0,a().v3)(),m=(0,u().O$)(d.permissionScopesStore),S=(0,u().K8)((()=>d.groupsStore.getGroupState(o)),[d,o]),h=(0,n.useCallback)((e=>{const o=d.collectionStore();o&&(lr({...e,environment:g,groupsFormatKey:"board_columns",collectionStore:o,...t}),(0,b().X)({environment:g,collectionContextStore:d,action:"rename_group"}))}),[t,d,g]),f=(0,p().IS)((()=>({container:{maxWidth:Si(s)-70}})),[s]);return S?(0,G.jsx)(Yr().d,{collectionContextStore:d,groupBy:c,groupFormat:o,currentGroups:l,schema:r,disabled:i||!m.canConfigureBlock,isHiddenGroup:!1,onChange:h,style:f.container,source:"board_group_header"}):null}function Ia(e){const{disabled:t,query:o,schema:r,collectionContextStore:i,groupFormat:l,hidden:s,boardSelectStyle:c,groupsResultStore:d}=e,g=(0,a().v3)(),m=(0,u().O$)(i.permissionScopesStore),S=(0,n.useCallback)((e=>{const t=i.collectionViewStore();if(!t)return;const n=e?[e]:[],r={...o,aggregations:n};T().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:g,canUndo:!0,perform:e=>{(0,hr().F)({collectionViewStore:t,update:{query2:r},transaction:e})}})}),[i,g,o]),h=(0,p().IS)((e=>({container:{color:Ba({theme:e,hidden:s,boardSelectStyle:c})}})),[s,c]),f=o.aggregations?o.aggregations[0]:void 0;return f?(0,G.jsx)(ba,{groupFormat:l,groupsResultStore:d,disabled:t||!m.canConfigureBlock,aggregation:f,schema:r,collectionContextStore:i,color:h.container.color,onChange:S}):null}function Ta(e){const{hidden:t,groupFormat:o,currentGroups:r,format:i,schema:l,query:s,collectionContextStore:a,boardSelectStyle:c,isHovered:d}=e,u=(0,vt().tz)(),g=(0,p().IS)((e=>{const o=Ba({theme:e,hidden:t,boardSelectStyle:c});return{button:Pa({hidden:t,isHovered:d}),icon:{width:Po().Ev.sm,height:Po().Ev.sm,fill:o}}}),[t,c,d]),m=(0,n.useCallback)((e=>(0,G.jsx)(Mt().A,{style:g.button,icon:mn().Y,iconStyle:g.icon,ariaLabel:u.formatMessage({defaultMessage:"More group options",id:"database.boardGroupHeader.actions.moreGroupOptions.tooltip"}),...e})),[u,g.button,g.icon]),S=(0,n.useCallback)((e=>(0,G.jsx)(Ar,{parent:e,groupFormat:o,currentGroups:r,format:i,query:s,schema:l,collectionContextStore:a,groupsFormatKey:"board_columns",groupsLimitStore:a.boardColumnsLimitStore})),[a,i,o,r,l,s]);return(0,G.jsx)(sn().Ay,{popupType:ke().A.isMobile?sn().z7.BottomSheet:sn().z7.Popup,renderOrigin:m,render:S})}function ja(e){const{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:s,boardSelectStyle:c}=e,d=(0,a().v3)(),{isMobile:g}=(0,a().Y0)(),m=(0,vt().tz)(),S=(0,n.useContext)(ll().n),h=(0,n.useCallback)((()=>{if(!(0,nt().EF)(d))return;const e="collectionTypedView"===r.contextType,n=Boolean(t.collection_group_by);r.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const l=r.groupsStore.getGroupState(o);if(!l)return;const s=l.resultsStore;T().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:d,canUndo:!0,perform:t=>{const i=(0,En().Q)({environment:d,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:d.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=i.coercionSucceeded,a=i.newStore;if(g){!function(e,t,o){o?o(e):rl().oo({environment:t,url:e})}((0,sl().Ay)({store:a,pageVisitSource:Vo().y8.Create}),d,S)}else if(l&&!n){const e=a.getBlockTitleStore();A().hc({environment:d,store:a}),I().setSelectionAtEnd({store:e}),(0,cl().C)({store:a})}else $o().VU({environment:d,store:a,peekMode:(0,V().hH)(r),showMoveTo:e,resultsStore:s,collectionContextStore:r,pageVisitSource:Vo().y8.Create});On().v(d,{from:"board_group_add_item_top",type:"page",new_page_id:a.id,creating_block_id:a.id,...(0,Me().sl)(r)})}})}),[d,r,t.collection_group_by,o,i,g,S]),f=(0,u().K8)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),y=(0,n.useMemo)((()=>{const e=(0,Bi().$O)(f);return m.formatMessage({defaultMessage:"New {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:e})}),[f,m]),v=(0,p().IS)((e=>{const t=Ba({theme:e,hidden:l,boardSelectStyle:c});return{button:Pa({hidden:l,isHovered:s}),icon:{width:Po().Ev.sm,height:Po().Ev.sm,fill:t}}}),[c,l,s]),x=(0,n.useCallback)((()=>y),[y]),b=(0,n.useCallback)((e=>(0,G.jsx)(Mt().A,{icon:qo().plusSmallIcon,onClick:h,style:v.button,iconStyle:v.icon,ariaLabel:y,...e})),[h,y,v.button,v.icon]);return(0,G.jsx)(Ft().A,{renderTooltip:x,render:b})}function _a(e){const{groupFormat:t,collectionContextStore:o,hidden:r,isHovered:i,boardSelectStyle:l}=e,s=(0,vt().tz)(),a=(0,u().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),c=(0,n.useMemo)((()=>{const e=(0,Bi().$O)(a);return s.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:e})}),[a,s]),d=(0,p().IS)((e=>{const t=Ba({theme:e,hidden:r,boardSelectStyle:l});return{button:Pa({hidden:r,isHovered:i}),icon:{width:Po().Ev.sm,height:Po().Ev.sm,fill:t}}}),[l,r,i]),g=(0,n.useCallback)((()=>c),[c]),m=(0,n.useCallback)(((e,t)=>(0,G.jsx)(Mt().A,{icon:Ti().arrowDiagonalUpRightSmallIcon,style:d.button,iconStyle:d.icon,...e,...t,ariaLabel:c})),[c,d.button,d.icon]);return(0,G.jsx)(Pi().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,G.jsx)(Ft().A,{renderTooltip:g,render:t=>m(t,e)})})}function Ba(e){const{theme:t,hidden:o,boardSelectStyle:n}=e;return!o&&n?n.textColor:t.text.tertiary}function Pa(e){const{hidden:t,isHovered:o}=e;return t?{}:{transition:"opacity 100ms ease-in-out",opacity:o?1:0}}const Ma=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,groupsResultStore:r,currentGroups:i,disableBoardColorColumns:l,disabled:s,format:c,headerPlaceholderHeight:d,hiddenGroups:g,hiddenGroupsHeaderRef:m,hoveredGroupStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y,paddingLeft:v,paddingRight:x,query:b,schema:C,store:w,visibleGroups:k,shouldShowShimmer:R}=e,A=(0,a().v3)(),I=(0,a().Y0)(),T=(0,n.useRef)(null),j=(0,H().X)("collection_group_reducer_visible"),_=(0,H().X)("db_ux_chrome"),B=(0,u().O$)(t.shouldShowSpinnerStore),P=(0,u().O$)(t.permissionScopesStore),M=(0,u().K8)((()=>(0,Do().K3)({device:I,isFullScreen:h,isRootChild:y})),[I,h,y]),F=(0,u().O$)(t.isInHomeWidgetStore),L=(0,V().Oz)(t),O=(0,p().IS)((e=>{const t=F?"transparent":(null==L?void 0:L.background)||(f?e.cardContentBackground:e.contentBackground),o=hi({disableBoardColorColumns:l,isInHomeWidget:F,isMobile:I.isMobile,isDBUXChromeEnabled:_});return{header:{position:"absolute",background:t,height:nn+o,paddingTop:o,zIndex:85,display:"flex",boxShadow:`-3px 0 0 ${t}`,minWidth:"100%"},stickyHeader:{paddingLeft:v,paddingRight:x},stickyHeaderTransition:{paddingLeft:v},hiddenGroupsTitle:{display:"flex",alignItems:"center",width:220,flexShrink:0,fontSize:14,color:e.text.tertiary,marginLeft:20},spacer:{height:"calc(100% + 17px)",...F?{}:{background:f?e.cardContentBackground:e.contentBackground},width:20,marginLeft:-20,marginTop:-17}}}),[null==L?void 0:L.background,I.isMobile,l,_,F,f,v,x]),E=(0,u().K8)((()=>{const e=t.normalizedFormatStore.state.board_columns_by;if(!e)return!1;const o=(0,Lo().Nf)(e);return P.canConfigureBlock&&o.includes("manual")}),[t.normalizedFormatStore,P.canConfigureBlock]),D=(0,n.useCallback)(((e,o)=>(0,G.jsx)(Fa,{schema:C,collectionContextStore:t,format:c,query:b,disabled:s,isFullScreen:h,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r})),[t,i,s,c,S,h,b,r,C,k]),z=(0,n.useCallback)((e=>{"v2"!==o.version?(0,ga().r)({environment:A,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:i,newGroupIds:e}):(0,ga().V)({environment:A,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:o.currentGroups,containsAllGroups:!1})}),[t,o.version,o.currentGroups,i,A]),K=(0,u().K8)((()=>(0,Do().Zl)(o,t,!0)),[t,o]),W=(0,n.useMemo)((()=>fi({displayState:o,format:c,permissionScopes:P})),[o,c,P]),N=(0,n.useMemo)((()=>R||"v2"===o.version?null:g.length>0?(0,G.jsx)("div",{style:O.hiddenGroupsTitle,ref:m,children:(0,G.jsx)(vt().sA,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})}):null),[o,g.length,m,R,O.hiddenGroupsTitle]);if(0===k.length&&0===g.length&&"v2"===o.version&&0===o.pinnedGroups.groups.length)return null;const $=k.map((e=>(0,Lo().Ix)(e)));return c.board_columns_by?(0,G.jsx)(Qr().g,{stickyAttachPoint:F?"no-stick":"ceiling",absoluteHeight:d,nodeRef:T,stickyStyle:O.stickyHeader,transitionStickyStyle:O.stickyHeaderTransition,children:(0,G.jsxs)("div",{style:O.header,ref:T,children:[M&&(0,G.jsx)("div",{style:O.spacer}),E?(0,G.jsx)(Gs().Ay,{direction:"horizontal",keys:$,renderKey:D,onDrop:z}):$.map(((e,o)=>(0,G.jsx)(Fa,{schema:C,collectionContextStore:t,format:c,query:b,disabled:s,isFullScreen:h,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r},(0,Lo().Ix)(k[o])))),j?null:(0,G.jsxs)(G.Fragment,{children:[K&&(0,G.jsx)(fn,{groupsDisplayState:o,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:C,collectionContextStore:t}),W&&(0,G.jsx)(Ns,{format:c,schema:C,collectionContextStore:t,store:w,columnsDisplayStateForCurrentGroups:i,disabled:B}),N]})]})}):null})),Fa=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:s,isFullScreen:a,hoveredGroupStore:c,groupsResultStore:d}=e;return(0,u().K8)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,G.jsx)(Ra,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:c,disabled:s,hidden:!1,isPopup:!1,isFullScreen:a,groupsResultStore:d}):null}));class Va extends g().Store{constructor(){super("groupsReducerResultStore")}getInitialState(){}}var La=()=>o(419357),Oa=()=>o(64e3),Ea=()=>o(897119);class Da extends g().Store{getInitialState(){return{searchQuery:"",limit:Da.defaultLimit}}}Da.defaultLimit=20,Da.loadMoreScrollOffset=200,Da.loadMoreIncrement=20;const za=Da,Ka=(0,vt().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}}),Ha={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},Wa=n.memo((function(e){const t=(0,a().v3)(),o=(0,p().DP)(),{groupBy:r,groupFormat:i,disabled:l,format:s,query:c,schema:d,currentGroups:g,collectionContextStore:m,blockPropertyValueOverlayStore:S,isFullScreen:h,hoveredGroupStore:f,paddingLeft:y,paddingRight:v,headerWidth:x,shouldShowShimmer:b}=e,C=(0,u().uB)(void 0,Va),w=(0,u().uB)(void 0,Ue().A),k=(0,u().uB)(void 0,za),R=n.useRef(null),A=(0,u().K8)((()=>{var e;return null===(e=c.aggregations)||void 0===e?void 0:e[0]}),[c]),I=(0,u().O$)(m.isInHomeWidgetStore),j=(0,u().K8)((()=>m.collectionViewBlockStore()),[m]),_=(0,n.useMemo)((()=>j?new(me().Bv)(t,{table:$().ev,id:j.id}):null),[t,j]),B=(0,n.useCallback)((()=>(0,G.jsx)(tc,{groupFormat:i,disabled:l,format:s,collectionContextStore:m,schema:d,blockPropertyValueOverlayStore:S,isFullScreen:h,buttonPopupStore:w,paddingLeft:y,paddingRight:v,headerWidth:x,shouldShowShimmer:b})),[S,w,m,l,s,i,h,y,v,d,x,b]),{searchQuery:P,limit:M}=(0,u().O$)(k),F=(0,u().K8)((()=>{const e=(0,Qn().Yy)({schema:d,group:i,groupBy:s.board_columns_by,propertyMapping:void 0,timeZone:(0,zn().P)(),experimentService:zo().default});if(!e)return;return{type:"results",filter:e,limit:M,searchQuery:P,loadContentCover:Boolean(s&&s.board_cover&&"page_content"===s.board_cover.type)}}),[i,d,s,P,M]),L=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:za.defaultLimit}),Ya(t)}(e,t,k)),[t,k]),O=(0,n.useCallback)((()=>function(e,t){t.reset(),Ya(e)}(t,k)),[t,k]),E=(0,n.useCallback)((()=>(0,G.jsxs)(n.Fragment,{children:[!ke().A.isMobile&&(0,G.jsx)(Ra,{groupBy:r,currentGroups:g,groupFormat:i,query:c,schema:d,format:s,collectionContextStore:m,disabled:l||Boolean(P),hidden:!0,isPopup:!0,isFullScreen:h,hoveredGroupStore:f,groupsResultStore:C},(0,Lo().Ix)(i)),(0,G.jsx)("div",{style:{margin:ke().A.isMobile?0:"6px 0"},children:(0,G.jsx)(kt().A,{capture:!0,render:e=>(0,G.jsx)(La().Ay,{value:P,placeholder:Tt().A.formatMessage(Ka.searchPlaceholder),autoFocus:!ke().A.isMobile,showClearButton:!0,onChange:L,onClearButtonClick:O,...e})})})]})),[m,g,l,s,r,i,O,L,f,h,c,C,d,P]),D=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=Xa(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,s=t.isLoadingStore.state;e<za.loadMoreScrollOffset&&!s&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+za.loadMoreIncrement})}(e,m,i,k)),[m,i,k]),z=(0,n.useCallback)((e=>(0,G.jsx)("div",{...e,children:(0,Ln()._)({width:18,height:18,color:o.text.tertiary})})),[o.text.tertiary]),K=(0,n.useCallback)((e=>(0,G.jsx)(Qa,{parent:e,groupFormat:i,currentGroups:g,format:s,schema:d,query:c,collectionContextStore:m})),[i,g,s,d,c,m]),H=(0,n.useCallback)((e=>{let t,{selectableEvents:o}=e;return t=ke().A.isMobile?{menuType:yr().gu.Modal,title:(0,G.jsx)(Yr().d,{groupBy:r,groupFormat:i,currentGroups:g,schema:d,disabled:!0,isHiddenGroup:!0,collectionContextStore:m,source:"collection_settings"}),left:(0,G.jsx)(sn().Ay,{popupType:Ea().nl.BottomSheet,renderOrigin:z,render:K}),right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:()=>ec(w),header:E()}:{menuType:yr().gu.Popup,header:E(),width:(0,V().rq)(Ua(s))+20},F?(0,G.jsxs)(xr().A,{...t,...o,children:[(0,G.jsx)(In().A,{id:`board_hidden_group:${(0,Lo().Ix)(i)}`,reducer:F,groupsPointer:[i],collectionContextStore:m,resultStore:Xa(m,i),render:B}),(0,G.jsx)(Gi().A,{onChange:D})]}):null}),[F,i,m,B,D,r,g,d,z,K,E,w,s]),W=(0,n.useCallback)((()=>{if(_)return(0,G.jsx)(Vi().A,{store:_,isDefaultContainer:!0,droppable:!0,render:H})}),[_,H]),N=(0,n.useCallback)((()=>function(e,t){t.reset(),Ya(e)}(t,k)),[t,k]),{value:U}=(0,ge().fJ)(de().VI.duplicateActions),X=(0,n.useCallback)((async e=>{const{droppedStores:o,duplicate:n}=e,r=R.current;if(!r)return;if(!(r instanceof Element))return;const l=await Te().T.formulas.load();T().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:t,canUndo:!0,perform:e=>nr({environment:t,collectionContextStore:m,groupsPointer:[i],droppedStores:o,duplicate:n,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:U})})}),[t,m,i,U]),q=(0,n.useCallback)((e=>(0,G.jsx)(Ga,{buttonPopupEvents:e,aggregation:A,schema:d,collectionContextStore:m,query:c,groupFormat:i,groupBy:r,currentGroups:g,isInHomeWidget:I,groupsResultStore:C})),[d,m,c,i,r,g,I,A,C]);return _?(0,G.jsx)("div",{ref:R,children:(0,G.jsx)(gt().Ay,{store:_,canDropOnto:!l,onSelectableDrop:X,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,G.jsx)(sn().Ay,{popupType:ke().A.isMobile?Ea().nl.BottomSheet:Ea().nl.Popup,renderOrigin:q,render:W,buttonPopupStore:w,onClick:N})})}):null}));function Ga(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:s,schema:c,collectionContextStore:d,isInHomeWidget:u,groupsResultStore:g}=e;const m=(0,a().v3)(),S=(0,p().IS)((e=>({button:{...Ha,...u?{fontSize:14}:{}}})),[u]),h=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&T().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,hr().F)({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,d,t,m)),[d,t,m]);return(0,G.jsxs)(Pt().A,{style:S.button,...r,children:[(0,G.jsx)(Yr().d,{groupBy:l,groupFormat:i,currentGroups:s,schema:c,disabled:!0,isHiddenGroup:!0,collectionContextStore:d,source:"collection_settings"}),o&&(0,G.jsx)(ba,{groupFormat:i,aggregation:o,schema:c,collectionContextStore:d,disabled:!0,onChange:h,groupsResultStore:g})]},(0,Lo().Ix)(i))}function Na(e){return e?e.board_cover:void 0}function $a(e){return e?e.board_cover_aspect:void 0}function Ua(e){return e?e.board_cover_size:void 0}function Xa(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function qa(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Ya(e){Se().default.state.stores.length>0&&A().IU({environment:e})}function Qa(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=(0,u().K8)((()=>s.collectionStore()),[s]),c=s.boardColumnsLimitStore;return a?(0,G.jsx)(Ar,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:c}):null}function Za(e,t,o,n,r){const{blocks:i,transaction:l}=e,s=o.groupsStore.getGroupState(t);if(!s)return;const a=s.resultsStore;if(i.length>0&&a.state.length>0){const e=i[0];if(!(0,nt().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;Ys({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function Ja(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(y().q4_(null==i?void 0:i.getValue()))return void A().Lt({environment:n,store:e});if(!r)return;const l=qa(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&qs(n,{...(0,Me().sl)(t),block_id:e.id}),T().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{Ct().by({childStore:e,transaction:t})}}),s>=0){const e=l.state[s];A().Lt({environment:n,store:e})}}function ec(e){e.setState({open:!1})}function tc(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:s,isFullScreen:c,buttonPopupStore:d,paddingLeft:p,paddingRight:g,headerWidth:m,shouldShowShimmer:S}=e;const h=(0,a().v3)(),f=(0,n.useCallback)((()=>ec(d)),[d]),y=(0,n.useCallback)((e=>Za(e,t,i,c,h)),[t,i,c,h]),{device:v}=h,x=(0,u().K8)((()=>{var e;return null===(e=Xa(i,t))||void 0===e?void 0:e.state}),[i,t]),b=(0,u().K8)((()=>{var e;return null===(e=qa(i,t))||void 0===e?void 0:e.state}),[i,t]),C=(0,u().K8)((()=>W().default.isSidePeekOpen()),[]);return x&&b?0===b.length?(0,G.jsx)(wr().A,{children:(0,G.jsx)(Oa().A,{title:(0,G.jsx)(vt().sA,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,G.jsx)("div",{style:{padding:v.isMobile?"8px 16px":"6px 14px 8px"},children:(0,G.jsx)(_l,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:y,disableRequest:!0,headerWidth:m,shouldShowShimmer:S,resultProps:{format:r,schema:l,disabled:o,coverFormat:Na(r),coverAspectFormat:$a(r),coverSizeFormat:Ua(r),colorStyle:void 0,blockPropertyValueOverlayStore:s,onTextEnter:e=>function(e,t,o,n,r){const i=qa(t,n);if(!i)return;if(!(0,nt().EF)(r)||!t.collectionStore())return Ja(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;T().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{Ys({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,c,t,h),onTextEsc:e=>Ja(e,i,t,h),onShiftEnter:e=>Za(e,t,i,c,h),collectionContextStore:i},resultComponent:ta,handleOpenPeekPage:C?void 0:f,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:Tl.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,paddingLeft:p,paddingRight:g,analyticsName:"board"})}):(0,G.jsx)(wr().A,{children:(0,G.jsx)(Oa().A,{title:(0,G.jsx)(hn().A,{})})})}const oc=Wa,nc=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:s,format:c,query:d,schema:p,isFullScreen:g,blockPropertyValueOverlayStore:m,columnsDisplayStateForCurrentGroups:S,hoveredGroupStore:h,paddingLeft:f,paddingRight:y,headerWidth:v}=e,x=(0,a().v3)(),b=(0,H().X)("db_ux_chrome"),C=(0,Ke().bx)(s,r),w=(0,u().O$)(o.isInHomeWidgetStore),k=(0,u().K8)((()=>C&&!ke().A.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[C,o]),R=(0,n.useMemo)((()=>l.slice(0,Do().RP)),[l]),A=(0,n.useMemo)((()=>R.map((e=>(0,Lo().Ix)(e)))),[R]),I=(0,u().O$)(o.permissionScopesStore),T=(0,n.useCallback)((e=>{if(c.board_columns_by)return(0,G.jsx)(oc,{query:d,schema:p,format:c,groupFormat:e,groupBy:c.board_columns_by,currentGroups:S,collectionContextStore:o,disabled:r||!C||!I.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:m,isFullScreen:g,hoveredGroupStore:h,paddingLeft:f,paddingRight:y,headerWidth:v,shouldShowShimmer:!1},(0,Lo().Ix)(e))}),[m,C,o,S,r,c,h,g,I.canEditContent,d,p,f,y,v]),j=(0,n.useCallback)(((e,t)=>T(R[t])),[R,T]),_=(0,n.useCallback)((e=>(0,ga().r)({environment:x,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:S,newGroupIds:e})),[o,S,x]),B=(0,n.useMemo)((()=>function(e){const{isInHomeWidget:t,disableBoardColorColumns:o,isMobile:n,isDBUXChromeEnabled:r}=e;return{width:220,flexShrink:0,marginTop:nn+hi({disableBoardColorColumns:o,isInHomeWidget:t,isMobile:n,isDBUXChromeEnabled:r}),marginLeft:12}}({isInHomeWidget:w,disableBoardColorColumns:i,isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:b})),[b,w,i]);return(0,G.jsx)("div",{style:B,ref:t,children:R.length>0?k?(0,G.jsx)(Gs().Ay,{direction:"vertical",keys:A,renderKey:j,onDrop:_}):(0,G.jsx)("div",{children:R.map(T)}):null})})));const rc={viewBox:"0 0 16 16",fittedViewBox:"3.37 1.53 9.26 12.92",svg:(0,G.jsx)("path",{d:"m10.225 6.095-.11-1.14.18-.16c.64-.57 1.01-1.4 1.01-2.26v-.38c0-.34-.28-.62-.62-.62h-5.36c-.34 0-.62.28-.62.62v.38c0 .86.37 1.68 1.01 2.26l.18.16-.11 1.14c-1.44.58-2.41 2-2.41 3.55v.5c0 .34.28.62.63.62h3.23v2.34c0 .14.03.27.09.4l.35.75c.05.11.14.18.26.2h.06c.09 0 .19-.04.26-.11l.06-.08.35-.77c.06-.12.09-.26.09-.4v-2.34h3.26c.34 0 .62-.28.62-.62v-.5c0-1.56-.96-2.98-2.41-3.55zm-3.66 1.05c.23-.08.4-.29.42-.53l.18-1.85c.02-.2-.06-.4-.21-.53l-.42-.38c-.32-.28-.52-.66-.58-1.08h4.07c-.06.42-.26.8-.58 1.08l-.42.38c-.15.13-.23.33-.21.53l.18 1.85c.02.24.19.45.42.53l.19.06c1 .34 1.7 1.27 1.75 2.32h-6.73c.05-1.05.74-1.98 1.75-2.32z"})},ic=(0,Po().wt)("pinSmall",rc);const lc=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,disabled:n}=e,r=o.pinnedGroups;return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(ln().p,{isLightGray:!0,iconLeading:ic,iconStyle:{width:16,height:16,marginRight:8},style:{width:"fit-content"},onClick:()=>{const e=t.settingsStore;C().R8({collectionSettingsStore:e,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})},children:(0,G.jsx)(vt().sA,{...Do().K0.pinnedGroups})}),(0,G.jsx)("div",{style:{marginLeft:24,marginTop:8},children:r.groups.map((e=>{const i=(0,Lo().Ix)(e),l=r.aggregations[i]??0;return(0,G.jsx)(sc,{groupFormat:e,count:l,collectionContextStore:t,columnsDisplayState:o,disabled:n},(0,Lo().Ix)(e))}))})]})}));function sc(e){const{groupFormat:t,collectionContextStore:r,columnsDisplayState:i,disabled:l}=e,s=(0,a().v3)(),c=(0,vt().tz)(),d=n.useRef(null),g=(0,u().O$)(r.normalizedFormatStore),m=(0,u().O$)(r.normalizedSchemaStore),S=(0,u().O$)(r.temporaryStateStore),[h,f]=n.useState(!1),y=(0,u().K8)((()=>{const e=r.collectionViewBlockStore();return e?new(me().Bv)(s,{table:$().ev,id:e.id}):null}),[s,r]),{value:v}=(0,ge().fJ)(de().VI.duplicateActions),x=n.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:n}=e,i=d.current;if(!i)return;if(!(i instanceof Element))return;const l=await Te().T.formulas.load();T().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:s,canUndo:!0,perform:e=>nr({environment:s,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:v})})}),[r,v,s]),b=n.useCallback((()=>{(0,Sr().m)({environment:s,collectionContextStore:r,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[s,r,t,i]),C=g.board_columns_by,w=n.useMemo((()=>{if(!C)return null;const e=Si(g);return(0,G.jsx)(Yr().d,{collectionContextStore:r,currentGroups:i.currentGroups,groupBy:C,groupFormat:t,schema:m,disabled:!0,isHiddenGroup:!1,style:{fontSize:14,cursor:"inherit",maxWidth:e-24,overflow:"hidden",textOverflow:"ellipsis"},source:"collection_settings"})}),[r,i.currentGroups,g,C,t,m]),k=(0,p().IS)((e=>({container:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2},pinIcon:{width:16,height:16,fill:e.text.tertiary}})),[]);if(!C)return null;if(!y)return null;const R={onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1)};return(0,G.jsx)("div",{ref:d,children:(0,G.jsxs)(gt().Ay,{analyticsName:"board_pinned_group",store:y,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await x({...e,groupFormat:t})},style:k.container,children:[(0,G.jsxs)(ln().p,{onClick:()=>{(0,o(701311).d)({collectionContextStore:r,environment:s,groupFormat:t,groupBy:C,temporaryViewState:S,title:w})},hoveredStyle:{cursor:"pointer"},children:[w,(0,G.jsx)("span",{style:{opacity:.5,fontSize:14,marginLeft:8},children:(0,o(72135).ZV)(e.count,"number",c,"compact")})]}),l?null:(0,G.jsx)(Ft().A,{renderTooltip:e=>(0,G.jsx)(vt().sA,{...e,...Do().K0.unpinGroup}),render:e=>(0,G.jsx)(Mt().A,{...(0,rn().A)(e,R),ariaLabel:c.formatMessage(Do().K0.unpinGroup),icon:h?o(230979).N:o(68207).S,iconStyle:k.pinIcon,onClick:b})})]})},(0,Lo().Ix)(t))}const ac=n.memo((function(e){const{args:t,collectionContextStore:o,isInPeekRenderer:r,format:i,setSubgroupsMounted:l,columnsDisplayStateStore:s}=e,a=(0,u().O$)(o.isInHomeWidgetStore),c=(0,H().X)("db_ux_chrome"),d=(0,u().O$)(s),g=(0,n.useMemo)((()=>yi({format:i,visibleGroups:d.visibleGroups,isDBUXChromeEnabled:c})),[i,d.visibleGroups,c]),{stickyStyle:m}=(0,p().IS)((e=>a?{stickyStyle:{}}:{stickyStyle:{background:r?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${r?e.cardContentBackground:e.contentBackground}`}}),[a,r]);return(0,G.jsx)(ei,{...t,height:a?At().ag:36,stickyStyle:m,style:{...t.style,minWidth:g},onMount:l})})),cc=g().Store.createClass(void 0,{name:"GroupsReducerResultStore"}),dc=g().Store.createClass(void 0,{name:"HoveredGroupStore"}),uc=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:c,isFullScreen:d,isPreviewing:g,paddingLeft:m,paddingRight:S,paddingBottom:h,disabled:f,query:y,blockPropertyValueOverlayStore:x,isInPeekRenderer:b,isRootChild:C,headerWidth:w}=e,k=(0,a().v3)(),{isMobile:A}=(0,a().Y0)(),I=(0,p().DP)(),j=(0,vt().tz)(),_=(0,H().X)("collection_group_reducer_visible"),B=(0,H().X)("db_ux_chrome"),P=(0,n.useRef)(null),M=(0,n.useRef)(null),F=(0,n.useRef)(0),L=(0,n.useRef)(null),O=(0,u().uB)(void 0,cc),E=(0,u().O$)(O),D=(0,u().uB)(void 0,dc),[z,K]=(0,n.useState)(!1),W=(0,u().r6)((()=>{var e,t;const o=c.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[c],{useDeepEqual:!0}),{collectionStore:N,collectionViewStore:$,collectionViewBlockStore:U}=(0,u().K8)((()=>({collectionStore:c.collectionStore(),collectionViewStore:c.collectionViewStore(),collectionViewBlockStore:c.collectionViewBlockStore()})),[c]),X=(0,u().K8)((()=>"collectionTypedView"===c.contextType),[c]),q=(0,u().O$)(c.permissionScopesStore),Y=(0,u().K8)((()=>{const e=r.board_columns_by;if(e)return(0,Lo().oH)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),Q=(0,u().O$)(c.boardColumnsLimitStore),Z=(0,u().K8)((()=>!Boolean((0,Do().$e)({environment:k,groupFormat:void 0,schema:i,format:r,theme:I}))),[k,r,i,I]),[J,ee]=(0,jn().d)({collectionContextStore:c,groupBy:r.board_columns_by,groupsFormatKey:"board_columns",reducerResult:E,groupsLimit:Q}),[te,oe]=(0,jn().d)({collectionContextStore:c,subGroupBy:r.collection_group_by,groupsFormatKey:Lo().V1,reducerResult:E,groupsLimit:Q}),ne=(0,u().K8)((()=>{const{visibleGroups:e}=J,t=r.collection_group_by,o=O.state;if("v2"===(null==o?void 0:o.version))return c.groupsStore.anyGroupHasResults();const n=void 0!==U?(0,Do().ck)({groupBy:t,schema:i,formatGroups:r.collection_groups||[],schemaGroups:Y,reducerResults:null==o?void 0:o.results,getRecordModel:U.getRecordModel,getRecordRole:U.getRecordRole,relativeVariableResult:c.relativeVariableStore.state,viewAppConfigUri:null==$?void 0:$.getFormat().app_config_uri,allowedCollectionStores:c.collectionStoresStore.state}):[];if(0===n.length){if(void 0!==t)return!1;for(const t of e){const e=c.groupsStore.getGroupState(t);if(null!=e&&e.reducerResultStore.state)return!0}}else for(const r of n)for(const t of e){const e=[r,t],o=c.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[c,U,$,J,r,O,i,Y]),re=(0,u().K8)((()=>{var e;const t=r.board_columns_by;if(!t)return;const o=r.collection_group_by?{groupBy:r.collection_group_by,groupsFormatKey:"collection_groups",limit:c.groupsLimitStore.state,subGroupAggregation:r.collection_group_aggregation}:void 0,n=(0,Tn().m)({collectionContextStore:c,isMobile:A,groupBy:t,subGroupBy:r.collection_group_by});return(0,Tn().p)({groupBy:t,schema:i,format:r,groupsFormatKey:"board_columns",limit:c.boardColumnsLimitStore.state,aggregation:null===(e=y.aggregations)||void 0===e?void 0:e.at(0),returnPinnedGroups:!0,subGroupArgs:o,blockResults:n})}),[c,r,A,y.aggregations,i]),ie=(0,Ke().bx)(t,f),le=(0,n.useMemo)((()=>ie&&(X||q.canEditContent)),[ie,q.canEditContent,X]),se=(0,n.useCallback)((()=>{N&&N.isDefined()&&$&&q.canConfigureBlock&&T().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:k,canUndo:!0,perform:e=>{let t,o=V().In(i);if(!o&&q.canConfigureCollection){o=(0,Oo().Ay)();t={[o]:{name:j.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!o)return;const n=(t||i)[o];n&&(0,Lo().Eg)(n)&&(Wo().zA({stores:[$],update:{board_columns_by:(0,Lo().V0)({property:o,propertySchema:n,isCollectionTypedView:X})},transaction:e}),Go().zv({store:$,data:{type:"board"},transaction:e}),t&&(0,Uo().F)({environment:k,collectionStore:N,update:t,transaction:e}))}})}),[N,$,k,j,X,q.canConfigureBlock,q.canConfigureCollection,i]);(0,n.useEffect)((()=>{N&&(!r.board_columns_by&&t.isDefined()&&N.isDefined()&&se(),s().default.afterNextFlush((()=>{if(!M.current||!P.current)return;let e=0;if(P.current){const t=M.current.getBoundingClientRect().left;e=P.current.getBoundingClientRect().left-t+8}const t=e+F.current;F.current=t,M.current.style.left=`${t}px`})))}),[c,N,k,r.board_columns_by,j,i,t,se]);const ae=(0,n.useCallback)((()=>{const e=ee.state.currentGroups;Ho({environment:k,groupsFormatKey:"board_columns",collectionContextStore:c,currentGroups:e})}),[k,c,ee]),ce=(0,n.useMemo)((()=>v().sg(ae,5e3)),[ae]);(0,n.useEffect)((()=>(ee.addListener(ce),()=>{ee.removeListener(ce),ce.cancel()})),[ee,ce]),(0,n.useEffect)((()=>{const e=()=>K(!1);return W.addListener(e),()=>W.removeListener(e)}),[W]);const de=(0,n.useCallback)((()=>D.setState(void 0)),[D]),ue=(0,n.useCallback)((e=>{const o=J.visibleGroups;return(0,G.jsx)("div",{style:Gs().Z0,children:o.map(((n,l)=>{const s=l===o.length-1,a=e?[e,n]:[n],u=0!==J.hiddenGroups.length;return c.groupsStore.getGroupState(a)?(0,G.jsx)(ra,{store:t,hoveredGroupStore:D,query:y,schema:i,format:r,groupsPointer:a,collectionContextStore:c,isFullScreen:d,disabled:f||!le,isLast:s&&!u,blockPropertyValueOverlayStore:x,anyGroupHasResults:ne,paddingLeft:m,paddingRight:S,headerWidth:w},(0,Lo().Hm)(a)):null}))})}),[ne,x,le,c,J.hiddenGroups.length,J.visibleGroups,f,r,w,D,d,m,S,y,i,t]),pe=(0,n.useCallback)((()=>{K(!0)}),[K]),ge=(0,n.useCallback)((e=>(0,G.jsx)(ac,{collectionContextStore:c,isInPeekRenderer:b,format:r,setSubgroupsMounted:pe,columnsDisplayStateStore:ee,args:e})),[c,ee,r,b,pe]),me=(0,n.useCallback)((e=>{A?No().uK({environment:k,store:e,pageVisitSource:Vo().y8.Create}):$o().VU({environment:k,store:e,peekMode:V().hH(c),showMoveTo:X,resultsStore:void 0,collectionContextStore:c,pageVisitSource:Vo().y8.Create})}),[c,k,X,A]),Se=ne,he=z,fe=(0,u().O$)(c.shouldShowSpinnerStore),ye=fe&&!he&&!Se,ve=(0,u().O$)(c.isInHomeWidgetStore),xe=(0,u().K8)((()=>Boolean(c.viewsModuleContextStore.getViewModuleType())),[c]),{visibleGroups:be,hiddenGroups:Ce}=J,we=(0,u().K8)((()=>"v2"===J.version?r.board_columns||[]:J.currentGroups),[J.currentGroups,J.version,r.board_columns]),ke=r.collection_group_by,Ae=d?480:ve?220:360,Ie=hi({disableBoardColorColumns:Z,isInHomeWidget:ve,isMobile:A,isDBUXChromeEnabled:B}),Te=nn+Ie,je=(0,Re().Zp)(),_e=(0,n.useCallback)((e=>{const{target:t}=e;!A&&0===e.button&&t instanceof HTMLElement&&(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:k,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[k,A]),Pe=(0,n.useCallback)((e=>({marginTop:4,...e.isLast&&{paddingBottom:12}})),[]),Me=(0,p().IS)((()=>{const e=Jo(B);return{container:{marginLeft:m,marginRight:S,float:"left",paddingBottom:Te},selectable:{display:"flex",position:"relative",flexGrow:1,paddingBottom:h},spacer:{width:90,marginLeft:e,marginRight:e,pointerEvents:"none"},addGroupButtonSpacer:{width:35,marginLeft:e,marginRight:e,pointerEvents:"none"},groupsWrapper:{display:"flex",flexDirection:"column",position:"relative",top:Te}}}),[Te,h,m,S,B]),Fe=(0,n.useCallback)((()=>{const e="v2"===J.version&&0===J.visibleGroups.length&&0===J.pinnedGroups.groups.length,n=r.collection_group_by&&"v2"===te.version&&0===te.visibleGroups.length;if(_&&!ye&&(e||n)){let t="board_columns_by";return!e&&r.collection_group_by&&0===te.visibleGroups.length&&(t="collection_group_by"),(0,G.jsx)(Oi,{collectionContextStore:c,groupByKeyToOpen:t,paddingLeft:m,paddingRight:S,headerWidth:w})}return(0,Ni().A)((e=>(0,G.jsx)("div",{className:Be().okd,style:Me.container,...e,ref:L,children:(0,G.jsx)(pi,{nodeRef:L,children:(0,G.jsxs)(gt().Ay,{style:Me.selectable,store:t,shouldShowHalo:!d&&!ve&&!g,canSelect:!d&&!xe,disablePointerEvents:null==je?void 0:je.disableAllPointerEvents,onMouseDown:_e,analyticsName:"board",onMouseLeave:de,children:[ye&&ve?null:(0,G.jsx)(Ma,{collectionContextStore:c,columnsDisplayState:J,currentGroups:we,disableBoardColorColumns:Z,disabled:f,groupsResultStore:O,format:r,headerPlaceholderHeight:Te,hiddenGroups:Ce,hiddenGroupsHeaderRef:M,hoveredGroupStore:D,isFullScreen:d,isInPeekRenderer:b,isRootChild:C,paddingLeft:m,paddingRight:S,query:y,schema:i,store:t,visibleGroups:be,shouldShowShimmer:ye}),ye?(0,G.jsx)(pa,{height:Ae,numBoardColumns:be.length,boardCoverSize:r.board_cover_size,areColumnsColored:!Z,showGroupHeader:0===be.length,disableBoardColorColumns:Z,isInHomeWidget:ve}):null,be.length>0?(0,G.jsx)("div",{style:Me.groupsWrapper,children:ke?(0,G.jsx)(Ds,{reducerId:o(381891).bq,store:t,groupsResultStore:_?O:void 0,collectionContextStore:c,disabled:f,isFullScreen:d,isRootChild:C,paddingLeft:m,paddingRight:S,stickyLeft:!A,renderGroup:ue,getGroupStyle:Pe,renderHeader:ge,onGroupHeaderAddItem:me,headerWidth:w}):ue(void 0)}):null,_?(0,G.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"fit-content",height:"fit-content",marginTop:Ie+6},children:[(0,Do().Zl)(J,c,!0)&&(0,G.jsx)(fn,{groupsDisplayState:J,groupsLimitStore:c.boardColumnsLimitStore,type:"board",schema:i,collectionContextStore:c}),fi({displayState:J,format:r,permissionScopes:q})&&(0,G.jsx)(Ns,{format:r,schema:i,collectionContextStore:c,store:t,columnsDisplayStateForCurrentGroups:we,disabled:fe}),"v2"===J.version&&J.pinnedGroups.groups.length>0&&!ye&&(0,G.jsx)(lc,{collectionContextStore:c,columnsDisplayState:J,disabled:f})]}):(0,G.jsxs)(G.Fragment,{children:[(0,Do().Zl)(J,c,!0)?(0,G.jsx)("div",{style:Me.spacer}):null,fi({displayState:J,format:r,permissionScopes:q})?(0,G.jsx)("div",{style:Me.addGroupButtonSpacer}):null,(0,G.jsx)(nc,{ref:M,collectionContextStore:c,store:t,disabled:f,hiddenGroups:Ce,disableBoardColorColumns:Z,format:r,schema:i,query:y,blockPropertyValueOverlayStore:x,isFullScreen:d,columnsDisplayStateForCurrentGroups:J.currentGroups,hoveredGroupStore:D,paddingLeft:m,paddingRight:S,headerWidth:w})]})]})})})))}),[J,r,te.version,te.visibleGroups.length,_,ye,c,m,S,w,Me.container,Me.selectable,Me.groupsWrapper,Me.spacer,Me.addGroupButtonSpacer,t,d,ve,g,xe,null==je?void 0:je.disableAllPointerEvents,_e,de,we,Z,f,O,Te,Ce,D,b,C,y,i,be,Ae,ke,A,ue,Pe,ge,me,Ie,q,fe,x]);return r.board_columns_by?(0,G.jsx)($s,{collectionContextStore:c,groupsResultStore:O,groupsReducer:re,render:Fe}):(0,G.jsx)(Xs,{collectionContextStore:c,isFullScreen:d,paddingLeft:m,paddingRight:S,paddingBottom:h})}));var pc=()=>o(604995),gc=()=>o(636740),mc=()=>o(397248),Sc=()=>o(833880),hc=()=>o(253021),fc=()=>o(747671),yc=()=>o(597777);function vc(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:s,columnIndex:a,currentlyViewedMonth:c,endOfDay:d,format:u,items:g,query:m,sortedResultsStore:S,schema:h,shouldShowShimmer:f,startOfDay:y}=e,v=(0,pc().vY)({firstDate:y,secondDate:c}),x=(0,pc().c_)(y),b=!v&&!x&&"week"!==i,C=(0,p().IS)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?e.text.tertiary:x?e.white:void 0,...x?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:ur().Ay.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.icon.secondary,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[x,b]),w=(0,n.useMemo)((()=>g.find((e=>(0,yc().m6)(y,d,e.start,e.end?e.end:void 0)))),[g,y,d]),k=(0,pc().wN)(y),R=(0,n.useCallback)((e=>(0,G.jsxs)(Pt().A,{style:C.button,...e,children:[(0,G.jsx)("div",{style:C.dayNumber,className:f?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${a}`:"notion-shimmer-calendar-transition",children:k}),w&&(0,G.jsx)("div",{style:C.eventDot})]})),[C,f,a,k,w]),A=(0,n.useCallback)((e=>(0,G.jsx)(o(824622).iq,{collectionContextStore:s,initialStartOfDay:y,format:u,schema:h,query:m,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:S})),[s,y,u,h,m,r,l,t,S]);return(0,G.jsx)(sn().Ay,{popupType:sn().z7.SlideUp,renderOrigin:R,render:A},k.toString())}const xc=(0,n.memo)(vc);function bc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:s,format:a,items:c,query:d,sortedResultsStore:u,schema:g,shouldShowShimmer:m,showWeekends:S,startOfWeek:h}=e,f=(0,p().IS)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=S?7:5,v=(0,n.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,pc().K1)({date:h,daysToAdd:e});return{startOfDay:t,endOfDay:(0,pc().P9)(t)}}))),[y,h]);return(0,G.jsx)("div",{style:f.container,children:v.map(((e,n)=>(0,G.jsx)(xc,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:s,endOfDay:e.endOfDay,format:a,items:c,query:d,sortedResultsStore:u,schema:g,shouldShowShimmer:m,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},h.toString())}const Cc=(0,n.memo)(bc);var wc=()=>o(465364);const kc=30,Rc=(0,vt().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function Ac(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:s,canEditCalendar:c,isInHomeWidget:d,isInPeekRenderer:g,isTypedMsvCollection:m,currentlyViewedMonth:S,calendarBy:h,propertySchema:f,calendarViewRange:y,shouldShowShimmer:v}=e,x=(0,a().v3)(),b=(0,vt().tz)(),C=(0,n.useContext)(ll().n),w=(0,ss().x6)(),{mainEditorCurrentBlockStore:R}=(0,u().O$)(jt().default),A=(0,u().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:I,isDragging:j,hoveredDay:_}=(0,u().K8)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:B,userId:P,inMemoryRecordCache:M}=(0,u().K8)((()=>t),[t]),F=(0,n.useMemo)((()=>{const e=I.get(s);if(e)return e;const t=new(o(148832).B)(x,B,{userId:P,inMemoryRecordCache:M});return I.set(s,t),t}),[I,x,M,B,s,P]),L=(0,pc().vY)({firstDate:s,secondDate:S}),O=(0,pc().c_)(s),E=(0,pc().sm)(s),D="date"===f.type,z=!L&&!O&&"week"!==y,K=!j&&_===s&&(D||O)&&A&&c,H=(0,n.useMemo)((()=>1!==(0,pc().wN)(s)||O?(0,pc().wN)(s):`${new Intl.DateTimeFormat(b.locale,{month:"short",day:"numeric"}).format(new Date(s))} `),[b.locale,O,s]),W=(0,n.useCallback)((e=>{C?C(e):rl().oo({environment:x,url:e})}),[x,C]),N=(0,n.useCallback)((()=>{const{performResult:e}=T().createAndCommit({userAction:"Calendar.createBlockInDay",environment:x,canUndo:!0,perform:e=>{const t=(0,En().Q)({environment:x,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:x.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(h))??h;wc().D5({type:"timestamp",environment:x,store:t.newStore,propertyId:n,timestampMs:s,transaction:e});const r=V().wy({environment:x,store:t.newStore,mainEditorCurrentBlockStore:R,collectionContextStore:i,showMoveTo:m})??(0,sl().Ay)({store:t.newStore,pageVisitSource:Vo().y8.Create});return W(r),k().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[h,i,x,m,R,W,s]),$=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(h))??h;if(wc().D5({type:"timestamp",environment:x,store:t,propertyId:i,timestampMs:s,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,zn().P)(),intl:b,isWorkflowsContainerWithCreationEnabled:w}))||"",s=r.length>53?`${r.slice(0,50)}…`:r;o(436572).rL({item:{label:b.formatMessage(Rc.linkExistingCompleteToast,{pageTitle:s,numUpdates:e})},undoFunc:()=>{}})}}),[h,x,s,b,w]),{value:U}=(0,ge().fJ)(de().VI.duplicateActions),X=(0,n.useCallback)((e=>{T().createAndCommit({userAction:"Calendar.renderDay",environment:x,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:x,getData:()=>Me().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),wc().M9({...e,environment:x,startOfDay:s,calendarBy:h,collectionStore:o,collectionContextStore:i,transaction:t,duplicateActions:U})}})}),[h,i,U,x,s]),q=(0,n.useCallback)((()=>{if(c&&(0,nt().EF)(x)&&A){const e=N();On().v(x,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Me().sl)(i)})}}),[c,x,A,N,i]),Y=(0,p().IS)((e=>{const t=(()=>{if(E)return d?(0,Qs().X4)(e.tableHomeDividerColor,.05):g?e.cardSidebarBackground:e.surface.wash})(),o=z?e.text.tertiary:O?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...O?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[d,g,O,E,z]),Q=(0,Re().Zp)();return(0,G.jsxs)(gt().Ay,{style:Y.selectable,store:F,canDropOnto:c&&D,onSelectableDrop:X,onDoubleClick:q,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[K&&!(null!=Q&&Q.disablePageLinks)&&(0,G.jsx)(Ic,{collectionContextStore:i,createBlockFunc:N,updateBlockDayProperty:$}),(0,G.jsx)("div",{style:Y.dayNumber,className:v?`${Be().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${Be().yWO} notion-shimmer-calendar-transition`,children:H})]},s.toString())}function Ic(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,a().v3)(),l=(0,vt().tz)(),s=(0,u().K8)((()=>V().fG({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),c=(0,n.useCallback)((()=>{if((0,nt().EF)(i)){const e=o();On().v(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Me().sl)(t)})}else(0,nt().QY)(i)}),[i,o,t]),d=(0,p().IS)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),g=(0,n.useCallback)(((e,t)=>(0,G.jsx)(Mt().A,{ariaLabel:l.formatMessage(Rc.addItemLabel),icon:Qt().W,style:d.iconButton,onClick:c,...(0,rn().A)(e,{onMouseDown:Oe().tr})})),[c,l,d.iconButton]);return(0,G.jsxs)("div",{style:d.iconToolbar,children:[(0,G.jsx)(Ft().A,{renderTooltip:()=>l.formatMessage(Rc.addItemLabel),render:g}),s?(0,G.jsx)(Ft().A,{renderTooltip:()=>l.formatMessage(Rc.linkExistingLabel),render:e=>(0,G.jsx)(Pi().O,{collectionContextStore:t,renderLinkButton:t=>(0,G.jsx)(Mt().A,{ariaLabel:l.formatMessage(Rc.linkExistingLabel),icon:nl().arrowDiagonalUpRightIcon,style:d.iconButton,...t,...(0,rn().A)(e,{onMouseDown:Oe().tr})}),onAddOrLink:r})}):null]})}const Tc=(0,n.memo)(Ac);var jc=()=>o(869190),_c=()=>o(693954),Bc=()=>o(828180),Pc=()=>o(603820),Mc=()=>o(16006),Fc=()=>o(338931),Vc=()=>o(771989);const Lc=2,Oc=3;function Ec(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,a().v3)(),s=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=jt().default.state;return V().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),rl().oo({environment:l,url:e}))}),[r,l,i,o]),d=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>s.current,getBlockStore:()=>o,activate:c})),[c,o]);(0,u().K8)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,G.jsx)("div",{ref:s,children:(0,G.jsx)(zc,{...e})});return(0,Ke().NW)(o,t,d,p)}const Dc=n.forwardRef(Ec);function zc(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:s,collectionContextStore:c,includeTime:d,handleOpenPeekPage:p,blockPropertyValueOverlayStore:g,calendarStore:m}=e,S=(0,a().v3)(),{value:h}=(0,ge().fJ)(Te().T.formulas),f=n[l],y=(0,u().K8)((()=>!i&&"date"===(null==f?void 0:f.type)&&!c.permissionScopesStore.state.isSyncedCollection),[c.permissionScopesStore,i,null==f?void 0:f.type]),{start:x,end:b,startOfWeek:C,endOfWeek:w,startColumn:k,columnCount:R}=(0,Fc().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),A=(0,u().K8)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,Xi().T)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:S.currentUser.id,userTimeZone:(0,zn().P)(),intl:Tt().A.getIntl(),experimentService:zo().default,collectionFeatureGates:(0,Hn().i)(),formulasModule:h})));return o.concat(v().R9(e,o))}),[S.currentUser.id,r.calendar_properties,n,t,h]),I=(0,u().K8)((()=>(0,ue().jz)({collectionContextStore:c})),[c]);if(!f||!Xo().$L(f))return null;const T=A.length+(I?1:0),j=x<C,_=void 0!==b&&b>w;return(0,G.jsxs)(Kc,{store:t,row:o,numRows:T,columnCount:R,startIsBeforeStartOfWeek:j,endIsAfterEndOfWeek:_,startColumn:k,disabled:i,isEditableDate:y,calendarBy:l,showWeekends:s,handleOpenPeekPage:p,children:[I&&(0,G.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,G.jsx)(Dl().n,{blockStore:t,collectionContextStore:c})}),(0,G.jsx)(Nc,{store:t,collectionContextStore:c,disabled:i,start:x,startOfWeek:C,end:b,endOfWeek:w,includeTime:d,propertySchema:f}),(0,G.jsx)(Uc,{store:t,sortedProperties:A,startIsBeforeStartOfWeek:j,disabled:i,blockPropertyValueOverlayStore:g}),y&&(0,G.jsx)(Xc,{store:t,start:x,startOfWeek:C,end:b,endOfWeek:w,calendarBy:l,calendarStore:m})]})}function Kc(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:s,disabled:c,isEditableDate:d,calendarBy:g,showWeekends:m,handleOpenPeekPage:S,startIsBeforeStartOfWeek:h,endIsAfterEndOfWeek:f}=e,y=(0,a().v3)(),v=(0,se().ET)(),x=(0,Re().Zp)(),b=(0,u().K8)((()=>V().NM(t)),[t]),C=(0,u().K8)((()=>(0,Sl().W)(y,t.id)),[y,t.id]),w=Gc(l,(0,u().K8)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),k=kc+w*i,R=(0,u().uB)(void 0,Vc().A),A=(0,u().K8)((()=>Ye().A.state?!0===R.state.dragging:hl().A.state.hoveredStore===t),[t,R]),I=m?7:5,T=(0,p().IS)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:h?0:6,paddingRight:f?0:6,width:f?`calc(100% / ${I} * ${r} - 1px)`:`calc(100% / ${I} * ${r})`,left:`calc(100% / ${I} * ${s})`,height:w,top:k},haloStyle:{...V().wh(e,b),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:h?0:5,marginRight:f?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.shadowSM,...f&&{borderTopRightRadius:0,borderBottomRightRadius:0},...h&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},...C&&{opacity:.5}},linkBoxHoveredStyle:{opacity:C?.5:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,f,w,I,b,s,h,k,C]),j=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?wc().jo({environment:y,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:g,transaction:e.transaction}):[]}),[g,v,y,t]),_=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&Ct().by({childStore:t,transaction:o})}),[t]),[B,P]=(0,u().K8)((()=>{const{mainEditorCurrentBlockStore:e}=jt().default.state,o=V().wy({environment:y,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,sl().Ay)({store:t,fullyQualified:!1,pageVisitSource:Vo().y8.LinkInPage}),o]}),[y,v,t]),M=(0,u().O$)(v.isInHomeWidgetStore);return(0,G.jsx)(gt().Ay,{store:t,style:T.selectable,canSelect:!c,shouldShowHalo:!(M||null!=x&&x.isPreviewing),shouldForceRenderSelectionHalo:b,haloStyle:T.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:d,onInsertAbove:j,onInsertBelow:j,onRemove:_,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:Be().E4t,draggableStore:R,children:(0,G.jsx)(Kl().A,{style:T.linkBoxStyle,hoveredStyle:T.linkBoxHoveredStyle,pressedStyle:T.linkBoxHoveredStyle,innerStyle:T.linkBoxInnerStyle,onClick:S,href:B,metaHref:P,hovered:A,disableForOffline:C,children:o})},t.id)}const Hc=24,Wc=36;function Gc(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?Wc:Hc)+e*Bc().CL+2*Lc+2*Oc}function Nc(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:s,end:c,endOfWeek:d,includeTime:g,propertySchema:m}=e,S=(0,a().v3)(),h=l<s,f=c&&c>d,y=(0,u().K8)((()=>(0,ue().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),v="time_format"in m?m.time_format:yc().CE,[x,b,C]=(0,u().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),w=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&T().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:S,canUndo:!0,perform:t=>{Go().KY({store:o,value:e,transaction:t})}})}),[S,t]),k=(0,u().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),R=(0,p().IS)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...h&&{paddingLeft:12},...f&&{paddingRight:11},width:"100%",...k?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:Wc,paddingTop:2}:{height:Hc,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:Fo().Wy.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:k?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:k?2:4,fill:e.palette.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:k?2:4},timeStyle:{color:e.text.secondary,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:k?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[f,h,k]),A=g&&c&&r().IX.fromDateTimes(s,d).contains(c)&&l.day!==c.day,I=(0,u().K8)((()=>o.shouldShowPageIcon()&&(void 0!==x||!b)&&!C),[o,x,b,C]),j=(0,u().K8)((()=>(0,ls().Te)(t)),[t]);return(0,G.jsxs)("div",{style:R.titleContainer,children:[I&&(i?(0,G.jsx)(ls().B6,{disabled:!0,icon:x,iconRecordCategory:j,isEmptyPage:b,size:14,style:R.recordIconStyle}):(0,G.jsx)(ls().B6,{disabled:!1,store:t,bucket:"secure",icon:x,iconRecordCategory:j,isEmptyPage:b,size:14,style:R.recordIconStyle,onChange:w})),C&&(0,_c().Q)(R.iconWarningStyle),(0,G.jsx)($c,{store:t,titlePropertyIsWrapped:k}),y&&(0,G.jsx)("div",{style:R.subitemCountIndicatorContainer,children:(0,G.jsx)(zl().W,{blockStore:t,collectionContextStore:o,wrapperStyle:R.subitemsWrapperStyle})}),g&&r().IX.fromDateTimes(s,d).contains(l)&&(0,G.jsxs)("div",{style:R.timeStyle,children:[(0,jc().PS)({dateTime:l,humanReadable:!1,timeFormat:v}),A&&(0,G.jsxs)("span",{children:[" → ",(0,jc().PS)({dateTime:c,humanReadable:!1,timeFormat:v})]})]}),(0,G.jsx)(Mc().A,{store:t,shouldWrap:k})]})}function $c(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,p().IS)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.text.tertiary,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,G.jsx)(Ol().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function Uc(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,se().ET)(),s=(0,u().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[a,c]=(0,u().K8)((()=>[V().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return a?(0,G.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,G.jsx)(os().BlockPropertyRouter,{store:t,property:e,disabled:r,locked:s,format:"calendar",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:a,collectionViewStore:c},e)))}):null}function Xc(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:s,calendarBy:c}=e,d=(0,a().v3)(),u=(0,p().IS)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),g=(0,n.useCallback)((e=>{wc().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:c})}),[o,c]),m=(0,n.useCallback)((()=>{T().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:d,canUndo:!0,perform:e=>{wc().eW({environment:d,transaction:e,calendarStore:o,calendarBy:c})}})}),[c,o,d]),S=(0,n.useCallback)((()=>{wc().Pt({calendarStore:o})}),[o]),h=r>=i&&(0,G.jsx)(Pc().A,{render:e=>(0,G.jsx)("div",{style:u.leftDragHandle,...e}),onDraggableDragStart:()=>{wc().v7({calendarStore:o,targetStore:t,direction:fc().Q.Left})},onDraggableDragMove:g,onDraggableDragEnd:m,onDraggableDragCancel:S}),f=(!l||l&&l<s)&&(0,G.jsx)(Pc().A,{render:e=>(0,G.jsx)("div",{style:u.rightDragHandle,...e}),onDraggableDragStart:e=>{wc().v7({calendarStore:o,targetStore:t,direction:fc().Q.Right})},onDraggableDragMove:g,onDraggableDragEnd:m,onDraggableDragCancel:S});return(0,G.jsxs)(G.Fragment,{children:[h,f]})}function qc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:s,collectionContextStore:c,collectionViewStore:d,currentlyViewedMonth:g,endOfWeek:m,format:S,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,items:v,propertySchema:x,schema:b,shouldShowShimmer:C,showWeekends:w,sortedResultsStore:R,startOfWeek:A}=e,I=(0,a().v3)(),{isDragging:T,targetStore:j,temporaryValue:_}=(0,u().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:B,targetStoreCollectionStoreCalendarBy:P}=(0,u().K8)((()=>{const e=null==j?void 0:j.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[j,r]),M=(0,n.useCallback)((()=>{He().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),k().Ey({collectionContextStore:c,resultsStore:R});const e=c.normalizedFormatStore.state.collection_peek_mode,t=e||xl().C9.calendar;fl().bn(I,{is_peek:!0,from:"calendar",peek_mode:t})}),[c,I,R]),F=w?7:5,V=(0,n.useMemo)((()=>{const e=[];v.forEach((o=>{const n=me().Bv.createChildStore(d,{table:$().ev,id:o.id});T&&j===n&&_||e.push((0,G.jsx)(Yc,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:c,endOfWeek:m,format:S,handleOpenPeekPage:M,item:o,schema:b,showWeekends:w,startOfWeek:A,store:n},o.id))}));const o=T&&_&&(0,pc().uo)(_,(0,zn().P)());if(T&&_&&o&&(0,yc().m6)(A,m,o.start,o.end)&&j&&null!=j&&j.id){const n=v.find((e=>e.id===j.id));e.push((0,G.jsx)(Yc,{blockPropertyValueOverlayStore:t,calendarBy:P??r,calendarStore:i,collectionContextStore:c,endOfWeek:m,format:S,handleOpenPeekPage:M,schema:B??b,showWeekends:w,startOfWeek:A,store:j,item:{id:j.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===_.type||"datetimerange"===_.type}},j.id))}return e}),[t,r,i,c,d,m,S,M,T,v,b,w,A,j,P,B,_]),L=(0,n.useMemo)((()=>Math.max(0,...v.map((e=>e.row)))),[v]),O=(0,u().K8)((()=>(0,ue().jz)({collectionContextStore:c})),[c]),E=(0,p().IS)((()=>{const e=(S.calendar_properties?S.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(O?1:0),t="week"===l?372:124,o=Gc(e,S);return{container:{position:"relative",display:"flex",height:Math.max((L+1)*o+kc+4,t)}}}),[l,S,L,O]);return(0,G.jsxs)("div",{style:E.container,children:[[...Array(F).keys()].map((e=>{const t=(0,pc().K1)({date:A,daysToAdd:e});return(0,G.jsx)(Tc,{blockStore:o,calendarStore:i,collectionContextStore:c,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:g,canEditCalendar:s,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,propertySchema:x,calendarViewRange:l,shouldShowShimmer:C},e)})),V]},A.toString())}function Yc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:s,item:a,schema:c,showWeekends:d,startOfWeek:p,store:g}=e,{canEdit:m,collectionStore:S}=(0,u().K8)((()=>({canEdit:g.canEdit(),collectionStore:g.getAssociatedCollectionStore()})),[g]),{collectionStoreSchema:h,collectionStoreCalendarBy:f}=(0,u().K8)((()=>({collectionStoreSchema:null==S?void 0:S.getSchema(),collectionStoreCalendarBy:null==S?void 0:S.getMappedProperty(o)})),[S,o]);return S?(0,G.jsx)(Dc,{collectionContextStore:r,store:g,startOfWeek:p,endOfWeek:i,showWeekends:d,start:a.start,end:a.end,row:a.row,includeTime:a.includeTime,format:l,schema:h??c,calendarBy:f??o,disabled:!m,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:s},g.id):null}const Qc=(0,n.memo)(qc);function Zc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:s,isInHomeWidget:c,isInPeekRenderer:d,isTypedMsvCollection:g,query:m,resultStore:S,schema:h,sortedResultsStore:f,weeks:y}=e,{isPhone:v}=(0,a().Y0)(),x=(0,u().K8)((()=>{var e,t;return(void 0===(null===(e=S.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=S.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Sn().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,S]),{collectionViewStore:b,calendarViewRange:C,showWeekends:w}=(0,u().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var k;y&&y.length>0&&(null===(k=i.databaseItemsVisibleTracker)||void 0===k||k.handleItemsRenderStart());const R=(0,p().IS)((e=>({container:v?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[v]),{calendar_by:A}=m;if(!A)return null;const I=h[A];return I&&b?(0,G.jsx)("div",{style:R.container,children:y&&y.map((e=>v?(0,G.jsx)(Cc,{blockPropertyValueOverlayStore:t,calendarBy:A,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:s,items:e.items,query:m,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start):(0,G.jsx)(Qc,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:A,calendarStore:n,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,collectionViewStore:b,currentlyViewedMonth:l,endOfWeek:e.end,format:s,isInHomeWidget:c,isInPeekRenderer:d,isTypedMsvCollection:g,items:e.items,propertySchema:I,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start)))}):null}const Jc=(0,n.memo)(Zc);var ed=()=>o(662303),td=()=>o(287940);const od=(0,vt().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}}),nd=n.memo((function(e){const{currentlyViewedMonth:t,calendarViewRange:r,setNewCalendarStart:i,isInHomeWidget:l,dateRangeStart:s,isInPeekRenderer:c,stickyStyle:d,collectionContextStore:g,weeks:m,userSettingsStartOfWeekStore:S}=e,h=(0,vt().tz)(),{isPhone:f}=(0,a().Y0)(),y=(0,n.useRef)(null),v=(0,V().Oz)(g),x=(0,u().K8)((()=>{const e=S.state,t=g.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_show_weekends").getValue())??!0?(0,jc().zI)(e,ed().locale):(0,jc().rj)(ed().locale)}),[g,S]),b=(0,n.useMemo)((()=>{const e=(0,jc().W_)(t,"month_year_long",ed().locale);if("month"===r)return e;if(!m||void 0===m[0])return"";const o=m[0];if((0,pc().vY)({firstDate:o.start,secondDate:o.end}))return e;return`${(0,jc().W_)(o.start,(0,pc().St)({firstDate:o.start,secondDate:o.end})?"month_short":"month_year_short",ed().locale)} - ${(0,jc().W_)(o.end,"month_year_short",ed().locale)}`}),[t,r,m]),C=(0,n.useCallback)((()=>{const e=S.state,t="month"===r?(0,pc().mK)((0,pc().Mw)(Date.now()),e):(0,pc().mK)(Date.now(),e);i({newCalendarStart:t,calendarViewRange:r,startOfWeek:e})}),[r,i,S]),w=(0,n.useCallback)((e=>{const t=S.state,o=(0,pc().to)(s,t);if("month"===r){const n="left"===e?-1:1,l=(0,pc().mK)((0,pc().Mw)((0,pc().AQ)({date:o,monthsToAdd:n})),t);i({newCalendarStart:l,calendarViewRange:r,startOfWeek:t})}else{const o="left"===e?-7:7,n=(0,pc().mK)((0,pc().K1)({date:s,daysToAdd:o}),t);i({newCalendarStart:n,calendarViewRange:r,startOfWeek:t})}}),[S,s,r,i]),k=(0,n.useCallback)((()=>{w("left")}),[w]),R=(0,n.useCallback)((()=>{w("right")}),[w]),A=(0,p().IS)((e=>{const t=f?e.contentBackground:null!=v&&v.background?v.background:c?e.cardContentBackground:e.contentBackground;return{container:{...!l&&{position:"absolute",left:0,right:0,zIndex:85,background:t}},icon:{width:Po().Ev.default,height:Po().Ev.default},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:Fo().Wy.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:f?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:f?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.text.tertiary,height:24}}}),[v,l,c,f]);return(0,G.jsx)(Qr().g,{stickyAttachPoint:l?"no-stick":"ceiling",nodeRef:y,stickyStyle:d,transitionStickyStyle:d,absoluteHeight:98,children:(0,G.jsxs)("div",{style:A.container,ref:y,children:[(0,G.jsxs)("div",{style:A.monthSwitcher,children:[(0,G.jsx)("div",{style:A.monthHeader,children:b}),(0,G.jsx)("div",{style:A.spacer}),(0,G.jsx)(td().A,{collectionContextStore:g,entrypoint:"calendar_view"}),(0,G.jsx)(Mt().A,{ariaLabel:h.formatMessage(od.previousMonthButtonAriaLabel),icon:o(879765).$,iconStyle:A.icon,onClick:k}),(0,G.jsx)(ln().p,{size:"sm",onClick:C,children:(0,G.jsx)(vt().sA,{...od.todayButtonLabel})}),(0,G.jsx)(Mt().A,{ariaLabel:h.formatMessage(od.nextMonthButtonAriaLabel),icon:o(222334).arrowChevronSingleRightIcon,iconStyle:A.icon,onClick:R})]}),(0,G.jsx)("div",{style:A.weekdayNamesContainer,className:Be().VO,children:x.map((e=>{let[t,o]=e;return(0,G.jsx)("div",{style:A.weekdayName,children:o},t)}))})]})})})),rd=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:s,query:m,schema:S,isFullScreen:h,isInPeekRenderer:f,isPreviewing:y,maxHeight:x,minWidth:b,paddingBottom:C,paddingLeft:w,paddingRight:k}=e,I=(0,vt().tz)(),j=(0,a().v3)(),_=j.currentUser.id,{isPhone:B,isMobile:P}=(0,a().Y0)(),{value:M}=(0,ge().fJ)(Te().T.formulas),F=(0,n.useRef)(null),L=(0,n.useRef)(null),O=(0,o(93583).A)(L,F),E=(0,u().uB)(void 0,fc().a),D=(0,u().uB)(void 0,g().Store),z=(0,u().K8)((()=>r.collectionViewStore()),[r]),H=null==z?void 0:z.id,W=(0,u().K8)((()=>r.collectionStore()),[r]),N=(0,Ke().bx)(i,!1),U=(0,u().O$)(Ye().A),X=(0,u().O$)(r.isLoadingStore),q=(0,u().K8)((()=>"collectionTypedView"===r.contextType),[r]),Y=(0,u().O$)(r.isInHomeWidgetStore),Q=(0,u().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),Z=(0,u().O$)(r.dateRangeStartStore),J=(0,u().O$)(r.dateRangeEndStore),ee=(0,u().O$)(r.permissionScopesStore),te=(0,u().O$)(E),{dayStoreMap:oe,startingMonth:ne,isDragging:re}=te,ie=re?void 0:te.hoveredDay,le=N&&(ee.canEditContent||q),se=(0,u().K8)((()=>{var e;return(null==z||null===(e=z.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[z]),ae=h&&!P&&"month"===se,ce=(0,u().K8)((()=>{const e=_e().XX.state;return ae||!Z?ne:(0,pc().Mw)((0,pc().to)(Z,e))}),[ae,Z,ne]),de=(0,u().K8)((()=>(0,Sc().j2)({collectionContextStore:r})),[r],{useDeepEqual:!0}),ue=(0,u().K8)((()=>{if(!z)return[];const e=D.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>me().Bv.createChildStore(z,{id:e,table:$().ev})))||[];return(0,Sc().oq)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:I,formulasModule:M})}),[z,D,r,i.getRecordValue,I,M],{useDeepEqual:!0}),pe=(0,u().r6)((()=>z&&ue&&(null==ue?void 0:ue.flatMap((e=>e.items.map((e=>me().Bv.createChildStore(z,{table:$().ev,id:e.id}))))))||[]),[z,ue],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,u().O$)(pe);const[Se,he]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=F.current)&&void 0!==e&&e.parentElement&&he((0,K().NM)(F.current.parentElement))}),[]);const fe=(0,n.useCallback)((e=>{const{newCalendarStart:t,calendarViewRange:o,startOfWeek:n}=e,i=(0,pc().to)(t,n);let l;"month"===o?(l=ae?(0,pc().to)((0,pc().AQ)({date:i,monthsToAdd:1}),n):(0,pc().to)((0,pc().Xf)(i),n),Se&&ae&&(Se.scrollTop=0)):l=i,(0,gc().r)({dateRangeStart:t,dateRangeEnd:l,collectionContextStore:r}),E.update((e=>({...e,startingMonth:(0,pc().Mw)((0,pc().to)(t,n))}))),H&&(0,hc().LQ)({newCalendarStart:t,newCalendarEnd:l,collectionViewId:H,currentUserId:_})}),[r,E,ae,Se,H,_]),ye=(0,n.useCallback)((()=>{W&&W.isDefined()&&z&&ee.canConfigureBlock&&T().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:j,canUndo:!0,perform:e=>{let t,o=V().zv(S);if(!o&&ee.canConfigureCollection){o=(0,Oo().Ay)();t={[o]:{name:I.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&((0,fr().f)({collectionViewStore:z,update:{calendar_by:o},transaction:e}),Go().zv({store:z,data:{type:"calendar"},transaction:e}),t&&(0,Uo().F)({environment:j,collectionStore:W,update:t,transaction:e}))}})}),[W,z,j,I,ee.canConfigureBlock,ee.canConfigureCollection,S]),ve=(0,n.useCallback)((e=>{if(!z||!H)return;const t=(0,hc().dI)({collectionViewId:H,currentUserId:_}),o=e.state,n=(0,pc().mK)(t,o),r=(0,pc().mK)(new Date((0,pc().to)(t,o)).getDate()>7?(0,pc().Mw)(t):t,o),i="month"===se?r:n;E.update((e=>({...e,startingMonth:r.valueOf()}))),fe({newCalendarStart:i,calendarViewRange:se,startOfWeek:o})}),[z,H,_,se,E,fe]),xe=(0,n.useCallback)((()=>{if(!L.current||!ae)return;const e=v().Ul(Array.from(oe.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=L.current.getBoundingClientRect(),n=e.find((e=>{let{store:n}=e;const r=o(695625).T.getRectFromStore(n);if(!r)return;const i=(null==Se?void 0:Se.scrollTop)??0,l=r.top<=t.top+i,s=r.bottom>=t.top+i;return l&&s}));if(n){const e=_e().XX.state,t=(0,pc().Mw)((0,pc().K1)({date:(0,pc().to)(n.timestamp,e),daysToAdd:1}));t!==ne&&E.update((e=>({...e,startingMonth:t})))}}),[E,oe,ae,ne,null==Se?void 0:Se.scrollTop]),be=(0,Hi().d)(xe,100),Ce=(0,n.useCallback)((e=>{if(e<Xe().A.incrementScrollOffset&&!X&&ae){const e=_e().XX.state,t=(0,pc().to)((0,pc().AQ)({date:J,monthsToAdd:2}),e);(0,gc().r)({dateRangeStart:Z,dateRangeEnd:t,collectionContextStore:r})}}),[r,J,Z,X,ae]),we=(0,n.useCallback)((e=>{const{target:t}=e;!B&&t instanceof HTMLElement&&(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:j,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[j,B,i]),ke=(0,n.useCallback)((e=>{if(!U&&(0,Sc().kc)(te)){const t=function(e,t){A().AP();const{selectableRectMap:n}=o(666710).default.state,r=Array.from(oe.keys()),i=Array.from(oe.values());for(const[o,l]of n.entries())if(l&&mc().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>oe.get(e)===o.props.store))}(e.clientX,e.clientY);ie!==t&&E.update((e=>({...e,hoveredDay:t})))}}),[E,te,oe,ie,U]),Ae=(0,Hi().d)(ke,100);(0,c().l)((()=>{ve(_e().XX),_e().XX.addListener(ve)})),(0,d().X)((()=>{_e().XX.removeListener(ve)})),(0,n.useEffect)((()=>{U&&(0,Sc().kc)(te)&&E.update((e=>({...e,hoveredDay:void 0}))),m.calendar_by||ye()}),[E,te,U,m.calendar_by,ye]),(0,n.useEffect)((()=>{const e=F.current,t=null==e?void 0:e.parentElement,o=Se;return t&&(Oe().P4(t,"mousemove",Ae),o&&Oe().P4(o,"scroll",be)),()=>{t&&Oe().Ol(t,"mousemove",Ae),o&&Oe().Ol(o,"scroll",be)}}),[Ae,be,Se]);const Ie=(0,p().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:x?x-(B?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...Y?{paddingTop:12}:{}},scrollOffset:Y?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...Y&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:C,paddingLeft:w,paddingRight:k,minWidth:b,...Y&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:w,paddingRight:k,minWidth:b}})),[Y,B,x,b,C,w,k]),je=(0,Re().Zp)(),Pe=(0,n.useCallback)((()=>(0,Ni().A)((e=>(0,G.jsx)(pi,{nodeRef:L,children:(0,G.jsx)(Gi().A,{onChange:Ce,style:Ie.scrollOffset,children:(0,G.jsx)("div",{ref:O,style:Ie.container,className:Be().G1r,children:(0,G.jsxs)(gt().Ay,{store:i,onMouseDown:we,style:Ie.selectable,shouldShowHalo:!h&&!Y&&!y,canSelect:!h&&!Q,analyticsName:"calendar",disablePointerEvents:null==je?void 0:je.disableAllPointerEvents,...e,children:[!(null!=je&&je.disableAllPointerEvents)&&(0,G.jsx)(nd,{collectionContextStore:r,weeks:ue,userSettingsStartOfWeekStore:_e().XX,dateRangeStart:Z,currentlyViewedMonth:ce,setNewCalendarStart:fe,calendarViewRange:se,isInHomeWidget:Y,isInPeekRenderer:f,stickyStyle:Ie.sticky}),Y?(0,G.jsx)(_o,{style:Ie.scroller,children:(0,G.jsx)(Jc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:E,resultStore:D,sortedResultsStore:pe,format:s,query:m,schema:S,weeks:ue,isInPeekRenderer:f,currentlyViewedMonth:ce,canEditCalendar:le,isInHomeWidget:Y,isTypedMsvCollection:q})}):(0,G.jsx)(Jc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:E,resultStore:D,sortedResultsStore:pe,format:s,query:m,schema:S,weeks:ue,isInPeekRenderer:f,currentlyViewedMonth:ce,canEditCalendar:le,isInHomeWidget:Y,isTypedMsvCollection:q})]})})})})))),[t,i,E,se,le,r,ce,Z,s,we,Ce,h,Y,f,y,Q,q,O,je,m,D,S,fe,pe,Ie.container,Ie.scrollOffset,Ie.scroller,Ie.selectable,Ie.sticky,ue]),{calendar_by:Me}=m;if(!Me)return(0,G.jsx)(id,{collectionContextStore:r,isFullScreen:h,paddingBottom:C,paddingLeft:w,paddingRight:k});const Fe=S[Me];return Fe&&Xo().$L(Fe)?de?(0,G.jsx)(In().A,{id:"calendar_results",resultStore:D,collectionContextStore:r,reducer:de,render:Pe}):null:(0,G.jsx)(id,{collectionContextStore:r,isFullScreen:h,paddingBottom:C,paddingLeft:w,paddingRight:k})}));function id(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,s=(0,u().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),a=(0,p().IS)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,G.jsx)(Us().Ay,{style:a.container,title:(0,G.jsx)(vt().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:s?(0,G.jsx)(vt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,G.jsx)(Us().P6,{onClick:()=>{C().Ow({collectionContextStore:t,collectionSettingsStore:l}),C().a2({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,G.jsx)(vt().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var ld=()=>o(157071);var sd=()=>o(872539);function ad(e){const t=(0,a().v3)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:s,subitemPath:c,indentLevel:d,onSubitemCreate:g}=e,m=(0,u().K8)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),S=(0,u().K8)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),h=(0,uo().Sm)(o),f=(0,u().K8)((()=>(0,P().si)({columnIndex:0,titleColumnIndex:0,indentLevel:d,isSubitemToggleOnTitleColumn:S})),[d,S]),y=(0,H().X)("db_ux_chrome"),v=(0,p().IS)((t=>({newRowButtonWrapper:{...y?{display:"flex",alignItems:"center",height:36,width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...m&&{borderTop:"none"},...e.styles}:{display:"contents"}},newRowButton:{display:y?"inline-flex":"flex",alignItems:"center",fontSize:14,height:y?28:32,...y?{borderRadius:6,paddingLeft:6,paddingRight:8,marginLeft:22}:{width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...m&&{borderTop:"none"},...e.styles}},newRowButtonHovered:{...!y&&{backgroundColor:t.tableRowHoveredBackground}},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:f+8,color:t.text.tertiary},newIcon:{width:Po().Ev.sm,height:Po().Ev.sm,marginRight:6,fill:t.icon.tertiary},newText:{color:t.text.tertiary}})),[f,m,e.styles,y]),x=(0,u().K8)((()=>r.isSystemCollection()),[r]),b=(0,u().K8)((()=>{const e=r.permissionScopesStore.state,t=s.isSyncedCollection();return(!i||x)&&e.canEditContent&&!t}),[r,i,s,x]),C=(0,n.useCallback)((e=>{x?T().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.createdPage",environment:t,canUndo:!0,perform:e=>{const n=sd().$n({environment:t,store:o,transaction:e,navigateToParent:!1,from:"library"});n&&g(n)}}):(T().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=(0,vl().u)({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:s,transaction:n,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&g(i)}}),function(e,t){(0,_().v)(e,"create_subitem",t)}(t,{...(0,Me().sl)(r)}))}),[r,t,l,s,o,c,g,x]);return!b||h?null:(0,G.jsx)("div",{style:v.newRowButtonWrapper,children:(0,G.jsx)(Pt().A,{onClick:C,onMouseDown:Oe().tr,style:v.newRowButton,hoveredStyle:v.newRowButtonHovered,children:(0,G.jsxs)("span",{style:v.newRowContainer,children:[(0,qo().plusSmallIcon)(v.newIcon),(0,G.jsx)("span",{style:v.newText,children:x?(0,G.jsx)(vt().sA,{defaultMessage:"Add new",id:"database.tableView.nest.addNew"}):(0,G.jsx)(vt().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})})}var cd=()=>o(996494),dd=()=>o(372267);const ud=n.memo((function(e){const{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:s,collectionContextStore:c,disabled:d,isEditing:p,mouseIsEntered:g}=e,m=(0,a().v3)(),S=(0,u().K8)((()=>V().Dj({store:l,collectionContextStore:c})),[l,c]),h=(0,u().K8)((()=>c.collectionViewStore()),[c]),f=(0,u().O$)(c.isInHomeWidgetStore),y=(0,u().O$)(c.isUnlistedViewStore),v=(0,u().O$)(c.isInlineViewStore),{isLocked:x,canEditContent:b}=(0,u().O$)(c.permissionScopesStore),C=(0,n.useMemo)((()=>{if("title"!==t)return!1;return g&&!f&&!(y&&v)}),[f,v,y,g,t]),w=(0,u().K8)((()=>l.canEdit()),[l]),k=p||f,R=(0,n.useCallback)((async()=>ld().V_(m,i,l,s,r,c,p)),[m,i,l,s,r,c,p]),A=(0,n.useCallback)((async()=>ld().Un(m,i,l,s,r,c,p)),[m,i,l,s,r,c,p]),I=(0,n.useCallback)((()=>ld().lY(m,i,l)),[m,i,l]),T=(0,n.useCallback)((()=>ld().PH(l)),[l]);return S?(0,G.jsx)(os().BlockPropertyRouter,{store:l,property:t,propertyIndex:o,disabled:d||!w,locked:x||!b,format:"list",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:S,collectionViewStore:h,forceMouseEntered:C,showIfEmpty:k,onBgClick:I,onEnter:I,onEsc:I,onTab:A,onUntab:R,onClick:T},t):null}));function pd(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,u().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=ke().A.isMobile,l=(0,H().X)("db_ux_mobile"),s=(null==n?void 0:n.length)??0,a=Math.max((s-1)*ue().yy,0)+ue().Pi,c=(0,p().IS)((()=>({noToggleIndent:{minWidth:a+ue().yy},toggleIndent:{minWidth:a},container:{paddingTop:i&&l?8:4,display:"flex"}})),[a,l,i]);return r?o?(0,G.jsxs)("div",{style:c.container,children:[(0,G.jsx)("div",{style:c.toggleIndent}),o]}):(0,G.jsx)("div",{style:c.noToggleIndent}):null}const gd=n.memo(n.forwardRef((function(e,t){const r=(0,vt().tz)(),{store:i,schema:l,blockPropertyValueOverlayStore:s,handleOpenPeekPage:c,collectionContextStore:g,onShiftEnter:m,toggleButton:S,subitemPath:h,showProperties:f,disabled:y}=e,v=(0,a().v3)(),{isMobile:x,isPhone:b}=(0,a().Y0)(),C=(0,H().X)("db_ux_mobile"),w=(0,u().K8)((()=>g.shouldShowPageIcon()),[g]),k=(0,n.useRef)(null),R=(0,n.useRef)(null),[A,T]=(0,n.useState)(!1),[j,_]=(0,n.useState)(!1),[B,P]=(0,n.useState)(!1),[M,F]=(0,n.useState)(!1),V=(0,u().K8)((()=>{const e=bl().A.state;return Boolean(e.isActive&&e.store.id===i.id)}),[i.id]),L=(0,u().K8)((()=>{const e=cd().A.state;return e.store&&e.store.id===i.id?e.editMode:void 0}),[i.id]),O=(0,Hi().d)((()=>{Ye().A.state||F(!0)}),100),E=(0,vn().Y)((()=>{F(!1)}),100),D=(0,Hi().d)((()=>{P(!0)}),100),z=(0,Hi().d)((()=>{_(!0)}),100),K=(0,u().K8)((()=>Se().default.state.stores.length>0&&Se().default.state.stores[0].id===i.id),[i.id]),W=(0,n.useCallback)((()=>{const e=dd().NK({environment:v,store:i,collectionContextStore:g});e&&(c(),rl().oo({environment:v,url:e}))}),[v,c,i,g]),N=(0,u().K8)((()=>i.getBlockTitleStore()),[i]),$=(0,u().K8)((()=>dd().uM(i)),[i]),U=(0,u().K8)((()=>dd().NK({environment:v,store:i,collectionContextStore:g})),[v,i,g]),X=(0,u().K8)((()=>f.map((e=>i.getPropertyValue(e)))),[f,i]),q=(0,n.useCallback)((()=>{ld().zU(i,c)}),[i,c]),Y=(0,n.useCallback)((()=>{R.current&&T(R.current.scrollWidth>R.current.clientWidth)}),[]),Q=(0,Hi().d)(Y,100),Z=(0,u().K8)((()=>(0,Sl().W)(v,i.id)),[v,i]),J=as().kG+as().mA,ee=(0,p().IS)((e=>({container:{display:"flex",position:"relative"},linkBox:{position:"relative",...dd().nq(V?"multi":"single")},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:C?`1px solid ${e.stroke.secondary}`:`1px solid ${e.tableDividerColor}`,borderImage:C&&w?`linear-gradient(to right, transparent ${J+as().qR}px, ${e.stroke.secondary} ${J+as().qR}px) 1`:void 0},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:V?void 0:"none",WebkitUserSelect:V?void 0:"none"},mobileLinkBoxInner:{paddingLeft:C?as().qR:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:x&&C&&w?J-as().iH:x?0:6,paddingBottom:x&&C?6:x?0:4},hoveredStyle:{background:V?"transparent":e.buttonHoveredBackground},pressedStyle:{background:V?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.icon.tertiary,marginLeft:-2}})),[V,x,C,w,J]);(0,n.useEffect)((()=>{V&&"new"===L&&I().setSelectionAtEnd({store:N})}),[V,L,N]),(0,n.useEffect)((()=>(window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q))),[Q]),(0,n.useEffect)((()=>{Q()}),[Q,X]),(0,d().X)((()=>{cd().A.reset(),bl().A.reset()}));const te=(0,n.useMemo)((()=>f.indexOf("title")),[f]),oe=b&&f.length>0,ne=(0,G.jsx)(pd,{collectionContextStore:g,toggleButton:S,subitemPath:h}),re=(e,t)=>(0,G.jsx)(ud,{blockPropertyValueOverlayStore:s,collectionContextStore:g,disabled:y,isEditing:V,mouseIsEntered:M,property:e,propertyIndex:t,showProperties:f,schema:l,store:i},e);let ie;if(oe){const[e,t]=[f.slice(0,te+1),f.slice(te+1)];ie=(0,G.jsxs)("div",{style:ee.container,dir:"ltr",ref:k,children:[ne,(0,G.jsxs)(Kl().A,{ref:R,href:$,metaHref:U,external:!1,style:ee.mobileLinkBox,innerStyle:ee.mobileLinkBoxInner,disableForOffline:Z,children:[(0,G.jsx)("div",{style:ee.propertiesWithTitleContainer,children:e.map(re)}),t.length>0&&(0,G.jsx)("div",{style:ee.propertiesAfterTitleContainer,children:t.map(re)})]})]})}else{const e=r.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});ie=(0,G.jsx)(le().A,{debugName:"CollectionListViewItem",capture:K,onShiftEnter:m,children:(0,G.jsxs)("div",{style:ee.container,dir:"ltr",ref:k,onMouseEnter:z,onMouseLeave:()=>_(!1),children:[ne,(0,G.jsx)(Kl().A,{ref:R,href:$,metaHref:U,altHref:U,onClick:q,external:!1,style:ee.linkBox,innerStyle:ee.linkBoxInner,hoveredStyle:ee.hoveredStyle,pressedStyle:ee.pressedStyle,onMouseEnter:O,onMouseMove:O,onMouseLeave:E,disableForOffline:Z,children:f.map(re)}),A?(0,G.jsx)("div",{style:ee.overflowButtonArea,children:B||j?(0,G.jsx)(Ft().A,{renderTooltip:()=>e,placement:$e().W.Bottom,render:t=>(0,G.jsx)(Mt().A,{icon:o(569397).C,iconStyle:ee.overflowIcon,ariaLabel:e,style:ee.overflowButton,onClick:W,onMouseEnter:D,onMouseLeave:()=>P(!1),...t})}):null}):null]})})}return(0,Ke().NW)(i,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>i,getNode:()=>k.current,activate:W})),[i,W]),ie)})));function md(){return{marginTop:1,marginBottom:1}}const Sd=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:s,blockPropertyValueOverlayStore:c,paddingLeft:d,paddingRight:p,headerWidth:g,shouldShowShimmer:m}=e;const S=(0,a().v3)(),h=(0,n.useMemo)((()=>t?[t]:[]),[t]),f=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:y}=(0,u().K8)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),v=(0,u().K8)((()=>l.groupsStore.getGroupState(h)),[h,l]),x=(0,u().K8)((()=>!i&&o.canEdit()&&y.canEditContent&&!y.isSyncedCollection),[i,o,y]),b=(0,n.useCallback)((()=>{if(!v)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=Se().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,Kn().Qe)(o.children,(e=>e.value.store===t)),r=n?(0,ue().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),s=Boolean(null==i?void 0:i.isExpanded);T().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:S,canUndo:!0,perform:o=>{const r=(0,vl().u)({environment:S,collectionContextStore:l,groupsPointer:v.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:s?"into":"below",from:"list_selection_overlay_shift_enter"});r&&ld().v7({environment:S,newStore:r,previousStore:t})}}),(0,Gl().u)(S,"list_item_edit_mode_enter",{...(0,Me().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,S,v]),C=(0,n.useCallback)(((e,t)=>{ld().v7({environment:S,newStore:t,previousStore:e})}),[S]),w=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:c,collectionContextStore:l,disabled:i,onShiftEnter:b,schema:s,showProperties:f,collectionViewBlockStore:o})),[c,l,i,b,s,f,o]),k=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,G.jsx)(ad,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:h,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,cl().C)({store:e,transient:!1}),cd().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,h]);return v?(0,G.jsx)(_l,{collectionContextStore:l,groupsPointer:h,format:r,canDrag:x,resultProps:w,canDrop:!0,resultComponent:gd,disabled:i,shouldShowHoverMenu:!0,direction:Tl.Vertical,analyticsName:"list",getItemSelectableStyle:md,emptyDroppableSize:0,onSelectableInsertRow:C,nestedCreateSubitemButton:k,paddingLeft:d,paddingRight:p,headerWidth:g,shouldShowShimmer:m}):null}));const hd=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:s,isPreviewing:c,isRootChild:d,minWidth:g,disabled:m,collectionContextStore:S,headerWidth:h}=e,f=(0,a().v3)(),{isMobile:y}=(0,a().Y0)(),v=(0,p().DP)(),x=(0,u().K8)((()=>V().mM(S,s)),[S,s]),b=(0,u().K8)((()=>null==S?void 0:S.isInHomeWidgetStore.state),[S]),C=(0,u().K8)((()=>"collectionSystemView"===(null==S?void 0:S.contextType)),[S]),w=(0,u().K8)((()=>Boolean(S.viewsModuleContextStore.getViewModuleType())),[S]),k=o.collection_group_by,R=n.useCallback(((e,t,o)=>{if(y)No().uK({environment:f,store:e,pageVisitSource:Vo().y8.Create});else if(t)ld().v7({environment:f,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=S.groupsStore.getGroupState(n),i="collectionTypedView"===S.contextType;$o().VU({environment:f,store:e,peekMode:V().hH(S),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:S,pageVisitSource:Vo().y8.Create})}}),[S,f,y]),A=n.useCallback((e=>0===e.index?{}:{borderTop:`1px solid ${v.tableDividerColor}`}),[v]),I=n.useCallback((o=>(0,G.jsx)(Ds,{reducerId:"list_groups",store:t,collectionContextStore:S,disabled:m,isFullScreen:s,isRootChild:d,paddingLeft:i,paddingRight:l,headerWidth:h,stickyLeft:!1,renderGroup:t=>(0,G.jsx)(yd,{...e,groupFormat:t}),getGroupStyle:A,renderHeader:e=>(0,G.jsx)(fd,{args:e}),onGroupHeaderAddItem:R})),[S,m,A,R,s,d,i,l,h,e,t]),T=n.useCallback((e=>{const t=S.isLoadingStore.state,o=S.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===S.contextType)return;const n=o.reducerResultStore.state;e<Xe().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,Wi().H)({collectionContextStore:S,environment:f,incrementLimitArgs:{isFullScreen:s,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[S,f,s]),j=(0,p().IS)((()=>({container:{paddingBottom:b?0:r,paddingLeft:i,paddingRight:l,minWidth:g},selectable:{display:"flex",flexDirection:"column",paddingTop:k||b||C?void 0:4,paddingBottom:4}})),[r,i,l,g,k,b,C]),_=(0,Re().Zp)();return(0,Ni().A)((o=>(0,G.jsxs)("div",{style:j.container,className:Be()._OD,children:[(0,G.jsx)(gt().Ay,{store:t,shouldShowHalo:!s&&!b&&!c,canSelect:!s&&!w,disablePointerEvents:null==_?void 0:_.disableAllPointerEvents,analyticsName:"list",style:j.selectable,...o,children:k?I(k):(0,G.jsx)(yd,{...e,groupFormat:k})}),!x&&(0,G.jsx)(Gi().A,{onChange:T})]})))}));function fd(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,u().O$)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,p().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,G.jsx)(ei,{...t,height:n?At().ag:48,stickyStyle:r})}const yd=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:s,isFullScreen:c,collectionContextStore:d,blockPropertyValueOverlayStore:g,paddingLeft:m,paddingRight:S,headerWidth:h}=e,{isMobile:f}=(0,a().Y0)(),y=(0,H().X)("db_ux_empty_states"),v=void 0!==s,x=n.useMemo((()=>s?[s]:[]),[s]),{groupState:b,isEmpty:C}=(0,u().K8)((()=>{const e=d.groupsStore.getGroupState(x);return{groupState:e,isEmpty:0===(null==e?void 0:e.resultsStore.state.length)}}),[d,x]),w=(0,u().O$)(null==b?void 0:b.reducerResultStore),k=""!==(0,u().O$)(d.searchQueryStore),R=(0,u().K8)((()=>(0,Eo().N1)({collectionContextStore:d,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[d]),A=(0,u().K8)((()=>d.groupsStore.anyGroupHasResults()),[d]),{canEditContent:I,isSyncedCollection:T}=(0,u().K8)((()=>{const e=d.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[d]),j=(0,u().K8)((()=>"collectionTypedView"===d.contextType),[d]),_=(0,u().O$)(d.isInHomeWidgetStore),B=y&&C&&(k||R),P=(0,u().K8)((()=>A&&!l&&t.canEdit()&&(I||j)&&!T&&!B),[A,l,t,I,j,T,B]),M=(0,u().K8)((()=>void 0!==w&&(null==w?void 0:w.blockIds.length)>0),[w]),F=(0,u().K8)((()=>(0,Sn().iv)({collectionContextStore:d,groupsPointer:x,hasPartialResults:M})),[d,x,M]),L=(0,u().K8)((()=>V().XQ({collectionContextStore:d,reducerResult:w,isFullScreen:c})),[d,w,c]),O=(0,p().IS)((e=>({container:{paddingBottom:s?_?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:f?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:s||_?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[s,_,f]);return b?(0,G.jsxs)("div",{style:O.container,children:[(0,G.jsx)(Sd,{groupFormat:s,store:t,format:r,disabled:l,collectionContextStore:d,schema:i,blockPropertyValueOverlayStore:g,paddingLeft:m,paddingRight:S,headerWidth:h,shouldShowShimmer:F}),F&&(0,G.jsx)(o(286993).c,{isFullScreen:c,hasGroups:v,hasPartialResults:M,hasSearchQuery:k,overrideNumShimmerRows:_&&!M?6:void 0}),P&&(0,G.jsxs)(G.Fragment,{children:[L&&(0,G.jsx)("div",{style:O.spacer}),(0,G.jsx)(vd,{collectionContextStore:d,isFullScreen:c,groupState:b,groupFormat:s})]}),L&&(0,G.jsx)(ol().jJ,{groupsPointer:x,store:t,collectionContextStore:d,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:O.groupLoadMoreButton,iconStyle:O.groupLoadMoreIcon})]}):null})),vd=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,vt().tz)(),d=(0,u().O$)(r.isInHomeWidgetStore),g=(0,u().K8)((()=>V().fG({collectionContextStore:r,environment:l,intl:c})),[r,l,c]),m=n.useCallback((()=>{if(!(0,nt().EF)(l))return void(0,nt().QY)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;T().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{ld().hn({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),S=(0,p().IS)((e=>({button:{display:"flex",alignItems:"center",height:(0,P().sG)({isMobile:s}),borderRadius:6,fontSize:d?14:16,color:e.text.tertiary,paddingLeft:4,paddingRight:12},icon:{...d?{width:12,height:12,marginLeft:10,marginRight:6}:{width:16,height:16,marginLeft:3,marginRight:8},fill:e.icon.tertiary},buttonContainer:{display:"flex"}})),[d,s]);return g?(0,G.jsxs)("div",{style:S.buttonContainer,children:[(0,G.jsxs)(Pt().A,{onClick:m,onMouseDown:Oe().tr,style:S.button,children:[(0,qo().plusSmallIcon)(S.icon),(0,G.jsx)(il().w,{collectionContextStore:r})]}),(0,G.jsx)(Pi().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,G.jsxs)(Pt().A,{style:S.button,...e,children:[(0,nl().arrowDiagonalUpRightIcon)(S.icon),(0,G.jsx)(vt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,G.jsxs)(Pt().A,{onClick:m,onMouseDown:Oe().tr,style:S.button,children:[(0,qo().plusSmallIcon)(S.icon),(0,G.jsx)(il().w,{collectionContextStore:r})]})}));class xd extends g().Store{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const bd=xd;var Cd=()=>o(675592);function wd(e){let{isPhone:t,elementWidth:o,paddingLeft:n,paddingRight:r,propertyWidths:i}=e;let l=o-n-r,s=0;for(let c=0;c<i.length;c++){if(l-=i[c]??0,s=c,l<=0)break}const a=s+1;return i.length>a+(t?2:5)}const kd=n.memo((function(e){let{collectionContextStore:t,tableProperties:r,paddingLeft:i,paddingRight:l,children:s}=e;const c=(0,a().v3)(),{isPhone:d}=(0,a().Y0)(),p=(0,n.useRef)(null),g=(0,n.useContext)(Ie().R),m=(0,n.useMemo)((()=>r.filter((e=>e.visible))),[r]),S=(0,u().K8)((()=>{var e;return null==g||null===(e=g.horizontalScroller)||void 0===e?void 0:e.getStore().state.element}),[g]),h=(0,u().K8)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),f=(0,u().K8)((()=>m.map((e=>(0,P().oe)({environment:c,propertyFormat:e})))),[c,m]),[y,v]=(0,n.useState)((()=>{var e;return wd({isPhone:d,elementWidth:(null==S||null===(e=S.deref())||void 0===e?void 0:e.clientWidth)??0,paddingLeft:i,paddingRight:l,propertyWidths:f})}));(0,n.useEffect)((()=>{t.virtualizedModule.setVirtualizedColumnsEnabled(y)}),[y,t]);const x=(0,n.useCallback)((e=>{W().default.state.open&&W().default.state.mode===o(868840).A||v(wd({isPhone:d,elementWidth:e.width,paddingLeft:i,paddingRight:l,propertyWidths:f}))}),[i,l,f,d]);(0,o(188709).tK)(p,x);const b=(0,n.useCallback)((e=>e+h>f.length-1?35:f[e+h]??35),[f,h]),C=(0,dl().Te)({enabled:y,count:m.length,estimateSize:b,scrollMargin:i,getScrollElement:()=>(null==S?void 0:S.deref())??null,getItemKey:e=>m[e].property||e,overscan:2,horizontal:!0}),w=C.getVirtualItems(),[k,R]=(0,n.useMemo)((()=>w.length>0?[w[0].start-i,C.getTotalSize()+i-w[w.length-1].end]:[0,0]),[w,C,i]),A=0===w.length?0:h+w[0].index,I=0===w.length?0:w[w.length-1].index+1,{propertiesInRange:T,propertiesInRangeIndices:j}=(0,n.useMemo)((()=>0===w.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:m.slice(A,I),propertiesInRangeIndices:Array.from({length:I-A},((e,t)=>A+t))}),[w.length,I,A,m]),_=(0,n.useMemo)((()=>({propertiesInRange:T,propertiesInRangeIndices:j,beforeWidth:k,afterWidth:R})),[R,k,T,j]);return(0,G.jsx)(Cd().Pr.Provider,{value:C,children:(0,G.jsx)(Cd().Z6.Provider,{value:y,children:(0,G.jsx)(Cd().Wm.Provider,{value:_,children:s})})})}));var Rd=()=>o(651124),Ad=()=>o(124311),Id=()=>o(316369),Td=()=>o(969197);const jd=Object.freeze({display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"});function _d(e){(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{}})}function Bd(e,t){return!e&&t}var Pd=()=>o(421107),Md=()=>o(831194);const Fd=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:s,propertyFormat:c,isHovered:d,aggregation:g,onChange:m}=e,S=(0,a().v3)(),{isMobile:h}=(0,a().Y0)(),f=(0,H().X)("db_ux_empty_states"),y=(0,H().X)("db_ux_chrome"),x=(0,vt().tz)(),[C,w]=(0,n.useState)(void 0),k=(0,n.useMemo)((()=>Boolean((null==c?void 0:c.width)&&c.width<100)),[c]),R=(0,u().K8)((()=>Mr(l,g)),[l,g]),A=(0,u().K8)((()=>{if(!g)return;return{type:"aggregation",filter:s?(0,Qn().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:s,timeZone:(0,zn().P)(),experimentService:zo().default}):void 0,aggregation:g}}),[i,s,g,l]),I=(0,n.useCallback)((e=>{let{aggregationType:t,enforceMaxAggregationLimit:o}=e;if(t){const e={aggregator:t,property:r,enforceMaxAggregationLimit:o};m(r,e),w(e),(0,b().X)({environment:S,collectionContextStore:l,action:"table_change_aggregation"})}else m(r,void 0),(0,b().X)({environment:S,collectionContextStore:l,action:"table_remove_aggregation"})}),[S,m,r,l]),T=(0,p().IS)((()=>({buttonContainer:{display:"flex",justifyContent:"flex-end",alignItems:y?"center":"flex-start",width:"100%",marginRight:f?4:0},buttonStyle:{display:"flex",alignItems:"center",...f?{justifyContent:"center",height:"75%",padding:"0px 6px",borderRadius:6}:{justifyContent:"flex-end",width:"100%",height:(0,P().sG)({isMobile:h}),paddingRight:8},overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[y,f,h]);(0,n.useEffect)((()=>{C&&!Mr(l,C)&&(0,v().n4)(g,C)&&w(void 0)}),[R,C,l,g]);const j=(0,n.useMemo)((()=>k&&null!=g&&g.aggregator?Pr().zY[(0,_r().V1)(g)]:void 0),[k,g]),_=(0,n.useMemo)((()=>{const e=null==A?void 0:A.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,Lo().Ix)(s)}:${r}:${t}`}),[s,r,null==A?void 0:A.aggregation]),B=(0,n.useCallback)((e=>A?(0,G.jsx)(In().A,{id:_,collectionContextStore:l,reducer:A,groupsPointer:s?[s]:void 0,render:o=>(0,G.jsx)(Ft().A,{alignment:k?$e().C.Center:$e().C.End,disableTooltip:!R&&!j,renderTooltip:()=>R?x.formatMessage(Lr.aggregationCalculating):j,render:n=>(0,G.jsx)(Pt().A,{disabled:t,style:T.buttonStyle,...(0,rn().A)(n,e),children:(0,G.jsx)(Vd,{resultStore:o,aggregation:g,schema:i,property:r,hideLabelText:k})})})}):f&&h?null:(0,G.jsx)(Pt().A,{disabled:t,style:T.buttonStyle,...e,children:(0,G.jsx)(Ld,{disabled:t,isHovered:d,hideLabelText:k})})),[f,A,_,l,h,s,t,T.buttonStyle,d,k,R,j,x,g,i,r]),M=(0,n.useCallback)((e=>{let{close:t}=e;return(0,G.jsx)(o(195071).A,{currentAggregation:g,property:r,schema:i,onChange:I,onClose:t,source:"tableAggregation"})}),[I,g,r,i]);return(0,G.jsx)("div",{style:T.buttonContainer,children:(0,G.jsx)(sn().Ay,{popupType:h?sn().z7.SlideUp:sn().z7.Popup,disabled:t,renderOrigin:B,render:M})})})),Vd=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:s}=e,c=(0,H().X)("db_ux_empty_states"),d=(0,se().ET)(),{isMobile:g}=(0,a().Y0)(),m=(0,p().IS)((e=>c?{container:{display:"flex",alignItems:"center"},valueStyle:{color:e.text.secondary,height:"100%"},aggregationTypeNameStyle:{fontWeight:500,color:e.text.tertiary,fontSize:g?12:10,textTransform:"uppercase",letterSpacing:1,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}:{container:{display:"flex",justifyContent:"center",alignItems:"center"},valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:g?12:10,textTransform:"uppercase",letterSpacing:1,color:e.text.secondary,marginTop:g?0:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}),[c,g]),S=(0,u().O$)(r),h=(0,n.useMemo)((()=>{if(!t)return;let e=Pr().SE[(0,_r().V1)(t)];return(0,_r().ET)(t.aggregator)&&(e=t.aggregator.groupName in Md().OR?Md().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:f,numberPrecision:y}=(0,u().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,Pr().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(685889).pg)(d,r),s=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),a=null==s?void 0:s[e.target_property];if("number"===(null==a?void 0:a.type)){const e=a.number_format,o=a.number_precision;return{numberFormat:e,numberPrecision:t?(0,Pr().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,d]);if(!h)return null;const v=(0,G.jsx)("span",{style:m.valueStyle,children:t&&(0,G.jsx)(Fr,{aggregation:t,collectionContextStore:d,children:S?(0,Pr().rv)({numberFormat:f,dateFormat:void 0,aggregation:t,userTimeZone:(0,zn().P)(),value:S.aggregationResult,numberPrecision:y}):void 0})},"value");return s?v:(0,G.jsxs)("div",{style:m.container,children:[(0,G.jsx)("span",{style:m.aggregationTypeNameStyle,children:h},"type"),v]})})),Ld=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,i=(0,H().X)("db_ux_empty_states"),{isMobile:l}=(0,a().Y0)(),s=(0,p().IS)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.text.tertiary},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.icon.tertiary},summationIcon:{width:12,marginTop:1,fill:e.icon.tertiary}})),[r]);return t||!n&&!l?null:(0,G.jsx)(Bt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:s.placeholderWrapper,children:(0,G.jsxs)("div",{style:s.placeholderWrapper,children:[r?(0,G.jsx)("span",{style:s.placeholderText,children:(0,o(514503).n)(s.summationIcon)},"placeholder"):(0,G.jsx)("span",{style:s.placeholderText,children:(0,G.jsx)(vt().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),!i&&(0,vi().b)(s.chevronIcon)]})})})),Od=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:s,query:c,schema:d,showPropertyFormats:g,showRightActionsSpacer:m,pageCount:S,style:h,paddingLeft:f,paddingRight:y,onMouseEnter:v,onMouseLeave:x,disableSticky:b}=e;const C=(0,a().v3)(),{isPhone:w,isMobile:k}=(0,a().Y0)(),R=(0,H().X)("db_ux_empty_states"),A=(0,p().DP)(),[I,T]=(0,n.useState)(!1),j=(0,u().K8)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:_,frozenPropertyFormats:B,unfrozenPropertyFormats:M}=(0,u().K8)((()=>{const e=g;let t=[],o=e;const n=(0,V().qi)(j);return void 0!==j&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[j,g]),F=(0,u().O$)(t.isInHomeWidgetStore),L=(0,u().K8)((()=>{var e;return Boolean(null===(e=c.aggregations)||void 0===e?void 0:e.length)}),[c.aggregations]),O=(0,n.useMemo)((()=>S>0&&!o),[S,o]),E=(0,u().O$)(Yt().A),D=(0,V().Oz)(t),z=(0,p().IS)((e=>{const t=F?void 0:(null==D?void 0:D.background)||(s?e.cardContentBackground:e.contentBackground);return{aggregationRow:{borderTop:!R||O?`1px solid ${e.tableDividerColor}`:"none",display:"flex",background:t,zIndex:85,fontSize:14,height:(0,P().sG)({isMobile:k})+(i&&!r?E:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...h},stickyStyle:{paddingLeft:f,paddingRight:y,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&m?32:0},innerContainer:{display:"flex"}}}),[F,null==D?void 0:D.background,s,R,k,i,r,E,h,f,y,o,m,O]),K=(0,u().K8)((()=>void 0!==j&&(0,P().wy)({environment:C,collectionContextStore:t,isPhone:w,theme:A})),[j,C,t,w,A]),W=(0,n.useCallback)((()=>{T(!0),null==v||v()}),[T,v]),N=(0,n.useCallback)((()=>{T(!1),null==x||x()}),[T,x]),$=(0,n.useCallback)((e=>{(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{}})}),[]),U=(0,n.useCallback)(((e,n)=>(0,G.jsx)(Ed,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:I,collectionContextStore:t,schema:d,query:c},e.property)),[t,o,r,I,c,d]),X=!F&&(L||i),q=(0,n.useRef)(null),Y=(0,G.jsx)(ut().s,{allowSelectionWithin:!1,style:z.aggregationRow,onMouseMove:W,onMouseLeave:N,onMouseDown:$,ref:q,children:(0,G.jsx)("div",{style:z.container,children:(0,G.jsxs)("div",{style:z.innerContainer,children:[void 0!==j&&(0,G.jsx)("div",{style:{...K,display:"flex"},children:B.map(U)}),M.map(((e,t)=>U(e,t+_)))]})})});return!(0,u().O$)(qe().e)?null:X?(0,G.jsx)(Qr().g,{stickyAttachPoint:b?"no-stick":"floor",stickyStyle:z.stickyStyle,nodeRef:q,children:Y}):Y})),Ed=n.memo((function(e){var t;let{propertyFormat:r,groupFormat:i,disabled:l,mouseEntered:s,collectionContextStore:c,query:d,schema:u}=e;const g=(0,a().v3)(),[m,S]=(0,n.useState)(!1),h=(0,H().X)("db_ux_empty_states"),f=(0,p().IS)((()=>({wrapper:{display:"flex",width:r.width}})),[r.width]),y=(0,n.useCallback)(((e,t)=>{(0,o(500733).I)({environment:g,collectionContextStore:c,query:d,property:e,newAggregation:t})}),[c,d,g]),v=!l&&(h?m:!!s),x=(0,n.useCallback)((()=>{S(!0)}),[S]),b=(0,n.useCallback)((()=>{S(!1)}),[S]);return(0,G.jsx)("div",{style:f.wrapper,onMouseEnter:x,onMouseLeave:b,children:(0,G.jsx)(Fd,{groupFormat:i,propertyFormat:r,disabled:l,isHovered:v,aggregation:null===(t=d.aggregations)||void 0===t?void 0:t.find((e=>e.property===r.property)),property:r.property,collectionContextStore:c,schema:u,onChange:y})})})),Dd=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,propertyFormats:s,hideDefaultButtonText:c,query:d}=e,{isMobile:g}=(0,a().Y0)(),m=(0,H().X)("db_ux_empty_states"),[S,h]=(0,n.useState)(0),f=(0,n.useCallback)((()=>{h(0)}),[]),y=(0,n.useCallback)((()=>{h(0)}),[]),v=(0,u().O$)(o.isInHomeWidgetStore),x=(0,u().K8)((()=>{var e;return Boolean(null===(e=d.aggregations)||void 0===e?void 0:e.length)}),[d.aggregations]),b=(0,p().IS)((e=>{const t=v?e.tableHomeDividerColor:e.tableDividerColor,{button:o,icon:n}=(0,P().BJ)({theme:e,isMobile:g,hideTextWithTransition:c,hideTextWithoutTransition:l}),r={fontSize:14,color:e.text.tertiary,display:"inline-flex",alignItems:"center",height:"100%",opacity:c?0:1,transition:"opacity 0.2s ease",...l&&{display:"none"}};return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`,paddingLeft:m?0:8},buttonHovered:{background:e.tableRowHoveredBackground},icon:n,firstRow:{...r,...!m&&{opacity:0!==S||c?0:1},height:"100%"},lastRow:{...!m&&{borderBottom:"none"},...m&&!x&&{marginBottom:6}},text:r}}),[c,l,S,x,m,v,g]);return 0===s.length?null:(0,G.jsxs)("div",{onMouseLeave:f,ref:t,children:[(0,G.jsx)(Pt().A,{className:Be().$0P,onClick:r,onMouseDown:Oe().tr,style:b.button,hoveredStyle:b.buttonHovered,onMouseEnter:y,children:(0,G.jsx)("span",{style:b.firstRow,children:m?(0,G.jsx)(zd,{propertyFormats:s,collectionContextStore:o,isRowHovered:0===S}):(0,G.jsxs)(G.Fragment,{children:[(0,qo().plusSmallIcon)(b.icon),(0,G.jsx)(il().w,{collectionContextStore:o})]})})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,a=S===n?1:0;return(0,G.jsx)(Pt().A,{className:Be().Mbm,onClick:r,onMouseDown:Oe().tr,style:{...b.button,...l&&b.lastRow},hoveredStyle:b.buttonHovered,onMouseEnter:()=>h(n),children:(0,G.jsx)("span",{style:{...b.text,...!m&&{opacity:a}},children:m?(0,G.jsx)(zd,{propertyFormats:s,collectionContextStore:o,isRowHovered:S===n}):(0,G.jsxs)(G.Fragment,{children:[(0,qo().plusSmallIcon)(b.icon),(0,G.jsx)(il().w,{collectionContextStore:o})]})})},n)}))]})})));function zd(e){const{propertyFormats:t,collectionContextStore:o,isRowHovered:n}=e;return(0,G.jsx)(G.Fragment,{children:t.map(((e,r)=>(0,G.jsx)(Kd,{propertyFormat:e,collectionContextStore:o,isRowHovered:n,isFirstColumn:0===r,showCellBorder:1===t.length||r!==t.length-1},e.property)))})}function Kd(e){const{propertyFormat:t,collectionContextStore:o,isRowHovered:n,isFirstColumn:r,showCellBorder:i}=e,l=(0,a().v3)(),s=(0,H().X)("db_ux_chrome"),{isMobile:c}=(0,a().Y0)(),d=(0,u().K8)((()=>(0,P().oe)({environment:l,propertyFormat:t})),[t,l]),g=(0,p().IS)((e=>({tableCell:{display:"flex",width:d,height:"100%",position:"relative",borderRight:i?`1px solid ${e.tableDividerColor}`:"none"},icon:{width:Po().Ev.sm,height:Po().Ev.sm,marginLeft:c?0:1,marginRight:7,fill:e.icon.tertiary},newPageLabel:{display:"flex",alignItems:"center",paddingLeft:8,minWidth:100,...s&&c&&{fontSize:17,color:e.text.tertiary}}})),[d,c,i,s]);return(0,G.jsx)("div",{style:g.tableCell,children:n&&r?(0,G.jsxs)("div",{style:g.newPageLabel,children:[(0,qo().plusSmallIcon)(g.icon),(0,G.jsx)(il().w,{collectionContextStore:o})]}):null})}var Hd=()=>o(40845),Wd=()=>o(634201),Gd=()=>o(60382),Nd=()=>o(713972);const $d={position:"absolute",display:"flex",opacity:.5,zIndex:81},Ud=function(e){const t=(0,n.useRef)(null),r=(0,n.useRef)(),i=(0,u().uB)(e.store,o(170253).A),l=(0,u().O$)(i),{direction:s,sectionedKeys:a,sectionStyles:c,keys:d,disableVerticalEdgeScroll:p,disableHorizontalEdgeScroll:g,disabled:m,renderKey:S}=e,h={..."horizontal"===s?Gs().Z0:Gs().Bb,...l.isDragging&&{position:"relative",zIndex:1,width:l.savedContainerRect.width,height:l.savedContainerRect.height},...e.style};function f(e){return"string"==typeof e?e:e.key}const y=(0,u().K8)((()=>d.map(((e,t)=>{const o=f(e),n=S(o,t,t===d.length-1);if(l.isDragging&&l.draggingKey===o){const{savedKeyRects:e,savedContainerRect:r,currentXOffset:i,currentYOffset:a}=l,c=e[t];let d,u;"vertical"===s?(d=(0,Hd().A)(c.top+a,r.top,r.top+r.height-c.height)-r.top,u=c.left-r.left):(d=c.top-r.top,u=(0,Hd().A)(c.left+i,r.left,r.left+r.width-c.width)-r.left);const p={...$d,left:u,top:d,width:c.width,height:c.height,zIndex:1};return(0,G.jsx)("div",{style:p,children:n},o)}}))),[d,S,s,l]);function b(){const{direction:o}=e;return!r.current&&t.current&&(r.current="vertical"===o?(0,K().NM)(t.current):(0,K().T8)(t.current)),r.current}const C=m?{}:{onDraggableDragCancel:()=>{l.isDragging&&i.reset()},onDraggableDragEnd:()=>{if(l.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:n,currentKeyPosition:r}=l;if(n!==r){const e=v().o8(t);e.splice(r,0,e.splice(n,1)[0]);const i=f(t[n]);o(e.map(f),{key:i,startPosition:n,endPosition:r})}e.onDragEnd&&e.onDragEnd(),i.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:n}=e,r=t.current;if(!r)return;if(!(r instanceof Element))return;const l=Nd().EV(o.target,(e=>Nd().vq(e)&&e.classList.contains(Be().wAf))),s=Nd().EV(o.target,(e=>e.parentNode===l));if(l&&s){const t=Wd().PE(r.children).indexOf(l),o=Wd().PE(l.children).indexOf(s);let c=0;const d=Object.keys(a);for(let e=0;e<t;e++)c+=a[d[e]].length;c+=o;const u=n[c];if("object"==typeof u&&!u.draggable)return;const p=r.getBoundingClientRect(),g=v().Bq(Object.keys(a).map(((e,t)=>a[e].map(((e,o)=>r.children[t].children[o].getBoundingClientRect()))))),m=b();if(m){const t=f(n[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),i.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:m.scrollLeft,startScrollY:m.scrollTop,currentKeyPosition:c,savedContainerRect:p,savedKeyRects:g})}}},onDraggableDragMove:t=>{!l.isDragging&&l.willDrag&&l.draggingKey&&(0,Gd().A)(t.startX,t.startY,t.currentX,t.currentY)>=De().tC[t.device]&&(i.setState({currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset,startScrollX:l.startScrollX,startScrollY:l.startScrollY,startKeyPosition:l.startKeyPosition,currentKeyPosition:l.currentKeyPosition,savedKeyRects:l.savedKeyRects,savedContainerRect:l.savedContainerRect,draggingKey:l.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const o=b();if(l.isDragging&&o){const{savedKeyRects:e,startScrollX:n,startScrollY:r}=l,s=o.scrollLeft-n,a=o.scrollTop-r,c=v().wq(e,(e=>(0,Gd().A)(t.currentX+s,t.currentY+a,e.left+e.width/2,e.top+e.height/2)));if(c){const o=e.indexOf(c);i.setState({...l,currentXOffset:t.diffX+s,currentYOffset:t.diffY+a,currentKeyPosition:o})}}}};return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(Pc().A,{...C,forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:p||"horizontal"===s,disableHorizontalEdgeScroll:g||"vertical"===s,render:o=>{let n=0;return(0,G.jsx)("div",{ref:t,style:h,...o,children:Object.entries(a).map((t=>{let[o,r]=t;const i=((e,t)=>(0,G.jsx)("div",{className:Be().wAf,style:null==c?void 0:c[e],children:t},e))(o,r.map(((t,o)=>((t,o)=>{const n=f(t),r=e.keys.map(f),i=S(n,o,r.length-1===o);let s="";if(l.isDragging){const{startKeyPosition:t,currentKeyPosition:n}=l;t===n?s="":"horizontal"===e.direction?n===o&&o<t?s=`inset 4px 0 ${ur().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(s=`inset -4px 0 ${ur().Ay.blueWithAlpha(.5)}`):"vertical"===e.direction&&(n===o&&o<t?s=`inset 0 4px ${ur().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(s=`inset 0 -4px ${ur().Ay.blueWithAlpha(.5)}`))}return(0,G.jsx)("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,x().HB)(e.direction),boxShadow:s},children:i},n)})(t,o+n))));return n+=r.length,i}))})}}),y]})};var Xd=()=>o(743176),qd=()=>o(59400),Yd=()=>o(404779),Qd=()=>o(377586);const Zd=(0,vt().YK)({addProperty:{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty.ariaLabel"}}),Jd=["relation"],eu=n.memo((function(e){const{collectionContextStore:t}=e,r=(0,a().v3)(),i=(0,vt().tz)(),l=(0,n.useRef)(null),s=(0,H().X)("db_ux_chrome"),c=(0,H().X)("db_ux_properties"),d=(0,u().O$)(t.normalizedSchemaStore),g=(0,n.useMemo)((()=>Object.keys(d).length<=1),[d]),m=(0,u().uB)(void 0,Ue().A),{open:S}=(0,u().O$)(m),h=(0,p().IS)((e=>{const t={display:"flex",alignItems:"center",justifyContent:"start",height:Ro().cR,width:"100%",paddingLeft:6,paddingRight:6,fontSize:ke().A.isMobile?Bc().hN:Bc().Mi};return{button:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"auto",padding:8,gap:6,fontSize:ke().A.isMobile?Bc().hN:Bc().Mi},iconStyle:{width:Po().Ev.sm,height:Po().Ev.sm,...s&&{width:g?Po().Ev.default:Po().Ev.sm,height:g?Po().Ev.default:Po().Ev.sm,fill:(0,Xd().P0)({theme:e,willShowOnTooltip:!1})}},longButton:t,longButtonAnchor:{...t,width:378},smallButton:{display:"flex",alignItems:"center",justifyContent:"center",width:ke().A.isMobile?32:28,height:ke().A.isMobile?32:28},popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"}}}),[s,g]),f=(0,n.useCallback)((()=>{l.current&&(0,K().$v)({element:l.current,environment:r,blockAlignment:"center",inlineAlignment:"nearest",behavior:"smooth",additionalPadding:{left:20,right:20}})}),[r]),y=(0,n.useCallback)((()=>{m.setState({...m.state,open:!1})}),[m]),v=(0,n.useCallback)((e=>{const{propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:s,selectOptions:a}=e;o(36629).nZ({environment:r,collectionContextStore:t,propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:s,selectOptions:a,from:"table",shouldOpenEditMenu:!c}),ke().A.isMobile&&!Jd.includes(n)?C().os({collectionSettingsStore:t.settingsStore}):y()}),[t,r,y,c]),x=(0,n.useCallback)((()=>{t.collectionStore()&&(I().clear({environment:r}),A().IU({environment:r}),(0,Yd().y)(),(0,b().X)({environment:r,collectionContextStore:t,action:"click_new_property"}),C().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:v}}))}),[t,r,v]),w=(0,n.useCallback)((e=>{const t=c&&S?h.longButtonAnchor:g?h.longButton:h.smallButton,o=(0,G.jsx)(ln().p,{ref:l,testId:"add-column-button",style:t,onMouseDown:_d,iconLeading:qo().plusSmallIcon,iconStyle:h.iconStyle,isGray:!0,...e,children:g?(0,G.jsx)(vt().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}):null});return g?o:(0,G.jsx)(Ft().A,{placement:$e().W.Top,renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}),render:e=>(0,G.jsx)("div",{...e,children:o})})}),[h.smallButton,h.iconStyle,c,S,g,h.longButton,h.longButtonAnchor]),k=(0,n.useCallback)((()=>(0,G.jsx)(qd().FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,handleClosePopup:y,scrollOriginIntoView:f})),[t,y,f]),R=(0,n.useCallback)((()=>{(0,b().X)({environment:r,collectionContextStore:t,action:"click_new_property"})}),[r,t]),T=(0,u().O$)(t.permissionScopesStore);return s?ke().A.isMobile||!c?w({onClick:x}):(0,G.jsx)(sn().Ay,{popupType:Qd().n.Popup,disabled:!T.canConfigureBlock,originGap:0,alignmentToOrigin:sn().yP.Start,buttonPopupStore:m,renderOrigin:w,render:k,onClick:R,onClose:y,popupWrapStyle:h.popupWrapStyle,preventScaleTransition:!0,preventOpacityTransition:!0,disableFlippingPlacement:!0}):(0,G.jsx)(Mt().A,{testId:"add-column-button",style:h.button,onMouseDown:_d,onClick:x,icon:qo().plusSmallIcon,iconStyle:h.iconStyle,ariaLabel:i.formatMessage(Zd.addProperty)})}));function tu(e){let{collectionContextStore:t}=e;const o=(0,a().v3)(),r=(0,u().O$)(t.normalizedSchemaStore),i=(0,n.useMemo)((()=>Object.keys(r).length<=1),[r]),l=(0,p().IS)((e=>({dotsIcon:{width:Po().Ev.sm,height:Po().Ev.sm,fill:(0,Xd().P0)({theme:e,willShowOnTooltip:!1})},button:{display:i?"none":"flex",alignItems:"center",justifyContent:"center",borderRadius:6,width:ke().A.isMobile?32:28,height:ke().A.isMobile?32:28}})),[i]),s=(0,n.useCallback)((()=>{C().Ow({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),(0,b().X)({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),C().a2({collectionSettingsStore:t.settingsStore,item:{type:"propertyVisibility",timelineViewTab:"timeline"}})}),[t,o]);return(0,G.jsx)(Ft().A,{renderTooltip:()=>(0,G.jsx)(vt().sA,{defaultMessage:"Show or hide properties",id:"collectionTable.configureColumnsButton.showOrHideProperties"}),render:e=>(0,G.jsx)(Pt().A,{...e,style:l.button,onMouseDown:_d,onClick:s,className:Be().LcC,children:(0,G.jsx)("div",{style:jd,children:(0,mn().Y)(l.dotsIcon)})})})}var ou=()=>o(871399);const nu=n.memo((function(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,s=(0,H().X)("db_ux_chrome"),a=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,Qs().X4)(ur().CM[e.mode].gray,.15)},${(0,Qs().X4)(ur().CM[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,Qs().X4)(ur().CM[e.mode].gray,.35)},${(0,Qs().X4)(ur().CM[e.mode].gray,.2)},  transparent)`),[o,t]),c=(0,p().IS)((e=>({container:{display:"flex",flexDirection:"row",height:"100%"},border:{position:"absolute",right:0,width:s?1:2,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-3,width:3,height:l?34:"100%",background:a(e)},animate:{opacity:r?1:0}})),[s,l,o,t,a,r]);return(0,G.jsxs)("div",{style:c.container,children:[i?null:(0,G.jsx)("div",{style:c.border}),(0,G.jsx)(Bt().A,{visible:!0,animate:c.animate,children:(0,G.jsx)("div",{style:c.shadow})})]})})),ru=n.memo((function(e){const{checkedState:t,onClick:r,checkboxType:i,collectionContextStore:l,isBlockHovered:s,passesFilter:c,disabled:d,frozoneProps:g}=e,m=(0,a().v3)(),S=(0,o(444570).Jj)(),h=(0,u().K8)((()=>S&&ou().default.state.isOpen&&ou().default.state.isPlusButtonVisible),[S]),[f,y]=(0,n.useState)(!1),v=(0,n.useRef)(null);(0,n.useEffect)((()=>{v.current&&(v.current.indeterminate="partial"===t)}),[t]);const x=(0,u().O$)(Gn().Hf),b=(0,n.useCallback)((e=>{if(d)return;r(e);const t=(0,Me().sl)(l)||{};(0,_().v)(m,"collection_multi_select_checkbox_clicked",{...t,checkbox_type:i})}),[d,i,l,m,r]),C=(0,n.useMemo)((()=>h?0:!1===t&&!f||x?s?.6:null!=g&&g.shouldShowStickyMultiSelectColumn?.4:0:1),[t,f,x,s,null==g?void 0:g.shouldShowStickyMultiSelectColumn,h]),w=(0,p().IS)((e=>{const t=null!=g&&g.shouldShowStickyMultiSelectColumn?C>0?1:0:C;return{multiSelectCheckbox:{background:null!=g&&g.isScrolled?null==g?void 0:g.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=g&&g.isCollectionViewBlockSelected?ur().Ay.blueWithAlpha(.14):void 0,height:"100%"},label:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:d?void 0:"pointer",zIndex:1},container:{width:`${Ro().tG}px`,height:`${Ro().tG}px`,display:"flex",justifyContent:"center",alignItems:"center"},animate:{opacity:t}}}),[C,d,null==g?void 0:g.frozenStyles.background,null==g?void 0:g.isCollectionViewBlockSelected,null==g?void 0:g.isScrolled,null==g?void 0:g.shouldShowStickyMultiSelectColumn]),k=(0,n.useCallback)((()=>{y(!0)}),[]),R=(0,n.useCallback)((()=>{y(!1)}),[]);return(0,G.jsxs)(Bt().A,{animate:w.animate,style:w.multiSelectCheckbox,onMouseEnter:k,onMouseLeave:R,children:[(0,G.jsx)("div",{style:w.multiSelectCheckboxInner,children:(0,G.jsx)("label",{style:w.label,onClick:Oe().kV,onMouseDown:Oe().tr,children:(0,G.jsx)("div",{style:w.container,children:(0,G.jsx)(o(73332).T,{ref:v,checked:t,onClick:b,disabled:d,size:32===Ro().tG?14:16})})})}),null!=g&&g.shouldFreezeMultiSelectColumn?(0,G.jsx)(nu,{isCollectionViewBlockSelected:null==g?void 0:g.isCollectionViewBlockSelected,passesFilter:c,isCheckbox:!0,isScrolled:!0}):null]})})),iu=n.memo((function(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,a().v3)(),s=(0,n.useCallback)((()=>(0,ue().v2)(t[0],o).filter((e=>e.canEdit()))),[o,t]),c=(0,u().K8)((()=>0===s().length),[s]),{checkedState:d,allVisibleItemsChecked:g}=(0,u().K8)((()=>{const e=s(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=Se().default.state.stores.filter((t=>e.includes(t))).length;return{checkedState:0!==o&&(o===t&&!r||"partial"),allVisibleItemsChecked:o===t}}),[s,r]),m=(0,n.useCallback)((e=>{var t;const n=s(),r=Se().default.state.stores,i=(0,P().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===d||"partial"===d&&!g?A().td({environment:l,stores:v().KC(i,n)}):(!0===d||"partial"===d&&g)&&A().td({environment:l,stores:v().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[d,o,l,s,g]),S=(0,u().K8)((()=>(0,V().f5)({collectionContextStore:o})),[o]),h=(0,p().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:S?{position:"absolute",left:-Ro().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,S]);return(0,G.jsx)("div",{style:h.wrapper,children:(0,G.jsx)("div",{style:h.checkboxContainer,children:(0,G.jsx)(ru,{passesFilter:!0,checkedState:d,onClick:m,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:c})})})}));var lu=()=>o(37250),su=()=>o(953006),au=()=>o(285176),cu=()=>o(782473);function du(e){const{origin:t,propertyType:o}=e,n=(0,a().v3)();return(0,G.jsx)(su().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,G.jsx)(vt().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,G.jsx)(vt().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,G.jsx)(vt().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,x().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,G.jsx)(vt().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,G.jsx)("span",{style:{fontWeight:Fo().Wy.semibold},children:e})}});case"verification":return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(vt().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,G.jsx)(au().o,{href:(0,Io().xS)("guides.wikis"),style:{color:ur().Ay.uiLightGray}})]});case"tags":return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(vt().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,G.jsx)(au().o,{href:(0,Io().xS)("guides.databaseProperties"),style:{color:ur().Ay.uiLightGray}})]});default:(0,x().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,x().HB)(o)}}(),onCloseClick:()=>{lu().ZP(n)},onPrimaryButtonClick:()=>lu().A6(n),onBackButtonClick:()=>lu().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:cu().gO,pointerOffset:cu().j$,style:{width:cu().Sw}})}var uu=()=>o(790748),pu=()=>o(912720);const gu=new(ge().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(16471),o.e(58550),o.e(44711),o.e(53321),o.e(55373),o.e(37353),o.e(29151),o.e(78191),o.e(62475),o.e(3151),o.e(98629),o.e(92845),o.e(84468),o.e(5605),o.e(95794),o.e(13677),o.e(48632),o.e(75078),o.e(4422),o.e(11341),o.e(46414),o.e(95168),o.e(28271),o.e(34877),o.e(17254),o.e(84185),o.e(32421),o.e(15315),o.e(24587),o.e(43777),o.e(74752),o.e(91194),o.e(81197),o.e(98659),o.e(20502),o.e(6266),o.e(8184),o.e(83884),o.e(65881),o.e(99809),o.e(90978),o.e(77213),o.e(6912),o.e(19930),o.e(61349),o.e(66559),o.e(35986),o.e(64819),o.e(47779)]).then(o.bind(o,201724)))),mu=(0,ge()._h)(gu,(e=>e.TableHeaderCellMenu));var Su=()=>o(840094),hu=()=>o(913687),fu=()=>o(452862),yu=()=>o(964447),vu=()=>o(673730),xu=()=>o(806401);const bu=(0,vt().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),Cu=n.memo((function(e){let{type:t}=e;const r=(0,a().v3)(),i=(0,vt().tz)(),l=(0,n.useRef)(null),s=(0,p().IS)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),c=(0,Io().xS)("guides.duplicateToSpace"),d=(0,n.useCallback)((()=>(0,G.jsxs)(xr().A,{menuType:yr().gu.Popup,children:[(0,G.jsx)(wr().A,{style:s.text,children:i.formatMessage(bu[t])}),(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,G.jsx)(Or().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...s.button,...s.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),rl().oo({environment:r,url:c,openInNew:"tab"})},render:e=>(0,G.jsx)(Or().A,{...e,title:(0,G.jsx)(vt().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(133033).$)(),desktopIconStyle:s.learnMoreIcon,buttonStyle:{...s.button,...s.learnMoreButton},href:c,external:!0})}],render:e=>(0,G.jsx)(wr().A,{...e,style:s.footer})}]})]})),[s,i,r,c,t]),u=(0,n.useCallback)((e=>(0,G.jsx)(Mt().A,{icon:_c().Q,iconStyle:s.icon,ariaLabel:i.formatMessage(bu[t]),...e})),[s,i,t]);return(0,G.jsx)(sn().Ay,{popupType:Qd().n.Popup,render:d,renderOrigin:u,ref:l})}));function wu(e){const{propertySchema:t}=e,o=ku({propertySchema:t}),n=(0,p().IS)((()=>({icon:{padding:2,marginLeft:5}})),[]);return o?(0,G.jsx)(Zl().I,{icon:is().exclamationMarkTriangleIcon,color:"uiYellowPrimary",style:n.icon}):null}function ku(e){const{propertySchema:t}=e,o=!(0,u().O$)(qe().e);if(!t||!o)return!1;const n="formula"===t.type,r=(0,Xo().$M)(t)&&(0,x().O9)((0,Xo().om)(t)),i=(0,x().O9)((0,ft().Dz)(t));return n||r||i}const Ru=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:s,disabled:c,format:d,formatKey:g,isLast:m,paddingTop:S,property:h,renderSpacer:f,schema:y,width:v,collectionViewBlockStore:x,handleTemporaryNewPropertyInsertion:b}=e,C=(0,n.useRef)(null);(0,uu().b)(o(344482).A,(()=>({collectionContextStore:r,property:h,getNode:()=>C.current})),[r,h]);const w=(0,a().v3)(),{value:k}=(0,ge().fJ)(Te().T.formulas),{value:R}=(0,ge().fJ)(Te().T.formulaConstants),{value:T}=(0,ge().fJ)(Te().T.formulaPermissions),[j,_]=(0,n.useState)(!1),B=(0,u().O$)(r.permissionScopesStore),P=(0,u().uB)(void 0,Ue().A),M=(0,u().K8)((()=>o(792415).A.state.publicPageData),[]),{isRightMostFrozenColumn:F,isScrolled:V}=(0,u().K8)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),L=y[h],O=(0,u().K8)((()=>{var e;if("relation"!==(null==L?void 0:L.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,Xo().o2)(t,L)}),[r,L]),[{value:E}]=(0,ml().Yb)((async()=>{var e;if("formula"!==(null==L?void 0:L.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&k&&R&&T))return!1;const i=(0,Hn().i)(),l=(0,o(502856).MC)({collectionFeatureGates:i,experimentService:zo().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel}),s={type:"block",collection:n},a={kind:R.FormulaContextValueKind.ThisRow,type:s},c={sourceProperty:h,valueTypes:[a],handleDataRequest:l,publicPageDataCollection:{id:null==M?void 0:M.collectionId,schema:null==M?void 0:M.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await T.hasAccessToProperty({collectionPointer:n,collectionSchema:y,context:c,propertyId:h,hasAccessFn:T.hasSameSpaceAccess}))}),[r,L,h,y,k,R,T,M]),D=(0,H().X)("db_ux_chrome"),z=(0,xu().D)(L),K=(0,u().K8)((()=>x.getCollectionStore()),[x]),W=(0,n.useCallback)((()=>{I().clear({environment:w}),A().IU({environment:w}),(0,Yd().y)()}),[w]),N=(0,n.useCallback)((e=>{ke().A.isMobile||(e.preventDefault(),(0,l().SQ)({event:e,context:l().y$.EditorContextMenu,callback:()=>{W(),P.setState({open:!0})}}))}),[W,P]),$=(0,n.useCallback)((e=>{_(e)}),[_]),U=(0,p().IS)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:v,borderRight:s?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:S},buttonHovered:{background:e.tableRowHoveredBackground},property:{fontSize:14,flex:"1 1 auto",...D&&ke().A.isMobile&&{fontSize:15,color:e.text.tertiary}},icon:{...D&&ke().A.isMobile&&{fill:e.text.tertiary}},enabledIcon:{width:20,height:20,marginLeft:4},menuWrapper:{marginLeft:D?-6:void 0}})),[v,s,S,D]),X=(0,n.useCallback)((()=>L?(0,G.jsx)(Au,{propertySchema:L,propertyId:h,collectionViewBlockStore:x,collectionStore:K}):null),[L,h,x,K]),q=(0,n.useCallback)(((e,t)=>{var n;return L?(0,G.jsxs)(Pt().A,{style:U.button,hoveredStyle:U.buttonHovered,disabled:c,...(0,rn().A)(e,t),children:[f&&f(m),(0,G.jsx)(Vt().mA,{propertySchema:L,showIcon:!0,iconStyle:U.icon,badge:(0,G.jsxs)(G.Fragment,{children:["relation"===L.type&&z&&(0,G.jsx)(fu().z,{style:U.enabledIcon}),K&&(0,G.jsx)(o(897941).$,{collectionStore:K,propertyId:h,propertySchema:L,blockStore:void 0}),"button"===L.type&&(0,G.jsx)(ju,{propertyId:h,propertySchema:L,collectionViewBlockStore:x}),Boolean(null===(n=L.description)||void 0===n?void 0:n.length)&&!ke().A.isMobile&&(0,G.jsx)(o(769068).g,{setIsHovered:$}),(0,G.jsx)(Vt().Jv,{propertySchema:L}),(0,G.jsx)(o(534239).Zr,{propertyId:h,propertySchema:L,collectionContextStore:r}),(0,G.jsx)(o(367424).D,{propertySchema:L}),(0,G.jsx)(wu,{propertySchema:L})]}),style:U.property,property:h}),O&&(0,G.jsx)(Cu,{type:"relation"}),E&&(0,G.jsx)(Cu,{type:"formula"}),F&&(0,G.jsx)(nu,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(V)})]}):null}),[L,U.button,U.buttonHovered,U.enabledIcon,U.property,U.icon,c,f,m,z,K,h,x,$,O,E,F,V,r]),Y=(0,n.useCallback)((e=>L?(0,G.jsx)(Ft().A,{tooltipClassName:Be().StS,disableTooltip:O||E||!L.name,delayThreshold:j?0:500,renderTooltip:e=>(0,G.jsx)("div",{...e,style:vu().Q$,children:X()}),render:t=>q(t,e)}):null),[L,O,E,X,j,q]),Q=(0,n.useCallback)((e=>(0,G.jsx)(mu,{allowHidingTitle:t,collectionContextStore:r,handleTemporaryNewPropertyInsertion:b,columnIndex:i,format:d,formatKey:g,parent:e,property:h,schema:y})),[t,r,b,i,d,g,h,y]);return L?(0,G.jsxs)("div",{ref:C,style:U.container,className:Be().P2l,onContextMenu:N,children:[(0,G.jsx)(yu().dT,{origin:C,store:r}),(0,G.jsx)(sn().Ay,{popupType:ke().A.isMobile?Ea().nl.BottomSheet:Ea().nl.Popup,bottomSheetInitialState:"half",disabled:!B.canConfigureBlock,originGap:D?0:1,popupWrapStyle:U.menuWrapper,alignmentToOrigin:sn().yP.Start,buttonPopupStore:P,renderOrigin:Y,render:Q,onClick:W})]}):null}));function Au(e){const{propertyId:t,propertySchema:n,collectionViewBlockStore:r,collectionStore:i}=e,l=(0,p().IS)((e=>({description:{color:e.text.contrastSecondary},sharingEnabledTooltip:{marginTop:8,color:e.text.contrastSecondary},personPropertyPermissionsTooltip:{marginTop:8,color:e.text.contrastSecondary},aiUpdate:{color:e.text.contrastSecondary},offlineWarning:{color:e.text.contrastSecondary}})),[]),s=(0,u().K8)((()=>(0,Xo().$M)(n)&&(0,Xo().om)(n)),[n]),a=(0,xu().D)(n),c=void 0!==(null==n?void 0:n.description)&&n.description.length>0,d="relation"===n.type&&a&&(0,x().O9)(i),g=(0,o(763870).i)({collectionStore:i,propertyId:t,propertySchema:n}),m=(0,x().O9)(g)&&(0,x().O9)(i),S=ku({propertySchema:n}),h=(0,x().O9)(s)&&!1!==s&&(0,x().O9)(s.auto_update_on_edit)&&!S,f=Iu({collectionViewBlockStore:r,propertyId:t,propertySchema:n});return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{children:n.name}),c?(0,G.jsx)("div",{style:l.description,children:n.description}):void 0,d?(0,G.jsx)(fu().F,{propertySchema:n,collectionStore:i,style:l.sharingEnabledTooltip}):void 0,m?(0,G.jsx)(o(408839).t,{propertySchema:n,propertyId:t,collectionStore:i,style:l.personPropertyPermissionsTooltip,blockStore:void 0}):void 0,h?(0,G.jsx)("div",{style:l.aiUpdate,children:(0,G.jsx)(vt().sA,{...hu().A.keptUpToDateWithNotionAITooltip})}):void 0,S?(0,G.jsx)("div",{style:l.offlineWarning,children:(0,G.jsx)(vt().sA,{..."formula"===n.type?hu().A.offlineWarningFormula:hu().A.offlineWarningAutoUpdate})}):void 0,f?(0,G.jsx)(Tu,{}):void 0]})}function Iu(e){const{collectionViewBlockStore:t,propertyId:o,propertySchema:n}=e,r=(0,se().ET)(),i=(0,u().K8)((()=>t.getSpaceId()),[t]),l="button"===n.type&&(0,x().O9)(n.automation_id)?me().dn.createChildStore(t,{id:n.automation_id,table:pu().yB,spaceId:i}):void 0;return(0,Su().cN)({automationStore:l,propertyId:o,propertySchema:n,collectionContextStore:r})}function Tu(){const e=(0,p().IS)((e=>({wrap:{color:e.text.contrastSecondary}})),[]);return(0,G.jsx)("div",{style:e.wrap,children:(0,G.jsx)(vt().sA,{...hu().A.buttonPropertyErrorTooltip})})}function ju(e){const{collectionViewBlockStore:t,propertyId:o,propertySchema:n}=e,r=(0,p().IS)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.icon.secondary}})),[]);return Iu({collectionViewBlockStore:t,propertyId:o,propertySchema:n})?(0,_c().Q)(r.icon):null}var _u=()=>o(708685);const Bu={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},Pu=n.memo((function(e){let{leftFormat:t,height:r,onTemporaryResize:i,onAccept:l,onCancel:s,propertySchema:c,resultStore:d}=e;const u=(0,n.useRef)(void 0),{isPhone:p}=(0,a().Y0)(),[g,m]=(0,n.useState)(!1),[S,h]=(0,n.useState)(!1),f=!p&&(S||g),y=(0,n.useCallback)((e=>{const o=u.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,Lu(c,t,o.width,e.optionKey));return{...o,width:n}}),[t,c]),x=(0,n.useCallback)((e=>{e.preventDefault(),u.current=t,h(!0)}),[t]),b=(0,n.useCallback)((e=>{const t=y(e);t&&i(t)}),[y,i]),C=(0,n.useCallback)((e=>{const t=y(e);t&&l(t),h(!1)}),[y,l]),w=(0,n.useCallback)((()=>{s(),u.current=void 0,h(!1)}),[s]),k=(0,n.useCallback)((e=>{const n=d.state?d.state.blockIds:[],r=v().oE(n.map((e=>{const n=o(57618).A.findBlockPropertyValueByBlockId(e,t.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),Lu(c,t,t.width)))};l(e)}}),[t,l,c,d]),R=(0,n.useCallback)((e=>(0,G.jsx)("div",{style:f?Eu(r):Ou(r),onDoubleClick:k,...e})),[k,r,f]);return(0,G.jsx)("div",{style:Bu,onMouseMove:()=>m(!0),onMouseLeave:()=>m(!1),children:(0,G.jsx)(Pc().A,{onDraggableDragStart:x,onDraggableDragMove:b,onDraggableDragEnd:C,onDraggableDragCancel:w,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:R})})}));const Mu=32,Fu=64,Vu=100;function Lu(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return Mu;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return Mu;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return Mu;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,_u().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return Mu;if("auto_increment_id"===(null==e?void 0:e.type))return Fu;return Vu}(e,t);return o&&o<n?Mu:n}function Ou(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:ur().Ay.blueWithAlpha(0),cursor:"col-resize"}}function Eu(e){return{...Ou(e),background:ur().Ay.blueWithAlpha(.8)}}const Du=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:s,formatKey:c,disableCellRightBorder:d,renderSpacer:g,allowHidingTitle:m,paddingTop:S,showRightActions:h,showPropertyFormats:f,resultStore:y,format:v,tableStore:x,height:C,groupsPointer:w,property:k,index:R,isLast:A}=e;const I=(0,a().v3)(),{isMobile:j,isPhone:_}=(0,a().Y0)(),B=(0,n.useRef)(null),M=(0,u().K8)((()=>x.getCurrentFormat(v)),[v,x],{useDeepEqual:!0}),F=f[R],{wikiOnboardingPhase:V,showWikiTooltip:L}=(0,u().K8)((()=>{var e,n,l,s;const a=lu().WH(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===k||k===o(931075)._e.Owner)&&"owner"===a,u=c&&"verification"===(null===(l=i[k])||void 0===l?void 0:l.type)&&"verification"===a,p=c&&"multi_select"===(null===(s=i[k])||void 0===s?void 0:s.type)&&"tags"===a;return{wikiOnboardingPhase:a,showWikiTooltip:!j&&(d||u||p)}}),[r,j,k,i,t]),O=(0,u().K8)((()=>d||A&&!Bd(s,h)),[d,s,A,h]),E=(0,u().K8)((()=>(0,P().oe)({environment:I,propertyFormat:F})),[I,F]),D=(0,u().K8)((()=>{const e=x.getCurrentFormat(M);return x.getCurrentProperties(c,e)}),[M,c,x]),z=(0,n.useCallback)((e=>{const t=x.getCurrentFormat(M),o={property:Ro().uR,width:Ro().XJ,visible:!0},n=[...x.getCurrentProperties(c,t)];"left"===e?n.splice(R,0,o):n.splice(R+1,0,o);const r={...t,[c]:n},i=w.length>0?w[0].value:void 0;x.setState({...x.state,temporaryFormat:r,showNewPropertyMenuForGroup:i})}),[x,M,c,R,w]),K=(0,n.useCallback)((()=>{x.setState({...x.state,temporaryFormat:void 0,showNewPropertyMenuForGroup:void 0})}),[x]),H=(0,n.useCallback)((e=>{const t=x.getCurrentFormat(M),o=x.getCurrentProperties(c,t).map((t=>t.property===e.property?e:t)),n={...t,[c]:o};x.setState({...x.state,temporaryFormat:n})}),[x,c,M]),W=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=x.getCurrentFormat(M),n=x.getCurrentProperties(c,M).map((t=>t.property===e.property?e:t)),i={...o,[c]:n};T().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:I,canUndo:!0,perform:e=>{(0,hr().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),x.setState({...x.state,temporaryFormat:void 0}),(0,b().X)({environment:I,collectionContextStore:r,action:"table_resize_columns"})}),[r,I,M,c,x]),N=(0,n.useCallback)((()=>{x.setState({...x.state,temporaryFormat:void 0})}),[x]),$=(0,p().IS)((()=>({container:{display:"flex",position:"relative"}})),[]),U=(0,u().K8)((()=>{const e=w.length>0?w[0].value:void 0;return!x.state.showNewPropertyMenuForGroup||x.state.showNewPropertyMenuForGroup===e}),[x,w]);return(0,G.jsxs)("div",{style:$.container,ref:L?B:null,children:[L&&(0,G.jsx)(du,{origin:B,propertyType:V}),k===Ro().uR?(0,G.jsx)(Ea().Ay,{popupType:Ea().nl.Popup,popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"},open:U,origin:(0,G.jsx)("div",{style:{width:Ro().XJ,height:32}}),onDismiss:K,alignmentToOrigin:sn().yP.Start,trapFocus:!0,render:()=>(0,G.jsx)(qd().FZ,{collectionContextStore:r,collectionSettingsStore:r.settingsStore,handleClosePopup:K,newPropertyFormat:D})}):E?(0,G.jsx)(Ru,{format:M,schema:i,query:l,property:k,handleTemporaryNewPropertyInsertion:z,width:E,collectionViewBlockStore:t,collectionContextStore:r,disabled:s,formatKey:c,isLast:A,disableCellRightBorder:O,allowHidingTitle:m,renderSpacer:g,paddingTop:S,columnIndex:R,groupsPointer:w}):null,!s&&!_&&(0,G.jsx)(Pu,{leftFormat:F,onTemporaryResize:H,onAccept:W,onCancel:N,height:C,propertySchema:i[k],resultStore:y})]},k)})),zu=g().Store.createClass(void 0,{name:"ReducerResultStore"}),Ku=n.memo((function(e){let{allowHidingTitle:t,children:o,collectionContextStore:r,disableCellRightBorder:i,disabled:l,disableHorizontalEdgeScroll:s,disableTopBorder:a,format:c,formatKey:d,frozoneProps:g,groupFormat:m,hasMoreReducerResults:S,height:h,isInHomeWidget:f,isInPeekRenderer:y,minWidth:v,paddingLeft:x,paddingRight:b,paddingTop:C,query:w,renderSpacer:k,resultStore:R,schema:A,showHoverActionsStore:I,showPropertyFormats:T,showRightActions:j,store:_,tableStore:B}=e;const P=(0,n.useRef)(null),M=(0,H().X)("db_ux_chrome"),F=(0,u().K8)((()=>(0,V().f5)({collectionContextStore:r})),[r]),L=(0,u().uB)(R,zu),O=(0,n.useMemo)((()=>m?[m]:[]),[m]),E=(0,n.useMemo)((()=>Bd(l,j)),[l,j]),D=(0,u().K8)((()=>!!I&&I.state),[I]),z=(0,u().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),K=(0,u().O$)(r.isUnlistedViewStore),W=(0,V().Oz)(r),N=(0,p().IS)((e=>{const t=f?e.tableHomeDividerColor:e.tableDividerColor,o=f?"transparent":K?e.surface.elevated:y?e.cardContentBackground:(null==W?void 0:W.background)||e.contentBackground,n=O.length>0;return{flex:{display:"flex"},buttonContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:Ro().sH},headerRow:{display:"flex",background:o,zIndex:87,height:h,color:e.text.secondary,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${a?"":`, inset 0 1px 0 ${t}`}`,minWidth:v,left:"timeline"===z?void 0:0,right:"timeline"===z?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingLeft:x,paddingRight:b,minWidth:v,background:o,borderRight:"timeline"===z?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===z?"0px":void 0},transitionStickyStyle:{paddingLeft:M&&n?24:0,..."timeline"===z?{borderRight:void 0}:{}}}}),[f,K,null==W?void 0:W.background,y,h,a,v,z,x,M,b,O.length]);return(0,G.jsx)(Qr().g,{stickyAttachPoint:f?"no-stick":"ceiling",absoluteHeight:h,nodeRef:P,stickyStyle:N.stickyStyle,transitionStickyStyle:N.transitionStickyStyle,children:(0,G.jsxs)("div",{className:Be().FYj,style:N.headerRow,dir:"ltr",ref:P,children:[F?(0,G.jsx)(iu,{groupsPointer:O,collectionContextStore:r,frozoneProps:g,hasMoreReducerResults:Boolean(S)}):null,(0,G.jsx)(Hu,{showRightActions:j,store:_,collectionContextStore:r,schema:A,query:w,disabled:l,formatKey:d,disableCellRightBorder:i,renderSpacer:k,allowHidingTitle:t,paddingTop:C,frozoneProps:g,disableTopBorder:a,backgroundColor:N.headerRow.background,disableHorizontalEdgeScroll:s,showPropertyFormats:T,format:c,height:h,tableStore:B,groupsPointer:O,resultStore:L}),(0,G.jsxs)(Bt().A,{visible:E,animate:{opacity:D?1:0},style:M?N.buttonContainer:N.flex,children:[(0,G.jsx)(eu,{collectionContextStore:r}),(0,G.jsx)(tu,{collectionContextStore:r})]}),o]})})})),Hu=n.memo((function(e){let{allowHidingTitle:t,backgroundColor:o,collectionContextStore:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,disableTopBorder:s,disabled:c,format:d,formatKey:g,frozoneProps:m,groupsPointer:S,height:h,paddingTop:f,query:y,renderSpacer:x,resultStore:C,schema:w,showPropertyFormats:k,showRightActions:R,store:A,tableStore:I}=e;const j=(0,a().v3)(),{canConfigureBlock:_}=(0,u().O$)(r.permissionScopesStore),B=(0,u().O$)(r.isInHomeWidgetStore),{frozenIndex:P,unfrozenIndexAddendum:M,stickyLeft:F}=(0,n.useMemo)((()=>{const e=null==m?void 0:m.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,V().qi)(e),stickyLeft:null==m?void 0:m.frozenStyles.left}}),[null==m?void 0:m.frozenIndex,null==m?void 0:m.frozenStyles.left]),{showProperties:L,frozenShowProperties:O,unfrozenShowProperties:E}=(0,n.useMemo)((()=>{const e=k.map((e=>e.property)),[t,o]=[e.slice(0,M),e.slice(M)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[k,M]),D=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=I.getCurrentFormat(d),n=v().Ul(I.getCurrentProperties(g,d),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),i={...o,[g]:n};T().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:j,canUndo:!0,perform:e=>{(0,hr().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),(0,b().X)({environment:j,collectionContextStore:r,action:"table_reorder_columns"})}),[r,j,d,g,I]),z=(0,p().IS)((e=>{const t=B?e.tableHomeDividerColor:e.tableDividerColor;return{flex:{display:"flex"},frozenStyle:{display:"flex",...null==m?void 0:m.frozenStyles,left:B?Ro().hj:F??0,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${s?"":`, inset 0 1px 0 ${t}`}`}}}),[o,s,null==m?void 0:m.frozenStyles,B,F]),K=(0,n.useMemo)((()=>({frozen:O,unfrozen:E})),[O,E]),H=(0,n.useMemo)((()=>({frozen:z.frozenStyle,unfrozen:{display:"flex"}})),[z.frozenStyle]),W=(0,n.useCallback)(((e,o,n)=>(0,G.jsx)(Du,{collectionContextStore:r,store:A,schema:w,query:y,disabled:c,format:d,formatKey:g,allowHidingTitle:t,showPropertyFormats:k,resultStore:C,showRightActions:R,disableCellRightBorder:i,renderSpacer:x,paddingTop:f,tableStore:I,groupsPointer:S,height:h,property:e,index:o,isLast:n},e)),[t,r,i,c,d,g,S,h,f,y,x,C,w,k,R,A,I]);return c||!_?(0,G.jsxs)("div",{style:Gs().Z0,children:[(0,G.jsx)("div",{style:z.frozenStyle,children:O.map(((e,t)=>W(e,t,t===L.length-1)))}),E.map(((e,t)=>W(e,t+M,t===L.length-1)))]}):(0,V().Eh)(P)?(0,G.jsx)(Ud,{style:z.flex,direction:"horizontal",keys:L,sectionedKeys:K,sectionStyles:H,renderKey:W,onDrop:D,disableHorizontalEdgeScroll:l}):(0,G.jsx)(Gs().Ay,{direction:"horizontal",keys:L,renderKey:W,onDrop:D,disableHorizontalEdgeScroll:l})}));function Wu(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,p().IS)((()=>({container:{display:"flex",background:o&&n?ur().Ay.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,G.jsx)(Bt().A,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,G.jsx)(G.Fragment,{children:t})}var Gu=()=>o(828634);function Nu(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,Cd().DV)()&&r?(0,G.jsx)($u,{store:t,collectionContextStore:o,children:n}):(0,G.jsx)("div",{style:{display:"flex"},children:n})}function $u(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,a().WS)(),l=(0,n.useRef)(null),s=(0,n.useRef)(null),c=o.virtualizedModule.getBlockHeightsCache(),d=(0,u().O$)(c.getBlockHeightStore(t.id)),g=(0,n.useCallback)((()=>{c.expandHeightToTallestCached(t.id)}),[c,t]);(0,Gu().tK)(0===d?l:s,g);const m=(0,p().IS)((()=>{const e=i?Ro().Um:Ro().tt;return{row:{display:"flex",...d?{height:Math.max(d,e),overflowY:"clip"}:{}}}}),[d,i]);return(0,G.jsx)("div",{ref:l,style:m.row,children:r})}const Uu=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,se().ET)(),s=(0,a().v3)(),c=(0,u().K8)((()=>Se().default.state.stores.includes(t)),[t]),d=(0,u().K8)((()=>{var e;return ou().default.state.isOpen&&(null===(e=ou().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,P().ut)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?A().td({environment:s,stores:[t]}):A().Lt({environment:s,store:t,selectMode:A().gj()?A().SB.MULTI_SELECT_FROM_BOUNDARY:A().SB.TOGGLE}),e.stopPropagation()}),[l,s,t]);return(0,G.jsx)(ru,{checkedState:c,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:d,frozoneProps:i,passesFilter:o,disabled:!r})}));const Xu=n.memo((function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(0,p().IS)((()=>{const e=(null==o?void 0:o.length)??0,t=Math.max((e-1)*ue().yy,0)+ue().Pi,i=ke().A.isMobile?Ro().Um:Ro().tt;return{hiddenContainer:{minWidth:t+ue().yy,...0===r&&n&&{marginLeft:-8,marginRight:4}},buttonContainer:{display:"flex",marginTop:(i-ue().yy)/2,...0===r&&n&&{marginLeft:-8,marginRight:0,gap:4}},width:{width:t}}}),[r,n,null==o?void 0:o.length]);return t?(0,G.jsxs)("div",{style:i.buttonContainer,children:[(0,G.jsx)("div",{style:i.width}),t]}):(0,G.jsx)("div",{style:i.hiddenContainer})})),qu=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:s,store:c,schema:d,disabled:g,disableCellBorderRight:m,disableLastCellBorderRight:S,subitemPath:h,onShiftEnter:f,tableWrap:y,subitemFormat:b,forceMouseEntered:C,shouldCaptureKeyboard:w,isLocked:k,toggleButton:R,onPropertyClick:A,titleColumnIndex:I,isSubitemToggleOnTitleColumn:T,onPropertyTab:j,onPropertyUntab:_,onPropertyEnter:B,onPropertyEsc:M,onPropertyBgClick:F,onPropertyContextMenu:V,collectionViewStore:L,collectionStore:O,blockPropertyValueOverlayStore:E,shouldSetCellHeight:D,onOpenProperty:z,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,groupFormat:W,rowIndex:N,isCollectionViewBlockSelected:$,passesFilter:U,isScrolled:X,shouldShowMultiSelectCheckbox:q,isInHomeWidget:Y,normalizedTableSelection:Q,hasColumnVirtualizer:Z}=e,{property:J,wrap:ee}=t,te=(0,a().v3)(),oe=(0,u().K8)((()=>(0,P().oe)({environment:te,propertyFormat:t})),[te,t]),ne=(0,se().ET)(),re=(null==h?void 0:h.length)??0,ie=b&&(0,P().BC)({columnIndex:r,titleColumnIndex:I,isSubitemToggleOnTitleColumn:T}),ae=(0,n.useMemo)((()=>{if(void 0!==oe){if(ie){const e=(0,P().si)({columnIndex:r,indentLevel:re,titleColumnIndex:I,isSubitemToggleOnTitleColumn:T});return oe-e}return oe}}),[re,r,T,ie,I,oe]),ce=(0,n.useCallback)((()=>A(c,J,d)),[A,J,d,c]),de=g||!i,ue=!(0,u().O$)(qe().e),pe=(0,ft()._g)({schema:d,property:t.property}),ge=ue&&(0,x().O9)(pe)&&(0,wt().$)({propertyType:pe.type,propertySchema:pe,allowAIProperty:!0}),[me,Se]=(0,u().K8)((()=>{const e=ne.collectionViewBlockStore();if(!e)return[!1,!1];const t=Pd().A.state;if(!t.isActive||!(0,Pd().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:W})||!Q)return[!1,!1];const o=Q,{start:n,end:i}=o,l=N===n.row||N===i.row||v().r4(N,n.row,i.row),s=r===n.col||r===i.col||v().r4(r,n.col,i.col);return[l&&s,N===n.row&&r===n.col]}),[ne,W,r,Q,N]),he=(0,u().K8)((()=>{const e=ne.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[ne,r]),fe=(0,o(736230).V)({collectionContextStore:ne,blockId:c.id,property:J,featureEnabled:Z}),ye=(0,p().IS)((e=>{const t=Y?e.tableHomeDividerColor:e.tableDividerColor,o=$?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:oe||void 0,height:fe?void 0:"100%",position:"relative",borderRight:m||s||l&&S?"none":`1px solid ${he?o:t}`,opacity:ge?.4:1},tableSelectionOverlay:{background:me?ur().Ay.blueWithAlpha(.07):void 0,borderRadius:Se?3:void 0,boxShadow:Se?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:ae||void 0}}}),[Y,$,oe,fe,m,s,l,S,he,me,Se,ae,ge]),ve=(0,G.jsxs)(le().A,{debugName:"TableRow",capture:w,onShiftEnter:f,children:[(0,G.jsx)(os().BlockPropertyRouter,{collectionStore:O,store:c,property:J,disabled:de,locked:k,width:ae,format:"table",forceMouseEntered:C,tableWrap:Boolean(y||ee),isLast:l,indentLevel:0===r&&h?h.length:void 0,onTab:j,onUntab:_,onEnter:B,onClick:ce,onEsc:M,onBgClick:F,onContextMenu:V,collectionViewStore:L,shouldSetCellHeight:D,onOpenProperty:z,blockPropertyValueOverlayStore:E,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,propertyIndex:r,shouldShowMultiSelectCheckbox:q},J),s&&(0,G.jsx)(nu,{isCollectionViewBlockSelected:$,passesFilter:U,isScrolled:X})]}),xe=(0,n.useRef)(null);return(0,G.jsxs)("div",{ref:xe,className:Be().WvK,"data-row-index":N,"data-col-index":r,style:ye.tableCell,children:[ie?(0,G.jsx)(Xu,{subitemFormat:b,toggleButton:R,subitemPath:h,shouldShowMultiSelectCheckbox:q,propertyIndex:r}):null,(0,G.jsx)("div",{style:ye.propertyValueContainer,children:ve}),me&&(0,G.jsx)("div",{style:ye.tableSelectionOverlay})]})})),Yu=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:s,indexAddendum:a,frozoneProps:c,normalizedTableSelection:d,canEdit:p,isInHomeWidget:g,...m}=e,S=(0,se().ET)(),h=(0,u().K8)((()=>S.collectionViewStore()),[S]),f=(0,u().K8)((()=>V().Dj({store:i,collectionContextStore:S})),[i,S]),y=(0,u().K8)((()=>!t.state.isOpen&&Se().default.state.stores.length>0&&Se().default.state.stores[0].id===i.id),[i.id,t]),v=(0,u().O$)(S.currentSubitemFormatStoreForUiDisplayStore),x=(0,u().K8)((()=>"title"===(null==h?void 0:h.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[h]),b=(0,u().K8)((()=>S.frozoneStore.state.frozenIndex),[S]),C=(0,u().K8)((()=>{if(!p)return;if(g)return;if(S.isInlineViewStore.state&&S.isUnlistedViewStore.state)return;const e=ou().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,S,g,i]),w=r??o.length;return(0,G.jsx)(G.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(a??0);return(0,G.jsx)(qu,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:b===r,collectionViewStore:h,collectionStore:f,tableWrap:l,shouldSetCellHeight:s,forceMouseEntered:"title"===e.property?C:void 0,shouldCaptureKeyboard:y,subitemFormat:v,isSubitemToggleOnTitleColumn:x,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:d,canEdit:p,isInHomeWidget:g,...m},e.property)}))})})),Qu=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,Cd().UB)();return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{width:`${i}px`}}),(0,G.jsx)(Yu,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,G.jsx)("div",{style:{width:`${l}px`}})]})})),Zu=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:s,frozoneProps:c,passesFilter:d,shouldShowMultiSelectCheckbox:g,isLast:m,isInHomeWidget:S,isCollectionViewBlockSelected:h,allRows:f,isInEphemeralView:y,normalizedTableSelection:v,unfrozenIndexAddendum:x,frozenPropertyFormats:b,unfrozenPropertyFormats:C,tableWrap:w,shouldSetCellHeight:k,isNonEditable:R,shouldShowRightActionSpacer:A,...I}=e,{handleOpenPeekPage:T}=e,j=(0,n.useRef)(null),_=(0,a().v3)(),B=(0,u().K8)((()=>!o&&r.canEdit()),[o,r]),P=(0,n.useMemo)((()=>f.findIndex((e=>e===r))),[f,r]),M=null==c?void 0:c.frozenIndex,F=void 0!==M,L=-1===M,O=(0,u().K8)((()=>{if(void 0===M)return!1;const e=Pd().A.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Pd().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!v)return!1;const o=v,{start:n}=o;return P===n.row&&n.col<=M}),[i,l,v,M,P]),E=(0,n.useMemo)((()=>F?{...null==c?void 0:c.frozenStyles,...O?{zIndex:86}:{zIndex:85},...L?{background:void 0}:{},...S?{left:Ro().hj}:{}}:{}),[F,null==c?void 0:c.frozenStyles,O,L,S]),D=(0,p().IS)((e=>{const t=S?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...m&&S?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-Ro().Fh,...!L&&{background:null==c?void 0:c.frozenStyles.background,height:"100%"}}}}),[L,null==c?void 0:c.frozenStyles.background,S,m]),z=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=jt().default.state,t=V().wy({environment:_,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:y?"center_peek":void 0});t&&(T(),rl().oo({environment:_,url:t}))}),[l,_,T,y,r]),K=(0,Cd().DV)(),H=w||s.some((e=>e.wrap)),W=(0,G.jsxs)(n.Fragment,{children:[(0,G.jsx)("div",{className:Be().Eo4,style:D.tableViewRowStyle,dir:"ltr",ref:j,children:(0,G.jsx)(ms().c,{store:r,step:"demo_collection_record",children:(0,G.jsxs)(Nu,{collectionContextStore:l,store:r,anyWrapping:H,children:[(0,G.jsx)("div",{style:E,children:(0,G.jsx)(Wu,{isCollectionViewBlockSelected:h,passesFilter:Boolean(d),shouldFreeze:!L,children:(0,G.jsxs)(G.Fragment,{children:[g&&(0,G.jsx)(Bt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,G.jsx)("div",{style:D.checkboxContainer,children:(0,G.jsx)(Uu,{store:r,passesFilter:Boolean(d),frozoneProps:c,canEdit:B})})}),(0,G.jsx)(Yu,{store:r,canEdit:B,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:k,indexAddendum:0,rowIndex:P,disabled:o,groupFormat:i,tableWrap:w,isLocked:R,isCollectionViewBlockSelected:h,passesFilter:Boolean(d),shouldShowMultiSelectCheckbox:g,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...I})]})})}),K?(0,G.jsx)(Qu,{store:r,canEdit:B,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:P,disabled:o,groupFormat:i,tableWrap:w,isLocked:R,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:g,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...I}):(0,G.jsx)(Yu,{store:r,canEdit:B,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:P,disabled:o,groupFormat:i,tableWrap:w,isLocked:R,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:g,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...I})]})})}),A?(0,G.jsx)("div",{style:{...D.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Ke().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>j.current,getBlockStore:()=>r,activate:z})),[z,r]),W)})));const Ju=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:s}=e,c=(0,a().v3)(),d=(0,se().Ks)(),g=(0,n.useRef)(null),m=(0,n.useRef)(null),[S,h]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[f,y]=n.useState(0),[x,b]=n.useState(0),C=(0,u().K8)((()=>t.state.isRepositioning||S.isMouseDown),[t,S.isMouseDown]),w=(0,u().K8)((()=>t.state.newFrozenIndex),[t]),k=(0,u().K8)((()=>!!d&&(0,V().f5)({collectionContextStore:d})),[d]),R=(0,u().K8)((()=>null==d?void 0:d.frozoneStore.state.isScrolled),[d]),A=(0,u().K8)((()=>!R&&-1===o&&k?-4:0),[o,R,k]),I=(0,u().K8)((()=>S.isEntered||C),[S.isEntered,C]),T=(0,u().K8)((()=>t.state.newFrozenColumnXPosition),[t]),j=(0,n.useContext)(Ie().R),_=null==j?void 0:j.horizontalScroller,B=(0,n.useCallback)((()=>{var e,t,o;if(!_||!g.current)return 0;const n=(null===(e=g.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=_.getNode())||void 0===t?void 0:t.getElementsByClassName(Be().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[_]),M=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!_||!g.current)return 0;const i=(null===(e=g.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=_.getNode())||void 0===t?void 0:t.getElementsByClassName(Be().Eo4),s=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(n=_.getNode())||void 0===n?void 0:n.getElementsByClassName(Be().Mbm),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(s,c)-i}),[_]),F=(0,u().K8)((()=>{var e;const t=null===(e=g.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==s?new DOMRect(t.x+s+S.x+10,t.y+S.y+10,3,3):void 0}),[s,S]),L=(0,u().K8)((()=>{const e=(null==d?void 0:d.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Ne().kf)(c),o=Math.max(t-e,0);return d&&(0,P().QP)(c,d)?o:0}),[d,c]),O=(0,u().K8)((()=>d&&(0,V().f5)({collectionContextStore:d})),[d]),E=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===s||null===g.current||null===m.current)return;const n=g.current.getBoundingClientRect(),a=e.clientX-n.x;if(null==d||d.frozoneStore.setState({...null==d?void 0:d.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!I)return;const c=B();y(c);const u=M();b(u);const p=2+s,S=Math.max(a-p,-p),f=e.clientY-n.y-14,v=n.bottom-n.top-14+u,x=C?c:-14,w=Math.max(Math.min(f,v),x);if(h((e=>({...e,x:C?S:0,y:w}))),C){const e=l,n=m.current.getBoundingClientRect();let c=a,d=i,u=-1,p=d,g=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,R&&t===o+1&&(c-=n.x);const i=Math.abs(d-c);i<g&&(g=i,p=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-s-1})}}),[o,r,s,null==d?void 0:d.frozoneStore,I,B,M,C,l,i,t,R]);(0,n.useEffect)((()=>{const e=v().nF((e=>{E(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[E]);const D=(0,n.useCallback)((e=>{C||(E(e.nativeEvent),h((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[C,E]),z=(0,n.useCallback)((e=>{C||h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[C]),K=(0,n.useCallback)((e=>{h((e=>({...e,isMouseDown:!0})))}),[]),H=(0,n.useCallback)((e=>{C&&h((e=>({...e,isEntered:!0})))}),[C]),W=(0,n.useCallback)((e=>{h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,n.useCallback)((e=>{C&&h((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[C]),$=(0,p().IS)((e=>{const t=void 0!==w&&void 0!==o&&w<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:C?"grabbing":"grab",pointerEvents:C?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:L+(O?Ro().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==s||R?s??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:C?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:C?S.x-1:-1,top:C?f:0,width:2,height:C?`calc(100% + ${x-f}px`:"100%",background:"dark"===e.mode?e.palette.gray[500]:e.palette.gray[200]},ghostColumnBase:{position:"absolute",top:C?f:0,width:1,height:C?`calc(100% + ${x-f}px`:"100%",background:e.palette.uiBlue[300]},frozenGhostColumn:{left:T,opacity:C&&t?1:0},unfrozenGhostColumn:{left:(s??0)+(T??0),opacity:I&&C&&!t?1:0},tooltipDraggable:{position:"absolute",left:C?S.x-2:-2,top:S.y,width:4,height:28,background:e.palette.uiBlue[600],borderRadius:4}}}),[w,o,C,L,O,s,R,S.x,S.y,f,x,T,I]);return(0,G.jsx)("div",{className:Be().FZs,style:$.repositionerContainer,onMouseEnter:H,onMouseLeave:W,onMouseUp:N,children:(0,G.jsxs)("div",{style:$.repositionerOutsideStickyWrapper,ref:m,children:[(0,G.jsx)("div",{style:$.repositionerInsideStickyWrapper,ref:g,children:(0,G.jsx)(Ft().A,{renderTooltip:()=>C&&void 0!==w&&w!==o?(0,G.jsx)(vt().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:w+1}}):(0,G.jsx)(vt().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:C||void 0,placement:$e().W.Right,originRect:F,render:e=>(0,G.jsxs)(Bt().A,{animate:{translateX:A,opacity:I?1:0},...e,style:$.tooltipContainer,children:[(0,G.jsx)("div",{style:$.tooltipOrigin,onMouseEnter:D,onMouseLeave:z,onMouseDown:K}),(0,G.jsx)("div",{style:{...$.ghostColumnBase,...$.frozenGhostColumn}}),(0,G.jsx)("div",{style:$.tooltipColumn}),(0,G.jsx)("div",{style:$.tooltipDraggable})]})})}),(0,G.jsx)("div",{style:{...$.ghostColumnBase,...$.unfrozenGhostColumn}})]})})},ep={tableSelectionOverlayActions:new(ge().O2)("tableSelectionOverlayActions",(async()=>await o.e(95496).then(o.bind(o,339016)))),tableSelectionOverlayPropertyActions:new(ge().O2)("tableSelectionOverlayPropertyActions",(async()=>await o.e(40589).then(o.bind(o,233035))))};var tp=()=>o(556148);class op extends g().Store{getInitialState(){}}const np=op;class rp extends g().Store{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const ip=rp,lp=new Set(["rollup","formula","verification"]);function sp(e){var t;const{dragAndFillStore:o,frozenIndex:r,rowsWrapRect:i,schema:l,selection:s,selectionStartRectStore:a,showPropertyFormats:c}=e,d=(0,se().ET)(),g=(0,u().O$)(o),m=(0,u().K8)((()=>{const e=(null==g?void 0:g.start)||s.start;return c[e.col]}),[g,s,c]),S=m?null===(t=l[m.property])||void 0===t?void 0:t.type:void 0,h=(0,u().O$)(a),f=(0,u().K8)((()=>void 0!==r&&s.start.col<=r),[r,s]),y=(0,u().O$)(d.isInHomeWidgetStore),v=(0,u().K8)((()=>(0,V().f5)({collectionContextStore:d})),[d]),x=(0,p().IS)((e=>{const t=f?91:85,o=f?"sticky":void 0;let n=0;y?n=Ro().hj:v&&(n=Ro().Fh);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,left:n},tooltipContainer:h?{position:"absolute",left:h.left+h.width-6-(v?Ro().Fh:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:h?h.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:h?h.bottom-5:void 0,width:9,height:9,border:`2px solid ${ur().Ay.blueWithAlpha(.57)}`,transform:g?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.text.contrastSecondary,maxWidth:200,...Fo().RC}}}),[f,y,v,h,g]),b=(0,n.useMemo)((()=>{if(h&&i)return new DOMRect(h.x+i.x+h.width-4,h.y+i.y+h.height-4,7,7)}),[h,i]),C=(0,n.useCallback)((()=>(0,G.jsx)(vt().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),w=(0,n.useCallback)((e=>(0,G.jsx)("div",{...e,style:x.dragAndFillContainer,children:(0,G.jsx)("div",{style:x.dragAndFillOutsideStickyWrapper,children:(0,G.jsx)("div",{style:x.dragAndFillInsideStickyWrapper,children:(0,G.jsxs)("div",{style:x.tooltipContainer,children:[(0,G.jsx)("div",{style:x.tooltipOrigin}),(0,G.jsx)("div",{className:Be().yle,style:x.tooltipCircle})]})})})})),[x]);return h?!S||(0,Xo().F_)(S)||lp.has(S)?null:(0,G.jsx)(Ft().A,{renderTooltip:C,delayThreshold:300,forceVisibleState:!!g||void 0,originRect:b,placement:$e().W.Right,render:w}):null}const ap=n.memo((function(e){const{groupFormat:t}=e,r=(0,a().v3)(),i=(0,n.useContext)(ll().n),l=(0,n.useRef)(null),s=(0,n.useRef)(void 0),c=(0,H().X)("improved_drag_and_fill"),{value:d}=(0,ge().fJ)(ae().g),{value:p}=(0,ge().fJ)(ce().S),{value:g}=(0,ge().fJ)(Te().T.formulas),m=(0,n.useMemo)((()=>ep.tableSelectionOverlayActions.load()),[]),S=(0,u().uB)(void 0,np),h=(0,u().uB)(void 0,ip),f=(0,u().r6)((()=>(0,ue().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),y=(0,u().K8)((()=>(0,V().f5)({collectionContextStore:e.collectionContextStore})),[e.collectionContextStore]),v=(0,u().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),x=(0,u().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=Pd().A.state;if(!r.isActive||!(0,Pd().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,P().yR)(r.selection,e.showPropertyFormats.length,f.state.length);return o(4319).kn(f.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,f]),b=(0,u().O$)(x),C=(0,u().K8)((()=>{const e=x.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[x]),w=(0,u().K8)((()=>{const e=x.state;return e&&e.start.row===e.end.row}),[x]),k=c?w:C,R=(0,u().r6)((()=>{const t=x.state;if(!t)return;if(!l.current)return;const o=t.start,n=e.showPropertyFormats,r=f.state[o.row],i=(0,tp().Xw)(r,l.current);if(!i)return;const s=l.current.getBoundingClientRect(),a=i.height,c=i.top-s.top-1,d=n[o.col].width||0,u=a+1;let p=(0,tp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,x,e.collectionContextStore,e.showPropertyFormats]),A=(0,u().r6)((()=>{const t=x.state;if(!t||!w)return;if(!l.current)return;const o=t.end,n=e.showPropertyFormats,r=f.state[o.row],i=(0,tp().Xw)(r,l.current);if(!i)return;const s=l.current.getBoundingClientRect(),a=i.height,c=i.top-s.top-1,d=n[o.col].width||0,u=a+1;let p=(0,tp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,w,x,e.collectionContextStore,e.showPropertyFormats]),I=c?A:R,T=(0,u().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),j=(0,u().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),_=(0,u().r6)((()=>{const t=T.state;if(void 0!==t){let o=(0,tp().$u)(e.collectionContextStore);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(y?Ro().Fh:0)}}),[T,y,e.collectionContextStore,e.showPropertyFormats]),B=(0,u().K8)((()=>(0,tp().$u)(e.collectionContextStore)-(y?Ro().Fh:0)),[e.collectionContextStore,y]),M=(0,u().K8)((()=>{let t=!1;const o=(0,tp().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=Se().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==T.state&&!S.state&&!t&&!Pd().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[S,T,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{l.current&&(s.current=new MutationObserver((()=>{R.recompute()})),s.current.observe(l.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=s.current;return()=>{e&&e.disconnect()}}),[R]);const F=(0,n.useCallback)((async t=>{(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,r,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,x,f,_,T]),L=(0,n.useCallback)((async t=>{(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),O=(0,n.useCallback)((async t=>{(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Up,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),E=(0,n.useCallback)((async t=>{(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Down,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),D=(0,n.useCallback)((async t=>{(await m).handleEnter({shortcutEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),z=(0,n.useCallback)((async t=>{t.preventDefault();(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),K=(0,n.useCallback)((async t=>{t.preventDefault();(await m).handleDirection({shortcutOrKeyboardEvent:t,direction:tp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),W=(0,n.useCallback)((async e=>{(await m).handleEsc({keyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,m]),N=(0,n.useCallback)((async()=>{(await m).handleDelete({environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,e.collectionContextStore,e.disabled,e.showPropertyFormats,m]),$=(0,n.useCallback)((async t=>{(await m).handleCut({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,formulasModule:g})}),[m,r,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x,f,g]),U=(0,n.useCallback)((async t=>{(await m).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:f.state,formulasModule:g,normalizedTableSelection:x.state})}),[m,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,f,g,x]),X=(0,n.useCallback)((async t=>{const o=await m,n=await te().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:v,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:p,disabled:e.disabled,allRows:f.state,clipboardActions:n,normalizedTableSelection:x.state})}),[m,f,r,d,x,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,v,p]),q=(0,n.useCallback)((async()=>{(await m).handleCommandEnter({environment:r,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,overrideLinkClick:i})}),[f,r,x,i,e.collectionContextStore,m]),Y=(0,n.useCallback)((async()=>{(await m).handleShiftEnter({environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:R,frozenSectionWidth:_.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,T,_,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,R]),Q=(0,n.useCallback)((async()=>{(await m).handleCommandShiftEnter({environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[m,f,r,x]),Z=(0,n.useCallback)((async t=>{(await m).handleDuplicate({keyboardEvent:t,environment:r,disabled:e.disabled,schema:v,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[m,f,r,x,v,e.disabled,e.showPropertyFormats]),J=(0,n.useCallback)((async t=>{(await m).handleKeypress({keyboardEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[m,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),ee=(0,n.useCallback)((async e=>{(await m).handleMoveTo({shortcutOrKeyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[m,f,r,x]),oe=(0,n.useCallback)((async t=>{(await m).handleDragStart({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:S,frozenColumnRepositionStore:h,frozenIndex:T.state,allRows:f.state,normalizedTableSelection:x.state})}),[m,f,S,r,h,T,x,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),ne=(0,n.useCallback)((async t=>{(await m).handleDragMove({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:R})}),[m,f,S,r,h,x,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,R]),re=(0,n.useCallback)((async()=>{(await m).handleDragEnd({environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:v,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state})}),[m,f,S,r,h,x,e.collectionContextStore,e.showPropertyFormats,v]),ie=(0,n.useCallback)((async()=>{(await m).handleDragCancel({dragAndFillStore:S,frozenColumnRepositionStore:h})}),[S,h,m]);return(0,G.jsx)(le().A,{debugName:"TableSelectionOverlay",capture:void 0!==b,onLeft:F,onRight:L,onUp:O,onDown:E,onEnter:D,onTab:z,onUntab:K,onEsc:W,onDelete:N,onBackspace:N,onCut:$,onCopy:U,onPaste:X,onCommandEnter:q,onShiftEnter:Y,onCommandShiftEnter:Q,onDuplicate:Z,onKeypress:J,onMoveTo:ee,children:(0,G.jsx)(Pc().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:oe,onDraggableDragMove:ne,onDraggableDragEnd:re,onDraggableDragCancel:ie,render:t=>{var o;return(0,G.jsxs)("div",{ref:l,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,tp().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&b&&(k||S.state)?(0,G.jsx)(sp,{dragAndFillStore:S,frozenIndex:T.state,rowsWrapRect:null===(o=l.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:v,selection:b,selectionStartRectStore:I,showPropertyFormats:e.showPropertyFormats}):null,M&&(0,G.jsx)(Ju,{frozenColumnRepositionStore:h,xForFirstCellInRow:B,maxFrozenIndex:j,showPropertyFormats:e.showPropertyFormats,frozenIndex:T.state,frozenSectionWidth:_.state}),(0,G.jsx)(cp,{...e,allRowsStore:f,selectionStartRectStore:R,normalizedTableSelectionStore:x,frozenSectionWidthStore:_,frozenIndexStore:T})]})}})})}),Qo().A),cp=n.memo((function(e){const t=(0,a().v3)(),o=(0,n.useMemo)((()=>ep.tableSelectionOverlayActions.load()),[]),r=(0,n.useMemo)((()=>ep.tableSelectionOverlayPropertyActions.load()),[]),i=(0,n.useMemo)((()=>({onPropertyTab:async()=>{(await r).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await r).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await r).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,n,i)=>{(await r).handlePropertyClick({store:o,property:n,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await r).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await r).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await r).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await r).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,r,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,G.jsx)(G.Fragment,{children:e.render(i)})}),Qo().A);function dp(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,s=(0,a().v3)(),c=(0,p().DP)(),d=(0,a().Y0)().isPhone,g=(0,se().Ks)(),m=(0,ys().A)(!0,0,100),S=(0,u().K8)((()=>Boolean(null==g?void 0:g.normalizedFormatStore.state.hide_table_vertical_lines)),[g]),h=l.isScrolled,f=l.frozenIndex,y=void 0!==f,v=(0,u().K8)((()=>{if(!g)return!1;const e=g.collectionViewBlockStore();return!!e&&(0,Td().d1)(e)}),[g]),x=(0,u().K8)((()=>g?(0,P().wy)({environment:s,collectionContextStore:g,isPhone:d,theme:c}):{}),[g,s,d,c]),b=(0,u().K8)((()=>Boolean(null==g?void 0:g.isInHomeWidgetStore.state)),[null==g?void 0:g.isInHomeWidgetStore]),C=(0,p().IS)((e=>{let t="0x 16px";return y?t=void 0:b&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...x,...-1===f?{background:void 0}:{}},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:S?void 0:`1px solid ${e.tableDividerColor}`}}}),[y,b,x,f,S]);if(!m||!g)return null;const w=n.map(((e,t)=>(0,G.jsx)("div",{style:{...C.column,width:e},children:(0,G.jsx)(so().A,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let k=null,R=[];if(y&&void 0!==f){const e=w.slice(0,f+1);k=(0,G.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,G.jsx)(Wu,{isCollectionViewBlockSelected:v,passesFilter:!0,shouldFreeze:-1!==f,children:e}),e.length>0?(0,G.jsx)(nu,{isCollectionViewBlockSelected:v,passesFilter:!0,isShimmerRow:!0,isScrolled:h}):null]}),R=w.slice(f+1,w.length)}else R=w;let A=1;o||r||i||(A=t?10:3);const I=[...Array(A)].map(((e,t)=>(0,G.jsxs)("div",{style:C.rowContainer,children:[k,R]},t)));return(0,G.jsx)("div",{style:C.container,children:(0,G.jsx)("div",{style:C.rowsContainer,children:I})})}const up=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,disabled:i,format:l,groupFormat:s,isFullScreen:c,isInPeekRenderer:d,minWidth:g,paddingBottom:m,paddingLeft:S,paddingRight:h,query:f,schema:y,showHoverActionsStore:v,store:x,tableStore:b,headerWidth:C}=e,w=(0,H().X)("db_ux_chrome"),k=(0,H().X)("db_ux_empty_states"),R=(0,a().v3)(),{isMobile:A,isPhone:I}=(0,a().Y0)(),j=(0,vt().tz)(),_=(0,p().DP)(),B=(0,n.useContext)(ll().n),M=(0,Re().Zp)(),F=(0,n.useMemo)((()=>s?[s]:[]),[s]),L=(0,u().K8)((()=>r.groupsStore.getGroupState(F)),[r.groupsStore,F]),{reducerResult:O,isReady:E,hasPartialResults:D,pageCount:z,shouldShowShimmer:K}=(0,u().K8)((()=>{const e=null==L?void 0:L.reducerResultStore.state,t=void 0!==e,o=(null==e?void 0:e.blockIds.length)||0,n=void 0!==e&&e.blockIds.length>0;return{reducerResult:e,isReady:t,hasPartialResults:n,pageCount:o,shouldShowShimmer:(0,Sn().iv)({collectionContextStore:r,groupsPointer:F,hasPartialResults:n})}}),[r,L,F]),W=0===z&&E&&!K,N=(0,u().K8)((()=>(0,Sn().Kk)({collectionContextStore:r,groupsPointer:F})),[r,F]),$=(0,u().O$)(r.permissionScopesStore),U=(0,Ke().bx)(e.store,e.disabled),X=(0,u().K8)((()=>!!U&&(!$.isSyncedCollection&&$.canEditContent)),[U,$]),{showPropertyFormats:q,titleColumnIndex:Y,propertyWidths:Q,totalPropertyWidth:Z}=(0,u().K8)((()=>{const e=(0,P().GW)(l,b).filter((e=>e.visible)),t=e.findIndex((e=>{let{property:t}=e;return"title"===t})),o=e.map((e=>{let{width:t}=e;return t||Rd().kp}));return{showPropertyFormats:e,titleColumnIndex:t,propertyWidths:o,totalPropertyWidth:e.reduce(((e,t)=>e+(t.width||0)),0)}}),[l,b],{useDeepEqual:!0}),J=(0,u().K8)((()=>(0,P().Ty)(l,b)),[l,b]),ee=(0,u().K8)((()=>Z+($.canEditContent?32:0)),[Z,$]),te=(0,u().K8)((()=>"collectionTypedView"===r.contextType),[r]),oe=(0,u().O$)(r.isInHomeWidgetStore),ne=(0,u().O$)(r.isUnlistedViewStore),re=(0,u().O$)(r.isInlineViewStore),ie=ne&&re,le=(0,u().K8)((()=>(0,_e().sj)(x.id)),[x]),se=(0,u().K8)((()=>V().fG({collectionContextStore:r,environment:R,intl:j})),[r,R,j]),ae=(0,u().K8)((()=>{if(k)return(0,Eo().N1)({collectionContextStore:r,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0;const e=Boolean(r.currentCombinatorFilterStore.state),t=r.currentPropertyFiltersStore.state.length>0;return e||t}),[r,k]),ce=(0,u().K8)((()=>""!==r.searchQueryStore.state),[r]),de=(0,n.useMemo)((()=>k&&W&&(ae||ce)),[k,W,ae,ce]),{shouldShowAddRowButton:pe,canAddRow:ge}=(0,u().K8)((()=>{const e=E&&!oe&&(X||te)&&Boolean(r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}));return de?{shouldShowAddRowButton:!1,canAddRow:e}:{shouldShowAddRowButton:e,canAddRow:e}}),[de,E,oe,X,te,r]),me=Boolean(s),he=!de&&(E&&!K&&0===z&&pe&&!ae&&!me),fe=(0,n.useMemo)((()=>c?4:2),[c]),ye=(0,u().K8)((()=>{var e;return Boolean(null===(e=f.aggregations)||void 0===e?void 0:e.length)}),[f]),ve=(0,u().K8)((()=>!de&&(!(k&&!ye)&&!(ne||null!=M&&M.hideTableAggregationRow))),[k,de,ne,null==M?void 0:M.hideTableAggregationRow,ye]),xe=(0,u().K8)((()=>V().XQ({collectionContextStore:r,reducerResult:O,isFullScreen:c})),[r,c,O]),be=(0,u().K8)((()=>r.viewIsFlushToTopbar()),[r]),Ce=(0,u().K8)((()=>Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines)),[r]),we=(0,u().K8)((()=>{const e=(0,ue().v2)(F[0],r);return Se().default.state.stores.filter((t=>e.includes(t))).length>0}),[F,r]),ke=(0,u().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=r.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,P().wy)({environment:R,collectionContextStore:r,isPhone:I,theme:_}),display:"flex",...e&&-1===t&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${_.tableDividerColor}`}},i=Boolean(e&&-1===t),l=Boolean(i&&(o||we)),s=r.collectionViewBlockStore(),a=!!s&&(0,Td().d1)(s);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:a}}),[we,r,R,I,_],{useDeepEqual:!0}),Ae=(0,u().K8)((()=>{const e=r.collectionViewStore();return X&&A&&!(null!=e&&e.isSyncedCollection())}),[X,r,A]),Ie=(0,u().O$)(r.defaultPageTemplateStore),Te=(0,u().K8)((()=>{var e,o;const n=null===(e=r.collectionStore())||void 0===e?void 0:e.id;return(t.state.isOpen&&(null===(o=t.state.collectionContextStore)||void 0===o||null===(o=o.collectionStore())||void 0===o?void 0:o.id))===n}),[t,r]),[je,Pe]=(0,n.useState)(!1),Fe=(0,n.useCallback)((()=>{Pe(!0)}),[]),Ve=(0,n.useCallback)((()=>{Pe(!1)}),[]),Le=(0,n.useCallback)((()=>{if(!L)return;const e=r.collectionStore();if(!e||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o=Se().default.state.stores[0];if(!o)return;const n=r.subitemTreeStore.state,i=(0,Kn().Qe)(n.children,(e=>e.value.store===o));if(!i)return;const l=i?(0,ue().kY)(i.map((e=>e.value.store))):"",s=r.subitemExpandedStore.state.get(l);Boolean(null==s?void 0:s.isExpanded)&&T().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:R,canUndo:!0,perform:n=>{const l=(0,vl().u)({environment:R,collectionContextStore:r,groupsPointer:L.groupsPointer,store:o,before:!1,collectionStore:e,transaction:n,subitemPath:i,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&t){const e=()=>{_i().ho({isNewBlock:!0,environment:R,blockPropertyValueOverlayStore:t,store:l,property:"title",format:"table",collectionContextStore:r})};r.registerCallbackForItemMounted(l,e)}}})}),[t,r,R,L]),Ee=(0,n.useCallback)((e=>{const n=new(o(838256).aD)(R,"handleAddRowClick");if(!(0,nt().EF)(R)||!L)return n.fail("invalid_state"),void(0,nt().QY)(R);r.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:r,isFullScreen:c}),T().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:R,canUndo:!0,perform:e=>{const o=(0,En().Q)({environment:R,collectionContextStore:r,groupsPointer:s?[s]:[],shouldCoerce:!0,templateStore:Ie,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:R.defaultRecordCache.inMemoryRecordCache});if(!o)return;const i=o.newStore;if(A){const e=(0,sl().Ay)({store:i,fullyQualified:!1,pageVisitSource:Vo().y8.Create});B?B(e):rl().oo({environment:R,url:e})}else{if(o.coercionSucceeded){const o=()=>{_i().ho({isNewBlock:!0,environment:R,blockPropertyValueOverlayStore:t,store:i,property:"title",format:"table",collectionContextStore:r})};r.registerCallbackForItemMounted(i,o),e.postSubmitCallbacks.push((async e=>{if(!e)return r.virtualizedModule.waitToScrollToBlock(F,i)}))}else $o().VU({environment:R,store:i,peekMode:V().hH(r),resultsStore:L.resultsStore,collectionContextStore:r,pageVisitSource:Vo().y8.Create});const n=r.currentSubitemFormatStoreForCollectionStore.state;On().v(R,{from:n?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:i.id,creating_block_id:i.id,...(0,Me().sl)(r)})}}})}),[R,L,r,c,s,Ie,A,B,t,F]),De=(0,n.useCallback)((e=>{L&&((0,Oe().kV)(e),O&&(0,Wi().H)({collectionContextStore:r,environment:R,incrementLimitArgs:{isFullScreen:c,currentResultCount:O.blockIds.length,groupsPointer:L.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,Ad().K)(R))}),[r,R,L,c,O]),ze=(0,V().Oz)(r),He=(0,p().IS)((e=>{const{button:t,buttonInner:o,icon:n}=(0,P().BJ)({theme:e,isMobile:A,hideTextWithTransition:he&&je,hideTextWithoutTransition:he&&Te});return{wrapper:{position:"relative",marginBottom:w?12:void 0},iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:k?`1px solid ${e.tableDividerColor}`:void 0,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...N?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}},loadMoreButtonInner:o,text:{color:e.text.tertiary,flexGrow:1},addRowButtonWrapper:{...t,display:"flex",alignItems:"center",gap:w?4:2,paddingLeft:2,paddingRight:2},addRowButton:{...w?{display:"inline-flex",height:28,borderRadius:6,paddingLeft:6,paddingRight:8}:{...t},background:(null==ze?void 0:ze.background)||(d?e.cardContentBackground:e.contentBackground)},addRowButtonHovered:{background:w?e.buttonHoveredBackground:e.tableRowHoveredBackground},addRowButtonInner:{...o,fontSize:A?Bc().hN:Bc().Mi},linkExistingButton:{paddingLeft:6,paddingRight:8,borderRadius:6,marginLeft:w?void 0:12},linkExistingButtonInner:{display:"flex",alignItems:"center",gap:8,fontSize:A?Bc().hN:Bc().Mi,height:28,color:e.text.tertiary},linkExistingIcon:{width:A?Po().Ev.default:Po().Ev.sm,height:A?Po().Ev.default:Po().Ev.sm,fill:e.icon.tertiary},aggregationRow:{...(!E||oe)&&{opacity:0,pointerEvents:"none",left:0,right:0}},spinner:{marginTop:1,marginLeft:8,marginRight:8}}}),[A,k,he,je,Te,w,N,null==ze?void 0:ze.background,d,E,oe]),We=(0,n.useCallback)((e=>(0,G.jsx)(pp,{args:e,store:x,collectionContextStore:r,collectionViewFormat:J,blockPropertyValueOverlayStore:t,groupFormat:s,groupsPointer:F,propertyFormats:q,schema:y,canDrag:Ae,disabled:i,titleColumnIndex:Y,onShiftEnter:Le,frozoneProps:ke,isInHomeWidget:oe,isFullScreen:c,isInEphemeralView:ie,paddingLeft:S,paddingRight:h,headerWidth:C,shouldShowShimmer:K})),[x,r,J,t,s,F,q,y,Ae,i,Y,Le,ke,oe,c,ie,S,h,C,K]);return L?(0,G.jsxs)("div",{style:He.wrapper,children:[(0,G.jsx)(Ku,{store:x,format:J,groupFormat:s,schema:y,query:f,collectionContextStore:r,isInPeekRenderer:d,minWidth:g,paddingBottom:m,paddingLeft:S,paddingRight:h,blockPropertyValueOverlayStore:t,resultStore:L.reducerResultStore,showPropertyFormats:q,showRightActions:$.canConfigureCollection&&$.canConfigureBlock&&!ie&&!le,showHoverActionsStore:v,allowHidingTitle:!1,tableStore:b,formatKey:"table_properties",disabled:i||!$.canConfigureBlock,disableTopBorder:!be||me||w,disableCellRightBorder:!be||me||Ce||w,height:Ro().sH,frozoneProps:ke,isInHomeWidget:oe,hasMoreReducerResults:Boolean(null==O?void 0:O.hasMore)}),(0,G.jsx)(ap,{store:x,collectionContextStore:r,minWidth:g,blockPropertyValueOverlayStore:t,showPropertyFormats:q,disabled:!X,groupFormat:s,tableStore:b,paddingLeft:S,render:We}),K&&(0,G.jsx)(dp,{isFullScreen:c,hasGroups:void 0!==s,propertyWidths:Q,hasPartialResults:D,hasSearchQuery:ce,frozoneProps:ke}),he?(0,G.jsx)(Dd,{collectionContextStore:r,handleAddRowClick:Ee,numberOfBlankRows:fe,hideDefaultButtonText:je,propertyFormats:q,isBlockPropertyValueOverlayOpen:Te,query:f}):null,(0,G.jsx)("div",{style:{width:ee}}),xe&&(oe?(0,G.jsx)(ol().jJ,{groupsPointer:F,store:x,collectionContextStore:r,format:l,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:He.viewAllButton}):(0,G.jsx)(Pt().A,{onMouseDown:Oe().tr,onClick:De,disabled:N,hoveredStyle:He.loadMoreButtonHovered,style:He.loadMoreButton,children:(0,G.jsxs)("span",{style:He.loadMoreButtonInner,children:[(0,gn().g)(He.iconStyle),(0,G.jsx)("div",{style:He.text,children:(0,G.jsx)(vt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),N?(0,G.jsx)("div",{style:He.spinner,children:(0,G.jsx)(hn().A,{size:"sm"})}):X&&(0,G.jsx)(Id().w,{collectionContextStore:r,format:l})]})})),pe&&!he&&w&&(0,G.jsxs)("div",{style:He.addRowButtonWrapper,children:[(0,G.jsx)(Pt().A,{onClick:Ee,onMouseDown:Oe().tr,style:He.addRowButton,hoveredStyle:He.addRowButtonHovered,className:Be().$0P,children:(0,G.jsxs)("span",{style:He.addRowButtonInner,children:[(0,qo().plusSmallIcon)(He.iconStyle),(0,G.jsx)(il().w,{collectionContextStore:r})]})}),se&&(0,G.jsx)(Pi().O,{collectionContextStore:r,groupFormat:s,renderLinkButton:e=>(0,G.jsx)(Pt().A,{style:He.linkExistingButton,...e,children:(0,G.jsxs)("span",{style:He.linkExistingButtonInner,children:[(0,Ti().arrowDiagonalUpRightSmallIcon)(He.linkExistingIcon),(0,G.jsx)(vt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]}),pe&&!he&&!w&&(0,G.jsx)(Pt().A,{onClick:Ee,onMouseDown:Oe().tr,style:He.addRowButton,hoveredStyle:He.addRowButtonHovered,className:Be().$0P,children:(0,G.jsxs)("span",{style:He.addRowButtonInner,children:[(0,qo().plusSmallIcon)(He.iconStyle),(0,G.jsx)(il().w,{collectionContextStore:r}),se&&(0,G.jsx)(Pi().O,{collectionContextStore:r,groupFormat:s,renderLinkButton:e=>(0,G.jsx)(Pt().A,{style:He.linkExistingButton,...e,children:(0,G.jsxs)("span",{style:He.linkExistingButtonInner,children:[(0,Ti().arrowDiagonalUpRightSmallIcon)(He.linkExistingIcon),(0,G.jsx)(vt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),ve&&(0,G.jsx)(Od,{pageCount:z,collectionContextStore:r,disabled:i||!ge,groupFormat:s,isFullScreen:c,isInPeekRenderer:d,onMouseEnter:Fe,onMouseLeave:Ve,paddingLeft:S,paddingRight:h,query:f,schema:y,showPropertyFormats:q,showRightActionsSpacer:$.canConfigureCollection,style:He.aggregationRow})]}):null})),pp=n.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:r,collectionContextStore:i,collectionViewFormat:l,disabled:s,frozoneProps:c,groupFormat:d,groupsPointer:g,isFullScreen:m,isInHomeWidget:S,onShiftEnter:h,propertyFormats:f,schema:y,store:v,titleColumnIndex:x,isInEphemeralView:b,paddingLeft:C,paddingRight:w,headerWidth:k,shouldShowShimmer:R}=e,A=(0,a().v3)(),I=(0,u().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),T=(0,u().K8)((()=>V().f5({collectionContextStore:i})),[i]),j=(0,u().K8)((()=>v.isNonEditableState()),[v]),_=(0,p().IS)((()=>({itemSelectableHalo:{borderRadius:3,zIndex:86},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),B=(0,n.useCallback)((()=>_.itemSelectableStyle),[_]),M=(0,n.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,G.jsx)(ad,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:s,groupsPointer:g,onSubitemCreate:e=>{if(o){const t=()=>{_i().ho({isNewBlock:!0,environment:A,blockPropertyValueOverlayStore:o,store:e,property:"title",format:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(e,t)}}})}),[o,i,s,A,g]),F=(0,u().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,Td().d1)(e)}),[i]),L=(0,u().K8)((()=>(0,ue().v2)(d,i)),[d,i]),O=(0,u().K8)((()=>{const e=Pd().A.state;if(e.isActive)return(0,P().yR)(e.selection,f.length,L.length)}),[L.length,f.length]),E=null==c?void 0:c.frozenIndex,D=(0,u().K8)((()=>V().qi(E)),[E]),[z,K]=(0,n.useMemo)((()=>void 0!==E?[f.slice(0,E+1),f.slice(E+1)]:[[],f]),[E,f]),H=(0,u().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),W=(0,u().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!H&&!f.some((e=>e.wrap)))}),[i,f,H]),N=(0,u().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),$=(0,u().K8)((()=>{var e;return!S&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,S]),U=(0,Cd().DV)(),X=(0,n.useMemo)((()=>({schema:y,collectionContextStore:i,propertyFormats:f,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:s,blockPropertyValueOverlayStore:o,disableCellBorderRight:I,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:j,disableTableWrap:!1,onShiftEnter:h,titleColumnIndex:x,groupFormat:d,frozoneProps:c,shouldShowMultiSelectCheckbox:T,isInHomeWidget:S,isCollectionViewBlockSelected:F,allRows:L,isInEphemeralView:b,normalizedTableSelection:O,unfrozenIndexAddendum:D,frozenPropertyFormats:z,unfrozenPropertyFormats:K,tableWrap:H,shouldSetCellHeight:W,isNonEditable:N,shouldShowRightActionSpacer:$,hasColumnVirtualizer:U})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,s,I,h,f,y,x,d,c,T,j,S,F,L,b,O,D,z,K,H,W,N,$,U]),q=m;return(0,G.jsx)(_l,{collectionContextStore:i,groupsPointer:g,format:l,canDrag:r,resultProps:X,canDrop:!0,resultComponent:Zu,disabled:s,direction:Tl.Vertical,getItemSelectableStyle:B,itemSelectableHaloStyle:_.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:x,nestedCreateSubitemButton:M,virtualizeResults:q,paddingLeft:C,paddingRight:w,headerWidth:k,shouldShowShimmer:R})}),Qo().A),gp=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:s,schema:c,disabled:d,isFullScreen:g,isRootChild:m,isInPeekRenderer:S,isPreviewing:h,query:f,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,minWidth:x,placementStore:b,headerWidth:C}=e,w=(0,a().v3)(),k=(0,u().uB)(void 0,bd),R=(0,n.useRef)(null),A=(0,H().X)("db_ux_chrome"),I=s.collection_group_by,T=g&&!I,j=(0,u().K8)((()=>(0,P().GW)(s,k)),[s,k]),_=(0,u().K8)((()=>(0,V().mM)(l,g)),[l,g]),B=(0,u().O$)(l.isInHomeWidgetStore),M=(0,u().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),F=(0,u().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===b.state;return e&&t}),[l.settingsStore,b]),L=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<Xe().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,Wi().H)({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:g,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,g]),O=(0,p().IS)((()=>({selectable:{position:"relative",marginRight:F?ko().vE:void 0},container:{position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i,marginTop:A?4:0}})),[o,r,i,F,A]),E=(0,Re().Zp)();return(0,Ni().A)((e=>{const n=(0,G.jsx)(gt().Ay,{store:t,shouldShowHalo:!g&&!B&&!h,canSelect:!g&&!M,disablePointerEvents:null==E?void 0:E.disableAllPointerEvents,analyticsName:"table",style:O.selectable,...e,children:I?(0,G.jsx)(mp,{collectionContextStore:l,store:t,format:s,schema:c,query:f,isFullScreen:g,isRootChild:m,isInPeekRenderer:S,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:d,headerWidth:C}):(0,G.jsx)(hp,{collectionContextStore:l,store:t,format:s,schema:c,query:f,isFullScreen:g,isInPeekRenderer:S,paddingLeft:r,paddingRight:i,headerWidth:C,paddingBottom:o,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:d,groupFormat:void 0})});return(0,G.jsx)("div",{className:Be().EOV,style:O.container,ref:R,children:(0,G.jsxs)(Il.Provider,{value:R,children:[I?(0,G.jsx)(kd,{collectionContextStore:l,tableProperties:j,paddingLeft:r,paddingRight:i,children:n}):(0,G.jsx)(pi,{nodeRef:R,children:(0,G.jsx)(kd,{collectionContextStore:l,tableProperties:j,paddingLeft:r,paddingRight:i,children:n})}),!_&&!T&&(0,G.jsx)(Gi().A,{onChange:e=>L(e)})]})})}))})),mp=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:s,isFullScreen:c,paddingLeft:d,paddingRight:u,isRootChild:g,isInPeekRenderer:m,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,tableStore:v,headerWidth:x}=e;const b=(0,a().v3)(),C=(0,p().IS)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),w=(0,H().X)("db_ux_chrome"),k=(0,n.useCallback)(((e,t)=>w&&0===e.index?{marginTop:4}:w||t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:C.groupDivider:{}),[w,C.groupDivider]),R=(0,n.useCallback)(((e,o)=>{if(b.device.isMobile)No().uK({environment:b,store:e,pageVisitSource:Vo().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;$o().VU({environment:b,store:e,peekMode:(0,V().hH)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:Vo().y8.Create})}}),[t,b]);return(0,G.jsx)(Ds,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:s,isFullScreen:c,isRootChild:g,paddingLeft:d,paddingRight:u,stickyLeft:!0,headerWidth:x,renderGroup:e=>(0,G.jsx)(hp,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:S,isFullScreen:c,isInPeekRenderer:m,disabled:s,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,paddingLeft:d,paddingRight:u,headerWidth:x,tableStore:v,groupFormat:e}),getGroupStyle:e=>k(e,t),renderHeader:e=>(0,G.jsx)(Sp,{args:e,isInPeekRenderer:m}),onGroupHeaderAddItem:(e,t,o)=>{R(e,o)}})})),Sp=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,u().O$)(n.isInHomeWidgetStore),i=(0,p().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,G.jsx)(ei,{...t,height:r?At().ag:Ro().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),hp=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:p,minWidth:g,paddingBottom:m,paddingLeft:S,paddingRight:h,headerWidth:f,tableStore:y}=e;const v=(0,u().uB)(y,bd);return(0,u().K8)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,G.jsx)(up,{tableStore:v,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:p,minWidth:g,paddingBottom:m,paddingLeft:S,paddingRight:h,headerWidth:f}):null}));var fp=()=>o(717989),yp=()=>o(839106);class vp extends g().Store{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class xp extends g().Store{getInitialState(){return new Set}}class bp extends(()=>o(959180))().A{constructor(){super(...arguments),this.itemsRefStore=new xp}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const Cp=new bp;(0,o(604341).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Cp);var wp=()=>o(396182),kp=()=>o(931121),Rp=()=>o(259464);const Ap=15,Ip=33,Tp=12,jp={position:"absolute",left:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function _p(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+Tp,o.top=o.top-Ap)),o):o}function Bp(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:l,isFullScreen:c,isRootChild:d,relationType:g,isUserDrawnTemp:m,isNewSubitemPlaceholder:S,renderEmitter:h}=e,f=(0,se().ET)(),y=(0,a().v3)(),v=(0,wp().I)(),[x,b]=(0,n.useState)(!1),C=(0,p().DP)(),[w,k]=(0,n.useState)(null),[R,A]=(0,n.useState)(null),I=(0,n.useCallback)((e=>{k(e.state)}),[]),T=(0,n.useCallback)((e=>{A(e.state)}),[]),j=(0,n.useCallback)((()=>{s().default.afterNextFlush((()=>{v("CollectionTimelineRelationArrow","CollectionTimelineRelationArrow/resetTopPositions")}))}),[v]);(0,n.useEffect)((()=>(k(t.stores.nodeStore.state),A(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(I),null==o||o.stores.nodeStore.addListener(T),null==h||h.addListener(j),f.filtersBarOpenStore.addListener(j),()=>{t.stores.nodeStore.removeListener(I),null==o||o.stores.nodeStore.removeListener(T),null==h||h.removeListener(j),f.filtersBarOpenStore.removeListener(j)})),[t,o,h,I,T,j,f.filtersBarOpenStore]);const _=(0,u().K8)((()=>Gn().Ay.state.isDragging&&Gn().Ay.state.draggedStores.includes(t.props.store)),[t]),B=(0,u().K8)((()=>o&&Gn().Ay.state.isDragging&&Gn().Ay.state.draggedStores.includes(o.props.store)),[o]),P=(0,u().K8)((()=>{const e=Gn().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),M=w&&w.getBoundingClientRect().y+(_?P:0),F=(0,u().K8)((()=>{const e=t.itemPositionStore.state;return M&&e?{left:e.left,right:"subitem"===g?e.left+Tp:e.right,top:"subitem"===g?M+Ap:M}:void 0}),[g,t.itemPositionStore,M]),V=R&&R.getBoundingClientRect().y+(B?P:0),L=(0,u().K8)((()=>{const e=V&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:V}:void 0;return"subitem"===g?_p({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,V,g,t.itemPositionStore]),O=(0,u().O$)(t.dateValueStore),E=(0,u().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),D=(0,u().K8)((()=>void 0!==i.dragStateStore.state),[i]),z=(0,u().K8)((()=>void 0!==i.drawStateStore.state),[i]),K=(0,u().O$)(i.hoveredItemStore),H=x&&!D&&!z,W=(0,n.useCallback)((()=>{r&&!l&&fp().cd({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:f,environment:y,timelineState:i,isFullScreen:c,isRootChild:d})}),[t,l,r,f,y,i,c,d]),N=(0,n.useCallback)((()=>{b(!0)}),[b]),$=(0,n.useCallback)((()=>{b(!1)}),[b]),U=(0,n.useCallback)((e=>{if(L)return(0,G.jsx)(Pp,{topOffset:e,endPosition:L,handleCloseButtonClick:W})}),[L,W]),X=(0,u().O$)(f.permissionScopesStore),q=K===t.props.store,Y=o&&K===o.props.store,Q=q||Y||H||"subitem"===g?1:.7;let Z;const J=(0,u().K8)((()=>t.props.store.canEdit()),[t.props.store]),ee=(0,u().K8)((()=>"subitem"!==g&&(J&&("collectionTypedView"===f.contextType||X.canEditContent))),[g,J,f,X.canEditContent]);"subitem"===g?Z=C.collectionUnsetDependencyArrow:O&&E&&(Z=O<=E?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const te=(0,p().IS)((()=>({svgStyle:{zIndex:"dependency"===g&&(H||Y)?86:83}})),[g,H,Y]);return F?m?(0,G.jsx)(Mp,{startPosition:F,timelineState:i}):S?(0,G.jsx)(Fp,{startPosition:F,timelineState:i}):t!==o&&L?(0,G.jsx)(Vp,{startPosition:F,endPosition:L,strokeOpacity:Q,strokeColorOverride:Z,svgStyle:te.svgStyle,cornerRadiusOverride:"subitem"===g?8:void 0,relationType:g,handleMouseMove:N,handleMouseLeave:$,renderChildren:ee&&H?U:void 0}):null:null}function Pp(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,p().IS)((e=>({icon:{background:e.white,borderRadius:5,fill:e.palette.red[500],height:14,width:14}})),[]);return(0,G.jsx)(G.Fragment,{children:(0,G.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,kp().J)(r.icon)})})}function Mp(e){const{startPosition:t,timelineState:o}=e,n=(0,u().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore]);return n?(0,G.jsx)(Vp,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function Fp(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,p().DP)(),i=(0,u().O$)(n.dateRangePlaceholderStore),l=(0,u().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),s=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=s?s[s.length-1].children.length:0,c=o.top+a*Ip+Ap+5,d=(0,u().K8)((()=>{const e=(0,Ao().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return _p({startItemPosition:o,value:t})}),[l,c,o,n]);return d?(0,G.jsx)(Vp,{startPosition:o,endPosition:d,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function Vp(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:s,svgStyle:a,handleMouseMove:c,handleMouseLeave:d}=e,g=(0,se().ET)(),m=(0,p().DP)(),[S,h]=(0,n.useState)(0),f=t.right,y=t.top+Ap-S,v=o.left-3,x=o.top+Ap-S,b=(0,u().K8)((()=>{if(r)return r;return(0,Ao().tH)(g)&&t.right&&o.left?t.right<o.left?m.collectionValidDependencyArrow:m.collectionInvalidDependencyArrow:m.collectionUnsetDependencyArrow}),[g,o.left,t.right,r,m]);return(0,G.jsx)("svg",{style:{...jp,...a},ref:e=>{e&&h(e.getBoundingClientRect().top)},children:(0,G.jsx)(Rp().A,{startPoint:{x:f,y},endPoint:{x:v,y:x},style:{stroke:b,strokeWidth:Ao().cC,strokeOpacity:l},useRightAngles:"subitem"===s,showArrowHead:"dependency"===s&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:d,children:e.renderChildren&&e.renderChildren(S)})})}function Lp(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:s}=e,a=(0,se().ET)(),c=(0,n.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),d=(0,u().K8)((()=>a.collectionViewBlockStore()),[a]),p=(0,u().K8)((()=>a.settingsStore.state.open),[a]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[p,t.drawStateStore,c]),!r||!d)return null;const g=Cp.findCollectionTimelineViewItems(d);return(0,G.jsx)(G.Fragment,{children:g.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,Lo().AC)(c):"noGroup";return(0,G.jsxs)(n.Fragment,{children:[(0,G.jsx)(Op,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,G.jsx)(Op,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function Op(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:s,renderEmitter:a}=e,{store:c,schema:d}=t.props,p=(0,se().ET)(),g=(0,u().K8)((()=>"dependency"===s?o.drawStateStore.state:void 0),[o.drawStateStore,s]),m=(0,u().K8)((()=>(null==g?void 0:g.startStore)===c),[c,g]),S=(0,u().K8)((()=>m&&!(null!=g&&g.tryToCompleteDrawnArrow)),[g,m]),h=(0,u().K8)((()=>"dependency"===s?m&&g?g.temporaryDependencyRelationPointers:(0,Ao().GW)(p,c,d):"subitem"===s?(0,Ao().s0)(p,c,d):[]),[s,m,g,p,c,d]),f=(0,u().K8)((()=>p.collectionViewBlockStore()),[p]),y=(0,u().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==s||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[s,t.props.store,o.dateRangePlaceholderStore]),v=(0,u().K8)((()=>[...Cp.getItemsRefStore().state]),[]);return f?(0,G.jsxs)(G.Fragment,{children:[h.map((e=>{if(c.id===e.id)return null;const d=v.filter((t=>t.props.store.id===e.id));return(0,G.jsx)(n.Fragment,{children:d.map((n=>{const c=n.props.store,d=n.props.groupFormat;return(0,G.jsx)(Bp,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:s},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===s&&S&&(0,G.jsx)(Bp,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===s&&y&&(0,G.jsx)(Bp,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const Ep=n.memo((function(e){const{zoomLevel:t,onChange:o}=e,r=(0,a().Y0)(),i=(0,p().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.icon.secondary}})),[]),l=(0,n.useMemo)((()=>(0,vi().b)(i.icon)),[i.icon]),s=(0,n.useCallback)((e=>(0,G.jsxs)(ln().p,{size:"sm",isGray:!0,...e,children:[(0,G.jsx)(Dp,{zoomLevel:t}),l]})),[l,t]),c=(0,n.useCallback)((e=>(0,G.jsx)(zp,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,G.jsx)(sn().Ay,{popupType:r.isMobile?Ea().nl.SlideUp:Ea().nl.Popup,originGap:8,renderOrigin:s,render:c})})),Dp=n.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,G.jsx)(vt().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,x().HB)(t)})),zp=n.memo((function(e){const{zoomLevel:t,onChange:o,parent:r}=e,{isMobile:i}=(0,a().Y0)(),l=(0,n.useMemo)((()=>[{key:"calendar by section",render:e=>(0,G.jsx)(wr().A,{...e}),items:Rd().Ui.map((e=>{const t={key:e,render:t=>(0,G.jsx)(Or().A,{...t,title:(0,G.jsx)(Dp,{zoomLevel:e})}),action:()=>{o(e),r.close()}};return t}))}]),[o,r]),s=(0,n.useCallback)((e=>{const o=i?{menuType:yr().gu.Modal,title:(0,G.jsx)(vt().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,G.jsx)(Cr().DoneMenuText,{}),onClickRight:r.close,...e}:{menuType:yr().gu.Popup,width:180,...e};return(0,G.jsx)(xr().A,{...o,children:(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,sections:l,initialFocus:Rd().Ui.indexOf(t)})})}),[i,r.close,l,t]);return(0,G.jsx)(pt().A,{capture:!0,allowEsc:!0,render:s})})),Kp=6,Hp=Ao().tp+Ao().lH,Wp=n.memo((function(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:s,isFullScreen:c,isRootChild:d,isReady:g,collectionContextStore:m,isInPeekRenderer:S,format:h,paddingRight:f}=e;const y=(0,p().DP)(),v=(0,a().v3)(),x=(0,u().K8)((()=>{const e=t.zoomLevelStore.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=Ao().eM[e],a=t.scrollLeftStore.state,{startTimestamp:d}=t.currentRangeStore.state;if(void 0!==a){const t=d+(0,Ao().C1)(e,a+i+(!s&&c?l:0));return(0,Ao().DY)(r().c9.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,s,c]),b=(0,a().Y0)(),C=(0,u().O$)(t.zoomLevelStore),w=(0,u().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:k}=Ao().eM[C],R=(0,u().K8)((()=>(0,Ao().DG)({environment:v,isFullScreen:c,isRootChild:d})),[v,c,d]),A=(0,u().O$)(m.permissionScopesStore),I=!s&&R&&A.canConfigureBlock,j=(0,V().Oz)(m),_=(null==j?void 0:j.background)||(S?y.cardContentBackground:y.contentBackground),B=S?y.cardContentBackgroundTransparent:y.contentBackgroundTransparent,P=(0,p().IS)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:c&&!s?i+l:i,display:"flex",alignItems:"center",height:Hp,paddingTop:Kp+(b.isMobile?2:0),background:_,fontSize:14,fontWeight:Fo().Wy.medium},outerContainer:{position:"sticky",left:0,width:w,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:f,display:"flex",alignItems:"center",height:Hp,paddingTop:Kp+1,background:_},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:b.isIOS?0:1,height:22,fill:y.icon.tertiary}})),[_,b.isIOS,b.isMobile,c,w,l,f,i,s,y.icon.tertiary]),M=(0,n.useRef)(null),F=(0,n.useCallback)((e=>{fp().k3({timelineState:t,environment:v,zoomLevel:e,centerTimestamp:(0,Ao().o$)(t)}),(0,yp().z2)(v,(0,yp().ZR)({environment:v,collectionContextStore:m,timelineState:t,isFullScreen:c,isRootChild:d}))}),[t,v,m,c,d]);return(0,G.jsx)(Qr().g,{stickyAttachPoint:"ceiling",nodeRef:M,noPlaceholder:!0,children:(0,G.jsxs)("div",{style:P.outerContainer,ref:M,children:[x&&(0,G.jsxs)("div",{style:P.secondaryDisplayUnit,children:[I&&(0,G.jsx)(Ft().A,{render:e=>(0,G.jsx)(ln().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;T().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ao().iH)(t,!0);Wo().zA({stores:[l],update:o,transaction:e})}}),(0,yp().VD)(e,{...(0,yp().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(v,h,t,m,c,d),style:P.hideTableIcon,...e,children:(0,o(996624).a)({width:14})}),renderTooltip:()=>(0,G.jsx)(vt().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,G.jsx)("span",{style:{paddingLeft:I||b.isPhone?0:c||s?16:2},children:(0,Ao().Kx)(x,k)}),!g&&!s&&(0,G.jsx)(Gp,{}),(0,G.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${_} 20%, ${B} 100%)`}})]}),(0,G.jsxs)("div",{style:P.controlBarRight,children:[(0,G.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${_} 20%, ${B} 100%)`}}),(0,G.jsx)(td().A,{collectionContextStore:m,entrypoint:"timeline_view"}),(0,G.jsx)(Ep,{zoomLevel:C,onChange:F}),(0,G.jsx)(ln().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ao().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ao().o$)(t),p=u-(0,Ao().C1)(s,d);fp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,yp().i6)(e,{...(0,yp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(v,t,l,h,c,d,m),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,o(380048).I)({width:12,fill:y.icon.secondary})}),(0,G.jsx)(ln().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=(0,Ao().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});fp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:a}),(0,yp().AP)(e,{...(0,yp().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(v,t,l,h,m,c,d),children:(0,G.jsx)(vt().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,G.jsx)(ln().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ao().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ao().o$)(t),p=u+(0,Ao().C1)(s,d);fp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,yp().i6)(e,{...(0,yp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(v,t,l,h,c,d,m),style:{paddingLeft:4,paddingRight:4},children:(0,o(742117).V)({width:12,fill:y.icon.secondary})})]})]})})}));function Gp(){return(0,ys().A)(!0,400,0)?(0,G.jsx)(hn().A,{style:{marginLeft:8,marginTop:1}}):null}var Np=()=>o(496506),$p=()=>o(402390);function Up(e){const{shouldShowShimmer:t,children:o}=e,n=(0,ys().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,G.jsx)("div",{className:n,style:{height:"100%"},children:o})}const Xp=4,qp=22,Yp=110,Qp=7,Zp=22,Jp=12,eg=4,tg=32;function og(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:s,schema:c}=e,d=(0,a().Y0)(),g=(0,vt().tz)(),m=(0,H().X)("db_ux_chrome"),S=(0,n.useRef)(null),{value:h}=(0,ge().fJ)(Te().T.formulas),f=(0,wp().I)(),y=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&f("CollectionTimelineViewTimeBar","CollectionTimelineViewTimeBar/handleSeconds")}),[f]);(0,n.useEffect)((()=>{const e=setInterval(y,1e3);return()=>clearInterval(e)}),[y]);const{primaryDisplayUnit:x,activeRangeType:b}=(0,u().K8)((()=>{const e=l.zoomLevelStore.state;return Ao().eM[e]}),[l]),C=(0,Ao().LH)(x),w=r().c9.now(),k=C?w.startOf("minute"):w.startOf("day"),R=w.startOf("minute"),A=(0,u().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Sn().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),I=(0,u().K8)((()=>o.viewIsFlushToTopbar()),[o]),T=new(Np().ComputedStore)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:a}=Ao().eM[n];if(!a)return;let d;if(t)d=t.temporaryValues.map((e=>(0,Ao().yl)(e,"day")));else if(i.active)d=[(0,Ao().yl)(i.date,"day")];else{const{stores:t}=Se().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=v().sb(v().oE([...n,r]));d=v().oE(i.map((e=>{const t=(0,Ao().GM)({store:e,query:s,schema:c,userId:o.getCurrentUserId(),intl:g,formulasModule:h});if(t)return(0,Ao().yl)(t,"day")})))}const u=v().wq(d,(e=>{let{start:t}=e;return t.valueOf()})),p=v().Sk(d,(e=>{let{end:t}=e;return t.valueOf()}));return u&&p?{start:u.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),j=null===(t=(0,V().Oz)(o))||void 0===t?void 0:t.background,_=(0,p().IS)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:j||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:I&&!m?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:Hp,position:"relative",overflow:"hidden"},primaryTimeBar:{height:tg,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[j,m,i,I]);return(0,G.jsx)(Qr().g,{stickyAttachPoint:"ceiling",nodeRef:S,stickyStyle:_.stickyStyle,transitionStickyStyle:_.transitionStickyStyle,noPlaceholder:!0,children:(0,G.jsxs)("div",{style:_.wrapper,ref:S,children:[(0,G.jsx)("div",{style:_.controlBar,children:!d.isPhone&&(0,G.jsx)(pg,{timelineState:l})}),(0,G.jsxs)("div",{style:_.primaryTimeBar,children:[(0,G.jsx)(Up,{shouldShowShimmer:A,children:(0,G.jsx)(ug,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:k})}),"highlight_days"===b&&(0,G.jsx)(mg,{timelineState:l,activeRangeStore:T}),(0,G.jsx)(gg,{timelineState:l,time:k}),"display_range"===b&&(0,G.jsx)(mg,{timelineState:l,activeRangeStore:T})]}),(0,G.jsx)(sg,{timelineState:l,time:R})]})})}function ng(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:s}=Ao().eM[r],a=(0,Ao().DY)(t,l),c=(0,Ao().Vz)(t,l),d=(0,Ao().w0)(r,a.valueOf()-i),u=(0,Ao().w0)(r,t.valueOf()-i),p=(0,Ao().w0)(r,c.valueOf()-i)-d,g=o?eg:0;return{left:("range_start"===s?u-p/2:u)-g,width:p+2*g}}function rg(e){return{color:e.text.primary,fontSize:Jp}}function ig(e){return{background:e.timelineRed,width:Zp,height:Zp,borderRadius:Zp/2,position:"absolute",left:`calc(50% - ${Zp/2}px)`,top:`calc(50% - ${Zp/2}px)`}}function lg(e){const{time:t,accent:o,timelineState:r}=e,i=(0,u().O$)(r.zoomLevelStore),{left:l,width:s}=(0,u().K8)((()=>ng({time:t,isNowIndicator:!1,timelineState:r})),[t,r]),a=(0,p().IS)((e=>({container:{position:"absolute",top:0,left:l,width:s,height:tg-4,display:"flex",alignItems:"start",lineHeight:tg-4+"px"},text:{fontSize:Jp,margin:"0 auto"},singleColor:{color:o?e.text.primary:e.text.tertiary},twoColorDarker:{color:o?e.text.primary:e.text.secondary},twoColorLighter:{color:o?e.text.secondary:e.text.tertiary}})),[o,l,s]),c=(0,n.useMemo)((()=>{const{primaryDisplayUnit:t}=Ao().eM[i],o=e.time.setLocale(ed().locale),n=(0,Ao().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,G.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,G.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,G.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,G.jsxs)(G.Fragment,{children:[t,e]}):(0,G.jsxs)(G.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,G.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,G.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h")}),t=(0,G.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,G.jsxs)(G.Fragment,{children:[t,e]}):(0,G.jsxs)(G.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("span",{style:{...a.twoColorLighter,paddingRight:3},children:o.toFormat("ccccc")}),(0,G.jsx)("span",{style:{...a.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,G.jsx)("span",{style:a.singleColor,children:o.toFormat("d")}):"month"===t?(0,G.jsx)("span",{style:a.singleColor,children:o.toFormat("M")}):void(0,x().HB)(t)}),[i,e.time,a.singleColor,a.twoColorDarker,a.twoColorLighter]);return(0,G.jsx)("div",{style:a.container,children:(0,G.jsx)("div",{style:a.text,children:c})})}function sg(e){const{time:t,timelineState:o}=e,r=(0,u().O$)(o.zoomLevelStore),{startTimestamp:i}=(0,u().O$)(o.currentRangeStore),l=(0,n.useMemo)((()=>Math.floor((0,Ao().w0)(r,t.valueOf()-i))),[r,t,i]),s=(0,p().IS)((e=>({container:{position:"absolute",left:l-Qp/2+.5,top:Math.floor(tg+Hp-Qp/2+.5),width:Qp,height:Qp,background:e.timelineRed,borderRadius:"100%"}})),[l]);return(0,G.jsx)("div",{style:s.container})}function ag(e){const{time:t,timelineState:o,intl:r}=e,{isMobile:i}=(0,a().Y0)(),l=(0,u().O$)(o.zoomLevelStore),{startTimestamp:s}=(0,u().O$)(o.currentRangeStore),c=(0,n.useMemo)((()=>(0,Ao().w0)(l,t.valueOf()-s)),[l,t,s]),d=(0,n.useMemo)((()=>{const{secondaryDisplayUnit:e}=Ao().eM[l];return(0,Ao().u7)((0,$p().H)(r),t.valueOf(),e)}),[l,r,t]),g=(0,p().IS)((e=>({container:{position:"absolute",top:0,left:c,height:tg,color:e.text.primary,fontSize:14,fontWeight:Fo().Wy.medium,verticalAlign:"middle",paddingTop:Kp+(i?2:7),display:"flex",alignItems:"center"}})),[i,c]);return(0,G.jsx)("div",{style:g.container,children:d},c)}function cg(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,p().DP)();return t&&o?n>=Yp?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:rg(r),children:(0,jc().W_)(t.valueOf(),"month_day",ed().locale)}),(0,G.jsx)("div",{style:{flexGrow:1}}),(0,G.jsx)("div",{style:rg(r),children:(0,jc().W_)(o.valueOf(),"month_day",ed().locale)})]}):(0,G.jsxs)("div",{style:rg(r),children:[(0,jc().W_)(t.valueOf(),"month_day",ed().locale)," – ",t.month===o.month?(0,jc().W_)(o.valueOf(),"day",ed().locale):(0,jc().W_)(o.valueOf(),"month_day",ed().locale)]}):(0,G.jsx)("div",{style:rg(r),children:(0,jc().W_)(t.valueOf(),"month_day",ed().locale)})}function dg(e,t,o,n){const r=e.setLocale(ed().locale),i=(0,Ao().LH)(o),l=(0,Ao().IW)();return i?l?(0,G.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,G.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("span",{style:{color:n.text.tertiary,paddingRight:3},children:r.toFormat("ccccc")}),(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)("div",{style:ig(n)}),(0,G.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)("div",{style:ig(n)}),(0,G.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function ug(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,u().O$)(o.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,u().O$)(o.currentRangeStore),s=Ao().eM[n],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:c}=s,d=c||0,p=(0,u().K8)((()=>ng({time:t,isNowIndicator:!0,timelineState:o})),[t,o]),g=p.left+d,m=p.left+p.width-d,S=[];let h=(0,Ao().DY)(r().c9.fromMillis(i),a);const f=(0,u().K8)((()=>ng({time:h,isNowIndicator:!1,timelineState:o})),[h,o]);for(;h.valueOf()<l;){const e=f.left+d,t=f.left+f.width-d;void 0!==c&&(g>=e&&g<=t||m>=e&&m<=t)||S.push((0,G.jsx)(lg,{timelineState:o,time:h,accent:!1},h.valueOf()));const n=(0,Ao().Vz)(h,a);h=n}return(0,G.jsx)(G.Fragment,{children:S})}function pg(e){let{timelineState:t}=e;const o=(0,vt().tz)(),n=(0,u().O$)(t.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,u().O$)(t.currentRangeStore),s=Ao().eM[n],{primaryDisplayUnit:a,secondaryDisplayUnit:c}=s,d=[];let p=(0,Ao().DY)(r().c9.fromMillis(i),c);for(;p.valueOf()<l;){d.push((0,G.jsx)(ag,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,Ao().Vz)(p,c);p=(0,Ao().zj)(e,a)}return(0,G.jsx)(G.Fragment,{children:d})}function gg(e){let{time:t,timelineState:o}=e;const n=(0,p().DP)(),r=(0,u().O$)(o.zoomLevelStore),{primaryDisplayUnit:i}=Ao().eM[r],{left:l,width:s}=(0,u().K8)((()=>ng({time:t,isNowIndicator:!0,timelineState:o})),[t,o]);return(0,G.jsx)("div",{style:{position:"absolute",top:0,left:l,width:s,height:tg-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,G.jsx)("div",{style:{fontSize:Jp,margin:"0 auto",display:"flex"},children:dg(t,r,i,n)})},l)}function mg(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,p().DP)(),i=(0,u().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,u().O$)(t.currentRangeStore),a=Ao().eM[i],{activeRangeType:c}=a,d=(0,u().O$)(o);if(d){const e=(0,Ao().DY)(r().c9.fromMillis(d.start),"day"),o=(0,Ao().w0)(i,e.valueOf()-l);if("highlight_days"===c){const a=[];let c=r().c9.fromMillis(Math.max(e.valueOf(),(0,Ao().DY)(r().c9.fromMillis(l),"day").valueOf()));for(;c.valueOf()<d.end&&c.valueOf()<s;){a.push(c);c=(0,Ao().Vz)(c,"day")}const u=(0,Ao().w0)(i,c.valueOf()-l)-o+2*Xp,p=a.map(((e,o)=>(0,G.jsx)(lg,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{position:"absolute",top:0,left:o-Xp,width:u,marginTop:(tg-qp)/2-2,height:qp,background:n.timelineDarkerBackground,borderRadius:qp/2}}),p]})}{const t=(0,Ao().DY)(r().c9.fromMillis(d.end),"day"),s=(0,Ao().NB)(r().c9.fromMillis(d.end),"day"),a=(0,Ao().w0)(i,t.valueOf()-l)-o+2*Xp;return(0,G.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-Xp,minWidth:a,marginTop:(tg-qp)/2-2,height:qp,background:n.timelineDarkerBackground,borderRadius:qp/2,paddingLeft:6,paddingRight:6},children:(0,G.jsx)(cg,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}return null}function Sg(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,u().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,G.jsx)(Us().Ay,{title:(0,G.jsx)(vt().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,G.jsx)(vt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,G.jsx)(Us().P6,{onClick:()=>{C().Ow({collectionContextStore:t,collectionSettingsStore:i}),C().a2({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,G.jsx)(vt().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function hg(e){let{timelineState:t}=e;const o=(0,wp().I)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o("TimelineBackground","TimelineBackground/handleSeconds")}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,u().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,u().O$)(t.currentRangeStore);return(0,G.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,G.jsx)(bg,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,G.jsx)(Cg,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,G.jsx)(xg,{zoomLevel:i,startTimestamp:l})]})}const fg=n.memo(hg,Qo().A),yg=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,p().IS)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,Ao().w0)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,Ao().w0)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,G.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),Qo().A),vg=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,p().IS)((e=>({verticalDivider:{position:"absolute",left:(0,Ao().w0)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,G.jsx)("div",{style:r.verticalDivider},t)}),Qo().A),xg=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,p().IS)((e=>{const n=r().c9.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Ao().w0)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,G.jsx)("div",{style:n.nowVerticalDivider})}),Qo().A),bg=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=Ao().eM[t];if(!i)return null;let l=(0,Ao().DY)(r().c9.fromMillis(o),"day");const s=[];for(;l.valueOf()<n;)6===l.weekday&&s.push((0,G.jsx)(yg,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Ao().Vz)(l,"day");return(0,G.jsx)(G.Fragment,{children:s})}),Qo().A),Cg=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=Ao().eM[t];if(!i)return null;const l=[];let s=(0,Ao().DY)(r().c9.fromMillis(o),i);for(;s.valueOf()<n;)l.push((0,G.jsx)(vg,{time:s.valueOf(),zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Ao().Vz)(s,i);return(0,G.jsx)(G.Fragment,{children:l})}),Qo().A);var wg=()=>o(74513);function kg(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:a}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,groupsDisplayState:c}=e,d=i.collection_group_by,u=t.groupsStore.getGroupState(n),p=Boolean(n&&!(null!=u&&u.toggleStateStore.state)),{currentGroups:g,visibleGroups:m,hiddenGroups:S}=c,h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,p,g,t),f=null==u?void 0:u.reducerResultStore.state,y=V().XQ({collectionContextStore:t,reducerResult:f,isFullScreen:o}),v=n===S[S.length-1],x=n===m[m.length-1],b=(0,Do().Zl)(c,t,!1),C=l.state?v:x,w=t.permissionScopesStore.state,k=C&&!r&&w.canConfigureBlock&&d&&(0,Lo().pP)(d,w.canConfigureCollection),R=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!s||!h)),tableHeaderRow:Boolean(s&&!p&&!h),tableAggregationRow:Boolean(s&&!p),addItemRow:Boolean(a&&!p),hiddenGroupsButton:Boolean(x&&S.length>0),groupsLoadMoreButton:Boolean(x&&b),loadMoreButton:Boolean(!p&&y),tableEmptyRow:Boolean(s&&!p&&R),extraGroupMarginBottom:Boolean(s&&p),addGroupButton:Boolean(k)}}),[a,t,r,i.collection_group_by,l,o,s])}const Rg=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,a().v3)(),i=(0,u().K8)((()=>Ag(t)),[t]),{value:l}=(0,ge().fJ)(Te().T.formulas),{value:s}=(0,ge().fJ)(de().VI.duplicateActions);return(0,G.jsx)(gt().Ay,{store:t,style:{width:"100%",height:wg().V+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?Ig(i,r,t,o,n):void 0,onInsertAbove:i?Tg(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i,l){const{droppedDirection:s,droppedStores:a,duplicate:c}=e,d=Ag(o);if(!d)return;const u=n.subitemTreeStore.state,p=(0,Kn().Qe)(u.children,(e=>e.value.store===o)),g=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(g,{environment:t,getData:()=>Me().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const m="collectionTypedView"===n.contextType;T().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{nr({environment:t,collectionStore:m?void 0:d,targetStore:o,droppedDirection:s,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:a,duplicate:c,transaction:e,subitemPath:p,collapsedGroup:!1,formulasModule:i,duplicateActions:l})}})}(e,r,t,o,n,l,s),onNativeDrop:e=>function(e,t,o,n,r,i,l){const{files:s,droppedDirection:a}=e,c=Ag(r);if(!c)return;const d=o.collectionViewBlockStore(),u=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:t,getData:()=>Me().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),d&&T().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{gl({environment:t,collectionStore:c,targetStore:d,droppedDirection:a,collectionContextStore:o,groupsPointer:n?[n]:[],files:s,transaction:e,formulasModule:i,duplicateActions:l})}})}(e,r,o,n,t,l,s),onRemove:e=>function(e,t){const{transaction:o}=e,n=Ag(t);if(!n)return;Ct().by({childStore:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function Ag(e){return e.getAssociatedCollectionStore()}function Ig(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,yl().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:s})}}function Tg(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,yl().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:s})}}function jg(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:s,paddingLeft:c,paddingRight:d,headerWidth:p,shouldShowShimmer:g}=e;const m=(0,a().v3)(),{value:S}=(0,ge().fJ)(Te().T.formulas),[h]=(0,n.useState)((()=>new(me().Bv)(m,t.pointer))),f=(0,u().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]),y=(0,u().O$)(r.permissionScopesStore),x=(0,u().K8)((()=>r.collectionViewStore()),[r]),b=(0,u().K8)((()=>i&&y.canEditContent&&!y.isSyncedCollection&&m.device.isMobile&&!(null!=x&&x.isSyncedCollection())),[i,x,m,y]),{value:C}=(0,ge().fJ)(de().VI.duplicateActions),w=(0,n.useMemo)((()=>{if(h)return(0,G.jsx)(gt().Ay,{store:h,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:s,duplicate:a}=e,c=o.collectionStore();if(!c)return;const d=o.groupsStore.getGroupState(t);if(!d)return;const u=o.collectionViewBlockStore(),p=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:n,getData:()=>Me().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),u&&T().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{nr({environment:n,collectionStore:c,targetStore:u,droppedDirection:l,collectionContextStore:o,groupsPointer:d.groupsPointer,droppedStores:s,duplicate:a,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})}})}(e,o,r,m,S,C),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e,a=t.collectionStore();if(!a)return;const c=t.collectionViewBlockStore(),d=He().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:n,getData:()=>Me().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),c&&T().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{gl({environment:n,collectionStore:a,targetStore:c,droppedDirection:s,collectionContextStore:t,groupsPointer:o?[o]:[],files:l,transaction:e,formulasModule:r,duplicateActions:i})}})}(e,r,o,m,S,C),analyticsName:"timeline",style:{width:"100%"}})}),[h,i,o,r,m,S,C]);return f?(0,G.jsxs)(G.Fragment,{children:[w,(0,G.jsx)(_l,{collectionContextStore:r,groupsPointer:f.groupsPointer,format:s,canDrag:b,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:v().lQ},canDrop:!0,resultComponent:Rg,disabled:l,direction:Tl.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Bg,paddingLeft:c,paddingRight:d,headerWidth:p,shouldShowShimmer:g,timelineType:"dropzone"})]}):null}const _g=n.memo(jg,Qo().A);function Bg(e){return(0,G.jsx)("div",{style:{width:"100%",height:wg().V+1}})}const Pg=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:s,paddingRight:c,headerWidth:d,onGroupHeaderAddItem:u,format:p,groupsReducerResultStore:g,hiddenGroupsVisibleStore:m,canEditCollectionTimeline:S,showTable:h}=e;const f=(0,n.useMemo)((()=>({type:"dropzone",hiddenGroupsVisibleStore:m})),[m]),y=(0,n.useCallback)((()=>null),[]),v=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,a().Y0)(),u=kg({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,P().sG)({isMobile:d})-1;let n=0,r=0;return t.groupHeader&&(n+=Ao().tp+Ao().lH-1),t.tableHeaderRow&&(n+=Ao().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=wg().V),t.loadMoreButton&&(r+=ol().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=xi+bi+Ci),t.groupsLoadMoreButton&&(r+=36),t.addGroupButton&&(r+=an+dn+cn),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:p,hiddenGroupsVisibleStore:m,showTable:h,canEditCollectionTimeline:S}),x=(0,n.useCallback)((e=>(0,G.jsx)(_g,{store:t,groupFormat:e,collectionContextStore:o,canEdit:S,format:p,disabled:r&&S,paddingLeft:s,paddingRight:c,headerWidth:d,shouldShowShimmer:!1})),[o,t,p,r,S,s,c,d]);return p.collection_group_by?(0,G.jsx)(Ds,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:s,paddingRight:c,headerWidth:d,stickyLeft:!1,renderGroup:x,getGroupStyle:v,renderHeader:y,onGroupHeaderAddItem:u,timelineProps:f,groupsResultStore:g}):(0,G.jsx)("div",{style:v(void 0),children:x(void 0)})}));function Mg(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,s=(0,u().O$)(n.isInHomeWidgetStore),a=(0,u().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),c=(0,p().IS)((e=>({outerDiv:{position:"sticky",left:0,width:a,height:Ao().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...s?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,s,a,i]);return(0,G.jsx)("div",{style:c.outerDiv,children:(0,G.jsx)(ei,{...o,style:c.headerStyle,stickyStyle:c.stickyStyle,preventToggleBackground:l})})}const Fg=new(ge().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,117686)))),Vg=(0,ge()._h)(Fg,(e=>e.TimelineItemDateRange)),Lg=(0,Po().wt)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",directional:!0,svg:(0,G.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})}),Og=(0,Po().wt)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",directional:!0,svg:(0,G.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})});var Eg=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Eg||{});function Dg(e){let{store:t,type:o,timelineState:r,scrollerLeftOffset:i,paddingLeft:l,format:s,itemPositionStore:c,dateValueStore:d,isDraggingViaTimelineItemStore:g,collectionContextStore:m,isFullScreen:S,isInPeekRenderer:h,isRootChild:f}=e;const y=(0,a().v3)(),v=(0,n.useRef)(Eg.NotDefined),x=(0,n.useRef)(null),b=(0,n.useRef)(null),[C,w]=(0,n.useState)(!1),k="left"===o?Lg:Og,R=(0,u().O$)(r.outerSizeObserver.rect),I=(0,u().r6)((()=>{const e=c.state;if(e){const{left:t,right:n}=e;if(g.state)return Eg.Hidden;const l=r.scrollLeftStore.state;if(void 0!==l){if("left"===o){const e=l+i;if(e-n>0)return Eg.VisibleOutOfItem;if(e-t>0)return Eg.VisibleInItem}else{const e=l+R.width;if(t-e>0)return Eg.VisibleOutOfItem;if(n-e>0)return Eg.VisibleInItem}return Eg.Hidden}}return Eg.NotDefined}),[g,c,R,i,r,o]),T=(0,p().IS)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:C?e.icon.primary:e.icon.secondary,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===o&&{marginLeft:8,marginRight:4},..."right"===o&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:h?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===o?i:R.width-220,width:220,height:Ro().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===o?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[C,h,R,i,o]);(0,n.useLayoutEffect)((()=>{j()}),[]),(0,n.useEffect)((()=>(I.addListener(j),()=>{I.removeListener(j)})),[]),(0,n.useEffect)((()=>{I.enqueueRecompute()}));const j=(0,n.useCallback)((()=>{const e=x.current,t=b.current;if(e&&t){const o=I.state,n=o===Eg.VisibleInItem||o===Eg.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===Eg.VisibleOutOfItem?"":"none";v.current!==Eg.NotDefined&&o!==Eg.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),v.current=o}}),[I]),_=(0,n.useCallback)((()=>{const e=d.state,n=r.zoomLevelStore.state,{snapUnit:i}=Ao().eM[n],a=(0,Ao().C1)(n,200);if(e)if("left"===o){const{start:t}=(0,Ao().yl)(e,i),o=(0,Ao().zb)({timestamp:t.valueOf(),environment:y,timelineState:r,paddingLeft:l,format:s})-a;fp().k3({timelineState:r,environment:y,zoomLevel:n,centerTimestamp:o})}else{const{end:t}=(0,Ao().yl)(e,i),o=(0,Ao()._r)({timestamp:t.valueOf(),timelineState:r})+a;fp().k3({timelineState:r,environment:y,zoomLevel:n,centerTimestamp:o})}w(!1),A().Lt({environment:y,store:t}),(0,yp().iT)(y,{...(0,yp().ZR)({environment:y,collectionContextStore:m,timelineState:r,isFullScreen:S,isRootChild:f}),type:o})}),[m,d,y,s,S,f,l,t,r,o]),B=(0,n.useCallback)((()=>{y.device.isPhone||Ye().A.state||w(!0)}),[y]),P=(0,n.useCallback)((()=>{y.device.isPhone||w(!1)}),[y]);return(0,G.jsxs)("div",{style:T.wrap,onMouseOver:B,onMouseOut:P,onMouseDown:Oe().tr,onClick:_,ref:b,children:[(0,G.jsx)("div",{style:T.arrow,ref:x,children:k(T.icon)}),C&&(0,G.jsx)(Kg,{dateValueStore:d,timelineState:r,isInPeekRenderer:h})]})}const zg=n.memo(Dg,Qo().A);function Kg(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,p().IS)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,u().O$)(t),l=(0,u().O$)(o.zoomLevelStore);return i?(0,G.jsx)("span",{style:r.dateRange,children:(0,Ao().tX)(i,l)}):null}class Hg extends g().Store{getInitialState(){return null}}function Wg(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:s,format:c,query:d,schema:g,blockPropertyValueOverlayStore:m,disabled:S,showProperties:h,collectionContextStore:f,isFullScreen:y,isRootChild:v,toggleButton:x,groupFormat:b,subitemPath:C,isInPeekRenderer:w,handleOpenPeekPage:k}=e;const A=(0,a().v3)(),{value:I}=(0,ge().fJ)(Te().T.formulas),j=(0,n.useRef)(null),[_]=(0,n.useState)((()=>t.clone())),B=(0,n.useRef)(null),P=(0,u().K8)((()=>{const e=o.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,Lo().Mn)(e.groupFormat,b))return e.date}),[b,t,o]),M=(0,u().r6)((()=>{const e=o.dragStateStore.state;if(P)return P;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return Gg(t,d,g,A,I)}),[A,P,d,g,t,o,I],{useDeepEqual:!0}),F=(0,u().O$)(M),L=(0,u().K8)((()=>{const e=(0,Kn().dC)(C);if(!e||Boolean(F))return;const t=e.value.store,o=Cp.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[F,C]),O=(0,u().r6)((()=>(0,Ao().BD)({timelineState:o,dateValue:F,placeholderDate:P,subitemPlaceholderDate:L})),[F,P,L,o]),E=(0,u().uB)(void 0,Hg);(0,uu().b)(Cp,(()=>({getNode:()=>j.current,props:{store:t,groupFormat:b,schema:g},stores:{nodeStore:E},dateValueStore:M,itemPositionStore:O})),[t,j,M,b,g,O,E]);const D=(0,u().O$)(O),z=(0,u().K8)((()=>{var e;return null===(e=f.groupsStore.getGroupState(b))||void 0===e?void 0:e.reducerResultStore}),[b,f]),K=(0,Re().Zp)(),H=Boolean(D&&!D.isPlaceholder&&!(null!=K&&K.disableAllPointerEvents)),W=(0,u().r6)((()=>{const e=o.dragStateStore.state,n=Gn().Ay.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,u().O$)(W);const N=(0,u().K8)((()=>t.getAssociatedCollectionStore()),[t]),$=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholderStore.state,r=f.groupsStore.getGroupState(b);if(r)if(n.active){const{date:e}=n;T().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:A,canUndo:!0,perform:o=>{fp().Xt({environment:A,store:t,query:d,schema:g,date:e,transaction:o})}}),o.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeftStore.state,s=O.state,a=B.current;if(!n||void 0===i||!s||!a)return;const c=n.getBoundingClientRect(),d=i+(e.clientX-c.left),u=B.current;if(!u)return;const p=u.lastElementChild;if(!p)return;const g=i+(p.getBoundingClientRect().right-c.left);d>s.right&&d<=g&&(0,l().SQ)({event:e,context:l().y$.Click,callback:()=>{(0,De().Zm)()||$o().VU({environment:A,store:t,openInNew:Oe().Vr(e),peekMode:(0,V().hH)(f),resultsStore:r.resultsStore,collectionContextStore:f,pageVisitSource:Vo().y8.PeekOpen})}})}}),[f,A,b,O,d,g,t,o]),U=(0,n.useCallback)((()=>{o.dateRangePlaceholderStore.setState({active:!1})}),[o]),X=(0,n.useCallback)((e=>{const{target:t}=e;!A.device.isMobile&&t instanceof HTMLElement&&(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:A,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[A]),q=(0,n.useCallback)((e=>{const n=o.dragStateStore.state,i=o.drawStateStore.state,{horizontalScroller:l}=o,s=o.scrollLeftStore.state,a=o.zoomLevelStore.state,c=o.currentRangeStore.state,{snapUnit:u,getDateRangePlaceholderDuration:p}=Ao().eM[a];if(!i&&Ye().A.state||n||Gg(t,d,g,A,I)||!l||void 0===s||S)return;const m=l.getBoundingClientRect(),h=s+(e.clientX-m.left),f=(0,Ao().C1)(a,h),y=r().c9.fromMillis(c.startTimestamp+f),v=(0,Ao().DY)(y,u),x=(0,Ao().DY)(p(y),u),C=(0,pc().p6)(v.valueOf(),(0,zn().P)()),w=(0,Ao().oJ)({startValue:C,snapUnit:u,desiredStart:v,desiredEnd:x});o.dateRangePlaceholderStore.setState({active:!0,store:t,parentStore:N,groupFormat:b,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:d,schema:g}})}),[A,o,t,b,S,d,g,N,I]),Y=(0,n.useCallback)((e=>{E.setState(e)}),[E]),Q=(0,p().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:wg().V+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!z)return null;const Z=Boolean(D);return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)("div",{ref:j,style:Q.scrollArrows,children:[H&&(0,G.jsx)(zg,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:M,paddingLeft:s,format:c,isDraggingViaTimelineItemStore:W,collectionContextStore:f,isFullScreen:y,isInPeekRenderer:w,isRootChild:v}),H&&(0,G.jsx)(zg,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:M,paddingLeft:s,format:c,isDraggingViaTimelineItemStore:W,collectionContextStore:f,isInPeekRenderer:w,isFullScreen:y,isRootChild:v})]}),(0,G.jsx)("div",{style:Q.dateRange,onMouseDown:X,onMouseMove:q,onMouseLeave:U,onClick:$,className:Be().ZLF,ref:Y,children:Z&&(0,G.jsx)(Vg,{store:t,parentStore:N,toggleButton:x,clonedStore:_,itemPositionStore:O,dateValueStore:M,query:d,schema:g,timelineState:o,blockPropertyValueOverlayStore:m,disabled:S,showProperties:h,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:W,collectionContextStore:f,isFullScreen:y,isInPeekRenderer:w,isRootChild:v,intl:Tt().A.getIntl(),propertiesWrapElementRef:B,resultStore:z,handleOpenPeekPage:k})})]})}function Gg(e,t,o,n,r){return(0,Ao().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:Tt().A.getIntl(),formulasModule:r})}function Ng(e){const{store:t,parentStore:i,timelineState:s,scrollerLeftOffset:c,query:d,schema:g,blockPropertyValueOverlayStore:m,disabled:S,showProperties:h,collectionContextStore:f,isFullScreen:y,isRootChild:v,toggleButton:x,groupFormat:b,canEditTimelineItems:C,subitemPath:w,paddingLeft:k,showTable:A}=e,I=(0,a().v3)(),{isMobile:j}=(0,a().Y0)(),[_,B]=(0,n.useState)(),M=(0,p().IS)((()=>({container:{display:"flex",height:(0,P().sG)({isMobile:j})+1,width:"100%",cursor:"default",isolation:"auto"}})),[j]);(0,n.useEffect)((()=>{B(null==t?void 0:t.clone())}),[t]);const F=(0,u().K8)((()=>{var e;return null===(e=f.groupsStore.getGroupState(b))||void 0===e?void 0:e.reducerResultStore}),[f.groupsStore,b]),V=(0,u().K8)((()=>{const e=s.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===i&&(0,Lo().Mn)(e.groupFormat,b))return e.date}),[b,i,t,s.dateRangePlaceholderStore]),L=(0,o(346923).l)(V),O=(0,u().K8)((()=>(0,Ao().BD)({timelineState:s,dateValue:L,placeholderDate:V,subitemPlaceholderDate:void 0})),[L,V,s]),E=(0,u().K8)((()=>Boolean(O)),[O]),D=(0,u().K8)((()=>!f.isInHomeWidgetStore.state&&!t&&!E&&f.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[f,E,t]),z=(0,u().O$)(f.isInPeekRendererStore),K=(0,n.useMemo)((()=>new(Np().ComputedStore)((()=>O),{debugName:"itemPositionStore"})),[O]),H=(0,n.useMemo)((()=>new(Np().ComputedStore)((()=>L),{debugName:"dateValueStore"})),[L]),W=(0,n.useMemo)((()=>new(Np().ComputedStore)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return F?(0,G.jsxs)("div",{style:M.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,I),onMouseMove:e=>function(e,t,o,n,i,l,s,a,c,d,u,p){var g;const m=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,f=t.scrollLeftStore.state,y=t.zoomLevelStore.state,v=t.currentRangeStore.state,{snapUnit:x,getDateRangePlaceholderDuration:b}=Ao().eM[y];if(!m&&Ye().A.state||S||!h||void 0===f||i)return;const C=null===(g=d.groupsStore.getGroupState(n))||void 0===g?void 0:g.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),R=(0,Ao().C1)(y,k),A=r().c9.fromMillis(v.startTimestamp+R),I=(0,Ao().DY)(A,x),T=(0,Ao().DY)(b(A),x),j=(0,pc().p6)(I.valueOf(),(0,zn().P)()),_=(0,Ao().oJ)({startValue:j,snapUnit:x,desiredStart:I,desiredEnd:T});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:_,newTimelineItemProps:{query:l,schema:s,resultsStore:C,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,s,t,b,S,d,g,y,C,f,i,w),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(s),onClick:e=>function(e,t,o,n,r,i,l,s,a,c,d,u){const p=r.dateRangePlaceholderStore.state;if(p.active){const{date:e}=p,g=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,nt().EF)(t))return void(0,nt().QY)(t);T().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=fp().dO({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:s,collectionContextStore:a,subitemPath:u,from:g});On().v(t,{from:g,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,Me().sl)(a)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,I,d,g,s,y,b,C,f,t,i,w),className:Be().ZLF,children:[E&&(0,G.jsx)(Vg,{store:i?void 0:t,parentStore:i,toggleButton:x,clonedStore:_,itemPositionStore:K,dateValueStore:H,query:d,schema:g,timelineState:s,blockPropertyValueOverlayStore:m,disabled:S,showProperties:h,scrollerLeftOffset:c,isDraggingViaTimelineItemStore:W,collectionContextStore:f,isFullScreen:y,isInPeekRenderer:z,isRootChild:v,intl:Tt().A.getIntl(),resultStore:F,handleOpenPeekPage:Ug}),D&&(0,G.jsx)(Qg,{parentStore:i,collectionContextStore:f,paddingLeft:k,isFullScreen:y,showTable:A})]}):null}const $g=n.memo(Ng);function Ug(){}function Xg(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,P().sG)({isMobile:t}),lineHeight:Fo().K_.UIRegular.desktop}}function qg(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Yg(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.icon.secondary}}function Qg(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const{isMobile:l}=(0,a().Y0)(),s=(0,p().DP)(),c=(0,u().O$)(o.currentSubitemFormatStoreForUiDisplayStore),d=(0,u().K8)((()=>{var e;return c&&t?null===(e=t.getSchema()[c.property])||void 0===e?void 0:e.name:""}),[c,t]);return(0,G.jsx)("div",{style:qg(n,r,i),children:(0,G.jsxs)("div",{style:Xg({isMobile:l}),children:[(0,Qt().W)(Yg(s)),(0,G.jsx)("span",{style:{color:s.text.secondary},children:t&&d?(0,G.jsx)(vt().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:d}}):(0,G.jsx)(vt().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function Zg(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:s,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:d,isFullScreen:p,isRootChild:g,groupFormat:m,paddingLeft:S,showTimelineProperties:h,scrollerLeftOffset:f,showTable:y,canEditTimelineItems:v,isInPeekRenderer:x,isReady:b,canEdit:C}=e,w=(0,u().K8)((()=>c.groupsStore.getGroupState(m)),[c,m]),k=(0,u().O$)(c.permissionScopesStore),R=(0,u().K8)((()=>"collectionTypedView"===c.contextType),[c]);return(0,u().O$)(c.isInHomeWidgetStore)||!w||!b||!C&&!R||k.isSyncedCollection?null:(0,G.jsx)($g,{store:t,disabled:i||!k.canEditContent&&!R,timelineState:r,schema:a,query:l,format:s,scrollerLeftOffset:f,paddingLeft:S,showProperties:h,blockPropertyValueOverlayStore:d,collectionContextStore:c,isFullScreen:p,showTable:y,isRootChild:g,groupFormat:m,canEditTimelineItems:v,isInPeekRenderer:x,parentStore:o,subitemPath:n})}const Jg=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:s,isFullScreen:c,paddingLeft:d,paddingRight:p,isInPeekRenderer:g,timelineState:m,blockPropertyValueOverlayStore:S,isRootChild:h,isReady:f,canEdit:y,disabled:x,scrollerLeftOffset:b,headerWidth:C}=e,w=(0,a().v3)(),k=(0,H().X)("collection_group_reducer_visible"),R=(0,u().K8)((()=>{if(k&&n)return;if(!r.timeline_by)return;const e=t.groupsStore.getGroupState(n);if(!e)return;const l=e.currentLimit.state,s=v().oE([n&&(0,Qn().K8)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,zn().P)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:l}}),[t,o,n,r,i,k]),A=(0,u().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),I=n?[n]:[],T=(0,u().K8)((()=>null==A?void 0:A.reducerResultStore.state),[null==A?void 0:A.reducerResultStore]),j=(0,u().K8)((()=>V().XQ({collectionContextStore:t,reducerResult:T,isFullScreen:c})),[t,T,c]),_=(0,u().K8)((()=>V().Cn({query:r,schema:o})),[r,o]),B=(0,u().K8)((()=>(s.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[s]);return A?(0,G.jsxs)(G.Fragment,{children:[R&&(0,G.jsx)(In().A,{id:I.length>0?`results:${(0,Lo().Hm)(I)}`:"timeline_results",reducer:R,groupsPointer:I,collectionContextStore:t,resultStore:A.reducerResultStore}),(0,G.jsx)(tm,{groupFormat:n,format:s,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:g,timelineState:m,blockPropertyValueOverlayStore:S,showTimelineProperties:B,paddingLeft:d,paddingRight:p,isFullScreen:c,isRootChild:h,isReady:f,canEdit:y,canEditTimelineItems:_,disabled:x,showTable:i,scrollerLeftOffset:b,headerWidth:C}),j&&(0,G.jsx)("div",{style:{width:"100%"},children:i?(0,G.jsx)("div",{style:{height:ol().LA}}):(0,G.jsx)(ol().jJ,{style:{position:"sticky",left:c?d:3,width:"max-content",height:ol().LA},groupsPointer:I,store:l,collectionContextStore:t,format:s,isFullScreen:c,incrementLimitsInRelatedGroups:!1})}),(0,G.jsx)(Zg,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>em(t,n,w),canEditTimelineItems:_,showTimelineProperties:B})]}):null};function em(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;He().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();k().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||xl().C9.timeline;fl().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function tm(e){const t=(0,a().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:s,blockPropertyValueOverlayStore:c,isFullScreen:d,isRootChild:p,showTable:g,canEditTimelineItems:m,scrollerLeftOffset:S,timelineState:h,paddingLeft:f,paddingRight:y,showTimelineProperties:v,isInPeekRenderer:x,headerWidth:b}=e,C=(0,u().K8)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:h,schema:s,query:l,format:n,scrollerLeftOffset:S,paddingLeft:f,showProperties:v,blockPropertyValueOverlayStore:c,collectionContextStore:r,isFullScreen:d,showTable:g,isRootChild:p,groupFormat:o,canEditTimelineItems:m,isInPeekRenderer:x,handleOpenPeekPage:()=>em(r,o,t),isLast:!1}}),[r,o,n,t,i,l,s,c,d,p,g,m,S,h,f,v,x]),w=(0,u().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return w?(0,G.jsx)(_l,{disableSelectable:!0,collectionContextStore:r,groupsPointer:w.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:C,canDrop:!1,resultComponent:Wg,disabled:!0,direction:Tl.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,G.jsx)(Zg,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>em(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e),timelineType:"item",paddingLeft:f,paddingRight:y,headerWidth:b,shouldShowShimmer:!1}):null}const om=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:s,paddingLeft:c,paddingRight:d,headerWidth:g,isRootChild:m,format:S,schema:h,query:f,showTable:y,groupsReducerResultStore:v,hiddenGroupsVisibleStore:x,canEditCollectionTimeline:b,isReady:C,blockPropertyValueOverlayStore:w,tableStore:k,scrollerLeftOffset:R,onGroupHeaderAddItem:A}=e;const I=(0,n.useMemo)((()=>({type:"item",hiddenGroupsVisibleStore:x})),[x]),T=(0,n.useCallback)((e=>{if(!y)return(0,G.jsx)(Mg,{timelineState:r,...e})}),[y,r]),j=(0,u().K8)((()=>(0,P().Ty)(S,k)),[S,k]),_=(0,n.useCallback)((e=>(0,G.jsx)(Jg,{store:t,groupFormat:e,schema:h,query:f,isInPeekRenderer:s,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:w,paddingLeft:c,paddingRight:d,format:j,isFullScreen:l,isRootChild:m,isReady:C,canEdit:b,disabled:i,showTable:y,scrollerLeftOffset:R,headerWidth:g})),[w,b,o,j,i,g,l,s,C,m,c,d,f,h,R,y,t,r]),B=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,a().Y0)(),u=(0,p().DP)(),g=kg({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{const t=g(e),o=(0,P().sG)({isMobile:d});let n=0,r=0;return t.groupHeader&&s&&(n+=Ao().tp+Ao().lH),t.tableHeaderRow&&(n+=Ao().MR-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&s&&(r+=xi+bi+Ci),t.groupsLoadMoreButton&&s&&(r+=36),t.addGroupButton&&s&&(r+=an+dn+cn),{paddingTop:n,paddingBottom:r,minHeight:Ao().tp,boxShadow:e.index>0&&(!s||t.tableHeaderRow)?`inset 0 -1px 0 ${u.tableDividerColor}`:void 0}}),[g,d,s,u.tableDividerColor])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:S,hiddenGroupsVisibleStore:x,showTable:y,canEditCollectionTimeline:b});return S.collection_group_by?(0,G.jsx)(Qr().l,{children:(0,G.jsx)(Ds,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:m,paddingLeft:c,paddingRight:d,stickyLeft:!1,renderGroup:_,getGroupStyle:B,renderHeader:T,onGroupHeaderAddItem:A,timelineProps:I,groupsResultStore:v,headerWidth:g})}):_()}));const nm=(0,Po().wt)("doubleChevronLeft",{viewBox:"0 0 16 16",directional:!0,svg:(0,G.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})});const rm=function(e){let{isGrouped:t,format:o,collectionContextStore:n,isFullScreen:r,isRootChild:i,timelineState:l}=e;const s=(0,p().DP)(),c=(0,a().v3)(),{device:d}=c;return(0,G.jsx)(Ft().A,{render:e=>(0,G.jsx)(ln().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;T().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ao().iH)(t,!1);Wo().zA({stores:[l],update:o,transaction:e})}}),(0,yp().VD)(e,{...(0,yp().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(c,o,n,r,i,l),style:{position:"absolute",top:t?d.isIOS?3:4:d.isIOS?7:8,right:t?6:8,zIndex:84,fill:s.icon.tertiary},...e,children:nm({width:14})}),renderTooltip:()=>(0,G.jsx)(vt().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function im(){const e=(0,p().IS)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,G.jsx)("div",{style:e.rowContainer,children:(0,G.jsx)(so().A,{style:e.rowShimmer})})}const lm=function(e){const{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:s,store:a,disabled:c,format:d,schema:p,isInPeekRenderer:g,query:m,paddingBottom:S,tableStore:h,timelineState:f,isRootChild:y,canEdit:v,paddingLeft:x,paddingRight:b,headerWidth:C}=e,w=(0,H().X)("db_ux_empty_states"),k=(0,u().K8)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),R=(0,n.useMemo)((()=>o?[o]:[]),[o]),A=(0,u().K8)((()=>i.groupsStore.getGroupState(R)),[i,R]),I=(0,u().K8)((()=>null==A?void 0:A.reducerResultStore.state),[A]),T=(0,u().K8)((()=>(0,V().XQ)({collectionContextStore:i,reducerResult:I,isFullScreen:r})),[i,I,r]),j=(0,u().O$)(i.shouldShowSpinnerStore),_=(0,u().O$)(i.permissionScopesStore),B=(0,u().O$)(t),P=(0,u().O$)(i.isInHomeWidgetStore),M=(0,u().K8)((()=>"collectionTypedView"===i.contextType),[i]),F=s&&0===(null==I?void 0:I.blockIds.length)&&!j,L=(0,u().K8)((()=>{const e=Boolean(!P&&s&&(v||M)&&!_.isSyncedCollection);return w?e&&!F:e}),[P,s,v,M,_.isSyncedCollection,w,F]);return A?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(cm,{store:a,format:d,schema:p,query:m,collectionContextStore:i,disabled:c,paddingBottom:S,isInPeekRenderer:g,blockPropertyValueOverlayStore:l,tableStore:h,showTablePropertyFormats:B,timelineState:f,isFullScreen:r,isRootChild:y,groupFormat:o,isInHomeWidget:P,paddingLeft:x,paddingRight:b}),(0,G.jsx)(ym,{store:a,schema:p,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:v,format:d,tableStore:h,paddingLeft:x,paddingRight:b,headerWidth:C,disabled:c,groupFormat:o,titleColumnIndex:k,groupsPointer:R,shouldShowShimmer:j}),j&&(0,G.jsx)(im,{}),T&&(0,G.jsx)(mm,{collectionContextStore:i,format:d,canEdit:v,groupFormat:o,isFullScreen:r,groupsPointer:R}),L&&(0,G.jsx)(gm,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:g}),(0,G.jsx)(Od,{groupFormat:o,pageCount:(null==I?void 0:I.blockIds.length)??0,style:am(s,o,r,x),disabled:c||!_.canConfigureBlock,schema:p,query:m,collectionContextStore:i,isInPeekRenderer:g,isFullScreen:r,showPropertyFormats:B,showRightActionsSpacer:!1,paddingLeft:x,paddingRight:b,disableSticky:!0})]}):null};function sm(){}function am(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function cm(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:s,paddingBottom:a,isInPeekRenderer:c,blockPropertyValueOverlayStore:d,tableStore:p,showTablePropertyFormats:g,timelineState:m,isFullScreen:S,isRootChild:h,isInHomeWidget:f,paddingLeft:y,paddingRight:v}=e;const x=(0,u().K8)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,u().O$)(l.permissionScopesStore),C=(0,u().K8)((()=>l.viewIsFlushToTopbar()),[l]);if(!x)return null;const w=Boolean(t);return(0,G.jsx)(Ku,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:c,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:d,showPropertyFormats:g,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:s||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Ao().Zk)(w),paddingTop:w?0:Ao().jI-Ao().MR,disableTopBorder:!C||w,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:f,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:v,children:!w&&b.canConfigureBlock&&(0,G.jsx)(rm,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:m,isFullScreen:S,isRootChild:h})})}function dm(e,t,o){return{display:"flex",alignItems:"center",height:(0,P().sG)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Fo().K_.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function um(e){return{width:Po().Ev.sm,height:Po().Ev.sm,marginRight:6,fill:e.icon.tertiary}}function pm(e,t,o,n,r,i){const{device:l}=e,s=n?[n]:[],a=t.groupsStore.getGroupState(s);if(!(0,nt().EF)(e)||!a)return;t.searchQueryStore.state&&(0,sr().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;T().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const s=(0,En().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(s){if(l.isMobile){!function(e,t,o){o?o(e):rl().oo({environment:t,url:e})}((0,sl().Ay)({store:s.newStore,fullyQualified:!1,pageVisitSource:Vo().y8.Create}),e,i)}else if(s.coercionSucceeded){const o=()=>{_i().ho({environment:e,blockPropertyValueOverlayStore:r,store:s.newStore,property:"title",format:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(s.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);$o().VU({environment:e,store:s.newStore,peekMode:(0,V().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Vo().y8.Create})}On().v(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,Me().sl)(t)})}}})}function gm(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const s=(0,a().v3)(),c=(0,p().DP)(),d=(0,n.useContext)(ll().n),u=(0,n.useCallback)((()=>pm(s,t,o,r,i,d)),[s,t,o,r,i,d]);return(0,G.jsxs)(Pt().A,{onClick:u,style:dm(l,c,s.device.isMobile),className:Be().$0P,onMouseDown:Oe().tr,children:[(0,qo().plusSmallIcon)(um(c)),(0,G.jsx)("span",{style:{color:c.text.tertiary},children:(0,G.jsx)(vt().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function mm(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const s=(0,p().DP)(),c=(0,a().v3)(),d=(0,u().K8)((()=>o.groupsStore.getGroupState(t)),[o,t]),g=(0,u().K8)((()=>(0,Sn().Kk)({collectionContextStore:o,groupsPointer:t})),[o,t]);return d?(0,G.jsxs)(Pt().A,{onMouseDown:Oe().tr,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Oe().kV)(e),A().IU({environment:r}),l&&(0,Wi().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,Ad().K)(r)}(e,o,i,l,c),disabled:g,hoveredStyle:g?{background:s.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:ol().LA,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:Fo().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${s.tableDividerColor}`,borderBottom:`1px solid ${s.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,gn().g)(um(s)),(0,G.jsx)("span",{style:{color:s.text.tertiary,flexGrow:1},children:(0,G.jsx)(vt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),g?(0,G.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,G.jsx)(hn().A,{size:"sm"})}):r&&(0,G.jsx)(Id().w,{collectionContextStore:o,format:n})]}):null}function Sm(e){const t=(0,a().v3)(),{isMobile:o}=(0,a().Y0)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:s,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,G.jsx)(ad,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:s,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{_i().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,P().sG)({isMobile:o})+1}}):null}const hm=[];function fm(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:s,format:c,groupFormat:d,titleColumnIndex:g,paddingLeft:m,paddingRight:S,headerWidth:h,shouldShowShimmer:f}=e;(0,p().DP)();const y=(0,a().Y0)(),v=(0,u().K8)((()=>r.collectionViewStore()),[r]),{groupsPointer:x}=t,b=(0,u().K8)((()=>r.groupsStore.getGroupState(x)),[r,x]),C=(0,u().O$)(l),w=(0,u().K8)((()=>!s&&y.isMobile&&!(null!=v&&v.isSyncedCollection())),[s,y,v]),k=(0,u().O$)(r.isInHomeWidgetStore),R=(0,u().K8)((()=>{const e=r.collectionViewBlockStore();return!(!e||r.isFullScreenStore.state)&&(0,Td().d1)(e)}),[r]),A=(0,u().K8)((()=>(0,ue().v2)(d,r)),[d,r]),I=(0,u().K8)((()=>r.isUnlistedViewStore.state&&r.isInlineViewStore.state),[r]),T=(0,u().K8)((()=>{const e=Pd().A.state;if(e.isActive)return(0,P().yR)(e.selection,C.length,A.length)}),[A,C]),j=hm,_=C,B=(0,u().K8)((()=>{const e=r.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[r.permissionScopesStore]);if(!v||!b)return null;return(0,G.jsx)(_l,{collectionContextStore:r,groupsPointer:x,disableRequest:!0,format:c,canDrag:w,shouldShowShimmer:f,resultProps:{schema:o,collectionContextStore:r,propertyFormats:C,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:sm,titleColumnIndex:g,groupFormat:d,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:k,isCollectionViewBlockSelected:R,allRows:A,isInEphemeralView:I,normalizedTableSelection:T,unfrozenIndexAddendum:0,frozenPropertyFormats:j,unfrozenPropertyFormats:_,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:B,shouldShowRightActionSpacer:!1,hasColumnVirtualizer:!1},resultComponent:Zu,canDrop:!1,disabled:n,direction:Tl.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:g,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:s}=e;return(0,G.jsx)(Sm,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:s,groupsPointer:x})},paddingLeft:m,paddingRight:S,headerWidth:h,timelineType:"table"})}function ym(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,collectionContextStore:l,blockPropertyValueOverlayStore:s,showTablePropertyFormatsStore:a,canEdit:c,format:d,tableStore:p,paddingLeft:g,paddingRight:m,headerWidth:S,disabled:h,titleColumnIndex:f,shouldShowShimmer:y}=e;const v=(0,u().K8)((()=>l.collectionViewStore()),[l]),x=(0,u().K8)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,u().O$)(a),C=(0,n.useCallback)((e=>(0,G.jsx)(fm,{schema:i,disabled:h,collectionContextStore:l,blockPropertyValueOverlayStore:s,showTablePropertyFormatsStore:a,canEdit:c,format:d,groupFormat:t,titleColumnIndex:f,paddingLeft:g,paddingRight:m,headerWidth:S,shouldShowShimmer:y,args:{...e,groupsPointer:o}})),[i,h,l,s,a,c,d,t,f,g,m,S,y,o]);return v&&x?(0,G.jsx)(ap,{store:r,collectionContextStore:l,minWidth:void 0,blockPropertyValueOverlayStore:s,showPropertyFormats:b,disabled:!c,disableHorizontalEdgeScroll:!0,groupFormat:t,render:C,tableStore:p,paddingLeft:g}):null}const vm=n.memo((function(e){let{store:t,tableStore:o,collectionContextStore:r,timelineState:i,format:l,schema:s,query:a,isFullScreen:c,groupBy:d,paddingLeft:g,paddingRight:m,headerWidth:S,paddingBottom:h,scrollerLeftOffset:f,isInPeekRenderer:y,isInHomeWidget:v,computedOuterHeight:x,blockPropertyValueOverlayStore:b,isRootChild:C,isReady:w,disabled:k,canEditCollectionTimeline:R,viewIsFlushToTopbar:A,groupsReducerResultStore:I,hiddenGroupsVisibleStore:T,onGroupHeaderAddItem:j}=e;const _=(0,H().X)("db_ux_chrome"),B=(0,n.useRef)(null),M=(0,u().r6)((()=>{const e=(0,P().Ty)(l,o);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[l,o],{useDeepEqual:!0});(0,u().O$)(M);const F=(0,u().K8)((()=>M.state.reduce(((e,t)=>e+(t.width||0)),0)),[M]),V=(0,p().IS)((e=>({selectable:{whiteSpace:"nowrap",...v?{}:{background:y?e.cardContentBackground:e.contentBackground},paddingLeft:g,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:F+g,height:v?"100%":x},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:_?void 0:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[v,y,g,F,x,_]),L=(0,u().K8)((()=>(0,P().Ty)(l,o)),[l,o]),O=(0,n.useCallback)((e=>(0,G.jsx)(lm,{store:t,groupFormat:e,schema:s,query:a,isInPeekRenderer:y,timelineState:i,collectionContextStore:r,blockPropertyValueOverlayStore:b,showTablePropertyFormatsStore:M,tableStore:o,paddingLeft:g,paddingRight:m,headerWidth:S,paddingBottom:h,format:L,isFullScreen:c,isRootChild:C,isReady:w,canEdit:R,disabled:k&&R})),[b,R,r,k,L,c,y,w,C,h,g,m,a,s,M,t,o,i,S]),E=(0,n.useCallback)((e=>{const t=r.permissionScopesStore.state;return(0,G.jsx)(ei,{...e,height:Ao().tp,paddingTop:Ao().lH,stickyStyle:V.tableGroupHeaderSticky,transitionStickyStyle:V.tableGroupHeaderTransition,style:0!==e.index||A?V.tableGroupHeader:{},stickyWrapStyle:{marginBottom:Ao().lH},children:0===e.index&&t.canConfigureBlock&&(0,G.jsx)(rm,{isGrouped:!0,format:l,collectionContextStore:r,timelineState:i,isFullScreen:c,isRootChild:C})})}),[r,l,c,C,V.tableGroupHeader,V.tableGroupHeaderSticky,V.tableGroupHeaderTransition,i,A]),D=(0,n.useCallback)((()=>({})),[]),z=(0,n.useCallback)((()=>(0,G.jsx)(Ds,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:k,isFullScreen:c,isRootChild:C,paddingLeft:g,paddingRight:m,headerWidth:S,stickyLeft:!1,renderGroup:O,getGroupStyle:D,renderHeader:E,onGroupHeaderAddItem:j,timelineProps:{type:"table",hiddenGroupsVisibleStore:T},groupsResultStore:I})),[r,k,D,I,T,c,C,j,g,m,E,O,t,S]);return(0,G.jsx)("div",{style:{position:"sticky",left:0,height:0,width:F,zIndex:3},children:(0,G.jsx)(gt().Ay,{style:V.selectable,store:t,shouldShowHalo:!1,canSelect:!c,analyticsName:"timeline",children:(0,G.jsx)(di().q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:f,children:d?z():(0,G.jsx)(pi,{nodeRef:B,children:(0,G.jsx)("div",{ref:B,children:O(void 0)})})})})})})),xm=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:s,format:g,paddingLeft:m,paddingRight:S,isFullScreen:h,isPreviewing:f,isRootChild:y,disabled:v,isInPeekRenderer:x,paddingBottom:b,showHoverActionsStore:C,blockPropertyValueOverlayStore:w,headerWidth:k}=e;const R=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,Ao().o8)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:h,isRootChild:y}),A=(0,a().v3)(),I=ke().A.isMobile;(0,c().l)((()=>{const e=i.collectionViewStore();e&&fp().n_({timelineState:R,environment:A,collectionViewStore:e,collectionContextStore:i}),(0,yp().iH)(A,(0,yp().ZR)({environment:A,collectionContextStore:i,timelineState:R,isFullScreen:h,isRootChild:y}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,vt().YK)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});T().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let s,a=V().HG(r);if(!a&&e.canConfigureCollection){a=(0,Oo().Ay)();s={[a]:{name:Tt().A.formatMessage(l.date),type:"date"}}}a&&((0,fr().f)({collectionViewStore:n,update:{timeline_by:a},transaction:t}),Go().zv({store:n,data:{type:"timeline"},transaction:t}),s&&(0,Uo().F)({environment:i,collectionStore:o,update:s,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:s,environment:A}),function(e){(0,n.useEffect)((()=>{const t=()=>{Ye().A.state&&e.hoveredItemStore.setState(void 0)};return Ye().A.addListener(t),()=>{Ye().A.removeListener(t)}}),[e])}(R),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawStateStore.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,Ao().tH)(o)&&T().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{fp().sd({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:A,collectionContextStore:i,timelineState:R,isFullScreen:h,isRootChild:y}),(0,d().X)((()=>{R.destroyed=!0,R.outerSizeObserver.destroy(),R.timelineSizeObserver.destroy(),R.horizontalScroller&&(R.horizontalScroller.scrollLeft=0,(0,Oe().Ol)(R.horizontalScroller,"scroll",D))}));const j=(0,u().uB)(void 0,bd),_=(0,u().uB)(void 0,vp),B=(0,u().uB)(void 0,Va),P=(0,u().O$)(i.isInHomeWidgetStore),M=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=R;if(!e)return;const o=R.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=R.currentRangeStore.state,i=e.scrollLeft,l=t.rect.state.width,s=(0,Ao().w0)(o,r-n),a=(0,Ao().o$)(R);if(i<Ao().XK){const e=-(0,Ao().C1)(o,Ao().E6);R.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),fp().k3({timelineState:R,environment:A,zoomLevel:o,centerTimestamp:a})}else if(i+l>s-Ao().XK){const e=(0,Ao().C1)(o,Ao().E6);R.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),fp().k3({timelineState:R,environment:A,zoomLevel:o,centerTimestamp:a})}}),[R,A]),F=(0,vn().U)(M,200),L=(0,u().K8)((()=>Boolean(i.remoteErrorStore.state&&!i.remoteResultStore.state)),[i]),O=(0,n.useRef)(!1),E=(0,H().X)("collections_remote_error_view"),D=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=R;if(!e)return;const o=e.scrollLeft,n=R.scrollLeftStore.state;A.device.isIOS&&void 0!==n&&0===o&&n>Ao().XK?e.scrollLeft=n:(t&&t(),R.scrollLeftStore.setState(o),(0,Ao().nS)(A)?F():M())}),[R,A,F,M]),z=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=R.currentRangeStore.state;fp().bu({timelineState:R,centerTimestamp:(e+t)/2})}),[R]),W=(0,n.useRef)(null),N=(0,n.useCallback)((e=>{if(e){W.current=e;const{outerSizeObserver:t}=R;t.observe(e);const o=(0,K().T8)(e);o&&(R.horizontalScroller=o,(0,Oe().P4)(o,"scroll",D),O.current=!0,z())}}),[D,z,R]);(0,n.useEffect)((()=>{if(E){if(L&&O.current){if(!R.horizontalScroller)return;(0,Oe().Ol)(R.horizontalScroller,"scroll",D),O.current=!1,R.horizontalScroller.scrollLeft=0}if(!L&&!O.current){if(!W.current)return;const e=R.horizontalScroller;e&&((0,Oe().P4)(e,"scroll",D),O.current=!0,z())}}}),[L,z,O,D,R,E]);const $=(0,u().K8)((()=>i.viewIsFlushToTopbar()),[i]),U=(0,n.useRef)(null),X=(0,u().K8)((()=>{const e=R.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=R.currentRangeStore.state;return(0,Ao().w0)(e,o-t)}),[R]),q=(0,u().K8)((()=>!f&&(0,Ao().Od)({environment:A,isRootChild:y,isFullScreen:h,format:g})?Ao().HV:m),[f,y,h,g,m,A]),Y=(0,u().K8)((()=>(0,Ao().Ho)({environment:A,paddingLeft:q,format:g,isFullScreen:h,isRootChild:y})),[A,g,h,y,q]);(0,uu().b)(o(297727).A,(()=>({getNode:()=>U.current,customizeEdgeScrollRect(e){const t=Y;return mc().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[Y]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return fp().$N({environment:A,store:t,timelineState:R,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const Q=(0,u().K8)((()=>(0,Ao().iw)({environment:A,format:g,isFullScreen:h,isRootChild:y})),[A,g,h,y]),Z=(0,u().K8)((()=>Boolean(i.normalizedFormatStore.state.collection_group_by)),[i.normalizedFormatStore]),J=(0,u().K8)((()=>i.groupsStore.anyGroupHasResults()),[i]),ee=(0,u().K8)((()=>Boolean(i.viewsModuleContextStore.getViewModuleType())),[i]),te=(0,Re().Zp)(),oe=(0,u().K8)((()=>V().mM(i,h)),[i,h]),ne=(0,u().K8)((()=>{const{timelineSizeObserver:e}=R,t=(e.rect.state.height||120)+b+(h?0:72)+(!h&&Q?28:0)+(h&&I?72:0);return i.groupsStore.getAllGroupStates().every((e=>0===e.resultsStore.state.length))?Math.max(t,144+(0,Ao().Zk)(Z)):t}),[R,b,h,Q,I,Z,i.groupsStore]),re=function(e,t){const o=(0,Ke().bx)(e,!1);return(0,u().K8)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),ie=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=R;t.observe(e)}}),[R]),le=(0,n.useCallback)(((e,t,o)=>{if(A.device.isMobile)No().uK({environment:A,store:e,pageVisitSource:Vo().y8.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;$o().VU({environment:A,store:e,peekMode:V().hH(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:Vo().y8.Create})}}),[A,i]),se=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<Xe().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,Wi().H)({collectionContextStore:i,environment:A,incrementLimitArgs:{isFullScreen:h,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,A,h]),ae=(0,p().IS)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:X,...P?{}:{background:x?e.peekTimelineBackground:e.timelineBackground},...!h&&!Q&&!P&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!J||P)&&{minHeight:150},...h&&{paddingBottom:b},height:P?"100%":ne}})),[ne,h,P,x,J,b,X,Q]),{timeline_by:ce}=l;if(!ce)return(0,G.jsx)(Sg,{collectionContextStore:i,isFullScreen:h,paddingBottom:b});const de=s[ce];return de&&Xo().$L(de)?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{ref:N}),!$&&!f&&(0,G.jsx)("div",{style:{height:4}}),(0,Ni().A)((e=>(0,G.jsx)(pi,{nodeRef:U,width:X,clipLeftExtra:Y||(h?0:q),children:(0,G.jsx)("div",{style:ae.container,className:Be().dBr,ref:U,...e,children:(0,G.jsxs)(gt().Ay,{store:r,analyticsName:"timeline",shouldShowHalo:!h&&!P&&!f,canSelect:!h&&!ee,disablePointerEvents:null==te?void 0:te.disableAllPointerEvents,style:P?{height:"100%"}:{},children:[(0,G.jsx)(fg,{timelineState:R}),(0,G.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Ao().jI},ref:ie,children:[(0,G.jsx)(om,{store:r,schema:s,query:l,showTable:Q,collectionContextStore:i,timelineState:R,disabled:v,isFullScreen:h,isRootChild:y,isInPeekRenderer:x,paddingLeft:q,paddingRight:S,groupsReducerResultStore:B,hiddenGroupsVisibleStore:_,format:g,canEditCollectionTimeline:re,isReady:J,blockPropertyValueOverlayStore:w,tableStore:j,scrollerLeftOffset:Y,onGroupHeaderAddItem:le,headerWidth:k}),(0,G.jsx)(Lp,{timelineState:R,disabled:v,isReady:J,renderEmitter:i.renderEmitter,isFullScreen:h,isRootChild:y})]}),(0,G.jsx)(og,{isInPeekRenderer:x,timelineState:R,query:l,schema:s,scrollerLeftOffset:Y,collectionContextStore:i,showTable:Q}),!(null!=te&&te.disableAllPointerEvents)&&(0,G.jsx)(Wp,{timelineState:R,isInPeekRenderer:x,paddingLeft:q,paddingRight:!h&&y?8:S,format:g,scrollerLeftOffset:Y,isFullScreen:h,isRootChild:y,showTable:Q,collectionContextStore:i,isReady:J}),Q&&(0,G.jsx)(vm,{store:r,collectionContextStore:i,groupBy:g.collection_group_by,paddingLeft:q,disabled:v,isFullScreen:h,isRootChild:y,format:g,schema:s,query:l,tableStore:j,scrollerLeftOffset:Y,isInPeekRenderer:x,paddingRight:S,paddingBottom:b,isInHomeWidget:P,computedOuterHeight:ne,timelineState:R,blockPropertyValueOverlayStore:w,viewIsFlushToTopbar:$,isReady:J,canEditCollectionTimeline:re,groupsReducerResultStore:B,hiddenGroupsVisibleStore:_,onGroupHeaderAddItem:le,headerWidth:k}),(0,G.jsx)("div",{style:{paddingTop:Ao().jI,pointerEvents:"none"},children:(0,G.jsx)(Pg,{store:r,collectionContextStore:i,disabled:v,isFullScreen:h,paddingLeft:q,paddingRight:S,headerWidth:k,isRootChild:y,format:g,groupsReducerResultStore:B,hiddenGroupsVisibleStore:_,canEditCollectionTimeline:re,onGroupHeaderAddItem:le,showTable:Q})}),!oe&&(0,G.jsx)(Gi().A,{onChange:se})]})})})))]}):(0,G.jsx)(Sg,{collectionContextStore:i,isFullScreen:h,paddingBottom:b})})));const bm=new(ge().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(6912),o.e(55717),o.e(95541),o.e(37160),o.e(22)]).then(o.bind(o,668114)))),Cm=(0,ge()._h)(bm,(e=>e.CollectionChartView)),wm=new(ge().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(92845),o.e(84468),o.e(95794),o.e(46414),o.e(28271),o.e(17254),o.e(58102),o.e(40186),o.e(61660),o.e(23133)]).then(o.bind(o,766911)))),km=(0,ge()._h)(wm,(e=>e.CollectionFormEditorView));const Rm=n.memo((function(e){let{store:t,collectionViewStore:r,isDisabled:i,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,isRootChild:d,paddingLeft:p,paddingRight:g,paddingBottom:m,headerSizeObserver:S,viewType:h,timelineViewRef:f,showHoverActionsStore:y,isInFrameWhenSidePeekOpen:v,query:x,schema:b,format:C,maxHeight:w,placementStore:k,templatePickerMenuListStore:R,editorContentContainerRef:A}=e;const I=(0,se().ET)(),T=(0,u().O$)(I.shouldShowSpinnerStore),[j,_]=(0,u().K8)((()=>["collectionSystemView"===I.contextType,I.isInHomeWidgetStore.state]),[I]),B=!(0,Ke().bx)(t,j||i),P=(0,u().K8)((()=>ao({store:t,collectionViewStore:r,collectionContextStore:I})),[t,r,I]),M=!(0,Ke().bx)(P,j);(0,n.useEffect)((()=>{"rendered"!==jt().default.state.renderPhase&&jt().default.setState({...jt().default.state,renderPhase:"rendered"})}),[]);const F=function(e){let{isFullScreen:t,viewType:o,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:s,store:c}=e;const d=(0,a().v3)();return(0,u().K8)((()=>{const{device:e}=d,a=e.isPhone,u=("gallery"===o||("calendar"===o||"list"===o)&&t)&&n,p=(0,Ne().zo)(d,i),g=W().default.state;return r||l?void 0:t||s?a?`calc(100% - ${2*(0,_e().F8)(d)}px - ${p}px)`:i?`calc(100% - ${2*W().PeekModePadding.horizontal[g.mode]}px - ${p}px)`:n?(0,Ne().Uh)(d)+(u?(0,Ne().Ql)(d):0):t?`calc(100% - ${2*(0,_e().Ws)(d)}px - ${p}px)`:(0,D().Ck)(c,void 0,e)?`calc(100% - ${2*(0,_e().F8)(d)}px - ${p}px)`:D().x6-2*(0,_e().F8)(d)-p:`calc(100% - ${p}px)`}),[d,o,t,n,i,r,l,s,c])}({isFullScreen:l,viewType:h,isInFrameWhenSidePeekOpen:v,isInHomeWidget:_,isInPeekRenderer:s,isPreviewing:c,isRootChild:d,store:t}),V=s?Fi().A:Mi().A,L=(0,u().K8)((()=>S.rect.state.width),[S.rect]);return"table"===h?(0,G.jsx)(gp,{schema:b,format:C,query:x,store:t,collectionContextStore:I,showHoverActionsStore:y,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:g,minWidth:F,paddingBottom:m,disabled:B,blockPropertyValueOverlayStore:V,isRootChild:d,placementStore:k,headerWidth:L},r.id):"board"===h?(0,G.jsx)(uc,{schema:b,format:C,query:x,store:t,collectionContextStore:I,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:g,paddingBottom:m,disabled:B,blockPropertyValueOverlayStore:V,isRootChild:d,headerWidth:L},r.id):"page"===h?P?(0,G.jsx)(Am,{targetStore:P,collectionViewStore:r,disabled:M,templatePickerMenuListStore:R,isFullScreen:l,editorContentContainerRef:A}):null:"calendar"===h?(0,G.jsx)(rd,{schema:b,format:C,query:x,store:t,collectionContextStore:I,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:g,maxHeight:w,minWidth:F,paddingBottom:m,disabled:B,blockPropertyValueOverlayStore:V,isRootChild:d,headerWidth:L},r.id):"list"===h?(0,G.jsx)(hd,{schema:b,format:C,query:x,store:t,collectionContextStore:I,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:v&&!_?24:g,minWidth:F,paddingBottom:m,disabled:B,blockPropertyValueOverlayStore:V,isRootChild:d,headerWidth:L},r.id):"gallery"===h?(0,G.jsx)(Is,{schema:b,format:C,query:x,store:t,collectionContextStore:I,isFullScreen:l,isInPeekRenderer:s,isPreviewing:c,paddingLeft:p,paddingRight:g,paddingBottom:m,headerWidth:L,minWidth:F,disabled:B,blockPropertyValueOverlayStore:V,isRootChild:d},r.id):"timeline"===h?(0,G.jsx)(xm,{schema:b,format:C,query:x,store:t,collectionContextStore:I,isFullScreen:l,isRootChild:d,isInPeekRenderer:s,isPreviewing:c,minWidth:F,paddingBottom:m,disabled:B,blockPropertyValueOverlayStore:V,showHoverActionsStore:y,ref:f,paddingLeft:p,paddingRight:g,headerWidth:L},r.id):"form_editor"===h?(0,G.jsx)(Im,{collectionViewStore:r,collectionContextStore:I,paddingLeft:p,paddingRight:g},r.id):"chart"===h?(0,G.jsx)(Tm,{collectionViewStore:r,isPreviewing:c,paddingLeft:p,paddingRight:g,headerSizeObserver:S,collectionContextStore:I}):"feed"===h?(0,G.jsx)(o(732430).XQ,{collectionViewStore:r,collectionContextStore:I,blockPropertyValueOverlayStore:V,paddingLeft:p,paddingRight:g,paddingBottom:m,disabled:B}):"map"===h?(0,G.jsx)(o(229793).wC,{collectionContextStore:I,paddingLeft:p,paddingRight:g,query:x,format:C,schema:b,store:t,renderGroupResults:e=>(0,G.jsx)(_l,{disabled:!1,canDrag:!1,canDrop:!1,direction:Tl.Vertical,collectionContextStore:I,format:C,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",paddingLeft:p,paddingRight:g,headerWidth:L,shouldShowShimmer:T,...e})}):null}));function Am(e){let{targetStore:t,collectionViewStore:o,disabled:n,templatePickerMenuListStore:r,isFullScreen:i,editorContentContainerRef:l}=e;const s=(0,se().ET)(),{collectionStore:a}=(0,u().K8)((()=>({collectionStore:s.collectionStore()})),[s]);return(0,G.jsx)(Co,{canEdit:!n,disabled:n,store:t,collectionViewStore:o,templatePickerMenuListStore:r,collectionStore:a,isFullScreen:i,editorContentContainerRef:l})}const Im=n.memo((function(e){let{collectionViewStore:t,collectionContextStore:n,paddingLeft:r,paddingRight:i}=e;const l=(0,a().Y0)(),s=(0,p().IS)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-Us().l1,marginBottom:120-Us().l1,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:Fo().Wy.regular},disabledBuilderIcon:{fill:e.icon.tertiary,height:72,margin:"0 auto"},offlineErrorWrapper:{padding:0,marginLeft:r,marginRight:i,height:ko().iZ},offlineErrorIcon:{width:25,height:25,fill:e.text.secondary},offlineErrorTitle:{fontSize:14,color:e.text.secondary,fontWeight:void 0}})),[r,i]),c=!(0,u().O$)(qe().e);return l.isMobile?(0,G.jsx)(Us().Ay,{style:s.disabledBuilderWrapper,title:(0,G.jsx)("span",{style:s.disabledBuilderTitle,children:(0,G.jsx)(vt().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:Mo(s.disabledBuilderIcon)}):c?(0,G.jsx)(Us().Ay,{style:s.offlineErrorWrapper,title:(0,G.jsx)(vt().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Go online to edit this form"}),titleStyle:s.offlineErrorTitle,icon:(0,o(553034).C)(s.offlineErrorIcon)}):(0,G.jsx)(km,{collectionContextStore:n,paddingLeft:r,paddingRight:i},t.id)}));function Tm(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const s=(0,u().K8)((()=>i.rect.state.width),[i]);return(0,G.jsx)(Cm,{collectionContextStore:l,isPreviewing:o,headingWidth:s,paddingLeft:n,paddingRight:r},t.id)}const jm=n.memo(Rm);var _m=()=>o(132855),Bm=()=>o(611520),Pm=()=>o(572088),Mm=()=>o(817126),Fm=()=>o(53137),Vm=()=>o(991249),Lm=()=>o(412236),Om=()=>o(864943);const Em=(0,vt().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function Dm(e){let{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i}=e;const l=(0,se().ET)(),s=(0,u().K8)((()=>{const e=l.collectionStore();return null==e?void 0:e.getFormat().integration_id}),[l]),a=(0,o(462853).l)(s);return s?a?(0,G.jsx)(zm,{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i,integrationId:s,featureName:a}):(0,G.jsx)(Km,{isFullScreen:t,paddingLeft:n,paddingRight:r,paddingBottom:i,integrationId:s}):null}function zm(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}=e;const s=(0,a().v3)(),c=(0,vt().tz)(),d=(0,se().ET)(),[g,m]=(0,u().K8)((()=>[d.settingsStore,d.collectionStore()]),[d]),S=(0,u().K8)((()=>g.state.open),[g]),h=(0,u().K8)((()=>{if(m)return m.getIcon()}),[m]),f=(0,u().K8)((()=>Fm().A.integrations.state.find((e=>e.id===i))),[i]),y=(0,p().IS)((e=>({integrationTitle:{fontSize:17,fontWeight:Fo().Wy.medium,textAlign:"center"},upgradeDescription:{fontSize:17,fontWeight:Fo().Wy.medium,textAlign:"center",color:e.text.tertiary,marginTop:12},upgradeIcon:{width:18,height:18,margin:2,color:e.text.uiBluePrimary}})),[]),v=(0,Mm().uF)({featureName:l});if(!i||!f||null==v||!v.upsell)return(0,G.jsx)(Km,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i});const{isAvailable:x,upsell:b,upsellTier:C}=v;return"none"!==b.type&&C?x&&b?(0,G.jsx)(Km,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}):(0,G.jsx)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,G.jsxs)("div",{style:{paddingRight:S?ko().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,G.jsx)(ls().B6,{icon:h,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,G.jsx)("div",{style:y.integrationTitle,children:(0,G.jsx)(vt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.externalCollectionUpsell.title",values:{integrationName:f.name}})}),(0,G.jsx)("div",{style:y.upgradeDescription,children:(0,G.jsx)(vt().sA,{defaultMessage:"Upgrade to {subscriptionTier} to use this feature. {learnMoreLink}",id:"collectionViewBlock.externalCollectionUpsell.description",values:{subscriptionTier:c.formatMessage(Em[C]),learnMoreLink:(0,G.jsx)(Lm().V,{})}})}),(0,G.jsx)(Om().A,{size:"md",iconLeading:_m().arrowInCircleUpFillIcon,iconStyle:y.upgradeIcon,style:{marginTop:12},onClick:()=>{Vm().K(s,{from:"collection_synced_database",upsell:b})},children:(0,G.jsx)(vt().sA,{defaultMessage:"Upgrade",id:"collectionViewBlock.externalCollectionUpsell.upgradeButton.label"})})]})}):(0,G.jsx)(Km,{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i})}function Km(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r,integrationId:i,featureName:l}=e;const s=(0,p().DP)(),c=(0,se().ET)(),[d,g,m]=(0,u().K8)((()=>[c.permissionScopesStore.state,c.settingsStore,c.collectionStore()]),[c]),S=(0,u().K8)((()=>g.state.open),[g]),h=(0,u().K8)((()=>{if(m)return m.getIcon()}),[m]),{isMobileBrowser:f}=(0,a().Y0)(),y=(0,u().K8)((()=>{if(!m)return!1;const e=m.getFormat().integration_id,t=Fm().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,Pm().jw)(e).length>0}),[m]),v=(0,u().K8)((()=>Fm().A.integrations.state.find((e=>e.id===i))),[i]);if(!v)return null;const x=!(f&&!y);return(0,G.jsxs)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,minHeight:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",gap:32},children:[(0,G.jsxs)("div",{style:{paddingRight:S?ko().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,G.jsx)(ls().B6,{icon:h,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,G.jsx)("div",{style:{fontSize:17,fontWeight:Fo().Wy.medium,color:s.text.tertiary,textAlign:"center",marginBottom:-2},children:(0,G.jsx)(vt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:v.name}})}),d.canConfigureBlock&&(0,G.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:s.text.tertiary},children:x&&(0,G.jsx)(vt().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:v.name,button:e=>(0,G.jsx)(Pt().A,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{C().Ho({collectionSettingsStore:g})},children:e})}})})]}),l?(0,G.jsx)(Bm().G2,{featureName:l,source:"collection_synced_database"}):null]})}const Hm=(0,Po().wt)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,G.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});function Wm(e){let{viewType:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const s=(0,a().v3)(),c=(0,se().ET)(),d=(0,u().O$)(c.permissionScopesStore),g=(0,p().DP)(),m=(0,n.useMemo)((()=>({style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l},icon:Hm({height:48,fill:g.icon.tertiary,margin:"0 auto"})})),[o,l,r,i,g.icon.tertiary]),S=(0,n.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();C().Ow({collectionContextStore:e,collectionSettingsStore:n}),C().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0}}),(0,b().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(c,s)}),[c,s]);return d.canConfigureBlock?(0,G.jsx)(Us().Ay,{title:t?(0,G.jsx)(vt().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:At().to[t].toLocaleLowerCase()}}):(0,G.jsx)(vt().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,G.jsx)(vt().sA,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:S,...m}):(0,G.jsx)(Us().Ay,{title:(0,G.jsx)(vt().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,G.jsx)(vt().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...m})}const Gm={viewBox:"0 0 20 20",fittedViewBox:"3.12 1.12 13.76 16.76",svg:(0,G.jsx)("path",{d:"M8.983 1.32a.875.875 0 0 1 1.228 1.234l-.06.066L8.64 4.125H10l.354.01A6.875 6.875 0 1 1 3.125 11a.875.875 0 1 1 1.75 0 5.125 5.125 0 1 0 5.389-5.118L10 5.875H8.639l1.5 1.508.06.067a.875.875 0 0 1-1.3 1.167L5.905 5.61l-.057-.064a.876.876 0 0 1 .06-1.174L8.917 1.38z"})},Nm=(0,Po().wt)("arrowCircleSpinCounterClockwiseFill",Gm);function $m(e){let{collectionContextStore:t,viewType:o,maxHeight:n}=e;const r=(0,a().v3)(),i=(0,p().IS)((e=>({container:{position:"absolute",inset:0,backgroundColor:e.surface.page,zIndex:2,display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:n?void 0:25}})),[n]),l=(0,H().X)("collections_remote_error_view"),s=(0,u().O$)(t.remoteErrorStore),c=(0,u().K8)((()=>{const e=t.remoteResultStore.state;if(!e)return!0;return Object.values(e.reducerResults).every((e=>"results"===e.type&&0===e.blockIds.length||"groups"===e.type&&"v2"===e.version&&0===(e.blockResults??[]).length))}),[t]);return l&&s&&"chart"!==o&&c?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:i.container,children:(0,G.jsx)(Us().Ay,{title:(0,G.jsx)(vt().sA,{id:"collectionRemoteError.title",defaultMessage:"Something went wrong"}),buttonText:(0,G.jsx)(vt().sA,{id:"collectionRemoteError.tryAgain",defaultMessage:"Try again"}),buttonIcon:Nm,buttonOnClick:()=>{(0,M().M)(r,t,{src:"manual_retry"})}})}),(0,G.jsx)("div",{style:{height:n??"200px"}})]}):null}var Um=()=>o(646447);const Xm=n.memo((function(e){let{collectionContextStore:t,store:o,collectionStore:n,collectionViewStore:r,showHoverActionsStore:i,viewSettingsPlacementStore:l,templatePickerMenuListStore:s,leftRightPaddingStore:c,leftRightMarginStore:d,headerHeightStore:g,currentViewType:m,query:S,schema:h,format:y,maxHeight:v,fullWidth:x,scrollerLeftPadding:b,contentEditableVoidLeft:C,additionalCollectionViewInnerHorizontalPadding:w,rootRef:k,timelineViewRef:R,editorContentContainerRef:A,headerSizeObserver:I,isDisabled:T,isFullScreen:j,isInPeek:_,isPreviewing:B,isRootOrDirectChild:P,isPlaceholderExternalCollection:M,isMyTasksEmpty:F,isInFrameWhenSidePeekOpen:V,showHomeCustomDbEmptyState:L,showMyTasksEmptyState:O,isInHomeWidget:E,isHomeCustomDbEmpty:D,isUnlistedView:z,isViewModule:K,handleAddItemClick:H,handleEditorClick:W,handleHorizontalScrollerMount:N,handleEditorMouseDown:$,handleContentMount:U}=e;const{isMobile:X}=(0,a().Y0)(),q=(0,a().WS)(),Y=j?(0,f().Px)(U,k):U,{paddingLeft:Q,paddingRight:Z}=(0,u().K8)((()=>{var e,t;const o=w??0;return{paddingLeft:((null===(e=c.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=c.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[c,w]),J=(0,u().K8)((()=>"collectionSettings"===t.contextType?0:j?"timeline"===m?96:X?90:180:"timeline"===m||"gallery"===m?0:z?16:Yt().A.state),[t,j,m,z,X]),ee=(0,u().K8)((()=>!("chat"===m||"custom"===m)&&t.hasSingleCollection()),[m,t]),[te,oe,ne]=(0,u().K8)((()=>[null==n?void 0:n.isReady(),null==n?void 0:n.isDefined(),null==n?void 0:n.canRead()]),[n]),re=(0,p().DP)(),ie=(0,u().K8)((()=>{const e={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...d.state,...!j&&!B&&{...b&&{marginLeft:-b},maxHeight:v?v-g.state:"inherit",...E&&t.isEditableHomeCollectionStore.state?(0,Ge().V$)({isPhone:q,theme:re}):{},width:x,left:C}};return{shimmer:{backgroundColor:re.largeShimmerColor,height:48,marginBottom:10,width:"100%"},content:e,pageViewContent:{...e,position:void 0,marginLeft:void 0,maxWidth:"100%"},contentInner:j||B?{..."custom"===m&&{height:"100%"}}:{position:"relative",...E?{height:"100%",maxHeight:"inherit"}:{},..."custom"===m&&{height:"100%"}}}}),[d,x,m,j,B,b,v,g,E,t.isEditableHomeCollectionStore,q,re,C]);return(0,G.jsx)(lo().A,{name:"CollectionViewBlockContent",children:(()=>{if(ee){if(!n)return(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(Wm,{viewType:m,isFullScreen:j,paddingLeft:Q,paddingRight:Z,paddingBottom:J})});if(!te)return(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)("div",{style:ie.shimmer,children:(0,G.jsx)(so().A,{emphasized:!1,style:ie.shimmer})})});if(!oe)return ne?(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(Wm,{viewType:m,isFullScreen:j,paddingLeft:Q,paddingRight:Z,paddingBottom:J})}):(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(Um().P2,{collectionStore:n,paddingLeft:Q,paddingRight:Z})})}if(M)return(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(Dm,{isFullScreen:j,paddingLeft:Q,paddingRight:Z,paddingBottom:J})});if(F&&"calendar"!==m)return(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(io,{collectionContextStore:t,onAddTaskClick:H,from:E?"home_tile_tasks":"home_tasks"})});if(L)return(0,G.jsx)(ut().s,{ref:Y,allowSelectionWithin:!1,style:ie.content,children:(0,G.jsx)(We().Y8,{collectionContextStore:t,onAddItemClick:H,from:E?"home_tile_custom_db":"home_custom_db"})});const e=(0,G.jsx)(jm,{store:o,collectionViewStore:r,viewType:m,isDisabled:T,isFullScreen:Boolean(j),isInPeekRenderer:_,isPreviewing:B,isRootChild:P,paddingLeft:Q,paddingRight:Z,paddingBottom:J,headerSizeObserver:I,timelineViewRef:R,showHoverActionsStore:i,isInFrameWhenSidePeekOpen:V,query:S,schema:h,format:y,maxHeight:v,placementStore:l,templatePickerMenuListStore:s,editorContentContainerRef:A}),a=O?e:(0,G.jsx)(Bo,{store:o,paddingLeft:b,isPreviewing:B,isFullScreen:Boolean(j),currentViewType:m,isInPeek:_,isInHomeWidget:E,isUnlistedView:z,viewSettingsPlacementStore:l,format:y,isMyTasksEmpty:F,isHomeCustomDbEmpty:D,isInFrameWhenSidePeekOpen:V,handleEditorMouseDown:$,isRootOrDirectChild:P,leftRightPaddingStore:c,paddingBottom:J,handleHorizontalScrollerMount:N,handleEditorClick:W,children:e});if("page"===m)return(0,G.jsx)(wo,{store:o,collectionViewStore:r,isFullScreen:Boolean(j),editorContentContainerRef:A,templatePickerMenuListStore:s,isViewsModule:K,style:ie.pageViewContent});const d=(0,G.jsx)("div",{style:ie.contentInner,children:a});return(0,G.jsxs)(ut().s,{ref:Y,allowSelectionWithin:!0,style:ie.content,children:[(0,G.jsx)($m,{collectionContextStore:t,viewType:m,maxHeight:v}),d]})})()})}));o(16280);var qm=()=>o(700250);function Ym(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:r,settingsHeaderSizeObserver:i,placementStore:l,placementToOrigin:s=qm().UV.Bottom,alignmentToOrigin:c=qm().MY.Start,marginTop:d=-1,originGap:p,headerRef:g,handleAddItemClick:m}=e,S=(0,a().v3)(),h=(0,u().O$)(l),[f,y]=(0,n.useState)(!1),[v,x]=(0,n.useState)(!0),b=(0,u().O$)(t.isInPeekRendererStore),C=(0,u().O$)(t.isFullScreenStore),[w,k]=(0,n.useState)(!1),R=(0,u().K8)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),A=(0,u().K8)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),I=(0,u().K8)((()=>{const e=o.rect.state;return 0!==e.width?(0,Fe().wW)(t,S.device.isMobile,e.width):"popup"}),[t,S.device.isMobile,o.rect]);(0,n.useEffect)((()=>{R&&(o.recompute(),i.recompute(),l.setState(I)),R&&!C&&"form_editor"!==A&&(y(!0),x(!1))}),[R,C,l,o,i,A,I]);const T=(0,u().K8)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:i.rect.state.right-2,y:i.rect.state.y-2,width:0,height:i.rect.state.height})),[t,i.rect]);return(0,n.useEffect)((()=>{if(f){const e=null==g?void 0:g.current;if(e){const t=e.getBoundingClientRect();S.WindowSizeStore.state.height-t.top<ko().iZ&&((0,K().vq)(e,{edgeDist:0,animate:!1}),o.recompute(),i.recompute())}y(!1),x(!0)}}),[t,S.WindowSizeStore,o,i,b,f,g]),(0,n.useEffect)((()=>{k(!(!R||!v))}),[R,v]),"sidebar"===h?(0,G.jsx)(Qm,{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:r,paddingRight:e.paddingRight,shouldScrollIntoView:f,headerHeightStore:e.headerHeightStore,settingsOpen:w,isInPeekRenderer:b}):(0,G.jsx)(Zm,{collectionContextStore:t,placementToOrigin:s,alignmentToOrigin:c,originGap:p??0,marginTop:d,settingsOpen:w,shouldScrollIntoView:f,originRect:T,handleAddItemClick:m})}function Qm(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:r,shouldScrollIntoView:i,settingsOpen:s}=e,c=(0,H().X)("db_ux_chrome"),d=(0,a().v3)(),g=(0,u().K8)((()=>{const e=o.rect.state;return d.WindowSizeStore.state.height-(e.top+Ve().Lq)}),[d.WindowSizeStore,o.rect]),m=(0,u().K8)((()=>n.rect.state.height),[n.rect]),S=(0,u().O$)(t.isInPeekRendererStore),h=(0,u().O$)(e.headerHeightStore),f=(0,u().K8)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),y=(0,p().IS)((e=>({topLevelDiv:{position:"absolute",top:h,right:-r,background:S?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,borderImage:c?`linear-gradient(180deg, ${e.contentBackground} 0px, ${e.tableDividerColor} 12px) 1 100%`:void 0,paddingRight:r,zIndex:88,...f?{height:m,minHeight:g}:{height:g}},nestedDiv:{...c?{}:{boxShadow:`inset 0 1px 0 ${e.tableDividerColor}`}}})),[h,r,S,f,m,g,c]);return s?(0,G.jsx)(pt().A,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,G.jsx)(Bt().A,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:y.topLevelDiv,className:Be().N11,...(0,rn().A)({onMouseDown:e=>function(e,t){(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{I().clear({environment:t})}})}(e,d)},e),children:(0,G.jsxs)("div",{style:{display:"flex",...f?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,G.jsx)("div",{style:y.nestedDiv,children:(0,G.jsx)(Jm,{collectionContextStore:t,shouldScrollIntoView:i,isSidebar:!0})}),(0,G.jsx)("div",{style:{width:r}})]})})}):null}function Zm(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:r,originGap:i,marginTop:l,settingsOpen:s,shouldScrollIntoView:c,originRect:d,origin:p=(0,G.jsx)("div",{}),handleAddItemClick:g}=e,m=(0,a().v3)(),S=(0,n.useCallback)((e=>(0,G.jsx)(Jm,{collectionContextStore:t,shouldScrollIntoView:c,isSidebar:e,handleAddItemClick:g})),[t,c,g]),h=function(e){let{collectionContextStore:t}=e;const o=(0,a().v3)(),n=(0,a().WS)(),r=(0,u().K8)((()=>o.WindowSizeStore.isLandscape()),[o.WindowSizeStore]);return(0,u().K8)((()=>"chart"===(null==t?void 0:t.getViewType())&&n&&!r),[t,n,r])}({collectionContextStore:t});return(0,G.jsx)(Ea().Ay,{popupType:m.device.isMobile?Ea().nl.BottomSheet:Ea().nl.Popup,bottomSheetInitialState:h?"half":"full",className:`${Be().N11} ${Be().xeF}`,open:s,placementToOrigin:o,alignmentToOrigin:r,style:{marginTop:l},origin:p,originGap:i,render:S,onDismiss:t=>{var o;null===(o=e.onDismiss)||void 0===o||o.call(e),function(e,t){C().os({collectionSettingsStore:t.settingsStore})}(0,e.collectionContextStore)},originRect:d,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}function Jm(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:n,handleAddItemClick:r}=e;const i=(0,H().X)("db_ux_mobile_filter_sheet"),l=(0,u().K8)((()=>ke().A.isMobile&&i?Fe().Bd.MobileSheet:Fe().Bd.ViewSettings),[i]);return n?null:(0,G.jsx)(qd().m$,{context:l,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t,handleAddItemClick:r})}const eS=n.memo((function(e){let{store:t,leftRightPaddingStore:o,viewSettingsPlacementStore:n,headerHeightStore:r,headerSizeObserver:i,contentSizeObserver:l,settingsHeaderSizeObserver:s,currentViewType:a,isInHomeWidget:c,placementToOrigin:d,alignmentToOrigin:p,headerRef:g,handleAddItemClick:m}=e;const S=(0,se().Ks)(),h=(0,u().K8)((()=>(0,z().RX)(t)?{paddingLeft:0,paddingRight:0}:o.state),[o,t]),f=(0,u().K8)((()=>{var e;return void 0!==(null==S||null===(e=S.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==S?void 0:S.viewsModuleContextStore]),y="form_editor"===a,b=(0,u().K8)((()=>{var e;if(d)return d;if(!y)return;return!(null==S||!S.settingsStore.state.open)&&(0,x().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,v().$1)(null==S?void 0:S.settingsStore.state.stack))||void 0===e?void 0:e.type)?qm().UV.Right:qm().UV.Bottom}),[d,y,null==S?void 0:S.settingsStore]),C=p??(c?qm().MY.End:void 0),w=y?b===qm().UV.Right?24:12:void 0,k=(0,u().K8)((()=>(null==S?void 0:S.isInlineViewStore.state)&&(null==S?void 0:S.isUnlistedViewStore.state)),[null==S?void 0:S.isInlineViewStore,null==S?void 0:S.isUnlistedViewStore]);return f?null:h&&S?(0,G.jsx)(Ym,{collectionContextStore:S,headerSizeObserver:i,contentSizeObserver:l,settingsHeaderSizeObserver:s,headerHeightStore:r,placementStore:n,marginTop:k?-10:void 0,placementToOrigin:b,alignmentToOrigin:C,originGap:w,headerRef:g,...h,handleAddItemClick:m}):null}));var tS=()=>o(430923),oS=()=>o(42425);const nS=(0,vt().YK)({defaultAddViewAriaLabel:{id:"collectionViewTabBar.addView",defaultMessage:"Add view, chart, or form"},defaultAddViewTooltip:{id:"collectionViewTabBar.addViewTooltip",defaultMessage:"Add a new view, chart, or form"},linkedAddViewAriaLabel:{id:"collectionViewTabBar.linkedAddView",defaultMessage:"Add view or chart"},linkedAddViewTooltip:{id:"collectionViewTabBar.linkedAddViewTooltip",defaultMessage:"Add a new view or chart"},viewsModuleAddViewAriaLabel:{id:"collectionViewTabBar.viewsModuleAddView",defaultMessage:"Add tab"},viewsModuleAddViewTooltip:{id:"collectionViewTabBar.viewsModuleAddViewTooltip",defaultMessage:"Add a new tab"}}),rS=n.memo((function(e){const{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r}=e,i=(0,u().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]),l=(0,p().IS)((()=>({flex:{display:"flex"}})),[]);return t.showAddViewButton?(0,G.jsx)(Bt().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.flex,onMouseDown:n,children:i?(0,G.jsx)(iS,{variant:r}):(0,G.jsx)(lS,{collectionContextStore:o,variant:r})}):null})),iS=n.memo((function(e){const{variant:t}=e,r=(0,vt().tz)(),i=(0,p().IS)((e=>({button:{..."pills"===t?{height:28,width:28,borderRadius:"100%"}:void 0,background:e.tint.uiBlue},hoveredButton:{color:e.text.uiBluePrimary,background:e.tint.uiBlueHover},pressedButton:{color:e.text.uiBluePrimary,background:e.tint.uiBluePressed},icon:{fill:e.icon.uiBluePrimary,height:Po().Ev.sm,width:Po().Ev.sm}})),[t]),l=(0,n.useCallback)((()=>(0,G.jsx)(vt().sA,{...nS.viewsModuleAddViewTooltip})),[]),s=(0,n.useCallback)(((e,t)=>(0,G.jsx)(Mt().A,{ariaLabel:r.formatMessage(nS.viewsModuleAddViewAriaLabel),className:Be().Tel,icon:qo().plusSmallIcon,style:i.button,hoveredStyle:i.hoveredButton,pressedStyle:i.pressedButton,iconStyle:i.icon,...t,...e})),[r,i.button,i.hoveredButton,i.icon,i.pressedButton]),a=(0,n.useCallback)((e=>(0,G.jsx)(Ft().A,{renderTooltip:l,render:t=>s(t,e)})),[s,l]);return(0,G.jsx)(o(621866).i,{renderOrigin:a})})),lS=n.memo((function(e){const{collectionContextStore:t,variant:o}=e,r=(0,vt().tz)(),i=(0,u().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isLinkedCollectionView()}),[t]),l=(0,p().IS)((()=>({button:{..."pills"===o?{height:28,width:28,borderRadius:"100%"}:void 0},icon:{height:Po().Ev.sm,width:Po().Ev.sm}})),[o]),s=(0,n.useCallback)((e=>(0,G.jsx)(tS().y7,{collectionContextStore:t,onClose:e.close,forceHideAdvancedConfigItems:!1})),[t]),a=(0,n.useCallback)((()=>(0,G.jsx)(vt().sA,{...i?nS.linkedAddViewTooltip:nS.defaultAddViewTooltip})),[i]),c=(0,n.useCallback)(((e,t)=>(0,G.jsx)(Mt().A,{ariaLabel:r.formatMessage(i?nS.linkedAddViewAriaLabel:nS.defaultAddViewAriaLabel),className:Be().Tel,icon:qo().plusSmallIcon,style:l.button,iconStyle:l.icon,...t,...e})),[r,i,l.button,l.icon]),d=(0,n.useCallback)((e=>(0,G.jsx)(Ft().A,{renderTooltip:a,render:t=>c(t,e)})),[c,a]);return(0,G.jsx)(sn().Ay,{popupType:ke().A.isMobile?sn().z7.BottomSheet:sn().z7.Popup,alignmentToOrigin:oS().C1.Start,originGap:4,render:s,renderOrigin:d},"suggested-views")}));var sS=()=>o(300089);function aS(e){const{origin:t}=e,o=(0,a().v3)();return(0,G.jsx)(su().k,{origin:t,placementToOrigin:"bottom",header:(0,G.jsx)(vt().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,G.jsx)(vt().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{lu().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:cu().gO,pointerOffset:cu().Nu,style:{width:cu().Sw}})}function cS(e){const{origin:t}=e,o=(0,a().v3)();return(0,G.jsx)(su().k,{origin:t,placementToOrigin:"right",header:(0,G.jsx)(vt().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,G.jsx)(vt().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,G.jsx)("span",{style:{fontWeight:Fo().Wy.semibold},children:e})}}),onCloseClick:()=>{lu().A6(o)},pointerPosition:"50%",pointerLength:cu().gO,pointerOffset:cu().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:cu().Sw}})}function dS(e){const{collectionContextStore:t,isPlaceholderExternalCollection:o,previewContext:n,showOnlyCurrentView:r}=e;return"collectionSettings"!==t.contextType&&(!(r||o||null!=n&&n.disableAllPointerEvents)&&(!!t.permissionScopesStore.state.canConfigureBlock&&!t.isMultiSourceView))}var uS=()=>o(745266),pS=()=>o(115512),gS=()=>o(374562),mS=()=>o(522827);function SS(e){var t;const{collectionContextStore:o,collectionViewStore:n,schema:r}=e,i=o.collectionStore();if(!i)return n.getName();const l=i.getPropertyMapping(),s=n.getName(),a=null==l?void 0:l[St().yx.TaskToSprintRelation];if(!r||!a||s!==Tt().A.formatMessage(gS().DZ.tasksCurrentSprintV2ViewName))return n.getName();const c=r[a],d=c&&(0,Xo().nC)(c)?(0,Xo().Nv)(c):void 0;if(!d)return n.getName();const u=null===(t=(0,mS().ax)(o,"current",d,i))||void 0===t?void 0:t.getBlockTitleStore().getValue();return u?`${Tt().A.formatMessage(gS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${u[0]}`:n.getName()}function hS(e){const{collectionViewStore:t,collectionContextStore:n}=e,[r,i]=(0,u().K8)((()=>{const e=n.settingsStore.state;return[e.open,e.stack.at(-1)]}),[n.settingsStore]),l=(0,u().O$)(n.viewsModuleContextStore),s=(0,u().K8)((()=>n.collectionViewStore()),[n]),a=(0,u().K8)((()=>t.getCollectionStore()),[t]),c=(0,u().K8)((()=>{if(!t.isDefined())return;return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===St().Lu&&null!=a&&a.isDefined()?{name:SS({collectionContextStore:n,collectionViewStore:t,schema:a.getSchema()}),type:t.getType()}:{name:t.getName(),type:t.getType()}}),[t,a,n]),d=r&&i&&("duplicateExistingView"===i.type||"createView"===i.type);return!c||(null==s?void 0:s.id)===t.id&&d&&!l?(0,G.jsx)(vt().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,G.jsx)(o(31902).A,{collectionViewName:c.name,collectionViewType:c.type})}function fS(e){const{collectionViewStore:t}=e,o=(0,se().ET)(),r=(0,u().K8)((()=>{var e;const n=null===(e=t.getParentBlockStore())||void 0===e?void 0:e.id;return!!n&&((0,_e().sj)(n)&&o.isInHomeWidgetStore.state)}),[o.isInHomeWidgetStore,t]),[i,l]=(0,u().K8)((()=>{const e=t.getName(),o=t.getType(),n=(0,V().OO)({collectionViewName:e,collectionViewType:o});if(!o)return[n,void 0];const r=t.getFormat().description;if(r)return[n,r];const i=t.getCollectionStore(),l=null==i?void 0:i.getName();if(i&&l){var s,a;if((null==i||null===(s=i.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(a=t.getParentBlockStore())||void 0===a?void 0:a.id))return[n,(0,G.jsx)(vt().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:At().to[o],collection:(0,Pe().r4)(l,i)}},"viewTab.tooltip.2")]}return[n,(0,G.jsx)(vt().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:At().to[o]}},"viewTab.tooltip.2")]}),[t]),s=(0,p().IS)((e=>({tooltip:r?{marginBottom:-5,marginLeft:8}:{},tooltipSecondLine:{color:e.text.contrastSecondary},offset:r?{marginLeft:-8}:{}})),[r]),{render:a}=e,c=(0,n.useCallback)((e=>r?(0,G.jsx)("div",{style:s.offset,children:a(e)}):a(e)),[r,a,s.offset]),d=(0,n.useCallback)((e=>r?(0,G.jsx)(vt().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,G.jsxs)("div",{...e,style:vu().Q$,children:[i,(0,G.jsx)("div",{style:s.tooltipSecondLine,children:l})]})),[r,s.tooltipSecondLine,i,l]);return i?(0,G.jsx)(Ft().A,{placement:r?$e().W.Top:$e().W.Bottom,originGap:r?0:void 0,alignment:$e().C.Start,delayThreshold:500,style:s.tooltip,render:c,renderTooltip:d}):null}const yS=n.memo((function(e){var t,r;const{collectionViewStore:i,collectionContextStore:s,hideUnderline:c,onViewClick:d,disabled:g,variant:m="default"}=e,S=(0,a().v3)(),{isMobile:h}=(0,a().Y0)(),f=(0,H().X)("db_ux_chrome"),y=(0,n.useRef)(null),[v,x]=(0,n.useState)(!1),w=(0,o(937199).v$)(),k=(0,Re().Zp)(),[R,A]=(0,u().K8)((()=>{var e;return[s.viewsModuleContextStore.isInLayoutBuilder(),null===(e=s.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[s.viewsModuleContextStore]),I=(0,u().K8)((()=>s.collectionViewStore()),[s]),T=(0,u().K8)((()=>s.collectionViewBlockStore()),[s]),j=(0,u().O$)(s.isInHomeWidgetStore),{isDefinedCollectionViewStore:_,viewIcon:B,viewType:P}=(0,u().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),M=(0,u().K8)((()=>{var e,t;return!((null==T?void 0:T.getSpaceId())!==(null===(e=jt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===St().Lu&&"sprint_board"===(null===(t=jt().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,T]),F=(0,u().K8)((()=>{var e;return!0===(null===(e=jt().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&s.isInPeekRendererStore.state}),[s]),L=(0,u().K8)((()=>{var e;const t=null===(e=s.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[s]),O=(0,n.useCallback)((()=>{x(!1)}),[]),{renderMenu:E,hasMenuItems:D}=(0,o(454869).y)({collectionViewStore:i,collectionContextStore:s,onClose:O}),z=(0,n.useCallback)((()=>{!D||null!=k&&k.disableAllPointerEvents||x(!0)}),[k,D]),K=(0,n.useCallback)((e=>{e.preventDefault(),(0,l().SQ)({event:e,context:l().y$.EditorContextMenu,callback:z})}),[z]),W=(0,n.useCallback)((e=>{const t=s.collectionViewStore();if(!t)return;const n=s.viewsModuleContextStore.state?void 0:Oe().Vr(e);if(d({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:n}),t.id===i.id?z():(0,o(180762).t)({environment:S,collectionContextStore:s,collectionViewId:i.id,openInNew:n,isFullScreen:s.isFullScreenStore.state,isRootChild:s.isRootChildStore.state,isInPeekRenderer:s.isInPeekRendererStore.state}),R&&w){var r;const e=null===(r=s.viewsModuleContextStore.getViewsModule())||void 0===r?void 0:r.id;e&&(w.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),C().Ow({collectionContextStore:s,collectionSettingsStore:s.settingsStore,closeOnEscape:!1}))}(0,b().X)({environment:S,collectionContextStore:s,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[s,d,z,i,R,w,S]),N=(null==I?void 0:I.id)===i.id,$=N&&R&&"existing_module"===(null==w||null===(t=w.currentModuleSelection)||void 0===t?void 0:t.type)&&w.currentModuleSelection.moduleId===A,U=R?N&&!$:("pills"!==m||!j)&&("pills"===m?v||N:v),X="pills"!==m&&!c&&N&&L,q=(null===(r=(0,V().Oz)(s))||void 0===r?void 0:r.background)??"none",Y=(0,p().IS)((e=>({originContainer:{display:"flex",alignItems:"center",background:R?void 0:q,height:"100%",...X&&{borderBottom:`2px solid ${e.text.primary}`,paddingTop:2},..."pills"===m&&{marginRight:1}},tooltipOriginContainer:{display:"flex",alignItems:"center",height:as().r2,fontSize:14,fontWeight:Fo().Wy.medium,color:N?e.text.primary:e.text.secondary,maxWidth:as().PB,..."pills"===m&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px 6px 10px",whiteSpace:"nowrap",height:h?as().G1:as().r2},...R?$?(0,pS().nl)({width:3,color:e.stroke.uiBluePrimary}):(0,pS().nl)({width:1.5,color:e.stroke.uiBlueSecondary}):void 0,...R&&{marginRight:4,transition:"box-shadow 0.3s"}},tooltipOriginContainerHovered:R?{...(0,pS().nl)({width:3,color:e.stroke.uiBlueSecondary}),background:"none"}:"dark"===e.mode&&f?{background:e.fill.graySecondary}:{},tooltipOriginContainerPressed:R?{...(0,pS().nl)({width:3,color:e.stroke.uiBluePrimary}),background:"none"}:{},collectionViewIcon:{marginRight:6,...j&&{fill:e.text.secondary,transform:"scale(0.75)"}},collectionViewTabTitle:{...Fo().RC,marginTop:1,...j&&{color:e.text.secondary,fontSize:Fo().J.UISmall.desktop,fontWeight:Fo().Wy.medium},...h&&{fontSize:15}}})),[q,N,$,R,j,X,m,h,f]),Q=(0,n.useCallback)((e=>(0,G.jsxs)(ln().p,{"aria-selected":N,role:"tab",ref:y,size:"pills"===m?"lg":"md",style:Y.tooltipOriginContainer,hovered:U,hoveredStyle:Y.tooltipOriginContainerHovered,pressedStyle:Y.tooltipOriginContainerPressed,onClick:W,disabled:g,...e,children:[(0,G.jsx)(uS().h,{color:N?"regular":"light",viewIcon:B,viewType:P,style:Y.collectionViewIcon}),(0,G.jsx)("span",{style:Y.collectionViewTabTitle,children:(0,G.jsx)(hS,{collectionContextStore:s,collectionViewStore:i})})]},i.id)),[s,i,g,W,U,N,Y.collectionViewIcon,Y.collectionViewTabTitle,Y.tooltipOriginContainer,Y.tooltipOriginContainerHovered,Y.tooltipOriginContainerPressed,m,B,P]);return _&&I&&T?(0,G.jsx)(Ea().Ay,{popupType:h?Ea().nl.BottomSheet:Ea().nl.Popup,alignmentToOrigin:$e().C.Start,open:v,render:E,onDismiss:O,trapFocus:!0,origin:(0,G.jsxs)("div",{className:Be().f_$,style:Y.originContainer,onContextMenu:K,children:[M?(0,G.jsx)(El().U7,{origin:y}):null,F?(0,G.jsx)(yu().gO,{origin:y,store:s}):null,(0,G.jsx)(fS,{collectionViewStore:i,render:Q})]})}):null})),vS={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:85,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:52}},xS=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:s,onViewClick:c,disabled:d,variant:g="default"}=e,m=(0,a().v3)(),S=(0,a().WS)(),h=ke().A.isMobile,f=(0,H().X)("db_ux_chrome"),y=(0,ss().Y4)(),v=(0,n.useRef)(null),x=(0,n.useRef)(null),C=(0,n.useRef)(new(ot().E)({throttleMs:50})),w=(0,n.useRef)(new Map),k=(0,u().O$)(r),[R,A]=(0,n.useState)(!1),I=(0,n.useCallback)((()=>{A(!0)}),[]),j=(0,n.useCallback)((()=>{A(!1)}),[]),_=(0,Re().Zp)(),B=(0,n.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:P,MORE_BUTTON_MAX_WIDTH:M,ADD_VIEW_BUTTON_MAX_WIDTH:F,VIEW_TAB_PADDING:L}=(0,n.useMemo)((()=>vS[g]),[g]),{isInCollectionViewPageWithContent:O,isEditingViewsModuleInPageBuilder:E}=(0,u().K8)((()=>{var e;return{isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),D=(0,u().O$)(t.permissionScopesStore),z=(0,u().O$)(t.isFullScreenStore),K=(0,u().O$)(t.isInHomeWidgetStore),W=(0,u().K8)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e||null===(e=e.getParentBlockStore())||void 0===e?void 0:e.id;return!!o&&((0,_e().sj)(o)&&t.isInHomeWidgetStore.state)}),[t]),N=(0,u().O$)(t.isEditableHomeCollectionStore),$=(0,u().K8)((()=>{var e;return s?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,s]),U=(0,u().K8)((()=>dS({collectionContextStore:t,isPlaceholderExternalCollection:i,previewContext:_,showOnlyCurrentView:s})),[t,i,_,s]);(0,n.useEffect)((()=>{const e=C.current;return()=>{e.destroy()}}),[C]);const X=(0,n.useCallback)((e=>{let t=w.current.get(e.id);t||(t=new(o(773363).k)({style:{fontSize:`${Fo().J.UIRegular.desktop}px`,fontWeight:Fo().Wy.medium}}),w.current.set(e.id,t));const n=(0,V().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),r=t.measure(n);return Math.min(L+r.width,as().PB)}),[L]),q=(0,u().K8)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(M,U?F:0);let n=C.current.rect.state.width-o;const r=[],i=X(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of $){if(t.id===e.id)continue;const o=X(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),s=$.findIndex((t=>t.id===e.id));return l.splice(s,0,e),l}),[t,M,U,F,X,$]),Y=(0,n.useMemo)((()=>null==q?void 0:q.reduce(((e,t)=>(e[t.id]=t,e)),{})),[q]),Q=(0,u().K8)((()=>"collectionSettings"===t.contextType),[t]),Z=(0,u().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e}),[t]),J=(0,u().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getType()}),[t]),ee=(0,n.useMemo)((()=>{const e=(null==q?void 0:q.length)||0,t=$.length-e,o=q&&(0===e||1===e&&$.length>1),n=Q?"allTabsVisible":o||S||O||N?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:U&&"allTabsVisible"===n&&(!f||f&&R),addViewButtonAnimatedIn:z||k||E,viewSelectState:n,moreViewsCount:t}}),[q,$.length,S,O,N,f,R,U,z,k,E,Q]);(0,n.useEffect)((()=>{const e=C.current;return()=>{e.destroy()}}),[C]);const te=(0,n.useCallback)((e=>{e&&C.current.observe(e)}),[C]),oe=(0,n.useCallback)((()=>{(0,b().X)({environment:m,collectionContextStore:t,action:"click_views_dropdown"})}),[t,m]),ne=(0,n.useCallback)((e=>{T().createAndCommit({userAction:e,environment:m,canUndo:!0,perform:e=>{(0,o(423938).Z)({environment:m,collectionContextStore:t,newViewType:"table",transaction:e})}}),(0,o(154017).b)({environment:m,collectionContextStore:t,view_type:"table",from:"addButton"})}),[t,m]),re=(0,n.useCallback)((e=>{const n=t.collectionViewBlockStore();n&&T().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:m,canUndo:!0,perform:t=>{(0,o(92253).i)({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}),[t,m]),ie=(0,n.useCallback)((e=>{(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),le=(0,p().IS)((e=>{const t=d||K,o=t&&"pills"!==g||"pills"===g?0:5,n="form_editor"===J&&ke().A.isMobile?P:f&&S?"100%":as().PB;return{draggableContainer:{height:"100%"},tabContainer:{display:"flex",alignItems:"center",height:as().r2,...f&&h&&{height:as().G1},fontSize:t?Fo().J.UISmall.desktop:14,fontWeight:t?Fo().Wy.regular:Fo().Wy.medium,color:t?e.text.secondary:e.text.primary,maxWidth:n,..."pills"===g&&{background:K?"none":"rgba(55, 53, 47, 0.06)",borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingLeft:10,paddingRight:10,whiteSpace:"nowrap"}},moreViewsContainer:{display:"flex",alignItems:"center",height:as().r2,...f&&h&&{height:as().G1},fontSize:Fo().J.UIRegular.desktop,color:e.text.secondary,..."pills"===g&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingLeft:10,paddingRight:10,whiteSpace:"nowrap"}},viewIcon:{marginLeft:o,marginRight:6,...W&&{transform:"scale(0.75)"},fill:e.text.secondary},viewTitle:{...Fo().RC,marginRight:f?4:6,...K&&{fontWeight:Fo().Wy.medium},...f&&h&&{fontSize:15}},tabChevron:{width:Po().Ev.sm,height:Po().Ev.sm,fill:e.icon.tertiary},viewSelectContainer:{display:"flex",alignItems:"center",height:"100%",...f&&{marginLeft:-4,marginTop:-3},flexGrow:S&&f?0:10,overflow:"hidden",...E&&{paddingLeft:2}},innerContainer:{display:"contents"},viewSelectInner:{display:"flex",alignItems:"center",flexShrink:1,height:"100%",...S&&f&&{width:"100%"}}}}),[d,K,J,P,g,W,f,E,h,S]),se=(0,n.useCallback)(((e,o)=>{if(!Y)return null;const r=Y[e];if(!r)return null;const i=n.createRef();return(0,G.jsx)(bS,{collectionContextStore:t,store:r,isFirst:0===o,onViewClick:c,disabled:d,showOnlyCurrentView:s,variant:g,origin:i})}),[t,d,c,s,Y,g]),ae=(0,n.useMemo)((()=>q&&Y&&"dropdown"!==ee.viewSelectState?!D.canConfigureBlock||null!=_&&_.disableAllPointerEvents?q.map(((e,o)=>{const r=n.createRef();return(0,G.jsx)(bS,{collectionContextStore:t,store:e,isFirst:0===o,onViewClick:c,disabled:d,showOnlyCurrentView:s,variant:g,origin:r},e.id)})):(0,G.jsx)(Gs().Ay,{keys:Object.keys(Y),renderKey:se,onDrop:re,direction:"horizontal",style:le.draggableContainer,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0}):null),[q,ee.viewSelectState,D.canConfigureBlock,null==_?void 0:_.disableAllPointerEvents,Y,le.draggableContainer,se,re,t,c,d,s,g]),ce=(0,n.useCallback)(((e,n)=>{if(!Z)return;const r=Z.getType(),i=Z.getFormat().collection_view_icon,l=d||K;return(0,G.jsxs)(ln().p,{ref:v,style:le.tabContainer,hovered:"pills"===g&&!K||void 0,size:"pills"===g?"lg":"md",disabled:d,...(0,rn().A)(e,n),children:[(0,G.jsx)(uS().h,{color:l?"lightGray":"regular",viewType:r,viewIcon:i,style:le.viewIcon,size:l?Po().Ev.sm:void 0}),(0,G.jsx)("span",{style:le.viewTitle,children:(0,G.jsx)(hS,{collectionContextStore:t,collectionViewStore:Z})}),d?null:(0,o(324254).arrowChevronSingleDownSmallIcon)(le.tabChevron)]})}),[t,Z,d,K,le.tabChevron,le.tabContainer,le.viewIcon,le.viewTitle,g]),de=(0,n.useCallback)((e=>{const o=t.collectionViewStore();if(null!=o&&o.isDefined()){if("dropdown"===ee.viewSelectState){var n;const r="page"===o.getType()&&(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===St().pW;return(0,G.jsxs)(G.Fragment,{children:[!ke().A.isMobile&&r&&"home"===lu().WH()?(0,G.jsx)(aS,{origin:v}):null,(0,G.jsx)(fS,{collectionViewStore:o,render:t=>ce(e,t)})]})}return"someTabsNotVisible"===ee.viewSelectState?(0,G.jsx)(ln().p,{style:le.moreViewsContainer,size:"pills"===g?"lg":"md",...e,children:(0,G.jsx)("span",{children:(0,G.jsx)(vt().sA,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:ee.moreViewsCount}})})}):void 0}}),[t,ee.viewSelectState,ee.moreViewsCount,ce,le.moreViewsContainer,g]),ue=(0,n.useCallback)((e=>{var o;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===St().pW;return(0,G.jsxs)(G.Fragment,{children:[!ke().A.isMobile&&"views"===lu().WH()&&n&&(0,G.jsx)(cS,{origin:x}),(0,G.jsx)("div",{ref:x,children:(0,G.jsx)(tS().W5,{collectionContextStore:t,onClose:e.close,onViewClick:c,onAddViewClick:ne})})]})}),[t,ne,c]);return(0,G.jsx)(rt().lC,{collectionContextStore:t,step:"views",containerRef:B,children:(0,G.jsx)("div",{role:"tablist",tabIndex:-1,onMouseEnter:I,onMouseLeave:j,style:le.viewSelectContainer,ref:te,children:(0,G.jsxs)("div",{ref:B,style:le.viewSelectInner,children:[ae,ee.showMoreViewsButton?(0,G.jsx)("div",{onMouseDown:ie,style:le.innerContainer,children:(0,G.jsx)(sn().Ay,{alignmentToOrigin:oS().C1.Start,originGap:4,popupType:S?y?Ea().nl.BottomSheet:Ea().nl.SlideUp:Ea().nl.Popup,render:ue,renderOrigin:de,onClick:oe})}):null,(0,G.jsx)(rS,{renderState:ee,collectionContextStore:t,preventRectangularSelection:ie,variant:g})]})})})}));function bS(e){const{collectionContextStore:t,store:n,origin:r,isFirst:i,onViewClick:l,disabled:s,showOnlyCurrentView:a,variant:c}=e,d=(0,u().K8)((()=>Boolean(Ze().Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(739135).gt)(jt().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]),g=(0,p().IS)((()=>({jiraOnboardingContainer:{boxShadow:o(638013).p.inputBlueFocusRing.light,borderRadius:6}})),[]);return i&&d?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{ref:r,style:g.jiraOnboardingContainer,children:(0,G.jsx)(yS,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:s,hideUnderline:a,variant:c},n.id)}),(0,G.jsx)(E().dM,{origin:r})]}):(0,G.jsx)(yS,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:s,hideUnderline:a,variant:c},n.id)}var CS=()=>o(658199),wS=()=>o(21140);const kS=n.memo((function(e){const{collectionContextStore:t}=e,o=(0,u().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,u().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,G.jsx)(RS,{parentBlockStore:n}):null})),RS=n.memo((function(e){let{parentBlockStore:t}=e;const r=(0,a().v3)(),{isMobile:i}=(0,a().Y0)(),l=i?wS().wt:wS().Ye,s=(0,p().IS)((e=>({layoutComponent:{color:e.text.secondary,background:e.palette.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:Fo().Wy.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),c=(0,n.useCallback)((()=>{(0,_().v)(r,"view_deleted_database_from_deleted_collection_view_banner"),o(867201).Y({environment:r,store:t,pageVisitSource:Vo().y8.LinkInPage})}),[r,t]);return(0,G.jsxs)(l,{style:s.layoutComponent,alignItems:"center",justifyContent:i?"":"space-between",children:[(0,G.jsxs)(wS().Ye,{alignItems:"center",children:[(0,o(735384).I)(s.trashIcon),(0,G.jsx)(vt().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,G.jsxs)(ln().p,{style:s.viewCollectionButton,onClick:c,isLightGray:!0,children:[(0,G.jsx)(vt().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,o(442277).B)(s.arrowIcon)]})]})}));var AS=()=>o(650829),IS=()=>o(152077),TS=()=>o(726483),jS=()=>o(559378),_S=()=>o(99042);function BS(){const e=(0,se().Ks)(),t=(0,u().K8)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,ys().A)(t,500,100)?(0,G.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,G.jsx)(hn().A,{style:{width:14,height:14}})}):null}const PS=n.memo(BS);var MS=()=>o(344417);var FS=()=>o(623580),VS=()=>o(766558);const LS=(0,vt().YK)({searchLabel:{id:"database.searchButton.tooltip",defaultMessage:"Search"},searchInputPlaceholder:{id:"database.searchInputPlaceholder",defaultMessage:"Type to search..."}}),OS=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,currentViewType:r,isInHomeWidget:i}=e,l=(0,vt().tz)(),{isPhone:s}=(0,a().Y0)(),c=(0,H().X)("db_ux_phone_remove_bar"),d=(0,u().K8)((()=>{const e=t.searchOpenStore.state;return s?e&&c:e}),[c,t,s]),p=(0,n.useCallback)((()=>l.formatMessage(LS.searchLabel)),[l]),g=(0,n.useCallback)((e=>(0,G.jsx)(ES,{ignoreAreaEvents:e,collectionContextStore:t,isFullScreen:o,currentViewType:r,isSearchOpen:d})),[t,o,r,d]),m=(0,n.useCallback)((e=>(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(DS,{tooltipEvents:e,collectionContextStore:t,isInHomeWidget:i}),(0,G.jsx)(Bt().A,{visible:d,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,G.jsx)(pt().A,{capture:d,allowEsc:!0,render:g})})]})),[t,g,d,i]);return(0,G.jsx)(Ft().A,{renderTooltip:p,render:m})}),Qo().A);function ES(e){let{ignoreAreaEvents:t,collectionContextStore:r,isFullScreen:i,currentViewType:l,isSearchOpen:s}=e;const c=(0,a().v3)(),d=(0,vt().tz)(),{isPhone:g}=(0,a().Y0)(),m=(0,u().O$)(r.searchQueryStore),[S,h]=(0,n.useState)(!1),f=(0,p().IS)((e=>({input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.text.primary,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),y=(0,n.useCallback)((()=>{Se().default.reset(),he().default.reset(),Pd().A.reset(),h(!0)}),[]),v=(0,n.useCallback)((()=>{r.searchQueryStore.setState(""),r.searchOpenStore.setState(!1)}),[r]),x=(0,n.useCallback)((()=>{r.searchQueryStore.state||v(),h(!1)}),[r,v]),b=(0,n.useCallback)((e=>{27===e.keyCode&&v()}),[v]),C=(0,n.useCallback)((e=>{(0,sr().S)({searchQuery:e.target.value,collectionContextStore:r,isFullScreen:Boolean(i)}),function(e,t){(0,_().v)(e,"collection_search",t)}(c,{view_type:l})}),[r,l,c,i]),w=(0,vn().Y)(C,250);return n.useEffect((()=>{r.searchOpenStore.state&&y()}),[r.searchOpenStore,y]),(0,G.jsxs)("div",{...t,style:f.ignoreArea,children:[(0,G.jsx)(FS().A,{style:f.input,right:(0,G.jsx)(AS().LazyAssistantCollectionSearchInputButton,{collectionContextStore:r}),format:FS().C.Transparent,value:m,onChange:w,placeholder:d.formatMessage(LS.searchInputPlaceholder),focusInitial:s,showClearButton:!0,onFocus:y,onBlur:x,onCancel:v,onClick:Oe().kV,onClearButtonClick:v,onKeyDown:b}),g?(0,G.jsx)(o(594739).A,{show:S}):null]})}function DS(e){let{tooltipEvents:t,collectionContextStore:r,isInHomeWidget:i}=e;const l=(0,vt().tz)(),s=(0,a().v3)(),c=(0,H().X)("db_ux_chrome"),{isPhone:d}=(0,a().Y0)(),g=(0,p().IS)((e=>{const{button:t,icon:o}=(0,VS().i)({theme:e,isInHomeWidget:i,isMobile:Boolean(ke().A.isMobile),isDBUXChromeEnabled:c});return{button:t,icon:o}}),[i,c]),m=(0,u().K8)((()=>0===r.collectionStoresStore.state.length),[r]),S=(0,n.useCallback)((()=>{r.searchOpenStore.update((e=>!e)),(0,b().X)({environment:s,collectionContextStore:r,action:"click_topbar_search"})}),[r,s]);return(0,G.jsx)(Mt().A,{...t,icon:d?o(207207).J:MS().u,iconStyle:g.icon,style:g.button,disabled:m,onClick:S,ariaLabel:l.formatMessage(LS.searchLabel)})}const zS={viewBox:"0 0 16 16",fittedViewBox:"3.62 1.34 8.75 12.93",svg:(0,G.jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},KS=(0,Po().wt)("lightningSmall",zS);var HS=()=>o(940371);function WS(){const e=(0,a().v3)(),{isMobile:t}=(0,a().Y0)(),o=(0,H().X)("db_ux_chrome"),r=(0,se().ET)(),i=(0,u().K8)((()=>r.settingsStore.state.open&&TS()._T({tab:(0,HS().S)(r.settingsStore)})),[r]),l=(0,u().O$)(r.isInHomeWidgetStore),s=(0,u().K8)((()=>r.aliveAutomationCountStore.state>0),[r]),c=(0,u().K8)((()=>r.collectionViewBlockStore()),[r]),d=(0,u().K8)((()=>{var e;return null===(e=jt().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),g=(0,u().K8)((()=>{const e=r.collectionStore(),t=null==e?void 0:e.getParentBlockStore();return null==t?void 0:t.pathIsDead()}),[r]),m=(0,u().K8)((()=>null==c?void 0:c.isLocked()),[c]),{disabled:S,tooltipCopy:h,ariaLabel:f}=function(e){let{hasAutomations:t,isPageInTrash:o,isParentCollectionInTrash:r}=e;const i=!(0,u().O$)(qe().e),l=(0,n.useMemo)((()=>(r||o)&&!t),[t,o,r]);if(i&&!t)return{disabled:!0,tooltipCopy:Tt().A.formatMessage(GS.disableAutomationsSettingsButtonOfflineTooltip),ariaLabel:Tt().A.formatMessage(GS.disableAutomationsSettingsButtonOfflineAriaLabel)};if(l)return{disabled:!0,tooltipCopy:Tt().A.formatMessage(GS.disableAutomationsSettingsButtonTrashTooltip),ariaLabel:Tt().A.formatMessage(GS.disableAutomationsSettingsButtonTrashAriaLabel)};return{disabled:!1,tooltipCopy:Tt().A.formatMessage(GS.openAutomationsSettingsButtonTooltip),ariaLabel:Tt().A.formatMessage(GS.openAutomationsSettingsButtonAriaLabel)}}({hasAutomations:s,isPageInTrash:d,isParentCollectionInTrash:g}),y=(0,p().IS)((e=>{const{button:n,icon:r}=(0,VS().i)({theme:e,isInHomeWidget:l,isMobile:t,isDBUXChromeEnabled:o});return{button:n,icon:{...r,fill:s?e.icon.uiBluePrimary:e.icon.secondary}}}),[s,l,t,o]),v=(0,u().K8)((()=>TS().rc({collectionStore:r.collectionStore()})),[r]),x=(0,n.useCallback)((t=>{const o=r.settingsStore,n=o.state.open,i=(0,HS().S)(o);n&&"automationSettings"===(null==i?void 0:i.type)?C().os({collectionSettingsStore:o}):s||m||d||g||!v?(C().Ow({collectionContextStore:r,collectionSettingsStore:o}),C().R8({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):C().js({environment:e,collectionSettingsStore:o,collectionContextStore:r})}),[e,r,s,m,d,g,v]);return(0,G.jsx)(Ft().A,{renderTooltip:()=>h,render:e=>(0,G.jsx)(Mt().A,{ariaLabel:f,className:Be().Jnf,icon:KS,style:y.button,iconStyle:y.icon,hovered:i,onClick:x,disabled:S,...e})})}const GS=(0,vt().YK)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTrashTooltip:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.tooltip"},disableAutomationsSettingsButtonTrashAriaLabel:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.ariaLabel"},disableAutomationsSettingsButtonOfflineTooltip:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.tooltip"},disableAutomationsSettingsButtonOfflineAriaLabel:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.ariaLabel"}}),NS=n.memo(WS);const $S=(0,vt().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),US=n.memo((function(e){const{createFilterSettingsStore:t}=e,r=(0,a().v3)(),{isMobile:i,isPhone:l}=(0,a().Y0)(),s=(0,H().X)("db_ux_chrome"),c=!(0,u().O$)(qe().e),d=(0,se().ET)(),g=(0,u().K8)((()=>t.state.open),[t]),m=(0,u().O$)(d.isInHomeWidgetStore),S=(0,u().K8)((()=>(0,Eo().N1)({collectionContextStore:d,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[d]),h=(0,u().K8)((()=>(0,Eo().I6)(d)),[d]),f=(0,u().K8)((()=>{var e;return c&&"chart"===(null===(e=d.collectionViewStore())||void 0===e?void 0:e.getType())}),[c,d]),y=f?Tt().A.formatMessage(xt().AY.unavailableOfflineTooltip):Tt().A.formatMessage($S.filterLabel),v=(0,n.useCallback)((()=>{var e;const n=null===(e=d.collectionViewStore())||void 0===e?void 0:e.id,i=d.isEphemeralView(),s=(0,o(37489).H)(d)?d.currentCombinatorFilterStore.state:void 0,a=d.currentPropertyFiltersStore.state,c=d.filtersBarOpenStore.state;n&&!l&&((0,o(914701).E)({userId:r.currentUser.id,collectionViewId:n,isOpen:!c}),d.filtersBarOpenStore.setState(c)),m||i?c||a.length>0||s?C().R8({collectionSettingsStore:d.settingsStore,item:{type:"filters"}}):(C().R8({collectionSettingsStore:d.settingsStore,item:{type:"createFilter"}}),wn().Ms(d)):c||a.length>0||s?d.filtersBarOpenStore.setState(!c):(C().R8({collectionSettingsStore:t,item:{type:"createFilter"}}),wn().Ms(d)),(0,b().X)({environment:r,collectionContextStore:d,action:"click_topbar_filter"})}),[d,t,r,m,l]),x=(0,n.useCallback)((()=>{C().os({collectionSettingsStore:t})}),[t]),w=(0,p().IS)((e=>{const{button:t,icon:o}=(0,VS().i)({theme:e,isInHomeWidget:m,isMobile:i,isDBUXChromeEnabled:s});return{button:t,icon:{...o,fill:S?e.icon.uiBluePrimary:e.icon.secondary},tempFilterIndicator:{position:"absolute",top:3,right:2,background:e.icon.orangePrimary,border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}}}),[m,S,i,s]),k=(0,n.useCallback)((()=>y),[y]),R=(0,n.useCallback)((()=>(0,G.jsx)(qd().m$,{context:Fe().Bd.TopbarFilterPopup,collectionContextStore:d,collectionSettingsStore:t,hideDesktopHeader:!0})),[d,t]);return(0,G.jsx)(Ea().Ay,{trapFocus:!0,popupType:i?sn().z7.SlideUp:sn().z7.Popup,open:g,placementToOrigin:qm().UV.Bottom,alignmentToOrigin:qm().MY.Start,origin:(0,G.jsx)(Ft().A,{renderTooltip:k,render:e=>(0,G.jsxs)("div",{style:w.iconContainer,children:[(0,G.jsx)(Mt().A,{...e,ariaLabel:y,icon:ji().$,iconStyle:w.icon,style:w.button,onClick:v,disabled:f}),h&&(0,G.jsx)("div",{style:w.tempFilterIndicator})]})}),onDismiss:x,originGap:4,render:R})})),XS={viewBox:"0 0 16 16",fittedViewBox:"2.42 2.11 11.16 12.13",svg:(0,G.jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},qS=(0,Po().wt)("bellSmall",XS),YS=(0,vt().YK)({followLabel:{defaultMessage:"Follow",id:"collectionViewBlock.action.follow.title"}});function QS(e){let{createFollowSettingsStore:t}=e;const{isMobile:o}=(0,a().Y0)(),r=(0,H().X)("db_ux_chrome"),i=(0,se().ET)(),l=(0,p().IS)((e=>{const{button:t,icon:n}=(0,VS().i)({theme:e,isInHomeWidget:!1,isMobile:o,isDBUXChromeEnabled:r});return{button:t,icon:n,iconContainer:{position:"relative"}}}),[o,r]),s=(0,n.useMemo)((()=>Tt().A.formatMessage(YS.followLabel)),[]),c=(0,u().K8)((()=>t.state.open),[t]),d=(0,n.useCallback)((()=>{C().R8({collectionSettingsStore:t,item:{type:"follow"}})}),[t]),g=(0,n.useCallback)((()=>{C().os({collectionSettingsStore:t})}),[t]),m=(0,n.useCallback)((()=>s),[s]),S=(0,n.useCallback)((()=>(0,G.jsx)(qd().m$,{context:Fe().Bd.TopbarFollowPopup,collectionContextStore:i,collectionSettingsStore:t,hideDesktopHeader:!0})),[i,t]);return(0,G.jsx)(Ea().Ay,{trapFocus:!0,popupType:o?sn().z7.BottomSheet:sn().z7.Popup,open:c,placementToOrigin:qm().UV.Bottom,alignmentToOrigin:qm().MY.Start,origin:(0,G.jsx)(Ft().A,{renderTooltip:m,render:e=>(0,G.jsx)("div",{style:l.iconContainer,children:(0,G.jsx)(Mt().A,{...e,ariaLabel:s,icon:qS,iconStyle:l.icon,style:l.button,onClick:d})})}),onDismiss:g,originGap:4,render:S})}function ZS(e){let{store:t,viewType:r}=e;const i=(0,a().v3)(),{isMobile:l}=(0,a().Y0)(),s=(0,H().X)("db_ux_chrome"),c=(0,se().ET)(),d=(0,u().K8)((()=>(0,sl().Ay)({store:t,fullyQualified:!1,pageVisitSource:Vo().y8.Expand,demoSettingsStore:jS().A})),[t]),g=(0,u().O$)(c.isInHomeWidgetStore),m=(0,p().IS)((e=>(0,VS().i)({theme:e,isInHomeWidget:g,isMobile:l,isDBUXChromeEnabled:s})),[l,g,s]),S=(0,n.useCallback)((()=>(0,o(989992).p)(i,{view_type:r})),[i,r]),h=Tt().A.formatMessage(o(589531).D.openFullscreenButton),f=(0,n.useMemo)((()=>l?o(47218).arrowExpandDiagonalBottomLeftToTopRightIcon:o(662984).arrowExpandDiagonalBottomLeftToTopRightSmallIcon),[l]);return(0,G.jsx)(Ft().A,{renderTooltip:()=>h,render:e=>(0,G.jsx)(Mt().A,{ariaLabel:h,href:d,onClick:S,icon:f,style:m.button,iconStyle:m.icon,...e})})}const JS=n.memo(ZS);var eh=()=>o(787626);var th=()=>o(415651);class oh extends g().Store{getInitialState(){return{query:"",limit:20}}}const nh=oh;var rh=()=>o(958378);const ih=(0,vt().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),lh=g().Store.createClass(void 0,{name:"ResultStore"});function sh(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:s,onAddPage:c}=e;const d=(0,a().v3)(),p=(0,u().uB)(void 0,nh),g=(0,u().uB)(void 0,lh),m=(0,u().K8)((()=>p.state.query),[p]),S=(0,u().O$)(g),h=(0,u().K8)((()=>{const{query:e,limit:t}=p.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,p]),f=(0,n.useCallback)((e=>{p.setState({query:e.target.value,limit:dh})}),[p]),y=(0,n.useCallback)((e=>{const t=p.state.limit,o=l.isLoadingStore.state;e<ch&&S&&S.hasMore&&!o&&p.setState({...p.state,limit:t+dh})}),[l,S,p]),v=(0,n.useCallback)((()=>{let e;return e="calendar"===r?ke().A.isMobile?(0,G.jsx)(vt().sA,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,G.jsx)(vt().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,G.jsx)(vt().sA,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),S?S&&0===S.blockIds.length?(0,G.jsx)(wr().A,{title:e,children:(0,G.jsx)(Oa().A,{title:(0,G.jsx)(vt().sA,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,G.jsx)(br().Ay,{type:br().Oh.Vertical,sections:[{key:"results",render:t=>(0,G.jsx)(wr().A,{...t,title:e}),items:gh(S.blockIds,l,t,i,c,d,r)}],initialFocus:m?0:void 0}):(0,G.jsx)(wr().A,{children:(0,G.jsx)(ph,{})})}),[t,r,S,l,i,c,d,m]);return(0,G.jsxs)(o(170356).Pq,{title:void 0,onCancel:s,desktopWidth:320,children:[(0,G.jsx)(wr().A,{isInput:!0,children:(0,G.jsx)(La().Ay,{placeholder:Tt().A.formatMessage(ih.searchPlaceholder),focus:!ke().A.isMobile||void 0,focusAfterAnimation:!0,value:m,onChange:f})}),(0,G.jsx)(In().A,{id:"no_date_results",reducer:h,collectionContextStore:l,render:v,resultStore:g}),(0,G.jsx)(Gi().A,{onChange:y})]})}const ah=n.memo(sh,Qo().A),ch=200,dh=20;function uh(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const s=(0,a().v3)(),c=n.useRef(null),d=(0,G.jsx)(rh().A,{...t,ref:c,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,G.jsx)(ln().p,{size:"sm",href:i,disabled:r,onClick:()=>{!function(e){(0,_().v)(e,"collection_no_date_menu_view")}(s)},children:(0,G.jsx)(vt().sA,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||ke().A.isMobile?d:(0,G.jsx)(gt().Ay,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[th().up(e.current)]}return[]}(c),analyticsName:"calendar_no_date_item",children:d})}function ph(){return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(so().A,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,G.jsx)(so().A,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function gh(e,t,o,n,r,i,l){const s=e.map((e=>me().Bv.createChildStore(o,{table:$().ev,id:e}))).filter((e=>!(0,eh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=jt().default.state;if(!o)return;const n=(0,V().wy)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),s={key:e.id,render:t=>(0,G.jsx)(uh,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),function(e){(0,_().v)(e,"collection_no_date_menu_add")}(i))}};return s}));return v().oE(s)}function mh(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,se().ET)(),d=(0,u().K8)((()=>c.collectionViewBlockStore()),[c]),g=(0,n.useCallback)((()=>{(0,b().X)({environment:l,collectionContextStore:c,action:"click_topbar_no_date"})}),[c,l]),m=(0,p().IS)((e=>({buttonStyle:(0,VS().y)({theme:e})})),[]),S=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=T().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,wc().$N)({environment:l,store:e,collectionStore:t,collectionContextStore:c,startDayOfWeek:_e().XX.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&A().td({environment:l,stores:[n]})}),[c,r,l,i]),h=(0,n.useCallback)((e=>d?(0,G.jsx)(ah,{collectionViewBlockStore:d,property:o,onClose:e.close,onAddPage:S,collectionViewType:r,collectionContextStore:c}):null),[c,d,r,o,S]);return!(0,u().O$)(qe().e)?null:(0,G.jsx)(sn().Ay,{popupType:s?Qd().n.SlideUp:Qd().n.Popup,placementToOrigin:sn().sx.Bottom,alignmentToOrigin:sn().yP.Start,originGap:4,render:h,onClick:g,renderOrigin:e=>(0,G.jsx)(ln().p,{isGray:!0,style:m.buttonStyle,...e,children:(0,G.jsx)(vt().sA,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=_r().iY?_r().iY-1+"+":t}})})})}const Sh=n.memo(mh);var hh=()=>o(670631);const fh=(0,vt().YK)({offlineLabelOneView:{defaultMessage:"The top {numPages} pages are available offline",id:"collectionViewBlock.offlineIndicator.labelOneView"},offlineLabelMultipleViews:{defaultMessage:"The top {numPages} pages in the first view are available offline",id:"collectionViewBlock.offlineIndicator.labelMultipleViews"},lastSyncedOn:{defaultMessage:"Last synced on {date}",id:"collectionViewBlock.offlineIndicator.lastSyncedOn"}});function yh(){const e=(0,se().ET)(),{isMobile:t}=(0,a().Y0)(),r=(0,H().X)("db_ux_chrome"),i=(0,u().O$)(e.isInHomeWidgetStore),l=(0,p().IS)((e=>{const{button:o,icon:n}=(0,VS().i)({theme:e,isInHomeWidget:i,isMobile:t,isDBUXChromeEnabled:r});return{icon:n,iconContainer:{position:"relative",...o},secondaryText:{color:e.text.secondary}}}),[i,t,r]),s=(0,u().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id}),[e]),c=(0,u().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewIds().length)??0}),[e]),d=(0,u().K8)((()=>zo().default.getConfigKey("offline_query_collection_settings","limit")),[]),g=(0,u().K8)((()=>{var e;return void 0!==s&&"success"===(null===(e=hh().A.state.offlinePages)||void 0===e||null===(e=e[s])||void 0===e?void 0:e.downloadStatus)}),[s]),m=(0,u().K8)((()=>{var e;return g&&void 0!==s?null===(e=hh().A.state.offlinePages)||void 0===e||null===(e=e[s])||void 0===e?void 0:e.lastDownloadedAt:void 0}),[s,g]),S=m?Tt().A.formatMessage(fh.lastSyncedOn,{date:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(m)}):void 0,h=Tt().A.formatMessage(1===c?fh.offlineLabelOneView:fh.offlineLabelMultipleViews,{numPages:d}),f=(0,n.useCallback)((()=>(0,G.jsxs)("div",{style:{width:200},children:[(0,G.jsx)("div",{children:h}),S&&(0,G.jsx)("div",{style:l.secondaryText,children:S})]})),[h,S,l.secondaryText]);return m?(0,G.jsx)(Ft().A,{renderTooltip:f,render:e=>(0,G.jsx)("div",{style:l.iconContainer,...e,children:(0,o(350646).k)(l.icon)}),textWrap:!0}):null}const vh=n.memo(yh);const xh=(0,vt().YK)({filterSortLabel:{defaultMessage:"Filter and Sort",id:"collectionViewBlock.action.filterSort.title"}}),bh=n.memo((function(e){const{phoneFilterSortSettingsStore:t}=e,r=(0,se().ET)(),{isMobile:i}=(0,a().Y0)(),l=(0,H().X)("db_ux_chrome"),s=(0,u().K8)((()=>{const e=r.currentSortsStore.state.length>0,t=(0,Eo().tG)(r)>0;return e||t}),[r]),c=(0,u().K8)((()=>(0,Eo().ye)(r)||(0,Eo().gv)(r)),[r]),d=!(0,u().O$)(qe().e),g=(0,u().K8)((()=>{var e;return d&&"chart"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[d,r]),m=g?Tt().A.formatMessage(xt().AY.unavailableOfflineTooltip):Tt().A.formatMessage(xh.filterSortLabel),S=(0,p().IS)((e=>{const{button:t,icon:o}=(0,VS().i)({theme:e,isInHomeWidget:!1,isMobile:i,isDBUXChromeEnabled:l});return{button:t,icon:{...o,fill:s?e.icon.uiBluePrimary:e.icon.secondary},iconContainer:{position:"relative"},diffDot:{position:"absolute",top:3,right:2,background:e.icon.orangePrimary,border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}}}),[s,i,l]),{open:h}=(0,u().O$)(t),f=(0,n.useCallback)((()=>(0,G.jsx)(qd().m$,{context:Fe().Bd.MobileSheet,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})),[r,t]),y=(0,n.useCallback)((()=>{C().R8({collectionSettingsStore:t,item:{type:"phoneFilterAndSort"}})}),[t]),v=(0,n.useCallback)((()=>{C().os({collectionSettingsStore:t})}),[t]);return(0,G.jsx)(Ea().Ay,{trapFocus:!0,open:h,popupType:Ea().nl.BottomSheet,origin:(0,G.jsxs)("div",{style:S.iconContainer,children:[(0,G.jsx)(Mt().A,{ariaLabel:m,icon:o(170350).S,iconStyle:S.icon,style:S.button,onClick:y,disabled:g}),c&&(0,G.jsx)("div",{style:S.diffDot})]}),onDismiss:v,render:f})}));const Ch=n.memo((function(e){const{store:t,handleAddItemClick:r,settingsHeaderSizeObserver:i}=e,l=(0,H().X)("db_ux_chrome"),s=(0,a().v3)(),{isMobile:c,isPhone:d}=(0,a().Y0)(),g=(0,n.useRef)(null),m=(0,se().ET)(),S=(0,u().K8)((()=>!l&&i.rect.state.width<=Fe().xO),[i,l]),h=l?d:!c&&S,f=(0,u().K8)((()=>m.isMultiSourceView),[m]),y=(0,u().K8)((()=>(0,V().h6)(m)),[m]),v=(0,u().K8)((()=>{if(!m.isMultiSourceView)return;const e=m.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:ro}),[m]),x=(0,p().IS)((()=>({buttonWrapper:{position:"relative",marginLeft:h?4:6,display:"flex",...l?{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:d?12:6}:{}},buttonStyle:{fontSize:14,height:28,...l&&{height:d?32:28}},mainButtonStyle:h?{width:28,...l&&d&&{fontSize:17,width:32}}:{},iconStyle:h?{width:15,marginRight:0,...l&&d&&{width:17}}:{}})),[l,h,d]),b=(0,n.useCallback)((e=>{C().Ub({environment:s,handleAddItemClick:r,buttonRef:g,event:e})}),[s,r,g]),w=(0,n.useCallback)((e=>{f?b(e):r(e)}),[f,b,r]),k=(0,n.useRef)(null),R=(0,n.useCallback)((e=>(0,G.jsx)("div",{style:x.buttonWrapper,ref:k,children:(0,G.jsx)(rt().lC,{collectionContextStore:m,containerRef:k,step:"new_page",children:(0,G.jsx)(o(430102).I,{ref:g,title:h?null:y,iconLeading:h?o(464699).b:void 0,color:"blue",onClick:w,mainButtonTooltip:v===ro?(0,G.jsx)(vt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,G.jsx)("br",{})}}):null,onDropdownClick:e.onClick,style:x.buttonStyle,className:Be().kel,disabled:Boolean(v),disableDropdown:f,mainButtonStyle:x.mainButtonStyle,iconStyle:x.iconStyle})})})),[x.buttonWrapper,x.buttonStyle,x.mainButtonStyle,x.iconStyle,m,h,y,w,v,f]);return(0,G.jsx)(o(472765).m,{store:t,popupType:c?Qd().n.SlideUp:Qd().n.Popup,renderOrigin:R,placementToOrigin:sn().sx.Bottom})})),wh={viewBox:"0 0 16 16",fittedViewBox:"1.67 2.48 12.66 11.03",directional:!0,svg:(0,G.jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},kh=(0,Po().wt)("arrowUpDownSmall",wh),Rh=(0,vt().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function Ah(e){let{createSortSettingsStore:t}=e;const o=(0,se().ET)(),{isMobile:r}=(0,a().Y0)(),i=(0,a().v3)(),l=(0,H().X)("db_ux_chrome"),s=(0,u().K8)((()=>t.state.open),[t]),c=(0,u().K8)((()=>o.currentSortsStore.state.length>0),[o]),d=(0,u().K8)((()=>(0,Eo().gv)(o)),[o]),g=(0,u().O$)(o.isInHomeWidgetStore),m=(0,n.useCallback)((()=>{const e=o.permissionScopesStore.state.canConfigureBlock?o.currentCombinatorFilterStore.state:void 0,n=o.currentPropertyFiltersStore.state,r=o.filtersBarOpenStore.state,l=c||r||n.length>0||e;g&&C().R8({collectionSettingsStore:o.settingsStore,item:{type:c?"sort":"createSort"}}),l?g||(o.filtersBarOpenStore.setState(!r),c?C().R8({collectionSettingsStore:o.filterBarSortSettingsStore,item:{type:"sort"}}):C().R8({collectionSettingsStore:t,item:{type:"createSort"}})):g||C().R8({collectionSettingsStore:t,item:{type:"createSort"}}),(0,b().X)({environment:i,collectionContextStore:o,action:"click_topbar_sort"})}),[o,t,i,c,g]),S=(0,n.useCallback)((()=>{C().os({collectionSettingsStore:t})}),[t]),h=Tt().A.formatMessage(Rh.sortLabel),f=(0,p().IS)((e=>{const{button:t,icon:o}=(0,VS().i)({theme:e,isInHomeWidget:g,isMobile:r,isDBUXChromeEnabled:l});return{icon:{...o,fill:c?e.icon.uiBluePrimary:e.icon.secondary,transform:"rotate(180deg)"},button:t,tempSortIndicator:{position:"absolute",top:3,right:2,background:e.icon.orangePrimary,border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}}}),[c,g,r,l]);return(0,G.jsx)(Ea().Ay,{popupType:r?sn().z7.SlideUp:sn().z7.Popup,placementToOrigin:qm().UV.Bottom,alignmentToOrigin:qm().MY.Start,open:s,origin:(0,G.jsx)(Ft().A,{renderTooltip:()=>h,render:e=>(0,G.jsxs)("div",{style:{position:"relative"},children:[(0,G.jsx)(Mt().A,{...e,ariaLabel:h,icon:kh,iconStyle:f.icon,style:f.button,onClick:m}),d&&(0,G.jsx)("div",{style:f.tempSortIndicator})]})}),onDismiss:S,originGap:4,render:()=>(0,G.jsx)(qd().m$,{context:Fe().Bd.TopbarSortPopup,collectionContextStore:o,collectionSettingsStore:t,hideDesktopHeader:!0}),trapFocus:!0})}const Ih=n.memo(Ah);function Th(){const e=(0,a().v3)(),t=(0,se().ET)(),r=(0,u().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,p().IS)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:Fo().Wy.medium,color:e.text.secondary},searchIcon:{width:Po().Ev.sm,height:Po().Ev.sm,fill:e.icon.secondary,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(260488).su({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(250484).Ay.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,G.jsxs)(ln().p,{style:i.button,onClick:l,children:[(0,MS().u)(i.searchIcon),(0,G.jsx)(vt().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const jh=n.memo(Th);const _h=(0,vt().YK)({feedbackButtonTooltip:{defaultMessage:"Share feedback on using Posts",id:"collectionViewBlock.action.postsFeedback.tooltip"}});function Bh(e){const{theme:t}=e,r=(0,a().v3)(),{isMobile:i}=(0,a().Y0)(),l=(0,H().X)("db_ux_chrome"),s=Tt().A.formatMessage(_h.feedbackButtonTooltip),c=(0,n.useCallback)((()=>s),[s]);return(0,G.jsx)(Ft().A,{renderTooltip:c,render:e=>(0,G.jsx)(ln().p,{...e,ariaLabel:s,iconLeading:o(173019).r,isGray:!0,onClick:()=>{o(755636).f({environment:r,url:"https://notion.notion.site/1caefdeead058012a151c3f764a4135b"})},style:(0,VS().i)({theme:t,isInHomeWidget:!0,isFeedbackButton:!0,isMobile:i,isDBUXChromeEnabled:l}).button,children:(0,G.jsx)(vt().sA,{defaultMessage:"Feedback",id:"TeamHome.feedback.label"})})})}const Ph=new(ge().O2)("MinimizableCollectionViewBlockHeaderActions",(async()=>await o.e(94516).then(o.bind(o,538900)))),Mh=(0,ge()._h)(Ph,(e=>e.MinimizableCollectionViewBlockHeaderActions)),Fh=n.memo((function(e){const{allowedActions:t,collectionContextStore:r,createFilterSettingsStore:i,createSortSettingsStore:s,phoneFilterSortSettingsStore:c,createFollowSettingsStore:d,currentViewType:m,handleAddItemClick:S,headerSizeObserver:h,isFullScreen:f,isInHomeWidget:y,isPlaceholderExternalCollection:v,minimizedActionViewStore:x,settingsHeaderSizeObserver:b,showHoverActionsStore:C,store:w,timelineViewRef:k,containerStyleOverrides:R}=e,A=(0,a().v3)(),{isPhone:I,isMobile:T,isMobileNative:j}=(0,a().Y0)(),_=(0,H().X)("db_ux_chrome"),B=(0,H().X)("db_ux_empty_states"),P=(0,H().X)("db_ux_phone_remove_bar"),M=(0,H().X)("download_for_offline"),F=(0,u().K8)((()=>(0,o(578136).D)({isMobileNative:j})),[j]),V=(0,IS().WA)(),L=(0,p().DP)(),D=(0,o(792485).S)(),z=(0,u().K8)((()=>r.collectionViewStore()),[r]),K=(0,u().K8)((()=>"view"===o(411671).A.getMode(A,w).permission),[A,w]),W=(0,u().K8)((()=>(0,Io().w6)(A)),[A]),N=(0,u().K8)((()=>({blockId:jS().A.getCurrentStepBlockId(),subStep:jS().A.getCurrentStepSubStep()??""})),[]),$=(0,u().K8)((()=>{const e=D&&D.publicEditModeStore.state.hasPublicPermission;return!(!jS().A.isActiveDemo()||!e)&&(!T&&N.blockId===w.id)}),[N.blockId,T,D,w.id]),U=(0,u().O$)(r.wasCreatedThisSessionStore),X=(0,u().K8)((()=>{const e=r.resultSetStore.state;return((null==e?void 0:e.blockIds.size)??0)<3}),[r.resultSetStore]),q=(0,u().O$)(r.normalizedSchemaStore),[Y,Q]=(0,n.useState)(!1);(0,n.useEffect)((()=>{U&&X&&Object.keys(q).length<=1||Q(!0)}),[Y,U,X,q]);const Z=(0,u().K8)((()=>(void 0!==r.collectionStore()||"collectionTypedView"===r.contextType)&&!v&&b.rect.state.width>=Fe().xO),[r,v,b]),J=(0,u().K8)((()=>!!$||C.state),[$,C]),ee=(0,u().K8)((()=>{const e=h.rect.state;return!T&&e.width>0&&e.width<400}),[T,h.rect]),{isUnlisted:te,isUnlistedFromSemanticQuery:oe}=(0,u().K8)((()=>{const e=null==z?void 0:z.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[z]),ne=(0,u().K8)((()=>{if(ee||f||I||te||!w.canEditCollection())return null;const e=b.rect.state.width<=Fe().xO;return(0,G.jsx)(o(99600).A,{store:w,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[f,I,te,b.rect,ee,w]),re=(0,u().K8)((()=>{const e=b.rect.state.width<=Fe().xO;return(0,G.jsx)(E().GL,{store:w,collectionContextStore:r,v2:!0,hideText:e})}),[b.rect,w,r]),ie=(0,u().K8)((()=>{var e,o;if(!t||t.includes("noDate"))return"timeline"===m?null===(e=r.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===m?null===(o=r.normalizedQueryStore.state)||void 0===o?void 0:o.calendar_by:void 0}),[t,r.normalizedQueryStore,m]),le=(0,u().uB)(void 0,g().Store),se=(0,n.useMemo)((()=>{if(ie)return{type:"aggregation",aggregation:{property:ie,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[ie]),ae=(0,u().K8)((()=>{if(se){const e=le.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[se,le]),ce=(0,u().K8)((()=>{if(!ie||!ae||!Z||ee||"calendar"!==m&&"timeline"!==m)return null;const e=r.permissionScopesStore.state,t=r.collectionStore();return"collectionTypedView"===r.contextType||t&&e.canEditContent?(0,G.jsx)(Sh,{noDateTotal:ae,noDateProperty:ie,collectionViewType:m,timelineViewRef:k}):null}),[r,m,ie,ae,Z,ee,k]),de=(0,n.useMemo)((()=>I&&P?(0,G.jsx)(bh,{phoneFilterSortSettingsStore:c}):null),[c,P,I]),ue=(0,n.useMemo)((()=>B&&!Y||!Z||"page"===m||"form_editor"===m||t&&!t.includes("filter")?null:$&&"filter"===N.subStep?(0,G.jsx)(_S().F,{subStep:"filter",step:"demo_collection",children:(0,G.jsx)(US,{createFilterSettingsStore:i})}):(0,G.jsx)(US,{createFilterSettingsStore:i})),[B,Y,Z,m,t,$,N.subStep,i]),pe=(0,u().K8)((()=>{if(B&&!Y)return null;if(!Z||"page"===m||"form_editor"===m||t&&!t.includes("sort"))return null;if("chart"===m){var e,o;const t=null===(e=r.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==t?void 0:t.type)||"results-advanced"!==(null==t||null===(o=t.chartFormat)||void 0===o?void 0:o.mainSort))return null}return $&&"sort"===N.subStep?(0,G.jsx)(_S().F,{subStep:"sort",step:"demo_collection",children:(0,G.jsx)(Ih,{createSortSettingsStore:s})}):(0,G.jsx)(Ih,{createSortSettingsStore:s})}),[B,Y,Z,m,t,$,N.subStep,s,r]),ge=(0,u().K8)((()=>B&&!Y||!Z||"chart"===m||"page"===m||v||!(0,TS().aS)(r)||K||t&&!t.includes("automations")?null:$&&"automations"===N.subStep?(0,G.jsx)(_S().F,{subStep:"automations",step:"demo_collection",children:(0,G.jsx)(NS,{})}):(0,G.jsx)(NS,{})),[B,Y,Z,m,v,r,K,t,$,N.subStep]),me=(0,u().K8)((()=>I&&r.searchOpenStore.state&&P),[I,r,P]),Se=(0,u().K8)((()=>I&&P?(0,G.jsx)(DS,{collectionContextStore:r,isInHomeWidget:Boolean(y)}):null),[P,I,r,y]),he=(0,u().K8)((()=>I&&P?(0,G.jsx)(Bt().A,{visible:me,animate:{opacity:1,translateX:0},initial:{opacity:0,translateX:-50},exit:{opacity:0,translateX:-50},style:{position:"absolute",left:0},children:(0,G.jsx)(ES,{collectionContextStore:r,isFullScreen:Boolean(f),currentViewType:m,isSearchOpen:me})}):null),[P,I,r,me,f,m]),fe=(0,u().K8)((()=>{return B&&!Y||!Z||"form_editor"===m||"chart"===m||ee||t&&!t.includes("search")||v?null:"page"===m?null!==(e=r.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,G.jsx)(jh,{}):null:(0,G.jsx)(OS,{collectionContextStore:r,isFullScreen:Boolean(f),currentViewType:m,isInHomeWidget:Boolean(y)});var e}),[B,Y,Z,m,ee,t,v,r,f,y]),ye=(0,u().K8)((()=>{var e;return!Z||t&&!t.includes("ai")||v||null!=r&&null!==(e=r.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,G.jsx)(AS().LazyAssistantCollectionViewButton,{collectionContextStore:r})}),[r,v,Z,t]),ve=(0,n.useMemo)((()=>I&&P||f||K||t&&!t.includes("fullScreen")?null:(0,G.jsx)(JS,{store:w,viewType:m})),[f,w,m,t,K,P,I]);(0,n.useEffect)((()=>{!r.permissionScopesStore.state.canConfigureBlock||"collectionTypedView"===r.contextType||r.isLoadingStore.state||r.isEmptyStore.state||(0,o(299487).HH)(A,"feed_view_onboarding_tooltip")}),[A,r]);const xe=(0,u().K8)((()=>{if(K||t&&!t.includes("viewSettings")||v)return null;if($&&"settings"===N.subStep)return(0,G.jsx)(_S().F,{subStep:"settings",step:"demo_collection",children:(0,G.jsx)(Um().XA,{collectionContextStore:r,settingsHeaderSizeObserver:b,buttonAndIconStyle:(0,VS().i)({theme:L,isInHomeWidget:Boolean(y),isMobile:T,isDBUXChromeEnabled:_})})});return o(131448).default.isVisible("feed_view_onboarding_tooltip")?(0,G.jsx)(Um().kU,{collectionContextStore:r,children:(0,G.jsx)("div",{style:{position:"relative"},children:(0,G.jsx)(Um().XA,{collectionContextStore:r,settingsHeaderSizeObserver:b,buttonAndIconStyle:(0,VS().i)({theme:L,isInHomeWidget:Boolean(y),isMobile:T,isDBUXChromeEnabled:_})})})}):(0,G.jsx)("div",{style:{position:"relative"},children:(0,G.jsx)(Um().XA,{collectionContextStore:r,settingsHeaderSizeObserver:b,buttonAndIconStyle:(0,VS().i)({theme:L,isInHomeWidget:Boolean(y),isMobile:T,isDBUXChromeEnabled:_})})})}),[r,y,v,b,L,t,$,N,K,T,_]),be=(0,u().K8)((()=>!W&&Z&&null!=t&&t.includes("saveOrOpenOverflow")?(0,G.jsx)(Um().fV,{collectionContextStore:r,shouldHideSaveViewOption:oe}):null),[Z,t,r,oe,W]),Ce=(0,u().K8)((()=>"page"===m||"form_editor"===m||v||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||t&&!t.includes("addItem")?null:(0,G.jsx)(Ch,{store:w,settingsHeaderSizeObserver:b,handleAddItemClick:S})),[m,v,r,t,w,b,S]),we=(0,u().K8)((()=>{var e;return(null===(e=w.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[w]),ke=(0,n.useMemo)((()=>"form_editor"!==m||t&&!t.includes("formActionButtons")||we?null:(0,G.jsx)(o(171559).Pe,{showCompactDesktopHeader:ee,collectionContextStore:r})),[m,t,ee,r,we]),Re=(0,u().K8)((()=>null!=t&&t.includes("closeCollectionViewInModal")&&r.isUnlistedViewStore.state?(0,G.jsx)(Um().YL,{}):null),[t,r]),Ae=(0,u().K8)((()=>{const e=r.collectionViewStore(),t=r.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[r]),Ie=(0,n.useCallback)((e=>{(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),Te=(0,u().O$)(qe().e),je=(0,n.useMemo)((()=>Te||!M?null:(0,G.jsx)(vh,{})),[Te,M]),_e=(0,n.useMemo)((()=>"feed"===m&&F&&V?(0,G.jsx)(Bh,{theme:L}):null),[m,L,V,F]),Be=(0,u().K8)((()=>r.databaseType),[r]),Pe=(0,IS().Vs)(),Me=(0,u().K8)((()=>{var e;return(null===(e=r.collectionStore())||void 0===e?void 0:e.isUserAllowedToFollow())??!1}),[r]),Ve=(0,n.useMemo)((()=>B&&!Y?null:Z&&"feed"===m&&F?Be||Pe&&!Me?null:(0,G.jsx)(QS,{createFollowSettingsStore:d}):null),[m,d,F,B,Y,Z,Be,Pe,Me]),Le=(0,H().X)("content_reskin_v2"),Oe=(0,p().IS)((()=>({container:{..._?{height:"100%",flexGrow:1}:{},...Le?{paddingRight:O().dE.paddingRight}:{},...R},phoneSearchInputContainer:{position:"relative",display:"flex",alignItems:"center",overflow:"hidden"},phoneInputButtons:{display:"flex",alignItems:"center",pointerEvents:me?"none":"auto"}})),[_,Le,R,me]);if(I)return(0,G.jsxs)(Bt().A,{visible:J,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)(PS,{}),je,Ae&&(0,G.jsx)(Cu,{type:"linkedView"}),ve,Se,(0,G.jsxs)("div",{style:Oe.phoneSearchInputContainer,children:[(0,G.jsxs)(Bt().A,{animate:{opacity:me?0:1},style:Oe.phoneInputButtons,children:[de,xe,Ce,ke,be]}),he]})]});const Ee=(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(PS,{}),_e,je,Ae&&(0,G.jsx)(Cu,{type:"linkedView"}),ne,re,se&&(0,G.jsx)(In().A,{id:"no_date_count",collectionContextStore:r,reducer:se,resultStore:le}),ce,Ve,ue,pe,ge,ye,fe,ve,xe,be,Ce,ke,Re]});return(0,G.jsx)("div",{style:Oe.container,children:_&&!T?(0,G.jsx)(Mh,{settingsHeaderSizeObserver:b,isFullScreen:f,collectionContextStore:r,viewSettingsButton:xe,minimizedActionViewStore:x,children:Ee}):(0,G.jsx)(Bt().A,{visible:J,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},onMouseDown:Ie,children:Ee})})}));var Vh=function(e){return e[e.TabBar=0]="TabBar",e[e.Source=1]="Source",e[e.None=2]="None",e}(Vh||{});function Lh(e){const{currentViewType:t,store:o,isFullScreen:r,hideViewTabBar:i,collectionViewHeaderText:s,headerActionsBehavior:c,allowedActions:d,isInHomeWidget:m,isMyTasksPage:S,isHomeCustomDbPage:h,showHoverActionsStore:y,headerSizeObserver:v,isPlaceholderExternalCollection:x,handleEditorMouseDown:b,handleHeaderMouseMove:w,handleHeaderMouseLeave:k,handleHeaderMount:R,handleSettingsHeaderMount:A,leftRightPaddingStore:I,headerHeightStore:T,canEdit:j,contentSizeObserver:_,settingsHeaderSizeObserver:B,viewSettingsPlacementStore:P,showOnlyCurrentView:M,switchViewMetric:F,handleAddItemClick:L,timelineViewRef:O,createFilterSettingsStore:E,filterBarCreateFilterSettingsStore:D,headerWrapStyle:z,headerRef:K,headerStyleOverrides:W,minimizedActionViewStore:$,createFollowSettingsStore:U}=e,X=(0,H().X)("db_ux_chrome"),q=(0,a().v3)(),{isPhone:Y}=(0,a().Y0)(),Q=(0,se().ET)(),Z=(0,Re().Zp)(),J=(0,u().K8)((()=>Q.collectionStore()),[Q]),ee=(0,u().uB)(void 0,g().Store),te=(0,n.useMemo)((()=>{if(S){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[S]),oe=(0,u().uB)(void 0,g().Store),ne=(0,n.useMemo)((()=>{if(h)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[h]),re=(0,u().uB)(void 0,Ue().A),ie=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),le=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"phoneFilterSortSettingsStore"}));(0,n.useEffect)((()=>{C().d9({environment:q,collectionContextStore:Q})}),[q,Q]);const ae=(0,u().K8)((()=>{const e=Q.viewIsFlushToTopbar();return("timeline"===t||"table"===t)&&e||m||Q.isUnlistedViewStore.state||X}),[Q,t,X,m]),ce=(0,u().K8)((()=>I.state),[I]),de=(0,u().K8)((()=>T.state),[T]),ue=(0,u().K8)((()=>{var e;return null===(e=Q.viewsModuleContextStore)||void 0===e?void 0:e.isInLayoutBuilder()}),[Q.viewsModuleContextStore]),pe=(0,u().K8)((()=>o.isNonEditableState()),[o]),ge=(0,u().K8)((()=>{var e;return X||"viewsMain"===(null===(e=Q.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[Q.viewsModuleContextStore,X]),me=Ce({collectionContextStore:Q,previewContext:Z,isPlaceholderExternalCollection:x}),Se=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(F)F.current={from:e,to:n,metric:He().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=Q.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&Q.isClientModeEnabledStore.setState(!1),"form_editor"===n&&C().os({collectionSettingsStore:Q.settingsStore})}}}),[Q.isClientModeEnabledStore,Q.remoteResultStore,Q.settingsStore,F]),he=(0,u().K8)((()=>{var e;return(null===(e=Q.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[Q]),fe=(0,u().K8)((()=>dS({collectionContextStore:Q,isPlaceholderExternalCollection:x,previewContext:Z,showOnlyCurrentView:M})),[Q,x,Z,M]),ye=(0,n.useMemo)((()=>({showMoreViewsButton:!1,showAddViewButton:fe,addViewButtonAnimatedIn:!0,viewSelectState:"allTabVisible",moreViewsCount:0})),[fe]),ve=(0,n.useCallback)((e=>{(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),xe=(0,n.useMemo)((()=>(0,G.jsx)(rS,{renderState:ye,collectionContextStore:Q,preventRectangularSelection:ve,variant:"default"})),[Q,ve,ye]),be=(0,n.useMemo)((()=>i?Vh.None:X&&!m&&!r&&me&&1===(null==he?void 0:he.length)?Vh.Source:Vh.TabBar),[i,X,null==he?void 0:he.length,r,me,m]),we=(0,u().K8)((()=>Boolean(null==J?void 0:J.isSyncedCollection())),[J]),ke=(0,u().K8)((()=>we&&be===Vh.Source),[we,be]),Ae=(0,p().IS)((e=>{let t;return t=ae?{}:ue?{boxShadow:`0 0.5px 0 ${e.stroke.uiBlueSecondary}`,marginBottom:.5}:{boxShadow:`0 1px 0 ${e.tableDividerColor}`,marginBottom:1},{headerPositioningStyle:{left:null==ce?void 0:ce.paddingLeft,paddingLeft:m?Ge().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:ke?"flex-start":"center",...ke?{}:{height:de},...t,left:null==ce?void 0:ce.paddingLeft,paddingLeft:m?Ge().Fq:void 0,width:"100%",...Y&&X?{gap:10,justifyContent:"space-between"}:{},...W},selectableStyle:{position:"relative"},headerActionsStyle:{...ke&&{marginTop:6}}}}),[de,W,ae,m,ue,null==ce?void 0:ce.paddingLeft,ke,Y,X]),Ie=(0,n.useMemo)((()=>{switch(be){case Vh.TabBar:return(0,G.jsx)(xS,{collectionContextStore:Q,showHoverActionsStore:y,isPlaceholderExternalCollection:x,showOnlyCurrentView:M??!1,onViewClick:Se,disabled:S,variant:ge?"pills":"default"});case Vh.Source:return(0,G.jsx)(N,{store:o,collectionContextStore:Q,isFullScreen:r,showHoverActionsStore:y,canEdit:j,addViewButton:xe});case Vh.None:return null}}),[be,xe,Q,y,x,M,Se,S,ge,o,r,j]),Te=(0,n.useMemo)((()=>"hidden"===c?null:(0,G.jsx)(Fh,{showHoverActionsStore:y,isFullScreen:r,store:o,currentViewType:t,collectionContextStore:Q,isPlaceholderExternalCollection:x,settingsHeaderSizeObserver:B,createFilterSettingsStore:E,createSortSettingsStore:ie,phoneFilterSortSettingsStore:le,createFollowSettingsStore:U,isInHomeWidget:m,handleAddItemClick:L,headerSizeObserver:v,timelineViewRef:O,allowedActions:d,minimizedActionViewStore:$,containerStyleOverrides:Ae.headerActionsStyle})),[c,y,r,o,t,Q,x,B,E,ie,le,U,m,L,v,O,d,$,Ae.headerActionsStyle]);return(0,G.jsxs)(ut().s,{allowSelectionWithin:!0,style:z,onMouseDown:b,onMouseMove:w,onMouseLeave:k,ref:(0,f().Px)(R,K),children:[r&&(0,G.jsx)(eS,{currentViewType:t,headerSizeObserver:v,contentSizeObserver:_,settingsHeaderSizeObserver:B,headerHeightStore:T,viewSettingsPlacementStore:P,store:o,leftRightPaddingStore:I,isInHomeWidget:m,headerRef:K,handleAddItemClick:L}),ce&&(0,G.jsxs)(gt().Ay,{store:o,shouldShowCopyLinkButton:pe,analyticsName:(0,V().LI)(t),style:Ae.selectableStyle,shouldShowHalo:!(r||m||null!=Z&&Z.isPreviewing),children:[(0,G.jsxs)("div",{style:Ae.headerStyle,ref:A,children:[Ie,s,Te]}),te&&(0,G.jsx)(In().A,{id:"tasks_results",collectionContextStore:Q,reducer:te,resultStore:ee}),ne&&(0,G.jsx)(In().A,{id:"custom_db_results",collectionContextStore:Q,reducer:ne,resultStore:oe})]}),(0,G.jsxs)("div",{style:Ae.headerPositioningStyle,dir:"ltr",children:[me&&!X&&(0,G.jsx)(N,{store:o,collectionContextStore:Q,isFullScreen:r,showHoverActionsStore:y,canEdit:j}),(0,G.jsx)(kS,{collectionContextStore:Q}),(0,G.jsx)(Oh,{collectionContextStore:Q,showHoverActionsStore:y,filterBarCreateFilterSettingsStore:D,saveControlMoreActionsButtonPopupStore:re,currentViewType:t,isInHomeWidget:m})]})]})}function Oh(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const s=(0,a().v3)(),c=(0,a().WS)(),d=(0,H().X)("db_ux_phone_remove_bar"),p=(0,u().K8)((()=>(0,Io().J9)(s)),[s]),g=(0,u().O$)(t.filtersBarOpenStore),m=(0,u().O$)(t.shouldShowSourceStore),S=(0,u().O$)(t.completeSprintButtonContextStore),h=m?8:12;return"page"===i||"form_editor"===i||"feed"===i&&(p||c)||l||c&&d?null:g?(0,G.jsx)(sS().N9,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):S?(0,G.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:c?12:8,paddingTop:h},children:[(0,G.jsx)("div",{style:{flex:1}}),(0,G.jsx)(CS().A,{collectionContextStore:t})]}):null}var Eh=()=>o(624919),Dh=()=>o(99895);const zh={formula:{initialResult:"collections_formula_initial_result_duration",mountToFirstResult:"collections_formula_mount_to_first_result"},relation:{initialResult:"collections_relation_initial_result_duration",mountToFirstResult:"collections_relation_mount_to_first_result"},rollup:{initialResult:"collections_rollup_initial_result_duration",mountToFirstResult:"collections_rollup_mount_to_first_result"}};function Kh(){return{formula:(0,H().X)("formulas_enable_clientside_metrics"),relation:(0,H().X)("relation_enable_clientside_metrics"),rollup:(0,H().X)("rollup_enable_clientside_metrics")}}const Hh=Symbol("DONE_WITH_INITIAL_RENDER");function Wh(e){const{collectionContextStore:t}=e,o=function(e){const{collectionContextStore:t,mountedBeforeInitialPageRender:o}=e,r=(0,a().v3)(),i=(0,n.useRef)(new(Dh().G)((()=>({done:!1,didTrackFirstResult:!1,pageIdToStatus:new Map})))),l=Kh();return{trackMount:(0,n.useCallback)((e=>{let{pageId:t,propertyId:o,propertyType:n}=e;if(!l[n])return;const r=i.current;if(r===Hh)return;const s=r.get(o);if(s.done)return;const a=performance.now();s.pageIdToStatus.has(t)||s.pageIdToStatus.set(t,{mountTime:a,gotFirstResult:!1}),(0,x().O9)(s.earliestMountTime)||(s.earliestMountTime=a)}),[l]),trackResult:(0,n.useCallback)((e=>{let{pageId:n,propertyId:a,propertyType:c,endTime:d,context:u}=e;if(!l[c])return;const p=i.current;if(p===Hh)return;const g=p.get(a);if(g.done)return;const{initialResult:m,mountToFirstResult:S}=zh[c],h=g.pageIdToStatus.get(n);if(!h)return void(0,Eh().NK)(`Property result duration performance entry for ${n}/${a} not found`);const f=v().Bj((()=>({...(0,Me().kz)(t),is_navigation:!o,...u})));g.didTrackFirstResult||(g.didTrackFirstResult=!0,(0,x().O9)(g.earliestMountTime)?He().default.measure({metricName:S,startTime:g.earliestMountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:f()}):(0,Eh().NK)(`Missing earliestMountTime for property ${a}`)),h.gotFirstResult||(h.gotFirstResult=!0,He().default.measure({metricName:m,startTime:h.mountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:f()})),s().default.afterNextFlush((()=>{g.didTrackFirstResult&&[...g.pageIdToStatus.values()].every((e=>e.gotFirstResult))&&p.set(a,{done:!0}),[...p.values()].every((e=>e.done))&&(i.current=Hh)}))}),[t,l,r,o])}}(e);return(0,c().w)((()=>{t.propertyResultDurationTracker||(t.propertyResultDurationTracker=o)})),null}function Gh(e){const t=Kh();return n.useMemo((()=>Object.values(t).some((e=>e))),[t])?(0,G.jsx)(Wh,{...e}):null}var Nh=()=>o(116225),$h=()=>o(680091);function Uh(e,t,o,n){return{render_started_at:o.cvbBlockRenderStart,mounted_at:o.cvbBlockRenderMount,items_started_at:o.itemsStart,items_visible:o.itemsVisible,query_request_count:t.queryCollectionRequests.length,query_request_times:t.queryCollectionRequests,collection_reducer_request_count:Object.keys(t.collectionReducerRequests).length,collection_reducer_request_times:Object.values(t.collectionReducerRequests),collection_prefetch_processing_time:$h().X.getProcessingTime(),page_origin_time:(0,He().getPageOriginOrPrewarmedTabAppStartTime)(e),cvb_bundle_timing:Xh(),lazy_render_started_at:n}}function Xh(){const e=Um().H6.CollectionViewBlock.getLoadingMetrics();if(null!=e&&e.resolvedAt&&null!=e&&e.startedAt)return{started_at:e.startedAt,resolved_at:e.resolvedAt,duration_ms:e.resolvedAt-e.startedAt}}var qh=()=>o(736316);class Yh extends g().Store{getInitialState(){return{stage:"NOT_TRACKING"}}}function Qh(e,t,o,r,i,l,c){const d=(0,a().v3)(),p=(0,u().uB)(void 0,Yh),g=(0,n.useRef)(0),m=(0,n.useRef)(t),S=(0,n.useRef)(),h=(0,n.useRef)(void 0),f=(0,n.useRef)(void 0),y=(0,n.useRef)(!0),v=(0,n.useRef)(!1),b=(0,n.useCallback)((()=>{"NOT_TRACKING"===p.state.stage&&(p.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),h.current=performance.now())}),[p]),C=(0,n.useCallback)((e=>{"NOT_TRACKING"===p.state.stage&&(p.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(S.current=e))}),[p]),w=(0,n.useCallback)((()=>{if(null==c||c(),o.current)return;const t=p.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(g.current++,1===g.current){const e=performance.now();s().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===p.state.stage&&p.setState({stage:"SHOULD_TRACK",endTime:e,source:p.state.source})}))}}else"NOT_TRACKING"===t&&y.current&&(y.current=!1,He().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:d,data:Me().ax({environment:d,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:v.current,isPrewarmedTab:(0,Ee().isPrewarmedTabInitialRender)(d),cvbLoadingStateOnInitialRender:i})}))}),[e,o,d,p,i,c]),k=(0,n.useCallback)((()=>{f.current||(f.current=performance.now())}),[]),R=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===p.state.stage&&(v.current=!0,e.isEmptyStore.removeListener(R),w())}),[e.isEmptyStore,w,p]),A=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,Ee().isPrewarmedTabInitialRender)(d),a=o?Qe().A.state.prewarmedTabAppStartTimeOverride:void 0,c=Me().ax({environment:d,collectionContextStore:e,visibleItemsCount:g.current||0,wasInitialRenderEmpty:v.current,isPrewarmedTab:o,cvbLoadingStateOnInitialRender:i}),u=d.RouterStore.state.route,p="page"===u.name&&u.blockId?xe().Ob.lookupViewIds(u.blockId).length:0;if("INITIAL"===t.state.source){var n,s;const i=(0,ze().A)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),u=null===(s=d.prefetchCache)||void 0===s?void 0:s.getPrefetchAnalytic(i),g={cvbBlockRenderStart:m.current,cvbBlockRenderMount:h.current,itemsStart:f.current,itemsVisible:t.state.endTime},S=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:s}=Qe().A.state.subMetricsStore.state,a=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&s&&(l["collections.await_page_chunk_end_to_cvb_start"]=a({startTime:s.endTime,endTime:o}),(0,qh().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:s.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=a({startTime:o,endTime:n}),(0,qh().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=a({startTime:n,endTime:r}),(0,qh().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=a({startTime:r,endTime:i}),(0,qh().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof a?{subMetricsTimes:g,isPrewarmedTab:!0,prewarmedTabNavigationStart:a}:{subMetricsTimes:g,isPrewarmedTab:!1}),y={...c,sub_metrics:S,initial_render_timings:Uh(d,e.timingTracker.finishTracking(),g,null==l?void 0:l.current),includes_page_origin_to_app_start:!0};r&&He().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:d,data:y,shouldSendIfStatsigNotInitialized:!0}),m.current&&(He().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:d,data:y,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==u?void 0:u.type)&&void 0!==u.finished_at&&u.finished_at>m.current&&He().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:m.current,endTime:u.finished_at},{environment:d,data:c}),(y.is_full_screen||1===p)&&Nh().u4({name:"database_visit",args:{database_visit_id:y.database_visit_id}}))}else if("NAVIGATION"===t.state.source){if(S.current){const e={...c,wasm_sqlite_initialized:Qe().A.state.metricDataStore.state.wasm_sqlite_initialized,...et().A.getDatabaseNavigationMetrics(S.current)};He().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:S.current,endTime:t.state.endTime},{environment:d,data:e})}if(m.current){const o={cvbBlockRenderStart:m.current,cvbBlockRenderMount:h.current,itemsStart:f.current,itemsVisible:t.state.endTime},n=Uh(d,e.timingTracker.finishTracking(),o,null==l?void 0:l.current);He().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:d,data:{...c,initial_render_timings:n}}),(c.is_full_screen||1===p)&&Nh().u4({name:"database_visit",args:{database_visit_id:c.database_visit_id}})}}else(0,x().ub)(t.state.source);t.setState({stage:"COMPLETED"}),g.current=0}}),[e,o,d,r,i,l]);return(0,n.useEffect)((()=>(p.addListener(A),()=>{p.removeListener(A)})),[A,p]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(R),()=>{e.isEmptyStore.removeListener(R)})),[e.isEmptyStore,R]),{handleInitialDatabaseRender:b,handleNavigationDatabaseRender:C,handleItemMount:w,handleItemsRenderStart:k}}function Zh(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r,cvbLoadingStateOnInitialRender:i,lazyRenderStartedAtRef:l,trackPendingCollectionItemRender:s}=e,{handleInitialDatabaseRender:a,handleNavigationDatabaseRender:c,handleItemMount:d,handleItemsRenderStart:u}=Qh(t,o,n,r,i,l,s);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:a,handleNavigationDatabaseRender:c,handleItemMount:d,handleItemsRenderStart:u}),null}const Jh=n.memo(n.forwardRef((function(e,t){const{store:O,isFullScreen:E,productUseCase:$,viewsModuleContext:U,overrideViewType:X,headerActionsBehavior:q="default",overridePaddingLeft:Y,overridePaddingRight:Q,fullWidth:Z,headerText:J,hideViewTabBar:ee,headerAllowedActions:te,maxHeight:oe,disabled:ne,forceLocalQueryCollection:re=!1,isUnlistedView:ie,viewId:le,onMount:ae,setCollectionContextStore:ce,showOnlyCurrentView:de,additionalCollectionViewInnerHorizontalPadding:ue,templatePickerMenuListStore:pe,mountedBeforeInitialPageRender:Se,cvbLoadingStateOnInitialRender:he,lazyRenderStartedAtRef:ye,trackPendingCollectionItemRender:ve,editorContentContainerRef:it}=e,lt=(0,p().DP)(),st=(0,a().Y0)(),{isPhone:at}=st,ct=(0,n.useRef)(null),St=(0,a().v3)(),ht=(0,Re().Zp)(),ft=(null==ht?void 0:ht.isPreviewing)??!1,yt=(0,n.useMemo)((()=>new(Xe().A)(St)),[St]),vt=(0,n.useContext)(Ie().R),{didDelayOffscreenRenderRef:xt}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i,trackPendingCollectionItemRender:l}=e;const s=(0,n.useRef)(r),a=(0,n.useRef)(!1),c=(0,u().K8)((()=>o(735372).Ay.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current)return;if(s.current)return;if(c)return s.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?(a.current=!0,null==l||l()):(s.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,c,i,l]),{didDelayOffscreenRenderRef:a}}({collectionContextStore:yt,isFullScreen:E,rootRef:ct,trackPendingCollectionItemRender:ve}),bt=(0,u().uB)(void 0,o(505776).A),Ct=(0,n.useMemo)((()=>new(ot().E)),[]),wt=(0,n.useMemo)((()=>new(ot().E)),[]),kt=(0,n.useMemo)((()=>new(ot().E)),[]),Rt=(0,n.useRef)(null),At=(0,n.useRef)(),It=(0,n.useRef)(null),[Tt]=(0,n.useState)((()=>performance.now())),jt=(0,n.useRef)(new Map),_t=(0,n.useRef)(),Bt=(0,n.useRef)(null);Bt.current||(Bt.current=new dt(yt,St)),(0,n.useEffect)((()=>{yt.previewContextStore.setState(ht)}),[ht,yt]),(0,n.useEffect)((()=>{const e=Bt.current;return async function(){const{createHasSchemaChangedForQueryStore:t}=await be.load();yt.hasSchemaChangedForQueryStore=t(yt),null==e||e.subscribeToSchemaChanges(yt.hasSchemaChangedForQueryStore)}(),()=>{null==e||e.unsubscribeFromSchemaChanges()}}),[Bt,yt]);const Pt=(0,n.useRef)(),Mt=(0,n.useRef)(),[Ft,Vt]=(0,n.useState)(!1),[Lt,Ot]=(0,n.useState)(!1),[Et,Dt]=(0,n.useState)(!1),zt=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),Kt=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"createFollowSettingsStore"})),Ht=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Wt=(0,u().uB)(void 0,g().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Gt=(0,u().uB)(void 0,g().Store.createClass(void 0,{name:"viewSettingsPlacementStore"})),Nt=(0,u().uB)(void 0,Ue().A);(0,o(265793).b)(yt);const $t=(0,n.useCallback)((()=>{var e;return X??(null===(e=yt.collectionViewStore())||void 0===e?void 0:e.getType())}),[X,yt]),Ut=(0,u().r6)((()=>(0,z().cq)(O)),[O]),Xt=(0,u().O$)(Ut),Yt=(0,u().O$)(yt.isInHomeWidgetStore),{isViewModule:Qt}=(0,u().K8)((()=>{const e=yt.viewsModuleContextStore;return{isViewModule:Boolean(e.getViewModuleType())}}),[yt]),Zt=(0,u().K8)((()=>(0,z().RX)(O)),[O]),Jt=(0,Ae().Lc)(),eo="nested"===(null==Jt?void 0:Jt.layout),to=(0,u().r6)((()=>{const e=(0,Ne().Uh)(St)-D().x6;if(Zt&&!E&&!(0,D().Ck)(O,void 0,st)&&e>0&&!Yt)return e/2}),[St,Zt,E,O,st,Yt]),oo=(0,u().O$)(to),no=(0,u().K8)((()=>{var e;return(null===(e=Rt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[Rt]),ro=(0,n.useCallback)((e=>{var t,o;if(yt.isInHomeWidgetStore.state)return;const n=yt.normalizedFormatStore.state,r=null===(t=no.current)||void 0===t?void 0:t.clientWidth;yt.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==Rt||null===(o=Rt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:to.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[yt,no,to]),io=(0,u().K8)((()=>O.isRootOrDirectChild()),[O]),lo=(0,u().K8)((()=>(0,we().dC)(St,O)),[St,O]),so=(0,Ae().Lc)(),ao=Boolean(so),co=(0,u().r6)((()=>{const e=$t(),t=(0,V().l0)({environment:St,store:O,isFullScreen:E,isInFeedView:ao,sizeObserver:Ct,viewType:e,collectionContextStore:yt});return t&&void 0!==Y&&(t.paddingLeft=Y),t&&void 0!==Q&&(t.paddingRight=Q),t&&io&&lo&&(0,D().Ck)(O,void 0,st)&&"page"!==e&&(t.paddingRight+=we().Qb),t}),[$t,St,O,E,Ct,yt,Y,Q,io,lo,st,ao]);(0,u().O$)(co);const uo=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&Dt(!0)}),[Dt]),po=(0,n.useCallback)((()=>{Dt(!1)}),[Dt]),go=(0,n.useCallback)((()=>{Ye().A.state||Vt(!0)}),[Vt]),mo=(0,n.useCallback)((()=>{Vt(!1)}),[Vt]),So=(0,n.useCallback)((()=>{var e,t;if(Yt)return;const o=null===(e=Rt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=yt.frozoneStore.state.scrollerWidth,r=null===(t=Rt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=yt.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=yt.collectionViewStore(),s=yt.normalizedFormatStore.state;yt.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:to.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,s),tryShowHiddenFrozenColumn:!1})))}),[yt,Rt,to,Yt]),ho=(0,n.useCallback)((()=>{var e,t;const o=null===(e=Rt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=co.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==yt.frozoneStore.state.isScrolled&&(yt.frozoneStore.setState({...yt.frozoneStore.state,isScrolled:r}),So())}),[yt,So,co]),fo=(0,n.useRef)(!1);!function(e){let{environment:t,collectionContextStore:o}=e;const r=(0,n.useCallback)((e=>{e.state.online||(0,M().M)(t,o,{src:"initial_load"})}),[t,o]);(0,c().l)((()=>{qe().A.state.online&&qe().A.addListener(r)})),(0,d().X)((()=>{qe().A.removeListener(r)}))}({environment:St,collectionContextStore:yt});const{collectionViewStore:yo,collectionStore:vo}=(0,u().K8)((()=>{var e;const t=yt.collectionViewStore(),n=yt.collectionStore(),r=St.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,s=O.getCollectionViewStores(),a=s.map((e=>e.id)),c=null!==(e=s[0])&&void 0!==e&&e.isDefined()?s[0]:void 0,d=O.id,u=S().K.get({userId:r,key:(0,Le().H6)(d)});let p;const g=e=>!!ie||(!!a.includes(e)||"collectionSettings"===yt.contextType);if(le&&g(le)?p=le:t&&g(t.id)?p=t.id:u&&g(u)?p=u:c&&g(c.id)&&(p=c.id),p){const e=me().pS.createChildStore(O,{table:o(869558).Gy,id:p});if(e.isDefined()){p!==u&&S().K.set({userId:r,key:(0,Le().H6)(d),value:p});const n=null==t?void 0:t.inMemoryRecordCache,s=null==e?void 0:e.inMemoryRecordCache,a=n!==s&&((null==n?void 0:n.name)===j().SJ||(null==s?void 0:s.name)===j().SJ),c=e.getCollectionStore();e&&(!fo.current||p!==i||a||c&&c.id!==l)&&(fo.current=!0,yt.forceLocalQueryCollection=re,(0,o(108014).d)({environment:St,collectionViewBlockStore:O,collectionViewStore:e,collectionStore:c,collectionContextStore:yt,isFullScreen:E??!1,productUseCase:$,isRootChild:O.isRootOrDirectChild(),isInPeekRenderer:Xt,viewsModuleContext:U}))}}return{collectionViewStore:yt.collectionViewStore(),collectionStore:yt.collectionStore()}}),[O,yt,St,E,$,Xt,U,re,ie,le]),{frozenIndex:xo,tableFrozenColumnIndex:bo}=(0,u().K8)((()=>({frozenIndex:yt.frozoneStore.state.frozenIndex,tableFrozenColumnIndex:null==yo?void 0:yo.getTableFrozenColumnIndex(yt.frozoneStore.state.scrollerWidth,yt.normalizedFormatStore.state)})),[yt.frozoneStore,yt.normalizedFormatStore,yo]);(0,n.useEffect)((()=>{void 0===xo&&yo&&ro(yo)}),[yt,yo,xo,ro]);const Co=(0,n.useRef)(!1);(0,n.useEffect)((()=>(Co.current=!0,()=>{Co.current=!1})),[]);const wo=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(wo.current){const e=$t();e&&(i().e.withListenerIgnored((()=>{const t=yt.collectionStore(),o=yt.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,B().u)({environment:St,event:{eventName:"database_visit",eventProperties:{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:O.id,type:e,is_full_screen:E,is_peek:Ut.state,peek_mode:W().default.state.mode,database_visit_id:yt.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n,product_use_case:$}}})})),wo.current=!1)}}),[]);const{value:ko}=(0,ge().fJ)(Te().T.formulas);(0,n.useEffect)((()=>{(0,x().O9)(ko)&&yt.formulasCodeStore.setState(ko)}),[ko,yt.formulasCodeStore]),(0,n.useEffect)((()=>{je(St)}),[St]),(0,n.useEffect)((()=>{i().e.withListenerIgnored((()=>{const e=yt.collectionViewStore();if(e&&"collectionTypedView"===yt.contextType){const t=yt.databaseType,n=$t();t&&n&&(0,o(999202).W)(St,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:O.id,type:n,databaseType:t,is_my_tasks:(0,o(696746).NY)("myTasks")===O.id})}}))}),[]),(0,n.useEffect)((()=>{const e=He().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");He().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:St,getData:()=>({...(0,Me().kz)(yt),is_first_render:wo.current})})})),Mt.current&&i().e.withListenerIgnored((()=>{if(!Mt.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=Mt.current;He().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:St,getData:()=>{const o=(0,Me().kz)(yt),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:yt.isLoadingStore.state,row_count_category:(0,Me().Cu)(n),...l}}}),Mt.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!yt.isLoadedStore.state||!Co.current||yt.wasCreatedThisSessionStore.state||yt.didFireLoadEventsStore.state)return;yt.didFireLoadEventsStore.setState(!0);const e=St.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=yt.isFullScreenStore.state;if(n){var i;const e=null===(i=yt.collectionViewStore())||void 0===i?void 0:i.getType();if(!Qe().A.state.initialRenderCompleted&&Se){var l;o(915086).setInitialRenderCompleted(),r().oh.hackyOffsetParsesCorrectly()||(0,_().v)(St,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,Me().kz)(yt),l=yt.collectionViewStore(),s=null==l?void 0:l.id,a=(0,ze().A)(s);return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:St.RouterStore.state.initialRoute.name,prefetchCache:null===(r=St.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(a))||void 0===r?void 0:r.type,cvb_loading_state:he,wasm_sqlite_initialized:Qe().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(248566).A)(),sub_metrics:Ee().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};He().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:St,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=Um().H6.CollectionViewBlock.getLoadingMetrics();var s,a;if(null!=c&&c.startedAt)He().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:St,data:{did_prefetch:"hit-match"===(null===(s=St.prefetchCache)||void 0===s||null===(s=s.getPrefetchAnalytic((0,ze().A)(null===(a=yt.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===s?void 0:s.type),is_full_screen:n}});null===(l=yt.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=et().A.popTimings(),o=()=>({...(0,Me().kz)(yt),wasm_sqlite_initialized:Qe().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:e,...et().A.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart)});t&&He().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:St,getData:o}),Je().A.state.isMeasuring&&Je().A.update((e=>({...e,isMeasuring:!1}))),null===(c=yt.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u;if(Se)null===(d=yt.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=yt.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender()}};return yt.isLoadedStore.addListener(e),e(),()=>{yt.isLoadedStore.removeListener(e)}}),[yt,St,Se,he]),(0,u().K8)((()=>{for(const t of O.getCollectionViewStores())t.getValue();const e=yt.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[O,yt]),(0,n.useEffect)((()=>{const e=()=>!W().default.isCenterPeekOpen()&&tt().A.state.isVisible,t=()=>{var t;e()&&(null===(t=Bt.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("page_show"))},o=()=>{var t;e()&&(null===(t=Bt.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("exit_peek"))};return tt().A.addListener(t),W().default.addListener(o),()=>{tt().A.removeListener(t),W().default.removeListener(o)}}),[Bt]),(0,n.useEffect)((()=>{const e=e=>{o(778708).bE({environment:St,sprintSettingsContext:e.state})};return yt.sprintSettingsContextStore.addListener(e),()=>{yt.sprintSettingsContextStore.removeListener(e)}}),[yt,St]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=yt.collectionViewBlockStore(),t=yt.collectionViewStore(),o=yt.collectionStore();if(!e||!t||!o)return;await(0,M().M)(St,yt,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return yt.relativeVariablesAreStaleStore.addListener(e),()=>{yt.relativeVariablesAreStaleStore.removeListener(e)}}),[yt,St,re]);const{contextType:Ro,databaseType:Ao,remoteCollectionIds:Io}=(0,u().K8)((()=>({contextType:yt.contextType,databaseType:yt.databaseType,remoteCollectionIds:yt.remoteCollectionIdsStore.state})),[yt]);(0,n.useEffect)((()=>{if(_t.current)return;if("collectionTypedView"!==Ro||!Ao)return;const e=new(mt().C)(St,(0,h().aW)({spaceId:O.getSpaceId(),databaseType:Ao}),((e,t)=>{var o;null===(o=Bt.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:ef(O),isCollectionTypeChange:!0})}));e.subscribe(),_t.current=e;const t=_t.current;return()=>{t.unsubscribe()}}),[yt,St,Bt,O,Ro,Ao]),(0,n.useEffect)((()=>{null==ce||ce(yt)}),[ce,yt]),(0,n.useEffect)((()=>{null==ae||ae($t())}),[]),(0,n.useEffect)((()=>{void 0===bo||Yt||yt.frozoneStore.setState({...yt.frozoneStore.state,frozenIndex:bo})}),[yt.frozoneStore,Yt,bo]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(jt.current.keys()??[]),o=v().R9(t,e),n=v().R9(e,t);for(const i of o){var r;null===(r=jt.current.get(i))||void 0===r||r.unsubscribe(),jt.current.delete(i)}for(const i of n){const e=new(mt().C)(St,(0,h().eG)(i),((e,t)=>{var o;null===(o=Bt.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:ef(O),isCollectionTypeChange:!1})}));e.subscribe(),jt.current.set(i,e)}};if(vo)e([vo.id]);else if("collectionTypedView"===Ro){e(Io??[]);const t=t=>{e(t.state)};return yt.remoteCollectionIdsStore.addListener(t),()=>{yt.remoteCollectionIdsStore.removeListener(t)}}}),[yt.remoteCollectionIdsStore,Bt,vo,Ro,St,Io,O]),(0,n.useEffect)((()=>{const e=jt.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const To=(0,n.useMemo)((()=>({onFocus:uo,onBlur:po,onMouseMove:go,onMouseLeave:mo})),[uo,po,go,mo]);(0,n.useEffect)((()=>{var e;const t=null===(e=Rt.current)||void 0===e?void 0:e.getNode();return t&&(0,Oe().P4)(t,"scroll",ho),()=>{t&&(0,Oe().Ol)(t,"scroll",ho)}}),[ho]),(0,n.useEffect)((()=>()=>{(0,o(436371).u)({collectionContextStore:yt})}),[yt]),(0,n.useEffect)((()=>()=>{Ct.destroy(),wt.destroy(),kt.destroy()}),[Ct,wt,kt]),(0,n.useEffect)((()=>()=>{var e;null==At||null===(e=At.current)||void 0===e||e.disconnect()}),[]),(0,xe().L)({collectionContextStore:yt,isFullScreen:Boolean(E),wasCreatedThisSessionStore:yt.wasCreatedThisSessionStore,environment:St,didDelayOffscreenRenderRef:xt}),(0,n.useEffect)((()=>{var e;const t=null===(e=yt.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=yt.settingsStore;t.external_collection_type&&t.synced_collection_external_url&&Ze().Ay.state.defaultExternalCollectionSetting&&(C().eM({collectionSettingsStore:o,source:Ze().Ay.state.defaultExternalCollectionSetting}),Ze().Ay.setState({...Ze().Ay.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[yt]);const jo=(0,u().r6)((()=>{var e;const t=null==vo?void 0:vo.isSyncedCollection(),o=!0===(null==vo||null===(e=vo.getFormat().sync_state)||void 0===e?void 0:e.syncing);return Boolean(t&&o&&!ke().A.isMobile)}),[vo]);(0,u().O$)(jo),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(449506).callApi({eventName:"getExternalCollectionSyncState",environment:St,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=yt.numberChildrenReceivedStore,i=yt.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(Pt.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(jo){const t=yt.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return jo.addListener(t),()=>{jo.removeListener(t),clearTimeout(Pt.current)}}),[jo,yt,St]);const _o=ne||Boolean(null==ht?void 0:ht.disableAllPointerEvents),Bo=(0,Ke().bx)(O,_o),Po=(0,u().K8)((()=>!!vo&&(0,m().Qu)(vo.getValue())),[vo]),Mo=(0,u().K8)((()=>(0,_e().sj)(O.id)),[O]),Fo=(0,u().K8)((()=>(0,_e().Wu)(O.id)),[O]),Vo=(0,u().K8)((()=>!!Mo&&yt.isEmptyStore.state),[Mo,yt]),Lo=(0,u().K8)((()=>!!Fo&&yt.isEmptyStore.state),[Fo,yt]),Oo=(0,u().K8)((()=>Yt&&Mo&&0===yt.collectionStoresStore.state.length&&yt.isLoadedStore.state),[Yt,Mo,yt]),Eo=(0,u().K8)((()=>Yt&&Fo&&0===yt.collectionStoresStore.state.length&&O.getCollectionViewStores().length<=1),[Yt,Fo,yt,O]),Do=(0,u().r6)((()=>{if(!io||!lo||!(0,D().Ck)(O,void 0,st)||O.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(we().Qb/2)}}),[st,io,lo,O]);(0,u().O$)(Do);const zo=(0,u().r6)((()=>{var e;if(Oo||Eo)return 0;const t="viewsMain"===(null===(e=yt.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return J||"hidden"!==q||!ee?t?Ve().WK:ie||yt.isInHomeWidgetStore.state?Ve().nh:Ve().Lq:0}),[Oo,Eo,yt,J,q,ee,ie]);(0,u().O$)(zo);const Ko=(0,H().X)("db_ux_chrome"),Ho=Ce({collectionContextStore:yt,previewContext:ht,isPlaceholderExternalCollection:Po}),Wo=(0,u().K8)((()=>{var e;return(null===(e=yt.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[yt]),Go=(0,n.useMemo)((()=>{const e=1===(null==Wo?void 0:Wo.length);return Ko&&Ho&&(E||!e)}),[Ko,Ho,Wo,E]),No=(0,u().K8)((()=>{if(Ft||Lt||Et||E)return!0;if("always_show"===q)return!0;if(ke().A.isMobile)return!0;if("form_editor"===$t())return!0;if(yt.settingsStore.state.open)return!0;if(yt.searchOpenStore.state)return!0;if(Wt.state.open)return!0;if(Kt.state.open)return!0;if(zt.state.open)return!0;if(Ht.state.open)return!0;if(yt.filterBarSortSettingsStore.state.open)return!0;if(Array.from(yt.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!Nt.state.open}),[Ft,Lt,Et,E,q,$t,yt,Wt,Kt,zt,Ht,Nt]),$o=(0,u().r6)((()=>!(!Ko||yt.isInHomeWidgetStore.state)||No),[No,Ko,yt]);(0,u().O$)($o);const Uo=(0,u().r6)((()=>yt.collectionActionsMinimizedStore.state&&!E?V().xE.Collapsed:V().xE.Expanded),[yt.collectionActionsMinimizedStore,E]);(0,u().O$)(Uo);const Xo=(0,u().K8)((()=>{const e=$t();return!!e&&(0,Fe().II)({currentViewType:e,isPlaceholderExternalCollection:Po,collectionContextStore:yt,allowedActions:te,settingsHeaderSizeObserver:wt})}),[$t,yt,te,Po,wt]);(0,u().K8)((()=>{Xo&&C().IW({collectionSettingsStore:yt.settingsStore,showAddItemButton:!0})}),[Xo,yt]);const qo=(0,n.useCallback)((e=>{if(!yt.collectionViewBlockStore()||!(0,nt().EF)(St))return;const t=yt.isMultiSourceView;w().Ur({userAction:"CollectionViewBlock.handleAddItemClick",environment:St,collectionContextStore:yt,collectionViewBlockStore:O,shouldCoerce:!0,templateStore:yt.defaultPageTemplateStore.state,useCrdt:!0,showMoveTo:t,peekModeOverride:Yt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,b().X)({environment:St,collectionContextStore:yt,action:"click_topbar_new_item"})}),[yt,St,O,Yt]),Yo=(0,n.useCallback)((e=>{const{target:t}=e;if(!yo||ke().A.isMobile||!(t instanceof HTMLElement))return;const o=$t();o&&0===e.button&&"form_editor"!==o&&(0,l().SQ)({event:e,context:l().y$.EditorMouseDown,callback:()=>{e.preventDefault(),R().jD({environment:St,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===o||"table"===o})}})}),[St,yo,$t]),Qo=(0,n.useCallback)(((e,t)=>{(0,l().SQ)({event:e,context:l().y$.Click,callback:()=>{if(Ut.state||k().Cx(St),"page"===t&&!(0,De().Zm)()){const{clientX:t,clientY:o,target:n}=e;s().default.afterNextFlush((()=>{T().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:St,canUndo:!0,perform:e=>{I().editNearestBlockOrInsertIfAtBottomOfPage(St,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[St,Ut]),Zo=(0,n.useMemo)((()=>v().sg(So,100)),[So]),Jo=(0,n.useCallback)((()=>{Ye().A.state||Ot(!0)}),[Ot]),en=(0,n.useCallback)((()=>{Ot(!1)}),[Ot]),tn=(0,n.useCallback)((e=>{e&&Ct.observe(e)}),[Ct]),on=(0,n.useCallback)((e=>{e&&kt.observe(e)}),[kt]),nn=(0,n.useCallback)((e=>{e&&wt.observe(e)}),[wt]),rn=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(Be().Dkd);Rt.current=n?e:(null==vt?void 0:vt.horizontalScroller)||null;const r=yt.collectionViewStore();ro(r);const i=null===(o=Rt.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(At.current=new ResizeObserver(Zo),At.current.observe(i))}),[yt,Zo,ro,vt]),ln=(0,u().K8)((()=>{if("form_editor"!==$t()&&yt.settingsStore.state.open&&"sidebar"===Gt.state&&!0!==o(184701).b.state.visible)return(0,G.jsx)("div",{style:{...co.state,...Do.state,borderTop:`1px solid ${lt.tableDividerColor}`,height:12}})}),[yt,Do,co,lt,Gt,$t]),sn=(0,u().K8)((()=>{const e=null==vo?void 0:vo.getValue();return Boolean(e&&(0,m().SJ)(e))}),[vo]),an=(0,u().K8)((()=>{var e;const t=$t();if(t)return(0,P().B2)({blockStore:O,isFullScreen:Boolean(E),collectionContextStore:yt})||ao&&"feed"!==t?0:-((null===(e=co.state)||void 0===e?void 0:e.paddingLeft)??0)}),[$t,O,E,co,yt,ao]),[cn,dn,un]=(0,u().K8)((()=>[yt.normalizedSchemaStore.state,yt.normalizedQueryStore.state,yt.normalizedFormatStore.state]),[yt]),pn=(0,u().K8)((()=>{if("collectionTypedView"===yt.contextType)return q;if("collectionSystemView"===yt.contextType){const e=yt.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(737658).TR)(t)?"default":"hidden"}return!vo||vo&&!1===vo.canRead()||!vo.isDefined()?"hidden":q??"default"}),[yt,vo,q]),gn=(0,n.useRef)(null),mn=(0,u().K8)((()=>{var e,t;const o=$t(),n=Zt&&!W().default.isSidePeekOpeningStore.state&&!ie,r=n?E?{paddingLeft:(null==co||null===(e=co.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==co||null===(t=co.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==co?void 0:co.state,i=(0,Ne().Uh)(St),l=(0,D().Ck)(O,void 0,st)||E?i:Math.min(D().x6,i);return{minHeight:zo.state,paddingLeft:null==r?void 0:r.paddingLeft,paddingRight:null==r?void 0:r.paddingRight,width:Z,position:"relative",left:ao&&"feed"!==o?0:-((null==r?void 0:r.paddingLeft)??0),flexShrink:0,...(E||ft||n)&&{position:"sticky",zIndex:86,left:0,width:!Zt||!r||E||ft||ie?void 0:l-r.paddingLeft/2},...O.isNonEditableState()&&{cursor:"default"},...Do.state}}),[Zt,ie,E,co,St,O,st,zo,Z,ft,Do,ao,$t]),Sn=(0,n.useCallback)((e=>{C().Ow({collectionContextStore:yt,collectionSettingsStore:yt.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:vo}]})}),[yt,vo]),{currentViewType:hn,paddingLeft:fn}=(0,u().K8)((()=>{var e;return{currentViewType:$t(),paddingLeft:null===(e=co.state)||void 0===e?void 0:e.paddingLeft}}),[$t,co]);let yn;if(yo&&cn&&dn&&un&&hn)if(eo){const e=O.getSpaceId();yn=Pe().S5({environment:St,textValue:{value:[y().Ey_(O.pointer.id,[["p",O.pointer.id,e]])],spaceId:e},parentStore:O,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!1,emojiType:(0,o(712030).FN)(St),theme:lt,katex:St.KatexStore.getKatex(),formulaValueTypes:[]})}else if(sn)yn=(0,G.jsx)(se().RI,{value:yt,children:(0,G.jsx)(ut().s,{allowSelectionWithin:!0,style:mn,onMouseDown:Yo,onMouseMove:Jo,onMouseLeave:en,onClick:Qo,ref:(0,f().Px)(tn,ct),children:(0,G.jsx)(gt().Ay,{store:O,shouldShowHoverMenu:!0,analyticsName:(0,V().LI)(hn),shouldShowHalo:!E&&!ft&&!Yt,canSelect:!(E||ft||Yt||Qt),children:(0,G.jsx)(o(361873).A,{store:O,style:{width:"auto"},disabled:!1})})})});else if(Eo)yn=(0,G.jsx)(se().RI,{value:yt,children:(0,G.jsx)("div",{ref:ct,...To,style:{display:"contents"},children:(0,G.jsxs)("div",{style:(0,Ge().V$)({isPhone:at,theme:lt}),ref:gn,children:[(0,G.jsx)("div",{style:{position:"relative"},children:(0,G.jsx)(eS,{currentViewType:hn,headerSizeObserver:Ct,contentSizeObserver:kt,settingsHeaderSizeObserver:wt,headerHeightStore:zo,viewSettingsPlacementStore:Gt,store:O,leftRightPaddingStore:co,isInHomeWidget:Yt,placementToOrigin:$e().W.Right,alignmentToOrigin:$e().C.Center,headerRef:gn})}),(0,G.jsx)(We().Ww,{feature:"custom_db",onSetup:Sn})]})})});else{const e=(0,G.jsx)(Xm,{collectionContextStore:yt,store:O,collectionStore:vo,collectionViewStore:yo,currentViewType:hn,isDisabled:_o,isFullScreen:Boolean(E),isInPeek:Xt,isPreviewing:ft,isRootOrDirectChild:io,headerSizeObserver:Ct,timelineViewRef:It,showHoverActionsStore:$o,handleAddItemClick:qo,isPlaceholderExternalCollection:Po,isMyTasksEmpty:Vo,isInFrameWhenSidePeekOpen:Zt,query:dn,schema:cn,format:un,showHomeCustomDbEmptyState:Eo,maxHeight:oe,viewSettingsPlacementStore:Gt,templatePickerMenuListStore:pe,editorContentContainerRef:it,showMyTasksEmptyState:Oo,isInHomeWidget:Yt,isUnlistedView:ie,isHomeCustomDbEmpty:Lo,handleHorizontalScrollerMount:rn,handleEditorMouseDown:Yo,handleEditorClick:Qo,leftRightPaddingStore:co,handleContentMount:on,rootRef:ct,isViewModule:Qt,additionalCollectionViewInnerHorizontalPadding:ue,scrollerLeftPadding:oo,headerHeightStore:zo,fullWidth:Z,contentEditableVoidLeft:an,leftRightMarginStore:Do});yn=(0,G.jsx)(se().RI,{value:yt,children:(0,G.jsx)(o(532564).Z,{value:bt,children:(0,G.jsxs)("div",{ref:ct,...To,style:{display:"contents"},children:[E?void 0:(0,G.jsx)("div",{style:{position:"relative"},children:(0,G.jsx)(eS,{currentViewType:hn,headerSizeObserver:Ct,contentSizeObserver:kt,settingsHeaderSizeObserver:wt,headerHeightStore:zo,viewSettingsPlacementStore:Gt,store:O,leftRightPaddingStore:co,isInHomeWidget:Yt,headerRef:gn,handleAddItemClick:qo})}),(0,G.jsx)(fe,{}),(0,G.jsx)(qt,{isFullScreen:Boolean(E),leftRightPaddingStore:co,leftRightMarginStore:Do,overrideViewType:X}),Go&&(0,G.jsx)(ut().s,{allowSelectionWithin:!0,onMouseDown:Yo,onMouseMove:Jo,onMouseLeave:en,ref:(0,f().Px)(tn,gn),style:{position:"sticky",left:0},children:(0,G.jsx)("div",{style:{marginBottom:6},children:(0,G.jsx)(N,{store:O,collectionContextStore:yt,showHoverActionsStore:$o,isFullScreen:Boolean(E),canEdit:Bo,paddingLeft:fn})})}),(0,G.jsx)(Lh,{currentViewType:hn,store:O,headerWrapStyle:mn,headerActionsBehavior:pn,allowedActions:te,hideViewTabBar:ee??!1,showHoverActionsStore:$o,headerSizeObserver:Ct,isFullScreen:Boolean(E),isInHomeWidget:Yt,isMyTasksPage:Mo,isHomeCustomDbPage:Fo,isPlaceholderExternalCollection:Po,collectionViewHeaderText:J,handleEditorMouseDown:Yo,handleHeaderMouseMove:Jo,handleHeaderMouseLeave:en,handleHeaderMount:tn,handleSettingsHeaderMount:nn,leftRightPaddingStore:co,headerHeightStore:zo,canEdit:Bo,viewSettingsPlacementStore:Gt,contentSizeObserver:kt,settingsHeaderSizeObserver:wt,handleAddItemClick:qo,timelineViewRef:It,filterBarCreateFilterSettingsStore:Ht,createFilterSettingsStore:zt,createFollowSettingsStore:Kt,switchViewMetric:Mt,showOnlyCurrentView:Boolean(de),headerRef:gn,headerStyleOverrides:{...ie&&{paddingLeft:24,paddingRight:24,paddingTop:12}},minimizedActionViewStore:Uo}),"form_editor"===hn?(0,G.jsx)(pt().N,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,wrapperTag:"div",children:e}):e,ln,(0,G.jsx)(rt().DG,{collectionContextStore:yt,paddingLeft:fn}),(0,G.jsx)(Zh,{collectionContextStore:yt,collectionViewBlockRenderStartTime:Tt,didDelayOffscreenRenderRef:xt,mountedBeforeInitialPageRender:Se,cvbLoadingStateOnInitialRender:he,lazyRenderStartedAtRef:ye,trackPendingCollectionItemRender:ve}),(0,G.jsx)(Gh,{collectionContextStore:yt,mountedBeforeInitialPageRender:Boolean(Se)})]})})})}else yn=null;return(0,Ke().NW)(O,t,(0,u().K8)((()=>({renderedType:"collection_view_page"===O.getType()?"collection_view_page":"collection_view",getBlockStore:()=>O,getNode:()=>ct.current,collectionContextStore:yt,resetLeftScrollAfterFlush:()=>{s().default.afterNextFlush((()=>{var e;const t=null===(e=Rt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,K().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){A().IU({environment:e}),s().default.afterNextFlush((()=>{const n=t.collectionStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionStoreIfSingleSource();if(n&&(0,m().Qu)(n.getValue()))C().Ho({collectionSettingsStore:i});else if(l){(0,o(359454).P)({environment:e,collectionContextStore:t});const n=t.collectionViewStore();"form_editor"!==(null==n?void 0:n.getType())&&(C().Ow({collectionContextStore:t,collectionSettingsStore:i}),C().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0}}),"chart"===(null==n?void 0:n.getType())&&t.isCreatingNewChartCollectionStore.setState(!0))}else if(n){const l=null==t?void 0:t.collectionViewStore();l?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,s=l?(0,F().v)(l):void 0,a=V().Mf({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,F().v)(o.id)}).find((e=>{var t;return e.id===(null==s||null===(t=s.viewPointer)||void 0===t?void 0:t.id)}));a&&(0,L().U)({viewToDuplicateStore:a,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),C().Ow({collectionContextStore:t,collectionSettingsStore:i}),C().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,o(424599).M)({environment:e,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i})}else{const e=null==t?void 0:t.collectionViewStore();let o;var s;if(e)o=null===(s=(0,F().v)(e.id))||void 0===s?void 0:s.viewSettingsStack;C().Ow({collectionContextStore:t,collectionSettingsStore:i,initialStack:o})}}))}(St,yt)})),[O,yt,St]),yn)})));function ef(e){var t;return!tt().A.state.isVisible||!(!W().default.isCenterPeekOpen()||null!==(t=W().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const tf=Jh;class of extends n.Component{componentDidCatch(e){throw o(449412).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,G.jsx)(tf,{...t,ref:e})}}const nf=n.forwardRef(((e,t)=>(0,G.jsx)(of,{...e,collectionViewBlockRef:t})))},556048:(e,t,o)=>{o.d(t,{C8:()=>p,Dz:()=>a,GC:()=>m,GL:()=>S,YY:()=>g,dM:()=>d,h9:()=>c,jX:()=>s,oF:()=>u,uj:()=>l});var n=()=>o(645873);const r={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(75134),o.e(68744)]).then(o.bind(o,408453)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(75134),o.e(2686)]).then(o.bind(o,484967)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await o.e(28763).then(o.bind(o,992567)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await o.e(98288).then(o.bind(o,244399)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020))))},i={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([o.e(75134),o.e(92845),o.e(84468),o.e(5605),o.e(48486),o.e(95794),o.e(13677),o.e(56952),o.e(25497),o.e(74562),o.e(27711),o.e(30291),o.e(12913),o.e(28464),o.e(6463),o.e(50569),o.e(93449),o.e(56188)]).then(o.bind(o,604698))))},l=(0,n()._h)(i.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,n()._h)(r.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),a=(0,n()._h)(r.JiraDCAuthModal,(e=>e.default)),c=(0,n()._h)(r.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n()._h)(r.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n()._h)(r.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(r.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),g=(0,n()._h)(r.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),m=(0,n()._h)(r.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),S=(0,n()._h)(r.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,o(340498).xh)("jira",{default:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:20},small:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:16},mini:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:14},large:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:24}})},556148:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>a,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>g,Xw:()=>S,Yg:()=>m,yA:()=>u});o(898992),o(672577),o(581454);var n=()=>o(519839),r=()=>o(38337),i=()=>o(405417),l=()=>o(695625),s=()=>o(236030);let a=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,i().v2)(o[0],e)}function p(e){return(0,n().f5)({collectionContextStore:e})?s().Fh:0}function g(e){let t=e;for(;null!==t&&!t.classList.contains(r().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function m(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},612900:(e,t,o)=>{o.d(t,{u:()=>i});var n=()=>o(645873);const r=new(n().O2)("PulsingWrapper",(async()=>o.e(45248).then(o.bind(o,673962)))),i=(0,n().jQ)(r,(e=>e.PulsingWrapper),{renderLoading:(e,t)=>t.children})},645099:(e,t,o)=>{o.d(t,{LA:()=>w,jJ:()=>k});o(296540);var n=()=>o(484714),r=()=>o(56366),i=()=>o(401497),l=()=>o(584262),s=()=>o(403733),a=()=>o(340498),c=()=>o(959013),d=()=>o(124311),u=()=>o(114641),p=()=>o(857783),g=()=>o(778417),m=()=>o(152077),S=()=>o(186445),h=()=>o(325383),f=()=>o(728611),y=()=>o(704152),v=()=>o(331542),x=()=>o(316369),b=o(474848);const C=30,w=33;function k(e){const{style:t,iconStyle:o,store:w,format:k,collectionContextStore:R,groupsPointer:A,incrementLimitsInRelatedGroups:I,isFullScreen:T}=e,j=(0,n().v3)(),_=(0,r().K8)((()=>R.groupsStore.getGroupState(A)),[R,A]),B=(0,r().K8)((()=>(0,h().Kk)({collectionContextStore:R,groupsPointer:A})),[R,A]),P=(0,r().O$)(R.isInHomeWidgetStore),M=(0,m().lU)(),F="PersonalHome"===M||"TeamHome"===M,V=(0,i().IS)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:C,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,...P?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},icon:{width:a().Ev.sm,height:a().Ev.sm,marginRight:6,fill:e.icon.tertiary,...o},text:{color:e.text.tertiary,width:"100%",fontSize:P?14:void 0},hoveredStyle:{...B?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}}})),[P,t,B,o]),L=(0,r().K8)((()=>w.canEdit()),[w]);return _?P||F?(0,b.jsx)("div",{style:V.homeContainer,children:(0,b.jsx)(y().A,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,r=(0,S().sj)(o.id)?l().y8.PersonalHomeTileTasks:l().y8.PersonalHomeTileCustomDb;p().uK({environment:t,store:o,pageVisitSource:r,openInNew:n})}(e,j,w),onMouseDown:f().tr,style:V.button,children:(0,b.jsx)("div",{style:V.text,children:(0,b.jsx)(c().sA,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,b.jsxs)(y().A,{onClick:e=>function(e,t,o,n,r,i){const l=o.groupsStore.getGroupState(n);if(!l)return;const s=l.reducerResultStore.state;(0,f().kV)(e),g().IU({environment:t}),s&&(0,u().H)({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:l.groupsPointer,incrementLimitsInRelatedGroups:r}});(0,d().K)(t)}(e,j,R,A,I,T),onMouseDown:f().tr,disabled:B,hoveredStyle:V.hoveredStyle,style:V.button,children:[(0,s().g)(V.icon),(0,b.jsx)("div",{style:V.text,children:(0,b.jsx)(c().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),B?(0,b.jsx)("div",{style:V.loadingContainer,children:(0,b.jsx)(v().A,{size:"sm"})}):L&&(0,b.jsx)(x().w,{collectionContextStore:R,format:k})]}):null}},662984:(e,t,o)=>{o.r(t),o.d(t,{arrowExpandDiagonalBottomLeftToTopRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.46 2.46 11.08 11.08",svg:(0,o(474848).jsx)("path",{d:"M8.912 2.463a.625.625 0 1 0 0 1.25h2.491L8.358 6.758a.625.625 0 1 0 .884.884l3.045-3.045v2.49a.625.625 0 1 0 1.25 0v-4a.625.625 0 0 0-.625-.624zM7.64 8.36a.625.625 0 0 0-.885 0l-3.042 3.043V8.912a.625.625 0 1 0-1.25 0v4c0 .345.28.625.625.625h4a.625.625 0 0 0 0-1.25H4.597l3.042-3.043a.625.625 0 0 0 0-.883"})},r=(0,o(340498).wt)("arrowExpandDiagonalBottomLeftToTopRightSmall",n)},701751:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.94 14.91 15.66",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,n.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},i=(0,o(340498).wt)("lockOpen",r)},739135:(e,t,o)=>{o.d(t,{KD:()=>c,gt:()=>d,i9:()=>a,ll:()=>l,tb:()=>s,x$:()=>i});var n=()=>o(541235),r=()=>o(496603);function i(e,t){return l(d(e,t))}function l(e){return void 0!==e&&(e===n().q_||e===n().YD)}function s(e,t){if(l(t))return;const o=n().c$[e],r=o.steps.findIndex((e=>e.id===t));return-1===r?o.steps[0].id:r===o.steps.length-1?n().q_:o.steps[r+1].id}function a(e,t){const o=d(e,t);if(o&&!l(o))return s(t,o)}function c(e,t){const o=d(e,t);if(o)return function(e,t){const o=n().c$[e];var i;if(l(t))return null===(i=(0,r().HV)(o.steps))||void 0===i?void 0:i.id;const s=o.steps.findIndex((e=>e.id===t));return-1!==s&&0!==s?o.steps[s-1].id:void 0}(t,o)}function d(e,t){var o;if(!e)return;const r=((null===(o=e.getSettings())||void 0===o?void 0:o.tutorials)||{})[t];return void 0===r?n().c$[t].steps[0].id:r}},748539:(e,t,o)=>{o.d(t,{f:()=>n});const n=new(o(645873).O2)("pageCovers",(async()=>{const{pageCovers:e}=await o.e(40198).then(o.bind(o,519737));return e}))},777045:(e,t,o)=>{o.d(t,{w:()=>s});o(296540);var n=()=>o(56366),r=()=>o(128914),i=()=>o(959013),l=o(474848);function s(e){const{collectionContextStore:t}=e,o=(0,i().tz)(),s=(0,n().K8)((()=>{var e;return t.databaseType?(0,r().Mw)(o,t.databaseType):(0,r()._o)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,l.jsx)(l.Fragment,{children:s})}},782473:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},812119:(e,t,o)=>{o.d(t,{J:()=>l});o(296540);var n=()=>o(401497),r=()=>o(710149),i=o(474848);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().IS)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().A,{style:l.circleShimmer}),(0,i.jsx)(r().A,{style:l.rowShimmer})]})})}},835755:(e,t,o)=>{o.d(t,{p:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionDescriptionSmall",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 4.667C6.69049 4.667 6.39366 4.54405 6.17481 4.32519C5.95595 4.10634 5.833 3.80951 5.833 3.5C5.833 3.19049 5.95595 2.89366 6.17481 2.67481C6.39366 2.45595 6.69049 2.333 7 2.333C7.30951 2.333 7.60634 2.45595 7.82519 2.67481C8.04405 2.89366 8.167 3.19049 8.167 3.5C8.167 3.80951 8.04405 4.10634 7.82519 4.32519C7.60634 4.54405 7.30951 4.667 7 4.667V4.667ZM8 11C8 11.2652 7.89464 11.5196 7.70711 11.7071C7.51957 11.8946 7.26522 12 7 12C6.73478 12 6.48043 11.8946 6.29289 11.7071C6.10536 11.5196 6 11.2652 6 11V7C6 6.73478 6.10536 6.48043 6.29289 6.29289C6.48043 6.10536 6.73478 6 7 6C7.26522 6 7.51957 6.10536 7.70711 6.29289C7.89464 6.48043 8 6.73478 8 7V11ZM7 0C5.14348 0 3.36301 0.737498 2.05025 2.05025C0.737498 3.36301 0 5.14348 0 7C0 8.85652 0.737498 10.637 2.05025 11.9497C3.36301 13.2625 5.14348 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0V0Z"})})},845094:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(645873);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,901175)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,191294))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},879765:(e,t,o)=>{o.d(t,{$:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"6.12 3.97 6.66 12.06",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M6.308 9.558a.625.625 0 0 0 0 .884l5.4 5.4a.625.625 0 1 0 .884-.884L7.634 10l4.958-4.958a.625.625 0 1 0-.884-.884z"})},r=(0,o(340498).wt)("arrowChevronSingleLeft",n)},920188:(e,t,o)=>{o.d(t,{Ay:()=>d,P6:()=>c,l1:()=>a});o(296540);var n=()=>o(401497),r=()=>o(284371),i=()=>o(704152),l=()=>o(864943),s=o(474848);const a=16;function c(e){const t=(0,n().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,s.jsx)(i().A,{style:t.button,onClick:e.onClick,children:e.children})}const d=function(e){const{title:t,description:i,icon:c,style:d,titleStyle:u,buttonText:p,buttonOnClick:g,buttonIcon:m,secondaryButtonText:S,secondaryButtonOnClick:h}=e,f=(0,o(62856).A)(!0,300,0),y=(0,n().IS)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:a,...d},title:{fontSize:17,fontWeight:r().Wy.medium,color:e.text.tertiary,textAlign:"center",marginBottom:-2,...u},description:{margin:"0 auto",fontSize:14,color:e.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:r().Wy.medium,color:e.text.primary}})),[d,u]);return f?(0,s.jsxs)("div",{style:y.wrapper,children:[c,(0,s.jsx)("div",{style:y.title,children:t}),i?(0,s.jsx)("div",{style:y.description,children:i}):void 0,p?(0,s.jsx)(l().A,{size:"lg",onClick:g,style:y.button,iconLeading:m,children:p}):void 0,S?(0,s.jsx)(l().A,{size:"lg",onClick:h,style:y.button,children:S}):void 0]}):null}},937199:(e,t,o)=>{o.d(t,{LH:()=>i,Op:()=>r,bi:()=>a,sf:()=>s,v$:()=>l});o(16280);var n=o(296540);const r=(0,n.createContext)(null);function i(){const e=(0,n.useContext)(r);if(!e)throw new Error("usePageLayoutEditorContext must be used inside BaseLayoutEditorContext.Provider");return e}function l(){return(0,n.useContext)(r)}r.displayName="BaseLayoutEditorContext";const s=(0,n.createContext)(null);function a(){const e=(0,n.useContext)(s);if(!e)throw new Error("usePageLayoutEditorContext must be used inside PageLayoutEditorContextProvider");return e}s.displayName="PageLayoutEditorContext"},996624:(e,t,o)=>{o.d(t,{a:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("doubleChevronRight",{viewBox:"0 0 16 16",directional:!0,svg:(0,n.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})}}]);