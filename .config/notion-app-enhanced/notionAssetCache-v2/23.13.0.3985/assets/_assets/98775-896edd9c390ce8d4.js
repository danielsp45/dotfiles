"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[98775],{81465:(e,t,a)=>{a.d(t,{z:()=>j});var n=a(296540),o=()=>a(84817),r=()=>a(780054),s=()=>a(807778),d=()=>a(624119),i=()=>a(484714),l=()=>a(852507),u=()=>a(56366),c=()=>a(959013),m=()=>a(252105),p=()=>a(710149),v=()=>a(765957),g=()=>a(506090),A=()=>a(960389),x=()=>a(414402),f=()=>a(471725),h=a(474848);function y(e){const{modalId:t,style:a}=e,n=(0,u().O$)(f().D),o=(0,i().v3)();(0,l().w)((()=>{f().D.setState(!0)}));const r={defaultValues:{billingDetails:(0,u().K8)((()=>{const e=v().default.state.currentUserStore;return{email:null==e?void 0:e.getEmail(),name:null==e?void 0:e.getName()}}),[])},terms:{card:"never"}};return(0,h.jsxs)(A().iy,{title:n?(0,h.jsx)(x().y,{labelOnly:!0}):(0,h.jsx)(c().sA,{id:"subscriptions.checkout.paymentMethod.title",defaultMessage:"Payment method"}),style:a,children:[n?(0,h.jsx)(b,{}):null,(0,h.jsx)(d().PaymentElement,{options:r,onChange:e=>{m().C3(o,{event:e,modal_id:t}),g().A.update((e=>{if(!e.open)return e;const{paymentData:t,...a}=e;return a}))},onReady:()=>f().D.setState(!1)})]})}function b(){return(0,h.jsxs)(o().Y1,{gap:12,children:[(0,h.jsxs)(o().Y1,{direction:"horizontal",gap:12,children:[(0,h.jsx)(p().A,{style:{width:"50%",height:60,borderRadius:6}}),(0,h.jsx)(p().A,{style:{width:"50%",height:60,borderRadius:6}})]}),(0,h.jsx)(x().y,{}),(0,h.jsx)(x().y,{}),(0,h.jsx)(x().y,{}),(0,h.jsx)(x().y,{})]})}var I=()=>a(520071);function C(e){const{customerAddress:t,vatId:a,onChangeFormData:n,errors:r,modalId:s}=e,d=(0,u().O$)(f().D),l=(0,c().tz)(),m=(0,i().v3)();return(0,h.jsxs)(o().Y1,{gap:12,children:[(0,h.jsxs)(o().Y1,{gap:12,direction:"horizontal",children:[(0,h.jsx)(A().uz,{id:"name",value:t.name,errorMessage:null==r?void 0:r.customerAddress,isLoading:d,onChange:e=>{s&&T({environment:m,addressType:"name",addressUpdate:e.target.value,modal_id:s}),n({vatId:a,customerAddress:{...t,name:e.target.value}})},label:l.formatMessage({defaultMessage:"Name",id:"billingDetails.name"}),placeholder:l.formatMessage({defaultMessage:"Ada Lovelace",id:"billingDetails.name.placeholder"})}),(0,h.jsx)(A().uz,{id:"businessName",value:t.businessName,isLoading:d,onChange:e=>{s&&T({environment:m,addressType:"businessName",addressUpdate:e.target.value,modal_id:s}),n({vatId:a,customerAddress:{...t,businessName:e.target.value}})},label:l.formatMessage({defaultMessage:"Business name (optional)",id:"billingDetails.businessName"}),placeholder:l.formatMessage({defaultMessage:"Acme Inc.",id:"billingDetails.businessName.placeholder"})})]}),void 0!==a?(0,h.jsx)(A().uz,{id:"vatId",value:a,isLoading:d,onChange:e=>n({vatId:e.target.value}),label:l.formatMessage({defaultMessage:"VAT/GST number (optional)",id:"billingDetails.vatNumber"}),placeholder:"123456789"}):null]})}const T=(0,a(496603).sg)((e=>{let{environment:t,addressType:a,addressUpdate:n,modal_id:o}=e;m().Jq(t,{addressType:a,addressUpdate:n,modal_id:o})}),1e3);function j(e){let{onChange:t,customerAddress:a,sessionId:d,vatId:i,validationErrors:l,gap:u=14,style:c,children:m}=e;const p=r().A.isMobile,v=(0,s().aD)(),g=(0,n.useMemo)((()=>{if(v)return(0,h.jsx)(I().c,{customerAddress:a,vatId:i,onChange:t,modalId:d});const{name:e,businessName:n}=a;return(0,h.jsx)(C,{customerAddress:{name:e,businessName:n},vatId:i,onChangeFormData:e=>{var n,o;t({customerAddress:{...a,name:(null===(n=e.customerAddress)||void 0===n?void 0:n.name)??"",businessName:(null===(o=e.customerAddress)||void 0===o?void 0:o.businessName)??""},vatId:e.vatId})},errors:l,modalId:d})}),[a,v,t,d,l,i]);return(0,h.jsxs)(o().Y1,{gap:u,padding:p&&v?4:0,style:c,children:[g,(0,h.jsx)(y,{modalId:d}),m]})}},601203:(e,t,a)=>{a.d(t,{Kz:()=>f,Qe:()=>v,dn:()=>g,gM:()=>h,qu:()=>A,sM:()=>x});var n=()=>a(251111),o=()=>a(762433),r=()=>a(643819),s=()=>a(496603),d=()=>a(449506),i=()=>a(780054),l=()=>a(765957),u=()=>a(506090),c=()=>a(134217),m=()=>a(430395),p=()=>a(981046);async function v(e){var t;let{environment:a,billingData:r,lineItems:s,memberCount:i,billingInterval:m,vatId:v,addOn:g,onlyShowAddOn:A,isCheckoutAddressFormExperimentEnabled:x,...f}=e;const h=u().A.state;if(!h.open||!r)return;const y=x,b=y?f.address:(null==r?void 0:r.address)??h.temporaryAddress;if(!(0,n().Z)(b))return;u().A.update((e=>({...e,calculatingTax:!0})));const I=m??h.temporaryBillingInterval??"year",C=g??h.addOnFeature,T=A??h.onlyShowAddOn;if(!(null===(t=l().default.state.currentSpaceStore)||void 0===t?void 0:t.id))return;const{planAmount:j,promoInfo:M,accountBalance:D}=(0,c().TQ)({memberCount:i,promo:y?f.promo:h.appliedPromo,currencyCode:p().A.selectedCurrencyCode,billingData:r,addOnFeature:C,onlyShowAddOn:T,subscriptionTier:h.subscriptionTier,taxAmount:h.taxAmount,calculatingTax:h.calculatingTax,billingInterval:I,coupon:h.coupon}),N=Math.max(0,j-M.amount+D),S=await d().callApi({eventName:"calculateTax",environment:a,data:{address:b,lineItems:s,price:N,vatId:v??(h.vatApplicable?h.temporaryVatCode:void 0),customerId:(0,o().Rz)(r)}});if("failed"===S.type)u().A.update((e=>({...e,taxAmount:void 0,calculatingTax:!1})));else{const e=S.data;e.valid?u().A.update((t=>({...t,taxAmount:e.taxAmount,calculatingTax:!1,taxCalculationError:void 0}))):u().A.update((t=>({...t,taxAmount:void 0,calculatingTax:!1,taxCalculationError:e.error})))}}async function g(e,t,a){var s;const i=m().A.state;if(!i.open||!t)return;const l=i.temporaryAddress;if(!(0,n().Z)(l))return;m().A.update((e=>({...e,calculatingTax:!0})));const u=(null===(s=i.totalUpgradeCost)||void 0===s?void 0:s.amount)||0,c=await d().callApi({eventName:"calculateTax",environment:e,data:{address:l,price:u,vatId:a??(i.vatApplicable?i.temporaryVatCode:void 0),customerId:(0,o().Rz)(t)}});if("failed"===c.type)m().A.update((e=>({...e,taxAmount:void 0,calculatingTax:!1})));else{const e=c.data;e.valid?m().A.update((t=>({...t,taxAmount:r().W.fromValue({amount:e.taxAmount,currencyCode:p().A.selectedCurrencyCode}),calculatingTax:!1,taxCalculationError:void 0}))):m().A.update((t=>({...t,taxAmount:void 0,calculatingTax:!1,taxCalculationError:e.error})))}}async function A(e){const{environment:t,billingData:a,stripeData:r,taxableAmount:s,lineItems:i}=e,{address:l}=null!=a&&a.address?{address:null==a?void 0:a.address}:e,u=(null==r?void 0:r.vatId)??(a?(0,o().t_)(a,"vat"):void 0);if(!l||!(0,n().Z)(l))return;const c=(0,o().Rz)(a),m=await d().callApi({eventName:"calculateTax",environment:t,data:{address:l,price:s.amount,vatId:u,customerId:c,lineItems:i}});if("failed"===m.type)return;const p=m.data;return p.valid?p.taxAmount:void 0}function x(e){let{price:t,quantity:a,promo:n}=e;if(!t)return;if(void 0===t.unitAmount)return;const o=i().A.pricing[t.product];if(!("productId"in o))return;return{amount:t.unitAmount.amount*a-t.getDiscountPerBillingInterval({quantity:a,promo:n}).amount,productId:o.productId}}function f(e){const t=i().A.pricing[e.price.product];if("productId"in t)return{amount:e.price.unitAmount.amount*e.quantity,productId:t.productId}}function h(e){let{line:t,defaultProductId:a=i().A.pricing.plus.productId}=e;const n=(0,s().xu)(t.discount_amounts??[],"amount"),o=t.price?"string"==typeof(r=t.price.product)?r:r.id:a;var r;return{amount:t.amount-n,productId:o}}},704073:(e,t,a)=>{a.d(t,{P:()=>g});var n=a(296540),o=()=>a(2143),r=()=>a(780054),s=()=>a(756279),d=(a(898992),a(354520),()=>a(56366)),i=()=>a(17090);const l=85,u=50,c="#000";function m(e,t,a,n){if(!e)return p(t,a,"bottom");const{clientHeight:o,scrollHeight:r,scrollTop:s}=e;if(r<=o+n)return;let d,i;if(s<r-o-n)i=p(t,a,"bottom");else{i=p(t,a+(100-a)*(n-(r-o-s))/n,"bottom")}if(0===s)d=void 0;else{const e=1-Math.min(s/n,1);d=p(t,Math.max(100*e,a),"top")}return[d,i].filter(Boolean).join(", ")}function p(e,t,a){return`linear-gradient(${"top"===a?"0deg":"180deg"}, ${e} ${t}%, transparent)`}var v=a(474848);function g(e){let{children:t,style:a,type:p,disabled:g}=e;const A=r().A.isMobile,{style:x,onScroll:f,scrollerStore:h}=function(){let{gradientPercentage:e=l,scrollThreshold:t=u}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[a]=(0,n.useState)(new(i().A)),{node:o,clientRect:r}=(0,d().K8)((()=>{var e;return{node:null===(e=a.state.element)||void 0===e?void 0:e.deref(),clientRect:a.state.clientRect}}),[a]),[s,p]=(0,n.useState)(m(o,c,e,t));return(0,n.useEffect)((()=>{p(m(o,c,e,t))}),[e,o,t,r]),{style:{maskImage:s,maskComposite:"intersect"},onScroll:(0,n.useCallback)((()=>{p(m(o,c,e,t))}),[e,o,t]),scrollerStore:a}}();return A||g?(0,v.jsx)(v.Fragment,{children:t}):(0,v.jsx)(o().H,{type:p??s().A.Y,style:{...x,...a},onScroll:f,store:h,children:t})}}}]);