"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[75840],{57145:(e,t,o)=>{var s=o(746518),n=o(179504),i=o(479306),r=o(225397),a=o(435370),l=o(344124),d=o(206469),c=Array,u=n(l("Array","sort"));s({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&i(e);var t=r(this),o=a(c,t);return u(o,e)}}),d("toSorted")},59976:(e,t,o)=>{o.d(t,{b:()=>i});var s=()=>o(645873);const n=new(s().O2)("time-series",(async()=>await Promise.resolve().then(o.bind(o,968526)))),i=(0,s()._h)(n,(e=>e.TimeSeries))},77126:(e,t,o)=>{o.d(t,{j:()=>n});class s extends(()=>o(959180))().A{}const n=new s},119987:(e,t,o)=>{o.d(t,{z:()=>y});var s=o(296540),n=()=>o(484714),i=()=>o(401497),r=()=>o(959013),a=()=>o(284371),l=()=>o(760217),d=()=>o(939740),c=()=>o(8980),u=()=>o(171347),m=()=>o(722872),p=()=>o(737230),g=()=>o(750420),f=o(474848);const y=s.memo((function(e){const{navigableBlockStore:t,inPeekView:u,noTopMargin:y}=e,h=(0,n().v3)(),S=(0,n().Y0)(),b=(0,r().tz)(),A=(0,o(56366).K8)((()=>p().Ay.getTabForNewCommentsSidebar()),[]),j=(0,s.useCallback)((e=>p().Ay.update((t=>({...t,...p().Ay.createUpdateForNewCommentsSidebar(e)})))),[]),C=(0,o(419123).P)({navigableBlockStore:t}),[M,w]=(0,s.useState)(!0);(0,s.useEffect)((()=>{const e=M&&!C.length;w(e),e&&A===p().UL.ForYou&&j(p().UL.Comments)}),[M,A,j,C.length]);const k=(0,s.useCallback)((()=>{o(883497).A.setState({open:!1})}),[]),I=(0,i().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:y?0:o(175947).ek(h.device.isElectronMac),paddingTop:4,width:"100%",background:u?e.popoverBackground:e.contentBackground,paddingRight:8,borderBottom:`1px solid ${e.regularDividerColor}`},label:{fontSize:14,color:e.text.primary,fontWeight:a().Wy.medium,boxShadow:"none"},tabStyle:{padding:"12px 0"},tabBorderStyle:{left:0,right:0}})),[y,h.device.isElectronMac,u]),B=(0,i().IS)((e=>({tabSwitcherButton:{display:"flex",alignItems:"center",gap:4,fontWeight:a().Wy.semibold,borderRadius:6,paddingLeft:6,paddingRight:6,paddingTop:4,paddingBottom:4,marginTop:7,marginBottom:7},titleWrapper:{display:"flex",justifyContent:"center",alignItems:"center"},closeButton:{position:"absolute",right:10,borderRadius:"50%",background:e.tint.primaryHover}})),[]);return S.isPhone?(0,f.jsx)(o(406699).Ay,{bottomSheetInitialState:"half",renderOrigin:e=>(0,f.jsxs)("div",{style:B.titleWrapper,children:[(0,f.jsxs)(o(704152).A,{style:B.tabSwitcherButton,...e,children:[[(0,f.jsx)(v,{count:C.length},"forYou"),(0,f.jsx)(x,{},"comments"),(0,f.jsx)(g().HX,{},"updates"),(0,f.jsx)(g().f2,{},"analytics")][A],(0,f.jsx)(c().I,{icon:o(324254).arrowChevronSingleDownSmallIcon,color:"secondary",size:"sm"})]}),(0,f.jsx)(o(285790).A,{icon:o(297813).xMarkFillIcon,onClick:k,style:B.closeButton,ariaLabel:b.formatMessage({id:"updateSidebar.header.closeLabel",defaultMessage:"Close"})})]}),render:e=>{const t=[{key:p().UL.Comments,render:e=>(0,f.jsx)(l().A,{...e,icon:(0,f.jsx)(c().I,{icon:o(49621).h}),title:(0,f.jsx)(r().sA,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}),action:()=>j(p().UL.Comments)},{key:p().UL.Updates,render:e=>(0,f.jsx)(l().A,{...e,icon:(0,f.jsx)(c().I,{icon:o(202017).n}),title:(0,f.jsx)(r().sA,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}),action:()=>j(p().UL.Updates)}];M||t.unshift({key:p().UL.ForYou,render:e=>(0,f.jsx)(l().A,{...e,icon:(0,f.jsx)(c().I,{icon:o(104077).r}),title:(0,f.jsx)(r().sA,{id:"updateSidebar.header.forYouLabel",defaultMessage:"For You"})}),action:()=>j(p().UL.ForYou)});const s=[{key:0,render:e=>(0,f.jsx)(o(89924).A,{...e}),items:t}];return(0,f.jsx)(o(928600).A,{title:(0,f.jsx)(r().sA,{id:"updateSidebar.header.switchViewLabel",defaultMessage:"Switch view"}),menuType:S.isPhone?m().gu.Modal:m().gu.Popup,children:(0,f.jsx)(d().Ay,{type:d().Oh.Vertical,initialFocus:void 0,onAccept:e.close,sections:s})})},popupType:o(377586).n.BottomSheet}):(0,f.jsx)("div",{style:I.updatesHeaderStyle,className:o(38337).Kbf,children:(0,f.jsx)(o(987017).Ay,{tabs:[(0,f.jsx)(v,{count:C.length},"forYou"),(0,f.jsx)(x,{},"comments"),(0,f.jsx)(g().HX,{},"updates"),(0,f.jsx)(g().f2,{},"analytics")],selectedIndex:A,onChange:j,style:I.label,tabStyle:I.tabStyle,tabBorderStyle:I.tabBorderStyle,idPrefix:g().Oi,hideTabIndexes:M?[0]:void 0})})}));function v(e){const{count:t}=e;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(r().sA,{id:"updateSidebar.header.forYouLabel",defaultMessage:"For You"}),(0,f.jsx)(u().A,{count:t,color:u().g.Red})]})}function x(){return(0,f.jsx)(r().sA,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}},123021:(e,t,o)=>{o.d(t,{O:()=>A});o(898992),o(672577),o(581454);var s=o(296540),n=()=>o(484714),i=()=>o(56366),r=()=>o(401497),a=()=>o(709687),l=()=>o(668725),d=()=>o(284371),c=()=>o(416726),u=()=>o(848259),m=()=>o(452558),p=()=>o(493823),g=()=>o(406699),f=()=>o(928600),y=()=>o(89924),v=()=>o(722872),x=()=>o(553965),h=()=>o(538075),S=()=>o(518773),b=o(474848);function A(e){var t;const{blockStore:o,from:A,buttonPopupStore:j}=e,C=e.moreProminentStyling??!1,M=(0,n().v3)(),w=(0,i().K8)((()=>o.isPageBlock()),[o]),k=(0,i().K8)((()=>o.getFollowSettingsKey()),[o]),I=(0,s.useCallback)((()=>{u().zP({environment:M,pageId:o.pointer.id,isCurrentlyFollowing:(0,S().A)(k).following,from:A})}),[o.pointer.id,M,k,A]),B=(0,i().K8)((()=>h().H8({followSettingsKey:k,environment:M,blockStore:o,from:A})),[k,M,o,A]),T=(0,r().IS)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.text.secondary,padding:C?"4px 10px":4,borderRadius:4,marginRight:C?0:4,fontSize:d().J.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1}})),[C]),F=null===(t=B.find((e=>h().I7({key:e.action.analyticsName,userSelectedKey:k}))))||void 0===t?void 0:t.title;return w?(0,b.jsx)(g().Ay,{popupType:g().z7.Popup,alignmentToOrigin:g().yP.End,placementToOrigin:g().sx.Bottom,sameWidthAsOrigin:C,buttonPopupStore:j,render:e=>(0,b.jsx)(f().A,{menuType:v().gu.Popup,minWidth:290,maxHeight:"50vh",children:(0,b.jsx)(m().A,{context:{blocks:[],environment:M,publicEditMode:void 0},sections:[(0,c().gy)({key:"in-app-notifications-section",render:e=>(0,b.jsx)(y().A,{...e}),actions:B.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})}),renderOrigin:e=>(0,b.jsxs)(p().p,{...(0,x().A)(e,{onClick:I}),style:T.buttonContainer,children:[(0,a().r)(T.bellIcon),F,C?(0,b.jsx)("div",{style:T.spacer}):void 0,(0,l().b)(T.chevronIcon)]})}):null}},128973:(e,t,o)=>{o.d(t,{P:()=>m});o(898992),o(737550),o(296540);var s=()=>o(484714),n=()=>o(56366),i=()=>o(401497),r=()=>o(284371),a=()=>o(94953),l=()=>o(89924),d=()=>o(963589),c=()=>o(372154),u=o(474848);function m(e){const{firstItemId:t,ignoreFirstItemState:o}=e,m=(0,s().Y0)(),p=(0,d().X)("comment_sidebar_for_you"),g=(0,n().K8)((()=>{var e;return!o&&(Boolean(t)&&(null===(e=a().A.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))))}),[t,o]),f=(0,n().K8)((()=>!o&&(c().A.state.open&&c().A.state.discussionIds&&c().A.state.discussionIds.some((e=>e===t)))),[t,o]),y=(0,i().IS)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:r().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:m.isPhone&&p?0:-12}})),[e.location,p,m.isPhone]);return(0,u.jsx)(l().A,{desktopTitleStyle:{...y.basicDesktopTitleStyle,...g?y.hoveredStyle:{},...f?y.pressedStyle:{}},mobileTitleStyle:y.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}},146594:(e,t,o)=>{o.d(t,{H:()=>i});var s=()=>o(645873);const n=new(s().O2)("UpdateSidebarTabInfo",(async()=>await Promise.all([o.e(75134),o.e(93282),o.e(3910),o.e(82122),o.e(21377)]).then(o.bind(o,722143)))),i=(0,s()._h)(n,(e=>e.UpdateSidebarTabInfo))},182034:(e,t,o)=>{o.d(t,{O:()=>u,e:()=>c});o(898992),o(672577);var s=()=>o(908006),n=()=>o(878523),i=()=>o(725614),r=()=>o(892632),a=()=>o(299545),l=()=>o(77126),d=()=>o(489348);function c(e,t){const o=a().dd(t),s=r().xh(o);e.setState({...e.state,files:s})}async function u(e){const{blockStore:t,pageViewBlockStore:o,environment:r}=e;o?o.setState({...o.state,forceDiscussionOpen:!0}):d().A.openNewPageDiscussionInput(t),n().o2(r,{from:"page_comments"}),await s().default.afterNextFlush();const a=l().j.find((e=>e.getBlockStore().id===t.id)),c=null==a?void 0:a.getInputStore();c&&i().setSelectionAtEnd({store:c.state.textStore})}},229907:(e,t,o)=>{o.d(t,{lT:()=>d});o(944114);var s=()=>o(244641),n=()=>o(720665),i=()=>o(416845);const r=7;function a(e){if(void 0===e)return s().c9.utc();const t={zone:"utc"};return"number"==typeof e?s().c9.fromMillis(e,t):s().c9.fromISO(e,t)}function l(e,t){const o=t?a(t):s().c9.utc(),n=a(e??function(e){const{days:t,endDate:o,startDate:n}=e;if(t<=0)throw new(i().yI4)("Days must be greater than 0");const r=o?a(o):s().c9.utc();if(!r.isValid)throw new(i().yI4)(`endDate ${o} is in an invalid format`);const l=n?a(n).toMillis():0,d=r.minus({days:t-1}).toMillis();return Math.max(d,l)}({days:r,endDate:t}));if(!n.isValid)throw new(i().yI4)(`startDate ${e} is in an invalid format`);if(!o.isValid)throw new(i().yI4)(`endDate ${t} is in an invalid format`);if(n>o)throw new(i().yI4)(`startDate ${e} => ${n.toISO()} is after endDate ${t} => ${o.toISO()}`);return{startTimestamp:n.toMillis(),endTimestamp:o.toMillis()}}function d(e,t){const{startTimestamp:o,endTimestamp:s}=l(e,t),i=[];let r=o;for(;r<=s;)i.push(a(r).toISODate()),r+=n().nD;return i}},273321:(e,t,o)=>{o.d(t,{A:()=>B});var s=o(296540),n=()=>o(790748),i=()=>o(56366),r=()=>o(401497),a=()=>o(713998),l=()=>o(797809),d=()=>o(959013),c=()=>o(284371),u=()=>o(710648),m=()=>o(678553),p=()=>o(125565),g=()=>o(862292),f=()=>o(186445),y=()=>o(972435),v=()=>o(480289),x=()=>o(765957),h=()=>o(441467),S=()=>o(848565),b=()=>o(369767),A=()=>o(555776),j=()=>o(116008),C=()=>o(811879),M=()=>o(846583),w=()=>o(640753),k=()=>o(105157),I=o(474848);function B(e){const{environment:t,menuListItemProps:o,shouldShowTopDividerLine:B,shouldShowBottomDividerLine:T,shouldExpandDiscussionWidth:F,noBackgroundColors:D,onMouseEnter:_,onMouseLeave:L,onFocus:P,onBlur:R}=e,E=(0,i().O$)(x().AppStoreMainEditorCurrentBlockStore),O=(0,i().K8)((()=>(0,f()._m)(t)),[t]),U=S().eQ,K=(0,i().K8)((()=>A().A.state.isActivelyComposing),[]),H=(0,i().K8)((()=>A().A.state.isHovered),[]),N=(0,s.useCallback)((()=>{null==_||_()}),[_]),V=(0,s.useCallback)((()=>{null==L||L()}),[L]),W=(0,s.useCallback)((()=>{null==P||P()}),[P]),z=(0,s.useCallback)((()=>{j().A.hasContent()?A().A.resetAllActiveSources():(j().A.reset(),A().A.reset()),null==R||R()}),[R]),$=(0,d().tz)(),Y=(0,s.useRef)(null);(0,n().b)(v().A,(()=>({getNode:()=>Y.current})),[]);const Z=(0,r().IS)((e=>({menuDiscussionItem:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)"},discussionContainer:{paddingTop:t.device.isMobile?4:6,borderTop:!t.device.isMobile&&B?`1px solid ${e.regularDividerColor}`:void 0,borderBottom:!t.device.isMobile&&T?`1px solid ${e.regularDividerColor}`:void 0,transition:"background 300ms ease",background:D?void 0:K?e.focusDiscussionBackground:H?e.hoveredDiscussionBackground:void 0},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:S().FB},avatar:{marginTop:0,marginRight:8,userSelect:"none",WebkitUserSelect:"none"},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none"},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},draftLabel:{margin:"0 6px",flexBasis:140,whiteSpace:"normal",flexGrow:void 0,display:"inline",color:e.text.tertiary},commentAuthorPlaceholder:{marginRight:8,marginTop:2,height:U,width:U,borderRadius:20,flexShrink:0},container:{paddingTop:S().e4,paddingRight:16,paddingBottom:S().Wv,paddingLeft:16},noOverflow:{overflow:"hidden"},commentContext:{display:"flex",width:"100%",marginTop:6,marginBottom:22,fontSize:13,color:e.text.secondary},displayName:{fontWeight:c().Wy.medium,whiteSpace:"normal"},fullWidthFlex:{display:"flex",width:"100%"},smallTopPadding:{marginTop:1}})),[U,t.device.isMobile,H,K,D,T,B]),q=(0,s.useCallback)((async()=>{const e=await g().T.formulas.load();h().i5({environment:t,allowActionsWhileCommenting:!0,formulasModule:e})}),[t]),G=(0,i().K8)((()=>!j().A.state.open||"reaction"===j().A.state.content),[]),X=(0,i().K8)((()=>{var e;return j().A.getBlockStore()??(null===(e=j().A.getClosestBlockStore())||void 0===e?void 0:e.parentBlockStore)}),[]),J=(0,i().K8)((()=>j().A.getPropertyId()),[]),Q=(0,i().K8)((()=>{if(J){var e;const t=null===(e=j().A.getBlockStore())||void 0===e?void 0:e.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const o=t.getSchema();return(0,a()._g)({schema:o,property:J})}}),[J]),ee=(0,i().K8)((()=>(0,l().RX)(y().A.getIntl()).title),[]),te=(0,i().O$)(j().f),oe=(0,i().K8)((()=>null==O?void 0:O.getDisplayName($)),[O,$]),se=(0,i().K8)((()=>null==X?void 0:X.getSpaceId()),[X]),ne=(0,i().K8)((()=>h().Ek({environment:t})),[t]),ie=(0,i().K8)((()=>j().A.getType()),[]),re=(0,i().K8)((()=>null==X?void 0:X.getValue()),[X]);if(G||!ee||!O||!X||!E||!te||!se||!re&&"block"===ie||!ne&&"inline"===ie)return null;const ae="inline"===ie||J,le="block"===ie&&!J?(0,I.jsx)(u().Ay,{blockValue:re,rootStore:X,blockPreviewLocation:"comments_sidebar"}):ae?(0,I.jsx)(u().vY,{value:{value:(null==ne?void 0:ne.context)??[],spaceId:se},propertySchema:ee,labeled:!1,rootStore:X,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}):null;return(0,I.jsx)("div",{style:Z.discussionContainer,ref:Y,onClick:null==o?void 0:o.onClick,onMouseEnter:N,onMouseLeave:V,children:(0,I.jsx)(m().Ay,{allowTextSelection:!0,style:Z.menuDiscussionItem,title:(0,I.jsx)("div",{style:Z.container,children:(0,I.jsxs)("div",{style:Z.comment,children:[(0,I.jsxs)("div",{style:Z.userRow,children:[(0,I.jsx)(C().E,{authorStore:O,avatarSize:U,avatarStyle:Z.avatar,placeholderStyle:Z.commentAuthorPlaceholder}),(0,I.jsxs)("div",{style:Z.noOverflow,children:[(0,I.jsx)("span",{style:Z.displayName,children:oe||(0,I.jsx)("span",{style:Z.placeholder})}),(0,I.jsx)(p().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:Z.draftLabel,children:(0,I.jsx)(d().sA,{defaultMessage:"Draft",id:"DraftCommentInputWithContext.draftLabel"})})]})]}),(0,I.jsxs)("div",{style:Z.commentElementsBelowUserRow,children:[(0,I.jsx)("div",{style:Z.commentContext,children:(0,I.jsxs)("div",{style:Z.fullWidthFlex,children:[(0,I.jsx)(M().T,{}),Q&&(0,I.jsx)(k().A,{propertySchema:Q}),(0,I.jsx)("div",{style:Z.smallTopPadding,children:le})]})}),(0,I.jsx)(w().A,{showAvatar:!1,parentStore:E,blockStore:X,onSubmit:q,discussionInputStore:te,isNewComment:!0,isEditingExistingComment:!1,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:b().DiscussionFormat.Sidebar,canDrop:!0,disableFocusRing:!0,adjustWidthForDraftDiscussions:F,dontMoveCursorToInputEndOnFocus:!0,onBlur:z,onFocus:W},"draft-comment-sidebar")]})]})})})},"draft-comment-discussion-updates")}},297813:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>s,xMarkFillIcon:()=>n});o(296540);const s={viewBox:"0 0 20 20",fittedViewBox:"3.87 3.87 12.26 12.26",svg:(0,o(474848).jsx)("path",{d:"M15.869 5.369A.875.875 0 0 0 14.63 4.13L10 8.763 5.369 4.13A.875.875 0 1 0 4.13 5.37L8.763 10 4.13 14.631a.875.875 0 1 0 1.24 1.239L10 11.237l4.631 4.632a.875.875 0 1 0 1.238-1.238L11.237 10z"})},n=(0,o(340498).wt)("xMarkFill",s)},310830:(e,t,o)=>{o.d(t,{f:()=>ve});var s=()=>o(244641),n=o(296540),i=()=>o(56366),r=()=>o(401497),a=()=>o(959013),l=()=>o(131533),d=()=>o(2143),c=(o(898992),o(823215),o(354520),o(430670),o(581454),o(908872),()=>o(968526)),u=()=>o(662303),m=()=>o(484714),p=()=>o(869190),g=()=>o(604995),f=()=>o(73514),y=()=>o(883234),v=()=>o(535845),x=()=>o(133033),h=()=>o(738418),S=()=>o(846899),b=()=>o(72135),A=()=>o(310442),j=()=>o(824862),C=()=>o(798880),M=()=>o(496603),w=()=>o(821062),k=()=>o(534177),I=()=>o(129546),B=()=>o(449506),T=()=>o(466721),F=()=>o(59976),D=()=>o(777092),_=()=>o(722872),L=()=>o(680026),P=()=>o(299545),R=()=>o(836251),E=()=>o(997583),O=()=>o(962730),U=()=>o(224239),K=()=>o(765957),H=()=>o(630116),N=()=>o(406699),V=()=>o(364280),W=()=>o(331542),z=()=>o(928600),$=()=>o(864943),Y=()=>o(859428),Z=()=>o(256863),q=()=>o(125565),G=()=>o(453697),X=()=>o(733815),J=()=>o(687110),Q=o(474848);const ee=Date.now();function te(e){let{store:t,spaceId:o,isDisabledForWorkspace:s}=e;const[l,d]=(0,n.useState)("last_28_days"),[c,u]=(0,n.useState)({state:s?"disabled-for-workspace":"loading"}),p=(0,m().v3)(),f=(0,r().DP)(),y=(0,i().K8)((()=>{const{currentSpaceStore:e}=K().default.state;return null==e?void 0:e.getName()}),[]),v=(()=>{switch(l){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}})();(0,n.useEffect)((()=>{s||async function(){const e=await B().callApi({eventName:"getPageAnalytics",environment:p,data:{pageId:t.id,spaceId:o,days:v}});if("failed"===e.type)return void u({state:"empty"});const s=e.data.map((e=>{let{ds:t,total_views:o,unique_views:s}=e;return{ds:t,values:{total_views:o,unique_views:s}}}));s.filter((e=>{let{ds:t}=e;return g().C6.isoToUnixMs(t,"UTC")??ee<=ee})).every((e=>{let{values:t}=e;return 0===t.total_views}))?u({state:"empty"}):u({state:"loaded",data:s})}()}),[p,t.id,s,o,v]);const h=(0,r().IS)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}})),[]);return"loading"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(W().A,{legacySize:32})}):"empty"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[y?(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:y}}):(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,Q.jsxs)("a",{href:(0,R().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.text.primary,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(q().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,Q.jsxs)(V().VP,{grow:1,gap:16,children:[(0,Q.jsx)(ne,{store:t,data:c.data,currentFilter:l,onChangeFilter:d}),(0,Q.jsx)(re,{store:t}),(0,Q.jsx)(me,{spaceId:o,store:t})]}),(0,Q.jsxs)("div",{style:{borderTop:`1px solid ${f.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Q.jsx)(N().Ay,{renderOrigin:e=>{let{onClick:t}=e;return(0,Q.jsx)($().A,{size:"lg",onClick:t,iconLeading:S().B,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:p.device.isMobile?N().z7.SlideUp:N().z7.Popup,render:()=>(0,Q.jsx)(z().A,{menuType:_().gu.Popup,width:460,children:(0,Q.jsx)("div",{style:se,children:(0,Q.jsx)(J().PageAnalyticsPageOptOut,{store:t})})})}),(0,Q.jsxs)("a",{href:(0,R().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.text.primary,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(q().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const oe=175,se={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function ne(e){const[t,o]=(0,E().z)(),{blueLayer:s,yellowLayer:i}=(0,c().useTimeSeriesPalette)(),r=(0,n.useMemo)((()=>{if(0===e.data.length)return ee;const t=g().C6.isoToUnixMs(e.data[0].ds,"UTC")??ee;return Math.min(t,ee)}),[e.data]);return(0,Q.jsxs)("div",{children:[(0,Q.jsx)(ie,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,Q.jsx)("div",{ref:t,style:{...se,marginBottom:0},children:(0,Q.jsx)(F().b,{startDate:(0,p().aD)(r,!0),endDate:(0,p().aD)(ee,!0),width:o,height:oe,data:e.data,layers:[{key:"total_views",...s,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...i,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function ie(e){const t=(0,a().tz)(),o=(0,n.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:o}=t;return e+o.total_views}),0)),[e.data]);return(0,Q.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,Q.jsxs)(V().fI,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,Q.jsxs)(V().fI,{gap:4,children:[(0,Q.jsx)(q().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,Q.jsx)(q().A,{isSecondaryColor:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,b().ZV)(o,"number_with_commas",t)}})})]}),(0,Q.jsx)(X().Z,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function re(e){const{store:t}=e,{pageVisitStore:o,presenceStore:s}=(0,i().O$)(K().default),r=(0,m().v3)();(0,n.useEffect)((()=>{T().Ds(r,{blockStore:t,pageVisitStore:o,incremental:!1,limit:T().FD})}),[r,t,o]);const l=(0,i().K8)((()=>(0,L().PZ)({pageVisitStore:o,presenceStore:s})),[o,s]);if(0===l.length)return null;const d=l.map((e=>{let{userId:o,activityTimestampNearestMinuteMs:s,onTrustedDomain:n}=e;return{actorStore:H().LU.createChildStore(t,{id:o,table:C().oo}),timestamp:s,onTrustedDomain:n}}));return(0,Q.jsxs)("div",{style:{...se,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(q().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,Q.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,Q.jsx)(le,{store:t,actorStores:d,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}const ae=5;function le(e){const{store:t,actorStores:o,collapsedLabel:s,expandedLabel:i}=e,[r,a]=(0,n.useState)(!0),l=r?o.slice(0,ae):o;return(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[l.map((e=>{let{actorStore:o,timestamp:s,onTrustedDomain:n}=e;return(0,Q.jsx)(de,{store:t,actorStore:o,timestamp:s,onTrustedDomain:n},o.id)})),o.length>ae&&(0,Q.jsx)("button",{onClick:e=>{e.preventDefault(),a(!r)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,Q.jsxs)(q().A,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[r?s:i,r?(0,y()._)({width:12}):(0,v().B)({width:12})]})},"toggle")]})}function de(e){const{actorStore:t,timestamp:o,onTrustedDomain:s}=e,l=(0,a().tz)(),d=(0,n.useMemo)((()=>{const e=Date.now();return(0,p().v9)(Math.min(o??e,e),u().locale)}),[o]),c=(0,i().K8)((()=>t.getDisplayName(l)),[t,l]),m=(0,r().IS)((e=>({icon:{width:14,height:14,position:"relative",top:1,color:e.text.secondary},tooltip:{marginTop:2}})),[]);return(0,Q.jsxs)(V().fI,{alignItems:"center",justifyContent:"space-between",children:[(0,Q.jsxs)(V().fI,{gap:4,children:[(0,Q.jsx)(ce,{actorStore:t}),(0,Q.jsx)(q().A,{style:{fontWeight:500},children:c})]}),(0,Q.jsx)(q().A,{isSecondaryColor:!0,children:o?(0,Q.jsx)("span",{title:(0,p().W_)(o,"medium_with_time",u().locale),children:d}):d}),s&&(0,Q.jsx)("div",{style:m.tooltip,children:(0,Q.jsx)(Y().A,{renderTooltip:()=>(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.sharedEmailDomainUser.tooltip.message",defaultMessage:"Shared email domain user"}),render:e=>(0,Q.jsx)("div",{...e,style:m.icon,children:(0,h().G)()}),placement:O().W.Bottom})})]})}function ce(e){const{actorStore:t}=e;return t.table===j().GP?(0,Q.jsx)(Z().A,{botStore:t,size:18}):t.table===C().oo?(0,Q.jsx)(G().A,{userStore:t,size:18}):t.table===A().yj?(0,Q.jsx)(G().A,{userStore:void 0,size:18}):void(0,k().HB)(t)}function ue(e){const{environment:t,store:o,spaceId:s}=e,[,,r]=(0,i().$y)(void 0,U().L),[a,l]=(0,n.useState)([]);(0,n.useEffect)((()=>{I().rL(t,{store:r,activityIds:a,spaceId:s,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:o.id})}),[a,r,s,o.id,t]);return(0,i().K8)((()=>{const e=r.state.activityIds;(0,w().A)(a,e)||l(e);const{currentSpaceStore:t}=K().default.state;if(!t)return[];const s=a.map((e=>(0,P().jA)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var o;return M().oE(null===(o=e.edits)||void 0===o?void 0:o.flatMap((e=>{var o;return null===(o=e.authors)||void 0===o?void 0:o.map((o=>({actorStore:(0,D().JQ)({parentStore:t,pointer:o}),timestamp:e.timestamp})))})))}(t,o):[]})),n=M().Ul(s,"timestamp").reverse();return M().hS(n,(e=>e.actorStore.id))}),[a,r,o])}function me(e){const{spaceId:t,store:o}=e,s=ue({environment:(0,m().v3)(),spaceId:t,store:o}),n=(0,i().K8)((()=>{const e=o.getCreatedByPointer(),t=o.getCreatedTime();if(e&&t)return{actorStore:(0,D().JQ)({parentStore:o,pointer:e}),createdTime:t}}),[o]);return(0,Q.jsxs)("div",{style:{...se,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(q().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),n&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,Q.jsx)(q().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,Q.jsx)(de,{store:o,actorStore:n.actorStore,timestamp:n.createdTime})]}),s.length>0&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,Q.jsx)(q().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,Q.jsx)(le,{actorStores:s,store:o,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function pe(e){const t=(0,r().IS)((e=>({column:{display:"flex",flexDirection:"column"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.text.secondary}})),[]);return(0,Q.jsx)("div",{style:{...t.column,gap:24},children:(0,Q.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,f().C)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,Q.jsx)(q().A,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,Q.jsx)(q().A,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}var ge=()=>o(347199),fe=()=>o(737230),ye=()=>o(756279);function ve(e){let{enablePageAnalytics:t}=e;const o=(0,i().O$)(K().AppStoreMainEditorCurrentBlockStore),n=(0,i().K8)((()=>{const e=s().c9.now().minus({years:1}).valueOf();return!!o&&o.getCreatedTime()<e}),[o]),c=(0,i().O$)(K().AppStoreCurrentSpaceStore),u=(0,i().K8)((()=>!(null!=o&&o.canRead())),[o]),m=(0,i().K8)((()=>{var e;const t=null==o?void 0:o.getModel();return o&&null!=t&&t.isCollectionView()?null===(e=o.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[o]),p=(0,i().K8)((()=>Boolean(null==c?void 0:c.getSettings().disable_page_analytics)),[c]),g=(0,r().IS)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.text.secondary,fontSize:14,background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[]),f=(0,i().K8)((()=>fe().Ay.state.updatesSubTab),[]);return u?(0,Q.jsx)(d().H,{type:ye().A.Y,style:g.updatesEmptyStyle,children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,Q.jsx)(a().sA,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don’t have permission to view the updates of this restricted page."})})}):c&&o?(0,Q.jsxs)(d().H,{type:ye().A.Y,ref:e=>{ge().A.UpdateSidebarScroller=e},style:g.updatesNotEmptyStyle,children:[t?(0,Q.jsx)("div",{style:{display:f===fe().VE.Analytics?"block":"none",height:"100%"},children:(0,Q.jsx)(te,{spaceId:c.id,store:o,isDisabledForWorkspace:p})}):void 0,(0,Q.jsx)("div",{style:{display:f===fe().VE.Updates?"block":"none"},children:(0,Q.jsx)(l().A,{collectionId:m,navigableBlockStore:o,spaceId:c.id,source:"updates_sidebar",empty:e=>(0,Q.jsx)(d().H,{type:ye().A.Y,style:g.updatesEmptyStyle,ref:e=>{ge().A.UpdateSidebarScroller=e},children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):n?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},o.id)})]}):null}},344124:(e,t,o)=>{var s=o(444576);e.exports=function(e,t){var o=s[e],n=o&&o.prototype;return n&&n[t]}},516672:(e,t,o)=>{o.d(t,{S:()=>n});o(296540);var s=o(474848);const n=(0,o(340498).wt)("filter",{viewBox:"0 0 16 16",svg:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4C2 3.58579 2.33579 3.25 2.75 3.25H13.25C13.6642 3.25 14 3.58579 14 4C14 4.41421 13.6642 4.75 13.25 4.75H2.75C2.33579 4.75 2 4.41421 2 4Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 8C3.75 7.58579 4.08579 7.25 4.5 7.25H11.5C11.9142 7.25 12.25 7.58579 12.25 8C12.25 8.41421 11.9142 8.75 11.5 8.75H4.5C4.08579 8.75 3.75 8.41421 3.75 8Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12C5.5 11.5858 5.83579 11.25 6.25 11.25H9.75C10.1642 11.25 10.5 11.5858 10.5 12C10.5 12.4142 10.1642 12.75 9.75 12.75H6.25C5.83579 12.75 5.5 12.4142 5.5 12Z"})]})})},569397:(e,t,o)=>{o.d(t,{C:()=>n});o(296540);const s={viewBox:"0 0 16 16",fittedViewBox:"2.12 3.05 11.76 9.9",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M9.372 3.238a.625.625 0 1 0-.884.884l3.253 3.253H2.75a.625.625 0 0 0 0 1.25h8.991l-3.253 3.253a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})},n=(0,o(340498).wt)("arrowStraightRightSmall",s)},687110:(e,t,o)=>{o.r(t),o.d(t,{PageAnalyticsPageOptOut:()=>x,TopbarPageAnalyticsOptOutMenu:()=>v,TopbarPageAnalyticsOptOutMenuStore:()=>y});o(296540);var s=()=>o(484714),n=()=>o(56366),i=()=>o(959013),r=()=>o(72234),a=()=>o(836251),l=()=>o(962730),d=()=>o(377586),c=()=>o(765957),u=()=>o(364280),m=()=>o(897119),p=()=>o(719147),g=()=>o(702723),f=o(474848);const y=o(757695).Store.createValue({isOpen:!1,rect:void 0},{name:"TopbarPageAnalyticsOptOutMenuStore"});function v(){const e=(0,s().v3)(),t=(0,n().K8)((()=>y.state.isOpen),[]),o=(0,n().K8)((()=>y.state.rect),[]),r=(0,n().O$)(c().AppStoreMainEditorCurrentBlockStore);return r?(0,f.jsx)(m().Ay,{popupType:e.device.isMobile?d().n.SlideUp:d().n.Popup,alignmentToOrigin:l().C.Center,open:t,render:()=>(0,f.jsx)("div",{style:{minWidth:360,padding:16},children:(0,f.jsxs)(u().VP,{gap:16,children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,f.jsx)(i().sA,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,f.jsx)(x,{store:r})]})}),originRect:o,onDismiss:()=>y.setState({isOpen:!1,rect:void 0})}):null}function x(e){const t=(0,s().v3)(),o=(0,n().K8)((()=>{const e=c().default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),l=(0,n().K8)((()=>{const t=null==o?void 0:o.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[o,e.store.id]);return(0,f.jsx)(g().A,{type:"dropdown",currentOption:l?"do_not_record":"record",options:[{key:"record",label:(0,f.jsx)(i().sA,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,f.jsx)(i().sA,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don’t record"})}],onSelectOption:o=>{"do_not_record"===o?r().Oy(t,e.store.id):r().F3(t,e.store.id)},isMobile:t.device.isMobile,title:(0,f.jsx)(i().sA,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,f.jsx)(i().sA,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,f.jsx)(p().A,{external:!0,href:(0,a().xS)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},704495:(e,t,o)=>{o.d(t,{F:()=>d});var s=o(296540),n=()=>o(56366),i=()=>o(774733),r=()=>o(94953),a=()=>o(372154),l=o(474848);const d=s.forwardRef((function(e,t){const{currentBlockStore:d,discussionStore:c,showAllRepliesAfterTimestamp:u,focused:m,isLast:p,location:g}=e,f=(0,n().K8)((()=>a().A.state.open&&a().A.state.discussionIds||[]),[]),y=(0,o(484714).v3)();(0,s.useEffect)((()=>{var e;if(m){r().A.setState({source:"update_sidebar",discussionIds:[c.id]});const e=setTimeout((()=>{var e;(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&o(546574).A.markDiscussionsInteractedWith([c.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&r().A.setState({discussionIds:[]})}),[m,c,y]);const v=(0,n().K8)((()=>{var e;return(null===(e=r().A.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),x=c.id,{parentId:h,currentSpaceId:S}=(0,n().K8)((()=>({parentId:c.getParentId(),currentSpaceId:c.getSpaceId()})),[c]),b=h?o(630116).Bv.createChildStore(c,{table:o(179034).ev,id:h}):void 0,A=f.includes(x),j=v.includes(x),C=(0,o(401497).IS)((e=>({discussionContainer:{paddingTop:y.device.isMobile?4:6,borderBottom:p||y.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},hoveredStyle:{background:"sidebar"===g?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===g?e.focusDiscussionBackground:void 0},menuStyle:{marginLeft:-12,marginRight:-12,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})),[y.device.isMobile,p,g]),{value:M}=(0,o(645873).fJ)(i().commentsDependency);if(!M)return null;if(!b||!S)return null;const w=(0,l.jsx)("div",{className:`sidebar-discussion-${x} ${o(38337)._57}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...C.discussionContainer,...j?C.hoveredStyle:{},...A?C.pressedStyle:{}},children:(0,l.jsx)(i().PW,{store:c,blockStore:d,format:M.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:u})});return(0,l.jsx)(o(678553).Ay,{allowTextSelection:!0,title:w,style:C.menuStyle})}))},709687:(e,t,o)=>{o.d(t,{r:()=>n});o(296540);var s=o(474848);const n=(0,o(340498).wt)("bell",{viewBox:"0 0 16 16",svg:(0,s.jsx)("path",{d:"M1.36914 11.7627C1.36914 12.3369 1.80664 12.7266 2.51074 12.7266H5.32031C5.38184 14.0322 6.44824 15.2285 8 15.2285C9.55176 15.2285 10.6182 14.0391 10.6797 12.7266H13.4893C14.2002 12.7266 14.6309 12.3369 14.6309 11.7627C14.6309 11.0381 13.9678 10.416 13.3457 9.81445C12.8672 9.34277 12.751 8.39941 12.6621 7.46289C12.5732 4.87207 11.8213 3.14258 10.0371 2.49316C9.77734 1.59082 9.01855 0.900391 8 0.900391C6.98145 0.900391 6.22266 1.59082 5.96289 2.49316C4.17871 3.14258 3.42676 4.87207 3.33789 7.46289C3.24902 8.39941 3.13965 9.34277 2.6543 9.81445C2.03906 10.416 1.36914 11.0381 1.36914 11.7627ZM3.00293 11.4756V11.3936C3.18066 11.1953 3.57715 10.833 3.91211 10.4434C4.38379 9.90332 4.60254 8.92578 4.6709 7.62695C4.75293 4.85156 5.60059 3.92871 6.70801 3.62793C6.87207 3.58691 6.96777 3.50488 6.98145 3.32031C7.01562 2.62305 7.39844 2.1582 8 2.1582C8.60156 2.1582 8.99121 2.62305 9.01855 3.32031C9.03223 3.50488 9.12793 3.58691 9.29883 3.62793C10.3994 3.92871 11.2539 4.85156 11.3291 7.62695C11.3975 8.92578 11.623 9.90332 12.0879 10.4434C12.4297 10.833 12.8125 11.1953 12.9834 11.3936V11.4756H3.00293ZM6.6123 12.7266H9.3877C9.33984 13.5811 8.7793 14.1348 8 14.1348C7.22754 14.1348 6.66699 13.5811 6.6123 12.7266Z"})})},733815:(e,t,o)=>{o.d(t,{Z:()=>h});o(898992),o(354520),o(581454);var s=o(296540),n=()=>o(401497),i=()=>o(42583),r=()=>o(301608),a=()=>o(56394),l=()=>o(972435),d=()=>o(722872),c=()=>o(962730),u=()=>o(377586),m=()=>o(760217),p=()=>o(928600),g=()=>o(939740),f=()=>o(897119),y=()=>o(89924),v=()=>o(806754),x=o(474848);function h(e){const t=(0,n().IS)((e=>({popup:{width:125,marginLeft:5},pillStyle:{display:"flex",alignItems:"center"}})),[]),{currentFilter:o,hideAllTime:h}=e,[S,b]=(0,s.useState)(!1),A=r().jf.filter((e=>!h||"all_time"!==e)).map((t=>{const o=()=>{e.onChangeFilter(t),b(!1)};return{key:t,action:()=>{},render:()=>(0,x.jsx)(m().A,{focused:!1,onClick:o,title:l().A.formatMessage(r().jy[t])})}})),j=(0,x.jsx)(a().A,{on:Boolean(o),wrapStyle:t.pillStyle,icon:(0,i().D)({width:16,marginRight:6,fill:"currentColor"}),title:l().A.formatMessage(r().jy[o]),onClick:()=>{b(!0)}}),C=[{key:"filters",items:A,render:e=>(0,x.jsx)(y().A,{...e,title:null,loading:!1})}],M=(0,x.jsx)(p().A,{menuType:d().gu.Popup,header:null,children:(0,x.jsx)(g().Ay,{type:g().Oh.Vertical,initialFocus:0,sections:C})});return(0,x.jsx)(v().A,{marginAfter:!1,children:(0,x.jsx)(f().Ay,{popupType:u().n.Popup,placementToOrigin:c().W.Bottom,alignmentToOrigin:c().C.Start,open:S,render:()=>M,onDismiss:()=>b(!1),keepFocus:!0,origin:j,preventScaleTransition:!0,style:t.popup,trapFocus:!0,originGap:8})})}},745591:(e,t,o)=>{o.d(t,{x:()=>T});o(898992),o(672577);var s=o(296540),n=()=>o(908006),i=()=>o(56366),r=()=>o(401497),a=()=>o(764880),l=()=>o(700500),d=o(474848);const c=(0,o(340498).wt)("commentSidebarZero",{viewBox:"0 0 56 56",svg:(0,d.jsx)("path",{d:"M13.1289 47.6641C13.9297 47.6641 14.4961 47.3516 15.4141 46.5508L21.8984 40.5938C23.0703 42.4297 25.1602 43.4258 27.9922 43.4258H36.3516L42.6602 48.8164C43.5195 49.5586 44.0273 49.9492 44.7305 49.9492C45.7461 49.9492 46.332 49.2266 46.332 48.0938V43.4258H47.4453C51.8398 43.4258 54.6328 40.8281 54.6328 36.2969V24.1289C54.6328 19.5977 51.8398 17 47.4453 17H43.9688V14.793C43.9688 9.83203 41.0781 7 36.0977 7H8.87109C4.00781 7 1 9.83203 1 14.793V32.4297C1 37.4102 4.00781 40.2422 8.87109 40.2422H11.4492V45.7695C11.4492 46.9609 12.0742 47.6641 13.1289 47.6641ZM13.7539 39.2461C13.7539 38.3867 13.2266 37.9766 12.543 37.9766H9.08594C5.43359 37.9766 3.42188 36.043 3.42188 32.293V14.9492C3.42188 11.2188 5.45312 9.26562 9.08594 9.26562H35.8828C39.5156 9.26562 41.5469 11.2188 41.5469 14.9492V17H27.9922C23.4414 17 20.8047 19.5977 20.8047 24.1289V36.3164C20.8047 36.9805 20.8438 37.6055 20.9609 38.1719L13.7539 44.9883V39.2461ZM44.0859 47.2148L38.1289 41.9023C37.4844 41.3359 37.0938 41.1602 36.2344 41.1602H28.168C25.0039 41.1602 23.207 39.4805 23.207 36.1797V24.2656C23.207 20.9648 25.0039 19.2656 28.168 19.2656H47.25C50.4336 19.2656 52.2305 20.9648 52.2305 24.2656V36.1602C52.2305 39.4609 50.4336 41.1602 47.25 41.1602H45.2383C44.5938 41.1602 44.0859 41.5312 44.0859 42.3711V47.2148Z"})});var u=()=>o(959013),m=()=>o(534177),p=()=>o(284371),g=()=>o(878523),f=()=>o(620689),y=()=>o(725614),v=()=>o(441467),x=()=>o(116008),h=()=>o(864943),S=()=>o(862292),b=()=>o(449195),A=()=>o(231722),j=()=>o(347199),C=()=>o(792002),M=()=>o(129522),w=()=>o(77126),k=()=>o(489348),I=()=>o(737230),B=()=>o(24157);function T(e){const{environment:t,device:o,navigableBlockStore:a,actorForFilter:T,currentCommentsMode:D,currentCommentsType:_}=e,L=(0,i().K8)((()=>{if(o.isMobile)return!1;if(!t.currentUser.isLoggedIn())return!1;if("suggestions"===_||"resolved"===D)return!1;if(null==a||!a.canComment())return!1;const e=B().default.getRootBlockStoreOfSelection();return!!(e&&"page"!==e.getType()||"section_hide"!==(0,b().Rn)())}),[o.isMobile,_,D,a,t.currentUser]),P=(0,s.useCallback)((async()=>{const e=B().default.getRootBlockStoreOfSelection(),o=e&&"page"!==e.getType()&&!e.isEmptyTitle()?"block":"page";switch(g().Bi(t,{target:o}),o){case"block":f().BM({environment:t,animate:!0}),await n().default.afterNextFlush();const s=await S().T.formulas.load();return void(e&&function(e){const{environment:t,blockStore:o,formulasModule:s}=e,n=o.getModel();if(!o.isDefined()||null==n||!n.isType(l().uP))return;const i=o.getTitleStore(),r=i&&(0,C().s6)(i);if(!(i&&r&&r.endIndex>0))return;(0,v().hN)({environment:t,blockStore:o,multiSelection:(0,A().$U)({store:i,selection:{startIndex:0,endIndex:r.endIndex}}),rect:M().K.getRect(o),from:"updates_sidebar",formulasModule:s})}({environment:t,blockStore:e,formulasModule:s}));case"page":if(await n().default.afterNextFlush(),!1===x().A.state.open&&x().A.setState({open:!1,rect:new DOMRect,from:"updates_sidebar"}),!a)return;return k().A.openNewPageDiscussionInput(a),await n().default.afterNextFlush(),void function(e){const{blockStore:t,environment:o}=e;if(!t)return;const s=w().j.find((e=>e.getBlockStore().id===t.id));if(!s)return;const i=s.getNode(),r=s.getInputStore();if(!i||i.nodeType!==Node.ELEMENT_NODE)return;f().hT({element:i,environment:o,scrollerContext:{verticalScroller:j().A.PageScroller,horizontalScroller:void 0},animate:!0,vertical:{reveal:"closest"},horizontal:void 0}),I().Ay.setState({...I().Ay.state,expanded:!1}),n().default.afterNextFlush((()=>{y().setSelectionAtEnd({store:r.state.textStore})}))}({blockStore:a,environment:t});default:(0,m().HB)(o)}}),[t,a]),R=(0,r().IS)((e=>({commentsEmptyStyle:{flex:1,display:"flex",gap:11,alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",fontSize:14,position:"relative",background:e.contentBackground,marginRight:0,pointerEvents:"auto",paddingTop:10},commentsContainerMessage:{fontWeight:p().Wy.semibold,color:e.text.secondary},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,fill:e.icon.secondary},addCommentButton:{borderRadius:6}})),[]);return(0,d.jsx)("div",{style:R.commentsContentStyle,children:(0,d.jsxs)("div",{style:R.commentsEmptyStyle,children:[c(R.commentsIconStyle),(0,d.jsx)("div",{style:R.commentsContainerMessage,children:(0,d.jsx)(F,{commentsMode:D,commentsType:_,actorForFilter:T})}),L?(0,d.jsx)(h().A,{size:"lg",onClick:P,style:R.addCommentButton,children:(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyCommentsButton",defaultMessage:"Add comment"})}):null]})})}function F(e){let{commentsMode:t,commentsType:o,actorForFilter:s}=e;const n=(0,u().tz)(),r=(0,i().K8)((()=>(0,a().lR)(n,s)),[n,s]);return(0,d.jsx)(d.Fragment,{children:((e,t)=>{if("unresolved"===e){if("commentsAndSuggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestionsForUser",defaultMessage:"No open comments or suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestions",defaultMessage:"No open comments or suggestions"});if("comments"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsForUser",defaultMessage:"No open comments from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedComments",defaultMessage:"No open comments"});if("suggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestionsForUser",defaultMessage:"No open suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestions",defaultMessage:"No open suggestions"})}else{if("commentsAndSuggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestionsForUser",defaultMessage:"No resolved comments or suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestions",defaultMessage:"No resolved comments or suggestions"});if("comments"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsForUser",defaultMessage:"No resolved comments from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedComments",defaultMessage:"No resolved comments"});if("suggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestionsForUser",defaultMessage:"No resolved suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestions",defaultMessage:"No resolved suggestions"})}})(t,o)})}},750420:(e,t,o)=>{o.d(t,{f2:()=>x,Oi:()=>h,HX:()=>v,Ay:()=>S});o(296540);var s=()=>o(484714),n=()=>o(56366),i=()=>o(401497),r=()=>o(175947),a=()=>o(959013),l=()=>o(284371),d=()=>o(987017),c=()=>o(38337),u=()=>o(737230),m=()=>o(217429),p=()=>o(187959);const g=new(o(463830).A);var f=()=>o(577009),y=o(474848);function v(){return(0,y.jsx)(a().sA,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function x(){return(0,y.jsx)(a().sA,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")}const h="UpdateSidebar";function S(e){const t=(0,s().v3)(),{enablePageAnalytics:o,navigableBlockStore:a,inPeekView:S,noTopMargin:b}=e,A=(0,i().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:b?0:r().ek(t.device.isElectronMac),paddingTop:4,width:"100%",background:S?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{...o?{padding:8}:{paddingBottom:14}},label:{fontSize:14,color:e.text.primary,fontWeight:l().Wy.medium,margin:0,padding:0}})),[b,t.device.isElectronMac,S,o]),j=(0,n().K8)((()=>u().Ay.state.updatesSubTab),[]),C=S?g:p().A,M=(0,n().K8)((()=>"on"===m().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]);return(0,y.jsxs)("div",{style:{...A.updatesHeaderStyle,...o?{padding:"0 6px"}:{}},className:c().Kbf,children:[M?void 0:(0,y.jsx)(f().QB,{navigableBlockStore:a,from:"page_updates",buttonPopupStore:C,style:A.getNotifiedFor}),o?(0,y.jsx)(d().Ay,{tabs:[(0,y.jsx)(v,{},"updates"),(0,y.jsx)(x,{},"analytics")],selectedIndex:j,onChange:e.onTabChange,style:{...A.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"},idPrefix:h}):(0,y.jsx)("h2",{style:A.label,children:(0,y.jsx)(v,{})})]})}},831272:(e,t,o)=>{o.d(t,{R:()=>je});o(944114),o(898992),o(354520),o(430670),o(581454),o(737550);var s=o(296540),n=()=>o(484714),i=()=>o(56366),r=()=>o(401497),a=()=>o(869190),l=()=>o(416504),d=()=>o(175947),c=()=>o(959013),u=()=>o(496603),m=()=>o(774733),p=()=>o(789557),g=()=>o(938045),f=()=>o(273321),y=()=>o(369767),v=()=>o(94953),x=()=>o(555776),h=()=>o(116008),S=()=>o(928600),b=()=>o(939740),A=()=>o(480095),j=()=>o(2143),C=()=>o(284371),M=()=>o(38337),w=()=>o(123021),k=(o(672577),()=>o(764880)),I=()=>o(30626),B=()=>o(516672),T=()=>o(835607),F=()=>o(534177),D=()=>o(493823),_=()=>o(760217),L=()=>o(406699),P=()=>o(678553),R=()=>o(8980),E=()=>o(89924),O=()=>o(859428),U=()=>o(457688),K=()=>o(972435),H=()=>o(722872),N=()=>o(869562),V=()=>o(883497),W=()=>o(737230),z=()=>o(962730),$=()=>o(377586),Y=o(474848);const Z=["commentsAndSuggestions","comments","suggestions"],q=["unresolved","resolved"],G={unresolved:M().jc0,resolved:M().tXX},X=(0,c().YK)({unresolved:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open"},resolved:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved"},commentsAndSuggestions:{id:"updateSidebar.comments.typeMode.commentsAndSuggestions",defaultMessage:"Any"},comments:{id:"updateSidebar.comments.typeMode.comments",defaultMessage:"Comments only"},suggestions:{id:"updateSidebar.comments.typeMode.suggestions",defaultMessage:"Suggestions only"}}),J=(0,c().YK)({filterLabel:{id:"updateSidebar.comments.filter.label",defaultMessage:"Filter"}});function Q(e,t,o,s,n){if(t)return e;const{items:i}=e;if(i.length<=6)return e;const r=[...i.slice(0,5),{key:"show more",render:e=>(0,Y.jsx)(_().A,{...e,icon:(0,I()._)(n.showMoreResultsButton),title:(0,Y.jsx)("span",{style:n.showMoreResultsButtonTitle,children:(0,Y.jsx)(c().sA,{defaultMessage:"{numberMore} more results",id:"updateSidebar.comments.filter.byPerson.showMoreResultsButton.title",values:{numberMore:i.length-5}})})}),action:()=>{o(!0)}}];return{...e,items:r}}function ee(e){let{numCommenters:t,userActorsForDisplay:o,actorForFilter:s,setActorForFilter:i,onMobileClose:a,currentCommentsMode:l,currentTypeMode:d,popupOpen:u,setPopupOpen:m,peopleFilterExpanded:p,setPeopleFilterExpanded:g}=e;const f=(0,n().v3)(),y=f.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By type",id:"commentFilterMenu.typeSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by type",id:"commentFilterMenu.typeSectionDesktop.title"}),v=f.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By status",id:"commentFilterMenu.statusSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by status",id:"commentFilterMenu.statusSectionDesktop.title"}),x=f.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By person",id:"commentFilterMenu.personFilterSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by person",id:"commentFilterMenu.personFilterSectionDesktop.title"}),h=(0,r().IS)((e=>({anyoneMenuItemMobileIconStyles:{width:P().nd,fill:e.icon.secondary},showMoreResultsButton:{width:16,fill:e.text.secondary},showMoreResultsButtonTitle:{color:e.text.secondary}})),[]),j={key:"typeMode",render:e=>(0,Y.jsx)(E().A,{...e,title:y}),items:Z.map((e=>({key:e,render:t=>(0,Y.jsx)(_().A,{...t,title:K().A.formatMessage(X[e]),isChecked:d===e}),action:()=>{N().setUpdateSidebarCommentsTypeMode(e),f.device.isMobile||m(!1)}})))},C={key:"commentFilter",render:e=>(0,Y.jsx)(E().A,{...e,topBorder:!0,title:v}),items:q.map((e=>({key:e,render:t=>(0,Y.jsx)(_().A,{...t,className:G[e],title:K().A.formatMessage(X[e]),isChecked:l===e}),action:()=>{N().setUpdateSidebarCommentsMode(e),f.device.isMobile||m(!1)}})))},M={key:"anyone",render:e=>(0,Y.jsx)(_().A,{...e,title:(0,Y.jsx)(c().sA,{defaultMessage:"Anyone",id:"commentFilterMenu.anyoneItem.title"}),mobileIconStyle:h.anyoneMenuItemMobileIconStyles,icon:(0,Y.jsx)(R().I,{icon:T().peopleIcon,color:"graySecondary"}),isChecked:void 0===s}),action:()=>{i(void 0),f.device.isMobile||m(!1)}},w=o.map((e=>{const t=e.getActorUserId();if(t){return{key:t,render:o=>(0,Y.jsx)(U().A,{...o,actor:e,useEmailAsTooltip:!0,isChecked:(null==s?void 0:s.getActorUserId())===t,right:(0,Y.jsx)(P().w4,{visible:(null==s?void 0:s.getActorUserId())===t})}),action:()=>{i(e),f.device.isMobile||m(!1)}}}})).filter(F().O9),k={key:"personFilter",render:e=>(0,Y.jsx)(E().A,{topBorder:!0,...e,title:x}),items:f.device.isMobile?[M,...w]:1===t?w:[M,...w]},I=(0,Y.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:[j,C,f.device.isMobile?k:Q(k,p,g,0,h)]});return f.device.isMobile?(0,Y.jsx)(S().A,{menuType:H().gu.Modal,scrollerStyle:{paddingBottom:0},title:(0,Y.jsx)(c().sA,{defaultMessage:"Filter",id:"commentFilterMenu.title"}),right:(0,Y.jsx)(A().DoneMenuText,{}),onClickRight:()=>{a(),m(!1)},children:I}):I}function te(e){let{userActors:t,actorForFilter:o,setActorForFilter:a}=e;const l=(0,n().v3)(),d=(0,c().tz)(),u=(0,i().K8)((()=>W().Ay.state.expanded),[]),m=(0,i().K8)((()=>V().A.state.open),[]),p=(0,i().K8)((()=>{let e=[...t];return o&&!e.find((e=>e.getActorUserId()===o.getActorUserId()))&&(l.device.isMobile?a(void 0):e=[o,...e]),e.sort(((e,t)=>{const o=(0,k().lR)(d,e),s=(0,k().lR)(d,t);return o&&s?o.localeCompare(s):0})),e}),[d,o,t,l.device.isMobile,a]),[g,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[x,h]=(0,i().K8)((()=>[W().Ay.state.commentsMode,W().Ay.state.commentsTypeMode]),[]),S=(0,r().IS)((e=>({toggleButton:{justifyContent:"center",display:"flex",color:e.text.secondary},toggleButtonContainer:{paddingRight:l.device.isMobile?0:8,display:"flex"},filterIcon:{width:l.device.isMobile?18:16,fill:o||"resolved"===x?e.icon.uiBluePrimary:e.icon.secondary}})),[o,x,l.device.isMobile]),b=K().A.formatMessage(J.filterLabel);return(0,i().K8)((()=>{l.device.isMobile||u?l.device.isMobile&&!m&&(N().setUpdateSidebarCommentsMode("unresolved"),a(void 0)):(N().setUpdateSidebarCommentsMode("unresolved"),a(void 0),v(!1))}),[m,l.device.isMobile,a,u]),(0,Y.jsx)(L().Ay,{open:g,originGap:0,popupType:l.device.isMobile?$().n.SlideUp:$().n.Popup,renderOrigin:e=>(0,Y.jsx)(O().A,{...e,placement:z().W.Bottom,renderTooltip:()=>b,render:e=>(0,Y.jsx)("div",{style:S.toggleButtonContainer,className:M().kJD,children:(0,Y.jsx)(D().p,{...e,style:S.toggleButton,onClick:()=>{f(!0)},children:(0,B().S)(S.filterIcon)})})}),placementToOrigin:z().W.Bottom,alignmentToOrigin:z().C.Center,render:e=>(0,Y.jsx)(ee,{userActorsForDisplay:p,actorForFilter:o,setActorForFilter:a,onMobileClose:()=>e.close(),currentCommentsMode:x,currentTypeMode:h,popupOpen:g,setPopupOpen:f,peopleFilterExpanded:y,setPeopleFilterExpanded:v,numCommenters:t.length}),onClose:()=>{f(!1)}})}var oe=()=>o(765957),se=()=>o(463830),ne=()=>o(217429);function ie(e){let{userActors:t,actorForFilter:o,setActorForFilter:s}=e;const n=(0,r().IS)((e=>({container:{display:"flex",flexDirection:"column",borderBottom:`1px solid ${e.regularDividerColor}`},commentsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto"},label:{lineHeight:"inherit",fontSize:14,color:e.text.primary,fontWeight:C().Wy.medium,display:"flex",alignItems:"center",margin:0,padding:"12px 12px 12px 16px"},notificationsLabel:{fontSize:C().J.UISmall.desktop,color:e.text.secondary,fontWeight:C().Wy.medium},notificationsBorder:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:4},notificationsContainer:{padding:"0 16px 14px"}})),[]),a=(0,i().K8)((()=>"on"===ne().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]),l=(0,i().O$)(oe().AppStoreMainEditorCurrentBlockStore),d=(0,i().uB)(void 0,se().A);return(0,Y.jsxs)("div",{style:n.container,children:[(0,Y.jsxs)("div",{style:n.commentsHeader,className:M().S4C,children:[(0,Y.jsx)("h2",{style:n.label,children:(0,Y.jsx)(c().sA,{id:"updateSidebar.header.commentsAndSuggestionsLabel",defaultMessage:"Comments & suggestions"})}),(0,Y.jsx)(te,{userActors:t,actorForFilter:o,setActorForFilter:s})]}),a&&l&&(0,Y.jsxs)("div",{style:n.notificationsContainer,children:[(0,Y.jsx)("div",{style:n.notificationsLabel,children:(0,Y.jsx)(c().sA,{defaultMessage:"Notify me for",id:"topbarCommentsDesktop.notifications.label"})}),(0,Y.jsx)("div",{style:n.notificationsBorder,children:(0,Y.jsx)(w().O,{blockStore:l,moreProminentStyling:!0,from:"comments_sidebar",buttonPopupStore:d})})]})]})}var re=()=>o(299545),ae=()=>o(347199),le=()=>o(953418),de=()=>o(645873),ce=()=>o(963589),ue=()=>o(644914),me=()=>o(756279),pe=()=>o(372154),ge=()=>o(546574),fe=()=>o(745591),ye=()=>o(704495),ve=()=>o(128973);function xe(e){const t=(0,i().K8)((()=>x().A.state.isHovered),[]),o=(0,i().K8)((()=>x().A.state.isActivelyComposing),[]),s=(0,r().IS)((e=>({hoveredStyle:{background:e.hoveredDiscussionBackground},pressedStyle:{background:e.focusDiscussionBackground},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:C().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[]);return(0,Y.jsx)(E().A,{desktopTitleStyle:{...s.basicDesktopTitleStyle,...t?s.hoveredStyle:{},...o?s.pressedStyle:{}},mobileTitleStyle:s.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var he=()=>o(423817);const Se=new(o(970585).A),be=50;function Ae(e){ae().A.UpdateSidebarCommentScroller=e}function je(e){const{timeViewed:t,location:o}=e,C=(0,n().v3)(),w=(0,n().Y0)(),[k,I]=(0,s.useState)(!1),[B,T]=(0,s.useState)(void 0),F=(0,i().O$)(oe().AppStoreMainEditorCurrentBlockStore),D=(0,i().K8)((()=>C.currentUser.id),[C]),_=(0,ce().X)("comment_sidebar_for_you"),{value:L}=(0,de().fJ)(m().commentsDependency),P=(0,i().K8)((()=>L?L.discussionHelpers.getDiscussionsForSidebar({blockStore:F,currentUserId:D,ignoreAfterTime:t}):[]),[L,F,t,D]),R=(0,i().K8)((()=>W().Ay.state.commentsMode),[]),E=(0,i().K8)((()=>W().Ay.state.commentsTypeMode),[]),O=(0,i().K8)((()=>(0,ue().me)(C)),[C]),U=(0,i().K8)((()=>{const e=("comments"===E||"commentsAndSuggestions"===E)&&"unresolved"===R,t=(h().A.hasContent()||x().A.state.isActivelyComposing)&&h().A.isDraftCommentOnValidSelection();return(O||w.isMobile)&&t&&e&&h().A.ifPropertyCommentShouldDisplay()}),[R,E,w.isMobile,O]),N=(0,i().K8)((()=>pe().A.getOpenDiscussionIds()),[]),V=(0,i().K8)((()=>{const e="commentsAndSuggestions"===E?P:P.filter((e=>e.getType()===W().zX[E])),{resolved:t,unresolved:o}=(0,re().uy)(e);return"unresolved"===R?o:t}),[P,E,R]),z=V.map((e=>e.id)),$=(0,i().K8)((()=>B?V.filter((e=>(0,re().wc)(e).map((e=>e.getCreatedById())).some((e=>e===B.getActorUserId())))):V),[V,B]),Z=(0,i().K8)((()=>(0,y().getSetOfUsersInDiscussions)(V)),[V]);(0,s.useEffect)((()=>{if("popup"===o&&k)return()=>{ge().A.markDiscussionsInteractedWith(z)}}),[o,z,k]);const q=(0,r().IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},filterControlStyle:{position:"absolute",top:-37,right:40}})),[]),G=(0,s.useRef)(null),X=(0,i().K8)((()=>{if(!L)return{};const e=u().$z($,(e=>{const o=L.discussionHelpers.getLatestRelevantComment({recordStore:e,currentUserId:D,timestamp:t});return o?(0,a().aD)(o.getCreatedTime()):""}));return delete e[""],e}),[L,$,t,D]),J=(0,i().K8)((()=>!L||L.discussionHelpers.anyDiscussionCommentsLoading($)),[L,$]);(0,s.useEffect)((()=>{k||J||I(!0)}),[k,J]);const Q=(0,s.useCallback)((()=>{x().A.setHoverWithSource("comments_pane"),v().A.reset()}),[]),ee=(0,s.useCallback)((()=>{x().A.resetHoverSource("comments_pane")}),[]),se=(0,i().K8)((()=>x().A.state.isActivelyComposing),[]);if(!F||!X||!k)return(0,Y.jsx)(he().J,{areaHeight:window.innerHeight});const ne=(0,a().aD)(Date.now()),ae=Object.keys(X).sort().reverse();!U||0!==ae.length&&ae.includes(ne)||ae.unshift(ne);const je=ae.map(((e,s)=>{const n=(0,a().ZF)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,l().P)(),intl:K().A.getIntl(),allowRelativeDates:!0}),i=X[e],r=U&&e===ne,d=[];r&&d.push({key:"draft-discussion-in-comments-pane",render:e=>(0,Y.jsx)(f().A,{environment:C,shouldShowBottomDividerLine:!(1===ae.length&&0===(null==i?void 0:i.length)),menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:Q,onMouseLeave:ee}),action:()=>{const e=h().A.getDiscussionInputStore();e&&(x().A.setActiveWithSource("comments_pane"),pe().A.reset(),(0,g().x)({currentBlockStore:F,discussionInputStore:e,environment:C,dontAffectCursor:se,animateScroll:!0}))}});const c=i?i.map(((e,n)=>{const a=e.getRecordStoreUIParent()??F,l={key:e.id,render:l=>(0,Y.jsx)(ye().F,{...l,currentBlockStore:a,discussionStore:e,isFirstInSection:0===n&&!r,location:o,isLast:n===i.length-1&&s===ae.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{se&&x().A.resetAllActiveSources(),p().DZ({discussionStore:e,currentBlockStore:F,environment:C,analyticsFrom:"updates_sidebar",currentEl:G.current})}};return l})):[];return d.push(...c),{key:e,render:e=>r?(0,Y.jsx)(xe,{title:n,...e}):(0,Y.jsx)(ve().P,{title:n,firstItemId:i[0].id,location:o,ignoreFirstItemState:r,...e}),items:d}})),Ce=je.flatMap((e=>e.items)).findIndex((e=>N.includes(e.key.toString()))),Me=0!==$.length||U?(0,Y.jsx)(j().H,{type:me().A.Y,style:q.scrollerStyle,className:M().bzV,ref:Ae,children:(0,Y.jsx)(b().Ay,{disableKeyboard:!0,store:Se,type:b().Oh.Vertical,initialFocus:Ce>=0?Ce:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),o=d().ek(C.device.isElectronMac),s=window.innerHeight,n=o+be,i=s-n;if(t.height>=i)return;const r=t.top>=n&&t.top<=s,a=r&&t.bottom>=s,l=t.bottom>=n&&t.bottom<=s,c=l&&t.top-n<0,u=r||l,m=.4*t.height;a&&Math.abs(t.top-s)<m?(0,le().vq)(e,{edgeDist:s-t.height-n,animate:!0}):c&&Math.abs(t.bottom-n)<m?(0,le().vq)(e,{edgeDist:0,animate:!0}):u||(0,le().vq)(e,{edgeDist:0,animate:!0})}},sections:je})}):(0,Y.jsx)(fe().x,{environment:C,device:w,navigableBlockStore:F,actorForFilter:B,currentCommentsMode:R,currentCommentsType:E});return C.device.isMobile?_?(0,Y.jsxs)("div",{style:q.commentsContentStyle,children:[w.isPhone?(0,Y.jsx)("div",{style:q.filterControlStyle,children:(0,Y.jsx)(te,{userActors:Z,actorForFilter:B,setActorForFilter:T})}):void 0,Me]}):(0,Y.jsx)(S().A,{menuType:H().gu.Modal,title:(0,Y.jsx)(c().sA,{defaultMessage:"Comments & suggestions",id:"topbarMobile.commentsAndSuggestionsMenu.title"}),left:(0,Y.jsx)(te,{userActors:Z,actorForFilter:B,setActorForFilter:T}),leftOuterStyle:{position:"relative",marginLeft:-4,paddingRight:4},right:(0,Y.jsx)(A().DoneMenuText,{}),onClickRight:e.onMobileClose,children:Me}):(0,Y.jsxs)("div",{style:q.commentsContentStyle,ref:G,children:[(0,Y.jsx)(ie,{userActors:Z,actorForFilter:B,setActorForFilter:T}),Me]})}},835607:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>s,peopleIcon:()=>n});o(296540);const s={viewBox:"0 0 20 20",fittedViewBox:"0.85 2.79 18.76 14.42",svg:(0,o(474848).jsx)("path",{d:"M11.794 3.936c.57-.71 1.414-1.141 2.456-1.141s1.886.43 2.456 1.14c.558.696.823 1.618.823 2.582s-.265 1.885-.823 2.58c-.57.71-1.414 1.141-2.456 1.141s-1.886-.43-2.456-1.14c-.558-.696-.823-1.618-.823-2.581 0-.964.265-1.886.823-2.581m.975.782c-.341.426-.548 1.052-.548 1.799s.207 1.373.548 1.798c.33.41.813.673 1.481.673s1.152-.262 1.481-.673c.342-.425.548-1.051.548-1.798s-.206-1.373-.548-1.799c-.33-.41-.813-.673-1.48-.673-.669 0-1.152.263-1.482.673M5.75 3.625c-.956 0-1.734.396-2.259 1.05-.513.64-.755 1.484-.755 2.362s.242 1.723.755 2.362c.525.654 1.303 1.05 2.26 1.05s1.733-.396 2.258-1.05c.513-.64.755-1.484.755-2.362s-.242-1.723-.755-2.362c-.525-.654-1.302-1.05-2.259-1.05M3.986 7.037c0-.661.184-1.21.48-1.58.285-.354.702-.582 1.284-.582s1 .228 1.284.582c.297.37.48.919.48 1.58s-.183 1.21-.48 1.58c-.284.354-.701.582-1.284.582-.582 0-1-.228-1.284-.583-.296-.37-.48-.918-.48-1.579m-.948 8.918h4.69c.114.467.337.894.634 1.25H3.038c-.68 0-1.327-.286-1.742-.764-.432-.498-.606-1.209-.265-1.92.823-1.72 2.636-2.896 4.72-2.896 1.128 0 2.178.346 3.034.936a6.6 6.6 0 0 0-.681 1.05 4.1 4.1 0 0 0-2.354-.736c-1.611 0-2.98.908-3.592 2.186-.1.21-.063.393.082.56.161.186.456.334.798.334M14.25 11.21c-2.334 0-4.354 1.36-5.202 3.323-.309.715-.125 1.419.309 1.912.418.476 1.064.76 1.743.76h6.3c.68 0 1.325-.284 1.744-.76.433-.493.617-1.197.308-1.912-.848-1.963-2.868-3.324-5.202-3.324m-4.054 3.818c.645-1.494 2.207-2.569 4.054-2.569s3.409 1.075 4.055 2.57a.52.52 0 0 1-.1.59c-.166.19-.462.336-.805.336h-6.3c-.342 0-.638-.146-.805-.336a.52.52 0 0 1-.1-.59"})},n=(0,o(340498).wt)("people",s)},848565:(e,t,o)=>{o.d(t,{FB:()=>m,Ql:()=>p,SM:()=>g,Wv:()=>i,Yz:()=>a,ds:()=>n,e4:()=>s,eQ:()=>r,im:()=>d,jw:()=>l,k2:()=>u,uG:()=>c});const s=8,n=10,i=8,r=24,a=6,l=1.5,d=(r-l)/2,c=r+a,u=`calc(100% + ${i+(s-a)-c}px)`,m=r+8,p=-16;function g(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}},913139:(e,t,o)=>{o.d(t,{B:()=>C});var s=o(296540),n=()=>o(56366),i=()=>o(737230),r=(o(57145),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(672577),o(581454),()=>o(484714)),a=()=>o(938045),l=()=>o(273321),d=()=>o(94953),c=()=>o(555776),u=()=>o(116008),m=()=>o(939740),p=()=>o(347199),g=()=>o(372154),f=o(474848);function y(e){const{navigableBlockStore:t}=e,d=(0,r().v3)(),p=(0,r().Y0)(),[y,j]=(0,s.useState)(new Set),C=function(e){const[t,o]=(0,s.useState)(new Map),i=(0,n().K8)((()=>{const t=new Map;for(const o of e)if(b(o)){const e=A(o);e&&t.set(o.id,e)}return t}),[e]);(0,s.useEffect)((()=>o((e=>{const t=new Map;for(const[o,s]of i.entries())e.has(o)||t.set(o,s);if(t.size){for(const[o,s]of e.entries())t.set(o,s);return t}return e}))),[i]);const r=(0,s.useCallback)((e=>(null==t?void 0:t.get(e.id))??A(e)),[t]);return(0,n().K8)((()=>e.toSorted(((e,t)=>r(t)-r(e)))),[e,r])}((0,o(419123).P)({navigableBlockStore:t,forceIncludeDiscussionIds:y})),M=function(e){const{environment:t,navigableBlockStore:o}=e,i=(0,n().K8)((()=>{const e=(u().A.hasContent()||c().A.state.isActivelyComposing)&&u().A.isDraftCommentOnValidSelection();return Boolean(e&&u().A.ifPropertyCommentShouldDisplay())}),[]),r=(0,n().K8)((()=>c().A.state.isActivelyComposing),[]),d=(0,s.useMemo)((()=>({key:"draft-discussion-in-comments-pane",render:e=>(0,f.jsx)(l().A,{environment:t,shouldShowBottomDividerLine:!0,menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:h,onMouseLeave:S}),action:()=>{const e=u().A.getDiscussionInputStore();e&&(c().A.setActiveWithSource("comments_pane"),g().A.reset(),(0,a().x)({currentBlockStore:o,discussionInputStore:e,environment:t,dontAffectCursor:r,animateScroll:!0}))}})),[t,o,r]);return i?d:void 0}({environment:d,navigableBlockStore:t}),w=(0,s.useRef)(null),k=[...M?[M]:[],...C.map(((e,n)=>({key:e.id,render:o=>{let{ref:i,...r}=o;return(0,s.createElement)(v,{...r,key:e.id,discussionStore:e,navigableBlockStore:t,isLast:n===C.length-1})},action:()=>o(789557).DZ({discussionStore:e,currentBlockStore:t,environment:d,analyticsFrom:"updates_sidebar",currentEl:w.current})})))];(0,s.useEffect)((()=>{j((e=>{const t=C.map((e=>e.id)).filter((t=>!e.has(t)));return t?new Set([...e,...t]):e}))}),[C]);const I=(0,n().K8)((()=>g().A.getOpenDiscussionIds()),[]),B=k.findIndex((e=>I.includes(e.key.toString()))),T=(0,s.useCallback)((e=>{const t=e.getOpenDiscussionIds(),o=C.find((e=>t.includes(e.id)));t.length&&!o&&i().Ay.update((e=>({...e,...i().Ay.createUpdateForNewCommentsSidebar(i().UL.Comments)})))}),[C]),F=(0,o(725252).L)({value:!0,waitTimeInMs:1e3}).value;(0,s.useEffect)((()=>{if(F)return g().A.addListener(T),()=>g().A.removeListener(T)}),[F,T]);const D=(0,o(401497).IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0}})),[]);return(0,f.jsx)("div",{style:D.commentsContentStyle,ref:w,children:k.length?(0,f.jsx)(o(2143).H,{type:o(756279).A.Y,style:D.scrollerStyle,className:o(38337).bzV,ref:x,children:t?(0,f.jsx)(m().Ay,{initialFocus:B??0,type:m().Oh.Vertical,sections:[{key:0,render:e=>(0,f.jsx)(o(128973).P,{location:"sidebar",...e}),items:k}]}):void 0}):(0,f.jsx)(o(745591).x,{environment:d,device:p,navigableBlockStore:t})})}const v=s.memo(s.forwardRef((function(e,t){const{discussionStore:s,navigableBlockStore:i,isLast:r,...a}=e,l=(0,n().K8)((()=>s.getRecordStoreUIParent()),[s]),d=l instanceof o(630116).Bv?l:i;return(0,f.jsx)("div",{children:(0,f.jsx)(o(704495).F,{...a,ref:t,currentBlockStore:d,discussionStore:s,isFirstInSection:!0,isLast:r,location:"sidebar",showAllRepliesAfterTimestamp:void 0})})})));function x(e){p().A.UpdateSidebarCommentScroller=e}function h(){c().A.setHoverWithSource("comments_pane"),d().A.reset()}function S(){c().A.resetHoverSource("comments_pane")}function b(e){return e.isDefined()&&e.getCommentStores().every((e=>e.isDefined()))}function A(e){return Math.max(...e.getCommentStores().map((e=>e.getCreatedTime())))}var j=()=>o(310830);const C=s.memo((function(e){const{navigableBlockStore:t,timeViewed:s}=e,r=(0,n().K8)((()=>i().Ay.getTabForNewCommentsSidebar()),[]);switch(r){case i().UL.ForYou:return(0,f.jsx)(y,{navigableBlockStore:t});case i().UL.Comments:return(0,f.jsx)(o(831272).R,{timeViewed:s,location:"sidebar"});case i().UL.Updates:case i().UL.Analytics:return(0,f.jsx)(j().f,{enablePageAnalytics:!0});case i().UL.Info:return(0,f.jsx)(o(146594).H,{store:t,context:o(548821).Rr.Frame,disabled:!1,shownAs:"sidebar"});default:return(0,o(534177).ub)(r),null}}))}}]);