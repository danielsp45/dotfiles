"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4586],{323779:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ye});var o=n(296540),i=()=>n(908006),s=()=>n(484714),r=()=>n(56366),a=()=>n(777447),l=()=>n(959013),c=()=>n(264879),u=()=>n(501666),d=()=>n(751156),p=()=>n(805751),k=()=>n(545805),f=()=>n(928600),m=()=>n(939740),g=()=>n(480095),v=()=>n(897119),x=()=>n(156988),y=()=>n(722872),h=()=>n(231722),I=()=>n(328347),S=()=>n(332737),b=()=>n(179034),T=()=>n(919709),A=()=>n(496603),B=()=>n(534177),w=()=>n(939768),P=()=>n(559926),C=()=>n(319975),L=()=>n(2220),j=()=>n(760217),M=()=>n(89924),U=()=>n(780054),E=()=>n(186445),R=()=>n(781286),V=()=>n(958163),_=()=>n(401497),F=()=>n(630116),H=()=>n(704152),K=()=>n(187820),N=()=>n(16006),W=n(474848);function O(e){const{store:t,onClick:n}=e,o=(0,s().v3)(),i=(0,s().WS)(),a=(0,r().K8)((()=>t.getIcon()),[t]),l=(0,r().K8)((()=>t instanceof F().Bv&&t.isEmptyPage()),[t]),c=(0,r().K8)((()=>(0,K().Te)(t)),[t]),u=(0,_().IS)((e=>({container:{display:"flex",alignItems:"center",padding:"4px 6px",marginLeft:12,marginRight:12,borderRadius:6,boxShadow:e.inputBoxShadow,background:e.inputBackground,height:28,fontSize:14,lineHeight:"120%"},phoneContainer:{display:"flex",alignItems:"center",padding:"4px 16px",boxShadow:`${e.regularDividerColor} 0px 1px 0px`,background:e.modalBackground,height:46}})),[]);return(0,W.jsxs)(H().A,{style:i?u.phoneContainer:u.container,onClick:n,children:[(0,W.jsx)(K().B6,{disabled:!0,icon:a,iconRecordCategory:c,isEmptyPage:l,size:o.device.isMobile?24:20,style:{marginRight:4}}),(0,W.jsx)(N().A,{store:t})]})}var q=()=>n(419357),D=()=>n(711319);function Q(e){const{state:t,focusInitial:n,defaultValue:o,onBlur:i,onKeyDown:r,style:a,inputComboboxProps:c}=e,u=(0,s().WS)(),d=(0,l().tz)(),p=d.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder"}),k=d.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder"}),f=!u||!t.showCreateIn,m=u?void 0:!t.showCreateIn&&t.focusLinkInput,g=(0,x().lR)(t)?k:p;return f?(0,W.jsx)(q().Ay,{onFocus:x().Nd,placeholder:g,value:o||t.url,onChange:z,onBlur:i,onKeyDown:r,focus:m,focusInitial:n,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0,style:a,...c}):null}function z(e){const t=(0,x().t4)();t&&function(e,t){switch(e.type){case"text":return void D().A.setState({...e,url:t.target.value,focusLinkInput:!0});case"image":return void V().A.setState({...e,url:t.target.value,focusLinkInput:!0});default:(0,B().HB)(e)}}(t,e)}function $(e){const{state:t,showPreview:n,store:o,inputComboboxProps:i}=e,r=(0,s().WS)(),a=(0,x().Hx)(t),l=(0,x().lR)(t);return n&&o?(0,W.jsx)(O,{store:o,onClick:x().Nd}):(0,W.jsx)(Q,{state:t,onBlur:x().gZ,onKeyDown:G,defaultValue:n?a:void 0,style:l?void 0:{marginTop:6},focusInitial:!l||r&&"text"===t.type&&!t.focusTitleInput,inputComboboxProps:i})}function G(e){"Escape"===e.key&&(e.stopPropagation(),(0,x().OY)())}function J(e){const{title:t,focus:n,defaultTitle:i}=e,r=(0,s().v3)(),a=(0,s().WS)(),[l,c]=(0,o.useState)(),u=(0,o.useRef)(!1),d=(0,o.useMemo)((()=>({environment:r,defaultTitle:i,setPlaceholder:c,hasTitleChanged:u})),[i,r]);return(0,o.useEffect)((()=>{const e=u.current;return()=>{e&&P().st(r)}}),[u,r]),(0,W.jsx)(q().Ay,{focus:n,focusInitial:a,onFocus:Z,onBlur:()=>X(d),onChange:e=>function(e,t){Y(e.target.value,t)}(e,d),onKeyDown:e=>function(e,t){"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),X(t))}(e,d),value:l?"":t,placeholder:l,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}function Y(e,t){const n=D().A.state;if(!n.open)return;const{editingToken:o,savedTextSelectionState:i}=n;if(!o)return;if(!e)return void D().A.setState({...n,title:""});const{environment:s,setPlaceholder:r,hasTitleChanged:a}=t;d().createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,canUndo:!0,perform:t=>{const l=u().ar({environment:s,title:e,transaction:t,editingToken:o,savedTextSelectionState:i});l&&D().A.setState({...n,...l,title:e}),r(void 0),a.current=!0}})}function Z(){(0,x().zE)(!0)}function X(e){!function(e){const t=D().A.state;if(!t.open)return;const{defaultTitle:n,setPlaceholder:o}=e;t.title||(Y(n,e),o(n))}(e),(0,x().zE)(!1)}var ee=()=>n(227440),te=(n(898992),n(581454),n(737550),()=>n(17022)),ne=()=>n(187174),oe=()=>n(958378),ie=()=>n(825972),se=()=>n(106628),re=()=>n(645873),ae=()=>n(62856);var le=()=>n(857437),ce=()=>n(236262),ue=()=>n(8980);function de(e){const{state:t,onUnlink:n}=e,[i,c]=(0,le().$)(),u=(0,o.useMemo)((()=>(0,x().V8)(t)),[t]),d=(0,o.useMemo)((()=>(0,x().KX)(u)),[u]),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:a}=e,{url:c}=t,u=(0,s().v3)(),d=(0,s().WS)(),p=(0,r().O$)(ee().e),k=Boolean(c),f=(0,o.useMemo)((()=>{let e,o=!1;if(!n&&k)e=(0,W.jsx)(l().sA,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl"}),o=!0;else{if(!n)return;if("notion"===n.type&&p)return;"web"===n.type?e=(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===n.type?e=(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===n.type?e=(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,B().HB)(n.type)}return{key:"link to url",action:()=>a(u,t,i,d),render:t=>(0,W.jsx)(j().A,{...t,title:c,caption:e,icon:(0,I().h)({width:16,paddingTop:4}),disabled:o})}}),[t,i,u,d,p,n,a,k,c]);return f}({state:t,inputUrl:d,query:u,handleLinkSelection:pe}),k=function(e){const{state:t,inputUrl:n,query:i,additionalItem:c}=e,u="text"===t.type?t.editingToken:t.imageHyperlink,d=(0,x().lR)(t),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:c,disableEmptyQueryResults:u}=e,d=(0,s().v3)(),p=(0,s().WS)(),[{online:k}]=(0,r().$y)(ee().A),f=(0,o.useMemo)((()=>{var e;const n="text"===t.type?null===(e=(0,h().H7)(t.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:t.store;if(n&&n instanceof F().Bv)return n}),[t]),m=(0,re().fJ)(se().T.searchActions),[{value:g,status:v}]=(0,ne().Yb)((async()=>{if(!k||"resolved"!==m.status)return[];if(!i)return u?[]:ie().NK.state.map((e=>e.pageId));const e=m.value;return(await e.searchMentionablePages({nearBlock:f,environment:d,query:i,source:"mention_menu",limit:10})).map((e=>e.id))}),[i,f,d,k,u,m.status,m.value]),x=(0,ae().A)("resolved"===v,300,300),y=(0,o.useMemo)((()=>{if(n&&"notion"===n.type){const e="page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,t=g?A().FF(g,e):[];return[n,...t]}return g}),[g,n]);return(0,o.useMemo)((()=>{if(!y||0===y.length)return;if(n&&"web"===n.type&&n.url===i)return;const e=te().e.withListenerIgnored(E().ZO);if(!e)return;const o=t.url?5:3,s=(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block"}),r=(0,W.jsx)(l().sA,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:(0,A().oE)(y.map(((n,o)=>{const{pageId:i,peekViewBlockId:r,scrollToBlockId:u,discussionId:k,collectionViewId:f}="object"==typeof n?{pageId:"page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,..."page"===n.notionPage.name?{scrollToBlockId:n.notionPage.scrollToBlockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId}:{scrollToBlockId:void 0,peekViewBlockId:void 0,discussionId:void 0,collectionViewId:void 0}}:{pageId:n,peekViewBlockId:void 0,scrollToBlockId:void 0,discussionId:void 0,collectionViewId:void 0};if(!i)return;const m=F().Bv.createChildStore(e,{table:b().ev,id:i});return{key:o,action:()=>{if("object"==typeof n){const e=(0,a().wv)({pageId:i,peekViewBlockId:r,peekMode:n.notionPage.peekMode,discussionId:k,collectionViewId:f,scrollToBlockId:u});c(d,t,e,p,m)}else c(d,t,(0,a().wv)({pageId:i}),p,m)},render:e=>{const t="object"==typeof n&&u;return(0,W.jsx)(oe().A,{...e,store:m,caption:t?s:void 0,placeholder:x?(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):(0,W.jsx)(l().sA,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}}}))).slice(0,o),title:y.some((e=>Boolean("object"==typeof e&&"page"===e.notionPage.name&&e.notionPage.scrollToBlockId)))?s:r}}),[y,t,d,p,i,n,c,x])}({state:t,inputUrl:n,query:i,handleLinkSelection:pe,disableEmptyQueryResults:d}),k=(0,o.useMemo)((()=>{if(p||c){return{key:"results",items:A().oE([...(null==p?void 0:p.items)||[],c]),render:e=>(0,W.jsx)(M().A,{...e,title:u||i?void 0:(0,W.jsx)(l().sA,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents"})})}}}),[p,c,u,i]);return k}({state:t,inputUrl:d,query:u,additionalItem:p}),f=(0,x().Hx)(t),m=f&&(0,a().lX)({url:f,baseUrl:U().A.domainBaseUrl,publicDomainName:U().A.publicDomainName}),g=(0,r().K8)((()=>{if(!m)return;const e=(0,E().ZO)();return e?F().Bv.createChildStore(e,{table:b().ev,id:m}):void 0}),[m]),v=function(e){const{state:t,url:n,isEmptyResults:i,pageStore:s,inputComboboxProps:r}=e,a=(0,o.useMemo)((()=>{let e=(0,W.jsx)(l().sA,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl"});const o=!t.focusLinkInput&&i;let a;return s?a={key:"link to page",action:()=>{},render:()=>(0,W.jsx)($,{state:t,showPreview:o,store:s,inputComboboxProps:r})}:n?a={key:"link to web",action:()=>{},render:()=>(0,W.jsx)($,{state:t,showPreview:!0,inputComboboxProps:r})}:(e=void 0,a={key:"create link",action:()=>{},render:()=>(0,W.jsx)($,{state:t,showPreview:o,inputComboboxProps:r})}),{key:"page or url",render:t=>(0,W.jsx)(M().A,{title:e,...t}),items:[a]}}),[t,n,i,s,r]);return a}({state:t,url:f,isEmptyResults:!Boolean(k),pageStore:g,inputComboboxProps:i}),y=function(e){const{state:t,url:n,pageStore:i}=e,s=(0,r().K8)((()=>i?T().q4_(i.getTitleValue()):void 0),[i]),a=(0,o.useMemo)((()=>{if("text"!==t.type)return;const{editingToken:e,title:o,focusTitleInput:i}=t;return e?{key:"link title",render:e=>(0,W.jsx)(M().A,{title:(0,W.jsx)(l().sA,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle"}),...e}),items:[{key:"update title",action:()=>{},render:()=>(0,W.jsx)(J,{title:o,defaultTitle:s??n,focus:i})}]}:void 0}),[t,n,s]);return a}({state:t,url:f,pageStore:g}),S=function(e){const{state:t,onUnlink:n}=e,i=function(e){const{state:t,onUnlink:n}=e,i=(0,s().v3)();return(0,o.useMemo)((()=>{if((0,x().lR)(t))return{key:"unlink",action:()=>{n(i);const e=(0,x().Hx)(t);switch(t.type){case"text":P().Mi(i,{type:"remove_link",url:e});break;case"image":const n=e?(0,w().bk)(e):void 0;(0,L().u)({environment:i,event:{eventName:"image_hyperlink_action",eventProperties:{action:"remove_link",url_type:null!=n&&n.hostname?"external":"notion"}}});break;default:(0,B().HB)(t)}},render:e=>(0,W.jsx)(j().A,{...e,title:(0,W.jsx)(l().sA,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:(0,W.jsx)(ue().I,{icon:ce().trashIcon})})}}),[n,t,i])}({state:t,onUnlink:n}),r=(0,o.useMemo)((()=>{const e=A().oE([i]);if(0!==e.length)return{key:"link actions",render:e=>(0,W.jsx)(M().A,{topBorder:!0,...e}),items:e}}),[i]);return r}({state:t,onUnlink:n});let C,R;return k?(R=1,C=A().oE([v,k])):(R=void 0,C=A().oE([v,y,S])),{initialFocus:R,sections:C,comboboxProps:c}}function pe(e,t,n,o,i){const s=(0,S().l)(n);if(!s)return;const r=(0,x().Hx)(t);if(d().createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,canUndo:!0,perform:n=>{switch(t.type){case"text":const{editingToken:r,savedTextSelectionState:a,title:l}=t;(0,h().kM)(a.multiSelection)&&(i?C().Gf({environment:e,editorMode:"default",store:a.multiSelection.start.store,selection:{startIndex:a.multiSelection.start.index,endIndex:a.multiSelection.end.index},annotation:T().ld4(i.id,i.getSpaceId()),transaction:n,analyticsFrom:"block"}):C().yr({environment:e,store:a.multiSelection.start.store,tokens:[[s,[["a",s]]]],index:a.multiSelection.start.index,transaction:n}));const c=u().BK({environment:e,transaction:n,url:s,title:l,editingToken:r,savedTextSelectionState:a});c?(P().Mi(e,{type:"edit_link",url:s}),D().A.setState({...t,...c,url:"",focusLinkInput:!1,focusTitleInput:Boolean(o)})):(P().Mi(e,{type:"create_link",url:s}),D().A.reset());break;case"image":R().Uc({url:s,transaction:n}),V().A.reset()}}}),"image"===t.type){var a;const t=null!==(a=(0,w().bk)(s))&&void 0!==a&&a.hostname?"external":"notion";(0,L().u)({environment:e,event:{eventName:"image_hyperlink_action",eventProperties:{action:r?"edit_link":"create_link",url_type:t}}})}}var ke=()=>n(691298),fe=()=>n(963248),me=()=>n(962730),ge=()=>n(377586),ve=()=>n(611371);const xe=330;function ye(){const e=(0,r().K8)((()=>(0,x().t4)()),[]),t=(0,s().Y0)(),n=null==e?void 0:e.trapFocus,i=(0,r().K8)((()=>!e||function(e){switch(e.type){case"text":return u().GC();case"image":return!e.open;default:(0,B().HB)(e)}}(e)),[e]);(0,o.useEffect)((()=>{e&&i&&function(e){switch(e){case"text":return void u().d();case"image":return void R().J6();default:(0,B().HB)(e)}}(e.type)}),[i,e]);const a=function(e){if(e)switch(e.type){case"text":return{onClose:u().d,onUnlink:u().sp};case"image":return{onClose:R().J6,onUnlink:R().PA};default:(0,B().HB)(e)}}(e);return a&&e?(0,W.jsx)(v().Ay,{popupType:t.isMobile?t.isTablet?ge().n.Popup:ge().n.SlideUp:ge().n.Popup,style:{width:xe},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:me().W.Bottom,alignmentToOrigin:me().C.Center,originGap:8,disableContentScroll:!0,onDismiss:a.onClose,render:()=>e.open?(0,W.jsx)(he,{state:e,onClose:a.onClose,onUnlink:a.onUnlink}):void 0,preventBlockRenderQueueOnEnter:!t.isMobile,trapFocus:n}):null}function he(e){const{state:t,onClose:n,onUnlink:r}=e,a=(0,s().WS)(),[c,u]=(0,o.useState)(!0);(0,o.useEffect)((()=>u(!1)),[]);const d=(0,o.useRef)(null);(0,o.useEffect)((()=>(d.current=document.createElement("input"),d.current.style.position="fixed",d.current.style.top="-9999px",d.current.style.left="-9999px",document.body.appendChild(d.current),()=>{d.current&&document.body.removeChild(d.current)})),[]);const m=a&&t.focusLinkInput&&("text"!==t.type||!t.focusTitleInput);(0,o.useEffect)((()=>{m&&i().default.afterNextFlush((()=>{d.current&&d.current.focus()}))}),[m]);const h=(0,o.useCallback)((()=>{i().default.afterNextFlush((()=>{d.current&&document.activeElement===d.current&&d.current.blur()}))}),[]);if((0,ke().A)({shouldPreserveTextSelection:m,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0,onClearSelection:h}),t.showCreateIn&&!a)return(0,W.jsx)(Se,{state:t});let I;return I=a?{menuType:y().gu.Modal,title:(0,W.jsx)(l().sA,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:(0,W.jsx)(g().CancelMenuText,{}),onClickRight:n,footer:(0,W.jsx)(v().Ay,{popupType:ge().n.SlideUp,open:t.showCreateIn||!1,render:()=>(0,W.jsx)(Se,{state:t})})}:{menuType:y().gu.Popup},(0,W.jsxs)(p().A,{debugName:"LinkMenu",capture:t.open&&(c||t.focusLinkInput||"text"===t.type&&t.focusTitleInput),allowEsc:!0,children:[(0,W.jsx)(f().A,{...I,children:(0,W.jsx)(Ie,{state:t,onUnlink:r})}),(0,W.jsx)(k().A,{debugName:"LinkMenu",capture:!0,onCommandSlash:x().Nd})]})}function Ie(e){const{state:t,onUnlink:n}=e,{initialFocus:o,sections:i,comboboxProps:s}=de({state:t,onUnlink:n});return(0,W.jsx)(m().Ay,{type:m().Oh.Vertical,initialFocus:o,sections:i,comboboxProps:s})}function Se(e){var t;const{state:n}=e,i=(0,s().v3)(),r=(0,o.useCallback)((async e=>{var t;if(!(0,ve().EF)(i))return;const o="text"===n.type?null===(t=(0,h().H7)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0;if(!o)return;const{performResult:{createInState:s}}=await d().createAndCommitAsync({environment:i,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const s=c().oj({environment:i,transaction:t,titleText:n.url||"",createInValue:e,recordStoreParentStore:o}),[r]=s.createdPages;return r&&"text"===n.type&&(u().BK({environment:i,url:(0,a().wv)({pageId:r.id}),transaction:t,editingToken:n.editingToken,savedTextSelectionState:n.savedTextSelectionState}),D().A.reset()),await s.moveToStorePromise,{createInState:s}}});await c().nT({analyticsFrom:"link_menu",createInState:s})}),[n,i]),l="text"===n.type?null===(t=(0,h().H7)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0,p=l&&"block"===l.table?l.id:void 0;return(0,W.jsx)(fe().v,{targetBlocks:[],isAddTo:!0,isCreateIn:!0,onAccept:r,parentBlockId:p,onAutocompleteQueryChange:be,autocompleteQuery:n.createInQuery||"",desktopWidth:xe,onCancel:Te})}function be(e){const t=D().A.state;t.open&&D().A.setState({...t,createInQuery:e})}function Te(){const e=D().A.state;e.open&&D().A.setState({...e,showCreateIn:!1,createInQuery:""})}}}]);