"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[8184],{102586:(e,t,o)=>{o.d(t,{L1:()=>r,MY:()=>c,US:()=>p,Uj:()=>l,if:()=>a,z2:()=>s});o(898992),o(354520);var n=()=>o(755199);const i=100;function a(e,t){return e.prompt===t.prompt&&e.type===t.type}function r(e,t,o){const r=s(t).filter((t=>!a(t,e)));n().mJ({userSettingsStore:t,transaction:o,data:{recent_ai_actions:[e,...r].slice(0,i)}})}function s(e){var t;return(null===(t=e.getModel())||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.recent_ai_actions)??[]}function l(e,t,o){const i=s(t),r=i.filter((t=>!a(t,e)));i.length!==r.length&&n().mJ({userSettingsStore:t,transaction:o,data:{recent_ai_actions:r}})}function c(e){const{clientPrompt:t,additionalContext:o,promptTitle:n}=e,i=null==o?void 0:o.prompt;if(("helpMeWrite"===t.key||"helpMeEdit"===t.key||"helpMeDraft"===t.key)&&i)return{type:"helpMeDraft"===t.key?"helpMeWrite":t.key,prompt:i,promptTitle:n};const a=function(e,t){if(!p(e.key))return;return null==t?void 0:t.topic}(t,o);return a?{type:"helpMeWrite",prompt:a,promptTitle:n}:void 0}const d={brainstormIdeas:!0,blogPost:!0,outline:!0,socialMediaPost:!0,pressRelease:!0,creativeStory:!0,essay:!0,poem:!0,todoList:!0,meetingAgenda:!0,prosConsList:!0,jobDescription:!0,salesEmail:!0,recruitingEmail:!0};function p(e){return d[e]}},108184:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>me,acceptCursorCompletion:()=>Ee,cancelCompletion:()=>je,doesPromptNeedAdditionalUserInput:()=>ke,handleCompletionPopupRetry:()=>Ce,improveAssistantCompletion:()=>We,improveCompletion:()=>Te,insertBlockSelectionCompletion:()=>De,insertTextSelectionCompletion:()=>Be,maybeSetPromptForCurrentAiBlock:()=>Ye,maybeUpdateAiEligibility:()=>Xe,openCompletionPopupForBlockSelectionContext:()=>he,openCompletionPopupForCursorContext:()=>ge,openCompletionPopupForPrefilledContext:()=>_e,openCompletionPopupForSavedContext:()=>ve,postProcessAICreatedStores:()=>Ve,redoCompletionRevision:()=>ze,replaceTextSelectionCompletion:()=>Ue,revertCurrentCompletionRevision:()=>He,selectPageAndOpenCompletionPopupForBlockSelectionContext:()=>ye,showCompletionErrorWithCode:()=>we,stopCompletion:()=>Ne,submitFeedbackForRevision:()=>Ze,triggerCompletionForAiBlock:()=>Fe,wrapTemporaryBlocksInList:()=>et});o(16280),o(944114),o(898992),o(823215),o(354520),o(803949),o(581454);var n=()=>o(221844),i=()=>o(908006),a=()=>o(925193),r=()=>o(700500),s=()=>o(857639),l=()=>o(416504),c=()=>o(206267),d=()=>o(386164),p=()=>o(134025),u=()=>o(370085),m=()=>o(450648),f=()=>o(179034),g=()=>o(441738),y=()=>o(919709),h=()=>o(708830),v=()=>o(532659),_=()=>o(496603),S=()=>o(534177),k=()=>o(720665),C=()=>o(449506),I=()=>o(884107),P=()=>o(901389),M=()=>o(722101),w=()=>o(246826),x=()=>o(778417),A=()=>o(436572),b=()=>o(319975),T=()=>o(725614),W=()=>o(324089),F=()=>o(751156),R=()=>o(412669),E=()=>o(659602),L=()=>o(335722),B=()=>o(862292),U=()=>o(951177),V=()=>o(401040),D=()=>o(495159),N=()=>o(556122),O=()=>o(812072),z=()=>o(594794),H=()=>o(972435),j=()=>o(962845),K=()=>o(731320),J=()=>o(299545),q=()=>o(953418),G=()=>o(20313),$=()=>o(906537),Q=()=>o(792002),X=()=>o(695625),Z=()=>o(106628),Y=()=>o(765957),ee=()=>o(430483),te=()=>o(295169),oe=()=>o(525569),ne=()=>o(630116),ie=()=>o(502438),ae=()=>o(991249),re=()=>o(329304),se=()=>o(668721),le=()=>o(178658),ce=()=>o(159495),de=()=>o(661077),pe=()=>o(102586),ue=()=>o(272200);const me=300,fe=1001;async function ge(e){const{environment:t,prompt:o=D().eB,additionalContext:n,from:i}=e,a=(0,V().gu)();a&&await Se({environment:t,prompt:o,context:a,additionalContext:n,from:i})}async function ye(e){const t=x().Ko(x().Xc()),o=(0,j().BO)(t);if(!o)return;T().setMultiSelection({multiSelection:o});const n=(0,V().rs)();if(!n)return;const i={type:"closedWithContext",context:n,futureRevisions:[]};oe().default.setState(i),await ve(e)}async function he(e){const{environment:t,prompt:o=D().eB,additionalContext:n,from:i}=e,a=(0,V().RH)();a&&await Se({environment:t,prompt:o,context:a,additionalContext:n,from:i})}async function ve(e){"closedWithContext"===oe().default.state.type&&oe().default.state.context&&await Se({...e,context:oe().default.state.context})}async function _e(e){await Se(e)}async function Se(e){const{environment:t,prompt:r,context:s,additionalContext:l,skipInitialForm:c,from:d}=e,p=oe().default.getExistingAISessionId(),u=p??(0,a().gC)();if(ke({clientPrompt:r,additionalContext:l})&&!c)return void(0,le().toggleInitialPrompt)({environment:t,from:d,prefilledValue:(0,V().oW)(r),promptForAnalytics:r,sessionId:u,context:s});if(!Boolean(p)){const e=te().default.getSessionContext(u);ue().trackAICompletionPopupOpen(t,{session_id:u,prompt_key:r.key,from:d,sessionContext:e})}T().clear({environment:t});if(ee().zD.isAssistantInWriterEnabled()){const{assistantWriterDependency:e}=await Promise.resolve().then(o.bind(o,505578)),{assistantWriterActions:n}=await e.load();n.triggerAssistantCompletion({environment:t,context:s,prompt:r,intl:H().A.getIntl(),updater:oe().default.createUpdater(),additionalContext:l,sessionId:u,from:d})}else await async function(e){const{environment:t,context:o,prompt:a,additionalContext:r,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{T().clear({environment:t}),x().IU({environment:t})}));const d=await E().g.load(),p=await I().R.clipboardActions.load(),u=await B().T.formulas.load(),{serverPrompt:m}=Ie({...e,markdownLinkifyIt:d,clipboardActions:p,formulasModule:u}),f=new(n().A)({name:"completionActions.triggerCompletion",isTemporaryData:!0});s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(f)}));const g=oe().default.state,y="completionPopup"===g.type&&"initialPrompt"===g.stage||"closedWithContext"===g.type?g.futureRevisions:[],h={type:"completionPopup",stage:"results",loading:!0,aiSessionId:l,revisions:[...y,{type:"initial",clientPrompt:a,serverPrompt:m,additionalContext:r,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:f,from:c,hasErrored:!1};s((()=>{oe().default.setState(h)})),await i().default.afterNextFlush(),await s((()=>Re({environment:t}))),await Pe({...e,updater:s})}({environment:t,context:s,prompt:r,intl:H().A.getIntl(),updater:oe().default.createUpdater(),additionalContext:l,sessionId:u,from:d})}function ke(e){const{clientPrompt:t,additionalContext:o}=e,n="translate"===t.key&&o&&o.language,i="changeTone"===t.key&&o&&o.tone;return Boolean(!n&&!i&&t.steps)}async function Ce(e){const{environment:t}=e,o=oe().default.state;if("completionPopup"===o.type&&"results"===o.stage)if(T().clear({environment:t}),ke((0,D().SA)(o)));else{const e=(0,D().SA)(o);oe().default.setState({...o,revisions:[...o.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await Pe({environment:t,updater:oe().default.createUpdater()})}}function Ie(e){const{environment:t,context:o,prompt:n,additionalContext:i,intl:a,markdownLinkifyIt:r,clipboardActions:s,formulasModule:c}=e,d=(0,m().r4)({intl:a,textValue:o.currentPage.getBlockTitleStore().getValue(),getRecordModel:o.currentPage.getRecordModel,userTimeZone:(0,l().P)()}),{previousContent:p,restContent:u,pageContent:f}=function(e){var t,o;const{environment:n,context:i,markdownLinkifyIt:a,clipboardActions:r,formulasModule:s}=e,l=i.currentPage.getContentStores()[0];let c,d;if("cursor"===i.type||"textSelection"===i.type)c=i.textSelection.start,d=i.textSelection.end;else{var p;c={store:i.stores[0].getBlockTitleStore(),index:0};const e=i.stores[i.stores.length-1].getBlockTitleStore();d={store:e,index:(null===(p=(0,Q().s6)(e))||void 0===p?void 0:p.endIndex)||0}}const u=Je(r,i.currentPage),m=r.multiTextSelectionToMarkdown({environment:n,textSelection:{start:{store:l.getBlockTitleStore(),index:0},end:d},markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:a}),f=[u,m].filter(S().O9).join("\n\n"),g=(0,G().OL)({includeNonSelectableListContainer:!1}),y=null===(t=(0,h().wI)(g).value)||void 0===t?void 0:t.store,v=null==y?void 0:y.getBlockTitleStore(),_=v&&r.multiTextSelectionToMarkdown({environment:n,textSelection:{start:c,end:{store:v,index:(null===(o=(0,Q().s6)(v))||void 0===o?void 0:o.endIndex)||0}},markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:a})||"",k=qe({environment:n,page:i.currentPage,markdownLinkifyIt:a,clipboardActions:r,formulasModule:s})||"";return{previousContent:f,restContent:_,pageContent:k}}({environment:t,context:o,clipboardActions:s,markdownLinkifyIt:r,formulasModule:c});let g,y;if("textSelection"===o.type||"blockSelection"===o.type){if("textSelection"===o.type)y=s.multiTextSelectionToMarkdown({environment:t,textSelection:o.textSelection,markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:r})??"";else if("blockSelection"===o.type){const e=_().oE(ie().default.state.stores.map((e=>e.getValue())));y=(0,U().ZI)({rootBlock:{...o.currentPage.pointer,spaceId:o.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:o.currentPage.getRecordValue,markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:r,formulasModule:c}).markdown||""}else(0,S().HB)(o);g=Ge({prompt:n,selectedText:y,pageTitle:d,pageContent:f,additionalContext:i}),g||(g=Qe({prompt:n,pageTitle:d,previousContent:p,restContent:u,pageContent:f,additionalContext:i}))}else"cursor"===o.type?(g=Qe({prompt:n,pageTitle:d,previousContent:p,restContent:u,pageContent:f,additionalContext:i}),g||(g=Ge({prompt:n,selectedText:f,pageTitle:d,additionalContext:i,pageContent:f}))):(0,S().HB)(o);if(!g)throw new Error(`Unable to find server prompt for "${n.key}" client prompt`);const v={type:"initial",pageTitle:d,selectedText:y,pageContent:f};return{serverPrompt:g.serverPrompt,initialStep:v,humanStep:g.humanStep}}async function Pe(e){const{environment:t,updater:o}=e,n=oe().default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const{aiSessionId:i}=n,a=Date.now(),r=c().JW(),s=(0,D().SA)(n);if(n.revisions[n.revisions.length-1]!==s)throw new Error("Assertion failure, expected current revision to be initial revision");const l={...s,inferenceId:r},p=n.revisions.slice(0,n.revisions.length-1),{serverPrompt:u}=l;ue().trackAICompletionPopupPreviewStart(t,{session_id:i,inference_id:r,from:n.from,prompt_key:l.clientPrompt.key,type:"completion"}),o((()=>{oe().default.setState({...n,loading:!0,revisions:[...p,l]})}));let m=!1;const f=_().nF((async()=>{m||await o((()=>Re({environment:t,setSelection:!1})))}),me),g=async function(e,t,o){const{currentSpaceStore:n}=Y().default.getState();if(!n)return;if(!t.trim())return;const i=await C().callStreamApi({eventName:"getCompletion",environment:e,data:{id:c().JW(),aiSessionId:o,context:{type:"promptTitle",selectedText:t},model:"default",metadata:{},spaceId:n.id,isSpacePermission:!1},headers:(0,d().WS)({spaceId:n.id})});if("success"!==i.type)return;const a=[];if(v().hS.is(i.data))for await(const s of i.data){if("success"!==s.type)return;a.push(s.completion)}const r=a.join("").trim();return r||void 0}(t,(0,D().z1)(s),i),y=xe({environment:t,inferenceId:r,aiSessionId:i,serverPrompt:u,targetStore:n.context.currentPage,inferenceReason:"writer",attribution:{blockId:n.context.currentPage.id},metadata:{blockId:n.context.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:n}=e;o((()=>{const e=oe().default.state;"completionPopup"===e.type&&"results"===e.stage&&(oe().default.setState({...e,revisions:[...p,{...l,completion:t,userSearchCache:n}]}),f())}))}}),[h,S]=await Promise.all([g,y]);if("error_modal_shown"===S.type||"upsell_modal_shown"===S.type)return void o((()=>Oe()));m=!0;const{completion:k,userSearchCache:I}=S;await o((()=>{ue().trackAICompletionPopupPreviewEnd(t,{session_id:i,inference_id:r,preview_time:Date.now()-a,type:"completion"});const e=oe().default.state;if("completionPopup"===e.type&&"results"===e.stage)return oe().default.setState({...e,revisions:[...p,{...l,completion:k,userSearchCache:I,promptTitle:h}],loading:!1}),Re({environment:t,setSelection:!0})}))}function Me(e){const{environment:t,inMemoryRecordCache:o,completion:n,userSearchCache:i,store:a,prompt:r,additionalContext:s,isComplete:l,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d,clipboardActions:m}=e;F().createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,canUndo:!0,perform:e=>{const f=a.clone(o);f.getContentIds().forEach((t=>{F().applyOperation({store:f,operation:(0,u().TQ)({blockParentId:f.id,recordId:t}),transaction:e})}));const g=m.markdownToBlocks({environment:t,text:n,inMemoryRecordCache:o,transaction:e,markdownOptions:(0,O().ge)(i),markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:d});if(!g)return;const h=f.getContentStore();g.reverse().forEach((t=>{M().Hs({parentStore:h,prependStore:t,transaction:e}),w().zv({store:t,data:{parent_id:f.id,parent_table:f.table,alive:!0},transaction:e})})),F().applyOperation({store:f,operation:p().op.update({pointer:f.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:r.key}}),transaction:e});const v=s?(0,y().x9d)(s.prompt):[];b().R9({environment:t,store:f.getBlockTitleStore(),value:v,transaction:e}),l&&$e({transaction:e,completionState:{clientPrompt:r,additionalContext:s}})}})}function we(e){const t=H().A.getIntl();return 451===e?A().D6({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):413===e?A().D6({label:t.formatMessage({id:"completionActions.promptOrAttachmentTooLarge",defaultMessage:"Query or attachment is too large. Please revise your input and try again. (413)"})}):502===e||503===e||504===e?A().D6({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void A().D6({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}async function xe(e){var t;const{environment:o,inferenceId:n,serverPrompt:i,targetStore:a,onUpdate:r,aiSessionId:l,metadata:c,attribution:d,inferenceReason:p}=e,u=N().qm()?N().QJ:C().callStreamApi,m=null===(t=Y().default.state.currentSpaceStore)||void 0===t?void 0:t.id,f=(0,K().Jh)(a);if(!m)return we(fe),{type:"error_modal_shown"};const y=await u({eventName:"getCompletion",environment:o,data:{id:n,context:i,model:"default",spaceId:m,isSpacePermission:f,aiSessionId:l,metadata:c,attributionForLogging:d,inferenceReason:p}});if("success"!==y.type)return P().Qg(y),{type:"error_modal_shown"};let h="",_="";const S=new Map,k=await Z().T.searchActions.load(),I=e=>k.searchUsersByNameWithNoSpaces({environment:o,query:e,membersOnly:!0,shouldUseEdgeCacheRollout:!0}),M=await(0,re().Bw)(o,{spaceId:m,userId:o.currentUser.id,amount:"unknown",name:"ai_usage"});if(v().hS.is(y.data))for await(const s of y.data)if("success"===s.type)h+=s.completion,(0,O().Hi)(h)||(_=Ae(h),await(0,O().J9)(h,I,S)),r({completion:_,userSearchCache:new Map(S)});else if("error"===s.type)return(0,g().Nf)(s.errorCode)&&null!=M&&M.upsell?(ae().K(o,{from:"ai_limit_in_app",upsell:M.upsell}),{type:"upsell_modal_shown"}):(we(s.errorCode),{type:"error_modal_shown"});const w=Ae(h);return w?(await(0,O().J9)(w,I,S),{type:"success",completion:w,userSearchCache:new Map(S)}):(we(600),s().log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:n}}),ue().trackAIEmptyResponse(o,{promptKey:i.type}),{type:"error_modal_shown"})}function Ae(e){return e.replace(/<br>/g,"\n")}function be(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,S().HB)(t.type)}async function Te(e,t){const o=oe().default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;let n=!1;const i=oe().default.createUpdater(),a=(0,D().tN)(o);if(!a.completion)return;const r=o.context,s=a.completion,l="continueWriting"===t.type?s:"",d=Date.now(),p=c().JW();ue().trackAICompletionPopupPreviewStart(e,{session_id:o.aiSessionId,inference_id:p,from:o.from,prompt_key:(0,D().SA)(o).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const u=[...o.revisions,...o.futureRevisions],m={type:"followup",improvement:t,completion:l,userSearchCache:new Map,inferenceId:p,hasFeedback:!1,previousRevision:(0,D().hb)(o)},f={...o,loading:!0,revisions:[...u,m],futureRevisions:[]},g=await E().g.load(),y=await I().R.clipboardActions.load(),h=await B().T.formulas.load(),v=function(e){const{environment:t,completionState:o,markdownLinkifyIt:n,clipboardActions:i,formulasModule:a}=e,{context:r}=o,s=[];for(const l of(0,D().Mt)(o))if("initial"===l.type){const{initialStep:e,humanStep:o}=Ie({environment:t,context:r,prompt:l.clientPrompt,additionalContext:l.additionalContext,intl:H().A.getIntl(),markdownLinkifyIt:n,clipboardActions:i,formulasModule:a});if(void 0===l.completion)throw new Error("Assertion failure, followup without initial completion");s.unshift(e,o,{type:"assistant",result:l.completion})}else if("followup"===l.type){const e=[be({improvement:l.improvement})];l.completion&&e.push({type:"assistant",result:l.completion}),s.unshift(...e)}else(0,S().HB)(l);N().qm()&&console.log("Transcript",JSON.stringify(s,null,2));return{type:"writerFollowup",transcript:s}}({environment:e,completionState:f,markdownLinkifyIt:g,clipboardActions:y,formulasModule:h});i((()=>{oe().default.setState(f)}));const k=_().nF((async()=>{n||await i((()=>Re({environment:e,setSelection:!1})))}),me),C=await xe({environment:e,inferenceId:p,serverPrompt:v,targetStore:r.currentPage,aiSessionId:o.aiSessionId,inferenceReason:"writer",attribution:{blockId:o.context.currentPage.id},metadata:{blockId:r.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:o}=e;i((()=>{const e=oe().default.state;"completionPopup"===e.type&&"results"===e.stage&&(oe().default.setState({...e,revisions:[...u,{...m,completion:l+t,userSearchCache:o}]}),k())}))}});if("error_modal_shown"===C.type||"upsell_modal_shown"===C.type)return void i((()=>Oe()));n=!0;const{completion:P,userSearchCache:M}=C;i((()=>{ue().trackAICompletionPopupPreviewEnd(e,{session_id:f.aiSessionId,inference_id:p,preview_time:Date.now()-d,type:"follow_up_improvement"}),oe().default.setState({...f,loading:!1,revisions:[...u,{...m,completion:l+P,userSearchCache:M}]}),Re({environment:e,setSelection:!0})}))}async function We(e,t){const n=oe().default.state;if("assistantCompletionPopup"!==n.type||"results"!==n.stage)return;const i=oe().default.createUpdater();if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");const{assistantDependency:a}=await Promise.resolve().then(o.bind(o,650829)),{assistantActions:r}=await a.load(),s=te().default.getActiveSessionId();if(!s)throw new Error("No active assistant session");await r.commitHumanStep({environment:e,text:(0,y().x9d)(t.prompt),sessionId:s,assistantSurfaceType:"writer"}),await i((()=>{const e=oe().default.state;if("assistantCompletionPopup"!==e.type||"results"!==e.stage)return;const t=_().HV(ie().default.state.stores);oe().default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}async function Fe(e){const{environment:t,store:o,prompt:i,additionalContext:a}=e,r=o.getRecordStoreUIRoot();if(!function(e){return e instanceof ne().Bv}(r))return;const s=await E().g.load(),d=await I().R.clipboardActions.load(),p=await B().T.formulas.load(),u=function(e){const{environment:t,rootStore:o,store:n,prompt:i,additionalContext:a,markdownLinkifyIt:r,clipboardActions:s,formulasModule:c}=e,d=H().A.getIntl(),p=(0,m().r4)({intl:d,textValue:o.getBlockTitleStore().getValue(),getRecordModel:o.getRecordModel,userTimeZone:(0,l().P)()}),u=qe({environment:t,page:o,markdownLinkifyIt:r,clipboardActions:s,formulasModule:c})||"";if("summarizeMeetingTranscript"===i.key)return{type:"summarizeMeetingTranscript",pageTitle:p,pageContent:u};if("helpMeWrite"===i.key){var f,g,y,v,_;const e={type:"helpMeWrite",pageTitle:p,pageContent:u,prompt:(null==a?void 0:a.prompt)??""},i=(0,G().Ag)({includeNonSelectableListContainer:!1,rootStore:n.getHighestContentBlockUIAncestor()});if(!i)return e;const l=(0,G().Xs)(n,i.children);if(!l)return e;const c=o.getContentStores()[0],d=(0,h().zJ)(i,l),m=d.prev?d.prev.value.store.getBlockTitleStore():null===(f=d.parent)||void 0===f?void 0:f.value.store.getBlockTitleStore(),k=c&&m&&s.multiTextSelectionToMarkdown({environment:t,textSelection:{start:{store:c.getBlockTitleStore(),index:0},end:{store:m,index:(null===(g=(0,Q().s6)(m))||void 0===g?void 0:g.endIndex)??0}},markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:r})||"",C=[Je(s,o),k].filter(S().O9).join("\n\n"),I=null===(y=(0,h().Eq)(i,l).next)||void 0===y?void 0:y.value.store.getBlockTitleStore(),P=null===(v=(0,h().wI)(i).value)||void 0===v?void 0:v.store,M=null==P?void 0:P.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:p,previousContent:C,restContent:I&&M&&s.multiTextSelectionToMarkdown({environment:t,textSelection:{start:{store:I,index:0},end:{store:M,index:(null===(_=(0,Q().s6)(M))||void 0===_?void 0:_.endIndex)||0}},markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:r})||"",prompt:(null==a?void 0:a.prompt)??""}}return"summarize"===i.key||"findActionItems"===i.key?{type:i.key,pageTitle:p,selectedText:u}:void 0}({environment:t,rootStore:r,store:o,prompt:i,additionalContext:a,markdownLinkifyIt:s,clipboardActions:d,formulasModule:p});if(!u)return;const f=_().nF(Me,me),g=new(n().A)({name:"completionActions.triggerCompletionForAiBlock",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(g);const y=await L().S.load(),v=await xe({environment:t,inferenceId:c().JW(),serverPrompt:u,targetStore:r,aiSessionId:c().JW(),metadata:{blockId:r.id},inferenceReason:"writer",attribution:{blockId:r.id},onUpdate(e){let{completion:n,userSearchCache:r}=e;f({inMemoryRecordCache:g,environment:t,store:o,completion:n,userSearchCache:r,prompt:i,additionalContext:a,isComplete:!1,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:y,clipboardActions:d})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(g),"error_modal_shown"===v.type||"upsell_modal_shown"===v.type)return;const{completion:k,userSearchCache:C}=v;Me({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:o,completion:k,userSearchCache:C,prompt:i,additionalContext:a,isComplete:!0,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:y,clipboardActions:d})}async function Re(e){const{environment:t,setSelection:o}=e,n=oe().default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const a=(0,D().tN)(n),{completion:r,userSearchCache:s}=a,{context:l,inMemoryRecordCache:c}=n;if("cursor"!==l.type)return;c.clearCache();const{currentBlock:d,currentParent:p,currentPage:u}=l,m=p||u.getContentStore(),{insertTitle:f,insertCompletion:g}=Le({completion:r||"",currentPage:u});f&&F().createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{const o=u.clone(c).getBlockTitleStore();o&&b().R9({environment:t,store:o,value:(0,y().x9d)(f),transaction:e})}});const[h,v,S]=await Promise.all([E().g.load(),L().S.load(),I().R.clipboardActions.load()]);if(g){const e=F().createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!g)return;const o=S.markdownToBlocks({environment:t,text:g,inMemoryRecordCache:c,transaction:e,markdownOptions:(0,O().ge)(s),markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:v});if(!o)return;Ve(t,o);Ke({parentStore:m.clone(c),insertAfter:null==d?void 0:d.clone(c),insertStores:o,transaction:e});return o.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(m)))}}).performResult;if(!e||!e.length)return;o&&x().td({environment:t,stores:e}),await i().default.afterNextFlush();const n=oe().default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const a=_().oE(e.map((e=>X().T.findNodeFromStore(e))));if(!(a[0]?(0,q().NM)(a[0]):void 0))return;oe().default.setState({...n,context:{...n.context,origin:_().HV(e)}})}else if(d){const e=(0,D().IC)(d),i=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);F().createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{Ke({parentStore:m.clone(c),insertAfter:d.clone(c),insertStores:[],transaction:e})}}),o&&x().IU({environment:t}),d.getAlive()?oe().default.setState({...n,context:{...l,origin:d}}):oe().default.setState({...n,context:{...l,origin:i}})}}function Ee(e){const{environment:t,transaction:o,selectInsertion:n,exitType:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:c}=e,d=oe().default.state;if(oe().default.invalidateLastUpdater(),"completionPopup"!==d.type||"results"!==d.stage||"cursor"!==d.context.type)return;const{completion:u,userSearchCache:m,inferenceId:f}=(0,D().tN)(d);if(!u)return;const{currentBlock:g,currentParent:h,currentPage:v}=d.context,_=h||v.getContentStore();oe().default.resetStore(e);const{insertTitle:S,insertCompletion:k}=Le({completion:u,currentPage:v});S&&"convert_to_ai_block"!==a&&b().R9({environment:t,store:v.getBlockTitleStore(),value:(0,y().x9d)(S),transaction:o});const C=c.markdownToBlocks({environment:t,text:k,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,O().ge)(m),markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l});if(C){if(g&&"convert_to_ai_block"===a){var I;const e=w().Wv({environment:t,type:r().xd.aiBlock,inMemoryRecordCache:g.inMemoryRecordCache,transaction:o,spaceId:g.pointer.spaceId});M().WH({parentStore:_,afterStore:g,insertStore:e,transaction:o}),(0,J().P4)(g)&&M().TF({parentStore:_,childToRemoveStore:g,transaction:o});const n=(0,D().tN)(d);if("initial"!==n.type)throw new Error("Assertion failure, currentRevision.type is not initial");const i=null===(I=n.additionalContext)||void 0===I?void 0:I.prompt;i&&F().applyOperation({store:e,operation:p().op.set({pointer:e.pointer,path:["properties","title"],args:[[i]]}),transaction:o}),F().applyOperation({store:e,operation:p().op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:n.clientPrompt.key}}),transaction:o}),Ke({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:C,transaction:o})}else Ke({parentStore:_,insertAfter:g,insertStores:C,transaction:o}),function(e){const{environment:t,parentStore:o,insertStores:n,selectInsertion:a}=e,r=n.map((e=>e.cloneWithNewUIParent(o)));i().default.afterNextFlush((()=>{x().bG({environment:t,stores:r}),a&&function(e){const{environment:t,insertedStores:o}=e;$().clear(t),i().default.afterNextFlush((()=>{const e=(0,j().BO)(o);e&&T().setMultiSelection({multiSelection:e})}))}({environment:t,insertedStores:r})}))}({environment:t,parentStore:_,insertStores:C,selectInsertion:n});$e({transaction:o,completionState:(0,D().SA)(d)}),f&&ue().trackAIAction(t,{type:"cursor_completion",inference_id:f,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}function Le(e){const{completion:t,currentPage:o}=e;let n,i;const a=Boolean(o.getBlockTitleStore().getValue()),r=o.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!a&&r){const{title:e,content:o}=function(e){const t=e.trim().split("\n"),o=t[0];return o.startsWith("# ")?{title:o.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");n=e,i=o}else i=t;return{insertTitle:n,insertCompletion:i}}function Be(e){var t,o;const{environment:n,transaction:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:r,clipboardActions:s}=e,l=oe().default.state;if(oe().default.invalidateLastUpdater(),"completionPopup"!==l.type||"results"!==l.stage||"textSelection"!==l.context.type)return;const{completion:c,userSearchCache:d}=(0,D().tN)(l);if(!c)return;const{endBlock:p,endBlockParent:u,currentPage:m}=l.context,f=u||m.getContentStore();oe().default.resetStore(e);const g=s.markdownToBlocks({environment:n,text:c,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:i,markdownOptions:(0,O().ge)(d),markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:r});if(!g)return;Ke({parentStore:f,insertAfter:p,insertStores:g,transaction:i}),$e({transaction:i,completionState:(0,D().SA)(l)});const h=g.map((e=>e.cloneWithNewUIParent(f))),v=null===(t=_().$1(h))||void 0===t?void 0:t.getBlockTitleStore(),S=null===(o=_().HV(h))||void 0===o?void 0:o.getBlockTitleStore();v&&S&&T().setMultiSelection({multiSelection:{start:{index:0,store:v},end:{index:S.getValue()?y().q4_(S.getValue()).length:0,store:S}}})}function Ue(e){const{environment:t,transaction:o,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i,clipboardActions:a}=e,r=oe().default.state;if(oe().default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"textSelection"!==r.context.type)return;const s=(0,D().tN)(r);s.completion&&(T().setMultiSelection({multiSelection:r.context.textSelection}),a.pasteMarkdown({environment:t,text:s.completion,transaction:o,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,O().ge)(s.userSearchCache),markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),$e({transaction:o,completionState:(0,D().SA)(r)}),oe().default.resetStore(e))}function Ve(e,t){for(const o of t)W().In({environment:e,blockStore:o})}function De(e){const{environment:t,transaction:o,replace:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a,clipboardActions:r}=e,s=oe().default.state;if(oe().default.invalidateLastUpdater(),"completionPopup"!==s.type||"results"!==s.stage||"blockSelection"!==s.context.type)return;const{completion:l,userSearchCache:c}=(0,D().tN)(s);if(!l)return;const{stores:d}=s.context,p=_().HV(d);if(!p)return;const u=p.getRecordStoreUIParent();if(!u)return;oe().default.resetStore(e);const m=r.markdownToBlocks({environment:t,text:l,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,O().ge)(c),markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a});if(!m)return;if(Ke({parentStore:u,insertAfter:p,insertStores:m,transaction:o}),n)for(const g of d){const e=g.getRecordStoreUIParent();e&&M().TF({parentStore:e,childToRemoveStore:g,transaction:o})}$e({transaction:o,completionState:(0,D().SA)(s)});const f=m.map((e=>e.cloneWithNewUIParent(u)));x().td({environment:t,stores:f})}function Ne(e){const t=oe().default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const o=(0,D().tN)(t);o.completion&&(ue().trackAICompletionPopupPreviewStoppedByUser(e,{session_id:t.aiSessionId,inference_id:o.inferenceId}),oe().default.invalidateLastUpdater(),oe().default.setState({...t,loading:!1}),Re({environment:e,setSelection:!0}))}function Oe(){const e=oe().default.state;"completionPopup"===e.type&&"results"===e.stage&&oe().default.setState({...e,hasErrored:!0})}function ze(e){const t=oe().default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&(oe().default.invalidateLastUpdater(),oe().default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),Re({environment:e,setSelection:!0}))}function He(e){const{environment:t,purgeFromHistory:o}=e,n=oe().default.state;if("completionPopup"!==n.type||"results"!==n.stage||0===n.revisions.length)return;const i=n.revisions[n.revisions.length-1];return oe().default.invalidateLastUpdater(),oe().default.setState({...n,hasErrored:!1,loading:!1,revisions:n.revisions.slice(0,-1),futureRevisions:o?n.futureRevisions:[i,...n.futureRevisions]}),Re({environment:t,setSelection:!0}),i}function je(e){oe().default.invalidateLastUpdater();const{environment:t,sessionId:o,inferenceId:n,exitType:i}=e,a=oe().default.state;if("completionPopup"!==a.type||"initialPromptForAIBlock"===a.stage)return;if((!t.device.isMobileNative||"error_modal"!==i&&"upsell_modal"!==i)&&("cursor"===a.context.type||"textSelection"===a.context.type?T().setMultiSelection({multiSelection:a.context.textSelection}):"blockSelection"===a.context.type?x().td({environment:t,stores:a.context.stores}):(0,S().HB)(a.context)),oe().default.resetStore(e),ue().trackAICompletionPopupClose(t,{session_id:o,inference_id:n,exit_type:i}),"results"!==a.stage)return;const r=(0,D().tN)(a);r.inferenceId&&ue().trackAIAction(t,{type:"cursor_completion",inference_id:r.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()})}function Ke(e){const{parentStore:t,insertAfter:o,insertStores:n,transaction:i}=e,a=_().o8(n).reverse();for(const r of a)o?M().WH({parentStore:t,insertStore:r,afterStore:o,transaction:i}):M().Hs({parentStore:t,prependStore:r,transaction:i}),w().zv({store:r,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:i});o&&(0,J().P4)(o)&&M().TF({parentStore:t,childToRemoveStore:o,transaction:i})}function Je(e,t){return e.serializePagePropertiesAsText({rootBlock:{...t.pointer,spaceId:t.getSpaceId()},getRecordValue:t.getRecordValue})}function qe(e){const{environment:t,page:o,markdownLinkifyIt:n,clipboardActions:i,formulasModule:a}=e,r=_().oE(o.getContentStores().map((e=>e.getValue())));return[Je(i,o),(0,U().ZI)({rootBlock:{...o.pointer,spaceId:o.getSpaceId()},getRecordValue:o.getRecordValue,blockValues:r,isWindows:t.device.isWindows,markdownSerializationOptions:(0,O().ez)(),markdownLinkifyIt:n,formulasModule:a}).markdown].filter(S().O9).join("\n\n")}function Ge(e){const{prompt:t,pageTitle:o,pageContent:n,selectedText:i,additionalContext:a}=e;N().qm()&&console.log("textSelectionPromptToServerContext",e);const r="string"==typeof t.name?t.name:H().A.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:o,selectedText:i},humanStep:{type:"human",prompt:r}};if("translate"===t.key){const e=(null==a?void 0:a.language)??"english";return{serverPrompt:{type:t.key,text:i,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==a?void 0:a.tone)??"professional";return{serverPrompt:{type:t.key,text:i,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==a?void 0:a.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:i,pageTitle:o,pageContent:n},humanStep:{type:"human",prompt:e}}}}function $e(e){const{transaction:t,completionState:{clientPrompt:o,additionalContext:n,promptTitle:i}}=e,a=(0,pe().MY)({clientPrompt:o,additionalContext:n,promptTitle:i});if(!a)return;const{currentUserSettingsStore:r}=Y().default.state;if(!r)return;(0,ce().L_)(r,a)||(0,pe().L1)(a,r,t)}function Qe(e){const{prompt:t,pageTitle:o,previousContent:n,restContent:i,additionalContext:a,pageContent:r}=e;N().qm()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:H().A.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:o,previousContent:n,restContent:i},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==a?void 0:a.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:o,previousContent:n,restContent:i,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==a?void 0:a.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:n,pageTitle:o},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==a?void 0:a.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:r},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:o,selectedText:r},humanStep:{type:"human",prompt:s}}:void 0}async function Xe(e,t,o){let n;const i=N().TI();if(i.debug)n=402!==i.showErrorCode;else{if(se().A.state&&se().A.state.isEligible&&"unlimited"===se().A.state.type&&!o){const e=se().A.state.lastUpdatedAt;if(Date.now()-e<10*k().Xb)return!0}const i=await C().callApi({eventName:"getAIUsageEligibility",environment:e,data:{spaceId:t},headers:(0,d().WS)({cellId:void 0,spaceId:t})});if("success"===i.type){var a,r;n=i.data.isEligible,n&&R().K.state&&R().K.setState(!1);const e=!1===(null===(a=se().A.state)||void 0===a?void 0:a.isEligible)&&(null===(r=se().A.state)||void 0===r?void 0:r.requestedAccess),t=i.data.researchModeUsage??0;se().A.setState({...i.data,lastUpdatedAt:Date.now(),researchModeUsage:t,...!1===i.data.isEligible&&{requestedAccess:e}})}}return void 0!==n&&de().P.setState(n),n}async function Ze(e){const{environment:t,revision:n,type:i,userContent:a,shareWithNotion:r,userOptIn:s}=e;if(ee().zD.isAssistantInWriterEnabled()){const{assistantDependency:e}=await Promise.resolve().then(o.bind(o,650829)),{assistantActions:n}=await e.load(),l=te().default.getActiveSessionId();if(!l)throw new Error("No assistantSessionId.");n.saveFeedback({environment:t,inferenceId:"",type:"thumbsup"===i?"assistant_thumbs_up":"assistant_thumbs_down",sessionId:l,userComment:a,shareWithNotion:r,userOptIn:s})}else{const e=oe().default.state;if(!n.inferenceId||"completionPopup"!==e.type||"results"!==e.stage)return;ue().trackAIAction(t,{type:"cursor_completion",inference_id:n.inferenceId,feedback_type:i,timestamp:(new Date).toUTCString(),user_comment:a,share_with_notion:r,user_opt_in:s}),oe().default.setState({...e,revisions:e.revisions.map((e=>e.inferenceId===n.inferenceId?{...e,hasFeedback:!0}:e))})}}function Ye(e,t){const o=oe().default.state;"completionPopup"===o.type&&"initialPromptForAIBlock"===o.stage&&F().createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,canUndo:!0,perform:n=>{b().R9({environment:e,store:o.store.getBlockTitleStore(),value:(0,y().x9d)(t),transaction:n})}})}function et(e){const{environment:t,stores:o,listId:n,inMemoryRecordCache:i,transaction:a}=e,r=new(ne().pm)({environment:t,pointer:{table:f().ev,id:n||(0,z().Z1)({environment:t,table:f().ev,spaceId:o[0].getSpaceId()}),spaceId:o.length>0?o[0].getSpaceId():a.spaceId},recordStoreOptions:{inMemoryRecordCache:i,userId:t.currentUser.id},path:["content"]});for(const s of o)M().BC({parentStore:r,appendStore:s,transaction:a}),w().zv({store:s,data:{parent_id:r.id,parent_table:r.table,alive:!0},transaction:a});return r}},123411:(e,t,o)=>{o.d(t,{X:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"4.96 2 10.08 15.99",svg:(0,o(474848).jsx)("path",{d:"M12.21 13.71c-.34 0-.62-.28-.62-.62 0-1.31.7-2.45 1.32-3.46.12-.2.24-.39.36-.58.34-.58.53-1.3.53-2.06 0-2.06-1.7-3.73-3.79-3.73S6.22 4.93 6.22 6.99c0 .76.18 1.47.53 2.06.11.19.23.39.35.58l.023.037c.614 1 1.307 2.129 1.297 3.423 0 .34-.24.61-.63.62-.35 0-.62-.28-.62-.63 0-.96-.55-1.85-1.14-2.8q-.091-.15-.185-.3-.095-.15-.185-.3c-.46-.78-.7-1.71-.7-2.69 0-2.74 2.26-4.98 5.04-4.98s5.04 2.23 5.04 4.98c0 .98-.24 1.92-.7 2.69-.12.2-.24.4-.37.61-.59.95-1.14 1.84-1.14 2.8 0 .34-.28.62-.62.63zm-1.26 4.28h-1.9c-.35 0-.62-.28-.62-.62s.28-.62.62-.62h1.9c.34 0 .62.28.62.62s-.28.62-.62.62M8.1 15.85h3.8c.34 0 .62-.28.62-.62s-.28-.62-.62-.62H8.1c-.34 0-.62.28-.62.62s.27.62.62.62"})},i=(0,o(340498).wt)("lightBulbBright",n)},159495:(e,t,o)=>{o.d(t,{$S:()=>d,I4:()=>s,IQ:()=>c,L_:()=>l,c0:()=>p});o(898992),o(354520);var n=()=>o(206267),i=()=>o(755199),a=()=>o(102586);function r(e,t){return e.id===t.id}function s(e,t,o){const n=c(t).slice(),s=n.findIndex((t=>r(e,t)));-1===s?n.unshift(e):n.splice(s,1,e),(0,a().Uj)(e.action,t,o),i().mJ({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:n}})}function l(e,t){for(const o of c(e))if((0,a().if)(o.action,t))return o}function c(e){var t;return(null===(t=e.getModel())||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.favorite_ai_actions)??[]}function d(e,t,o){const n=c(t).filter((t=>!r(t,e)));i().mJ({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:n}})}function p(e){return{id:n().JW(),name:e.promptTitle??"",action:{...e,promptTitle:void 0}}}},178658:(e,t,o)=>{o.r(t),o.d(t,{closeInitialPromptAndEndSession:()=>M,closeInitialPromptButContinueSession:()=>w,openHelpMeWriteGenericPopup:()=>b,retryInitialPrompt:()=>P,showInitialPromptForAIBlock:()=>x,toggleInitialPrompt:()=>A});var n=()=>o(908006),i=()=>o(925193),a=()=>o(206267),r=()=>o(534177),s=()=>o(449506),l=()=>o(725614),c=()=>o(401040),d=()=>o(68465),p=()=>o(231722),u=()=>o(393255),m=()=>o(765957),f=()=>o(430483),g=()=>o(295169),y=()=>o(525569),h=()=>o(217429),v=()=>o(502438),_=()=>o(24157),S=()=>o(272200),k=()=>o(972911),C=()=>o(286088);function I(e,t){if((0,C().Ku)(e),!("completionPopup"!==t.type&&"assistantCompletionPopup"!==t.type||"results"!==t.stage&&"initialPrompt"!==t.stage||"textSelection"!==t.context.type&&"cursor"!==t.context.type)){const e=t.context.textSelection;n().default.afterNextFlush((()=>l().setMultiSelection({multiSelection:e})))}}function P(e){y().default.invalidateLastUpdater();const{environment:t}=e,{state:o}=y().default;if("completionPopup"!==o.type||"results"!==o.stage)return;t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(o.inMemoryRecordCache);const n={type:"completionPopup",stage:"initialPrompt",prefilledValue:"",context:o.context,aiSessionId:o.aiSessionId,from:o.from,futureRevisions:[...o.revisions,...o.futureRevisions]};y().default.setState(n)}function M(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&I(e,y().default.state),y().default.setState({type:"closed"})}function w(e){const{state:t}=y().default;I(e,t),"completionPopup"===t.type&&"initialPrompt"===t.stage&&y().default.setState({type:"closedWithContext",context:t.context,aiSessionId:t.aiSessionId,futureRevisions:t.futureRevisions}),setTimeout((()=>{"closedWithContext"===y().default.state.type&&y().default.reset()}),1)}function x(e){y().default.setState({...e,type:"completionPopup",stage:"initialPromptForAIBlock",from:"ai_block",prefilledValue:"",aiSessionId:a().JW()}),T({environment:e.environment,promptForAnalytics:e.clientPrompt})}async function A(e){const{environment:t,from:n}=e;let{context:a,prefilledValue:r,sessionId:l}=e;const{assistantDependency:d}=await Promise.resolve().then(o.bind(o,650829)),u=await d.load();if(!(await u.assistantMenuActions.closeAssistantRightHandSideMenu({environment:t})))return;let g={type:"closed"};if("closed"===y().default.state.type||"closedWithContext"===y().default.state.type){if(!a&&v().default.state.stores.length>0){const e=_().default.state;a="empty"===e.mode?(0,c().RH)():(0,p().kM)(e.multiSelection)?(0,c().gu)():(0,c().rs)()}a&&(r||(r=""),l||(l=(0,i().gC)()),g=f().zD.isAssistantInWriterEnabled()?{type:"assistantCompletionPopup",stage:"initialPrompt",context:a,from:n,prefilledValue:r,sessionId:l,loading:!1,hasErrored:!1}:{type:"completionPopup",stage:"initialPrompt",context:a,from:n,prefilledValue:r,aiSessionId:l,futureRevisions:[]},m().default.state.currentSpaceStore&&s().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"writer",spaceId:m().default.state.currentSpaceStore.id,id:"assistantCompletionPopup"===g.type?l:g.aiSessionId,metadata:{from:n}}}),"spacebar"===n&&(0,k().onSpaceForAiTriggered)(t))}y().default.setState(g),T(e)}function b(e){const{title:t,environment:o,prefilledValue:n,from:i}=e,s=(0,c().gu)();if(!s)return;let l;if((0,r().O9)(t)){const e=t?(0,d().gB)({customPrompt:n??t,isPageEmpty:!0}):d().am;l={promptForAnalytics:e,prefilledValue:(0,c().oW)(e)}}else l={prefilledValue:n,promptForAnalytics:void 0};A({environment:o,from:i??"page_menu",sessionId:a().JW(),context:s,...l})}function T(e){const{environment:t,promptForAnalytics:o}=e,{state:n}=y().default;if(("completionPopup"===n.type||"assistantCompletionPopup"===n.type)&&"results"!==n.stage){"initialPromptForAIBlock"===n.stage||h().default.checkGate({gateName:"mobile_assistant_prevent_clear_selection"})||l().clear({environment:t});const e="assistantCompletionPopup"===n.type?n.sessionId:n.aiSessionId,i=g().default.getSessionContext(e);S().trackAICompletionPopupOpen(t,{session_id:"assistantCompletionPopup"===n.type?n.sessionId:n.aiSessionId,prompt_key:(null==o?void 0:o.key)??("completionPopup"!==n.type||n.prefilledValue?"unknown":"alternative_ui_empty_input"),from:n.from,sessionContext:i}),u().VN({dismissed:!1,environment:t})}}},272200:(e,t,o)=>{o.r(t),o.d(t,{trackAIAction:()=>s,trackAIAssistantEngineError:()=>I,trackAIAssistantSelfHealingRetries:()=>P,trackAIBlockAction:()=>d,trackAICompletionPopupClose:()=>f,trackAICompletionPopupHistoryNavigation:()=>y,trackAICompletionPopupOpen:()=>m,trackAICompletionPopupPreviewEnd:()=>_,trackAICompletionPopupPreviewStart:()=>h,trackAICompletionPopupPreviewStoppedByUser:()=>S,trackAICompletionPopupRetry:()=>g,trackAICompletionPopupUpdatePromptText:()=>v,trackAIDataSharingOptInSubmit:()=>k,trackAIEmptyResponse:()=>C,trackAIFavoriteAction:()=>c,trackAiAutofillAction:()=>p,trackAiAutofillSettingsAction:()=>u,trackUserFlow:()=>l});var n=()=>o(679924),i=()=>o(650829),a=()=>o(430483),r=()=>o(217429);function s(e,t){const{user_comment:o,...i}=t;(0,n().v)(e,"ai_action",i)}function l(e,t,o){const i={site:"client",...o};(0,n().v)(e,t,i)}function c(e,t){(0,n().v)(e,"ai_favorite_action",t)}function d(e,t){(0,n().v)(e,"ai_block_action",t)}function p(e,t){(0,n().v)(e,"ai_autofill_action",t),r().default.logEvent("ai_autofill_action",1,{action_type:t.type})}function u(e,t){(0,n().v)(e,"ai_autofill_settings_action",t)}function m(e,t){if(a().zD.isXMLAssistantEnabled()){var o;const n=(null===(o=t.sessionContext)||void 0===o?void 0:o.evaluator.getTranscript())??[];i().assistantDependency.load().then((o=>{let{assistantAnalyticsActions:i}=o;i.trackAssistantOpened(e,{from:t.from,sessionId:t.session_id,isReminder:!1,reminderType:void 0,startTimestamp:Date.now(),transcript:n,hasQuery:!1,searchSessionId:void 0})}))}else(0,n().v)(e,"ai_completion_popup_open",{session_id:t.session_id,prompt_key:t.prompt_key,from:t.from})}function f(e,t){(0,n().v)(e,"ai_completion_popup_close",t),r().default.logEvent("ai_completion_popup_close",1,{exit_type:t.exit_type})}function g(e,t){(0,n().v)(e,"ai_completion_popup_retry",t)}function y(e,t){(0,n().v)(e,"ai_completion_popup_history_navigation",t)}function h(e,t){(0,n().v)(e,"ai_completion_popup_preview_start",t),r().default.logEvent("ai_completion_popup_preview_start",1,{from:t.from,prompt_key:t.prompt_key})}function v(e,t){(0,n().v)(e,"ai_completion_popup_update_prompt_text",t)}function _(e,t){(0,n().v)(e,"ai_completion_popup_preview_end",t),r().default.logEvent("ai_completion_popup_preview_end",1,{preview_time:t.preview_time})}function S(e,t){(0,n().v)(e,"ai_completion_popup_preview_stopped_by_user",t)}function k(e,t){(0,n().v)(e,"ai_user_data_sharing_opt_in_submit",t)}function C(e,t){(0,n().v)(e,"getCompletion.emptyResponse",t),r().default.logEvent("getCompletion.emptyResponse",1,{promptKey:t.promptKey})}function I(e,t){(0,n().v)(e,"ai_assistant_error",t)}function P(e,t){(0,n().v)(e,"ai_assistant_self_healing_retries",t)}},401040:(e,t,o)=>{o.d(t,{RH:()=>f,gu:()=>g,oW:()=>m,rs:()=>y});var n=()=>o(496603),i=()=>o(534177),a=()=>o(286088),r=()=>o(102586),s=()=>o(301421),l=()=>o(630116),c=()=>o(502438),d=()=>o(24157),p=()=>o(972435),u=()=>o(969197);function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p().A.getIntl();if("helpMeEdit"===e.key||"helpMeDraft"===e.key||"helpMeWrite"===e.key){var o;const n=null===(o=e.steps)||void 0===o?void 0:o[0],i="text"===(null==n?void 0:n.type)&&n.prefilledValue;return i?t.formatMessage({id:"completionPopup.prefilledValue",defaultMessage:"Write about {prefilledValue} "},{prefilledValue:i}):""}if(!(0,r().US)(e.key))return"";switch(e.key){case"brainstormIdeas":return t.formatMessage({id:"completionPopup.brainStorm.prefilledValue",defaultMessage:"Brainstorm ideas on "});case"blogPost":return t.formatMessage({id:"completionPopup.blogPost.prefilledValue",defaultMessage:"Write a blog post about "});case"outline":return t.formatMessage({id:"completionPopup.outline.prefilledValue",defaultMessage:"Write an outline about "});case"socialMediaPost":return t.formatMessage({id:"completionPopup.socialMediaPost.prefilledValue",defaultMessage:"Write a social media post about "});case"pressRelease":return t.formatMessage({id:"completionPopup.pressRelease.prefilledValue",defaultMessage:"Write a press release about "});case"creativeStory":return t.formatMessage({id:"completionPopup.creativeStory.prefilledValue",defaultMessage:"Write a creative story about "});case"essay":return t.formatMessage({id:"completionPopup.essay.prefilledValue",defaultMessage:"Write an essay about "});case"poem":return t.formatMessage({id:"completionPopup.poem.prefilledValue",defaultMessage:"Write a poem about "});case"todoList":return t.formatMessage({id:"completionPopup.todoList.prefilledValue",defaultMessage:"Write a todo list about "});case"meetingAgenda":return t.formatMessage({id:"completionPopup.meetingAgenda.prefilledValue",defaultMessage:"Write a meeting agenda about "});case"prosConsList":return t.formatMessage({id:"completionPopup.prosConsList.prefilledValue",defaultMessage:"Write a pros and cons list about "});case"jobDescription":return t.formatMessage({id:"completionPopup.jobDescription.prefilledValue",defaultMessage:"Write a job description about "});case"salesEmail":return t.formatMessage({id:"completionPopup.salesEmail.prefilledValue",defaultMessage:"Write a sales email about "});case"recruitingEmail":return t.formatMessage({id:"completionPopup.recruitingEmail.prefilledValue",defaultMessage:"Write a recruiting email about "});default:(0,i().HB)(e.key)}}function f(){const{stores:e}=c().default.state,t=e[0],o=n().HV(e),i=t?t.getRecordStoreUIRoot():void 0;if(i&&i instanceof l().Bv&&o){return{type:"blockSelection",stores:e,currentPage:i,origin:o,scrollerStore:(0,a().K3)(i)}}}function g(){const e=d().default.state;if("editing"!==e.mode)return;const t=e.multiSelection,o=t.start.store,n=o.getRecordStoreUIRoot(),i=s().n.findNodeFromStore(o),r=(0,u().T)(o),c=null==r?void 0:r.getRecordStoreUIParent(),p=(0,a().K3)(n),m=r&&r instanceof l().Bv&&r!==n?r:void 0,f=m??i;if(!(n&&n instanceof l().Bv&&f))return;return{type:"cursor",textSelection:t,currentPage:n,currentBlock:m,origin:f,currentParent:c,scrollerStore:p,isPageTitle:n.id===o.id}}function y(){const{stores:e}=c().default.state,t=d().default.state,o="empty"!==t.mode?t.multiSelection:void 0,n="empty"!==t.mode?t.multiSelection.start.store:void 0;let i=n?n.getRecordStoreUIRoot():void 0;if(!(i instanceof l().Bv)){let e,t=null==n?void 0:n.getRecordStoreUIParent();for(;null!=t;)t instanceof l().Bv&&(e=t),t=t.getRecordStoreUIParent();e&&(i=e)}if(o&&i&&i instanceof l().Bv){const t=(0,u().T)(o.end.store),n=null==t?void 0:t.getRecordStoreUIParent(),r=(0,a().K3)(i);if(t&&n){return{type:"textSelection",stores:e,textSelection:o,currentPage:i,origin:t,endBlock:t,endBlockParent:n,scrollerStore:r}}}}},412669:(e,t,o)=>{o.d(t,{K:()=>n});const n=o(757695).Store.createValue(!1)},441738:(e,t,o)=>{o.d(t,{Mc:()=>i,Nf:()=>r,dx:()=>a});o(16280),o(898992),o(672577),o(737550);var n=()=>o(416845);const i=["ai_add_on_employee_discount_monthly","ai_add_on_employee_discount_yearly"],a=["ai_add_on_standard_sales_assisted","ai_add_on_standard_sales_assisted_eur","ai_add_on_standard_sales_assisted_gbp","ai_add_on_standard_sales_assisted_jpy","ai_add_on_standard_sales_assisted_krw","ai_add_on_employee_discount_monthly","ai_add_on_employee_discount_yearly","ai_add_on_marketing_discount_monthly","ai_add_on_marketing_discount_yearly","sites_custom_hostnames_add_on_sales_assisted_gbp","sites_custom_hostnames_add_on_sales_assisted_usd","sites_custom_hostnames_add_on_sales_assisted_eur","sites_custom_hostnames_add_on_sales_assisted_jpy","sites_custom_hostnames_add_on_sales_assisted_krw","ai_add_on_standard_trial_monthly_usd","ai_add_on_standard_trial_yearly_usd","ai_add_on_standard_trial_monthly_eur","ai_add_on_standard_trial_yearly_eur","ai_add_on_standard_trial_monthly_gbp","ai_add_on_standard_trial_yearly_gbp","ai_add_on_standard_trial_monthly_jpy","ai_add_on_standard_trial_yearly_jpy","ai_add_on_standard_trial_monthly_krw","ai_add_on_standard_trial_yearly_krw",...["ai_add_on_standard_monthly_10","ai_add_on_standard_monthly_eur","ai_add_on_standard_monthly_gbp","ai_add_on_standard_monthly_jpy","ai_add_on_standard_monthly_krw","ai_add_on_standard_yearly_96","ai_add_on_standard_yearly_eur","ai_add_on_standard_yearly_gbp","ai_add_on_standard_yearly_jpy","ai_add_on_standard_yearly_krw","sites_custom_hostnames_add_on_monthly_usd","sites_custom_hostnames_add_on_yearly_usd","sites_custom_hostnames_add_on_monthly_eur","sites_custom_hostnames_add_on_yearly_eur","sites_custom_hostnames_add_on_monthly_gbp","sites_custom_hostnames_add_on_yearly_gbp","sites_custom_hostnames_add_on_monthly_jpy","sites_custom_hostnames_add_on_yearly_jpy","sites_custom_hostnames_add_on_monthly_krw","sites_custom_hostnames_add_on_yearly_krw"]];function r(e){return e===n()._D_}Error},469635:(e,t,o)=>{o.d(t,{t:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.27 7.7 15.45 4.59",svg:(0,o(474848).jsx)("path",{d:"M2.9 7.708a.625.625 0 0 0 0 1.25h14.2a.625.625 0 1 0 0-1.25zm0 3.334a.625.625 0 1 0 0 1.25h9.457a.625.625 0 1 0 0-1.25z"})},i=(0,o(340498).wt)("textShort",n)},474587:(e,t,o)=>{o.d(t,{$L:()=>a,VT:()=>n,jm:()=>r,nP:()=>i});const n=(0,o(959013).YK)({translateSpanish:{defaultMessage:"Spanish",id:"id.completions.translateSpanish"},translateFrench:{defaultMessage:"French",id:"id.completions.translateFrench"},translateKorean:{defaultMessage:"Korean",id:"id.completions.translateKorean"},translateJapanese:{defaultMessage:"Japanese",id:"id.completions.translateJapanese"},translateEnglish:{defaultMessage:"English",id:"id.completions.translateEnglish"},translateChinese:{defaultMessage:"Chinese",id:"id.completions.translateChinese"},translateChineseSimplified:{defaultMessage:"Chinese, Simplified",id:"id.completions.translateChineseSimplified"},translateChineseTraditional:{defaultMessage:"Chinese, Traditional",id:"id.completions.translateChineseTraditional"},translateRussian:{defaultMessage:"Russian",id:"id.completions.translateRussian"},translatePortuguese:{defaultMessage:"Portuguese",id:"id.completions.translatePortuguese"},translateGerman:{defaultMessage:"German",id:"id.completions.translateGerman"},translateItalian:{defaultMessage:"Italian",id:"id.completions.translateItalian"},translateDutch:{defaultMessage:"Dutch",id:"id.completions.translateDutch"},translateIndonesian:{defaultMessage:"Indonesian",id:"id.completions.translateIndonesian"},translateFilipino:{defaultMessage:"Filipino",id:"id.completions.translateFilipino"},translateVietnamese:{defaultMessage:"Vietnamese",id:"id.completions.translateVietnamese"},changeToneProfessional:{defaultMessage:"Professional",id:"id.completions.changeToneProfessional"},changeToneCasual:{defaultMessage:"Casual",id:"id.completions.changeToneCasual"},changeToneStraightforward:{defaultMessage:"Straightforward",id:"id.completions.changeToneStraightforward"},changeToneConfident:{defaultMessage:"Confident",id:"id.completions.changeToneConfident"},changeToneFriendly:{defaultMessage:"Friendly",id:"id.completions.changeToneFriendly"}}),i=[{key:"english",name:n.translateEnglish},{key:"korean",name:n.translateKorean},{key:"chinese (simplified)",name:n.translateChineseSimplified},{key:"chinese (traditional)",name:n.translateChineseTraditional},{key:"japanese",name:n.translateJapanese},{key:"spanish",name:n.translateSpanish},{key:"russian",name:n.translateRussian},{key:"french",name:n.translateFrench},{key:"portuguese",name:n.translatePortuguese},{key:"german",name:n.translateGerman},{key:"italian",name:n.translateItalian},{key:"dutch",name:n.translateDutch},{key:"indonesian",name:n.translateIndonesian},{key:"filipino",name:n.translateFilipino},{key:"vietnamese",name:n.translateVietnamese}],a=[{key:"professional",name:n.changeToneProfessional},{key:"casual",name:n.changeToneCasual},{key:"straightforward",name:n.changeToneStraightforward},{key:"confident",name:n.changeToneConfident},{key:"friendly",name:n.changeToneFriendly}];function r(e){return"formula"!==e.type&&"rollup"!==e.type&&"relation"!==e.type&&"file"!==e.type&&"url"!==e.type&&"auto_increment_id"!==e.type&&"button"!==e.type&&"email"!==e.type&&"phone_number"!==e.type}},495159:(e,t,o)=>{o.d(t,{EA:()=>I,IC:()=>R,IG:()=>b,LB:()=>E,Lu:()=>w,Mt:()=>O,My:()=>V,NP:()=>P,SA:()=>B,SF:()=>x,VT:()=>_,X$:()=>W,a:()=>A,eB:()=>F,hb:()=>N,nq:()=>z,tN:()=>U,vr:()=>S,z1:()=>D});o(16280),o(944114);var n=()=>o(474587),i=()=>o(425940),a=()=>o(116089),r=()=>o(105819),s=()=>o(37719),l=()=>o(877235),c=()=>o(512062),d=()=>o(496603),p=()=>o(534177),u=()=>o(38337),m=()=>o(695625),f=()=>o(525569),g=()=>o(630116),y=()=>o(401040),h=()=>o(68465),v=()=>o(972435);const _=(0,o(959013).YK)({writeWithAI:{defaultMessage:"Write with AI",id:"id.completions.writeWithAI"},draftWithAI:{defaultMessage:"Draft with AI",id:"id.completions.draftWithAI"},extractFromSelection:{defaultMessage:"Generate from selection",id:"id.completions.extractFromSelection"},extractFromPage:{defaultMessage:"Generate from page",id:"id.completions.extractFromPage"},editSelection:{defaultMessage:"Edit or review selection",id:"id.completions.editSelection"},editPage:{defaultMessage:"Edit or review page",id:"id.completions.editPage"},aiBlocks:{defaultMessage:"Insert AI blocks",id:"id.completions.aiBlocks"},helpMeEdit:{defaultMessage:"Ask AI to edit...",id:"id.completions.helpMeEdit"},askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeEdit:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeEdit"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},continueWriting:{defaultMessage:"Continue writing",id:"id.completions.continueWriting"},brainstormIdeas:{defaultMessage:"Brainstorm ideas",id:"id.completions.brainstormIdeas"},brainstormIdeasTopic:{defaultMessage:'What do you want to brainstorm ideas about?\nFor example, "creative name ideas for a pirate themed party game"',id:"id.completions.Topic"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},translate:{defaultMessage:"Translate",id:"id.completions.translate"},translateLanguage:{defaultMessage:"Select language",id:"id.completions.translateLanguage"},blogPost:{defaultMessage:"Blog post",id:"id.completions.blogPost"},blogPostTopicPlaceholder:{defaultMessage:'What should the blog post be about?\nFor example, "the benefits of practicing mindfulness and meditation"',id:"id.completions.blogPost.blogPostTopic.placeholder"},blogPostGenerate:{defaultMessage:"Generate post",id:"id.completions.blogPost.generate"},prosConsList:{defaultMessage:"Pros and cons list",id:"id.completions.prosConsList"},prosConsListPlaceholder:{defaultMessage:'What do you want to make a pros and cons list about?\nFor example, "learning a new language for the first time"',id:"id.completions.prosConsListPlaceholder"},socialMediaPostPlaceholder:{defaultMessage:'What do you want to make a social media post about?\nFor example, "tips and tricks for changing careers"',id:"id.completions.socialMediaPostPlaceholder"},outlinePlaceholder:{defaultMessage:'What do you want to make an outline for?\nFor example, "a detailed step-by-step process for getting into university"',id:"id.completions.outlinePlaceholder"},creativeStoryPlaceholder:{defaultMessage:'What do you want to write a story about?\nFor example, "suzy discovers a magical secret room only she can see"',id:"id.completions.creativeStoryPlaceholder"},poemPlaceholder:{defaultMessage:'What do you want to write a poem about?\nFor example, "a whimsical poem about finding meaning in ordinary things"',id:"id.completions.poemPlaceholder"},essayPlaceholder:{defaultMessage:'What do you want to write an essay about?\nFor example, "how a chaotic environment can actually improve focus"',id:"id.completions.essayPlaceholder"},todoListPlaceholder:{defaultMessage:'What do you want to make a to-do list about?\nFor example, "creating a new board game"',id:"id.completions.todoListPlaceholder"},meetingAgendaPlaceholder:{defaultMessage:'What is the purpose of the meeting?\nFor example, "alignment on pricing for new product"',id:"id.completions.meetingAgendaPlaceholder"},pressReleasePlaceholder:{defaultMessage:'What should the press release be about?\nFor example, "product launch for new mind-reading app for pets"',id:"id.completions.pressReleasePlaceholder"},jobDescriptionPlaceholder:{defaultMessage:'What job do you want to write a description about?\nFor example, "data engineer at Notion, needs Postgres experience"',id:"id.completions.jobDescriptionPlaceholder"},salesEmailPlaceholder:{defaultMessage:'What product are you selling?\nFor example, "email for a head of operations about a new brain boosting supplement"',id:"id.completions.salesEmailPlaceholder"},recruitingEmailPlaceholder:{defaultMessage:'Who are you trying to recruit?\nFor example, "experienced frontend engineer for our new social mindfulness app"',id:"id.completions.recruitingEmailPlaceholder"},helpMeEditPlaceholder:{defaultMessage:'How would you like to edit this text?\nFor example, "Summarize in one sentence"',id:"id.completions.helpMeEditPlaceholder"},improveWriting:{defaultMessage:"Improve writing",id:"id.completions.improveWriting"},fixSpellingGrammar:{defaultMessage:"Fix spelling & grammar",id:"id.completions.fixSpellingGrammar"},explainThis:{defaultMessage:"Explain this",id:"id.completions.explainThis"},makeLonger:{defaultMessage:"Make longer",id:"id.completions.makeLonger"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},makeShorter:{defaultMessage:"Make shorter",id:"id.completions.makeShorter"},simplifyLanguage:{defaultMessage:"Simplify language",id:"id.completions.simplifyLanguage"},changeTone:{defaultMessage:"Change tone",id:"id.completions.changeTone"},changeToneType:{defaultMessage:"Select tone",id:"id.completions.changeToneType"},socialMediaPost:{defaultMessage:"Social media post",id:"id.completions.socialMediaPost"},cleanUpFormatting:{defaultMessage:"Clean up formatting",id:"id.completions.cleanUpFormatting"},outline:{defaultMessage:"Outline",id:"id.completions.outline"},creativeStory:{defaultMessage:"Creative story",id:"id.completions.creativeStory"},poem:{defaultMessage:"Poem",id:"id.completions.poem"},essay:{defaultMessage:"Essay",id:"id.completions.essay"},todoList:{defaultMessage:"To-do list",id:"id.completions.todoList"},toDoListKeywords:{id:"id.completions.todoListKeywords",defaultMessage:"Todo To-Do List"},meetingAgenda:{defaultMessage:"Meeting agenda",id:"id.completions.meetingAgenda"},pressRelease:{defaultMessage:"Press release",id:"id.completions.pressRelease"},jobDescription:{defaultMessage:"Job description",id:"id.completions.jobDescription"},salesEmail:{defaultMessage:"Sales email",id:"id.completions.salesEmail"},recruitingEmail:{defaultMessage:"Recruiting email",id:"id.completions.recruitingEmail"},conclusion:{defaultMessage:"Conclusion",id:"id.completions.conclusion"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"},insertAIBlock:{defaultMessage:"Insert as AI block",id:"id.completions.insertAIBlock"}}),S={text:{summarize:{name:_.autofillSummary,svg:s().P},translate:{name:_.autofillTranslate,svg:l().H},extract:{name:_.autofillExtract,svg:o(202017).n},custom:{name:_.autofillCustom,svg:a().x}},select:{select:{name:_.autofillCustom,svg:a().x}},multi_select:{select:{name:_.autofillCustom,svg:a().x}}};const k=[h().am,{key:"brainstormIdeas",category:"draftWithAI",name:_.brainstormIdeas,svg:o(123411).X,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.brainstormIdeasTopic,placeholder:_.brainstormIdeasTopic,type:"text"}]},{key:"blogPost",category:"draftWithAI",name:_.blogPost,generateName:_.blogPostGenerate,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.blogPostTopicPlaceholder,placeholder:_.blogPostTopicPlaceholder,type:"text"}]},{key:"outline",category:"draftWithAI",name:_.outline,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.outlinePlaceholder,placeholder:_.outlinePlaceholder,type:"text"}]},{key:"socialMediaPost",category:"draftWithAI",name:_.socialMediaPost,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.socialMediaPostPlaceholder,placeholder:_.socialMediaPostPlaceholder,type:"text"}]},{key:"pressRelease",category:"draftWithAI",name:_.pressRelease,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.pressReleasePlaceholder,placeholder:_.pressReleasePlaceholder,type:"text"}]},{key:"creativeStory",category:"draftWithAI",name:_.creativeStory,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.creativeStoryPlaceholder,placeholder:_.creativeStoryPlaceholder,type:"text"}]},{key:"essay",category:"draftWithAI",name:_.essay,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.essayPlaceholder,placeholder:_.essayPlaceholder,type:"text"}]},{key:"poem",category:"draftWithAI",name:_.poem,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.poemPlaceholder,placeholder:_.poemPlaceholder,type:"text"}]},{key:"todoList",category:"draftWithAI",name:_.todoList,fuzzySearchKeywords:_.toDoListKeywords,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.todoListPlaceholder,placeholder:_.todoListPlaceholder,type:"text"}]},{key:"meetingAgenda",category:"draftWithAI",name:_.meetingAgenda,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.meetingAgendaPlaceholder,placeholder:_.meetingAgendaPlaceholder,type:"text"}]},{key:"prosConsList",category:"draftWithAI",name:_.prosConsList,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.prosConsListPlaceholder,placeholder:_.prosConsListPlaceholder,type:"text"}]},{key:"jobDescription",category:"draftWithAI",name:_.jobDescription,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.jobDescriptionPlaceholder,placeholder:_.jobDescriptionPlaceholder,type:"text"}]},{key:"salesEmail",category:"draftWithAI",name:_.salesEmail,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.salesEmailPlaceholder,placeholder:_.salesEmailPlaceholder,type:"text"}]},{key:"recruitingEmail",category:"draftWithAI",name:_.recruitingEmail,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],steps:[{key:"topic",name:_.recruitingEmailPlaceholder,placeholder:_.recruitingEmailPlaceholder,type:"text"}]}],C=[h().KW,{key:"continueWriting",category:"writeWithAI",name:_.continueWriting,svg:r().pencilLineIcon,svgFill:c().M.light.purple[400],requiresContent:!0},{key:"summarize",category:"extractFromContent",name:_.summarize,svg:s().P,svgFill:c().M.light.purple[400],requiresContent:!0},{key:"findActionItems",category:"extractFromContent",name:_.findActionItems,svg:i().a,svgFill:c().M.light.purple[400],requiresContent:!0}];function I(e){if("string"==typeof e.name)return e.name;return v().A.getIntl().formatMessage(e.name)}function P(e){for(const t of M()){const o=(0,y().oW)(t);if(o&&e.startsWith(o))return{prompt:t,additionalContext:{topic:e}}}}function*M(){for(const t of k){var e;1===(null===(e=t.steps)||void 0===e?void 0:e.length)&&"topic"===t.steps[0].key&&(yield t)}}function w(e,t){const o=e.trim().toLocaleLowerCase();for(const n of M()){if((0,y().oW)(n,t).trim().toLocaleLowerCase()===o)return!0}return!1}function x(e){const t=[];return"cursor"===e.selectionType?e.isPageEmpty?t.push(...k):t.push(...C,...T,...k):t.push(...T,...C,...k),d().hS(t,(e=>e.key))}function A(e,t){switch(e){case"writeWithAI":return _.writeWithAI;case"draftWithAI":return _.draftWithAI;case"editContent":switch(t){case"page":return _.editPage;case"selection":return _.editSelection}break;case"extractFromContent":switch(t){case"page":return _.extractFromPage;case"selection":return _.extractFromSelection}}}function b(e,t){const o={editContent:[],writeWithAI:[],draftWithAI:[],extractFromContent:[]};function n(e){return[e,o[e]]}for(const i of e)o[i.category].push(i);return"cursor"===t.selectionType?t.isPageEmpty?[n("draftWithAI"),n("writeWithAI")]:[n("writeWithAI"),n("extractFromContent"),n("editContent"),n("draftWithAI")]:[n("editContent"),n("extractFromContent"),n("writeWithAI"),n("draftWithAI")]}const T=[{key:"improveWriting",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.improveWriting,svg:a().x,svgFill:c().M.light.purple[400]},{key:"fixSpellingGrammar",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.fixSpellingGrammar,svg:o(29037).checkmarkIcon,svgFill:c().M.light.purple[400]},{key:"summarize",category:"extractFromContent",name:_.summarize,svg:s().P,svgFill:c().M.light.purple[400]},{key:"translate",category:"extractFromContent",name:_.translate,svg:l().H,svgFill:c().M.light.purple[400],generateName:_.translate,regenerateName:_.translate,steps:[{key:"language",name:_.translateLanguage,type:"dropdown",dropdownOptions:n().nP}]},{key:"explainThis",category:"extractFromContent",name:_.explainThis,svg:o(406533).questionMarkCircleIcon,svgFill:c().M.light.purple[400]},{key:"makeShorter",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.makeShorter,svg:o(469635).t,svgFill:c().M.light.purple[400]},{key:"makeLonger",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.makeLonger,svg:o(467248).i,svgFill:c().M.light.purple[400]},{key:"findActionItems",category:"extractFromContent",name:_.findActionItems,svg:i().a,svgFill:c().M.light.purple[400]},{key:"changeTone",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.changeTone,svg:o(724925).l,svgFill:c().M.light.purple[400],generateName:_.changeTone,regenerateName:_.changeTone,steps:[{key:"tone",name:_.changeToneType,type:"dropdown",dropdownOptions:n().$L}]},{key:"simplifyLanguage",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.simplifyLanguage,svg:o(824375).sparklesIcon,svgFill:c().M.light.purple[400]},{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.helpMeEdit,svg:a().x,svgFill:c().M.light.purple[400],steps:[{key:"prompt",name:_.helpMeEditPlaceholder,placeholder:_.helpMeEditPlaceholder,type:"text"}]}];function W(e){return{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:_.helpMeEdit,svg:a().x,svgFill:c().M.light.purple[400],steps:[{key:"prompt",name:_.helpMeEditPlaceholder,placeholder:_.helpMeEditPlaceholder,type:"text",prefilledValue:e}]}}const F={key:"continueWriting",name:_.continueWriting};function R(e){let t=m().T.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${u().rb2}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}function E(e){const{origin:t}=e;return t instanceof g().Bv?R(t):t instanceof HTMLElement?t.getBoundingClientRect():t}function L(e){if(0===e.revisions.length)throw new Error("Assertion failure: no revisions exist")}function B(e){L(e);for(const t of O(e))if("initial"===t.type)return t;throw new Error("Assertion failure, initial revision does not exist")}function U(e){return L(e),e.revisions[e.revisions.length-1]}function V(e){return"followup"===U(e).type}function D(e){return e.additionalContext&&(e.additionalContext.prompt||e.additionalContext.topic)||""}function N(e){if(0===e.revisions.length)throw new Error("Assertion failure, expected revisions to be non-empty");return e.revisions.length-1}function*O(e){let t=N(e),o=0;for(;;){if(o+=1,o>1e4)throw new Error("Maximum iteration limit reached");const n=e.revisions[t];if(!n)throw new Error("Assertion failure, invalid revision index");if(yield n,"initial"===n.type)break;"followup"===n.type?t=n.previousRevision:(0,p().HB)(n)}}function z(){const e=f().default.state;return"completionPopup"===e.type&&"initialPromptForAIBlock"===e.stage&&!e.store.hasContent()}},505578:(e,t,o)=>{o.d(t,{A:()=>a,assistantWriterDependency:()=>i});var n=()=>o(645873);const i=new(n().O2)("assistantWriter",(()=>Promise.all([o.e(75134),o.e(16471),o.e(58550),o.e(44711),o.e(53321),o.e(90825),o.e(96346),o.e(55373),o.e(37353),o.e(29151),o.e(78191),o.e(92845),o.e(84468),o.e(5605),o.e(48486),o.e(95794),o.e(13677),o.e(56952),o.e(48632),o.e(75078),o.e(25497),o.e(74562),o.e(27711),o.e(4422),o.e(11341),o.e(46414),o.e(95168),o.e(28271),o.e(36908),o.e(17254),o.e(84185),o.e(32421),o.e(15315),o.e(24587),o.e(78708),o.e(43777),o.e(74752),o.e(91194),o.e(81197),o.e(98659),o.e(20502),o.e(6266),o.e(83884),o.e(65881),o.e(99809),o.e(93282),o.e(43678),o.e(15019),o.e(90978),o.e(3910),o.e(77213),o.e(78984)]).then(o.bind(o,390849)))),a=(0,n()._h)(i,(e=>e.AssistantWriterPopup))},556122:(e,t,o)=>{o.d(t,{QJ:()=>f,TI:()=>d,qm:()=>c});o(944114),o(581454);var n=()=>o(763824),i=()=>o(780054);let a=0;const r="clipboard",s={debug:Boolean(i().A.isDevelopingInAirplaneMode),responseText:r,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},l="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function c(){return s.debug}function d(){return s}function p(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,n().wR)(s.delayBetweenChunks),yield t}}}function u(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,a=0;i<o;++i,a+=t)n[i]=e.substr(a,t);return n}function m(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function f(e){let{environment:t,data:o}=e;console.log("Retrieving fake completion for data",o);const{context:n}=o,c=n.selectedText,d=[];let{responseText:f}=s;if(f===r&&(f=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===f&&(d.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${a++}.`,inferenceId:"mock"}),i().A.isDevelopingInAirplaneMode&&d.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof c)){d.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of u(c,s.chunkSize))d.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(s.showErrorCode)d.push({type:"error",message:"alas",errorCode:s.showErrorCode});else if(void 0===f)for(let i=0;i<s.numLoremIpsums;i++)d.push(...m([`\n\n${i+1}. `,...u(l,0===s.delayBetweenChunks?l.length:s.chunkSize)]));else if(f.length>0){const e=u(f,s.chunkSize);d.push(...m(e))}return Promise.resolve({type:"success",data:p(d),status:200,headers:{}})}(0,o(604341).exposeDebugValue)("completionDebugSettings",s)},661077:(e,t,o)=>{o.d(t,{P:()=>n});const n=o(757695).Store.createValue(!0,{name:"IsAiEligibleStore"})},724925:(e,t,o)=>{o.d(t,{l:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.87 14.75 14.75",svg:(0,o(474848).jsx)("path",{d:"M2.865 17.61q.069.015.135.015a.626.626 0 0 0 .61-.49c.025-.11 2.474-10.663 11.95-12.82a15.2 15.2 0 0 1-1.617 3.008l-1.996-.087a.6.6 0 0 0-.491.206.63.63 0 0 0-.154.51l.294 1.984a12.8 12.8 0 0 1-4.218 2.424.624.624 0 1 0 .405 1.182 14 14 0 0 0 4.9-2.9.63.63 0 0 0 .199-.555l-.233-1.57 1.58.07a.59.59 0 0 0 .533-.258c1.682-2.316 2.276-4.422 2.335-4.644a.64.64 0 0 0-.127-.586.64.64 0 0 0-.582-.214C5.209 4.633 2.416 16.743 2.39 16.865a.626.626 0 0 0 .475.745M6 17.625h10a.626.626 0 0 0 0-1.25H6a.625.625 0 0 0 0 1.25"})},i=(0,o(340498).wt)("quill",n)},877235:(e,t,o)=>{o.d(t,{H:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"0.59 4.59 18.82 10.82",svg:(0,o(474848).jsx)("path",{d:"M14.776 5.217a.625.625 0 1 0-1.25 0v.967H9.524a.625.625 0 1 0 0 1.25h6.688c-.32.87-.963 2.091-2.06 3.375a12.8 12.8 0 0 1-1.48-2.122.625.625 0 1 0-1.095.603c.415.754.978 1.589 1.717 2.438a16.3 16.3 0 0 1-3.341 2.512.625.625 0 0 0 .62 1.085 17.6 17.6 0 0 0 3.58-2.688 17.6 17.6 0 0 0 3.577 2.688.625.625 0 1 0 .622-1.085 16.3 16.3 0 0 1-3.342-2.512c1.42-1.632 2.196-3.216 2.52-4.294h1.251a.625.625 0 1 0 0-1.25h-4.005zm-8.014 7.16.958 2.62a.625.625 0 0 0 1.174-.43L5.645 5.683a.94.94 0 0 0-1.765 0L.632 14.568a.625.625 0 1 0 1.174.43l.958-2.621zm-.457-1.25H3.221l1.542-4.219z"})},i=(0,o(340498).wt)("textTranslate",n)},972911:(e,t,o)=>{o.r(t),o.d(t,{AiOnboardingQueuedSelectedStore:()=>m,advanceAITutorialTooltipsStage:()=>y,getAiOnboardingPhase:()=>f,onSpaceForAiTriggered:()=>g,useUpdateAskAIAnythingOnboardingState:()=>v,useUpdateRefineAIResponseOnboardingState:()=>h});o(16280);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(591779),s=()=>o(495989),l=()=>o(751156),c=()=>o(755199),d=()=>o(765957),p=()=>o(337567),u=()=>o(323714);const m=o(757695).Store.createValue(void 0,{name:"AiOnboardingQueuedSelectedStore"});function f(){const{currentUserSettingsStore:e}=d().default.state;if(!e||!e.isReady())return;const t=e.getSettings();return t?t.ai_assistant_tooltips_onboarding_phase??"space_for_ai":void 0}function g(e){"space_for_ai"===f()&&y(e)}function y(e){const t=f();if(void 0===t)throw new Error("Assertion failure, AI onboarding state is undefined!");const o=s().aD.indexOf(t);if(-1===o)throw new Error(`Assertion failure, ${t} is not a valid AI onboarding state!`);if(o<s().aD.length-1){const{currentUserSettingsStore:t}=d().default.state;if(!t)return;const n=s().aD[o+1];l().createAndCommit({userAction:"AiOnboardingActions.advanceAIOnboardingStage",environment:e,canUndo:!0,perform:e=>{c().mJ({userSettingsStore:t,transaction:e,data:{ai_assistant_tooltips_onboarding_phase:n}})},userId:t.id}),"complete"===n&&(0,u().setAssistantOnboardingPhase)(e,{phase:"complete",transactionUserAction:"AiOnboardingActions.advanceAIAssistantOnboardingPhase.fromAiTooltips",userSettingsStore:t})}}function h(e){const t=(0,i().v3)(),o=(0,a().K8)((()=>{const e=(0,p().K1)();return!!e&&e.isStreaming()}),[]),s="completionPopup"===e.type&&"results"===e.stage&&!e.loading,l="assistantCompletionPopup"===e.type&&"results"===e.stage&&!o,c=s||l,d=(0,r().ZC)(c);(0,n.useEffect)((()=>{d&&!c&&"refine_ai_response"===f()&&y(t)}),[c,d,t])}function v(e){const t=(0,i().v3)(),o="results"===e.stage&&e.loading,a=(0,r().ZC)(o);(0,n.useEffect)((()=>{o&&!a&&"ask_ai_anything"===f()&&y(t)}),[o,a,t])}}}]);