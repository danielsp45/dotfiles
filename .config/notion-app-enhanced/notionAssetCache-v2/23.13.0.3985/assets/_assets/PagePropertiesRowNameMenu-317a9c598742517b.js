"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[1423,2411,5834,34208,71204],{26517:(e,t,o)=>{o.d(t,{Wf:()=>v,YB:()=>y,aj:()=>f,f3:()=>h,qg:()=>_});o(898992),o(354520),o(581454),o(296540);var r=()=>o(401497),n=()=>o(651124),i=()=>o(959013),a=()=>o(449195),l=()=>o(722872),s=()=>o(760217),c=()=>o(928600),d=()=>o(939740),u=()=>o(89924),p=()=>o(74263),m=o(474848);function y(e){const{currentVisibility:t,propertySchema:o,onSelect:r,onClose:l}=e;let s=[...n().vj];s=s.filter((e=>"section"!==e)),(0,a()._f)({propertySchema:o})||(s=s.filter((e=>"hide_if_empty"!==e)));const c=s.map((e=>({visibility:e,label:(0,m.jsx)(i().sA,{...p().gY[e]})})));return(0,m.jsx)(g,{currentVisibility:t,visibilityLevelsWithLabels:c,onSelect:r,onClose:l})}function f(e){const{currentVisibility:t,onSelect:o,onClose:r}=e,n=(0,a().SB)(t),l=["always_show","section_collapsed","section_hide"].map((e=>({visibility:e,label:(0,m.jsx)(i().sA,{...p().vG[e]})})));return(0,m.jsx)(g,{currentVisibility:n,visibilityLevelsWithLabels:l,onSelect:o,onClose:r})}function v(e){const{currentVisibility:t,onSelect:o,onClose:r}=e,a=n().OA.filter((e=>"section_hide"!==e)).map((e=>({visibility:e,label:(0,m.jsx)(i().sA,{...p().wV[e]})}))),l="section_hide"===t?void 0:t;return(0,m.jsx)(g,{currentVisibility:l,visibilityLevelsWithLabels:a,onSelect:o,onClose:r})}function _(e){const{currentVisibility:t,onSelect:o,onClose:r}=e,a=n().qG.filter((e=>"section_collapsed"!==e)).map((e=>({visibility:e,label:(0,m.jsx)(i().sA,{...p().Bb[e]})}))),l="section_collapsed"===t?"section_show":t;return(0,m.jsx)(g,{currentVisibility:l,visibilityLevelsWithLabels:a,onSelect:o,onClose:r})}function h(e){const{currentVisibility:t,onSelect:o,onClose:r}=e,a=n().RL.map((e=>({visibility:e,label:(0,m.jsx)(i().sA,{...p().PP[e]})})));return(0,m.jsx)(g,{currentVisibility:t,visibilityLevelsWithLabels:a,onSelect:o,onClose:r})}function g(e){const{currentVisibility:t,visibilityLevelsWithLabels:o,onSelect:r,onClose:n}=e,i=o.map((e=>{let{visibility:o,label:i}=e;return{key:o,render:e=>(0,m.jsx)(b,{buttonMenuItemProps:e,isChecked:o===t,label:i}),action:()=>{r(o),n&&n()}}})),a=[{key:"visibilityLevels",render:e=>(0,m.jsx)(u().A,{...e,topBorder:0!==e.index}),items:i}],s={menuType:l().gu.Popup,width:"auto",maxWidth:360};return(0,m.jsx)(c().A,{...s,children:(0,m.jsx)(d().Ay,{type:d().Oh.Vertical,initialFocus:void 0,sections:a})})}function b(e){const{buttonMenuItemProps:t,label:o,isChecked:n}=e,i=(0,r().IS)((()=>({title:{display:"flex",alignItems:"center",width:150}})),[]),a=(0,m.jsx)("div",{style:i.title,children:o});return(0,m.jsx)(s().A,{...t,textWrapperStyle:{marginRight:0},title:a,isChecked:n})}},74263:(e,t,o)=>{o.d(t,{Bb:()=>i,PP:()=>l,gY:()=>m,vG:()=>c,wV:()=>u});var r=()=>o(959013);const n=(0,r().YK)({expanded:{id:"customizePageMenuVisibilitySelect.expanded.label",defaultMessage:"Expanded"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),i={section_show:n.expanded,section_collapsed:n.expanded,section_hide:n.off},a=(0,r().YK)({default:{id:"customizePageMenuVisibilitySelect.default.label",defaultMessage:"Default"},minimal:{id:"customizePageMenuVisibilitySelect.minimal.label",defaultMessage:"Minimal"}}),l={inline:a.default,minimal:a.minimal},s=(0,r().YK)({showOnHover:{id:"visibilityLevelMessages.backlinksPageSection.showOnHover",defaultMessage:"Show on hover"},alwaysShow:{id:"visibilityLevelMessages.backlinksPageSection.alwaysShow",defaultMessage:"Always show"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),c={always_show:s.alwaysShow,section_show:s.showOnHover,section_collapsed:s.showOnHover,section_hide:s.off,inline:s.off,minimal:s.off},d=(0,r().YK)({asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"},minimal:{id:"visibilityLevelMessages.propertyPageSection.minimal",defaultMessage:"Minimal"}}),u={inline:d.asPageSection,minimal:d.minimal},p=(0,r().YK)({alwaysShow:{id:"customizePageMenuVisibilitySelect.show.label",defaultMessage:"Always show"},alwaysHide:{id:"customizePageMenuVisibilitySelect.hide.label",defaultMessage:"Always hide"},hideWhenEmpty:{id:"customizePageMenuVisibilitySelect.hideIfEmpty.label",defaultMessage:"Hide when empty"},asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"}}),m={show:p.alwaysShow,hide:p.alwaysHide,hide_if_empty:p.hideWhenEmpty,section:p.asPageSection}},89849:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>i,iconDefinition:()=>n});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"0.96 4.19 18.07 11.62",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.135 3.303l-.005.17a3.305 3.305 0 0 1-3.3 3.137l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17A3.307 3.307 0 0 1 10 6.69zm-.17 2.2a1.104 1.104 0 0 0 0 2.207 1.103 1.103 0 0 0 0-2.207"}),(0,r.jsx)("path",{d:"M10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.163c.126.333.126.7 0 1.033l-.073.163c-1.602 3.052-4.984 5.126-8.862 5.126-3.757 0-7.049-1.946-8.707-4.843l-.156-.283a1.46 1.46 0 0 1 0-1.359l.156-.283C2.95 6.141 6.243 4.194 10 4.194m0 1.251c-3.33 0-6.196 1.724-7.622 4.214l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214 3.437 0 6.38-1.837 7.756-4.457l.018-.048a.2.2 0 0 0 0-.1l-.018-.049C16.38 7.282 13.437 5.445 10 5.445"})]})},i=(0,o(340498).wt)("eye",n)},167170:(e,t,o)=>{o.d(t,{_:()=>n});o(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"3.29 3.29 13.41 13.41",svg:(0,o(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},n=(0,o(340498).wt)("layout",r)},175213:(e,t,o)=>{o.d(t,{G:()=>i});var r=()=>o(679924),n=()=>o(217429);function i(e,t){(0,r().v)(e,"delete_property",t),n().default.logEvent("delete_property")}},234359:(e,t,o)=>{o.d(t,{L8:()=>S,O2:()=>x,dm:()=>A,qN:()=>M});var r=o(296540),n=()=>o(484714),i=()=>o(56366),a=()=>o(496506),l=()=>o(757695),s=()=>o(443239),c=()=>o(970013),d=()=>o(713998),u=()=>o(416504),p=()=>o(534177),m=()=>o(862292),y=()=>o(909470),f=()=>o(972435),v=()=>o(645873),_=()=>o(963589),h=()=>o(217429),g=()=>o(414712),b=o(474848);const S=(0,r.createContext)({collectionContextStore:void 0,propertySchema:void 0,property:void 0,propertyFormat:void 0,isEmptyStore:l().Store.createValue(!1),canEdit:!1,disabled:!0,shouldRenderTooltip:!1,shouldWrap:!1,baseStyles:{},format:"table",containerRef:null,store:void 0,shouldShowMultiSelectCheckbox:void 0,propertyIndex:void 0,collectionSchemaStore:l().Store.createValue(void 0)});S.displayName="BlockPropertyValueContext";const M=r.memo((function(e){const{children:t,unmappedProperty:l,property:s,propertySchema:c,containerRef:d}=e,{format:u,disabled:y,store:f,tableWrap:_,collectionStore:h,shouldSetCellHeight:g,isLast:M,locked:A,showIfEmpty:C,shouldShowMultiSelectCheckbox:I,propertyIndex:T,propertyModule:P,formQuestionStore:k,formDataStore:O,onClose:E}=e.innerProps,R=(0,n().v3)(),{value:D}=(0,v().fJ)(m().T.formulas),B=(0,o(175116).Ks)(),[N,j]=(0,i().K8)((()=>{const e=null==B?void 0:B.getPropertyFormat(l??s);let t=!1;return O&&k&&(t=Boolean(O.getQuestionError(k.id))),[e,t]}),[B,O,k,s,l]),V=(0,r.useMemo)((()=>new(a().ComputedStore)((()=>{var e;return(null==O||null===(e=O.getFormState())||void 0===e?void 0:e.collectionSchema)||h.getSchema()}),{debugName:"BlockPropertyValueContext.collectionSchemaStore"})),[h,O]),U=(0,o(551619).Sm)(f),L=x({store:f,collectionStore:h,property:s,disabled:y,format:u,propertySchema:c,collectionContextStore:B,writeStateType:"edit"}),F=function(e,t){return"page"===e||"table"===e&&t||"board"===e&&t||"gallery"===e&&t||"form_viewer"===e}(u,_),H=P&&"style"in P&&"large"===P.style,W=(0,o(425497).x7)({shouldSetCellHeight:g,format:u,shouldWrap:F,isLast:M,locked:A,disabled:y,showIfEmpty:C,isInvalidFormAnswer:j,isLargeModule:H}),z=function(e,t,o,r,n,a,l,s){return(0,i().K8)((()=>"board"===n||"gallery"===n||"list"===n||"relation"===n||"relation_section"===n||"feed"===n||("mini"===n?!w(e,t.state,o,null==r?void 0:r.type,l.currentUser.id,s):"page"===n?a:("compact_page"===n||"table"===n||"form_viewer"===n||"form_editor"===n||"property_module"===n||"calendar"===n||"timeline"===n||(0,p().ub)(n),!1))),[t,l.currentUser.id,n,s,a,o,null==r?void 0:r.type,e])}(f,V,s,c,u,U,R,D),G=(0,r.useMemo)((()=>{let e;return{store:f,collectionContextStore:B,property:s,propertySchema:c,propertyFormat:N,isEmpty:!1,canEdit:L,disabled:y,shouldRenderTooltip:z,shouldWrap:F,baseStyles:W,format:u,containerRef:d,shouldShowMultiSelectCheckbox:I,propertyIndex:T,isExternallyImportedAndSyncedPage:U,propertyModule:P,onClose:E,collectionSchemaStore:V,get isEmptyStore(){return e||(e=new(a().ComputedStore)((()=>w(f,V.state,s,null==c?void 0:c.type,R.currentUser.id,D)),{debugName:"BlockPropertyValueContext.isEmptyStore"})),e}}}),[f,B,s,c,N,L,y,z,F,W,u,d,I,T,U,P,E,V,R.currentUser.id,D]);return(0,b.jsx)(S.Provider,{value:G,children:t})}));function w(e,t,o,r,n,i){return!!(o&&e&&e.isDefined())&&(!!t&&("checkbox"!==r&&"button"!==r&&"created_time"!==r&&"created_by"!==r&&"last_edited_time"!==r&&"last_edited_by"!==r&&"formula"!==r&&"rollup"!==r&&"auto_increment_id"!==r&&(0,d().r8)({block:e.getModel(),property:o,schema:t,getRecordModel:e.getRecordModel,userTimeZone:(0,u().P)(),intl:f().A.getIntl(),userId:n,experimentService:h().default,collectionFeatureGates:(0,y().i)(),formulasModule:i})))}function A(e,t,o,r){const a=(0,n().v3)(),{value:l}=(0,v().fJ)(m().T.formulas);return(0,i().K8)((()=>w(e,t,o,null==r?void 0:r.type,a.currentUser.id,l)),[t,a.currentUser.id,o,null==r?void 0:r.type,e,l],{debugName:"BlockPropertyValueContext.useIsBPVEmpty"})}function x(e){const{store:t,collectionStore:o,property:r,disabled:n,format:a,propertySchema:l,collectionContextStore:u,writeStateType:m}=e,y=(0,_().X)("jira_2_way_sync");return(0,i().K8)((()=>{if(!t||!o||!r)return!1;if("calendar"===a||"timeline"===a||(0,s().u)(r)||(0,c().z3)(l)||(0,g().Lp)({collectionStore:o,property:r,propertySchema:l})||null!=u&&u.isUnlistedViewStore.state)return!1;if(n||!t.canEdit()||t.isNonEditableStateStore().state)return"edit"!==m&&(t.canComment()&&!t.isNavigableAncestorNonCommentableState());if((0,g().ni)({store:t,collectionStore:o,collectionContextStore:u,propertySchema:l,property:r,isJiraTwoWaySyncEnabled:y}))return!1;if(!o.isExternallyImportedAndSyncedCollection()&&(0,d().VF)(t.getModel(),r,t.getRecordModel))return!1;if(null!=l&&l.synced_permissions)switch(l.synced_permissions){case"read_only":return!1;case"read_write":break;default:(0,p().HB)(l.synced_permissions)}return!0}),[a,r,l,o,u,n,t,m,y],{debugName:`BlockPropertyValueContext.useWriteState|${m}`})}},241319:(e,t,o)=>{o.d(t,{y:()=>i});o(898992),o(672577);var r=()=>o(534177),n=()=>o(977345);function i(e){var t;const{actionModels:o,id:i}=e,a=(0,n().y5)(i),l="action"===a.source?o.find((e=>e.id===a.action_id)):void 0,s=(0,r().O9)(l)&&l.isType("create_page")?null===(t=l.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:a,collectionPointer:s,actionModel:l}}},290966:(e,t,o)=>{o.d(t,{E_:()=>P,HQ:()=>E,I5:()=>k,ZQ:()=>T});o(16280),o(898992),o(823215),o(354520),o(581454),o(296540);var r=()=>o(662303),n=()=>o(536095),i=()=>o(134025),a=()=>o(912720),l=()=>o(179034),s=()=>o(519831),c=()=>o(869558),d=()=>o(144081),u=()=>o(921515),p=()=>o(959013),m=()=>o(496603),y=()=>o(534177),f=()=>o(284371),v=()=>o(966759),_=()=>o(235191),h=()=>o(901389),g=()=>o(751156),b=()=>o(67103),S=()=>o(16006),M=()=>o(972435),w=()=>o(470928),A=()=>o(630116),x=()=>o(913454),C=()=>o(204067),I=o(474848);function T(e){let{transaction:t,collectionStore:o,templateId:r,instance:n,logger:p}=e;p.debug(`Creating/updating ${u().rM} record for "${r}".`);const m=o.getSpaceId(),f=n.id;if("automation"===n.type){const e={table:a().yB,id:f,spaceId:m};g().applyOperation({store:A().dn.createChildStore(o,e),operation:i().op.set({pointer:e,path:["properties","workflow_template_instance"],args:{template_id:r}}),transaction:t})}else if("block"===n.type){const e={table:l().ev,id:f,spaceId:m};g().applyOperation({store:A().Bv.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:r}}),transaction:t})}else if("collection"===n.type){const e={table:s().Vl,id:f,spaceId:m};g().applyOperation({store:o,operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:r}}),transaction:t})}else if("collection_view"===n.type){const e={table:c().Gy,id:f,spaceId:m};g().applyOperation({store:A().pS.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:r}}),transaction:t})}else if("layout"===n.type){const e={table:d().zx,id:f,spaceId:m};g().applyOperation({store:A().K_.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:r}}),transaction:t})}else if("compound"===n.type){if(n.instancePointers.length<2)throw new Error(`Compound template instance ${n.id} must contain 2 or more instances`);const e=n.instancePointers.map((e=>{switch(e.type){case"automation":return{type:"automation",id:e.id};case"block":return{type:"block",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id};case"property":return{type:"property",id:e.id}}(0,y().HB)(e)}));g().applyOperation({store:o,operation:{command:"keyedObjectListUpdate",pointer:o.pointer,path:["format","compound_workflow_template_instances"],args:{value:{template_id:r,id:n.id,instance_pointers:e}}},transaction:t})}else"property"===n.type?g().applyOperation({store:o,operation:i().op.update({pointer:o.pointer,path:["schema",n.id],args:{workflow_template_instance:{template_id:r}}}),transaction:t}):(0,y().HB)(n)}function P(e){let{environment:t,collectionStore:o,propertyId:r,compoundTemplateInstancesToDelete:i,collectionContextStore:a,from:l}=e;if(!i.every((e=>e.templateId===n().z$)))return!1;if(!(0,w().Io)())return!1;const s=(0,C().aL)({environment:t,collectionStore:o,compoundTemplateInstancesToDelete:i}),c=m().sb(s.filter((e=>"property"===e.type)).map((e=>e.id))),d=o.getSchema(),u=c.map((e=>{var t;if(e===r)return;const o=d[e];if(!o)throw new Error(`Property ${e} not found`);if(o.name)return o.name;const n=null===(t=o.workflow_template_instance)||void 0===t?void 0:t.template_id;if(!n)throw new Error(`Property ${e} has no workflow template id`);const i=x().globalWorkflowTemplates.fromId(n);return(0,x().getWorkflowTemplateName)(i)})).filter(y().O9);return O({environment:t,collectionStore:o,propertyIds:c,otherPropertyNames:u,collectionContextStore:a,from:l}),!0}function k(e){let{environment:t,collectionStore:o,propertyId:r,collectionContextStore:n,from:i}=e;const a=o.getSchema(),l=Object.keys(a).filter((e=>(0,w().Do)({collectionStore:o,propertyId:e})||(0,w().k$)(e))),s=l.map((e=>{var t;if(e===r)return;const n=null===(t=a[e])||void 0===t?void 0:t.name;if(n)return n;if((0,w().Do)({collectionStore:o,propertyId:e}))return M().A.formatMessage(b().Gl.verificationPropertyName);if((0,w().k$)(e))return M().A.formatMessage(b().Gl.ownerPropertyName);throw new Error(`Property ${e} must be a verification or owner property`)})).filter(y().O9);return O({environment:t,collectionStore:o,propertyIds:l,otherPropertyNames:s,collectionContextStore:n,from:i}),!0}function O(e){let{environment:t,collectionStore:o,propertyIds:n,otherPropertyNames:i,collectionContextStore:a,from:l}=e;const s=[{label:(0,I.jsx)(p().sA,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deleteOption",defaultMessage:"{count, plural, one {Delete {count} property} other {Delete {count} properties}}",values:{count:n.length}}),color:"red",onAccept:()=>function(e){let{environment:t,collectionStore:o,collectionContextStore:r,propertyIds:n,from:i}=e;g().createAndCommit({userAction:"workflowTemplateInstanceActions.handleDeleteAccept",environment:t,canUndo:!0,perform:e=>{const a=o.getSchema();for(const l of n){_().BJ({environment:t,collectionStore:o,schema:a,property:l,transaction:e});const n=a[l];n&&(0,v().i)({environment:t,collectionContextStore:r,property_type:n.type,from:i,property:l})}}})}({environment:t,collectionStore:o,collectionContextStore:a,propertyIds:n,from:l})}],c=new Intl.ListFormat(r().locale,{style:"long",type:"conjunction"}),d=(0,I.jsx)(p().sA,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deletePropertyFromDb",defaultMessage:"Delete this property from <bold>{databaseName}</bold>? {otherPropertyNames} will also be deleted",values:{bold:e=>(0,I.jsx)("span",{style:{fontWeight:f().Wy.bold},children:e}),databaseName:(0,I.jsx)(S().A,{style:{display:"inline",fontWeight:f().Wy.bold},shouldWrap:!0,store:o}),otherPropertyNames:c.format(i)}});h().ui({message:(0,I.jsx)("span",{children:d}),showCancel:!0,keepFocus:!0,innerStyle:{width:400},items:s})}function E(e){const{environment:t,transaction:o,collectionStore:r,instance:n}=e;(0,C().aI)({environment:t,instancePointer:n,inMemoryRecordCache:r.inMemoryRecordCache})||g().applyOperation({store:r,operation:{pointer:r.pointer,command:"keyedObjectListRemove",path:["format","compound_workflow_template_instances"],args:{remove:{id:n.id}}},transaction:o})}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class r extends(()=>o(757695))().Store{getInitialState(){return{}}}const n=new r;o(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",n);const i=n},334684:(e,t,o)=>{o.d(t,{$:()=>l});var r=()=>o(970013),n=()=>o(713998),i=()=>o(534177);const a=["button","formula","auto_increment_id","file"];function l(e){const{propertyType:t,propertySchema:o,allowAIProperty:l}=e,s=(0,i().O9)(o)&&(0,r().$M)(o)&&(0,i().O9)((0,r().om)(o)),c=!l&&s,d=(0,i().O9)((0,n().Dz)(o));return a.includes(t)||c||d}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>O,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>w,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>M,MAX_RECURRENCE_INTERVAL:()=>_,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>h,RRULE_WEEKDAYS_MAP:()=>v,adjustedStartDateIfPossible:()=>x,areRecurrenceSchedulesEqual:()=>N,convertFromUnpersistedRecurrenceConfig:()=>B,convertToUnpersistedRecurrenceConfig:()=>E,getFormattedEndCondition:()=>k,getFormattedNextRecurrenceTime:()=>P,getNewEndTimestamp:()=>R,getNextDateUtc:()=>T,getRecurrenceAfter:()=>C,isRunningBetweenMidnightAnd3AM:()=>I,isValidRecurrenceInterval:()=>g,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>A});o(898992),o(354520),o(581454);var r=()=>o(244641);o(944114);function n(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];if(0===o.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...n(o[0],...o.slice(1)).map((e=>[a,...e])));return i}var i=()=>o(496603),a=()=>o(534177),l=()=>o(720665),s=()=>o(597777),c=()=>o(869190),d=()=>o(416504),u=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const y=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},v={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},_=99,h=999;function g(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=_}function b(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function S(e){const{start_date:t,frequency:o,interval:r,weekdays:i,timezone:l,hour:c,minute:d}=e,u="week"===o&&i?i.map((e=>v[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=n(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return v[t].nth(o)})):(0,a().HB)(e.monthly_restriction)),new p({freq:f[o],dtstart:(0,s().eU)(t),interval:r,byweekday:u,tzid:l,byhour:c??0,byminute:d??0,bysecond:0,...m})}const M=1,w=1;function A(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,n=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>M,a=o.length>=w;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:n}}function x(e){var t;const{recurrence:o,afterDate:n}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=n)return o;let i=r().c9.fromMillis(o.start_date,{zone:"utc"});const a=r().c9.fromMillis(n,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/o.interval);i=i.plus({years:e*o.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/o.interval);i=i.plus({months:e*o.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/o.interval);i=i.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/o.interval);i=i.plus({days:e*o.interval});break}}return{...o,start_date:(0,s().DH)(i.toMillis())}}function C(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,s().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(x({recurrence:t,afterDate:o})).after((0,s().eU)(o));if(!e)return;return(0,s().h1)(e)}}function I(e){return 0===e.hour||1===e.hour||2===e.hour}function T(e){return S(e).after((0,s().eU)((0,s().Rz)()))||void 0}function P(e){const{recurrence:t,intl:o}=e,n=T(B(t));if(!n)return;const i=I(t),a=r().c9.fromJSDate(n).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(o)).setZone(t.timezone),l=(0,c().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(y.dateBetweenMidnightAnd3AM,{date:l});{let e=a.toLocaleString(r().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(y.dateAtTime,{date:l,time:e})}}function k(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(y.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:r().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(y.noEndCondition)}const O=100;function E(e){return{...e,start_date:(0,s().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function R(e,t,o){return e.plus(o-t)}function D(e,t){const o=r().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Rz)(o.toJSDate())}}function B(e){return{...e,start_date:(0,s().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?D(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function N(e,t){const o=i().fN(e,(e=>void 0!==e)),r=i().fN(t,(e=>void 0!==e));return i().n4(o,r)}},414712:(e,t,o)=>{o.d(t,{DZ:()=>v,Lp:()=>y,QK:()=>f,YX:()=>_,ni:()=>u});var r=o(296540),n=()=>o(56366),i=()=>o(66689),a=()=>o(970013),l=()=>o(713998),s=()=>o(919709),c=()=>o(319975),d=()=>o(751156);i().Hx.Dates;function u(e){var t,o;const{collectionStore:r,propertySchema:n,collectionContextStore:i,store:a,property:s,isJiraTwoWaySyncEnabled:c}=e;if(!r.isExternallyImportedAndSyncedCollection())return!1;if(!c)return!0;const d=Boolean(null===(t=r.getFormat())||void 0===t||null===(t=t.sync_state)||void 0===t?void 0:t.syncing);if("read_write"!==(null==n?void 0:n.synced_permissions)||null===(o=r.getFormat().sync_state)||void 0===o||!o.enable_two_way_sync||d)return!0;const u=null==i?void 0:i.externalSyncStore.state;return(null==u||!u.shouldAllowUserToEditSyncedCollection())&&(0,l().VF)(a.getModel(),s,a.getRecordModel)}const p={[i().Hx.Dates]:{propertyId:i().Hx.Dates,validationCheck:e=>{const{collectionStore:t}=e,o=t.getPropertyMapping(),r=null==o?void 0:o[i().Hx.StatusV2];return Boolean(r)}}},m={date:[i().Hx.Dates]};function y(e){const{collectionStore:t,property:o,propertySchema:r}=e;if(!r)return!0;const n=t.getPropertyMapping();if(!n)return!1;const i=m[r.type]??[];for(const a of i){const e=p[a];if(!e.validationCheck({collectionStore:t}))continue;const r=null==n?void 0:n[e.propertyId];if(o===e.propertyId||o===r)return!0}return!1}function f(e,t){let{store:o,property:n,format:i,onClick:a,collectionStore:l,blockPropertyValueOverlayStore:s,disableHorizontalEdgeScroll:c,focusButtonAfterClose:d}=e;return(0,r.useMemo)((()=>({store:o,property:n,format:i,onClick:a,collectionStore:l,blockPropertyValueOverlayStore:s,disableHorizontalEdgeScroll:c,isStatusCheckbox:null==t?void 0:t.isStatusCheckbox,focusButtonAfterClose:d})),[s,l,c,i,null==t?void 0:t.isStatusCheckbox,a,n,o,d])}function v(e,t,o){return(0,n().K8)((()=>{if(!e.isDefined())return;if(!e.isTemplate())return;const r=null==o?void 0:o.type;if(!(0,a().mF)(r))return;const n=e.getPropertyValue(t);if(!n)return;const i=null==n?void 0:n[0];if(i&&s().qXl(i)){const e=s().PVS(s().wQU(i)),t=e&&s().y0Y(e);return t&&{templateVariable:t.type}}}),[t,o,e],{debugName:"useTemplateVariableContext"})}function _(e,t,o){const r=l().hk(e);d().createAndCommit({userAction:"BlockPropertyValueOverlay.handleNumberValueChange",environment:t,canUndo:!0,perform:e=>{for(const n of o)c().R9({environment:t,store:n,value:r,transaction:e})}})}},422540:(e,t,o)=>{o.d(t,{$0:()=>v,Fx:()=>w,Ge:()=>m,I3:()=>u,Kj:()=>S,PP:()=>A,TK:()=>x,Yy:()=>d,aE:()=>C,cQ:()=>M,kH:()=>y,m7:()=>p,nq:()=>g,nv:()=>_,tj:()=>f});o(898992),o(354520),o(737550);var r=()=>o(496603),n=()=>o(534177),i=()=>o(970013),a=()=>o(651124),l=()=>o(349835),s=()=>o(390066);const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(c[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:l,sort:c,sourcePropertyIds:d}=e,p=(d??(0,n().uv)(o)).filter(((t,r,n)=>{const a=o[t];return!(!a||!u(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,a))&&(!l||l([t,a],r,o)))}));if(0===p.length)return[];if(!t||!1===c)return p;const m=(0,s().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return r().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:o,sort:l}=e,c=(0,n().uv)(o).filter(((e,t,r)=>{const n=o[e];return!(!n||!(0,i().JY)(n))}));if(0===c.length)return[];if(!t||!1===l)return c;const d=(0,s().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return r().Ul(c,(e=>d.findIndex((t=>t.property===e))))}function y(e){return e.type===l().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===l().M9.TokenExpected?{type:e.type,token:e.token}:e.type===l().uW.MissingSchemaPropertyOnThisRow||e.type===l().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===l().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===l().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===l().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===l().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===l().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===l().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===l().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===l().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===l().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===l().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,place:!1};function v(e){return Boolean(f[e.type])}function _(e){const{collectionFormat:t,collectionSchema:o,filter:l,sort:c}=e,d=(0,n().uv)(o).filter(((e,t,r)=>{var n;const a=o[e];return!(!a||!f[a.type])&&((!(0,i().$M)(a)||null===(n=(0,i().om)(a))||void 0===n||!n.auto_update_on_edit)&&(!l||l([e,a],t,o)))}));if(0===d.length)return[];if(!t||!1===c)return d;const u=(0,s().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return r().Ul(d,(e=>u.findIndex((t=>t.property===e))))}const h={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function g(e){return h[e.type]}const b={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function S(e){return b[e.type]}function M(e){return 0===e}function w(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function A(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function x(e){const{collectionSchema:t,property:o,type:r}=e,n=null==t?void 0:t[o];return!n||("action"===r?!u(n):!f[n.type])}function C(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:r,source:i,relativeDate:a}=t.event;if(void 0===i)return!1;const l="some"===r.type&&r.some,s="all"===r.type&&r.all;if((l||s||[]).some((e=>A({collectionSchema:o,property:e.property})||x({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const c="some"===r.type&&(!(0,n().O9)(r.some)||0===r.some.length),d="all"===r.type&&(!(0,n().O9)(r.all)||0===r.all.length);if(!e&&("none"===r.type||c||d)&&!a)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},546461:(e,t,o)=>{o.d(t,{EC:()=>w,To:()=>M,YC:()=>A,or:()=>S,u:()=>b});o(16280);var r=o(296540),n=()=>o(484714),i=()=>o(792485),a=()=>o(56366),l=()=>o(496506),s=()=>o(322867),c=()=>o(959013),d=()=>o(534177),u=()=>o(813297),p=()=>o(862292),m=()=>o(698331),y=()=>o(645873),f=()=>o(190019),v=()=>o(76190),_=o(474848);const h=new WeakMap,g=(0,r.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});g.displayName="AutomationContext";function b(e){const{automationStore:t,children:o,contextType:r}=e,b=(0,n().v3)(),S=(0,c().tz)(),{value:M}=(0,y().fJ)(p().T.formulas),{value:w}=(0,y().fJ)(u().QV.automationTypecheck),A=(0,v().n)(t),x=(0,i().S)(),C=(0,a().K8)((()=>{if(!M)return{error:new(s().N9)("Missing formulas dependency")};if(!w)return{error:new(s().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:r,contextType:n,formulasModule:i,intl:a,isSubscribed:s,pageStore:c}=e,u=h.get(o);if(u)return u;{const e=new(l().ComputedStore)((()=>{const e=o.getTriggerType();let l=n;return(0,d().O9)(e)&&(0,m().x2)(e)&&(l=(0,m().H8)(e)),(0,f().Z)({environment:t,automationStore:o,automationTypecheckModule:r,contextType:l,formulasModule:i,intl:a,isSubscribed:s,pageStore:c})}),{debugName:"automationContextTypecheckResultCachedStore"});return h.set(o,e),e}}({environment:b,automationStore:t,automationTypecheckModule:w,contextType:r,formulasModule:M,intl:S,isSubscribed:A,pageStore:"button_block"===r?null==x?void 0:x.pageStore:void 0});return e.state}),[b,t,w,r,M,S,A,null==x?void 0:x.pageStore]);return(0,_.jsx)(g.Provider,{value:{automationStore:t,typecheckResult:C,contextType:r,defined:!0},children:o})}function S(e){const{automationStore:t,children:o}=e,r=(0,a().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,_.jsx)(b,{automationStore:t,contextType:(0,m().H8)(r??"event"),children:o})}function M(e){var t;return null===(t=h.get(e))||void 0===t?void 0:t.state}function w(){const e=r.useContext(g);if(!1===e.defined)throw new Error("No automation context found!");return e}function A(){return r.useContext(g)}},566910:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"0.97 2.72 18.06 14.56",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M3.893 2.875a.626.626 0 0 1 .79-.02l.092.088.126.146.016.035.072.105 11.273 13.15a.624.624 0 0 1-1.036.678l-1.615-1.884c-1.12.408-2.339.633-3.611.633-3.757 0-7.049-1.946-8.707-4.843l-.155-.283a1.46 1.46 0 0 1 0-1.359l.155-.283c.89-1.554 2.249-2.835 3.898-3.688L3.826 3.757l-.072-.105a.626.626 0 0 1 .14-.777M6.031 6.33c-1.564.744-2.842 1.913-3.653 3.33l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214.957 0 1.876-.144 2.734-.406l-1.1-1.284a3.3 3.3 0 0 1-1.634.438l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17c0-.777.269-1.492.718-2.056zm2.903 3.387q-.036.135-.037.281a1.104 1.104 0 0 0 1.218 1.097zM10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.164c.126.332.126.7 0 1.032l-.073.163a9.3 9.3 0 0 1-2.987 3.327l-.82-.955c1.15-.764 2.084-1.779 2.7-2.953l.02-.048a.2.2 0 0 0 0-.1l-.02-.049C16.382 7.282 13.438 5.445 10 5.445q-.706 0-1.378.1l-.94-1.098A10.7 10.7 0 0 1 10 4.194"}),(0,r.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.136 3.303l-.005.17a3.3 3.3 0 0 1-.116.702L9.623 6.713q.186-.022.377-.022z"})]})},i=(0,o(340498).wt)("eyeSlash",n)},698331:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>a,x2:()=>n});var r=()=>o(534177);function n(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,r().O9)(t)&&n(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,r().HB)(e)}},716547:(e,t,o)=>{o.r(t),o.d(t,{PagePropertiesRowNameMenu:()=>te});o(16280),o(944114),o(898992),o(354520),o(672577),o(581454);var r=o(296540),n=()=>o(484714),i=()=>o(56366),a=()=>o(443239),l=()=>o(970013),s=()=>o(487929),c=()=>o(713998),d=()=>o(49621),u=()=>o(859384),p=()=>o(764781),m=()=>o(89849),y=()=>o(566910),f=()=>o(167170),v=()=>o(735790),_=()=>o(236262),h=()=>o(564262),g=()=>o(778781),b=()=>o(798880),S=()=>o(959013),M=()=>o(381349),w=()=>o(183558),A=()=>o(534177),x=()=>o(966759),C=()=>o(235191),I=()=>o(686526),T=()=>o(334261),P=()=>o(854593),k=()=>o(751156),O=()=>o(324587),E=()=>o(797535),R=()=>o(519839),D=()=>o(730307),B=()=>o(175116),N=()=>o(722872),j=()=>o(553965),V=()=>o(978846),U=()=>o(712287),L=()=>o(447934),F=()=>o(937199),H=()=>o(154807),W=()=>o(57618),z=()=>o(962730),G=()=>o(712505),q=()=>o(575143),$=()=>o(760217),K=()=>o(939740),Y=()=>o(8980),X=()=>o(859428),Z=()=>o(662971),J=()=>o(26517),Q=o(474848);function ee(e){const t=(0,B().ET)(),T=(0,n().v3)(),J=(0,o(401497).DP)(),{permissionScopes:ee,collectionSettingsStore:te,collectionStore:ie,layoutStore:ae}=(0,i().K8)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,collectionSettingsStore:t.settingsStore,collectionStore:t.collectionStore(),layoutStore:null===(e=t.collectionStore())||void 0===e?void 0:e.getLayoutStore()}}),[t]),{databaseType:le,collectionSchema:se}=(0,i().K8)((()=>({databaseType:null==ie?void 0:ie.getDatabaseType(),collectionSchema:null==ie?void 0:ie.getSchema()})),[ie]),{property:ce,schema:de,blockStore:ue}=e,pe=(0,c()._g)({schema:de,property:ce}),me=(0,i().K8)((()=>o(685889).pg(t,pe)),[t,pe]);(0,r.useEffect)((()=>{const e=de[ce];t&&"relation"===(null==e?void 0:e.type)&&(null==me||me.load())}),[t,ce,de,me]);const ye=(0,i().K8)((()=>!!ie&&Boolean(le&&o(313892).jP((0,o(617254).appConfigs)(),le,ce,ie))),[ce,le,ie]),fe=(0,o(234359).dm)(ue,se,ce,pe);let ve;const{device:_e}=T;ve=_e.isMobile?{menuType:N().gu.ActionSheet}:{menuType:N().gu.Popup,width:220};const he=Boolean((0,r.useContext)(F().sf)),{sessionId:ge,setModuleSelection:be}=(0,r.useContext)(F().Op)||{},Se=!he&&!fe,Me=(0,i().K8)((()=>(0,o(400851).Y)({environment:T,blockStore:ue,from:"pagePropertiesRowNameMenu"})),[ue,T]),we=!(0,i().O$)(o(227440).e)&&(0,A().O9)(pe)&&(0,o(334684).$)({propertyType:pe.type,propertySchema:pe,allowAIProperty:!1}),Ae=function(e){let{property:t,schema:o,format:r,blockStore:n,pagePropertiesStore:i,popupContainerRef:T,collectionContextStore:B,permissionScopes:N,collectionStore:F,collectionSettingsStore:K,isTypedProperty:J,environment:ee,theme:te,layoutModule:ie,isInPageLayoutEditor:ae,layoutSessionId:le,layoutStore:se,isPropertyCommentsEnabled:ce,canShowLayoutBuilderEntryPoint:de,hideDuplicatePropertyOption:ue,setModuleSelection:pe,editingDisabledOffline:me}=e;const{device:ye}=ee,fe=(0,c()._g)({schema:o,property:t});if(!(B&&K&&fe&&F))return[];const ve=[],_e=ae&&(0,g().V_)(ie),he=N.canConfigureCollection||N.canConfigureBlock;if(he&&!(0,a().u)(t)&&!N.isExternallyImportedAndSyncedCollection){const e=ae&&(_e||(0,g().i_)(ie)||(0,g()._Q)(ie));if(_e){const e=[{key:"Show As Property Or Section",action:()=>{},render:(e,n)=>(0,Q.jsx)(Z().A,{...e,renderOrigin:e=>(0,Q.jsx)(q().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Show as",id:"database.configureProperty.showAsAction"}),svg:m().eyeIcon}),onFocus:n.onFocus,renderExtension:(e,n)=>(0,Q.jsx)(ne,{popupEvents:e,extParent:n,property:t,schema:o,format:r,collectionStore:F,pagePropertiesStore:i})})}];ve.push(e)}const a=[];if(ve.push(a),a.push({key:"rename",render:e=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Rename",id:"database.tableHeaderCell.rename"}),icon:(0,Q.jsx)(Y().I,{icon:u().M})}),action:()=>{I().Ow({collectionContextStore:B,collectionSettingsStore:K,fromBlockStore:n}),I().dP({collectionSettingsStore:K,item:{type:"property",formatKey:"collection_page_properties",property:t,selectNameInitial:!ye.isMobile}})}}),a.push({key:"edit_property",render:e=>(0,Q.jsx)(X().A,{placement:z().W.Left,render:t=>(0,Q.jsx)($().A,{title:(0,Q.jsx)(S().sA,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,Q.jsx)(Y().I,{icon:v().M}),...(0,j().A)(e,t),disabled:me,disabledFeedback:!0}),style:{whiteSpace:"normal"},renderTooltip:()=>me?(0,Q.jsx)(S().sA,{id:"database.tableHeaderCell.editPropertyTooltip.offline",defaultMessage:"Unavailable while offline"}):(0,Q.jsx)(S().sA,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{I().Ow({collectionContextStore:B,collectionSettingsStore:K,fromBlockStore:n,hideDuplicatePropertyOption:ue}),I().dP({collectionSettingsStore:K,item:{type:"property",formatKey:"collection_page_properties",property:t}})}}),se&&e){const e=[{key:"Move to layout",action:()=>{if(!le)throw new Error("could not find session id for layouts logging");const e=(0,w().Ay)(),o=(0,h().W)(se.getModules());(0,V().UQ)({position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===o.area?{area:o.area,viewId:o.viewsMainTabId}:{area:o.area}},layoutStore:se,environment:ee,module:{type:"property_relation",id:e,propertyId:t},sessionId:le,isPropertyCreation:!1}),null==pe||pe({type:"existing_module",moduleId:e,isDragging:!1}),oe(i,B)},render:e=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Add to layout",id:"database.configureProperty.moveToLayout"}),icon:(0,Q.jsx)(Y().I,{icon:f()._})})}];ve.push(e)}ce&&"formula"!==fe.type&&"rollup"!==fe.type&&"button"!==fe.type&&"auto_increment_id"!==fe.type&&"verification"!==fe.type&&!(0,l().F_)(fe.type)&&a.push({key:"comment",render:e=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Comment",id:"database.tableHeaderCell.comment"}),icon:(0,Q.jsx)(Y().I,{icon:d().h})}),action:async()=>{await(0,D().l)({environment:ee,blockStore:n,rect:W().A.getRect(n,t),property_id:t}),oe(i,B)}})}const ge=[];ve.push(ge);let be=!0;if("relation"===fe.type){var Se;const e=r.collection_page_sections||[],o=e.findIndex((e=>e.section===t)),n=null===(Se=e[o])||void 0===Se?void 0:Se.visibility;!n||"inline"!==n&&"minimal"!==n||(be=!1)}if("title"!==fe.type&&N.canConfigureBlock&&be&&!((0,g().gx)(ie)||(0,g()._Q)(ie)||(0,g().V_)(ie))){const e=r.property_visibility;if(e){const n=e.find((e=>e.property===t));ge.push({key:"Property Visibility",action:()=>{},render:(e,a)=>(0,Q.jsx)(Z().A,{...e,renderOrigin:e=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Property visibility",id:"database.configureProperty.propertyVisibilityAction"}),icon:"show"===(null==n?void 0:n.visibility)?(0,Q.jsx)(Y().I,{icon:y().e}):(0,Q.jsx)(Y().I,{icon:m().eyeIcon})}),onFocus:a.onFocus,renderExtension:()=>(0,Q.jsx)(re,{property:t,schema:o,format:r,collectionStore:F,pagePropertiesStore:i})})})}}l().cN.includes(fe.type)&&N.canConfigureCollection&&!(0,a().u)(t)&&!N.isExternallyImportedAndSyncedCollection&&((0,l().vB)(fe)&&!ue&&ge.push({key:"Duplicate Property",render:e=>(0,Q.jsx)(X().A,{disableTooltip:!me,placement:z().W.Left,render:t=>(0,Q.jsx)($().A,{...(0,j().A)(e,t),title:(0,Q.jsx)(S().sA,{defaultMessage:"Duplicate property",id:"database.configureProperty.duplicateAction"}),icon:(0,Q.jsx)(Y().I,{icon:p().V}),disabled:me,disabledFeedback:!0}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,Q.jsx)(S().sA,{id:"database.duplicatePropertyTooltip.offline",defaultMessage:"Unavailable while offline"})}),action:async()=>{oe(i,B),await async function(e,t,o,r,n){const i=o.collection_page_properties||[],a=null==t?void 0:t.getSpaceId();if(!t||!a)return;const l=t.getNormalizedPropertyGroups(),s=await R().W4({environment:n,schema:r,properties:i,property:e,propertyGroups:l,parentStore:t,spaceId:a});if(s){const e=n.currentUser.id,i=e?{id:e,table:b().oo}:void 0;k().createAndCommit({userAction:"PagePropertiesRowName.handleDuplicate",environment:n,canUndo:!0,perform:e=>{(0,A().O9)(s.automationUpdate)&&O().duplicateAutomation({actorPointer:i,environment:n,sourceAutomationStore:s.automationUpdate.sourceAutomationStore,targetAutomationId:s.automationUpdate.targetAutomationId,transaction:e});const a={...r,[s.newProperty]:s.newPropertySchema},l={...o,collection_page_properties:s.newProperties,property_groups:s.newPropertyGroups};(0,E().I)({environment:n,collectionStore:t,update:{schema:a,format:l},transaction:e})}})}}(t,F,r,o,ee)}}),J||ge.push({key:"delete",render:e=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),icon:(0,Q.jsx)(Y().I,{icon:_().trashIcon}),hoveredStyle:{color:M().Ay.red,fill:M().Ay.red}}),action:async()=>{const e=()=>{var e;if(!_e)return;const o=B.collectionStore(),r=null==o?void 0:o.getSchema(),n=null==o?void 0:o.getFormat();if(!(0===(r&&n?(0,s().T)({format:n,schema:r,visibilityLevels:["inline","minimal"]}):[]).filter((e=>e.section!==t)).length))return;const i=null==o||null===(e=o.getLayoutStore())||void 0===e?void 0:e.getModules().page_main.find((e=>"normalizedTitleWithIcon"===e.type));i&&(null==pe||pe({type:"existing_module",moduleId:i.id,isDragging:!1}))};oe(i,B),await async function(e){let{environment:t,theme:o,property:r,schema:n,collectionStore:i,collectionContextStore:a,onAccept:l}=e;if(!a)return;await P().q({environment:t,collectionContextStore:a,property:r,handleDeleteAccept:()=>(l(),function(e,t,o,r,n){if(!n)return;k().createAndCommitAsync({environment:e,userAction:"PagePropertiesRowName.handleDeleteAccept",waitForServerCommit:!1,perform:n=>C().PF({environment:e,collectionStore:r,schema:o,property:t,transaction:n})});const i=r.getSchema()[t];i&&(0,x().i)({environment:e,collectionContextStore:n,property_type:i.type,from:"table_column",property:t});const a=r.getLayoutStore(),l=(0,H().SR)(r);G().default.state.open||!a||l||(0,U().F)({environment:e,from:"details_sidebar_empty",layoutStore:a,panelLocation:"mainPage",preventPeekWidthResize:!1})}(t,r,n,i,a)),theme:o,from:"table_column"})}({environment:ee,theme:te,property:t,schema:o,collectionStore:F,onAccept:e,collectionContextStore:B})}}));const Me=[];de&&Me.push({key:"customizeLayout",action:()=>{oe(i,B);const e=B.collectionStore();e&&(0,L().nh)({environment:ee,blockStore:n,collectionStore:e,from:"page_property_menu"})},render:(e,t)=>(0,Q.jsx)($().A,{...e,title:(0,Q.jsx)(S().sA,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,Q.jsx)(Y().I,{icon:f()._})})});ae||ve.push(Me);return ve}({property:e.property,schema:e.schema,format:e.format,blockStore:e.blockStore,pagePropertiesStore:e.pagePropertiesStore,popupContainerRef:e.popupContainerRef,collectionContextStore:t,permissionScopes:ee,collectionStore:ie,collectionSettingsStore:te,isTypedProperty:ye,environment:T,theme:J,layoutModule:e.layoutModule,layoutSessionId:ge,isInPageLayoutEditor:he,layoutStore:ae,isPropertyCommentsEnabled:Se,hideDuplicatePropertyOption:Boolean(e.hideDuplicatePropertyOption),canShowLayoutBuilderEntryPoint:Me,setModuleSelection:be,editingDisabledOffline:we});return(0,Q.jsx)(o(928600).A,{...ve,children:(0,Q.jsx)(K().Ay,{type:K().Oh.Vertical,initialFocus:void 0,sections:o(496603).oE(null==Ae?void 0:Ae.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,Q.jsx)(o(89924).A,{...e,topBorder:0!==t}),items:e}})))})})}const te=r.memo(ee);function oe(e,t){e.setState({...e.state,openProperty:void 0});const o=null==t?void 0:t.settingsStore;o&&I().os({collectionSettingsStore:o})}function re(e){let{property:t,schema:o,format:i,collectionStore:a,pagePropertiesStore:l}=e;const s=(0,n().v3)(),c=(0,r.useContext)(B().p2),d=i.property_visibility;if(!d)return null;const u=o[t];if(!u)return null;const p=d.find((e=>e.property===t));return(0,Q.jsx)(J().YB,{propertySchema:u,currentVisibility:(null==p?void 0:p.visibility)||"show",onSelect:e=>function(e,t,o,r,n){k().createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:n,canUndo:!0,perform:n=>{T().D7({property:t,visibility:e,format:o,store:r,transaction:n})}})}(e,t,i,a,s),onClose:()=>{oe(l,c)}})}function ne(e){let{popupEvents:t,extParent:o,property:i,schema:a,format:l,collectionStore:s,pagePropertiesStore:c}=e;const d=(0,n().v3)(),u=(0,r.useContext)(B().p2),p=l.collection_page_sections||[];if(!a[i])return null;const m=p.findIndex((e=>e.section===i)),y=p[m];return(0,Q.jsx)(J().Wf,{currentVisibility:(null==y?void 0:y.visibility)||"section_hide",onSelect:e=>{C().Z7({visibility:e,property:i,schema:a,collectionStore:s,format:l,environment:d}),oe(c,u)},onClose:()=>{o.close()}})}},735790:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);var r=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.25 15.25 11.5",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,r.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},i=(0,o(340498).wt)("sliders",n)},854593:(e,t,o)=>{o.d(t,{q:()=>_});o(944114),o(296540);var r=()=>o(302107),n=()=>o(959013),i=()=>o(284371),a=()=>o(521358),l=()=>o(16006),s=()=>o(972435),c=()=>o(685889),d=()=>o(470928),u=()=>o(290966),p=()=>o(204067),m=()=>o(27732),y=()=>o(901389),f=()=>o(751156),v=o(474848);async function _(e){const{environment:t,collectionContextStore:o,property:_,handleDeleteAccept:h}=e,g=o.collectionStore();if(!g)return;if(g.isTypedProperty(_)){if(await a().nD({environment:t,property:_,collectionContextStore:o,theme:e.theme,from:e.from}))return}const b=(0,p().R5)({environment:t,collectionStore:g,propertyId:_});if(b.length>0){if((0,u().E_)({environment:t,collectionStore:g,propertyId:_,compoundTemplateInstancesToDelete:b,collectionContextStore:o,from:e.from}))return}else if(((0,d().k$)(_)||(0,d().Do)({collectionStore:g,propertyId:_}))&&(0,d().aF)(g)&&(0,d().Io)()){if((0,u().I5)({environment:t,collectionStore:g,propertyId:_,collectionContextStore:o,from:e.from}))return}const S=o.normalizedSchemaStore.state,M=S[_],w=c().pg(o,M);await(null==w?void 0:w.load());const A=w&&c().D5(o,_,w),x=w&&c().uf(w),C=w&&g.id===w.id,I=[{label:(0,v.jsx)(n().sA,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:h}];let T,P;if(A&&g&&x&&!C&&I.push({label:(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteProperty.modal.inverseConfirmButton",defaultMessage:"Delete, but keep related property"}),color:"red",onAccept:()=>{f().createAndCommit({userAction:"collectionPropertyActions.showDeletePropertyDialog",environment:t,canUndo:!0,perform:e=>{if(M&&"relation"===M.type&&M.property&&w){const o=M.property,r=w.getSchema();m().C4({environment:t,collectionStore:w,propertySchema:r[o],property:o,targetPropertyID:void 0,autoRelate:g.isSyncedCollection()&&!w.isSyncedCollection()?{enabled:!1}:M.autoRelate,transaction:e})}m().t$({environment:t,collectionStore:g,property:_,transaction:e})}})}}),"auto_increment_id"===(null==M?void 0:M.type))T=c().me(S)?(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteUniqueIdWithGithubProperty.modal.prompt",defaultMessage:"You will no longer be able to link new GitHub PRs and status automations will stop working."}):(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteUniqueIdProperty.modal.prompt",defaultMessage:"The ID property will be permanently deleted."});else if("status"===(null==M?void 0:M.type)){const e=c().AX(S);if(e){const t=e.connectedRelation.automation;t&&t[_]&&(T=(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteStatusProperty.modal.prompt",defaultMessage:"Deleting this status property will stop the GitHub Pull Requests status automation."}))}}else w&&x&&!C&&A?T=(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteRelatedProperty.modal.prompt",defaultMessage:"This property has a related property on {relationTargetName} which will also be deleted.",values:{relationTargetName:(0,v.jsx)(l().A,{style:{display:"inline",fontWeight:i().Wy.medium},store:w})}}):M&&(0,r().dR)({propertyId:_,propertyType:M.type,permissionItems:g.getPermissionItems()})&&(P=s().A.formatMessage(r().DZ.deletePropertyTypeWarningMessage),T=s().A.formatMessage(r().DZ.deletePropertyTypeWarningDescription));y().ui({message:P||(0,v.jsx)("span",{children:(0,v.jsx)(n().sA,{id:"database.tableHeaderCell.deleteProperty.modal.prompt",defaultMessage:"Delete this property from {databaseName}? It will be removed from all views.",values:{databaseName:(0,v.jsx)(l().A,{style:{display:"inline",fontWeight:i().Wy.bold},shouldWrap:!0,store:g})}})}),description:T,showCancel:!0,keepFocus:!0,items:I,mode:"wide"})}},888325:(e,t,o)=>{function r(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>r})},890409:(e,t,o)=>{o.d(t,{Ah:()=>v,Dk:()=>m,Iv:()=>f,SF:()=>y,YO:()=>g,_f:()=>S,c_:()=>u,dW:()=>h,gW:()=>p,sp:()=>M,vN:()=>_});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var r=()=>o(496603),n=()=>o(973647),i=()=>o(534177),a=()=>o(842599),l=()=>o(977345),s=()=>o(798880),c=()=>o(919709),d=()=>o(241319);function u(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function b(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:r,getRecordModel:a,spaceId:s,value:c,featureGates:d}=e;if("formula"===c.type){if(!(0,i().O9)(c.value))return;const e=n().Q.unwrapOr(o.parseFormulaInputToAst(c.value),void 0);if(e){const n=o.addTypesToFormulaAST(e,{handleDataRequest:(0,l().zg)(a),spaceId:s,valueTypes:r,featureGates:d});return{...t.getFormulaAnalytics(e,{getRecordModel:a,typecheckContextValues:r}),formula_return_type:n.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:a,typecheckContextValues:r})}}}else{if("simple"===c.type){if(!(0,i().O9)(c.value))return;return t.getSimpleFormulaAnalytics(c.value,{getRecordModel:a,typecheckContextValues:r})}(0,i().HB)(c.type)}}function S(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y,simpleFormulasModule:f}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:r,formulaTypecheckContextValues:n,getRecordModel:a,featureGates:l}=e,s=t.getConfig();let c,d=[];const u=null==s?void 0:s.collection,p=null==s?void 0:s.properties;if((0,i().O9)(u)&&(0,i().O9)(p)&&p.length>0){const e=a(u),y=null==e?void 0:e.getNormalizedSchema();(0,i().O9)(y)&&(d=p.map((e=>{var t;return(null===(t=y[e])||void 0===t?void 0:t.type)??"unknown"})));const f=null==s?void 0:s.values;if(r&&(0,i().O9)(f)){c=[];for(const e of p){var m;const i=null===(m=f[e])||void 0===m?void 0:m.value;if(!i)continue;const s=b({formulaAnalyticsModule:o,formulasModule:r,getRecordModel:a,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:i,featureGates:l});s&&c.push(s)}}}return{automation_action_id:t.pointer.id,property_formula_stats:c,property_types:d,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:r,formulaTypecheckContextValues:n,getRecordModel:a,featureGates:l}=e,s=t.getConfig(),c=[];if(r&&(0,i().O9)(s)&&s.text){const e=b({formulasModule:r,formulaAnalyticsModule:o,getRecordModel:a,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:s.text,featureGates:l});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:r,formulasModule:n,formulaTypecheckContextValues:a,getRecordModel:l,featureGates:s,simpleFormulasModule:d}=e,u={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,i().O9)(p))return u;if((0,i().O9)(p.target))if("formula"===p.target.type&&(0,i().O9)(p.target.value)){if(u.targetData={type:"formula",numUserFormulaTargets:(0,c().Fbh)(p.target.value.value).length,numFormulaContextTargets:d.getReferencedContextValueIds(p.target.value).length},n){const e=b({formulasModule:n,formulaAnalyticsModule:r,getRecordModel:l,formulaTypecheckContextValues:a,spaceId:o.spaceId,value:p.target.value,featureGates:s});e&&(u.formula_stats??=[],u.formula_stats.push(e))}}else if("property"===p.target.type&&(0,i().O9)(p.target.propertyId)&&(0,i().O9)(p.target.collectionPointer)){const e=l(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,i().O9)(t)&&(u.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,i().O9)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(u.messageCharacterCount=(0,c().FAw)(p.notification_message.value),n)){const e=b({formulasModule:n,formulaAnalyticsModule:r,getRecordModel:l,formulaTypecheckContextValues:a,spaceId:o.spaceId,value:p.notification_message,featureGates:s});e&&(u.formula_stats??=[],u.formula_stats.push(e))}return u}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y,simpleFormulasModule:f}):t.isType("send_gmail_notification")?function(e){var t,o,n,l,d,u,p;const{automationActionModel:m,formulaAnalyticsModule:y,formulasModule:f,formulaTypecheckContextValues:v,getRecordModel:_,featureGates:h}=e,g=m.getConfig();if(!(0,i().O9)(g))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const S=Object.fromEntries(Object.entries(g||{}).map((e=>{let[t,o]=e;var r;return"formula"===(null==o?void 0:o.type)?[t,Boolean(null==o||null===(r=o.value)||void 0===r?void 0:r.value)]:"simple"===(null==o?void 0:o.type)?[t,Boolean(null==o?void 0:o.value)]:[t,Boolean(o)]}))),{to:M,cc:w,bcc:A}=g,x=[...(null==M||null===(t=M.value)||void 0===t?void 0:t.value)||[],...(null==w||null===(o=w.value)||void 0===o?void 0:o.value)||[],...(null==A||null===(n=A.value)||void 0===n?void 0:n.value)||[]],C=[...(0,c().Fbh)(x).map((e=>_({table:s().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(i().O9),...(0,a().C3)((0,c().k4p)(x))],I=r().Tr(C.map((e=>e.split("@")[1]))),T=[null===(l=g.to)||void 0===l?void 0:l.value,null===(d=g.cc)||void 0===d?void 0:d.value,null===(u=g.bcc)||void 0===u?void 0:u.value,null===(p=g.reply_to)||void 0===p?void 0:p.value,g.from_name,g.email_subject,g.email_body].map((e=>{if(f&&(0,i().O9)(e))return b({formulaAnalyticsModule:y,formulasModule:f,getRecordModel:_,formulaTypecheckContextValues:v,spaceId:m.spaceId,value:e,featureGates:h})})).filter(i().O9);return{automation_action_id:m.pointer.id,fields:S,formula_stats:T,recipient_domains:I,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:r,formulasModule:n,formulaTypecheckContextValues:a,getRecordModel:s,featureGates:c}=e,u=t.getConfig(),p=[],m=[],y=[];if((0,i().O9)(u)&&(0,i().O9)(u.target)&&(0,i().O9)(u.properties)&&u.properties.length>0){let e;if("variable"===u.target.type){const t=(0,l().y5)(u.target.id);if("action"===t.source){const t=(0,d().y)({actionModels:o,id:u.target.id}).collectionPointer;if((0,i().O9)(t)){const o=s(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,l().IV)(a,u.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,i().O9)(t.type.collection)){const o=s(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===u.target.type){const t=s(u.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,i().O9)(e)&&u.properties.forEach((o=>{const l=e[o];if((0,i().O9)(l)&&(p.push(l.type),n&&(0,i().O9)(u.values))){const e=u.values[o];if((0,i().O9)(e)&&(m.push({type:l.type,operator:e.action}),e.value)){const o=b({formulasModule:n,formulaAnalyticsModule:r,getRecordModel:s,formulaTypecheckContextValues:a,spaceId:t.spaceId,value:e.value,featureGates:c});o&&y.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:y,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:r,formulaTypecheckContextValues:n,getRecordModel:a,featureGates:l}=e,s=t.getConfig(),c=[];if(r&&(0,i().O9)(s)&&s.values)for(const i of Object.values(s.values))if(i.value){const e=b({formulasModule:r,formulaAnalyticsModule:o,getRecordModel:a,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:i.value,featureGates:l});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:void(0,i().HB)(t)}function M(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:r,formulasModule:n,formulaTypecheckContextValues:a,getRecordModel:l,featureGates:s,simpleFormulasModule:c,source:d}=e,u=[],p=t.getActionPointers().map((e=>l(e))).filter(i().O9);for(const g of t.getActionPointers()){const e=l(g);(0,i().O9)(e)&&u.push(S({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:r,formulasModule:n,formulaTypecheckContextValues:a,getRecordModel:l,featureGates:s,simpleFormulasModule:c}))}const m=[];let y,f,v;if(t.isEventType()){var _;const e=t.getEventConfiguration(),o=l(t.getParentPointer());y=t.getParentId();const r=t.getEventConfiguration();if("collection_view"===(null===(_=r.source)||void 0===_?void 0:_.type)){const e=l(r.source.pointer);v=null==e?void 0:e.parent_id,f=null==r?void 0:r.source.pointer.id}const n=null==o?void 0:o.getNormalizedSchema();if((0,i().O9)(n)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&m.push({type:"page"}),"any"===o.type)m.push({condition:"any",type:"property"});else if("none"===o.type)m.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],r=[];e.forEach((e=>{var o;const a=null===(o=n[e.property])||void 0===o?void 0:o.type;(0,i().O9)(a)&&(t.push({type:a,operator:e.filter.operator}),r.push(a))})),m.push({condition:o.type,property_configs:t,property_types:r,type:"property"})}}}else if(t.isButtonType())m.push({type:"button"});else if(t.isRecurrenceType()){var h;m.push({type:"recurrence",frequency:null===(h=t.getTrigger().recurrence)||void 0===h?void 0:h.frequency})}else(0,i().HB)(t);return{automation_actions:u,automation_id:t.id,automation_triggers:m,collection_id:y,collection_view_id:f,collection_view_block_id:v,builder_type:o,source:d}}},937199:(e,t,o)=>{o.d(t,{LH:()=>i,Op:()=>n,bi:()=>s,sf:()=>l,v$:()=>a});o(16280);var r=o(296540);const n=(0,r.createContext)(null);function i(){const e=(0,r.useContext)(n);if(!e)throw new Error("usePageLayoutEditorContext must be used inside BaseLayoutEditorContext.Provider");return e}function a(){return(0,r.useContext)(n)}n.displayName="BaseLayoutEditorContext";const l=(0,r.createContext)(null);function s(){const e=(0,r.useContext)(l);if(!e)throw new Error("usePageLayoutEditorContext must be used inside PageLayoutEditorContextProvider");return e}l.displayName="PageLayoutEditorContext"},966759:(e,t,o)=>{o.d(t,{i:()=>i});var r=()=>o(476492),n=()=>o(175213);function i(e){const{environment:t,collectionContextStore:o,property_type:i,from:a,property:l,...s}=e,c=(0,r().sl)(o)||{};(0,n().G)(t,{property:l,property_type:i,from:a,...s,...c})}},978846:(e,t,o)=>{o.d(t,{E:()=>_,UQ:()=>h});o(16280),o(18107),o(944114),o(967357);var r=()=>o(31503),n=()=>o(792071),i=()=>o(688728),a=()=>o(500993),l=()=>o(369186),s=()=>o(475140),c=()=>o(120997),d=()=>o(251822),u=()=>o(778781),p=()=>o(496603),m=()=>o(534177),y=()=>o(751156),f=()=>o(447934),v=()=>o(204521);function _(e){const{moduleId:t,layoutStore:o,sessionId:n,environment:a,position:l}=e,s=o.getModuleById(t);if(!s)throw new Error(`Cannot move module with id ${t} because a module with that id is not in the layout`);const c=(0,v().TR)({modulesByArea:o.getModules(),moduleId:t,newPosition:l});g({...e,module:s,userAction:"BuilderLayoutModules.moveModuleToPosition",afterUpsertTransaction:()=>{var e;const t=(0,r().Cg)({moduleId:s.id,modulesByArea:o.getModules()}).length;(0,v().Ib)({environment:a,sessionId:n,collectionId:null===(e=o.getCollectionModel())||void 0===e?void 0:e.id,layoutId:o.id,context:(0,i().We)(l.area),action:c,moduleType:s.type,area:l.area,depth:t})}})}function h(e){const{position:t,module:o,layoutStore:n,sessionId:a,environment:l}=e;if(n.getModuleById(o.id))throw new Error(`Cannot add module with id ${o.id} because a module with that id is already in the layout`);g({...e,userAction:"BuilderLayoutModules.addModuleAtPosition",performBeforeApplyUpsertOperations:e=>{const{transaction:r}=e;"page_main"!==t.area&&"page_details"!==t.area||(0,u().gx)(o)&&(0,f().HD)({environment:l,transaction:r,layoutStore:n,property:o.propertyId})},afterUpsertTransaction:()=>{var s;const c=(0,r().Cg)({moduleId:o.id,modulesByArea:n.getModules()}).length;(0,v().zb)({environment:l,module:o,sessionId:a,collectionId:null===(s=n.getCollectionModel())||void 0===s?void 0:s.id,layoutId:n.id,context:(0,i().We)(t.area),isPropertyCreation:e.isPropertyCreation,area:t.area,depth:c})}})}function g(e){const{environment:t,position:o,layoutStore:r,module:d,transaction:u,userAction:p,performBeforeApplyUpsertOperations:f,afterUpsertTransaction:v}=e,_=r.pointer,h=r.getModules(),g=r.getRawModules(),w=g&&(0,s().c7)(g,(e=>e.id===d.id))||(0,l().Lv)(d),A="page_main"===o.area||"page_details"===o.area?function(e){const{layoutPointer:t,modulesByArea:o,rawModulesByArea:r}=e,a=(0,s().EX)(o,(e=>"relationsGroup"===e.type));if("form_conditional_modules"===(null==a?void 0:a.position.area))return;const c=r&&(0,s().LC)(r,(e=>"relationsGroup"===e.type));if(!a)return;if(a&&c)return;const d=a.module;if(!d||"relationsGroup"!==d.type)throw new Error("relations group module location in normalized was incorrect, cannot backfill relations group module");return function(e){var t;const{module:o,modulesByArea:r,layoutPointer:a}=e,c=(0,s().JO)(r,(e=>e.id===o.id));if(!c)throw new Error("cannot upsert module at current position because module does not have a current position");if("form_conditional_modules"===c.area)throw new Error("[Forms Conditional Logic Not Implemented] form_conditional_modules area is not supported for adding and moving modules");const d="views_main_tab_modules"===c.area?null===(t=r.views_main_tab_modules)||void 0===t?void 0:t[c.viewId]:r[c.area];if(!d||0===d.length)throw new Error("cannot upsert module at current position in area because that area is empty");const u={module:(0,l().Lv)(o),pointer:a,..."views_main_tab_modules"===c.area?{area:i().Zm[c.area],viewId:c.viewId}:{area:i().Zm[c.area]}};if(0===c.index)return n().N4X.putModuleAfter({...u,afterId:void 0});const p=d.at(c.index+1);if(!p)return n().N4X.putModuleAfter({...u,afterId:void 0});return n().N4X.putModuleBefore({...u,beforeId:p.id})}({module:d,layoutPointer:t,modulesByArea:o})}({layoutPointer:_,modulesByArea:h,rawModulesByArea:g}):null;A&&y().createAndCommitOrAppend({environment:t,perform:e=>{y().applyOperation({transaction:e,store:r,operation:A})},canUndo:!0,transaction:u,userAction:`${p||"BuilderLayoutModules.upsert"}.preOpBackfill`});const x=[],C=function(e){const{layoutStore:t,module:o,upsertPosition:r}=e,a=t.getModules(),l=(0,s().JO)(a,(e=>o.id===e.id));if(!l)return;if("form_conditional_modules"===l.area)return n().N4X.deleteModuleInArea({pointer:t.pointer,area:l.area,moduleId:o.id});if("views_main_tab_modules"===l.area){const e="absolute"===r.type&&"views_main_tab_modules"===r.area?r.viewId:void 0,i=l.viewId;if(e===i)return;return n().N4X.deleteModuleInArea({pointer:t.pointer,area:l.area,moduleId:o.id,viewId:i})}if("page_main"===l.area||"page_details"===l.area||"form_layout_schema"===l.area||"person_profile_page_main"===l.area||"person_profile_page_details"===l.area){if(l.area===r.area)return;return n().N4X.deleteModuleInArea({pointer:t.pointer,area:i().Zm[l.area],moduleId:o.id})}(0,m().HB)(l.area)}({upsertPosition:o,module:d,layoutStore:r});C&&x.push(C);const I=function(e){const{upsertPosition:t,layoutPointer:o,modulesByArea:r,rawModuleToUpsert:l}=e;if("absolute"===t.type)return function(e){const{upsertPosition:t,rawModuleToUpsert:o,layoutPointer:r,modulesByArea:l}=e,d=(0,s().JO)(l,(e=>o.id===e.id)),{area:u}=t;if("form_conditional_modules"===u){const{parentConditionalGroupId:e,parentModuleId:i}=t;if(!(0,c().V)(o,"form_conditional_modules"))throw new Error("Can only add form question or placeholder modules to form_conditional_modules area.");const d=(0,s().Ib)({modulesByArea:l,find:e=>e.id===o.parentModuleId}),u=(0,a().A)(i,l);return n().N4X.upsertChildModule({pointer:r,module:o,previousParentModuleAndArea:d,newParentModule:{area:u.area,module:u.module,conditionalGroupId:e,index:t.index},modulesByArea:l})}const p=t.index;if(p<0)throw new Error(`Cannot upsert module with id ${o.id} to a negative position`);if("views_main_tab_modules"===u){const e=t.viewId;if(!l[u]||!l[u][e])throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");const a="views_main_tab_modules"===(null==d?void 0:d.area)&&(null==d?void 0:d.viewId)===e?d.index:void 0,s=b({modulesInArea:l[u][e],indexOfModuleToUpsertInArea:a,indexToUpsertTo:p});if(!s)return;return[n().N4X.putModuleBeforeOrAfter({pointer:r,area:i().Zm[u],viewId:e,module:o,direction:s.insertDirection,beforeOrAfterId:s.beforeOrAfterId})]}const m=l[u],y=(null==d?void 0:d.area)===u?d.index:void 0,f=b({modulesInArea:m,indexOfModuleToUpsertInArea:y,indexToUpsertTo:p});if(!f)return;return[n().N4X.putModuleBeforeOrAfter({pointer:r,area:i().Zm[u],module:o,direction:f.insertDirection,beforeOrAfterId:f.beforeOrAfterId})]}({upsertPosition:t,rawModuleToUpsert:l,layoutPointer:o,modulesByArea:r});if("module_relative"===t.type)return[S({upsertPosition:t,rawModuleToUpsert:l,layoutPointer:o,modulesByArea:r})];if("area_relative"===t.type)return[M({upsertPosition:t,rawModuleToUpsert:l,layoutPointer:o,modulesByArea:r})];(0,m().HB)(t)}({module:d,upsertPosition:o,modulesByArea:h,layoutPointer:_,rawModuleToUpsert:w});I&&x.push(...I);const T="placeholder"===d.type&&"form_layout_schema"===o.area?`form_layout_new_question_${d.id}`:void 0;y().createAndCommitOrAppend({environment:t,undoCheckpoint:T,canUndo:!0,perform:e=>{f&&f({transaction:e});for(const t of x)y().applyOperation({transaction:e,store:r,operation:t})},transaction:u,userAction:p||"BuilderLayoutModules.upsert"}),v&&v()}function b(e){const{modulesInArea:t,indexOfModuleToUpsertInArea:o,indexToUpsertTo:r}=e;if(0===r||0===t.length)return{insertDirection:"before",beforeOrAfterId:void 0};const n=t.at(r);return n?void 0===o?{insertDirection:"before",beforeOrAfterId:n.id}:o!==r?o<r?{insertDirection:"after",beforeOrAfterId:n.id}:{insertDirection:"before",beforeOrAfterId:n.id}:void 0:{insertDirection:"after",beforeOrAfterId:void 0}}function S(e){const{upsertPosition:t,rawModuleToUpsert:o,layoutPointer:r,modulesByArea:a}=e,{area:l,direction:c,relativeToModuleId:d}=t,u=i().Zm[l],p=(0,s().JO)(a,(e=>e.id===d));if(!p||p.area!==l)throw new Error(`Cannot find module with id: ${d} to add upsert relative to in ${l}`);if("views_main_tab_modules"===u){const e="views_main_tab_modules"===p.area?p.viewId:void 0;if(!e)throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");return n().N4X.putModuleBeforeOrAfter({pointer:r,area:"views_main_tab_modules",viewId:e,module:o,direction:"above"===c?"before":"after",beforeOrAfterId:d})}return n().N4X.putModuleBeforeOrAfter({pointer:r,area:u,module:o,direction:"above"===c?"before":"after",beforeOrAfterId:d})}function M(e){const{upsertPosition:t,rawModuleToUpsert:o,layoutPointer:r,modulesByArea:a}=e,{location:l}=t;if("views_main_tab_modules"===t.area){const e=t.viewId,c={pointer:r,area:i().Zm[t.area],viewId:e,module:o};if("start"===l||"end"===l)return n().N4X.putModuleBeforeOrAfter({...c,direction:"start"===l?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===l){var s;const e=w({area:t.area,modulesInArea:(null===(s=a.views_main_tab_modules)||void 0===s?void 0:s[t.viewId])??[]});return n().N4X.putModuleBeforeOrAfter({...c,direction:e.insertDirection,beforeOrAfterId:e.beforeOrAfterId})}(0,m().HB)(l)}const c={pointer:r,area:i().Zm[t.area],module:o};if("start"===l||"end"===l)return n().N4X.putModuleBeforeOrAfter({...c,direction:"start"===l?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===l){const e=a[t.area],o=w({area:t.area,modulesInArea:e});return n().N4X.putModuleBeforeOrAfter({...c,direction:o.insertDirection,beforeOrAfterId:o.beforeOrAfterId})}(0,m().HB)(l)}function w(e){const{area:t,modulesInArea:o}=e,{nonMoveableHeaderModules:r,moveableModules:n,nonMoveableFooterModules:i}=(0,d().jS)(t,o);if(n.length){const e=(0,p().HV)(n);if(!e)throw new Error("cannot find last moveable module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(r.length){const e=(0,p().HV)(r);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(i.length){const e=i.at(0);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"before",beforeOrAfterId:e.id}}return{insertDirection:"after",beforeOrAfterId:void 0}}}}]);