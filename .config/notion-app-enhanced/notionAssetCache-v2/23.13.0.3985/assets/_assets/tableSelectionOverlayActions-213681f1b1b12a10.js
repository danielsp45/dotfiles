"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[95496],{339016:(e,o,t)=>{t.r(o),t.d(o,{handleCommandEnter:()=>Z,handleCommandShiftEnter:()=>te,handleCopy:()=>q,handleCut:()=>X,handleDelete:()=>J,handleDirection:()=>Q,handleDragCancel:()=>W,handleDragEnd:()=>L,handleDragMove:()=>_,handleDragStart:()=>U,handleDuplicate:()=>oe,handleEnter:()=>G,handleEsc:()=>Y,handleKeypress:()=>re,handleMoveTo:()=>j,handlePaste:()=>$,handleRowSelectableEnter:()=>ne,handleShiftEnter:()=>ee,setSelection:()=>N,updateSelectionScroll:()=>ie});t(944114),t(898992),t(803949),t(581454),t(908872);var r=()=>t(908006),n=()=>t(584262),l=()=>t(970013),i=()=>t(713998),a=()=>t(522419),c=()=>t(179034),s=()=>t(708830),d=()=>t(522986),m=()=>t(612008),u=()=>t(843306),p=()=>t(750660),S=()=>t(246826),f=()=>t(755636),v=()=>t(281948),h=()=>t(435009),y=()=>t(620689),w=()=>t(778417),g=()=>t(4319),b=()=>t(319975),C=()=>t(751156),R=()=>t(2220),F=()=>t(404779),x=()=>t(519839),z=()=>t(458366),P=()=>t(38337),k=()=>t(405417),T=()=>t(492414),E=()=>t(592678),A=()=>t(57618),M=()=>t(695625),V=()=>t(644914),D=()=>t(765957),K=()=>t(353643),O=()=>t(732770),B=()=>t(611371),I=()=>t(450510),H=()=>t(556148);function N(e){const{selection:o,shouldNormalize:t,environment:r,collectionContextStore:n,groupFormat:l,showPropertyFormats:i,allRows:a,selectionStartRectStore:c}=e,s=n.collectionViewBlockStore();if(!s)return;const d=t?(0,I().yR)(o,i.length,a.length):o,m=a[d.start.row];g().td({environment:r,selectionKey:{collectionViewBlockStore:s,groupFormat:l},selection:d,currentRowStore:m}),c.recompute()}function U(e){const{dragEvent:o,environment:t,collectionContextStore:r,showPropertyFormats:n,paddingLeft:l,disabled:i,dragAndFillStore:a,frozenColumnRepositionStore:c,frozenIndex:s,allRows:d,normalizedTableSelection:m}=e;if(o.preventDefault(),o.target instanceof Element){if(H().Hl(o.target,P().FZs))c.setState({isRepositioning:!0,newFrozenIndex:s,newFrozenColumnXPosition:void 0}),function(e){var o;const{environment:t,collectionContextStore:r,showPropertyFormats:n,paddingLeft:l,allRows:i}=e;if(!r.frozoneStore.state.isScrolled)return;const a=i[0],c=n[0].property,s=A().A.findBlockPropertyValue(a,c),d=r.frozoneStore.state.scrollerLeftOffset??0,m=(0,V().kf)(t),u=Math.max(m-d,0),p=(0,I().QP)(t,r)?u:0;null==s||null===(o=s.getScrollerContext())||void 0===o||null===(o=o.horizontalScroller)||void 0===o||null===(o=o.getNode())||void 0===o||o.scrollTo({left:l-p})}({environment:t,collectionContextStore:r,showPropertyFormats:n,paddingLeft:l,allRows:d}),K().A.setState({...K().A.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const e=m;if(e&&H().Gd(i,r)&&H().Hl(o.target,P().yle))return void a.setState({...e})}(0,F().y)()}}function _(e){const{dragEvent:o,environment:t,collectionContextStore:r,groupFormat:n,showPropertyFormats:l,dragAndFillStore:i,frozenColumnRepositionStore:a,normalizedTableSelection:c,allRows:s,selectionStartRectStore:d}=e;if(!(o.target instanceof Element))return;if(a.state.isRepositioning);else if((0,E().Zm)()){const e=H().RT(o.target);if(!e)return;const a=i.state,m=(null==a?void 0:a.start)??(null==c?void 0:c.start)??e;if(!m)return;N({selection:{start:m,end:e},shouldNormalize:!0,environment:t,collectionContextStore:r,groupFormat:n,showPropertyFormats:l,allRows:s,selectionStartRectStore:d})}}function L(e){const{environment:o,collectionContextStore:t,showPropertyFormats:r,schema:n,dragAndFillStore:i,frozenColumnRepositionStore:a,normalizedTableSelection:c,allRows:s}=e;!function(e){const{environment:o,collectionContextStore:t,frozenColumnRepositionStore:r}=e,n=r.state.isRepositioning;if(!n)return;C().createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,canUndo:!0,perform:e=>{g().sp({environment:o,collectionContextStore:t,currentIndex:r.state.newFrozenIndex,transaction:e,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),r.reset()}})}({environment:o,collectionContextStore:t,frozenColumnRepositionStore:a}),function(e){const{environment:o,showPropertyFormats:t,schema:r,dragAndFillStore:n,normalizedTableSelection:i,allRows:a}=e,c=i;if(!c)return;const s=n.state;if(!s)return;const{start:d,end:m}=s;if(d.row!==m.row)return;const{start:u,end:p}=c,[S,f]=[Math.min(u.row,p.row),Math.max(u.row,p.row)],[v,h]=[Math.min(u.col,p.col),Math.max(u.col,p.col)],y=a[u.row],w=t.slice(v,h+1),g=w.reduce(((e,o)=>{var t;const n=null===(t=r[o.property])||void 0===t?void 0:t.type;return!n||l().rb.has(n)||"verification"===n||e.push({property:o.property,propertyType:n,value:y.getPropertyValue(o.property)||[]}),e}),[]);if(0===g.length)return;const b=a.slice(S,f+1);C().createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:o,canUndo:!0,perform:e=>{g.forEach((o=>{let{value:t,property:r,propertyType:n}=o;le({transaction:e,value:t,property:r,propertyType:n,startRowStore:y,rowStores:b})}))}}),(0,R().u)({environment:o,event:{eventName:"collection_table_drag_and_fill",eventProperties:{property_types:g.map((e=>e.propertyType)),num_rows:f-S,num_cols:g.length}}}),n.reset()}({environment:o,showPropertyFormats:r,schema:n,collectionContextStore:t,dragAndFillStore:i,normalizedTableSelection:c,allRows:s})}function W(e){const{dragAndFillStore:o,frozenColumnRepositionStore:t}=e;o.reset(),t.reset(),(0,F().y)()}function Q(e){var o;const{shortcutOrKeyboardEvent:t,direction:r,environment:n,collectionContextStore:l,groupFormat:i,showPropertyFormats:a,normalizedTableSelection:c,allRows:s,frozenSectionWidth:d,frozenIndex:m,disableHorizontalEdgeScroll:u,shiftKeyOverride:p}=e;null===(o=t.preventDefault)||void 0===o||o.call(t),O().A.setKeyboardMode(!0);const S=c;if(!S)return;const f=l.collectionViewBlockStore();if(!f)return;const v=void 0!==p?p:"shiftKey"in t&&t.shiftKey||!1,h={collectionViewBlockStore:f,groupFormat:i};let y=S;switch(r){case H().Dp.Left:y=g().jG({environment:n,selectionKey:h,selection:S,shiftKey:v,columnCount:a.length});break;case H().Dp.Right:y=g().Uz({environment:n,selectionKey:h,selection:S,shiftKey:v,columnCount:a.length,rowCount:s.length});break;case H().Dp.Up:y=g().bi({environment:n,selectionKey:h,selection:S,shiftKey:v});break;case H().Dp.Down:y=g().mL({environment:n,selectionKey:h,selection:S,shiftKey:v,rowCount:s.length})}ie({environment:n,direction:r,showPropertyFormats:a,normalizedTableSelection:y,allRows:s,frozenSectionWidth:d,frozenIndex:m,disableHorizontalEdgeScroll:u})}function G(e){const{shortcutEvent:o,environment:t,schema:r,showPropertyFormats:n,disabled:l,blockPropertyValueOverlayStore:a,collectionContextStore:c,normalizedTableSelection:s,allRows:m,disableHorizontalEdgeScroll:u}=e;o.preventDefault&&o.preventDefault(),O().A.setKeyboardMode(!0);const p=s;if(!p)return;const S=m[p.start.row],f=n[p.start.col].property,v=r[f];if(v&&!l)if((0,z().B2)(v))d().ho({environment:t,blockPropertyValueOverlayStore:a,store:S,property:f,format:"table",disableHorizontalEdgeScroll:u,collectionContextStore:c}),(0,F().y)();else if("checkbox"===v.type){const e=S.getPropertyStore(f),o=i().wu(e.getValue()),r=m.slice(p.start.row,p.end.row+1);C().createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,canUndo:!0,perform:e=>{for(const n of r)b().R9({environment:t,store:n.getPropertyStore(f),value:i().rN(!o),transaction:e})}})}}function Z(e){const{environment:o,collectionContextStore:t,normalizedTableSelection:r,allRows:n,overrideLinkClick:l}=e,{device:i}=o,a=r;if(i.isMobile||!a)return;const c=n[a.start.row],{mainEditorCurrentBlockStore:s}=D().default.state,d=(0,x().wy)({environment:o,store:c,mainEditorCurrentBlockStore:s,collectionContextStore:t,fullyQualified:!1});d&&(l?l(d):h().oo({environment:o,url:d}))}function Y(e){const{keyboardEvent:o,environment:t,normalizedTableSelection:r,allRows:n}=e;if(t.device.isMobile)return;o.preventDefault(),O().A.setKeyboardMode(!0);const l=r;if((0,F().y)(),l){const e=(0,I().hn)(l),o=n.slice(e.minRow,e.maxRow+1);w().td({environment:t,stores:o})}}function j(e){var o;const{shortcutOrKeyboardEvent:t,environment:r,normalizedTableSelection:n,allRows:l}=e;null===(o=t.preventDefault)||void 0===o||o.call(t),O().A.setKeyboardMode(!0);const i=n;if((0,F().y)(),!i)return;const a=(0,I().hn)(i),c=l.slice(a.minRow,a.maxRow+1);if(0===c.length)return;w().td({environment:r,stores:c});const s=M().T.getRectFromStore(c[0]);p().ho({environment:r,blocks:c,originRect:s,moveToContext:"action_menu"})}function J(e){const{environment:o,collectionContextStore:t,disabled:r,showPropertyFormats:n,normalizedTableSelection:l,allRows:i}=e,a=l,c=t.normalizedSchemaStore.state;a&&!r&&C().createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:o,canUndo:!0,perform:e=>{g().ic({selection:a,schema:c,currentPropertyFormats:n,currentRows:i,transaction:e})}})}function X(e){const{clipboardEvent:o,environment:t,collectionContextStore:r,disabled:n,groupFormat:l,showPropertyFormats:i,normalizedTableSelection:a,allRows:c,formulasModule:s}=e,d=a,m=r.normalizedSchemaStore.state,u=r.collectionViewBlockStore();u&&d&&!n&&C().createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,canUndo:!0,perform:e=>{g().De({selectionKey:{collectionViewBlockStore:u,groupFormat:l},schema:m,selection:d,currentPropertyFormats:i,currentRows:c,event:o,transaction:e,formulasModule:s})}})}function q(e){const{clipboardEvent:o,collectionContextStore:t,groupFormat:r,showPropertyFormats:n,normalizedTableSelection:l,allRows:i,formulasModule:a}=e,c=l,s=t.normalizedSchemaStore.state,d=t.collectionViewBlockStore();d&&c&&g().A_({selectionKey:{collectionViewBlockStore:d,groupFormat:r},schema:s,selection:c,currentPropertyFormats:n,currentRows:i,event:o,formulasModule:a})}function $(e){const{clipboardEvent:o,environment:t,collectionContextStore:r,groupFormat:n,schema:l,showPropertyFormats:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:c,disabled:s,normalizedTableSelection:d,allRows:m,clipboardActions:u}=e,p=d,S=r.collectionViewBlockStore();S&&p&&!s&&C().createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,canUndo:!0,perform:e=>{g().GZ({environment:t,collectionContextStore:r,clipboardActions:u,selectionKey:{collectionViewBlockStore:S,groupFormat:n},selection:p,currentPropertyFormats:i,currentRows:m,event:o,transaction:e,schema:l,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:c})}})}function ee(e){const{environment:o,collectionContextStore:t,groupFormat:l,blockPropertyValueOverlayStore:i,showPropertyFormats:a,normalizedTableSelection:c,allRows:p,selectionStartRectStore:S,frozenSectionWidth:f,frozenIndex:h,disableHorizontalEdgeScroll:y}=e,{device:w}=o;if(w.isMobile)return;const g=c;if(!g)return;if(!(0,B().EF)(o))return;if(!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const b=p[g.start.row],R=t.subitemTreeStore.state,F=(0,s().Qe)(R.children,(e=>e.value.store===b)),z="table_selection_overlay_shift_enter";if(F){const e=F?(0,k().kY)(F.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(e),s=Boolean(null==c?void 0:c.isExpanded),f=[...F].splice(0,F.length-1),h=f?(0,k().kY)(f.map((e=>e.value.store))):"",y=t.subitemExpandedStore.state.get(h),w=Boolean(null==y?void 0:y.isExpanded);if(s||w)C().createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:o,canUndo:!0,perform:e=>{const r=t.collectionStore();if(!r)return;const n=(0,u().u)({environment:o,collectionContextStore:t,groupsPointer:l?[l]:[],store:b,before:!1,collectionStore:r,transaction:e,subitemPath:F,subitemInsertDirection:w&&!s?"below":"into",from:z});if(n&&i){const e=()=>{d().ho({isNewBlock:!0,environment:o,blockPropertyValueOverlayStore:i,store:n,property:"title",format:"table",collectionContextStore:t})};t.registerCallbackForItemMounted(n,e)}}});else{const e={col:g.end.col,row:t.currentViewHasSort()?p.length:g.end.row+1};C().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:o,canUndo:!0,perform:r=>{const i=(0,m().Q)({environment:o,collectionContextStore:t,groupsPointer:l?[l]:[],insertAtIndex:e.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:z},inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const e=l?[l]:[],r=t.groupsStore.getGroupState(e);v().VU({environment:o,store:i.newStore,peekMode:(0,x().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:n().y8.Create})}}}),r().default.afterNextFlush((()=>{N({selection:{start:e,end:e},shouldNormalize:!1,environment:o,collectionContextStore:t,groupFormat:l,showPropertyFormats:a,allRows:p,selectionStartRectStore:S})}))}}else{const e={col:g.end.col,row:t.currentViewHasSort()?p.length:g.end.row+1};C().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:o,canUndo:!0,perform:r=>{const i=(0,m().Q)({environment:o,collectionContextStore:t,groupsPointer:l?[l]:[],insertAtIndex:e.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:z},inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const e=l?[l]:[],r=t.groupsStore.getGroupState(e);v().VU({environment:o,store:i.newStore,peekMode:(0,x().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:n().y8.Create})}}}),r().default.afterNextFlush((()=>{N({selection:{start:e,end:e},shouldNormalize:!1,environment:o,collectionContextStore:t,groupFormat:l,showPropertyFormats:a,allRows:p,selectionStartRectStore:S})}))}ie({environment:o,direction:H().Dp.Down,showPropertyFormats:a,normalizedTableSelection:c,allRows:p,frozenSectionWidth:f,frozenIndex:h,disableHorizontalEdgeScroll:y}),d().VN({environment:o,blockPropertyValueOverlayStore:i})}function oe(e){var o;const{keyboardEvent:t,environment:r,disabled:n,schema:l,showPropertyFormats:i,normalizedTableSelection:a,allRows:c}=e,{device:s}=r;if(s.isMobile)return;const d=a;if(!d||d.start.col!==d.end.col||n)return;if(!(0,B().EF)(r))return;const{start:m,end:u}=d,[p,S]=[Math.min(m.row,u.row),Math.max(m.row,u.row)],f=i[m.col],{property:v}=f,h=null===(o=l[f.property])||void 0===o?void 0:o.type;if(!h)return;const y=c.slice(p,S+1),w=c[m.row],g=w.getPropertyValue(v)||[];t.preventDefault(),C().createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:r,canUndo:!0,perform:e=>{le({transaction:e,value:g,property:v,propertyType:h,startRowStore:w,rowStores:y})}})}function te(e){const{environment:o,normalizedTableSelection:t,allRows:r}=e,{device:l}=o;if(l.isMobile)return;if(t){const e=r[t.start.row],l=(0,T().Ay)({store:e,fullyQualified:!1,pageVisitSource:n().y8.LinkInPage});f().f({environment:o,url:l})}}function re(e){const{keyboardEvent:o,environment:t,schema:r,showPropertyFormats:n,disabled:i,blockPropertyValueOverlayStore:a,collectionContextStore:c,normalizedTableSelection:s,allRows:m,disableHorizontalEdgeScroll:u}=e;if(!o.key||o.metaKey||o.ctrlKey)return;o.preventDefault(),O().A.setKeyboardMode(!0);const p=s;if(!p)return;const S=m[p.start.row],f=n[p.start.col].property,v=r[f];v&&!i&&l().wz.includes(v.type)&&o.key&&1===o.key.length&&(d().ho({environment:t,blockPropertyValueOverlayStore:a,store:S,property:f,format:"table",disableHorizontalEdgeScroll:u,insertChar:o.key,collectionContextStore:c}),(0,F().y)())}function ne(e){const{onEnterArgs:o,environment:t,collectionContextStore:r,groupFormat:n,showPropertyFormats:l,allRows:i,selectionStartRectStore:a}=e,c=o.blocks.map((e=>i.indexOf(e))),s=Math.min(...c)||0,d=Math.max(...c)||0;s>=0&&d>=0&&N({selection:{start:{col:0,row:s},end:{col:0,row:d}},shouldNormalize:!0,environment:t,collectionContextStore:r,groupFormat:n,showPropertyFormats:l,allRows:i,selectionStartRectStore:a})}function le(e){const{transaction:o,value:t,property:r,propertyType:n,startRowStore:l,rowStores:s}=e,d={table:c().ev,id:l.id,spaceId:l.getSpaceId()};s.forEach((e=>{if(e.id!==l.id&&(b().R9({environment:e.environment,store:e.getPropertyStore(r),value:t,transaction:o}),"text"===n||"file"===n||"url"===n)){const r=(t?i().pJ(t):[]).reduce(((e,o)=>{const t=(0,a().oN)({urlOrAlias:o.url});return t?[...e,t]:e}),[]);r.length>0&&S().Bn({store:e,source:d,fileIds:r.map((e=>e.fileId)),transaction:o})}}))}function ie(e){const{environment:o,direction:t,showPropertyFormats:r,normalizedTableSelection:n,allRows:l,frozenSectionWidth:i,frozenIndex:a,disableHorizontalEdgeScroll:c}=e,s=n;if(!s)return;let d;d=t===H().Dp.Down?s.start.row>s.end.row?s.start:s.end:t===H().Dp.Up?s.start.row<s.end.row?s.start:s.end:t===H().Dp.Right?s.start.col>s.end.row?s.start:s.end:s.start.col<s.end.row?s.start:s.end;const m=l[d.row],u=r[d.col].property,p=A().A.findBlockPropertyValue(m,u),S=(null==p?void 0:p.getNode())??null;if(S){const e=i??0,t=c||a&&s.start.col<=a&&s.end.col<=a;y().hT({element:S,environment:o,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:t?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollerContext:null==p?void 0:p.getScrollerContext()})}}}}]);