"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11341],{47273:(e,t,n)=>{n.d(t,{DS:()=>o,Fe:()=>d,GB:()=>a,Gf:()=>u,V_:()=>l,j1:()=>c,j8:()=>i,yp:()=>p,yw:()=>s});var r=()=>n(762433);function o(e){return(0,r().Fq)({subscription:e})}function i(e){return(0,r().Ry)({clock:void 0,subscription:e,trial:void 0})}function a(e){let{subscriptionState:t,logFunction:n,spaceId:o}=e;const i=m(t);return(0,r().yB)({billingData:{clock:void 0,subscription:i,trial:void 0},logFunction:n,spaceId:o})}function s(e){return(0,r().q8)({subscription:e})}function c(e){return(0,r().V9)({clock:void 0,subscription:m(e),trial:void 0})}function d(e){return(0,r().d$)({clock:void 0,subscription:m(e),trial:void 0})}function l(e){return(0,r().ji)({clock:void 0,subscription:m(e),trial:void 0})}function u(e){return(0,r().AI)({clock:void 0,subscription:m(e),trial:void 0})}function p(e,t){return(0,r().KH)({clock:void 0,subscription:m(e),trial:void 0},t)}function m(e){return e?{...e,trialEnd:void 0}:void 0}},51473:(e,t,n)=>{n.d(t,{A:()=>o});n(898992),n(672577);class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}close(){this.state.open&&this.setState({open:!1})}open(e){let{oldTier:t,newTier:r,oldAddOns:o,newAddOns:i}=e;if(function(e){if(!e)return!1;return["plus","enterprise","business","student"].includes(e)}(r)){if(function(e,t){if(!e||!t)return!1;return"upgrade"===(0,n(979340).qR)({oldTier:e,newTier:t})}(t,r))return this.setState({productUpgrade:r,open:!0}),!0}if(i.length>o.length){const e=i.find((e=>!o.includes(e)));if(function(e){if(!e)return!1;return["ai"].includes(e)}(e))return this.setState({productUpgrade:e,open:!0}),!0}return!1}}const o=new r},112527:(e,t,n)=>{n.r(t),n.d(t,{getLegacyStripeAppearance:()=>k,getStripe:()=>S,injectStripe:()=>y,optionalPaymentMethodIdGivenPaymentData:()=>T,optionalStripeTokenGivenPaymentData:()=>C,stripeElementLocaleGivenNotionLocale:()=>I,translateStripeError:()=>w,useElementsOptions:()=>x});var r=()=>n(624119),o=()=>n(37458),i=n(296540),a=()=>n(484714),s=()=>n(56366),c=()=>n(401497),d=()=>n(402390);var l=()=>n(798880),u=()=>n(807487),p=()=>n(534177),m=()=>n(284371),g=()=>n(780054),f=()=>n(765957),b=()=>n(217429),v=n(474848);let h=null;function y(e){return function(t){const[n]=i.useState(S);return(0,v.jsx)(r().Elements,{stripe:n,children:(0,v.jsx)(r().ElementsConsumer,{children:n=>{let{stripe:r,elements:o}=n;const i={...t,stripe:r,elements:o};return(0,v.jsx)(e,{...i})}})})}}async function S(){return h||(o().loadStripe.setLoadParameters({advancedFraudSignals:!1}),h=(0,o().loadStripe)(g().A.stripe.key)),h}function I(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function x(e){const t=(0,c().DP)(),n=(0,a().v3)(),{type:r}=e,o="setup"===r||"subscription"===r?e.currency:void 0,g="subscription"===r?e.amount:void 0,v=(0,s().K8)((()=>{var e;return(null===(e=f().default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||d().q}),[]),h=(0,s().K8)((()=>"KRW"===o&&function(e){const{experimentService:t,actor:n}=e;return t.checkGate({actor:n,gateName:"kr_card_payment_method"})}({experimentService:b().default,actor:{table:l().oo,id:n.currentUser.id??""}})),[n.currentUser,o]);return(0,i.useMemo)((()=>{const e=function(e){const t=A(e.text.primary),n=A(e.text.secondary),r=A(e.text.tertiary),o=A(e.text.uiRedPrimary),i=A(e.text.uiBluePrimary),a=A(e.icon.contrast),s=A(e.whiteButtonBackground);return{labels:"above",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"12px",spacingGridColumn:"12px",spacingUnit:"4px",spacingTab:"6px",colorPrimary:t,colorPrimaryText:t,colorText:t,colorTextSecondary:n,colorTextPlaceholder:r,colorIcon:t,colorIconCheckmark:a,colorDanger:o,colorBackground:s,colorIconTabHover:t,colorIconTabSelected:i,colorIconChevronDown:t,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.medium}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"500",lineHeight:"16px",color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground},".Tab:focus":{boxShadow:e.buttonBlueFocusRing},".Tab--selected, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:t,boxShadow:"none",outline:"none"},".Tab--selected:hover":{backgroundColor:e.whiteButtonBackground,color:t},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.buttonBlueFocusRing},".Input":{fontSize:"14px",lineHeight:"18px",padding:"7px 8px",backgroundColor:e.surface.wash,boxShadow:`0 0 0 1px ${e.stroke.primary}`,border:"none",color:t},".Input--invalid":{color:t,boxShadow:e.inputRedFocusRing},".Input:focus":{color:t,boxShadow:e.inputBlueFocusRing},".Label":{fontSize:"12px",lineHeight:"15px",fontWeight:"500",color:n,marginBottom:"8px"},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:o},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:t},".PickerItem:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--selected:hover":{boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:t},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:n,fontSize:"10px",fontWeight:"400",lineHeight:"13px",letterSpacing:"0.12px"},".CheckboxLabel":{color:t,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:t,fontWeight:"400",padding:"4px 8px"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.buttonBlueFocusRing},".MenuIcon, .MenuIcon:hover":{fill:t},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",padding:"16px"},".Icon":{fill:t}}}}(t),n={appearance:e,locale:I(v)},i={paymentMethodTypes:(0,u().VV)({currency:o,isKrCardFeatureGateEnabled:h})};switch(r){case"address":return n;case"setup":return{...n,...i,currency:null==o?void 0:o.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"};case"subscription":return{...n,...i,amount:g,currency:null==o?void 0:o.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session",loader:"never"};default:(0,p().HB)(r)}}),[t,v,o,h,r,g])}function w(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(e,t.decline_code);default:return t.message||""}}function k(e){return{labels:"floating",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"8px",spacingGridColumn:"8px",spacingUnit:"4px",spacingTab:"4px",colorPrimary:e.text.primary,colorPrimaryText:e.text.primary,colorText:e.text.primary,colorTextSecondary:e.text.secondary,colorTextPlaceholder:e.text.tertiary,colorIcon:e.text.primary,colorIconCheckmark:e.icon.contrast,colorDanger:e.text.uiRedPrimary,colorBackground:e.whiteButtonBackground,colorIconTabHover:e.text.primary,colorIconTabSelected:e.text.uiBluePrimary,colorIconChevronDown:e.text.primary,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.semibold}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"510",lineHeight:"16px",color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary},".Tab:focus":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:e.buttonBlueFocusRing},".Tab--selected, .Tab--selected:hover, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:e.text.primary,boxShadow:"none",outline:"none"},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.buttonBlueFocusRing},".Input":{fontSize:"14px",lineHeight:"18px",padding:"4px 8px",boxShadow:"none",backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,color:e.text.primary},".Input--invalid":{border:"none",color:e.text.primary,boxShadow:e.inputRedFocusRing},".Label":{fontSize:"14px",lineHeight:"18px",color:e.text.tertiary},".Label--floating":{fontSize:"10px",fontWeight:"510",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease",color:e.text.secondary},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:e.text.uiRedPrimary},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary},".PickerItem:hover, .PickerItem--selected:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:e.text.primary},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:e.text.secondary,fontSize:"12px",fontWeight:"400",lineHeight:"15px"},".CheckboxLabel":{color:e.text.primary,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:e.text.primary,fontWeight:"400"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.buttonBlueFocusRing},".MenuIcon, .MenuIcon:hover":{fill:e.text.primary},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary}}}}function A(e){const[t,n,r,o]=e.match(/[\d.]+/g)??[];return t&&n&&r&&o&&1===parseInt(o)?`rgb(${t}, ${n}, ${r})`:e}function C(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function T(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}},323063:(e,t,n)=>{n.d(t,{HO:()=>m,V5:()=>c,Vr:()=>d,ef:()=>p,gL:()=>l,ng:()=>b,vH:()=>u,vk:()=>f,z2:()=>g});n(16280),n(269479),n(898992),n(354520),n(672577),n(581454),n(737550);var r=()=>n(720665),o=()=>n(762433),i=()=>n(47273),a=()=>n(622963),s=()=>n(979340);function c(e,t){return m(e.items,t.items).some((e=>{let[t,n]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const n=o().xp(e),r=o().xp(t);if(!n||!r)return!1;return s().o3[n]>s().o3[r]}(t,n)}))}function d(e,t,n){let{trialEnd:r,items:o}=t;return{trialEnd:r,items:o.map((t=>{const r=t.price.product,o=t.price.unitAmount.currencyCode,i=f(e,{interval:n,product:r,currency:o});return{...t,price:i}}))}}function l(e,t){const n=e.items.filter((e=>o().IE(e)!==t));return{...e,items:n}}function u(e,t,n){const{isMay13PackagingChangesEnabled:r}=n,i=o().IE(t),a=t.price.product,s=e.items.filter((e=>{const t=e.price.product,n=o().IE(e);return!(i===n)&&!(r&&"ai"===t&&("business"===a||"enterprise"===a))}));return{...e,items:s.concat([t])}}function p(e){const{state:t,prices:n,quantities:r,params:{interval:i,currency:a},products:s,flags:{isMay13PackagingChangesEnabled:c}}=e,d=s.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),l=d.map((e=>o().Mr(e))),u=t.items.filter((e=>{const t=e.price.product,n=o().IE(e),r=l.includes(n),i=c&&"ai"===t&&(d.includes("business")||d.includes("enterprise"));return!r&&!i})),p=d.map((e=>b(f(n,{interval:i,currency:a,product:e}),r)));return{...t,items:u.concat(p)}}function m(e,t){return(0,r().Z4)(e,(e=>o().IE(e)),t,(e=>o().IE(e)))}function g(e){const{prices:t,billingData:n,product:r}=e,a=o().Ry(n),s=o().lQ(n),c=i().yw(s),d=o().q8(n),l=c??d;return t.find((e=>e.product===r&&e.billingInterval===l&&e.unitAmount.currencyCode===a))}function f(e,t){let{interval:n,product:r,currency:o}=t;return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===r&&e.billingInterval===n&&e.unitAmount.currencyCode===o)),`Unable to find price with interval: ${n}, product: ${r}, currency: ${o}`)}function b(e,t){const{numSeats:n,numCustomHostnames:r}=t;return"public_domain_custom_hostnames"===(0,a().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:n}}},411341:(e,t,n)=>{n.r(t),n.d(t,{applyStudentGitHubGrant:()=>_e,closeSubscriptionUpgradeModal:()=>Te,handlePaymentIntentNextActions:()=>Me,handlePlanChangeClick:()=>Pe,openSubscriptionUpgradeModal:()=>Ce,openSubscriptionUpgradeModalForClaimAndUpgrade:()=>Be,payUnpaidInvoice:()=>be,refreshAllBillingData:()=>Se,refreshSubscriptionData:()=>xe,refreshUserData:()=>Ie,trackSubscriptionUpdate:()=>ge,updateAddress:()=>ve,updateBillingEmail:()=>ye,updateCurrentSpace:()=>ke,updatePaymentMethod:()=>fe,updateSubscription:()=>pe,updateSubscriptionToEducationPlan:()=>we,updateVatId:()=>he});n(16280),n(296540);var r=()=>n(857639),o=()=>n(206267),i=()=>n(763884),a=()=>n(386164),s=()=>n(762433),c=()=>n(47273),d=()=>n(323063),l=()=>n(166386);var u=()=>n(979340),p=()=>n(959013),m=()=>n(496603),g=()=>n(534177),f=()=>n(252105),b=()=>n(449506),v=()=>n(934839),h=()=>n(901389),y=()=>n(496414),S=()=>n(209660),I=()=>n(662453),x=()=>n(680074),w=()=>n(972435),k=()=>n(965378),A=()=>n(719431),C=()=>n(529803),T=()=>n(765957),B=()=>n(780262),P=()=>n(57605),M=()=>n(814431),D=()=>n(21735),_=()=>n(975971),E=()=>n(150193),U=()=>n(589994),H=()=>n(613240),N=()=>n(151059),W=()=>n(404141),F=()=>n(506090),L=()=>n(596513),O=()=>n(762299);const R=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async function(e,t){let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,449506)),i=await o.callApi({eventName:"countUsers",environment:e,data:{spaceId:r}});return"success"===i.type?i.data:void 0}));n(604341).exposeDebugValue("UserCountsStore",R);var $=()=>n(271084),V=()=>n(807778),j=()=>n(779795),z=()=>n(72256),G=()=>n(324561);n(898992),n(354520),n(672577),n(581454);var q=()=>n(112527),Y=()=>n(134217),K=()=>n(10984),Q=()=>n(995604),J=()=>n(430395),Z=()=>n(805061),X=()=>n(51473),ee=()=>n(981046),te=()=>n(749240),ne=()=>n(921997),re=()=>n(941541);async function oe(e){const{environment:t,spaceId:n}=e,r=(0,ne().GM)({spaceId:n});if(!se||se!==r){let n;!function(e){ae&&re().Ay.removeListener(ae,e)}(t);const o=t=>{let{value:r}=t;void 0!==n&&n!==r&&ie(e),n=r},i=m().nF(o,5e3);ae=re().Ay.addListener(r,void 0,i,void 0,t),se=r;const a=C().A.state;if(!Object.keys(a).length)return ie(e)}}async function ie(e){const{environment:t,spaceId:n}=e;if((0,Y().e9)(t,n))return;const r=await b().callApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},headers:(0,a().WS)({cellId:void 0,spaceId:n})});var o;"success"===r.type&&((null===(o=T().default.state.currentSpaceStore)||void 0===o?void 0:o.id)===n&&C().A.setState(r.data.bannerData));const i=await b().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var s;"success"===i.type&&((null===(s=T().default.state.currentSpaceStore)||void 0===s?void 0:s.id)===n&&B().A.setState(i.data))}let ae,se;var ce=()=>n(128265),de=n(474848);const le="SubscriptionData",ue=(0,p().YK)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},paymentMethodUpdateAuthFailed:{id:"subscriptionSettings.paymentMethodUpdateAuthFailedMessage",defaultMessage:"We could not update your payment method. Please try again or contact support."},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion's Education plan for free"},finishingUp:{id:"subscription.upgrade.finishing",defaultMessage:"Finishing up..."}});async function pe(e){const{from:t,environment:n,spaceStore:r,billingEmail:o,paymentData:i,vatId:a,coupon:c,customerName:l,businessName:p,addressLine1:m,addressLine2:g,addressZip:f,addressCity:I,addressState:x,addressCountry:w,promoCodeId:k,offerInfo:A,useTestClock:C,sessionId:T,inAppOffer:B,desiredState:P,trialData:M,postUpgradeCallback:D,performImmediately:_}=e;v().Re({bannerStore:E().A}),y().m({message:ue.updatingSubscription});const U=r.id,H=await(0,G().Vv)({environment:n,spaceId:U});if(!H)throw new Error("Billing data not loaded");const N=(0,s().PP)(H),{plan:F,addOns:L,isTrial:O}=function(e,t){if(!t)return{plan:void 0,addOns:[],isTrial:void 0};const n=e.items.filter((e=>"plan"!==(0,s().IE)(e))),r=t.items.find((e=>"plan"===(0,s().IE)(e))),o=t.items.filter((e=>"plan"!==(0,s().IE)(e)));return{isTrial:Boolean(t.trialEnd),plan:null==r?void 0:r.price.externalId,addOns:(0,d().HO)(n,o).map((e=>{let[t,n]=e;return{isCancellation:!n,priceId:(n??t).price.externalId,quantity:null==n?void 0:n.quantity}}))}}(N,P);let R;if(P&&0===P.items.length)R=await b().callApi({eventName:"cancelSubscription",environment:n,data:{spaceId:r.id,cancelImmediately:e.performImmediately}});else{const e=_?{prorationBehavior:"always_invoice",billingCycleAnchor:"now"}:void 0;R=await b().callApi({eventName:"updateSubscription",environment:n,data:{spaceId:U,plan:F,addOns:L,billingEmail:o,paymentMethodId:(0,q().optionalPaymentMethodIdGivenPaymentData)(i),vatId:a,coupon:c,customerName:l,businessName:p,addressLine1:m,addressLine2:g,addressZip:f,addressCity:I,addressState:x,addressCountry:w,promoCodeId:k,useTestClock:C,countryCode:undefined,modalSessionId:T,inAppOffer:B,offerInfo:A,isTrial:O,clientVersion:n.device.version,trialData:M,from:t,billingPolicyOverwrites:e}})}if("failed"===R.type)throw y().V(),h().Qg(R),new Error("An error occurred while updating subscription");Se({environment:n,spaceStore:r});const[$,V]=await Promise.all([(0,ce().G)(n),(0,G().Vv)({environment:n,spaceId:U})]);if(!V)throw y().V(),new Error("Billing data not loaded");if(ge({environment:n,context:{spaceId:U,planType:r.getPlanType(),from:t,isMmOrEnt:$,trialData:M,modalId:T},oldData:H,newData:V,desiredState:P}),y().V(),D)D();else if(Boolean(M)){if((0,s().TB)(H)&&!(0,s().TB)(V)){const e=(0,s().AW)(H);"upgrade"===(0,u().qR)({oldTier:e,newTier:(0,s().AI)(V)})&&me({oldTier:(0,s().AW)(H),newTier:(0,s().AI)(V),oldAddOns:(0,s().ji)(H),newAddOns:(0,s().ji)(V)})}}else me({oldTier:(0,s().AI)(H),newTier:(0,s().AI)(V),oldAddOns:(0,s().ji)(H),newAddOns:(0,s().ji)(V)});return W().A.state.open&&"requests"===W().A.state.currentTab&&S().Ow({currentTab:"billing"}),R.data}function me(e){return!!(0,V().Pe)()&&X().A.open(e)}function ge(e){var t;let{environment:n,context:r,oldData:o,newData:i,desiredState:a}=e;const d=(0,s().V9)(o),l=(0,s().AI)(o),u=(0,s().ji)(o),p=(0,s().q8)(o),m=(0,s().Ry)(o),g=o.email,b=(0,c().j1)(a),v=(0,c().Gf)(a),h=(0,c().V_)(a),y=(0,c().yw)(a),S=(0,c().j8)(a),I=Boolean(null==a?void 0:a.trialEnd),w=i.email,k=!(0,s().Fq)(o)&&(0,c().DS)(a),A=(0,s().Fq)(o)&&(0,c().DS)(a),C=(0,s().Fq)(o)&&!(0,c().DS)(a);k&&b?f().BK(n,{plan:b,credit_amount:0}):A?f().pT(n,{billing_email_changed:g!==w,plan_changed:b!==d,plan_current:b,plan_old:d,currency_code:S,billing_address_changed:!1}):C&&d&&f().pp(n,{plan:d}),f().xN(n,{from:r.from,action:C?"cancel":"update",spaceId:r.spaceId,isMmOrEnt:r.isMmOrEnt,planType:r.planType,addressCountry:null===(t=i.address)||void 0===t?void 0:t.country,oldSubscriptionTier:l,newSubscriptionTier:v,oldCurrency:m,newCurrency:S,oldPriceId:d,newPriceId:b,oldAddOns:u,newAddOns:h,oldBillingInterval:p,newBillingInterval:y,creditAmount:0,isProfessionalTeamUser:(0,x().YD)(),isTrial:I,trialEndDate:(0,s().i5)(o),trialData:r.trialData,modalId:r.modalId})}async function fe(e){const{environment:t,stripe:n,spaceStore:r,paymentMethodId:o}=e,i=await b().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"!==i.type){if(i.data.clientSecret&&"requires_action"===i.data.status){if("succeeded"!==await De({stripe:n,clientSecret:i.data.clientSecret}))return void h().f1(w().A.formatMessage(ue.paymentMethodUpdateAuthFailed));const e=await b().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"===e.type)return void h().Qg(e)}await Se({environment:t,spaceStore:r})}else h().Qg(i)}async function be(e){const{environment:t,spaceStore:n,invoiceId:r,paymentMethodId:o}=e,i=await b().callApi({eventName:"payInvoice",environment:t,data:{invoiceId:r,paymentMethodId:o}});"failed"!==i.type?await Se({environment:t,spaceStore:n}):h().Qg(i)}async function ve(e){const{environment:t,spaceStore:n,address:r}=e;v().Re({bannerStore:E().A}),y().m({message:ue.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await Se({environment:t,spaceStore:n}),y().V()}async function he(e){const{environment:t,spaceStore:n,vatId:r}=e;v().Re({bannerStore:E().A}),y().m({message:ue.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await Se({environment:t,spaceStore:n}),y().V()}async function ye(e){const{environment:t,spaceStore:n,email:r}=e;v().Re({bannerStore:E().A}),y().m({message:ue.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await Se({environment:t,spaceStore:n}),y().V()}async function Se(e){let{environment:t,spaceStore:n}=e;const r=n.id;ee().A.setState({...ee().A.state,status:"init"}),await Promise.all([j().$W({environment:t,spaceId:r}),xe(t,r),P().A.resetData(t,{spaceId:r}),L().t.resetData(t,{spaceId:r}),_().A.resetData(t,{spaceId:r}),Z().c.resetData(t,{spaceId:r}),M().L.resetData(t,{spaceId:r}),O().A.resetData(t,{spaceId:r}),N().A.resetData(t,{spaceId:r})])}async function Ie(e){let{environment:t,spaceStore:n}=e;const r=n.id;await Promise.all([xe(t,r),N().A.resetData(t,{spaceId:r})])}async function xe(e,t){var n;const o=t??(null===(n=T().default.state.currentSpaceStore)||void 0===n?void 0:n.id),s=e.currentUser.id;if(!o)throw new Error("No spaceId.");const c=`${le}:${o}:v2`,d=i().K.get({userId:s,key:c});d&&(te().subscriptionDataStoreInstance.setState(d),te().subscriptionDataStoreInstance.spaceId=o,$().k.setState(d.userSimilarity)),await U().transactionQueue.drain();const[l,u]=await Promise.all([b().callApi({eventName:"getSubscriptionData",environment:e,data:{spaceId:o},headers:(0,a().WS)({cellId:void 0,spaceId:o})}),b().callApi({eventName:"getVisibleUsers",environment:e,data:{spaceId:o,supportsEdgeCache:!0},headers:(0,a().WS)({spaceId:o})})]);if("success"===l.type&&"success"===u.type){var p;const t={...l.data,...u.data};D().A.setState({shouldUseEdgeCache:u.data.shouldUseEdgeCache});try{i().K.set({userId:s,key:c,value:t})}catch{r().log({level:"error",from:"subscriptionActions",type:"subscriptionDataTooLarge",data:{miscDataToConvertToString:{subscriptionDataJsonSize:JSON.stringify(t).length}}})}(null===(p=T().default.state.currentSpaceStore)||void 0===p?void 0:p.id)===o&&(te().subscriptionDataStoreInstance.setState(t),te().subscriptionDataStoreInstance.spaceId=o,$().k.setState(t.userSimilarity),Y().Fq(t)&&f().G3(e))}else r().log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataFailed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:l.type,getSubscriptionDataResponseStatus:l.status,getVisibleUserResponseType:u.type,getVisibleUserResponseStatus:u.status}}});D().A.state.shouldUseEdgeCache&&await R.resetData(e,{spaceId:o}),await Promise.all([I().aiDependency.load().then((t=>{let{completionActions:n}=t;return n.maybeUpdateAiEligibility(e,o,!0)}))])}const we=(0,m().sg)((async function(e){const{environment:t,spaceStore:r,code:o}=e;y().m({message:ue.verifyingEligibility});const i=te().subscriptionDataStoreInstance.state;if(!i)throw new Error("Subscription data not loaded.");const a=await b().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:o}});"failed"===a.type?h().Qg(a):a.data.isEligible?(await Se({environment:t,spaceStore:r}),Ae(i,t)):n(446242).A.setState({open:!0,handlePromoCode:async e=>{y().m({message:ue.updatingSubscription});const n=await b().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:e}});"failed"===n.type?h().Qg(n):n.data.isEligible?(await Se({environment:t,spaceStore:r}),Ae(i,t)):h().f1((0,de.jsx)(p().sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),y().V()}}),y().V()}),1e3,{leading:!0,trailing:!1});async function ke(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:r}=e,o=te().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||o&&o===n)await te().subscriptionDataStoreInstance.waitUntilLoaded();else{if(C().A.setState({}),oe({environment:t,spaceId:n}),B().A.setState({}),r){const e={type:"unsubscribed_admin",accountBalance:0,users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1};te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,$().k.setState(e.userSimilarity)}xe(t,n)}}async function Ae(e,t){const n=()=>{me({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||h().rG({message:w().A.formatMessage(ue.educationPlusFree)}),W().A.setState({...W().A.state,currentTab:"billing",defaultSubtab:void 0});const n=Y().RJ(e);f().tt(t,{plan:"student_free",old_plan:n?n.plan:void 0})};await A().shouldCreatePassword(t)?k().r({onSubmit:n,onCancel:n}):n()}function Ce(e,t){const{subscriptionTier:n,from:r,addOnFeature:i,coupon:a,isTrial:s,dismissMobilePlansModal:c,postUpgradeCallback:d,offer:l}=t,u=o().JW();f().ae(e,{subscriptionTier:n,from:r,addOnFeature:i,currency_code:ee().A.state.selectedCurrencyCode,isTrial:s,modal_id:u}),F().A.open({from:r,subscriptionTier:n,billingInterval:"month",addOnFeature:i,coupon:a,isTrial:s,sessionId:u,dismissMobilePlansModal:c,postUpgradeCallback:d,offer:l})}function Te(e){const t=F().A.state;t.open&&(f().OC(e,{modal_id:t.sessionId}),F().A.setState({open:!1}))}function Be(e){J().A.open(e)}async function Pe(e){var t;const{environment:n,product:o,spaceStore:i,from:a,pageSection:u,churnState:p,billingData:f}=e,b=await j().p_({environment:n,spaceId:i.id}),v=f.subscription;if(!(v&&(0,g().O9)(f.paymentMethod)||"free"===o))return void Ce(n,{subscriptionTier:o,from:a});const h=(0,s().lQ)(f),y=(0,s().Ry)(f),S=(0,c().yw)(h),I=(0,c().yw)(v),x=S??I,w=(null===(t=(0,s().KH)(f,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,k=(0,c().GB)({spaceId:i.id,logFunction:r().log.bind(r()),subscriptionState:h}),A=(0,c().GB)({spaceId:i.id,logFunction:r().log.bind(r()),subscriptionState:v}),C=k??A;let T;if("free"===o)T=(0,d().gL)(h,"plan");else{if(!(y&&x&&C))throw new Error("Trying to update plan on a subscription with no items");{const e=(0,V().Le)();T=(0,d().ef)({state:h,prices:b,quantities:{numSeats:C,numCustomHostnames:w},params:{currency:y,interval:x},products:[o],flags:{isMay13PackagingChangesEnabled:e}})}}if(!m().n4(h,T)){if((0,d().V5)(h,T)){if("no_churn"===p||!p)return;if((0,l().hZ)(H().A.getData(n,{spaceId:null==i?void 0:i.id}))&&(0,l().Jf)("resurrection_offer",K().AI(),I)){if(!(await(0,Q().Z)(n)))return}return await pe({environment:n,spaceStore:i,desiredState:T,from:a,performImmediately:"churn_immediately"===p})}(0,z().o)(n,{desiredProducts:[o],from:a,analyticsArgs:{from:a,pageSection:u}})}}async function Me(e){y().m({message:ue.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:r,onFailure:o}=e,i=t.paymentIntentClientSecret;let a=t.paymentIntentStatus;i&&"requires_action"===a&&(a=await De({stripe:n,clientSecret:i})),"succeeded"===a||"processing"===a?null==r||r():function(e){let{status:t}=e;return["requires_payment_method","requires_source"].includes(t)}({status:a})&&(null==o||o()),y().V()}async function De(e){let{stripe:t,clientSecret:n}=e;const{paymentIntent:r,setupIntent:o,error:i}=await t.handleNextAction({clientSecret:n});if(r)return r.status;if(o)return o.status;if(i.payment_intent)return i.payment_intent.status;if(i.setup_intent)return i.setup_intent.status;throw new Error(`Unexpected error handling intent: ${i.message}`)}async function _e(e){const{environment:t,data:n}=e;await b().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}},430395:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1,succeeded:!1}}close(){this.setState({open:!1,succeeded:!1})}closeWithSuccess(){this.setState({open:!1,succeeded:!0})}open(e){this.setState({open:!0,temporaryBillingInterval:"month",temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},appliedPromo:void 0,error:void 0,vatApplicable:!1,calculatingTax:!1,payButtonState:"disabled",subscriptionTier:"enterprise",targetPlan:void 0,targetSpace:e,totalUpgradeCost:void 0,onlyShowAddOn:!1,sessionId:n(206267).JW(),type:n(506090).p.TargetSpace,vatId:void 0})}setAddressField(e){this.state.open&&this.setState({...this.state,temporaryAddress:{...this.state.temporaryAddress,...e},taxCalculationError:void 0})}}const o=new r},446242:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new r},503416:(e,t,n)=>{n.d(t,{r:()=>r});const r=(0,n(340498).xh)("arrowInCircleDown",{default:{loader:()=>n.e(96029).then(n.bind(n,973238))},small:{loader:()=>n.e(96029).then(n.bind(n,747012))},fill:{loader:()=>n.e(96029).then(n.bind(n,561604))},fillSmall:{loader:()=>n.e(96029).then(n.bind(n,613131))}},["arrow","circle","down","direction","pointer","downgrade"])},762299:(e,t,n)=>{n.d(t,{A:()=>o});const r=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,449506)),i=await o.callApi({eventName:"getInvoiceData",environment:e,data:{spaceId:r,type:"upcoming"}});return"success"===i.type?i.data.invoiceData:void 0}));n(604341).exposeDebugValue("UpcomingInvoiceStore",r);const o=r},805061:(e,t,n)=>{n.d(t,{c:()=>r});const r=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:r}=t;const o=await Promise.resolve().then(n.bind(n,449506)),i=await o.callApi({eventName:"getLegacyPriceInfo",environment:e,data:{spaceId:r},headers:(0,n(386164).WS)({cellId:void 0,spaceId:r})});if("success"===i.type)return i.data}))},814431:(e,t,n)=>{n.d(t,{L:()=>r});const r=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{var r;let{spaceId:o}=t;const i=await Promise.resolve().then(n.bind(n,449506)),a=await i.callApi({eventName:"getBillingHistory",environment:e,data:{spaceId:o,limit:20}});return"success"===a.type?null===(r=a.data)||void 0===r?void 0:r.events:void 0}));n(604341).exposeDebugValue("BillingHistoryStore",r)},995604:(e,t,n)=>{n.d(t,{Z:()=>b});n(296540);var r=()=>n(449506),o=()=>n(2220),i=()=>n(82275),a=()=>n(49210),s=()=>n(765957),c=()=>n(503416),d=()=>n(959013),l=()=>n(7674),u=()=>n(719147),p=()=>n(836251),m=n(474848);function g(e){let{onAccept:t}=e;return(0,m.jsx)(l().tf,{header:(0,m.jsx)(l().YA,{iconAndTitle:(0,m.jsx)(l().ZQ,{iconGroup:c().r,iconColorName:"uiRedPrimary",title:(0,m.jsx)(d().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,m.jsx)(d().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,m.jsx)(u().A,{external:!0,href:(0,p().xS)("resurrectionLearnMore"),children:e})}})}),footer:(0,m.jsx)(l().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:t}],secondaryButtons:[{buttonType:"dismiss",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const f=406;async function b(e){var t;const n=null===(t=s().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return await a().T.showAsyncModal((t=>(0,m.jsx)(i().s,{isOpen:t.isOpen,onDismiss:()=>{(0,o().u)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:f},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,m.jsx)(g,{onAccept:async()=>{(0,o().u)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await r().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}}}]);