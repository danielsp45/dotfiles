"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2411,5834,34208,59388,90871,93568],{53592:(e,t,r)=>{r.r(t),r.d(t,{attemptServerBackedLocalDuplicate:()=>C,serverBackedLocalDuplicate:()=>I});r(944114),r(581454);var o=()=>r(857639),a=()=>r(386164),n=()=>r(388821),i=()=>r(912720),c=()=>r(199378),l=()=>r(502800),s=()=>r(763824),d=()=>r(466614),p=()=>r(449506),u=()=>r(666144),m=()=>r(751156),g=()=>r(974233),v=()=>r(611191),y=()=>r(603815),h=()=>r(261450),_=()=>r(503388),S=()=>r(966152),f=()=>r(59110),b=()=>r(605605),k=()=>r(677733);function I(e){const{environment:t,sourceBlock:r,targetInMemoryRecordCache:o,transaction:a,options:i,targetSpaceId:c,installationImprint:l,templateInstallationMetadata:d={},shouldUseSynchronousDuplicationAPI:p,stopwatch:u}=e,m=performance.now();null==u||u.mark("server_duplicate_start");const g=e.copyIndicators??(0,_().U8)({environment:t,sourceBlocks:[r],targetRecordCache:o,transaction:a,spaceId:c});null==u||u.mark("create_copy_indicators");const v=s().yX();return a.postSubmitCallbacks.push((async e=>{if(null==u||u.mark("transaction_post_submit_callback"),e)return(0,S().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:g.map((e=>e.id)),error:e,targetSpaceId:c,options:i}}),void(0,_().Jc)(e,v);(0,_().Yj)(g),null==u||u.mark("initialize_copy_indicators_progress_state");const{success:o,size:s}=await C({environment:t,sourceBlockPointer:r,targetBlockStore:g[0],options:i,templateInstallationMetadata:d,stopwatch:u});if(o)return(0,h().E)({environment:t,success:!0,time:performance.now()-m,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:s,method:"server_backed_local_duplication"}),null==u||u.mark("server_backed_local_duplicate_success"),(0,_().dH)(g),void v.resolve({status:"success"});const y=await(0,k().performServerDuplicate)({environment:t,copyIndicators:g,sourceBlocks:[r],targetSpaceId:c,options:i,templateInstallationMetadata:d,installationImprint:l,shouldUseSynchronousDuplicationAPI:p,stopwatch:u});if((0,_().dH)(g),!y.success)return(0,_().uC)({environment:t,copyIndicators:g}),(0,S().P0)({environment:t,type:"server_duplicate_iterator_error",data:{errorMessage:y.errorMessage}}),void v.resolve({status:"error",errorMessage:y.errorMessage,error:y.error});(0,h().E)({environment:t,success:!0,time:performance.now()-m,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:y.size,method:"sbld_fallback_server_duplication"}),null==u||u.mark("server_duplicate_success"),v.resolve({status:"success",recordIdMap:y.recordIdMapJson?n().RecordMapPolymorphic.create(y.recordIdMapJson):void 0})})),{blockStores:g,onComplete:v.promise}}async function C(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:s,options:h,templateInstallationMetadata:_,recordLimit:k=500,targetInMemoryRecordCache:I,stopwatch:C}=e;null==C||C.mark("attempt_server_backed_local_duplicate_start"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate",data:{sourceBlockPointer:r,targetBlockStore:s,targetSpaceId:s.getSpaceId(),options:h}});const M=(0,v().$J)(),w=await async function(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:i,targetInMemoryRecordCache:c,options:s,enableLegacyTransclusionFixing:d,recordLimit:m}=e,v=c??i.inMemoryRecordCache,h={blockId:r.id,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!s.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!s.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:d,inMemoryRecordCache:v};let _;if(_=(0,f().loadLocalSubtree)(t,h),!_.recordMap&&v===t.defaultRecordCache.inMemoryRecordCache)try{(0,S().JW)({environment:t,type:"performInexactPagePreload",data:{message:"No local subtree found, performing performInexactPagePreload",loadLocalSubtreeArgs:h}}),await(0,y().A$)(t,{table:"block",id:r.id,spaceId:r.spaceId}),_=(0,f().loadLocalSubtree)(t,h)}catch(b){o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"persistedRecordCachePreloadError",error:(0,l().convertErrorToLog)(b),data:{message:"Failed to preload subtree from persisted record cache"}})}_.recordMap||((0,S().JW)({environment:t,type:"loadLocalSubtreeApi",data:{message:"No local subtree found from previous attempts, attemping API call to loadBlockSubtree",currentLocalSubtreeResponse:_}}),_=await async function(e){const{environment:t,sourceBlockPointer:r,recordLimit:i,targetBlockStore:c,loadLocalSubtreeArgs:s}=e;try{const e=await p().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:i},headers:(0,a().WS)({spaceId:r.spaceId})});if((0,S().JW)({environment:t,type:"loadBlockSubtreeApiResult",data:{message:"Result from loadBlockSubtree API call",subtreeResult:e,apiArgs:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:i}}}),"success"===e.type){const r=n().RecordMapWithRole.create(e.data.subtreeRecordMap);return await u()._O({environment:t,inMemoryRecordCache:s.inMemoryRecordCache,recordMap:r,debugSource:"load_local_subtree_from_server"}),(0,f().loadLocalSubtree)(t,s)}{const t=(0,g().V)(e);o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"loadBlockSubtreeFailure",data:{message:"Error fetching subtree",miscDataToConvertToString:{error:t,sourceBlockPointer:r,cacheSize:c.inMemoryRecordCache.size,targetBlockPointer:{id:c.id,spaceId:c.getSpaceId(),type:c.getType()}}}})}}catch(b){o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,l().convertErrorToLog)(b),data:{message:"Error loading subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:c.inMemoryRecordCache.size,targetBlockPointer:{id:c.id,spaceId:c.getSpaceId(),type:c.getType()}}}})}}({environment:t,sourceBlockPointer:r,recordLimit:m,targetBlockStore:i,loadLocalSubtreeArgs:h}));_&&!_.recordMap&&o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadFailure",data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:i.inMemoryRecordCache.size,reason:"error"===_.type?_.reason:void 0,targetBlockPointer:{id:i.id,spaceId:i.getSpaceId(),type:i.getType()},missingRecord:"error"===_.type?_.pointer:void 0}}});return _}({environment:t,sourceBlockPointer:r,targetBlockStore:s,targetInMemoryRecordCache:I,options:h,enableLegacyTransclusionFixing:M,recordLimit:k});if(null==C||C.mark("try_load_local_subtree_finished"),!w||!w.recordMap)return{success:!1,size:void 0,pageStore:s};var B;if(d().Lw({sourceSpaceId:r.spaceId,targetSpaceId:s.getSpaceId(),sourceBlockSubtree:w.recordMap}))return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"accessLockingWarning",data:{message:"Unable to perform local duplication",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}}),null==C||C.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(B=w.recordMap)||void 0===B?void 0:B.getSize(),pageStore:s};for(const a of w.recordMap.getTables()){var x;if(a===i().yB||a===c().SC)return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"invalidRecordType",data:{message:"Local duplication does not support automation tables",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}}),null==C||C.mark("attempt_server_backed_local_duplicate_failure"),{success:!1,size:null===(x=w.recordMap)||void 0===x?void 0:x.getSize(),pageStore:s}}try{var A;(0,S().JW)({environment:t,type:"server_backed_duplicate_start_transaction",data:{message:"Starting transactionActions.createAndCommit for localDuplicate",sourceBlockPointer:r,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}});const{serverCommitResult:e}=m().createAndCommit({userAction:"server_backed_local_duplicate",environment:t,canUndo:!0,isTemplateInstantiationTransaction:Boolean(_),perform:e=>(0,b().localDuplicate)({environment:t,sourceBlockId:r.id,targetBlockPointer:s.pointer,sourceBlockSubtree:w.recordMap,targetInMemoryRecordCache:s.inMemoryRecordCache,transaction:e,templateInstallationMetadata:_,stopwatch:C,options:{...h,preventLegacyTransclusions:M}})});return await e,null==C||C.mark("server_backed_local_duplicate_finished"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate_success",data:{targetSpaceId:s.getSpaceId(),options:h}}),{success:!0,size:null===(A=w.recordMap)||void 0===A?void 0:A.getSize(),pageStore:s,transactionPromise:e}}catch(R){var P;return o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,l().convertErrorToLog)(R),data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}}),{success:!1,size:null===(P=w.recordMap)||void 0===P?void 0:P.getSize(),pageStore:s}}}},152236:(e,t,r)=>{r.d(t,{M:()=>p,h:()=>u});r(16280),r(898992),r(354520);var o=()=>r(700500),a=()=>r(363497),n=()=>r(179034),i=()=>r(869558),c=()=>r(750660),l=()=>r(246826),s=()=>r(568131),d=()=>r(765957);function p(e){const{environment:t,collectionViewStore:r,parentCollectionViewBlockStore:c,transaction:s,filter:p,inMemoryRecordCache:u,sort:m,semanticQuery:g,assistantChatSessionId:v}=e,y=d().default.state.currentSpaceStore,h=d().default.state.currentSpaceViewStore;if(!y||!h)throw new Error("No current space or space view.");const _=t.currentUser.id;if(!_)throw new Error("User is not logged in.");const S=l().Wv({environment:t,type:o().xd.collectionViewPage,inMemoryRecordCache:y.inMemoryRecordCache,transaction:s,spaceId:y.id,permissions:[{type:"user_permission",user_id:_,role:"editor"}]}),f={type:"table",parent_id:S.id,parent_table:n().ev,alive:!0,space_id:y.id,format:{table_properties:r.getFormat().table_properties,timeline_arrows_by:void 0,subitem_display_mode:"hidden",table_subitem_toggle_column:"title",is_unlisted:!0,collection_pointer:r.getFormat().collection_pointer??c.getCollectionPointer(),...g?{is_unlisted_from_semantic_query:{is_from_semantic_query:!0,query:g}}:{is_unlisted_from_semantic_query:{is_from_semantic_query:!1}}},query2:{filter:p,sort:m}},b=l().eC({environment:t,table:i().Gy,value:f,inMemoryRecordCache:u,transaction:s});return l().zv({store:S,data:{parent_id:v,parent_table:a().TF,alive:!0,view_ids:[b.id]},transaction:s}),{collectionViewStore:b,linkedDatabaseCollectionBlockStore:S}}async function u(e){const{environment:t,transaction:r,acceptMoveToArgs:o,linkedDatabaseBlockStore:a}=e,{blockStores:[n]}=s().duplicateBlock({environment:t,stores:[a],transaction:r,targetSpaceId:a.getSpaceId(),preferDuplicateLocation:"local",options:{resolveTemplateVariables:!1,addCopyName:!1,allowRedundancy:!0,deepCopyTransclusionContainers:!0}});l().zv({store:n,data:{alive:!0},transaction:r});for(const i of n.getCollectionViewStores())l().zv({store:i.getFormatStore(),data:{is_unlisted:null,is_unlisted_from_semantic_query:null},transaction:r});return await c().Ju({...o,targetBlocks:[n],transaction:r}),n}},274375:(e,t,r)=>{r.d(t,{Q:()=>a});r(898992),r(354520),r(672577);var o=()=>r(970013);function a(e,t){const r={property:o().rn,visible:!0,width:276},a={property:t,visible:!0},n=[r,a],i=e.getCollectionViewStores().find((e=>"table"===e.getType())),c=null==i?void 0:i.getFormatStore().getKeyStore("table_properties").getValue();if(!i||!c||0===c.length)return n;const l=c.find((e=>e.property===o().rn))??r;return[l,c.find((e=>e.property===t))??a,...c.filter((e=>e.property!==o().rn&&e.property!==t))]}},374136:(e,t,r)=>{r.d(t,{_G:()=>N,$k:()=>P,w$:()=>U,H$:()=>z,l9:()=>O,NH:()=>V,jY:()=>D,JI:()=>j,ck:()=>L,i5:()=>F,EN:()=>q,gc:()=>R,wK:()=>T});var o=()=>r(244641),a=r(296540),n=()=>r(401497),i=()=>r(764880),c=()=>r(100594),l=()=>r(901610),s=()=>r(921598),d=()=>r(713998),p=()=>r(825237),u=()=>r(792071),m=r(474848);const g=a.memo((function(e){const{size:t,style:r,icon:o,baseUrl:a,getRecordModel:n}=e;return(0,m.jsx)("div",{style:{height:t,width:t,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,verticalAlign:"top",marginTop:1,...r},children:(0,m.jsx)(h,{icon:o,size:t,baseUrl:a,getRecordModel:n})})}));function v(e){return.9*e}function y(e){return.888*e}function h(e){let{icon:t,size:o,baseUrl:a,getRecordModel:n}=e;if(!t)return null;const i=(e,t)=>{const r=p().wY({url:e,baseUrl:a,fullyQualified:!0,permissionRecord:t,width:y(o),userId:void 0});return(0,m.jsx)("img",{alt:"icon",src:r,style:{width:y(o),height:y(o),objectFit:"cover",borderRadius:4,marginTop:1}})},c=(0,r(651124).WO)(t.icon);switch(c.type){case"unicode_emoji":return(0,m.jsx)("div",{style:{fontSize:v(o)},children:c.emoji.unicode});case"custom_emoji":const e=u().xm7.resolveCustomEmojiIcon(t,n);return e?i(e.icon,e.pointer):null;case"app_package_asset":case"notion_icon":case"url":return i(t.icon,t.pointer);default:(0,r(534177).HB)(c)}}var _=()=>r(216519);const S=function(e){const{botValue:t,avatarSize:o,baseUrl:a,theme:n,style:i}=e;if(null!=t&&t.icon){const c=r(522419).GM(t.icon)?p().x8({url:t.icon,width:e.avatarSize,fullyQualified:!0,stripGoogleIconQuery:!0,baseUrl:a,userId:void 0}):t.icon;return(0,m.jsx)("div",{style:{...(0,_().fo)({theme:n,avatarSize:o}),...i},children:(0,m.jsx)("img",{src:c,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})})}if(null!=t&&t.name){const e=t.name[0];return(0,m.jsx)("div",{children:(0,m.jsx)("div",{style:{...(0,_().ws)({theme:n,avatarSize:o}),...i},children:(0,m.jsx)("div",{children:e})})})}return(0,m.jsx)("span",{children:"ðŸ¤–"})};var f=()=>r(597777),b=()=>r(869190),k=()=>r(72135),I=()=>r(379632),C=()=>r(437607),M=()=>r(381349),w=()=>r(284371),B=()=>r(780054),x=()=>r(10594),A=()=>r(698449);const P=(0,r(959013).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"chartLabelFormatHelpers.untitledBlock"}});function R(e,t,r){const o=(0,n().IS)((e=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},initialStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor},avatarStyle:{background:"none"},botStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor,fontSize:r?8:10},avatarWrapper:{flexShrink:0},nameWrapper:{minWidth:0,...w().RC}})),[r]);return(0,a.useCallback)(((a,n)=>{var c,l,s;if(!n)return a.toString();let d,p,g;if(n.actorPointer&&e)if(n.actorPointer.table===C().n){var v;p=e(n.actorPointer),g=(0,A().Pf)({intl:t,groupName:null===(v=p)||void 0===v?void 0:v.name})}else{var y;const r=(0,i().xC)({pointer:n.actorPointer,getRecordModel:e});p=null==r?void 0:r.asActor,g=null===(y=p)||void 0===y?void 0:y.getDisplayName(t)}return g||(g=a||t.formatMessage(u().Fvx.messages.anonymousPlaceholder)),d="space_permission_group"===(null===(c=p)||void 0===c?void 0:c.table)?(0,m.jsx)(_().Ay,{userValue:{name:"?"},avatarSize:r?16:20,baseUrl:B().A.domainBaseUrl,theme:(0,M().x0)(),fontSize:r?8:10,initialStyle:o.initialStyle,avatarStyle:o.avatarStyle}):null!==(l=p)&&void 0!==l&&l.isUser()?(0,m.jsx)(_().Ay,{userValue:p,avatarSize:r?16:20,baseUrl:B().A.domainBaseUrl,theme:(0,M().x0)(),fontSize:r?8:10,initialStyle:o.initialStyle,avatarStyle:o.avatarStyle}):null!==(s=p)&&void 0!==s&&s.isBot()?(0,m.jsx)(S,{botValue:p,avatarSize:r?16:20,baseUrl:B().A.domainBaseUrl,theme:(0,M().x0)(),style:o.botStyle}):(0,m.jsx)(_().Ay,{userValue:{name:"?"},avatarSize:r?16:20,baseUrl:B().A.domainBaseUrl,theme:(0,M().x0)(),fontSize:r?8:10,initialStyle:o.initialStyle,avatarStyle:o.avatarStyle}),I().A.renderToStaticMarkup((0,m.jsxs)("div",{style:o.wrapper,children:[(0,m.jsx)("div",{style:o.avatarWrapper,children:d}),r?(0,m.jsx)("div",{style:o.nameWrapper,children:g}):null]}))}),[e,t,r,o])}function T(e,t,r){const o=(0,n().IS)((()=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},avatarWrapper:{flexShrink:0},titleWrapper:{minWidth:0,...w().RC}})),[]),i=t.formatMessage(P.titlePlaceholder);return(0,a.useCallback)(((a,n)=>{if(!n||!e)return a.toString()||i;let c;if(n.pagePointer&&e&&(c=e(n.pagePointer)),!c)return a.toString()||i;const l=c.getRenderTitleWithPlaceholder({getRecordModel:e,userTimeZone:r,intl:t,isWorkflowsContainerWithCreationEnabled:!1}),s=c.getRenderIcon({getRecordModel:e});return I().A.renderToStaticMarkup((0,m.jsxs)("div",{style:o.wrapper,children:[s&&(0,m.jsx)("div",{style:o.avatarWrapper,children:(0,m.jsx)(g,{getRecordModel:e,icon:s,size:16,baseUrl:B().A.domainBaseUrl})}),(0,m.jsx)("div",{style:o.titleWrapper,children:l})]}))}),[e,r,t,i,o.wrapper,o.avatarWrapper,o.titleWrapper])}function L(e){var t,r,o,a;const n="count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator)?"number":j(e.propertySchema);let i;return i="count"===(null===(o=e.aggregation)||void 0===o?void 0:o.aggregator)||"unique"===(null===(a=e.aggregation)||void 0===a?void 0:a.aggregator)?"precision_0":"precision_from_number_property"===e.numberPrecisionOverride?F(e.propertySchema):e.numberPrecisionOverride,t=>"string"==typeof t?t:i&&"precision_uncapped"!==i?(0,k().ZV)(t,n,e.intl,"compact",i):(0,k().ZV)(q(t,2),n,e.intl,"compact",void 0)}function D(e){let{groupBy:t,dateFormat:r,intl:o}=e;return(e,a)=>{let n;return n=a?a.name:"string"==typeof e?e:e.toString(),z({dateString:n,dateFormat:r,groupBy:t,intl:o})}}function z(e){let{dateString:t,dateFormat:r,groupBy:a,intl:n}=e;const i=parseInt(t,10);if(isNaN(i))return t;switch(a){case"relative":default:return t;case"day":return(0,b().ZF)({value:{type:"date",start_date:o().c9.fromMillis(i).toISODate()},date_format:r||f().vz,allowRelativeDates:!0,intl:n});case"week":case"month":case"year":const e=o().c9.fromMillis(i),c={type:a,range:{type:"daterange",start_date:e.toISODate(),end_date:e.plus({[`${a}s`]:1}).minus({days:1}).toISODate()}};return(0,x().nc)({value:c,intl:n})}}function j(e){let t;return("number"===e.type||"formula"===e.type)&&(t=e.number_format),t}function F(e){return"number"===e.type||"formula"===e.type?e.number_precision:void 0}function V(e){let{chartConfig:t,schema:r,highChartsLabel:o,highChartsValue:a,isMultiSeries:n,intl:i,numberPrecisionOverride:s}=e,p=o,u=a;if(!t)return{label:p,value:u};const m=t.dataConfig;let g,v,y,h;if(n){if((0,l().m)(t)&&"groups_reducer"===t.dataConfig.type){var _;const e=t.dataConfig;if(g=null===(_=e.aggregationConfig.stackOptions)||void 0===_?void 0:_.groupBy,g){const e=(0,d()._g)({schema:r,property:g.property});e&&(0,c().zn)(e)&&(v=e)}h=e.aggregationConfig.aggregation,"count"!==h.aggregator&&(y=(0,d()._g)({schema:r,property:h.property}))}}else"groups_reducer"===m.type?(g=m.groupBy,v=(0,d()._g)({schema:r,property:m.groupBy.property}),h=m.aggregationConfig.aggregation,"count"!==h.aggregator&&(y=(0,d()._g)({schema:r,property:h.property}))):y=(0,d()._g)({schema:r,property:m.valueProperty});if(p=v?U({propertySchema:v,groupByFormat:g,aggregation:void 0,highChartsLabel:o,intl:i}):p,u&&"number"==typeof u&&y&&(0,c().JW)(y)){var S,f,b,I;const e="count"===(null===(S=h)||void 0===S?void 0:S.aggregator)||"unique"===(null===(f=h)||void 0===f?void 0:f.aggregator)?"number":j(y),t="count"===(null===(b=h)||void 0===b?void 0:b.aggregator)||"unique"===(null===(I=h)||void 0===I?void 0:I.aggregator)?"precision_0":s??F(y);u=t&&"precision_uncapped"!==t?(0,k().ZV)(u,e,i,"compact",t):(0,k().ZV)(q(u,2),e,i,"compact")}return{label:p,value:u}}function U(e){const{propertySchema:t,groupByFormat:r,aggregation:o,highChartsLabel:a,intl:n}=e;if(t&&(0,c().JW)(t)){const e="count"===(null==o?void 0:o.aggregator)||"unique"===(null==o?void 0:o.aggregator)?"number":j(t),r=parseInt(a,10);return isNaN(r)||"percent"===e?a:(0,k().ZV)(r,e,n,"compact")}const i="formula"===(null==r?void 0:r.type)?r.groupBy:r;return t&&(0,c().i8)(t)&&i&&(0,s().Ik)(i)?z({dateString:a,dateFormat:t.date_format,groupBy:i.groupBy,intl:n}):a}const W=1.2,E=2;function N(e){var t,r,o,a;if("count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator))return!1;return"percent"===j(e.propertySchema)||(void 0!==e.userYAxisMax&&void 0!==e.userYAxisMin&&Math.abs(e.userYAxisMax-e.userYAxisMin)<E||(!!(null!==(o=e.userYAxisMax)&&void 0!==o&&o.toString().includes(".")||null!==(a=e.userYAxisMin)&&void 0!==a&&a.toString().includes("."))||Math.abs(e.dataYAxisMax)<W&&Math.abs(e.dataYAxisMin)<W))}function O(e){return e%1==0?e:e.toFixed(1)}function q(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}},384856:(e,t,r)=>{r.d(t,{B:()=>m,G:()=>u});var o=()=>r(584262),a=()=>r(650829),n=()=>r(152236),i=()=>r(681445),c=()=>r(492414),l=()=>r(732038),s=()=>r(750660),d=()=>r(435009),p=()=>r(751156);function u(e){const{collectionContextStore:t,environment:r,originRect:a,isChartDrilldown:i,intl:c}=e,d=null==t?void 0:t.collectionViewBlockStore(),u=null==t?void 0:t.collectionViewStore();d&&u&&s().ho({environment:r,blocks:[d],originRect:a,moveToContext:"ai_ephemeral_view",isAddTo:!0,isDefaultPrivateLocation:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:async e=>{const{performResult:a}=await p().createAndCommitAsync({environment:r,userAction:"UnlistedCollectionViewMoreButton.handleAddViewToMenuClick",waitForServerCommit:!0,perform:o=>i?l().Iz({environment:r,collectionViewStore:u,collectionViewBlockStore:d,collectionContextStore:t,acceptMoveToArgs:e,transaction:o,intl:c}):(0,n().h)({environment:r,transaction:o,linkedDatabaseBlockStore:d,acceptMoveToArgs:e})});await m({environment:r,blockStore:a,pageVisitSource:i?o().y8.ChartsDrilldown:o().y8.AIEphemeralView})}})}async function m(e){const{environment:t,blockStore:r,pageVisitSource:o}=e;if(!r)return;const n=(0,c().Ay)({store:r,pageVisitSource:o});d().oo({environment:t,url:n});const{assistantMenuActions:l}=await a().assistantDependency.load();i().S.close(),await l.closeAssistantRightHandSideMenu({environment:t})}},568131:(e,t,r)=>{r.r(t),r.d(t,{duplicateBlock:()=>C});r(16280),r(898992),r(823215),r(581454),r(737550);var o=()=>r(179034),a=()=>r(665344),n=()=>r(854150),i=()=>r(466614),c=()=>r(970330),l=()=>r(901389),s=()=>r(863168),d=()=>r(594794),p=()=>r(611191),u=()=>r(972435),m=()=>r(494043),g=()=>r(406792);class v{constructor(e){this.environment=void 0,this.metricName=void 0,this.startMetric=void 0,this.prevLapMetric=void 0,this.extraData=void 0,this.environment=e.environment,this.metricName=e.metricName,this.startMetric=g().default.mark(e.metricName),this.prevLapMetric=g().default.mark(e.metricName),this.extraData=e.extraData??{}}mark(e){g().default.measure(this.prevLapMetric,{environment:this.environment,data:{type:e,...this.extraData},sampleDecision:"default"}),this.prevLapMetric=g().default.mark(this.metricName)}end(){g().default.measure(this.startMetric,{environment:this.environment,data:{type:"total",...this.extraData},sampleDecision:"default"})}}var y=()=>r(765957),h=()=>r(227440),_=()=>r(630116),S=()=>r(261450),f=()=>r(59110),b=()=>r(605605),k=()=>r(53592),I=()=>r(677733);function C(e){const{environment:t,stores:r,transaction:g,targetSpaceId:C,preferDuplicateLocation:M,analyticsFrom:w,options:B,installationImprint:x,shouldAttemptServerBackedLocalDuplication:A,templateInstallationMetadata:P,shouldUseSynchronousDuplicationAPI:R}=e,T=new v({environment:t,metricName:"duplicate_block_stopwatch",extraData:{duplication_type:"local"===M?"local_duplication":A?"server_backed_local_duplication":R?"server_synchronous_duplication":"server_duplication",from:w}});if(0===r.length)throw new Error("Must duplicate at least one block");const L=r[0].getSpaceId();if(!r.every((e=>e.getSpaceId()===L)))throw new Error("All stores must be in the same space");if(r.length>1&&!r.every((e=>e.isTypedCollectionViewBlock())))throw new Error("Multiple source blocks only supported for grouped typed DB duplication");!function(e){const{environment:t,stores:r,analyticsFrom:o}=e;for(const i of r){var a;const e=i.getRecordStoreAtRootPath().getValue();if(!e)continue;const{currentSpaceStore:r}=y().default.getState();let l;r&&e.parent_table===n().yK&&(l=_().h4.createChildStore(r,{table:n().yK,id:e.parent_id})),c().v(t,{from:o??"copy",type:e.type,teamStore:l,is_toggleable:(0,m().Yt)(e.type,e.format),collection_id:i.getAssociatedCollectionId()??(null===(a=i.getCollectionStore())||void 0===a?void 0:a.id),new_page_id:"page"===e.type?i.id:void 0,creating_block_id:i.id,parent_collection_id:i.getParentCollectionIdUpToTwoLevels(),form_id:i.getFirstFormIdInCollectionViewBlock()})}}({environment:t,stores:r,analyticsFrom:w}),T.mark("track_create_blocks"),B.convertExternalObjectInstancesToPlaceholders=L!==C;const D=P&&(0,a().Fe)(P.source)&&P.isListedTemplate;if("local"===M&&1===r.length&&!D){const e=function(e){const{environment:t,store:r,sourceSpaceId:a,targetSpaceId:n,transaction:c,options:l,installationImprint:u,templateInstallationMetadata:m,stopwatch:g}=e,v=(0,p().$J)(),y=(0,f().loadLocalSubtree)(t,{blockId:r.id,inMemoryRecordCache:r.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!l.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!l.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:v}).recordMap;if(null==g||g.mark("load_local_subtree"),!y||i().Lw({sourceSpaceId:a,targetSpaceId:n,sourceBlockSubtree:y}))return;const{targetBlockStore:h}=(0,b().localDuplicate)({environment:t,sourceBlockId:r.id,targetBlockPointer:(0,d().zP)({environment:t,table:o().ev,spaceId:n}),sourceBlockSubtree:y,targetInMemoryRecordCache:r.inMemoryRecordCache,options:{...l,preventLegacyTransclusions:v},transaction:c,installationImprint:u,templateInstallationMetadata:m,stopwatch:g});"ai_block"===h.getType()&&s().EF.setState(h.pointer.id);return{blockStores:[h],onComplete:Promise.resolve({status:"success"})}}({environment:t,store:r[0],options:B,sourceSpaceId:L,targetSpaceId:C,transaction:g,installationImprint:x,templateInstallationMetadata:P,stopwatch:T});if(e)return T.mark("try_local_duplication_success"),T.end(),e;T.mark("try_local_duplication_failure")}const z=t.defaultRecordCache.inMemoryRecordCache;if(r.some((e=>e.inMemoryRecordCache!==z)))throw new Error("Can only server duplicate from the environment.defaultRecordCache.inMemoryRecordCache.");let j;return h().A.state.online||l().f1(u().A.formatMessage(S().V.offlineError)),j=1===r.length&&A?(0,k().serverBackedLocalDuplicate)({environment:t,sourceBlock:{id:r[0].id,spaceId:r[0].getSpaceId()},targetInMemoryRecordCache:z,transaction:g,targetSpaceId:C,installationImprint:x,templateInstallationMetadata:P,stopwatch:T,shouldUseSynchronousDuplicationAPI:R,options:B}):(0,I().serverDuplicate)({environment:t,sourceBlocks:r.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),targetInMemoryRecordCache:z,transaction:g,targetSpaceId:C,installationImprint:x,templateInstallationMetadata:P,stopwatch:T,shouldUseSynchronousDuplicationAPI:R,options:B}),async function(){const{blockStores:e,onComplete:t}=j;if("success"===(await t).status)for(const r of e)if("ai_block"===r.getType())return void s().EF.setState(r.pointer.id)}(),T.mark("duplicate_block_immediate_return"),j.onComplete.then((e=>{T.end()})),j}},735790:(e,t,r)=>{r.d(t,{M:()=>n});r(296540);var o=r(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.25 15.25 11.5",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,o.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},n=(0,r(340498).wt)("sliders",a)}}]);