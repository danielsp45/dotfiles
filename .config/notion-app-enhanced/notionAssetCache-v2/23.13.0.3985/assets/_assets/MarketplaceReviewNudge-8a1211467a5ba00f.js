"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2501],{11385:(e,t,n)=>{n.r(t),n.d(t,{MarketplaceReviewNudge:()=>p});var i=n(296540),r=()=>n(401497),a=()=>n(959013),o=()=>n(812182),s=()=>n(755199),c=()=>n(2220),l=()=>n(554509),d=()=>n(217429),u=()=>n(332661),g=n(474848);const v="marketplace_review_modal_toast";function m(e){let{acquisitionId:t,listingId:r}=e;const l=(0,a().tz)(),u=(0,n(484714).v3)(),[m,p]=(0,i.useState)(!1),{onRatingConfirmed:h,onSubmit:f,error:_,isLoading:C}=(0,n(36338)._)({acquisitionId:t,source:"nudge"});return(0,i.useEffect)((()=>{(0,c().u)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"show"}}}),d().default.logEvent("marketplace_review_nudge","show")}),[u]),(0,i.useEffect)((()=>{m||o().Iz({id:v,presentationType:"persistent",title:l.formatMessage({id:"marketplace.reviews.nudge.title",defaultMessage:"Enjoying this template?"}),message:(0,g.jsx)(w,{onRatingConfirmed:h,error:_}),onUserDismiss:()=>{s().Tu(u,{listingId:r}),(0,c().u)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"dismiss"}}}),d().default.logEvent("marketplace_review_nudge","dismiss")},actions:{primary:{title:l.formatMessage({id:"marketplace.reviews.nudge.submit",defaultMessage:"Submit"}),onAction:async()=>{try{await f(),p(!0),s().Tu(u,{listingId:r}),o().UW(v),n(743071).A.openModal({stage:"details",acquisitionId:t,source:"nudge"}),(0,c().u)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"rate"}}}),d().default.logEvent("marketplace_review_nudge","rate")}catch(e){}},isLoading:C,disabled:Boolean(_)}}})}),[l,u,t,r,_,C,f,h,m]),null}const p=(0,i.memo)(m);function w(e){let{onRatingConfirmed:t,error:n}=e;const i=(0,a().tz)(),o=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center"}})),[]);return(0,g.jsxs)("div",{style:o.container,children:[(0,g.jsx)(l().D,{styleName:"UISmall-12px/Medium",children:i.formatMessage({id:"marketplace.reviews.nudge.body",defaultMessage:"Leave a review for the community!"})}),(0,g.jsx)(u().v,{onRatingConfirmed:t,error:n})]})}},20051:(e,t,n)=>{n.d(t,{Bl:()=>c,IH:()=>u,Lh:()=>I,Mh:()=>C,RY:()=>w,VP:()=>y,_A:()=>m,n$:()=>_});var i=()=>n(534177),r=()=>n(130382),a=()=>n(416845),o=()=>n(266442);const s=15;function c(e){if(!o().Vu.includes(e))throw new(a().rTV)("Rating must be an integer between 1 and 5.",{type:"marketplace_listing_review_invalid_rating"});return!0}const l=3,d=100;function u(e){const t=e.trim();if(t.length<l)throw new(a().rTV)("Title too short",{type:"marketplace_listing_review_title_too_short"});if(t.length>d)throw new(a().rTV)("Title too long",{type:"marketplace_listing_review_title_too_long"})}const g=50,v=1500;function m(e){const t=e.trim();if(t.length<g)throw new(a().rTV)("Description too short",{type:"marketplace_listing_review_description_too_short"});if(t.length>v)throw new(a().rTV)("Title too long",{type:"marketplace_listing_review_description_too_long"})}const p=40;function w(e){const t=e.trim();if(0===t.length)throw new(a().rTV)("Name is required",{type:"marketplace_listing_review_name_too_short"});if(t.length>p)throw new(a().rTV)("Name too long",{type:"marketplace_listing_review_name_too_long"})}const h=5,f=1500;function _(e){const t=e.trim();if(t.length<h)throw new(a().rTV)("Creator response too short",{type:"marketplace_listing_review_creator_response_too_short"});if(t.length>f)throw new(a().rTV)("Creator response too long",{type:"marketplace_listing_review_creator_response_too_long"})}function C(e){return void 0!==e.getTitle()&&void 0!==e.getSerializedContent()}function y(e){return(0,r().YH)(e)<s}function I(e){switch(e){case"mostRecent":return{columnName:"updated_time",direction:"descending"};case"highestRating":return{columnName:"rating",direction:"descending"};case"lowestRating":return{columnName:"rating",direction:"ascending"};default:(0,i().HB)(e)}}},36338:(e,t,n)=>{n.d(t,{_:()=>c});n(16280);var i=n(296540),r=()=>n(484714),a=()=>n(187174),o=()=>n(226098),s=()=>n(327684);function c(e){let{acquisitionId:t,source:n}=e;const c=(0,r().v3)(),{trackRateListing:l}=(0,s().o)(t),[d,u]=(0,i.useState)(),[g,v]=(0,i.useState)(0),m=(0,i.useCallback)((e=>{v(e),u(void 0)}),[]),[p,w]=(0,a().V$)((()=>(0,o().Df)({environment:c,acquisitionId:t,rating:g})),[c,t,g]);return{onRatingConfirmed:m,onSubmit:(0,i.useCallback)((async()=>{try{await w(),g&&l({type:"add",surface:"leaveReviewButton",rating:g,source:n})}catch(e){throw e instanceof Error&&u(e),e}}),[w,g,n,l]),isLoading:"pending"===p.status,error:d}}},85438:(e,t,n)=>{n.d(t,{w:()=>r});n(296540);var i=n(474848);const r=(0,n(340498).wt)("star",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.2627 14.7637C3.58398 15.0098 3.98047 14.9277 4.44531 14.5928L8 11.9814L11.5547 14.5928C12.0195 14.9277 12.4229 15.0098 12.7441 14.7637C13.0586 14.5244 13.127 14.1279 12.9424 13.5879L11.541 9.41113L15.1299 6.83398C15.5879 6.50586 15.7861 6.14355 15.6562 5.76074C15.5264 5.38477 15.1641 5.2002 14.5967 5.20703L10.1943 5.23438L8.85449 1.03711C8.68359 0.490234 8.40332 0.196289 8 0.196289C7.60352 0.196289 7.32324 0.490234 7.14551 1.03711L5.80566 5.23438L1.40332 5.20703C0.835938 5.2002 0.480469 5.38477 0.350586 5.76074C0.220703 6.14355 0.412109 6.50586 0.876953 6.83398L4.46582 9.41113L3.05762 13.5879C2.87305 14.1279 2.94141 14.5244 3.2627 14.7637ZM4.45898 13.1162C4.45215 13.1025 4.45215 13.0957 4.45898 13.0615L5.75781 9.39062C5.87402 9.05566 5.83301 8.84375 5.52539 8.63867L2.3125 6.4375C2.28516 6.42383 2.27148 6.41016 2.27832 6.38965C2.29199 6.37598 2.30566 6.36914 2.33984 6.36914L6.22949 6.45801C6.58496 6.47168 6.7627 6.35547 6.86523 6.01367L7.96582 2.28125C7.97266 2.24023 7.98633 2.2334 8 2.2334C8.02051 2.2334 8.02734 2.24023 8.04102 2.28125L9.13477 6.01367C9.2373 6.35547 9.42188 6.47168 9.77051 6.45801L13.6602 6.36914C13.7012 6.36914 13.7148 6.37598 13.7217 6.38965C13.7285 6.41016 13.7217 6.41699 13.6875 6.4375L10.4814 8.63867C10.167 8.85059 10.126 9.05566 10.2422 9.39062L11.541 13.0615C11.5547 13.0957 11.5547 13.1025 11.541 13.1162C11.5273 13.1367 11.5137 13.123 11.4863 13.1094L8.40332 10.7305C8.12305 10.5117 7.87695 10.5117 7.60352 10.7305L4.52051 13.1094C4.49316 13.123 4.47266 13.1367 4.45898 13.1162Z"})})},226098:(e,t,n)=>{n.d(t,{Df:()=>l,Jj:()=>g,TG:()=>d});n(16280),n(504294),n(944114);var i=()=>n(416845),r=()=>n(20051),a=()=>n(449506),o=()=>n(898486),s=()=>n(972435),c=()=>n(743071);async function l(e){let{environment:t,acquisitionId:n,rating:i,title:o,description:s,name:l}=e;try{(0,r().Bl)(i)}catch(g){!function(e){const t=v(e);if(t)throw new Error(t);m()}(g)}u({title:o,description:s,name:l});const d=await a().callApi({eventName:"createMarketplaceListingReview",environment:t,data:{acquisitionId:n,rating:i,title:o,description:s,name:l}});if("success"===d.type){const e=d.data.marketplaceListingReviewId;return c().A.setReviewId(n,e),{reviewId:e}}m()}async function d(e){let{environment:t,reviewId:n,title:i,description:r,name:o}=e;if(!n)throw new Error("Review id is required");u({title:i,description:r,name:o});const s=await a().callApi({eventName:"updateMarketplaceListingReview",environment:t,data:{reviewId:n,title:i,description:r,name:o}});if("success"===s.type)return s.data.success;m()}function u(e){let{title:t,description:n,name:i}=e;const a=[];if(void 0!==t)try{(0,r().IH)(t)}catch(o){a.push(new Error(v(o),{cause:"title"}))}if(void 0!==n)try{(0,r()._A)(n)}catch(o){a.push(new Error(v(o),{cause:"description"}))}if(void 0!==i)try{(0,r().RY)(i)}catch(o){a.push(new Error(v(o),{cause:"name"}))}if(a.length>0)throw new AggregateError(a)}async function g(e){let{environment:t,listingId:n,sort:i,offset:o,limit:s}=e;const c=await a().callApi({eventName:"getMarketplaceListingReviews",environment:t,data:{listingId:n,sort:(0,r().Lh)(i??"mostRecent"),limit:s,offset:o}});let l=[];return"success"===c.type&&(l=c.data.reviewIds),{reviewIds:l}}function v(e){if((0,i().V4j)(e))return(0,o().DX)(s().A.getIntl(),e.body)}function m(){throw new Error(s().A.getIntl().formatMessage({id:"marketplace.review.createReviewError",defaultMessage:"Something went wrong"}))}},327684:(e,t,n)=>{n.d(t,{o:()=>d});var i=n(296540),r=()=>n(484714),a=()=>n(56366),o=()=>n(529745),s=()=>n(2220),c=()=>n(217429),l=()=>n(936015);function d(e){const t=(0,r().v3)(),n=(0,a().K8)((()=>new(l().y)(t,{table:o().Ht,id:e}).getListingId()||""),[t,e]);return{trackReviewListing:(0,i.useCallback)((e=>{(0,s().u)({environment:t,event:{eventName:"review_listing",eventProperties:{from:"inApp",listing_id:n,...e}}}),c().default.logEvent("review_listing",void 0,e)}),[t,n]),trackRateListing:(0,i.useCallback)((e=>{(0,s().u)({environment:t,event:{eventName:"rate_listing",eventProperties:{from:"inApp",listing_id:n,...e}}}),c().default.logEvent("rate_listing",e.rating,e)}),[t,n])}}},332661:(e,t,n)=>{n.d(t,{v:()=>u});n(581454);var i=n(296540),r=()=>n(401497),a=()=>n(85438),o=()=>n(995166),s=()=>n(266442),c=()=>n(959013),l=()=>n(554509),d=n(474848);function u(e){let{labelledBy:t,error:n,isDisabled:u,rating:p,onRatingConfirmed:w}=e;const h=(0,c().tz)(),f=function(e){return(0,r().IS)((t=>({marketplaceRatingContainer:{paddingBottom:"4px"},group:{display:"flex",...e&&{pointerEvents:"none"}},star:{cursor:"pointer",padding:"0 4px",height:"40px",width:"40px",color:t.marketplaceStarDefault},starDragging:{cursor:"grabbing"},highlighted:{color:t.marketplaceStarSelected},error:{color:t.text.uiRedTertiary},errorMessage:{marginTop:"8px",textAlign:"center"}})),[e])}(u),[_,C]=(0,i.useState)(0),y=p??_,[I,k]=(0,i.useState)(!1),[L,b]=(0,i.useState)(0),R=()=>b(0),M=R,x=e=>()=>{b(e)},S=e=>()=>{k(!1),C(e)},E=e=>t=>{"Enter"===t.key&&(C(e),null==w||w(e),k(!1))},T=e=>()=>{k(!1),null==w||w(e)},A=e=>t=>{v(t)&&(k(!0),C(e)),b(e)};return(0,d.jsxs)("div",{style:f.marketplaceRatingContainer,children:[(0,d.jsx)("div",{role:"radiogroup","aria-labelledby":t,"aria-invalid":Boolean(n),"aria-errormessage":n?g:void 0,"aria-required":!0,style:f.group,onMouseLeave:e=>{R(),k(!1),v(e)&&y&&(null==w||w(y))},onBlur:M,children:s().Vu.map((e=>{const t=y===e,i=e<=y,r=!u&&(i||e<=L),s={...f.star,...r&&f.highlighted,...I&&f.starDragging,...n&&!L&&f.error};return(0,d.jsx)("div",{role:"radio",tabIndex:0,"aria-checked":t,"aria-label":h.formatMessage(m.starLabel,{star:e}),"aria-disabled":u,onFocus:x(e),onMouseDown:S(e),onKeyDown:E(e),onMouseUp:T(e),onMouseEnter:A(e),children:i?(0,o().M)(s):(0,a().w)(s)},e)}))}),n?(0,d.jsx)(l().D,{id:g,styleName:"UIRegular-14px/Regular",colorName:"redTertiary",customStyles:f.errorMessage,children:n.message}):void 0]})}const g="rating-error-message";function v(e){return 1===e.buttons}const m=(0,c().YK)({starLabel:{id:"marketplace.rating.star",defaultMessage:"Select {star, plural, one {{star, number} star} other {{star, number} stars}}"}})},504294:(e,t,n)=>{var i=n(746518),r=n(497751),a=n(318745),o=n(779039),s=n(714601),c="AggregateError",l=r(c),d=!o((function(){return 1!==l([1]).errors[0]}))&&o((function(){return 7!==l([1],c,{cause:7}).cause}));i({global:!0,constructor:!0,arity:2,forced:d},{AggregateError:s(c,(function(e){return function(t,n){return a(e,this,arguments)}}),d,!0)})},743071:(e,t,n)=>{n.d(t,{A:()=>a});const i={reviewIdCache:{},isOpen:!1,acquisitionId:"",stage:"rating",rating:0,source:void 0};class r extends(()=>n(757695))().Store{getInitialState(){return{...i}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal(e){let{stage:t,acquisitionId:n,rating:r,source:a}=e;this.setState({...i,reviewIdCache:this.state.reviewIdCache,isOpen:!0,acquisitionId:n,stage:t,rating:r||0,source:a})}closeModal(){this.setState({...i,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const a=new r},995166:(e,t,n)=>{n.d(t,{M:()=>r});n(296540);var i=n(474848);const r=(0,n(340498).wt)("starFilled",{viewBox:"0 0 24 24",svg:(0,i.jsx)("path",{d:"M4.603 22.837c.375.277.826.2 1.4-.22l6.002-4.411 6.003 4.41c.561.42 1.024.498 1.387.221.375-.276.463-.73.232-1.403l-2.346-7.075 6.047-4.366c.572-.41.77-.83.627-1.271-.143-.432-.55-.653-1.255-.653l-7.424.045-2.269-7.108C12.787.32 12.457 0 12.005 0c-.463 0-.782.32-1.002 1.006l-2.27 7.108-7.423-.045c-.716 0-1.123.221-1.266.653-.144.442.066.862.638 1.27l6.036 4.367-2.335 7.075c-.231.674-.143 1.127.22 1.403z"})})}}]);