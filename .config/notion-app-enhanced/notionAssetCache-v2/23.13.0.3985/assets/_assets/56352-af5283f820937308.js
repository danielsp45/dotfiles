"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[56352],{61548:(e,t,i)=>{i.d(t,{S7:()=>Q,eQ:()=>_,jd:()=>D,my:()=>X});var o=i(296540),n=()=>i(484714),r=()=>i(56366),s=()=>i(401497),a=()=>i(563884),d=()=>i(310442),l=()=>i(824862),c=()=>i(798880),u=()=>i(959013),g=()=>i(496603),h=()=>i(534177),m=()=>i(284371),p=()=>i(572080),v=()=>i(751156),f=()=>i(38337),x=()=>i(728611),S=()=>i(553965),b=()=>i(907514),y=()=>i(577009),C=()=>i(965351),A=()=>i(962730),k=()=>i(630116),j=()=>i(406699),M=()=>i(187820),T=()=>i(16006),w=()=>i(859428),R=()=>i(256863),B=()=>i(453697),I=()=>i(791194),L=()=>i(659799),K=()=>i(709438),U=()=>i(682197),z=i(474848);const N=0,D=8,_=24,P=16+_+12;function W(e){const{notification:t,children:a,header:d,subheader:l,body:c,rootStore:u,count:g,onArchiveClicked:h,onUnarchiveClicked:f,onMarkAsReadClicked:x,onMarkAsUnreadClicked:S,onNotificationBodyClicked:b,url:y,isFirst:A,isLast:M,disableLineClamp:T,disableTitleClamp:w}=e,R=(0,n().v3)(),B=(0,n().Y0)(),I=parseInt(t.end_time),L=(0,r().K8)((()=>{const e=t.navigable_block_id;if(e)return k().sk.createChildStore(u,{table:i(179034).ev,id:e,spaceId:u.id})}),[u,t.navigable_block_id]),K=(0,r().K8)((()=>L||e.notificationTitleStore),[L,e.notificationTitleStore]),D=(0,r().K8)((()=>i(441199).default.isPeekDismissableState()),[]),[_,W]=(0,o.useState)(!1),[O,H]=(0,o.useState)(!1),E=(0,o.useRef)(null),V=(0,i(683097).A)({onLongPress:()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.setOpen(!0)}}),[$,Y]=(0,o.useState)(!1),Z=_&&!O&&!$,Q=(0,r().K8)((()=>"mentions"===i(606846).Ay.state.currentTab),[]),X=!t||t.read,J=B.isMobile,q=(0,r().K8)((()=>{const e=R.WindowSizeStore.state;return{left:e.paddingLeftCSS,right:e.paddingRightCSS}}),[R.WindowSizeStore]),ee=(0,s().IS)((e=>({article:{display:"flex",flexDirection:"column"},mainClickTargetButton:{display:"flex",flexDirection:"column",gap:0,paddingTop:14-N,paddingBottom:14-N,paddingLeft:J?q.left:0,paddingRight:J?q.right:0,marginTop:A?0:N,marginBottom:M?0:N,marginLeft:N,marginRight:N,transition:"background 150ms ease"},mainClickTargetButtonHovered:{background:e.state.hover},header:{display:"flex",paddingLeft:16-N,paddingRight:16-N,maxWidth:"100%"},subheaderAndBody:{display:"flex",flexDirection:"column"},subheader:{paddingLeft:P-N,paddingRight:16-N,fontSize:14,fontWeight:m().Wy.regular,color:e.text.primary,...m().RC},body:{marginTop:3,paddingLeft:P-N,paddingRight:16-N,fontSize:14,color:e.text.secondary,display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:T?void 0:2,overflow:"hidden"},children:{paddingTop:4,paddingLeft:P-N,paddingRight:16-N},divider:{height:1,backgroundColor:e.stroke.secondary},buttonPressed:{backgroundColor:_&&O?e.buttonBackground:e.state.pressed}})),[J,q.left,q.right,A,M,_,O,T]),te=(0,o.useCallback)((e=>{t&&($||(!y&&t.read||b(),!D||e.metaKey||e.ctrlKey||i(770906).VI({environment:R}),t.read||v().createAndCommit({userAction:"ActivityNotificationSection.handleMarkAsRead",environment:R,canUndo:!0,perform:e=>{p().ZB({notification:t,rootStore:u,transaction:e,read:!0})}})))}),[R,$,t,b,D,u,y]),ie=(0,o.useCallback)((e=>{t&&(t.read?S():x(),v().createAndCommit({userAction:"InboxActionsMenu.toggleNotificationReadStatus",environment:R,canUndo:!0,perform:e=>{p().ZB({notification:t,rootStore:u,transaction:e,read:!t.read})}}))}),[R,t,x,S,u]),oe=(0,o.useCallback)((e=>{t&&(h(),v().createAndCommit({userAction:"InboxActionsMenu.handleArchive",environment:R,canUndo:!0,perform:e=>{p().s4({notification:t,rootStore:u,transaction:e})}}))}),[R,t,h,u]),ne=(0,o.useCallback)((e=>{t&&(f(),v().createAndCommit({userAction:"Activity.handleUnarchive",environment:R,canUndo:!0,perform:e=>{p().JV({notificationId:t.id,visited:!1,rootStore:u,transaction:e})}}))}),[R,t,f,u]),re=(0,o.useCallback)((()=>W(!0)),[]),se=(0,o.useCallback)((()=>W(!1)),[]),ae=(0,o.useId)(),de=(0,i(575301).T4)();return(0,z.jsx)(j().Ay,{ref:E,disabled:!B.isMobile,style:de.popup,popupType:B.isTablet?j().z7.Popup:j().z7.BottomSheet,render:e=>(0,z.jsx)(C().Lk,{blockStore:L,notification:t,handlers:{handleUnarchive:ne,handleArchive:oe,toggleNotificationReadStatus:ie},closePopup:()=>e.close()}),renderOrigin:()=>(0,z.jsx)("div",{...B.isMobile&&V,children:(0,z.jsx)("article",{style:ee.article,onMouseOver:re,onMouseLeave:se,children:(0,z.jsxs)(U().y.Provider,{value:H,children:[(0,z.jsx)(F,{notification:t,rootStore:u,isMobile:J,isHovered:_,isFirst:A,onMouseEnter:()=>Y(!0),onMouseLeave:()=>Y(!1),onArchiveClicked:h,onUnarchiveClicked:f,onMarkAsReadClicked:x,onMarkAsUnreadClicked:S}),(0,z.jsxs)(i(197190).A,{href:y,hovered:Z,ignoreLocalHoverState:!0,style:ee.mainClickTargetButton,onClick:te,hoveredStyle:ee.mainClickTargetButtonHovered,disabled:!Boolean(y),pressedStyle:ee.buttonPressed,"aria-labelledby":ae,children:[(0,z.jsx)("div",{style:ee.header,children:d?(0,z.jsx)(G,{icon:d.icon,header:d.title,timestamp:I,titleAriaId:ae,showBlueDot:Q&&!X,disableTitleClamp:w,count:g}):(0,z.jsx)(G,{notificationTitleStore:K,timestamp:I,titleAriaId:ae,showBlueDot:Q&&!X,disableTitleClamp:w,count:g})}),(0,z.jsxs)("div",{style:ee.subheaderAndBody,children:[l&&(0,z.jsx)("div",{style:ee.subheader,children:l}),c&&(0,z.jsx)("div",{style:ee.body,children:c}),a&&(0,z.jsx)("div",{style:ee.children,children:a})]})]}),!M&&(0,z.jsx)("div",{style:ee.divider})]})})})},t.id)}const O=12-N,H=12-N,E="100ms ease-out";function F(e){const{notification:t,rootStore:i,isMobile:o,isHovered:n,isFirst:r,onArchiveClicked:a,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c,onMouseEnter:u,onMouseLeave:g}=e,h=(0,s().IS)((()=>({container:{display:"flex",alignItems:"flex-start",position:"relative",zIndex:1},body:{transition:`opacity ${E}`,opacity:o||n?1:0,position:"absolute",right:O,top:H+(o?-3:0)+(r?0:N)}})),[o,n,r]);return t?(0,z.jsx)("div",{style:h.container,onMouseEnter:u,onMouseLeave:g,children:(0,z.jsx)("div",{style:h.body,children:(0,z.jsx)(y().hR,{notification:t,rootStore:i,onArchiveClicked:a,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c})})}):null}const V=14,$=12,Y=12;function G(e){const{notificationTitleStore:t,icon:i,header:d,timestamp:l,showBlueDot:c,disableTitleClamp:h,count:p=0}=e,v=(0,n().Y0)(),y=(0,u().tz)(),j=v.isMobile,[R,B]=(0,o.useState)(!1),[N,_]=(0,o.useState)(!1),P=(0,b().nl)(l,{useUltraCompactFormat:!0}),W=(0,b().x$)(l),H=(0,r().K8)((()=>{if(t instanceof k().Bv)return t}),[t]),{actorStore:E,actorName:F}=(0,r().K8)((()=>{if(t instanceof k().LU||t instanceof k().vK||t instanceof k().pH){return t?{actorStore:t,actorName:t.getDisplayName(y)}:{actorStore:void 0,actorName:void 0}}return{actorStore:void 0,actorName:void 0}}),[t,y]),G=(0,r().K8)((()=>{if(!(t instanceof k().pS||t instanceof k().LU||t instanceof k().vK||t instanceof k().pH))return t}),[t]),Q=(0,r().K8)((()=>{var e;if(G)return null===(e=G.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:G.getRecordModel})}),[G]),X=(0,r().K8)((()=>!!H&&H.isEmptyPage()),[H]),J=(0,r().K8)((()=>(0,M().Te)(H)),[H]),q=(0,r().K8)((()=>null==H?void 0:H.isDefined()),[H]),ee=(0,o.useCallback)((()=>{B(!0),_(!1)}),[]),te=g().nF((()=>{_(!0)}),200,{leading:!0}),ie=(0,o.useCallback)((()=>{B(!1),_(!1),x().Ol(window,"scroll",te,!0)}),[te]),oe=(0,o.useCallback)((e=>(0,z.jsx)(I().yf,{store:H,events:e})),[H]);(0,o.useEffect)((()=>(x().P4(window,"scroll",te,!0),()=>x().Ol(window,"scroll",te,!0))),[te]);const ne=(0,s().IS)((e=>({container:{display:"flex",flexDirection:"row",minWidth:0,width:"100%",marginTop:2},iconHeaderOverride:{display:"flex",flexDirection:"row",gap:Y,alignItems:"start",minWidth:0},headerMobile:{fontSize:V,minWidth:0},header:{display:"inline-grid",gridAutoFlow:"column",alignItems:"start",justifyContent:"space-between",fontSize:V,gap:12,minWidth:0},time:{display:"flex",gap:8,fontSize:$,color:e.text.tertiary,whiteSpace:"nowrap",...j&&{display:"inline"},marginTop:V-$+2},pageTitleAndTimestamp:{display:"flex",flex:1,flexDirection:"column",gap:Y,minWidth:0},pageTitleMockedButton:{minWidth:0,display:"inline",textAlign:"center",borderRadius:3,paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:5,marginTop:-2,marginBottom:-2,marginLeft:-3,marginRight:-5,background:R&&(q||t)?e.state.hover:void 0},statusDotContainer:{display:"flex",alignItems:"center"},statusDotSpacer:{width:D,flexShrink:0},count:{lineHeight:"21px",fontSize:12,color:e.text.secondary,paddingTop:.5},headerText:{fontSize:14,fontWeight:m().Wy.medium,display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:h?void 0:3,overflow:"hidden",textOverflow:"ellipsis",marginTop:2}})),[j,R,t,q,h]),re=!0!==N&&void 0;return(0,z.jsxs)("div",{style:ne.container,children:[(0,z.jsx)("div",{style:ne.pageTitleAndTimestamp,children:(0,z.jsxs)("div",{style:j?ne.headerMobile:ne.header,children:[i&&d&&(0,z.jsxs)("div",{style:ne.iconHeaderOverride,children:[i,(0,z.jsxs)("div",{style:ne.headerText,children:[d,(H||t)&&(0,z.jsx)(U().g,{disabled:!q&&!t,children:(0,z.jsx)(w().A,{originGap:3,disableTooltip:!q,alignment:A().C.Start,placement:A().W.Bottom,renderTooltip:oe,closeDelay:0,noStyle:!0,textWrap:!0,forceVisibleState:re,render:e=>(0,z.jsxs)("div",{style:ne.pageTitleMockedButton,...(0,S().A)(e,{onMouseEnter:ee,onMouseLeave:ie}),children:[E&&F?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Z,{actorStore:E,avatar:void 0,size:16}),(0,z.jsx)("div",{children:F})]}):G?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(M().B6,{disabled:!0,icon:Q,iconRecordCategory:J,isEmptyPage:X,size:16}),(0,z.jsx)(T().A,{store:G,underline:!0})]}):null,p?(0,z.jsx)("div",{style:ne.count,children:p}):null]})})})]})]}),(0,z.jsxs)("div",{style:ne.time,className:f().Cxn,children:[l>0?(0,z.jsx)(L().A,{text:P,tooltipText:W,icon:a().k}):void 0,c?(0,z.jsx)("div",{style:ne.statusDotContainer,children:(0,z.jsx)(K().m,{size:D})}):(0,z.jsx)("div",{style:ne.statusDotSpacer})]})]})}),j&&(0,z.jsx)("div",{style:{width:C().UM-O,flexShrink:0}})]})}function Z(e){const{actorStore:t,avatar:i}=e,o=e.size??28;return t?t.table===l().GP?(0,z.jsx)(R().A,{botStore:t,size:o}):t.table===c().oo?(0,z.jsx)(B().A,{userStore:t,size:o}):t.table===d().yj?(0,z.jsx)(B().A,{userStore:void 0,size:o}):void(0,h().HB)(t):i?(0,z.jsx)(B().A,{avatar:i,size:o}):(0,z.jsx)(B().A,{userStore:void 0,size:o})}function Q(e){let{icon:t}=e;const i=(0,s().IS)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"center",height:24,width:24},icon:{height:20,width:20,fill:e.icon.secondary}})),[]);return(0,z.jsx)("div",{style:i.wrapper,children:t(i.icon)})}const X=o.memo(W)},400835:(e,t,i)=>{i.d(t,{D:()=>n});i(296540);var o=i(474848);const n=(0,i(340498).wt)("personBadgeQuestionMark",{viewBox:"0 0 15 14",svg:(0,o.jsx)("path",{d:"M12.4551 5.41699C12.8037 5.41699 13.0088 5.19824 13.0088 4.93164V4.84961C13.0088 4.45996 13.2344 4.2207 13.7061 3.90625C14.3691 3.46875 14.8408 3.07227 14.8408 2.25195C14.8408 1.11719 13.8291 0.501953 12.667 0.501953C11.498 0.501953 10.7256 1.0625 10.5342 1.69141C10.5 1.80078 10.4795 1.91016 10.4795 2.02637C10.4795 2.33398 10.7188 2.49805 10.9443 2.49805C11.1836 2.49805 11.3271 2.38867 11.4502 2.22461L11.5732 2.06055C11.8125 1.66406 12.1748 1.43164 12.626 1.43164C13.248 1.43164 13.6514 1.78711 13.6514 2.30664C13.6514 2.77148 13.3643 2.99707 12.7695 3.41406C12.2773 3.75586 11.915 4.11816 11.915 4.78809V4.87695C11.915 5.23242 12.1064 5.41699 12.4551 5.41699ZM5.79004 6.99609C7.25293 6.99609 8.52441 5.68359 8.52441 3.97461C8.52441 2.28613 7.25293 1.03516 5.79004 1.03516C4.32715 1.03516 3.05566 2.31348 3.05566 3.98828C3.05566 5.68359 4.32031 6.99609 5.79004 6.99609ZM12.4414 7.4541C12.8379 7.4541 13.1797 7.13965 13.1797 6.74316C13.1797 6.34668 12.8447 6.03223 12.4414 6.03223C12.0381 6.03223 11.7031 6.35352 11.7031 6.74316C11.7031 7.13281 12.0449 7.4541 12.4414 7.4541ZM1.20312 13.3262H10.3701C11.1016 13.3262 11.5391 12.9844 11.5391 12.417C11.5391 10.6533 9.33105 8.21973 5.7832 8.21973C2.24219 8.21973 0.0341797 10.6533 0.0341797 12.417C0.0341797 12.9844 0.47168 13.3262 1.20312 13.3262Z"})})},656352:(e,t,i)=>{i.d(t,{DW:()=>M,EG:()=>T,yb:()=>j});i(18107),i(410838),i(944114),i(57145),i(517642),i(658004),i(733853),i(845876),i(432475),i(515024),i(731698),i(967357),i(898992),i(354520),i(430670),i(803949),i(581454),i(737550);var o=i(296540),n=()=>i(484714),r=()=>i(56366),s=()=>i(401497),a=()=>i(584262),d=()=>i(857639),l=()=>i(179034),c=()=>i(959013),u=()=>i(534177),g=()=>i(284371),h=()=>i(963589),m=()=>i(737230),p=()=>i(217429),v=()=>i(630116),f=()=>i(77179),x=()=>i(12296),S=()=>i(769617),b=()=>i(668942),y=()=>i(870923),C=()=>i(61548),A=i(474848);function k(e){const{activity:t,tabArgs:o,rootStore:n,isFirst:s,isLast:a}=e,{notification:d}=o,l=(0,r().K8)((()=>t.getEdits()),[t]);let c=l.filter((e=>{switch(e.type){case"comment-changed":return!1;case"comment-created":case"comment-deleted":case"suggestion-created":return!0;default:(0,u().HB)(e)}}));0===c.length&&0!==l.length&&(c=l);const g=(0,r().K8)((()=>[n.getRecordStore(n,{table:i(197959).$Y,id:t.discussion_id,spaceId:t.space_id})]),[t,n]);return(0,A.jsx)(j,{notification:d,edits:c,discussionStores:g,activity:t,tabArgs:o,rootStore:n,isFirst:s,isLast:a})}function j(e){const{notification:t,edits:i,discussionStores:k,tabArgs:j,rootStore:T,isFirst:w,isLast:R,activity:B}=e,I=(0,c().tz)(),L=i.length>0,K=(0,n().v3)(),U=(0,h().X)("public_api_custom_display_names_in_comments"),z=k[0],N=(0,r().K8)((()=>{const e=null==z?void 0:z.getParentPointer();if(e)return v().Bv.createChildStore(T,e)}),[z,T]),D=(0,r().K8)((()=>Boolean(N&&N.isDefined())),[N]),_=(0,r().K8)((()=>{const e=null==N?void 0:N.getNavigableBlockStore();return(null==e?void 0:e.id)??(null==B?void 0:B.navigable_block_id)??t.navigable_block_id}),[N,B,t.navigable_block_id]),P=_?v().Bv.createChildStore(T,{table:l().ev,id:_}):void 0,W=(0,r().K8)((()=>(null==P?void 0:P.isDefined())??!1),[P]),O=(0,r().K8)((()=>p().default.getConfigKey("assume_comment_read","last_seen_at")),[]),H=(0,r().K8)((()=>k.filter((e=>e.isUnread(O))).length),[k,O]),E=(0,r().K8)((()=>k.toSorted(((e,t)=>Math.max(...t.getCommentStores().map((e=>e.getCreatedTime())))-Math.max(...e.getCommentStores().map((e=>e.getCreatedTime()))))).toSorted(((e,t)=>(t.isUnread(O)?1:0)-(e.isUnread(O)?1:0))).filter((e=>e.getCommentStores().some((e=>{var t;return(null===(t=e.getCreatedByPointer())||void 0===t?void 0:t.id)!==K.currentUser.id}))))),[k,O,K.currentUser.id]),{actorModels:F,actorNamesInDiscussions:V}=(0,r().K8)((()=>{const e=new Set,t=[],i=new Map,o=K.currentUser.id,n=E.flatMap((e=>e.getCommentStores().toSorted(((e,t)=>t.getCreatedTime()-e.getCreatedTime()))));n.forEach((o=>{const n=o.getCreatedByPointer();n&&!e.has(n.id)&&(e.add(n.id),t.push(n),i.set(n.id,o))}));const r=t.map((e=>v().sk.createChildStore(T,e).getModel())).filter(u().O9).filter((e=>e.id!==o));return{actorModels:r,actorNamesInDiscussions:r.map((e=>{const t=i.get(e.id);if(!t)return;return t.resolveAuthorDisplayName(U,I)})).filter(u().O9)}}),[E,T,I,K.currentUser.id,U]),$=(0,r().K8)((()=>{const e=E.at(0),t=null==e?void 0:e.getCommentStores().findLast((e=>{var t;return(null===(t=e.getCreatedByPointer())||void 0===t?void 0:t.id)!==K.currentUser.id}));return t&&e?{commentStore:t,discussionStore:e}:{author:void 0,commentStore:void 0,discussionStore:void 0}}),[E,K.currentUser.id]),Y=(0,r().K8)((()=>{var e;if(N)return null===(e=N.getModel())||void 0===e?void 0:e.getRenderUrl({getRecordModel:T.getRecordModel,discussionId:(null==B?void 0:B.discussion_id)??t.discussion_id,pageVisitSource:a().y8.Notification,updateSidebarTab:H>1?m().UL.ForYou:void 0})}),[N,T,B,t.discussion_id,H]),G=(0,r().K8)((()=>F.map((e=>e.asActor)).filter(u().O9)),[F]),{firstActorStore:Z,lastActorStore:Q}=(0,o.useMemo)((()=>{const e=G.at(0),t=G.length>1?G.at(-1):void 0;return{firstActorStore:e?v().sk.createChildStore(T,e.pointer):void 0,lastActorStore:t?v().sk.createChildStore(T,null==t?void 0:t.pointer):void 0}}),[G,T]),X=Z&&Q?(0,A.jsx)(S().v9,{frontActorStore:Z,backActorStore:Q,spaceStore:T}):(0,A.jsx)(f().H8,{authors:G,size:C().eQ,style:{marginTop:0,marginRight:0},showAvatarShadow:!1}),J=(0,s().IS)((e=>({latestComment:{fontSize:14,color:e.text.secondary,lineHeight:"21px"},truncateTwoLines:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden"}})),[]);return L&&W&&D&&z?(0,A.jsx)(C().my,{isFirst:w,isLast:R,rootStore:T,navigableBlockId:_,notification:t,count:H,url:Y,header:{icon:X,title:(0,A.jsx)(c().sA,{id:"activity.commentActivity.subheader",defaultMessage:"{authors} <regular>commented in </regular> {pageTitle}",values:{authors:(0,A.jsx)(M,{actorNames:V}),regular:e=>(0,A.jsx)("span",{style:{fontWeight:g().Wy.regular},children:e}),pageTitle:(0,A.jsx)(y().i,{blockStore:P,underline:!1,shouldWrap:!0})}})},body:1===E.length&&$.commentStore&&$.discussionStore&&(0,A.jsx)(b().j,{style:{...J.latestComment,...J.truncateTwoLines},discussionStore:$.discussionStore,commentStore:$.commentStore}),...(0,x().$5)({notification:t,environment:K,tab:j.tab,activity:B})}):(d().log({level:"warning",from:"CommentPageGroupActivityNotification",type:"invalidNotificationData",data:{ids:[(null==t?void 0:t.id)??"unknown"]}}),null)}function M(e){let{actorNames:t}=e;if(1===t.length)return(0,A.jsx)("span",{children:t[0]});if(2===t.length)return(0,A.jsxs)("span",{children:[t[0],", ",t[1]]});if(t.length>2){const e=t.length-1;return(0,A.jsxs)("span",{children:[t[0],", ",e," ",1===e?"other":"others"]})}return null}const T=o.memo(k)},668942:(e,t,i)=>{i.d(t,{j:()=>u});i(296540);var o=()=>i(484714),n=()=>i(56366),r=()=>i(401497),s=()=>i(191772),a=()=>i(712030),d=()=>i(921855),l=()=>i(299545),c=i(474848);function u(e){const{discussionStore:t,commentStore:i}=e,u=(0,o().v3)(),g=(0,r().DP)(),h=(0,n().K8)((()=>l().gp(i).getValue()),[i]),m=(0,n().K8)((()=>i.getSpaceId()),[i]),p=(0,n().K8)((()=>{if(!h||!m)return null;const e=(0,s().Eh)({textValue:h,currentUserId:u.currentUser.id,getRecordModel:t.getRecordModel,highlightStyle:"text_only"});return(0,d().S5)({environment:u,textValue:{value:e,spaceId:m},parentStore:t,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableHover:!0,disabled:!0,theme:g,emojiType:(0,a().FN)(u),katex:u.KatexStore.getKatex(),formulaValueTypes:[]})}),[u,t,g,h,m]),v=(0,r().IS)((t=>({commentText:{whiteSpace:"pre-wrap",wordBreak:"break-word",display:"inline",fontSize:14,color:t.text.primary,lineHeight:"22px",...e.style}})),[e.style]);return(0,c.jsx)("span",{style:v.commentText,children:p})}},682197:(e,t,i)=>{i.d(t,{g:()=>s,y:()=>r});var o=i(296540),n=i(474848);const r=o.createContext((()=>{}));function s(e){const{disabled:t=!1,children:i}=e,s=(0,o.useContext)(r),a=(0,o.useCallback)((()=>{t||s(!0)}),[s,t]),d=(0,o.useCallback)((()=>{t||s(!1)}),[s,t]);return(0,n.jsx)("div",{style:{display:"contents"},onMouseEnter:a,onMouseLeave:d,children:i})}r.displayName="NestedNotificationButtonContext"},683097:(e,t,i)=>{i.d(t,{A:()=>r});var o=i(296540),n=()=>i(484714);function r(e){const t=(0,n().v3)(),{onLongPress:i,hapticsEnabled:r=!0,timeout:s=300}=e,a=(0,o.useCallback)((()=>{var e,o,n;r&&(null!==(e=t.mobileNative)&&void 0!==e&&e.buzz?t.mobileNative.buzz():null===(o=(n=window.navigator).vibrate)||void 0===o||o.call(n,20));i()}),[t.mobileNative,r,i]),d=(0,o.useRef)(),l=(0,o.useRef)(0),c=(0,o.useRef)(0),u=(0,o.useCallback)((()=>clearTimeout(d.current)),[]);(0,o.useEffect)((()=>u),[u]);return{onTouchStart:(0,o.useCallback)((()=>{clearTimeout(d.current),d.current=setTimeout(a,s)}),[s,a]),onTouchMove:(0,o.useCallback)((e=>{const t=e.touches[0].clientX,i=e.touches[0].clientY;(Math.abs(t-l.current)>50||Math.abs(i-c.current)>50)&&clearTimeout(d.current)}),[]),onTouchEnd:u,onTouchCancel:u}}},700348:(e,t,i)=>{i.d(t,{Ay:()=>O,T6:()=>K,VB:()=>M,XA:()=>R,eQ:()=>T,gH:()=>z,rL:()=>W});var o=i(296540),n=()=>i(484714),r=()=>i(56366),s=()=>i(401497),a=()=>i(563884),d=()=>i(823279),l=()=>i(179034),c=()=>i(572080),u=()=>i(82926),g=()=>i(751156),h=()=>i(38337),m=()=>i(972435),p=()=>i(907514),v=()=>i(577009),f=()=>i(965351),x=()=>i(630116),S=()=>i(406699),b=()=>i(285790),y=()=>i(859428),C=()=>i(659799),A=()=>i(870923),k=i(474848);const j=0,M=8,T=24,w=24+T+M,R="150ms ease";function B(e){const{notification:t,children:a,rootStore:d,icon:u,isPrivate:m,onArchiveClicked:p,onUnarchiveClicked:v,onMarkAsReadClicked:b,onMarkAsUnreadClicked:y,onNotificationBodyClicked:C,navigableBlockId:A,url:B,showSnapshotButton:I,hidePageTitle:L,header:K,isFirst:z,isLast:N}=e,D=(0,n().v3)(),W=(0,n().Y0)(),O=parseInt(t.end_time),H=(0,r().K8)((()=>{const e=t.navigable_block_id;if(e)return x().sk.createChildStore(d,{table:l().ev,id:e,spaceId:d.id})}),[d,t.navigable_block_id]),E=(0,r().K8)((()=>i(441199).default.isPeekDismissableState()),[]),[F,V]=(0,o.useState)(!1),[$,Y]=(0,o.useState)(!1),G=(0,o.useRef)(null),Z=(0,i(683097).A)({onLongPress:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.setOpen(!0)}}),[Q,X]=(0,o.useState)(!1),J=F&&!$&&!Q,q=(0,r().K8)((()=>"mentions"===i(606846).Ay.state.currentTab),[]),ee=!t||t.read,te=W.isMobile,ie=(0,r().K8)((()=>{const e=D.WindowSizeStore.state;return{left:e.paddingLeftCSS,right:e.paddingRightCSS}}),[D.WindowSizeStore]),oe=(0,s().IS)((e=>({article:{display:"flex",flexDirection:"column"},mainClickTargetButton:{display:"flex",flexDirection:"column",gap:8,paddingTop:14-j,paddingBottom:14-j,paddingLeft:te?ie.left:0,paddingRight:te?ie.right:0,marginTop:z?0:j,marginBottom:N?0:j,marginLeft:j,marginRight:j,transition:`background ${R}`},mainClickTargetButtonHovered:{background:e.state.hover},headerAndAvatar:{display:"flex",paddingLeft:8-j,paddingRight:20-j,gap:M,maxWidth:"100%"},avatarAndStatusDot:{display:"flex",gap:8,alignItems:"center",height:T},statusDotSpacer:{width:8,flexShrink:0},privatePageBadge:{marginTop:1,marginBottom:4,marginLeft:8},children:{paddingLeft:w-j,paddingRight:20-j},divider:{height:1,backgroundColor:e.stroke.secondary},buttonPressed:{backgroundColor:F&&$?e.buttonBackground:e.state.pressed}})),[te,ie.left,ie.right,z,N,F,$]),ne=(0,o.useCallback)((e=>{t&&(Q||(!B&&t.read||C(),!E||e.metaKey||e.ctrlKey||i(770906).VI({environment:D}),t.read||g().createAndCommit({userAction:"ActivityNotificationSection.handleMarkAsRead",environment:D,canUndo:!0,perform:e=>{c().ZB({notification:t,rootStore:d,transaction:e,read:!0})}})))}),[D,Q,t,C,E,d,B]),re=(0,o.useCallback)((e=>{t&&(t.read?y():b(),g().createAndCommit({userAction:"InboxActionsMenu.toggleNotificationReadStatus",environment:D,canUndo:!0,perform:e=>{c().ZB({notification:t,rootStore:d,transaction:e,read:!t.read})}}))}),[D,t,b,y,d]),se=(0,o.useCallback)((e=>{t&&(p(),g().createAndCommit({userAction:"InboxActionsMenu.handleArchive",environment:D,canUndo:!0,perform:e=>{c().s4({notification:t,rootStore:d,transaction:e})}}))}),[D,t,p,d]),ae=(0,o.useCallback)((e=>{t&&(v(),g().createAndCommit({userAction:"Activity.handleUnarchive",environment:D,canUndo:!0,perform:e=>{c().JV({notificationId:t.id,visited:!1,rootStore:d,transaction:e})}}))}),[D,t,v,d]),de=(0,o.useCallback)((()=>V(!0)),[]),le=(0,o.useCallback)((()=>V(!1)),[]),ce=(0,o.useId)(),ue=(0,i(575301).T4)();return(0,k.jsx)(S().Ay,{ref:G,disabled:!W.isMobile,style:ue.popup,popupType:W.isTablet?S().z7.Popup:S().z7.SlideUp,render:e=>(0,k.jsx)(f().Lk,{blockStore:H,notification:t,handlers:{handleUnarchive:ae,handleArchive:se,toggleNotificationReadStatus:re},closePopup:()=>e.close()}),renderOrigin:()=>(0,k.jsx)("div",{...W.isMobile&&Z,children:(0,k.jsx)("article",{style:oe.article,onMouseOver:de,onMouseLeave:le,children:(0,k.jsxs)(i(682197).y.Provider,{value:Y,children:[(0,k.jsx)(U,{notification:t,rootStore:d,isMobile:te,isHovered:F,isFirst:z,onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),onArchiveClicked:p,onUnarchiveClicked:v,onMarkAsReadClicked:b,onMarkAsUnreadClicked:y}),(0,k.jsxs)(i(197190).A,{href:B,hovered:J,ignoreLocalHoverState:!0,style:oe.mainClickTargetButton,onClick:ne,hoveredStyle:oe.mainClickTargetButtonHovered,disabled:!Boolean(B),pressedStyle:oe.buttonPressed,"aria-labelledby":ce,children:[(0,k.jsxs)("div",{style:oe.headerAndAvatar,children:[(0,k.jsxs)("div",{className:h().a9W,style:oe.avatarAndStatusDot,children:[q&&!ee?(0,k.jsx)(i(709438).m,{size:8}):(0,k.jsx)("div",{style:oe.statusDotSpacer}),u]}),(0,k.jsx)(_,{blockStore:H,timestamp:O,header:K,hidePageTitle:Boolean(L),titleAriaId:ce}),I&&A&&(0,k.jsx)(P,{timestamp:O,navigableBlockId:A,rootStore:d}),m&&!t&&(0,k.jsx)(i(365136).A,{style:oe.privatePageBadge})]}),a&&(0,k.jsx)("div",{style:oe.children,className:h().CyB,children:a})]}),!N&&(0,k.jsx)("div",{style:oe.divider})]})})})},t.id)}const I=12-j,L=12-j,K="100ms ease-out";function U(e){const{notification:t,rootStore:i,isMobile:o,isHovered:n,isFirst:r,onArchiveClicked:a,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c,onMouseEnter:u,onMouseLeave:g}=e,h=(0,s().IS)((()=>({container:{display:"flex",alignItems:"flex-start",position:"relative",zIndex:1},body:{transition:`opacity ${K}`,opacity:o||n?1:0,position:"absolute",right:I,top:L+(o?-3:0)+(r?0:j)}})),[o,n,r]);return t?(0,k.jsx)("div",{style:h.container,onMouseEnter:u,onMouseLeave:g,children:(0,k.jsx)("div",{style:h.body,children:(0,k.jsx)(v().hR,{notification:t,rootStore:i,onArchiveClicked:a,onUnarchiveClicked:d,onMarkAsReadClicked:l,onMarkAsUnreadClicked:c})})}):null}const z=14,N=12,D=3;function _(e){const{blockStore:t,timestamp:i,hidePageTitle:o,header:r,titleAriaId:d}=e,l=(0,n().Y0)().isMobile,c=!o,u=(0,p().nl)(i,{useUltraCompactFormat:!0}),g=(0,p().x$)(i),m=(0,s().IS)((e=>({container:{display:"flex",flexDirection:"row",minWidth:0,width:"100%",marginTop:2},headerMobile:{fontSize:z,minWidth:0},header:{display:"inline-grid",gridAutoFlow:"column",justifyContent:"space-between",fontSize:z,minWidth:0},headlineMobile:{paddingTop:2,display:"inline",whiteSpace:"pre-wrap",wordBreak:"break-word"},headline:{flexShrink:2,whiteSpace:"pre-wrap",wordBreak:"break-word"},time:{display:"flex",fontSize:N,color:e.text.tertiary,whiteSpace:"nowrap",...l&&{display:"inline"},paddingLeft:6,marginTop:z-N},headerAndPageTitle:{display:"flex",flex:1,flexDirection:"column",gap:D,minWidth:0}})),[l]);return(0,k.jsxs)("div",{style:m.container,children:[(0,k.jsxs)("div",{style:m.headerAndPageTitle,children:[(0,k.jsxs)("div",{style:l?m.headerMobile:m.header,children:[(0,k.jsx)("div",{style:l?m.headlineMobile:m.headline,className:h().k2l,id:d,children:r}),(0,k.jsx)("div",{style:m.time,className:h().Cxn,children:(0,k.jsx)(C().A,{text:u,tooltipText:g,icon:a().k})})]}),c&&(0,k.jsx)(A().i,{blockStore:t,shouldWrap:!1,underline:!0})]}),l&&(0,k.jsx)("div",{style:{width:f().UM-I,flexShrink:0}})]})}function P(e){const{timestamp:t,navigableBlockId:i,rootStore:o}=e,r=(0,n().v3)();if(t<new Date("2018-10-26").getTime())return null;const s=m().A.getIntl().formatMessage({defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),a=()=>{const e=x().Bv.createChildStore(o,{table:l().ev,id:i});u().WE({environment:r,blockStore:e,openSnapshotNearTimestamp:t.toString(),from:"activity"})};return(0,k.jsx)(y().A,{renderTooltip:()=>s,render:e=>(0,k.jsx)(b().A,{ariaLabel:s,onClick:a,icon:d().L,...e})})}function W(e){const{children:t}=e,i=(0,s().IS)((e=>({container:{borderRadius:"100%",display:"flex",flexShrink:0,justifyContent:"center",alignItems:"center",height:T,width:T,backgroundColor:e.surface.elevated,borderWidth:1,borderStyle:"solid",borderColor:e.stroke.secondary}})),[]);return(0,k.jsx)("div",{style:i.container,children:t})}const O=o.memo(B)},769617:(e,t,i)=>{i.d(t,{CS:()=>ue,_B:()=>de,gL:()=>J,m$:()=>re,v9:()=>ae});i(898992),i(354520),i(581454);var o=i(296540),n=()=>i(402014),r=()=>i(484714),s=()=>i(56366),a=()=>i(401497),d=()=>i(713998),l=()=>i(400835),c=()=>i(413267),u=()=>i(310442),g=()=>i(179034),h=()=>i(824862),m=()=>i(197959),p=()=>i(161479),v=()=>i(798880),f=()=>i(959013),x=()=>i(534177),S=()=>i(284371),b=()=>i(848259),y=()=>i(774733),C=()=>i(902731),A=()=>i(105157),k=()=>i(712030),j=()=>i(921855),M=()=>i(477293),T=()=>i(436525),w=()=>i(741737),R=()=>i(630116),B=()=>i(710648),I=()=>i(197190),L=()=>i(296798),K=()=>i(864943),U=()=>i(256863),z=()=>i(453697),N=()=>i(719147),D=()=>i(447587),_=()=>i(12296),P=()=>i(331132),W=()=>i(770176),O=()=>i(668942),H=()=>i(700348),E=()=>i(682197),F=i(474848);function V(e){const{activity:t,tabArgs:n,rootStore:a,isFirst:d,isLast:l}=e,{source:c,tab:u,notification:h}=n,p=(0,s().K8)((()=>t.getEdits()),[t]);let v=p.filter((e=>{switch(e.type){case"comment-changed":return!1;case"comment-created":case"comment-deleted":case"suggestion-created":return!0;default:(0,x().HB)(e)}}));const f=(0,s().K8)((()=>"suggestion-created"===p[0].type),[p]);0===v.length&&0!==p.length&&(v=p);const b=v.length>0,y=(0,r().v3)(),A=(0,s().K8)((()=>{const e=a.getRecordStore(a,{table:m().$Y,id:t.discussion_id,spaceId:t.space_id});if(e.isDefined())return e}),[t,a]),k=(0,s().K8)((()=>A?A.getCommentStores():[]),[A]),j=(0,s().K8)((()=>{const e=null==A?void 0:A.getParentPointer();if(e)return R().Bv.createChildStore(a,e)}),[A,a]),T=(0,s().K8)((()=>Boolean(j&&j.isDefined())),[j]),w="on"===(0,M().r)("inbox_activity_split"),B=(0,s().K8)((()=>{const e=null==j?void 0:j.getNavigableBlockStore();return(null==e?void 0:e.id)||t.navigable_block_id}),[t,j]),I=R().Bv.createChildStore(a,{table:g().ev,id:B}),L=(0,s().K8)((()=>I.isDefined()),[I]),K=(0,s().K8)((()=>Boolean(!(null!=j&&j.pathIsDead()))),[j]),U=(0,s().K8)((()=>I.canComment()&&K&&!w),[K,I,w]),z=(0,s().K8)((()=>{var e;if(j)return null===(e=j.getModel())||void 0===e?void 0:e.getRenderUrl({getRecordModel:a.getRecordModel,discussionId:t.discussion_id,pageVisitSource:i(584262).y8.Notification})}),[j,a,t]),N=(0,s().K8)((()=>(0,W().Ln)({edits:v,rootStore:a})),[v,a]),D=(0,s().K8)((()=>(0,i(496603).hS)(k.map((e=>e.getCreatedByPointer())).filter(x().O9),"id").map((e=>R().sk.createChildStore(a,e)))),[k,a]),P=(0,s().K8)((()=>D.map((e=>e.getModel())).filter(x().O9)),[D]),{backActorStore:O,frontActorStore:E}=(0,s().K8)((()=>{const e=y.currentUser.id;return e?(0,W()._S)({authorStores:D,currentUserId:e}):{backActorStore:void 0,frontActorStore:void 0}}),[y.currentUser.id,D]),V=K,$=(0,o.useCallback)((e=>{if((0,_().uY)({...n,environment:y,activity:t,mightCloseTab:V}),!K&&j&&A){var i;const o=e.target;C().IX({environment:y,discussionStore:A,rect:o.getBoundingClientRect(),blockStore:j,discussionLocation:J({forReplyMenu:!0,source:n.source}),activityId:t.id,notificationId:null===(i=n.notification)||void 0===i?void 0:i.id})}}),[t,K,j,A,y,n,V]),Z=(0,o.useCallback)((e=>{"Removed"===e?(0,_().jv)({...n,environment:y,activity:t,mightCloseTab:V}):"Added"===e?(0,_().P)({...n,environment:y,activity:t,mightCloseTab:V}):(0,x().HB)(e)}),[n,y,t,V]),Q=(0,s().K8)((()=>(0,W().DU)({recordId:B,recordType:g().ev,tab:u,rootStore:a,environment:y})),[B,u,a,y]),ee=(0,s().K8)((()=>J({source:c,forReplyMenu:!1})),[c]),te=(0,s().K8)((()=>{const e=null==A?void 0:A.getModel();if(e)return(0,W().pN)(e)}),[A]);return b&&L&&T&&A?(0,F.jsxs)(H().Ay,{header:(0,F.jsx)(q,{authorCount:N.length,authorPhrase:(0,F.jsx)(de,{authorsLength:D.length,frontActorStore:E,backActorStore:O,authorTextStyle:{fontWeight:S().Wy.medium}}),isSuggestionCreatedActivity:f}),isFirst:d,isLast:l,isPrivate:Q,rootStore:a,navigableBlockId:B,notification:h,icon:E&&O?(0,F.jsx)(ae,{frontActorStore:E,backActorStore:O,spaceStore:a}):P.length>0?(0,F.jsx)(i(77179).H8,{authors:P,size:H().eQ,style:{marginTop:0,marginRight:0},showAvatarShadow:!1}):(0,F.jsx)(le,{}),showSnapshotButton:!1,url:z,...(0,_().$5)({notification:h,environment:y,tab:u,activity:t}),children:[A&&te&&(0,F.jsx)(G,{discussionStore:A,url:z,onClick:$,rootStore:a,source:c,isSuggestionCreatedActivity:f}),A&&(0,F.jsx)(oe,{discussionStore:A,discussionLocation:ee,onReactionToggle:Z}),U&&(0,F.jsx)(X,{activity:t,rootStore:a,tabArgs:n,isSuggestionCreatedActivity:f}),A&&(0,F.jsx)(Y,{discussionStore:A})]}):(i(857639).log({level:"warning",from:"CommentActivityNotification",type:"invalidNotificationData",data:{ids:[(null==h?void 0:h.id)??"unknown"]}}),null)}const $=8;function Y(e){const{discussionStore:t}=e,i=(0,s().K8)((()=>t.getResolved()),[t]),o=(0,a().IS)((e=>({container:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:e.text.secondary,marginTop:$},icon:{height:12,width:12}})),[]);return i?(0,F.jsxs)("div",{style:o.container,children:[(0,c().b)(o.icon),(0,F.jsx)(f().sA,{id:"activity.commentActivity.commentStatusResolved",defaultMessage:"Resolved on the page"})]}):null}function G(e){const{url:t,onClick:i,discussionStore:o,rootStore:n,isSuggestionCreatedActivity:r}=e,d=(0,a().IS)((e=>({linkbox:{display:"flex",alignItems:"center",fontSize:13,color:e.text.secondary,paddingTop:2,paddingBottom:8,marginBottom:0}})),[,]),l=(0,s().K8)((()=>o.getType()),[o]);return(0,F.jsx)(L().A,{href:t,onClick:i,innerStyle:d.linkbox,disabled:!0,children:"suggestion"===l?!r&&(0,F.jsx)(y().c4,{discussionStore:o,collapsed:!1}):(0,F.jsx)(Z,{rootStore:n,discussionStore:o})})}function Z(e){const t=(0,r().v3)(),i=(0,a().DP)(),{rootStore:o,discussionStore:n}=e,l=(0,s().K8)((()=>{const e=n.getModel();if(e)return(0,W().pN)(e)}),[n]),c=(0,s().K8)((()=>{var e;const t=null==n||null===(e=n.getParentStore())||void 0===e?void 0:e.getParentStore();if(!t||"collection"!==t.table)return;const i=t.getSchema(),o=n.getPropertyId();return void 0!==o?(0,d()._g)({schema:i,property:o}):void 0}),[n]),u=(0,s().K8)((()=>(0,j().S5)({environment:t,textValue:l?{value:l,spaceId:o.id}:void 0,parentStore:o,disableHover:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!0,disabled:!0,highlightDiscussionId:n.id,theme:i,emojiType:(0,k().FN)(t),katex:t.KatexStore.getKatex(),formulaValueTypes:[]})),[t,l,o,n.id,i]);return l?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(P().A,{}),c&&(0,F.jsx)(A().A,{propertySchema:c}),(0,F.jsx)("div",{style:S().RC,children:u})]}):null}const Q=8;function X(e){const{activity:t,rootStore:i,tabArgs:n,isSuggestionCreatedActivity:d}=e,{source:l,notification:c,tab:u}=n,h=(0,s().K8)((()=>{const e=i.getRecordStore(i,{table:m().$Y,id:t.discussion_id,spaceId:t.space_id});if(e.isDefined())return e}),[t,i]),v=(0,r().v3)(),x=(0,s().K8)((()=>R().sk.createChildStore(i,{table:m().$Y,id:t.discussion_id,spaceId:(0,p().e)(i.pointer.spaceId)})),[t,i]),S=(0,s().K8)((()=>null==h?void 0:h.getParentId()),[h]),y=(0,o.useCallback)((e=>{if(!S)return;const o=R().Bv.createChildStore(i,{table:g().ev,id:S}),n=e.target,r=null==c?void 0:c.id;C().IX({environment:v,discussionStore:x,rect:n.getBoundingClientRect(),blockStore:o,discussionLocation:J({forReplyMenu:!0,source:l}),activityId:t.id,notificationId:r}),"notifications_tab"===l&&b().ZP({environment:v,notificationId:r,alreadyRead:Boolean(null==c?void 0:c.read),activity:t,tab:u})}),[t,x,v,c,S,i,l,u]),A=(0,a().IS)((e=>({container:{paddingTop:Q}})),[]);return!h||d?null:(0,F.jsx)("div",{style:A.container,children:(0,F.jsx)(E().g,{children:(0,F.jsx)(K().A,{size:"lg",onClick:y,children:(0,F.jsx)(f().sA,{defaultMessage:"Reply",id:"activityNotification.replyButton.label"})})})})}function J(e){const{forReplyMenu:t,source:i}=e;if("updates_sidebar"===i)return t?"reply_menu_updates_sidebar":"updates_sidebar";return`${t?"reply_menu_":"updates_menu_"}${b().jD()}`}function q(e){const{authorCount:t,authorPhrase:i,isSuggestionCreatedActivity:o}=e;return o?(0,F.jsx)(f().sA,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} suggested in} other {{authorOrAuthors} suggested in}}",values:{numberOfAuthors:t,authorOrAuthors:i},id:"activity.commentActivity.standardizedHeader.suggestion"}):(0,F.jsx)(f().sA,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented in} other {{authorOrAuthors} commented in}}",values:{numberOfAuthors:t,authorOrAuthors:i},id:"activity.commentActivity.standardizedHeader"})}const ee=2,te=10,ie=4;function oe(e){const{discussionStore:t,discussionLocation:i,onReactionToggle:d}=e,l=(0,r().v3)(),[c,u]=(0,o.useState)(!1),g=(0,s().K8)((()=>{if(!t)return[];const e=t.getCommentStores();return"suggestion"===t.getType()?e.slice(1):e}),[t]),h=g.length-ee,m=h>0,p="on"===(0,M().r)("inbox_activity_split"),v=1===g.length,x=(0,o.useCallback)((e=>{(0,n().SQ)({event:e,context:n().y$.Click,callback:()=>{u(!c),b().o1(l,{expand:!c,comments_count:g.length,discussion_id:t.id})}})}),[l,c,g.length,t.id]),S=(0,a().IS)((e=>({discussion:{display:"flex",flexDirection:"column",gap:te},expandButton:{display:"flex",justifyContent:"start",alignItems:"center",gap:14,borderRadius:6,fontSize:12,padding:6,marginLeft:-6,marginTop:ie-te,marginBottom:ie-te,color:e.text.secondary,maxWidth:"fit-content",maxHeight:26}})),[]),y=c?void 0:v?4:3;if(v){const e=g[0];return(0,F.jsx)("div",{style:S.discussion,children:(0,F.jsx)(ne,{commentStore:e,discussionStore:t,discussionLocation:i,onReactionToggle:d,maxLines:y,showAuthor:!1,onMore:x},e.id)})}if(p&&g.length>0){const e=g[g.length-1];return(0,F.jsx)("div",{style:S.discussion,children:(0,F.jsx)(ne,{commentStore:e,discussionStore:t,discussionLocation:i,onReactionToggle:d,maxLines:y,showAuthor:!1,onMore:x},e.id)})}return(0,F.jsxs)("div",{style:S.discussion,children:[g.slice(0,1).map((e=>(0,F.jsx)(ne,{commentStore:e,discussionStore:t,discussionLocation:i,onReactionToggle:d,maxLines:y,onMore:x},e.id))),m&&(0,F.jsx)(E().g,{children:(0,F.jsx)(I().A,{style:S.expandButton,onClick:x,children:c?(0,F.jsx)(f().sA,{id:"CommentGroupingActivity.discussionThread.hidePreviousRepliesCount",defaultMessage:"Hide {previousRepliesCount} {previousRepliesCount, plural, one {comment} other {comments}}",values:{previousRepliesCount:h}}):(0,F.jsx)(f().sA,{id:"CommentGroupingActivity.discussionThread.showPreviousRepliesCount",defaultMessage:"{previousRepliesCount} {previousRepliesCount, plural, one {more comment} other {more comments}}",values:{previousRepliesCount:h}})})}),c&&g.slice(1,-1).map((e=>(0,F.jsx)(ne,{commentStore:e,discussionStore:t,discussionLocation:i,onReactionToggle:d,maxLines:y,onMore:x},e.id))),g.slice(-1).map((e=>(0,F.jsx)(ne,{commentStore:e,discussionStore:t,discussionLocation:i,onReactionToggle:d,maxLines:y,onMore:x},e.id)))]})}function ne(e){const{commentStore:t,discussionStore:i,discussionLocation:n,onReactionToggle:d,maxLines:l,showAuthor:c=!0,onMore:u}=e,h=(0,r().Y0)(),[m,p]=(0,o.useState)(!1),v=(0,s().K8)((()=>{const e=t.getContent(),i=0===e.length;if(e||!i)return e.map((e=>{const i=R().sk.createChildStore(t,{table:g().ev,id:e,spaceId:t.getSpaceId()}).getValue();if(i)return(0,F.jsx)(B().Ay,{blockValue:i,rootStore:t},e)})).filter(x().O9)}),[t]),b=(0,s().K8)((()=>R().Lk.getUserVisibleReactions(t).length>0),[t]),C=(0,s().K8)((()=>t.getLastEditedTime()>t.getCreatedTime()+100),[t]),A=!b&&h.isMobile,k=!A,j=(0,o.useCallback)((e=>{h.isMobile?e.preventDefault():p(!0)}),[h.isMobile]),M=(0,o.useCallback)((e=>{h.isMobile?e.preventDefault():p(!1)}),[h.isMobile]),T=(0,a().IS)((e=>({avatarCommentReactionBarContainer:{...!b&&!h.isMobile&&{position:"relative"}},avatarAndCommentContainer:{display:"flex",flexDirection:"column"},commentContainer:{display:"flex",justifyContent:"space-between",gap:6,flexGrow:1},commentClampContainer:{lineHeight:S().K_.UIRegular.desktop,color:e.palette.gray[500]},toggleOverflowButton:{color:e.palette.gray[500],fontSize:14},editedBadge:{fontSize:13,color:e.text.secondary,paddingLeft:4},reactionBarMobile:b?{marginTop:4}:{marginRight:-6},reactionBar:{...!b&&{position:"absolute",top:-2,right:-8,opacity:m?1:0,transition:`opacity ${H().T6}`},...b&&{marginTop:4}},newReaction:{borderWidth:1,borderStyle:"solid",borderColor:h.isMobile?"transparent":e.stroke.primary,borderRadius:6,boxShadow:h.isMobile?"unset":"0px 2px 4px 0px rgba(22, 29, 27, 0.02)"}})),[h,b,m]),w=(0,o.useCallback)((e=>{e.preventDefault(),u(e)}),[u]);return(0,F.jsx)("div",{children:(0,F.jsxs)("div",{style:T.avatarCommentReactionBarContainer,onMouseEnter:j,onMouseLeave:M,children:[(0,F.jsxs)("div",{style:T.avatarAndCommentContainer,children:[c&&(0,F.jsx)("div",{children:(0,F.jsx)(re,{commentStore:t})}),(0,F.jsxs)("div",{style:T.commentContainer,dir:"auto",children:[(0,F.jsxs)(D().A,{style:T.commentClampContainer,maxLines:l,onMore:w,moreElement:(0,F.jsxs)(N().A,{style:T.toggleOverflowButton,disableUnderline:!0,hoverColor:"blue",children:["…"," ",(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{id:"commentActivityNotification.truncated.showMoreLabel",defaultMessage:"more"})})]}),children:[(0,F.jsx)(O().j,{discussionStore:i,commentStore:t}),v,C&&(0,F.jsx)("span",{style:T.editedBadge,children:(0,F.jsx)(f().sA,{id:"CommentGroupingActivity.discussionThreadComment.editedBadge",defaultMessage:"(edited)"})})]}),A&&(0,F.jsx)("div",{style:h.isMobile?T.reactionBarMobile:T.reactionBar,children:(0,F.jsx)(E().g,{children:(0,F.jsx)(y().fj,{parentStore:t,discussionLocation:n,onReactionToggle:d,newReactionStyle:T.newReaction})})})]})]}),k&&(0,F.jsx)("div",{style:h.isMobile?T.reactionBarMobile:T.reactionBar,children:(0,F.jsx)(E().g,{children:(0,F.jsx)(y().fj,{parentStore:t,discussionLocation:n,onReactionToggle:d,newReactionStyle:T.newReaction})})})]})})}function re(e){const{commentStore:t}=e,i=(0,r().v3)(),o=(0,f().tz)(),n=(0,s().K8)((()=>{const e=t.getCreatedByPointer();if(e)return R().sk.createChildStore(t,e)}),[t]),d=(0,s().K8)((()=>{if(n)return n.getDisplayName(o)}),[n,o]),l=(0,s().K8)((()=>!!n&&i.currentUser.id===n.id),[i,n]),c=(0,a().IS)((e=>({fullName:{fontWeight:S().Wy.regular,fontSize:12,lineHeight:"22px",color:e.text.secondary},you:{fontWeight:S().Wy.regular,fontSize:12,lineHeight:"22px",color:e.text.tertiary}})),[]);return l?(0,F.jsx)(f().sA,{id:"CommentGroupingActivity.discussionThreadComment.authorLabel",defaultMessage:"<author>{fullName}</author> <you>(You)</you>",values:{author:e=>(0,F.jsx)("span",{style:c.fullName,children:e}),fullName:d,you:e=>(0,F.jsx)("span",{style:c.you,children:e})}}):d?(0,F.jsx)("span",{style:c.fullName,children:d}):(0,F.jsx)("span",{style:c.fullName,children:(0,F.jsx)(f().sA,{id:"CommentGroupingActivity.discussionThreadComment.unknownAuthorLabel",defaultMessage:"Unknown author"})})}const se=20;function ae(e){const{frontActorStore:t,backActorStore:i,spaceStore:o}=e,n=(0,a().IS)((()=>({container:{display:"grid",height:H().eQ,width:H().eQ},back:{gridColumn:1,gridRow:1,marginLeft:-3,marginTop:-3,maxWidth:se,minWidth:se},front:{gridColumn:1,gridRow:1,marginLeft:7,marginTop:7,maxWidth:se,minWidth:se}})),[]);return(0,F.jsxs)("div",{style:n.container,children:[(0,F.jsx)("div",{style:n.back,children:(0,F.jsx)(ce,{size:se,actorStore:i,spaceStore:o,avatar:void 0})}),(0,F.jsx)("div",{style:n.front,children:(0,F.jsx)(ce,{size:se,actorStore:t,spaceStore:o,avatar:void 0})})]})}function de(e){const{authorsLength:t,frontActorStore:i,backActorStore:o,authorTextStyle:n}=e,a=(0,r().v3)(),d=(0,f().tz)(),l=a.currentUser.id,c=(0,s().K8)((()=>{if(i)return i.getDisplayName(d)}),[i,d]),u=(0,s().K8)((()=>{if(o)return o.getDisplayName(d)}),[o,d]),g={fontWeight:S().Wy.semibold,...n};return 0===t?(0,F.jsx)("span",{style:g,children:(0,F.jsx)(f().sA,{defaultMessage:"<b>Nobody</b>",id:"activitySection.authorPhraseInboxRedesign.forNoAuthors.label",values:{b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):1===t&&i?i.id===l?(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{defaultMessage:"<b>You</b>",id:"activitySection.authorPhraseInboxRedesign.forOneAuthorCurrentUser.label",values:{b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{defaultMessage:"<b>{author}</b>",id:"activitySection.authorPhraseInboxRedesign.forOneAuthor.label",values:{author:c,b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):2===t?o&&o.id===l?(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{defaultMessage:"<b>{frontActorName} and You</b>",id:"activitySection.authorPhraseInboxRedesign.forTwoAuthorsCurrentUser.label",values:{frontActorName:c,b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{defaultMessage:"<b>{frontActorName} and {backActorName}</b>",id:"activitySection.authorPhraseInboxRedesign.forTwoAuthors.label",values:{frontActorName:c,backActorName:u,b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):t>2?(0,F.jsx)("span",{children:(0,F.jsx)(f().sA,{defaultMessage:"<b>{frontActorName} and {numberOfOtherAuthors} others</b>",id:"activitySection.authorPhraseInboxRedesign.forMoreThanTwoAuthors.label",values:{frontActorName:c,numberOfOtherAuthors:t-1,b:e=>(0,F.jsx)("span",{style:g,children:e})}})}):null}function le(){const e=(0,a().IS)((e=>({icon:{height:14,width:14,fill:e.icon.secondary}})),[]);return(0,F.jsx)(H().rL,{children:(0,l().D)(e.icon)})}function ce(e){const{actorStore:t,spaceStore:i,avatar:o}=e,n=e.size??28,r=t instanceof R().LU?t:void 0,s=(0,w().c)({spaceStore:i,viewedUserStore:r});return t?t.table===h().GP?(0,F.jsx)(U().A,{botStore:t,size:n}):t.table===v().oo?s&&r?(0,F.jsx)(T().D,{userStore:r,children:(0,F.jsx)(z().A,{userStore:t,size:n})}):(0,F.jsx)(z().A,{userStore:t,size:n}):t.table===u().yj?(0,F.jsx)(z().A,{userStore:void 0,size:n}):void(0,x().HB)(t):o?(0,F.jsx)(z().A,{avatar:o,size:n}):(0,F.jsx)(z().A,{userStore:void 0,size:n})}const ue=o.memo(V)},870923:(e,t,i)=>{i.d(t,{i:()=>f});var o=i(296540),n=()=>i(56366),r=()=>i(401497),s=()=>i(496603),a=()=>i(284371),d=()=>i(728611),l=()=>i(553965),c=()=>i(962730),u=()=>i(187820),g=()=>i(16006),h=()=>i(859428),m=()=>i(791194),p=()=>i(682197),v=i(474848);function f(e){const{blockStore:t,shouldWrap:i=!1,underline:f=!0}=e,[x,S]=(0,o.useState)(!1),[b,y]=(0,o.useState)(!1),C=s().nF((()=>{y(!0)}),200,{leading:!0});(0,o.useEffect)((()=>(d().P4(window,"scroll",C,!0),()=>d().Ol(window,"scroll",C,!0))),[C]);const A=(0,n().K8)((()=>{var e;return null==t||null===(e=t.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:t.getRecordModel})}),[t]),k=(0,o.useCallback)((()=>{S(!0),y(!1)}),[]),j=(0,o.useCallback)((()=>{S(!1),y(!1),d().Ol(window,"scroll",C,!0)}),[C]),M=(0,o.useCallback)((e=>(0,v.jsx)(m().yf,{store:t,events:e})),[t]),T=(0,n().K8)((()=>!!t&&t.isEmptyPage()),[t]),w=(0,n().K8)((()=>(0,u().Te)(t)),[t]),R=(0,n().K8)((()=>null==t?void 0:t.isDefined()),[t]),B=(0,r().IS)((e=>({pageTitleMockedButton:{maxWidth:"fit-content",display:"inline",borderRadius:4,paddingLeft:3,paddingRight:5,marginTop:-2,marginBottom:-2,marginLeft:-2.5,marginRight:-5,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:x&&R?e.state.hover:void 0},recordTitle:{fontSize:14,fontWeight:a().Wy.medium,paddingBottom:1,whiteSpace:i?"break-spaces":"nowrap"},recordIcon:{whiteSpace:"nowrap",display:"inline-block",verticalAlign:Boolean(A)?"text-top":"sub",marginRight:3}})),[x,R,i,A]);if(!t)return null;const I=!0!==b&&void 0;return(0,v.jsx)(p().g,{disabled:!R,children:(0,v.jsx)(h().A,{originGap:3,disableTooltip:!R,alignment:c().C.Start,placement:c().W.Bottom,renderTooltip:M,closeDelay:0,noStyle:!0,textWrap:!0,forceVisibleState:I,render:e=>(0,v.jsxs)("div",{style:B.pageTitleMockedButton,...(0,l().A)(e,{onMouseEnter:k,onMouseLeave:j}),children:[(0,v.jsx)(u().B6,{disabled:!0,icon:A,iconRecordCategory:w,isEmptyPage:T,size:16,style:B.recordIcon}),(0,v.jsx)(g().A,{store:t,style:B.recordTitle,underline:f,shouldWrap:!0})]})})})}}}]);