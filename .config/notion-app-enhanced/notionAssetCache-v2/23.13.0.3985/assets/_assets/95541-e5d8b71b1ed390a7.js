"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[95541],{100594:(e,t,o)=>{o.d(t,{CN:()=>k,D0:()=>h,D5:()=>R,GL:()=>m,HI:()=>g,I9:()=>f,JQ:()=>C,JW:()=>D,PC:()=>_,Rb:()=>x,SK:()=>F,UK:()=>q,VY:()=>p,YU:()=>w,Yp:()=>B,_x:()=>b,bg:()=>d,fn:()=>T,i8:()=>L,kq:()=>s,q_:()=>G,sh:()=>y,tG:()=>v,xS:()=>P,zn:()=>V});var r=()=>o(534177),n=()=>o(708685),a=()=>o(921598),i=()=>o(970013),l=()=>o(713998),u=()=>o(499755),c=()=>o(901610);const p=["gray","blue","yellow","green","purple","teal","orange","pink","red"],s=["auto","colorful"],g=[...p,...s];let d=function(e){return e.small="small",e.medium="medium",e.large="large",e.extra_large="extra_large",e}({});function y(e){switch(e){case d.small:return 300;case d.medium:return 400;case d.large:return 600;case d.extra_large:return 800;default:(0,r().HB)(e)}}function f(e){switch(e){case d.small:return 150;case d.medium:return 250;case d.large:return 300;case d.extra_large:return 400;default:(0,r().HB)(e)}}let m=function(e){return e.avatar="avatar",e.avatar_name="avatar_name",e.name="name",e}({}),v=function(e){return e.none="none",e.x_axis="x_axis",e.y_axis="y_axis",e.both="both",e}({}),C=function(e){return e.none="none",e.horizontal="horizontal",e.vertical="vertical",e.both="both",e}({}),_=function(e){return e.normal="normal",e.percent="percent",e.side_by_side="side_by_side",e}({}),h=function(e){return e.none="none",e.value="value",e.name="name",e.name_and_value="name_and_value",e}({});function S(e){if(!e)return!1;return a().BI.includes(e)}function B(e){const t=(0,n().getFormulaPropertySchemaBaseResultType)(e);return"text"===t||"number"===t||"checkbox"===t||"person"===t||"date"===t}function w(e,t){var o,n;let i,c=e.chartFormat;if("groups_reducer"===e.dataConfig.type){var p;const{chartFormat:o,chartGroupByFormat:r}=function(e,t,o,r){const n=(0,l()._g)({schema:r,property:e.property});if(n&&"donut"===o&&(0,u().e0)(n)){const o=(0,a().MP)(e);return{chartFormat:{...t,mainSort:u().S0.yDescending},chartGroupByFormat:o}}return{chartFormat:t,chartGroupByFormat:e}}(null==e||null===(p=e.dataConfig)||void 0===p?void 0:p.groupBy,null==e?void 0:e.chartFormat,"donut",t);c=o,i={...e.dataConfig,groupBy:r,aggregationConfig:{aggregation:e.dataConfig.aggregationConfig.aggregation}}}else"results_reducer"===e.dataConfig.type?(i=e.dataConfig,c={...c,mainSort:u().S0.yDescending}):(0,r().HB)(e.dataConfig);G(e)&&c&&(void 0===(null===(o=c)||void 0===o?void 0:o.donutDataLabels)||(null===(n=c)||void 0===n?void 0:n.donutDataLabels)===h.none)?c.donutDataLabels=h.value:!G(e)&&c&&(c.donutDataLabels=h.none);const s={...e,type:"donut",dataConfig:i};return c&&(s.chartFormat=c),s}function b(e,t){let o;"groups_reducer"===e.dataConfig.type?o={...e.dataConfig,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t},stackOptions:void 0}}:"results_reducer"===e.dataConfig.type?o={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,r().HB)(e.dataConfig);const n=e.chartFormat;return n&&n.donutDataLabels&&n.donutDataLabels!==h.none?n.axisShowDataLabels=!0:!n||n.donutDataLabels!==h.none&&void 0!==n.donutDataLabels||(n.axisShowDataLabels=!1),{...e,type:t,dataConfig:o}}function F(e,t){let o;if("groups_reducer"===e.dataConfig.type){var n;const r=null==e||null===(n=e.dataConfig)||void 0===n?void 0:n.groupBy;o={...e.dataConfig,groupBy:r,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t}}}}else"results_reducer"===e.dataConfig.type?o={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,r().HB)(e.dataConfig);return{...e,type:t,dataConfig:o}}const x={main:u().S0.xAscending,stacked:u().S0.manual};function k(e){let{chartConfig:t,xAxisPropertyId:o,newDataConfigType:n,groupBy:a,aggregation:i,valueProperty:l}=e;const c="groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.seriesFormat:t.dataConfig.valueSeriesFormat;"groups_reducer"===n?t.dataConfig={type:"groups_reducer",groupBy:a,aggregationConfig:{aggregation:i,seriesFormat:c,stackOptions:"groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.stackOptions:void 0}}:"results_reducer"===n?t.dataConfig={type:"results_reducer",nameProperty:o,valueProperty:l,valueSeriesFormat:c}:(0,r().HB)(n);const p="formula"===a.type?a.groupBy.sort:a.sort;return t.chartFormat={...t.chartFormat,mainSort:(0,u().gN)(p)},t}function P(e){let{property:t,propertySchema:o,groupByOption:r,hideEmptyGroups:i}=e;const l=o.type;if((0,a().Eg)(o)){if((0,a()._o)(l)){if(r&&S(r))return{type:l,property:t,groupBy:r,sort:{type:"ascending"}}}else{if((0,a().KI)(l)||"select"===l||"multi_select"===l)return{type:l,property:t,sort:{type:"ascending"}};if((0,a().iF)(l)){if(r&&((u=r)&&a().PC.includes(u)))return{type:l,property:t,groupBy:r,sort:{type:"ascending"}}}else{if("number"===l)return{type:l,property:t,groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}};if("formula"===l){const e=(0,n().getFormulaPropertySchemaResultType)(o);if("number"===e)return{type:"formula",property:t,groupBy:{type:"number",groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}}};if("date"===e&&S(r))return{type:"formula",property:t,groupBy:{type:"date",groupBy:r,sort:{type:"ascending"}}}}else if("person"===l)return{type:l,property:t,sort:{type:"manual"}}}}var u;return(0,a().V0)({property:t,propertySchema:o,hideEmptyGroups:i})}}function D(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().AM)(e)||"number"===t}function V(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,a()._o)(e.type)||"date"===t}function T(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().JY)(e)||"person"===t}function L(e){if("formula"===e.type){const t=(0,n().getFormulaPropertySchemaResultType)(e);return(0,a()._o)(t)}return(0,a()._o)(e.type)}function q(e){return"text"===e||"number"===e||"person"===e||"date"===e}function R(e){var t;return!(!e||!(0,c().m)(e))&&("groups_reducer"!==e.dataConfig.type||!e.dataConfig.aggregationConfig.stackOptions||"percent"!==(null===(t=e.chartFormat)||void 0===t?void 0:t.axisGroupStyle))}function G(e){return!!R(e)&&(!(!e||!(0,c().m)(e))&&(void 0===(null===(t=e.chartFormat)||void 0===t?void 0:t.axisShowDataLabels)||(null===(o=e.chartFormat)||void 0===o?void 0:o.axisShowDataLabels)));var t,o}},732038:(e,t,o)=>{o.d(t,{Sp:()=>w,sw:()=>b,Iz:()=>F});var r=()=>o(402014),n=()=>o(584262),a=()=>o(713998),i=()=>o(750660),l=()=>o(2220),u=()=>o(467676),c=()=>o(681445),p=()=>o(476492),s=(o(898992),o(354520),()=>o(901610)),g=()=>o(592269),d=()=>o(289915),y=()=>o(857639),f=()=>o(416504),m=()=>o(498212),v=()=>o(274375);var C=()=>o(374136),_=()=>o(492414),h=()=>o(630116),S=()=>o(246826),B=()=>o(435009);function w(e){const{chartConfig:t,collectionViewBlockStore:o,format:n,dataPoint:i,clickEvent:u,schema:_,environment:h,collectionContextStore:S,intl:B,query2:w,temporaryViewState:b}=e;if(!o||"groups_reducer"!==(null==t?void 0:t.dataConfig.type))return;(0,r().SQ)({event:u,context:r().y$.Click});const F=function(e){const{dataPoint:t,propertySchema:o,groupByFormat:r,aggregation:n,intl:a}=e,i=t.name??t.x.toString();if(!o)return i;return(0,C().w$)({propertySchema:o,groupByFormat:r,aggregation:n,highChartsLabel:i,intl:a})}({dataPoint:i,propertySchema:(0,a()._g)({schema:_,property:t.dataConfig.groupBy.property}),groupByFormat:null==t?void 0:t.dataConfig.groupBy,aggregation:null==t?void 0:t.dataConfig.aggregationConfig.aggregation,intl:B}),x=function(e){var t,o;const{chartConfig:r,dataPoint:n,format:a,schema:i,collectionViewBlockStore:l,query2:u,temporaryViewState:c}=e;if(!(r&&"placeholder"!==r.type&&"results_reducer"!==r.dataConfig.type&&r.dataConfig.groupBy&&n&&l&&l.pointer.spaceId))return void y().log({level:"error",from:"chartDrilldownHelpers",type:"chartDrilldownMissingRequiredData",error:{name:"chartDrilldownHelpers",message:"Unexpected error"},data:{miscDataToConvertToString:{chartConfig:r,dataPoint:n,collectionViewBlockStore:l}}});const p=r.dataConfig.groupBy.property,C=(0,v().Q)(l,p),_={type:"table",parent_id:l.pointer.id,parent_table:l.pointer.table,alive:!0,space_id:l.pointer.spaceId,format:{is_unlisted:!0,collection_pointer:null==a?void 0:a.collection_pointer,property_filters:(null==c||null===(t=c.propertyFilters)||void 0===t?void 0:t.value)??(null==a?void 0:a.property_filters),table_properties:C},query2:{...u,filter:(null==c||null===(o=c.combinatorFilter)||void 0===o?void 0:o.value)??(null==u?void 0:u.filter)}};let h;var S;return n.groupFormat&&(h=(0,g().K8)({schema:i,propertyMapping:void 0,groupBy:r.dataConfig.groupBy,group:n.groupFormat,timeZone:(0,f().P)()})),h&&((0,d().dU)(h)?null!==(S=_.query2)&&void 0!==S&&S.filter?_.query2.filter=(0,d().GV)([_.query2.filter,h]):_.query2.filter=h:(0,d().yX)(h)&&(_.format.property_filters=[..._.format.property_filters??[],{filter:h,id:(0,m().Ay)()}])),"groups_reducer"===r.dataConfig.type&&(0,s().m)(r)&&r.dataConfig.aggregationConfig.stackOptions&&(_.format.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;const o=e.aggregationConfig.stackOptions.groupBy;return o.hideEmptyGroups=!0,o}(r.dataConfig)),_}({chartConfig:t,format:n,dataPoint:i,schema:_,collectionViewBlockStore:o,query2:w,temporaryViewState:b});if(!x)return;const k=(0,p().sl)(S);(0,l().u)({environment:h,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...k,drilldown_type:"grouped",from:"chart_data_point"}}}),c().S.openCollectionDrilldownView({collectionViewValue:x,collectionViewBlockStore:o,viewsModuleContext:S.viewsModuleContextStore.state,title:F})}function b(e){var t;const{collectionStore:o,dataPoint:a,clickEvent:i,environment:u,collectionContextStore:c}=e;if(null==a||null===(t=a.pagePointer)||void 0===t||!t.id||!o)return;(0,r().SQ)({event:i,context:r().y$.Click});const s=h().Bv.createChildStore(o,a.pagePointer),g=(0,_().Ay)({store:s,fullyQualified:!1,pageVisitSource:n().y8.Expand,showMoveTo:!1,openInCenterPeek:!0});if(!g)return;const d=(0,p().sl)(c);(0,l().u)({environment:u,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...d,drilldown_type:"results",from:"chart_data_point"}}}),B().oo({environment:u,url:g})}async function F(e){const{environment:t,collectionViewStore:o,collectionViewBlockStore:r,collectionContextStore:n,acceptMoveToArgs:a,transaction:c,intl:s}=e;if(!o)return;const g=r.getCollectionPointer(),d=S().Wv({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,type:"collection_view",transaction:c}),y=(0,u().t)({environment:t,transaction:c,collectionViewStore:o,collectionViewBlockStore:d,intl:s,copyNameExactly:!0});if(!y)return;y.getFormatStore().getKeyValue("collection_pointer")||S().zv({store:y.getFormatStore().getKeyStore("collection_pointer"),data:g,transaction:c}),S().zv({store:y.getFormatStore(),data:{is_unlisted:null},transaction:c}),await i().Ju({...a,targetBlocks:[d],transaction:c});const f=(0,p().sl)(n);return(0,l().u)({environment:t,event:{eventName:"collection_chart_drilldown_save",eventProperties:{...f,new_collection_view_block_id:d.pointer.id}}}),d}}}]);