"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[45758],{146828:(e,t,r)=>{r.r(t),r.d(t,{LinkPreviewLab:()=>F,default:()=>D});r(581454);var s=r(296540),i=()=>r(484714),n=()=>r(56366),o=()=>r(401497),a=()=>r(725252),l=()=>r(412532),d=()=>r(668725),u=()=>r(388693),g=()=>r(345404),c=()=>r(919709),p=()=>r(506391),x=()=>r(959013),v=()=>r(534177),h=()=>r(284371),j=()=>r(671593),b=()=>r(739095),m=()=>r(939482),y=()=>r(722872),f=()=>r(124749),A=()=>r(463830),S=()=>r(53137),w=()=>r(555267),T=()=>r(704152),I=()=>r(760217),R=()=>r(406699),k=()=>r(623580),M=()=>r(928600),U=()=>r(939740),P=()=>r(554509),E=()=>r(864943),L=()=>r(89924),C=()=>r(447887),B=()=>r(361873),W=()=>r(791194),z=()=>r(718725),_=()=>r(339600),O=r(474848);function D(e){const{integrationPointer:t}=e,r=(0,f().$)(),s=(0,n().K8)((()=>{if(r)return r.getRecordValue(t)}),[r,t]),i=(0,a().L)({value:s,waitTimeInMs:5e3}),l=(0,o().IS)((()=>({header:{marginBottom:24}})),[]);return"pending"===i.status?(0,O.jsx)(w().A,{}):"rejected"!==i.status&&(0,u().v_)(i.value)?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{style:l.header,children:[(0,O.jsx)(P().D,{styleName:"UITitle-30px/Semibold",children:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.title.label",defaultMessage:"Link Preview Lab"})}),(0,O.jsx)(P().D,{styleName:"Heading-17px/Regular",children:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.subtitle.label",defaultMessage:"Plan out preview URL regex patterns and API responses."})})]}),(0,O.jsx)(F,{starterIntegration:i.value})]}):(0,O.jsx)(C().A,{})}function F(e){let{starterIntegration:t}=e;const[r,i]=s.useState(""),[n,o]=s.useState(m().j9),[a,l]=s.useState(m().AC),[d,u]=s.useState(m().AW()),[g,c]=s.useState(m().es),[x,v]=s.useState(m().uL),[h,j]=s.useState(m().ky),[b,y]=s.useState(t);return s.useEffect((()=>{const{original_url_domains:e,development_url_domains:r,original_url_patterns:s}=t.info,i=(null==e?void 0:e[0])||(null==r?void 0:r[0]);if(i&&c(i),null!=s&&s[0]){const{regex:e,attributes:t,sample_urls:r}=null==s?void 0:s[0];v(e);const i=t.map(p().mW);j(i);const n=null==r?void 0:r[0];n&&o(n)}}),[t]),s.useEffect((()=>{y((e=>m().aZ({domain:g,regex:x,attributes:h,currentIntegration:e})))}),[g,x,h]),s.useEffect((()=>{S().A.setState({loaded:!0,loading:!1,userId:void 0,spaceId:m().B3,integrations:[b],externalAuthentications:[],bots:[],completeSlackAuthentications:[],twoWaySyncExternalEntities:[]})}),[b]),(0,O.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,O.jsx)(N,{style:{flex:1,marginRight:12},setErrorMessage:i,rootUrl:n,setRootUrl:o,relatedUrisToAttributes:d,setRelatedUrisToAttributes:u,domain:g,setDomain:c,regexPattern:x,setRegexPattern:v,regexAttributes:h,setRegexAttributes:j,rootAttributes:a,setRootAttributes:l}),(0,O.jsx)(V,{style:{flex:1},rootUrl:n,rootAttributes:a,relatedUrisToAttributes:d,integration:b,errorMessage:r})]})}function N(e){const{style:t,rootUrl:r,setRootUrl:s,domain:i,setDomain:o,regexPattern:a,setRegexPattern:l,regexAttributes:d,setRegexAttributes:u,rootAttributes:c,setRootAttributes:p,relatedUrisToAttributes:v,setRelatedUrisToAttributes:j,setErrorMessage:b}=e,y=(0,n().K8)((()=>m().O2(c)),[c]);return(0,O.jsxs)("div",{style:t,children:[(0,O.jsxs)("label",{children:[(0,O.jsx)("div",{style:{fontSize:15,fontWeight:h().Wy.medium},children:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.rootUrl.label",defaultMessage:"Pasted URL to Preview"})}),(0,O.jsx)(k().A,{value:r,onChange:e=>s(e.target.value)})]}),(0,O.jsxs)($,{title:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.regexConfiguration.label",defaultMessage:"Manage Regex Configuration"}),style:{marginTop:12},children:[(0,O.jsxs)("label",{style:{marginTop:12},children:[(0,O.jsx)("div",{style:{fontSize:15,fontWeight:h().Wy.medium},children:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.domain.label",defaultMessage:"Domain"})}),(0,O.jsx)(k().A,{value:i,onChange:e=>o(e.target.value)})]}),(0,O.jsx)(J,{regexPattern:a,setRegexPattern:l,setErrorMessage:b}),(0,O.jsxs)("label",{style:{marginTop:12},children:[(0,O.jsx)("div",{style:{fontSize:15,fontWeight:h().Wy.medium},children:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.regexAttributes.label",defaultMessage:"Regex Attributes"})}),(0,O.jsx)(q,{value:d,onChange:u,validationType:g().kE,setErrorMessage:b})]})]}),(0,O.jsx)($,{title:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.rootAttributes.label",defaultMessage:"Unfurl response payload"}),style:{marginTop:12},children:(0,O.jsx)(q,{value:c,onChange:p,validationType:g().kE,setErrorMessage:b})}),(0,O.jsx)($,{title:(0,O.jsx)(x().sA,{id:"developerIntegrationLab.relatedAttributes.label",defaultMessage:"Related unfurl response payloads"}),style:{marginTop:12},children:y.map((e=>{const t=v[e];return(0,O.jsx)($,{title:e,style:{marginTop:12,marginLeft:12},children:t?(0,O.jsx)(q,{value:t,onChange:t=>{j({...v,[e]:t})},validationType:g().kE,setErrorMessage:b}):(0,O.jsx)(x().sA,{id:"developerIntegrationLab.relatedAttributes.empty",defaultMessage:"No related attributes found."})},e)}))})]})}const H=["preview","mention","hover"],K=["authenticate","error","update","loaded"];function V(e){const{style:t,rootUrl:r,rootAttributes:i,relatedUrisToAttributes:n,integration:o,errorMessage:a}=e,[l,d]=s.useState("preview"),[u,g]=s.useState("loaded");return(0,O.jsxs)("div",{style:t,children:[(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,O.jsx)("div",{style:{marginRight:12},children:"Preview type:"}),(0,O.jsx)(Z,{title:l,options:H,onSelectOption:e=>d(e)}),(0,O.jsx)("div",{style:{marginLeft:12,marginRight:12},children:"Preview state:"}),(0,O.jsx)(Z,{title:u,options:K,onSelectOption:e=>g(e)})]}),(0,O.jsx)("div",{style:{marginTop:12,maxWidth:600},children:(0,O.jsx)(G,{previewType:l,previewState:u,rootUrl:r,rootAttributes:i,relatedUrisToAttributes:n,integration:o,errorMessage:a})})]})}function $(e){const[t,r]=s.useState(!1);return(0,O.jsxs)("div",{style:e.style,children:[(0,O.jsxs)(T().A,{onClick:()=>r(!t),style:{display:"flex",alignItems:"center"},children:[(0,l().l)({width:"0.8em",height:"0.8em",transition:"transform 200ms ease-out",transform:`rotateZ(${t?180:90}deg)`,marginRight:4}),e.title]}),t?e.children:void 0]})}function q(e){const{value:t,onChange:r,validationType:i,setErrorMessage:n}=e,[o,a]=s.useState(JSON.stringify(t,null,2));return(0,O.jsx)(k().A,{format:k().C.ExtraLarge,inputStyle:{fontSize:14,lineHeight:"18px",height:500},textarea:!0,value:o,onChange:e=>{const t=e.target.value;a(t);const s=b().VU(t);if(void 0===s)n("Could not parse JSON object input.");else{const e=(0,j().tf)(i,s);e?n(e.message):(n(""),r(s))}}})}function J(e){const{regexPattern:t,setRegexPattern:r,setErrorMessage:i}=e,[n,o]=s.useState(t);return(0,O.jsxs)("label",{style:{marginTop:12},children:[(0,O.jsx)("div",{style:{fontSize:15,fontWeight:h().Wy.medium},children:"Regex Pattern"}),(0,O.jsx)(k().A,{value:n,onChange:e=>{const t=e.target.value;o(t);try{new RegExp(t);r(t),i("")}catch(s){i("Invalid Regex.")}}})]})}function Z(e){const{title:t,options:r,onSelectOption:s}=e,[i,o,a]=(0,n().$y)(void 0,A().A);return(0,O.jsx)(R().Ay,{popupType:R().z7.Popup,buttonPopupStore:a,renderOrigin:()=>(0,O.jsxs)(E().A,{size:"lg",onClick:()=>o({...i,open:!0}),children:[t,(0,d().b)({width:10,marginTop:4,marginLeft:4})]}),render:()=>(0,O.jsx)(M().A,{menuType:y().gu.Popup,children:(0,O.jsx)(U().Ay,{type:U().Oh.Vertical,sections:[{key:t,items:r.map((e=>({key:e,action:()=>{s(e),o({...i,open:!1})},render:t=>(0,O.jsx)(I().A,{...t,title:e})}))),render:e=>(0,O.jsx)(L().A,{...e})}],initialFocus:void 0})})})}function G(e){const{previewType:t,previewState:r,rootUrl:n,rootAttributes:a,relatedUrisToAttributes:l,integration:d,errorMessage:u}=e,[g,c]=s.useState(""),p=(0,i().v3)(),[x,v]=s.useState();s.useEffect((()=>{const e=m().Ie({environment:p,rootUrl:n,rootAttributes:a,relatedUrisToAttributes:l,integration:d});"error"in e?c(e.error):(c(""),v(e))}),[p,n,a,l,d]),s.useEffect((()=>{c(u)}),[u]);const h=(0,o().IS)((e=>({error:{marginTop:12,marginBottom:12,padding:"12px 24px",marginRight:"auto",backgroundColor:e.palette.red[100]}})),[]);return(0,O.jsxs)(O.Fragment,{children:[g?(0,O.jsxs)("div",{style:h.error,children:[g," "]}):void 0,x?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(_().qT,{isInverted:!1,showInsets:!1,showSize:!1,children:(0,O.jsx)(X,{previewType:t,previewState:r,previewStores:x})}),(0,O.jsx)(_().qT,{isInverted:!0,showInsets:!1,showSize:!1,children:(0,O.jsx)(X,{previewType:t,previewState:r,previewStores:x})})]}):void 0]})}function Q(e){const{previewStores:t}=e,r=(0,o().IS)((e=>({container:{borderRadius:6,boxShadow:e.shadowSM}})),[]),s=(0,n().K8)((()=>{const e=t.previewBlockStore.id;if(!e)return;return{annotation:(0,c().bMp)(e),store:t.inlineBlockStore,token:void 0}}),[t.previewBlockStore,t.inlineBlockStore]);return s?(0,O.jsx)("div",{style:r.container,children:(0,O.jsx)(W().zP,{isHoveredTokenEditable:!0,state:s})}):null}function X(e){const{previewType:t,previewState:r,previewStores:s}=e;return"preview"===t?(0,O.jsx)(B().A,{store:"authenticate"===r?s.emptyInstanceBlockStore:s.previewBlockStore,disabled:!1,forceActionForUIDoc:"loaded"===r?void 0:r}):"mention"===t?(0,O.jsx)(z().A,{store:"authenticate"===r?s.emptyInlineBlockStore:s.inlineBlockStore,disabled:!1}):"hover"===t?(0,O.jsx)(Q,{...e}):void(0,v().HB)(t)}}}]);