"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[93449],{15897:(e,t,i)=>{i.d(t,{A:()=>u});i(581454),i(296540);var n=()=>i(401497),s=()=>i(962730),r=()=>i(704152),o=()=>i(859428),a=i(474848);function l(e){const{isFirst:t,isLast:i,isSelected:l,item:u,itemStyle:d,selectedItemStyle:c,innerStyle:p,children:m,colors:g,onClick:v}=e,{isDisabled:h,tooltip:y}=u,f=(0,n().IS)((e=>{const n=(null==g?void 0:g.selectedOutline)??e.blueColor,s=(null==g?void 0:g.unselectedOutline)??e.selectorBorderUnselected;return{SegmentedItem:{alignItems:"center",background:l?null==g?void 0:g.selectedBackground:void 0,borderBottomLeftRadius:t?3:0,borderBottomRightRadius:i?3:0,borderColor:l?n:s,borderStyle:"solid",borderTopLeftRadius:t?3:0,borderTopRightRadius:i?3:0,borderWidth:1,cursor:h?void 0:"pointer",display:"flex",flexBasis:"50%",marginLeft:t?0:-1,padding:0,userSelect:"none",zIndex:l?10:0,...d,...l?c:void 0},Inner:{borderBottomLeftRadius:t?2:0,borderBottomRightRadius:i?2:0,borderColor:l?n:"transparent",borderStyle:"solid",borderTopLeftRadius:t?2:0,borderTopRightRadius:i?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"12px 20px",textAlign:"center",width:"100%",...p}}}),[null==g?void 0:g.selectedBackground,null==g?void 0:g.selectedOutline,null==g?void 0:g.unselectedOutline,t,i,l,h,d,c,p]),x=()=>{v&&v(u.key)};return(0,a.jsx)(o().A,{render:e=>(0,a.jsx)(r().A,{ariaLabel:u.ariaLabel,"aria-pressed":l,onClick:x,style:f.SegmentedItem,disabled:h,...e,children:(0,a.jsx)("div",{style:f.Inner,children:m})}),renderTooltip:()=>(0,a.jsx)("div",{children:y}),disableTooltip:l||void 0===y,placement:s().W.Bottom})}function u(e){const{items:t=[],itemStyle:i,selectedItemStyle:s,innerStyle:r,outerStyle:o,value:u,onChange:d,colors:c}=e,p=(0,n().IS)((e=>({SegmentedButton:{background:e.cardContentBackground,display:"flex",width:"100%",...o}})),[o]);return 0===t.length?null:(0,a.jsx)("div",{style:p.SegmentedButton,children:t.map(((e,n)=>(0,a.jsx)(l,{isFirst:0===n,isLast:n===t.length-1,isSelected:e.key===u,item:e,itemStyle:i,selectedItemStyle:s,innerStyle:r,colors:c,onClick:d,children:e.render()},e.key)))})}},101749:(e,t,i)=>{i.d(t,{N:()=>o});i(296540);var n=()=>i(959013),s=()=>i(423657),r=i(474848);function o(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,r.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests."})}),(0,r.jsx)("div",{children:(0,r.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests."})}),(0,r.jsx)("div",{children:(0,r.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},133507:(e,t,i)=>{i.d(t,{j:()=>l});i(296540);var n=()=>i(56366),s=()=>i(959013),r=()=>i(10984),o=()=>i(749240),a=i(474848);function l(e){let{featureAvailability:t}=e;const i=(0,n().K8)((()=>(0,r().aV)(o().subscriptionDataStoreInstance.state)),[])??0,l={type:"unavailable",limit:{type:"cumulative",total:i,current:i},upsell:{type:"product",product:"plus",limit:{type:"cumulative",current:i,total:"unlimited"},trialability:"none"}};t??=l;const u=t.limit.total,d=t.upsell;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to {currentLimit, plural, one {{currentLimit} unique guest} other {{currentLimit} unique guests}}.",values:{currentLimit:u}})}),"product"===d.type?(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2upgrade",defaultMessage:"Upgrade to get up to {upsellLimit, plural, one {{upsellLimit} guest} other {{upsellLimit} guests}}",values:{upsellLimit:d.limit.total}})}):(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2contactSales",defaultMessage:"Contact sales to get more guests"})]})}},232376:(e,t,i)=>{i.d(t,{Ay:()=>W,Qg:()=>F});i(944114),i(898992),i(354520),i(581454),i(737550);var n=i(296540),s=()=>i(484714),r=()=>i(56366),o=()=>i(401497),a=()=>i(764880),l=()=>i(437607),u=()=>i(798880),d=()=>i(919709),c=()=>i(959013),p=()=>i(496603),m=()=>i(458366),g=()=>i(722872),v=()=>i(963589),h=()=>i(842599),y=()=>i(906380),f=()=>i(97835),x=()=>i(966505),b=()=>i(653048),S=()=>i(760217),T=()=>i(406699),w=()=>i(811979),A=()=>i(64e3),I=()=>i(8980),_=()=>i(89924),k=()=>i(765957),M=()=>i(529183),j=()=>i(10984),C=()=>i(980270),R=()=>i(875497),P=()=>i(690490),U=i(474848);function E(e){const t=(0,r().uB)(void 0,M().Ay),i=(0,r().uB)(void 0,R().A),{store:a,inputValue:l,intl:d,propertySchemaLimit:p,isLoading:g,handlePersonPropertyMenuChange:v,format:E}=e,D=(0,s().v3)(),B=(0,o().IS)((e=>({moreBarTitleStyle:{color:e.text.secondary,fontSize:11},desktopTitleStyle:{color:e.text.secondary,fontSize:11},messageBodyStyle:{color:e.text.tertiary,paddingLeft:2},messageTitleStyle:{color:e.text.tertiary},inviteBodyStyle:{color:e.text.primary}})),[]),{isMobile:L}=(0,s().Y0)(),G=(0,r().K8)((()=>{var e;return null===(e=k().default.state.currentSpaceStore)||void 0===e?void 0:e.getName()}),[]),q=(0,r().K8)((()=>i.state.flowId),[i]),{email:F,isEmail:O,inviteButtonTitle:W}=(0,n.useMemo)((()=>{const e=(0,h().qh)(l),t=(0,h().DT)(e),i=d.formatMessage({id:"invite.person_property.button.invite_people",defaultMessage:"Invite people"}),n=d.formatMessage({id:"invite.person_property.button.invite_email",defaultMessage:"Invite ”{email}”"},{email:e});return{email:e,isEmail:t,inviteButtonTitle:t?n:i}}),[l,d]),N=(0,n.useCallback)((()=>{O&&F&&C().handlePopupClickWithEmail({email:F,inviteTargetsStore:t}),x().TS(D,{origin:"person_property_invite",invite_flow_id:q})}),[O,q,F,D,t]),V=(0,n.useCallback)((()=>{x().F$(D,{origin:"person_property_invite",invite_flow_id:q})}),[q,D]),K=(0,r().K8)((()=>{const e=function(e){const{canAddPermissions:t,isMobile:i,format:n}=e,s="enterprise"===e.subscriptionTier;if(i||s||!t||(0,m().NN)(n))return!1;return!0}({canAddPermissions:a.canEditMembership(),isMobile:L,subscriptionTier:(0,j().AI)(),format:E});return e&&x().HJ(D,{origin:"person_property_invite",invite_flow_id:q}),e}),[a,q,L,D,E]),z=(0,r().K8)((()=>{if(!(0,m().NN)(E))return(0,b().tF)(p)}),[E,p]);return K?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(_().A,{title:(0,U.jsx)(c().sA,{defaultMessage:"People",id:"database.personPropertyValue.selectPerson.noSearchResults.resultsTitle"}),desktopTitleStyle:B.desktopTitleStyle,loading:g,desktopStyle:{paddingBottom:4},children:(0,U.jsx)(A().A,{title:(0,U.jsx)("span",{style:B.messageBodyStyle,children:(0,U.jsx)(c().sA,{defaultMessage:"No matches in {spaceName}",id:"database.personPropertyMenu.noSearchResults.messageWithSpaceName",values:{spaceName:G}})}),titleStyle:B.messageTitleStyle})}),(0,U.jsx)(_().A,{title:(0,U.jsx)(c().sA,{defaultMessage:"More",id:"database.personPropertyValue.selectPerson.noSearchResults.suggestionTitle"}),desktopTitleStyle:B.moreBarTitleStyle,topBorder:!0,desktopStyle:{marginTop:0,paddingTop:10},children:(0,U.jsx)(w().A,{focused:!1,stopClickPropagation:!0,popupType:T().z7.Popup,renderOrigin:e=>(0,U.jsx)(S().A,{...e,focused:!1,icon:(0,U.jsx)(I().I,{icon:f().x,color:"primary"}),title:W,right:(0,U.jsx)(I().I,{icon:y().arrowChevronSingleRightSmallIcon,size:"sm",color:"secondary"}),textWrapperStyle:B.inviteBodyStyle}),onClick:N,onClose:V,borderRadius:8,render:e=>(0,U.jsx)(P().A,{inviteOrigin:"person_property_invite",store:a,handleBackButtonClick:()=>e.close(),inviteTargetsStore:t,personPropertyInviteStore:i,onInviteCompleteFn:t=>{e.close();const i=(t.success?Object.values(t.invitedUsers):[]).map((e=>({table:u().oo,id:e})));v(i)}})})})]}):(0,U.jsx)(_().A,{title:z,loading:g,children:(0,U.jsx)(A().A,{title:(0,U.jsx)(c().sA,{defaultMessage:"No results",id:"database.personPropertyMenu.noSearchResults.message"})})})}var D=()=>i(422464),B=()=>i(928600),L=()=>i(939740),G=()=>i(448693),q=()=>i(856952);const F=(0,c().YK)({searchForPerson:{defaultMessage:"Search for a person…",id:"database.personPropertyValue.searchPlaceholder"},searchErrorMessage:{defaultMessage:"Something went wrong.",id:"database.personPropertyMenu.searchErrorMessage"},searchOfflineErrorMessage:{defaultMessage:"Unavailable offline.",id:"database.personPropertyMenu.searchOfflineErrorMessage"}});const O=n.memo((function(e){const{tokens:t,disabled:r,onChange:a,value:l,inputValue:u,setInputValue:d}=e,{isMobile:p,isAndroid:m,isPhone:g}=(0,s().Y0)(),h=(0,c().tz)(),y=(0,v().X)("db_ux_chrome"),f=(0,v().X)("db_ux_mobile"),x=(0,o().IS)((()=>{const e=(0,i(828180)._Q)({isPhone:g});return{tokenWrapStyle:y?{padding:e.table.token,gap:4}:{padding:"4px 6px",gap:4}}}),[y,g]),b=(0,n.useCallback)((()=>{a({type:"personPropertyMenuUpdateRemovePerson",removedValue:l[l.length-1]})}),[a,l]);return(0,U.jsx)(_().A,{disableDesktopPadding:!0,children:(0,U.jsx)(q().Ay,{focus:!p||void 0,focusAfterAnimation:!0,format:q().le.Person,tokens:t,tokenWrapStyle:x.tokenWrapStyle,placeholder:h.formatMessage(F.searchForPerson),hideInput:r,onRemoveLastToken:b,value:u,onChange:e=>d(e.target.value),dontShowBorderBottom:m||p&&f})})})),W=function(e){const t=(0,v().X)("db_ux_mobile"),o=(0,s().v3)(),{isMobile:h}=(0,s().Y0)(),y=(0,c().tz)(),{disabled:f,value:x,format:T,valueIsUnpersistedDefaultValue:w,onChange:I,propertySchema:M,parentStore:j,onDismiss:C,isTemplatePage:R,insertChar:P,formQuestionStore:q,collectionStore:W}=e,[N,V]=(0,n.useState)((()=>P||"")),K=(0,r().K8)((()=>{if(!(0,m().NN)(T))return(0,b().tF)(M.limit)}),[T,M.limit]),z=(0,r().K8)((()=>{const e=M.limit;return(0,m().NN)(T)&&q?(0,i(31503).hm)(M,q.getModel()):e}),[q,T,M]),H=(0,r().O$)(k().AppStoreCurrentSpaceStore),Q=(0,i(741737).c)({spaceStore:H,viewedUserStore:void 0,ignoreViewedUserStore:!0}),Y=(0,n.useCallback)((e=>{!function(e){let{newMentions:t,tokenLimit:i,value:n,valueIsUnpersistedDefaultValue:s,onChange:r}=e;1===i&&t.length>0?r({type:"personPropertyMenuUpdateReplacePerson",newValue:t[0]}):void 0===i?r(s?{type:"personPropertyMenuUpdateAddPerson",newValues:[...n,...t]}:{type:"personPropertyMenuUpdateAddPerson",newValues:t}):t.length+n.length<=i&&r({type:"personPropertyMenuUpdateAddPerson",newValues:t})}({newMentions:e,tokenLimit:z,value:x,valueIsUnpersistedDefaultValue:w,onChange:I}),V("")}),[I,z,x,w]),{tokens:$,selectedTemplateAnnotationVariables:X}=(0,r().K8)((()=>{const e=[];return{tokens:x.map((t=>{if((0,d().MMZ)(t))return e.push(t),(0,U.jsx)(D().W,{templateVariableType:t,showRemoveButton:!f,onRemove:()=>{I({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},style:{margin:"0px 6px 6px 0px"}},t);if((0,a().Pu)(t)){const e=(0,a().xC)({pointer:t,getRecordValue:j.getRecordValue});return(0,U.jsx)(G().Ay,{actor:e,format:h?G().Ay.Format.Large:G().Ay.Format.Medium,showRemoveButton:!f,onClickRemove:()=>{I({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0,hasPersonHoverCard:Q},t.id)}if((0,l().GL)(t)){const e=(0,l().bj)({spacePermissionGroupId:t.id,spaceId:t.spaceId});return(0,U.jsx)(i(27356).UISpacePermissionGroupToken,{parentStore:j,groupPointer:e,format:h?G().Ay.Format.Large:G().Ay.Format.Medium,showRemoveButton:!f,onClickRemove:()=>{I({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0},e.id)}(0,i(534177).HB)(t)})),selectedTemplateAnnotationVariables:e}}),[x,f,I,j,h,Q]),J=d().Wov.filter((e=>!X.includes(e))),Z=(0,v().X)("group_mentions_in_person_property_values"),ee=(0,r().K8)((()=>{const e=Boolean(W&&W.isExternallyImportedAndSyncedCollection()&&(null==W?void 0:W.getFormat().external_collection_type)),t=null==W?void 0:W.getFormat().external_collection_type;if((0,i(504836).CS)()&&e&&t)return(0,i(526065).Y)({environment:o,intl:y,store:j,isSyncedCollection:e,inputValue:N,value:x,format:T,propertySchema:M,handlePersonPropertyMenuAddMentions:Y,sectionMenuTitle:K,externalSyncedCollectionType:t});const n={request:{query:N,actorPointers:p().pb(x,a().Pu),groupPointers:p().pb(x,(e=>"string"!=typeof e&&(0,l().GL)(e)))},performRequest:async e=>{let{query:t,actorPointers:n,groupPointers:s}=e;const r=await i(106628).T.searchActions.load(),a=await r.searchSpaceUsers({environment:o,query:t,membersOnly:!1,limit:20+n.length,placeSelfFirst:""===t||r.isPersonalPronoun(t,y.locale),shouldUseEdgeCacheRollout:i(217429).default.checkGate({gateName:"edge_cache_person_property"})}),l=Z?r.searchSpaceGroups({query:t,intl:y}):[];return{users:a.filter((e=>!n.some((t=>t.id===e.id)))).slice(0,20),groups:l.filter((e=>!s.some((t=>t.id===e.pointer.id)))).slice(0,20),type:"notionUsersAndGroups"}},render:(e,t,n)=>{if(e){const e=!i(227440).A.state.online;return(0,U.jsx)(_().A,{title:K,loading:!n,children:(0,U.jsx)(A().A,{title:e?(0,U.jsx)(c().sA,{...F.searchOfflineErrorMessage}):(0,U.jsx)(c().sA,{...F.searchErrorMessage})})})}if(t&&"notionUsersAndGroups"!==t.type)return(0,U.jsx)(_().A,{title:K,loading:!n,children:(0,U.jsx)(A().A,{title:(0,U.jsx)(c().sA,{...F.searchErrorMessage})})});if(t&&0===t.users.length&&0===t.groups.length)return(0,U.jsx)(E,{store:j,inputValue:N,intl:y,propertySchemaLimit:M.limit,isLoading:!n,format:T,handlePersonPropertyMenuChange:e=>{Y(e)}});const s=!(void 0!==z&&x.length>=z&&z&&z>1),r=p().oE((t&&t.users||[]).map((e=>{const t={key:e.id,render:t=>(0,U.jsx)(i(859428).A,{disableTooltip:s,renderTooltip:()=>(0,U.jsx)(c().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:n=>(0,U.jsx)(i(457688).A,{...t,actor:(0,a().A7)(e),disabled:!s,disabledFeedback:!s,...n})}),action:()=>{Y([{table:u().oo,id:e.id}])}};return t}))),o=p().oE((t&&t.groups||[]).map((e=>{const t={key:e.group_id,render:t=>(0,U.jsx)(i(862139)._,{group:e,menuListItemProps:t}),action:()=>{Y([e.getGroupPointer()])}};return t}))),l=p().oE([r.length>0?{key:"person section",render:e=>(0,U.jsx)(_().A,{...e,title:K,loading:!n}),items:r}:void 0,o.length>0?{key:"group section",render:e=>(0,U.jsx)(_().A,{...e,title:(0,b().Rf)(M.limit),loading:!n}),items:o}:void 0]);return(0,U.jsx)(L().Ay,{type:L().Oh.Vertical,initialFocus:N.length>0?0:void 0,sections:l})}};return n}),[W,N,x,o,y,j,T,M,Y,K,Z,z]),te=(0,U.jsx)(O,{tokens:$,disabled:f,onChange:I,value:x,inputValue:N,setInputValue:V});let ie;return ie=h?{menuType:g().gu.Modal,title:M.name,...!t&&{right:(0,U.jsx)(i(480095).DoneMenuText,{}),onClickRight:C},header:te,includeFixedHeaderSpacing:t,scrollerStyle:t?{paddingBottom:i(838364).Hc}:void 0}:{menuType:g().gu.Popup,header:te,tokenInputHeader:!0,maxHeight:333},f?(0,U.jsx)(B().A,{...ie}):(0,U.jsxs)(B().A,{...ie,children:[R&&(0,U.jsx)(_().A,{title:(0,U.jsx)(c().sA,{defaultMessage:"Shortcuts",id:"PersonPropertyMenu.menuItem.shortcuts.label"}),children:J.length>0?(0,U.jsx)(n.Fragment,{children:J.map((e=>(0,U.jsx)(S().A,{focused:!1,title:(0,U.jsx)(D().W,{templateVariableType:e}),caption:(0,i(173979).EC)(e,y),inline:!0,onClick:()=>{Y([e])}},`relative-person-shortcut-${e}`)))}):(0,U.jsx)(A().A,{title:(0,U.jsx)(c().sA,{id:"database.personPropertyMenu.noShorcuts.message",defaultMessage:"No shortcuts"})})}),(0,U.jsx)(i(251126).A,{...ee})]})}},274652:(e,t,i)=>{i.d(t,{o:()=>r});var n=i(296540),s=i(474848);const r=n.forwardRef((function(e,t){let{color:n="primary",...r}=e;const o=(0,i(401497).IS)((e=>{const t="blue"===n?i(381349).Ay.blue:"secondary"===n?e.text.secondary:e.text.primary;return{title:{color:t,fill:t},buttonMenuItem:{...r.style,...r.disabled?{cursor:"not-allowed"}:{}}}}),[r.disabled,n,r.style]);return(0,s.jsx)(i(760217).A,{ref:t,...r,title:(0,s.jsx)("div",{style:o.title,children:r.title}),icon:(0,s.jsx)(i(8980).I,{icon:i(617668).plusIcon,style:{fill:n}}),style:o.buttonMenuItem})}))},381374:(e,t,i)=>{i.d(t,{p:()=>r});i(296540);var n=()=>i(959013),s=i(474848);function r(e){let{invalidInvites:t,showEmptyError:i,styles:r}=e;if(i)return(0,s.jsx)("div",{style:r,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.noEmails",defaultMessage:"Please enter an email address"})});if(0===t.length)return null;const o=t[0].value.text;return 1===t.length?(0,s.jsx)("div",{style:r,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.singleEmail",defaultMessage:"“{text}” is not a valid email",values:{text:o}})}):(0,s.jsx)("div",{style:r,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.multipleEmails",defaultMessage:"{additionalInvalid, plural, one {”{text}” and {additionalInvalid} other are not valid emails} other {”{text}” and {additionalInvalid} others are not valid emails}}",values:{text:o,additionalInvalid:t.length-1}})})}},401996:(e,t,i)=>{i.d(t,{P:()=>u,S:()=>d});i(898992),i(354520),i(581454);var n=()=>i(842599),s=()=>i(535279),r=()=>i(765957),o=()=>i(975971),a=()=>i(542056);const l=i(496603).sg((e=>{let{environment:t,flowId:n,billingData:s,origin:r}=e;i(134696).D2(t,{invite_flow_id:n,billingData:s,invite_origin:r})}),1e3);async function u(e){var t;const{environment:i,event:u,flowId:d,inviteTargetsStore:c,inviteOrigin:p,onInputChanged:m}=e;null==m||m();const g=null===(t=r().default.state.currentSpaceStore)||void 0===t?void 0:t.id,v=g?await o().A.awaitData(i,{spaceId:g}):void 0;c.setState({...c.state,tokenQuery:u.target.value}),l({environment:i,flowId:d,billingData:null==v?void 0:v.billingData,origin:p});const h=u.target.value,{extractedEmails:y,invalidParts:f,newInputValue:x}=(0,n().l2)(h),b=[...await a().Ah(i,y),...f.map((e=>({type:"invalidUser",value:{text:e}})))].filter((e=>!s().P4({inviteTargetsStore:c,target:e}))),S=[...c.state.inviteTargets,...b];c.setState({...c.state,inviteTargets:S,tokenQuery:x})}function d(e){const{targetToRemove:t,inviteTargetsStore:i}=e;if(0===i.state.inviteTargets.length)return;const n=i.state.inviteTargets.filter((e=>e!==t));0===n.length?i.setState({...i.state,inviteTargets:[]}):i.setState({...i.state,inviteTargets:n})}},422464:(e,t,i)=>{i.d(t,{W:()=>y,e:()=>h});i(296540);var n=()=>i(401497),s=()=>i(784892),r=()=>i(563884),o=()=>i(91451),a=()=>i(436632),l=()=>i(919709),u=()=>i(959013),d=()=>i(534177),c=()=>i(848401),p=()=>i(88306),m=i(474848);const g="20px",v=(0,u().YK)({me:{id:"templateVariablePropertyValueComponent.templateVariables.text.me",defaultMessage:"Person who duplicated page"},now:a().H.nowText,today:a().H.todayText});function h(e){const t=(0,n().IS)((e=>({textWrapper:{lineHeight:g}})),[]);return(0,m.jsx)(p().C,{fontColor:"light",style:t.textWrapper,children:(0,m.jsx)(y,{templateVariableType:e.templateVariableType})})}function y(e){const{templateVariableType:t,showRemoveButton:i,onRemove:a,style:p}=e,g=(0,u().tz)(),v=(0,n().IS)((e=>({uiToken:{background:e.outlineBlueButtonPressedBackground,color:e.blueColor,padding:"2px 4px",width:"max-content",...p||{}}})),[p]);return(0,m.jsx)(c().Ay,{format:s().NY.Medium,isSingle:!0,title:f(t,g),renderAvatar:()=>function(e){let t;(0,l().pbt)(e)?t=o().z:(0,l().UKc)(e)?t=r().k:(0,d().HB)(e);return t}(t)({width:12,height:12,marginRight:4}),shouldShrink:!0,onClickRemove:a,showRemoveButton:Boolean(i),style:v.uiToken})}function f(e,t){let i;return"me"===e?i=t.formatMessage(v.me):"now"===e?i=t.formatMessage(v.now):"today"===e?i=t.formatMessage(v.today):(0,d().HB)(e),i}},423657:(e,t,i)=>{i.d(t,{A:()=>a});var n=()=>i(108944),s=()=>i(299545),r=()=>i(640653);function o(e,t){return(0,r().hN)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const a=function(e){return(0,i(56366).K8)((()=>{if((0,s().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if(!(0,s()._p)(e))return(0,r().r7)(e)?o(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,n().Uo)(e),a=(0,n().pp)(e),l=a||i(765957).default.state.currentSpaceStore;if((0,r().r7)(l))return o(l,t);const u=!(null!=a&&a.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:u,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:u,isGuestRequestRequired:!1}}),[e])}},526065:(e,t,i)=>{i.d(t,{Y:()=>I,z:()=>_});i(581454),i(296540);var n=()=>i(56366),s=()=>i(764880),r=()=>i(437607),o=()=>i(798880),a=()=>i(959013),l=()=>i(496603),u=()=>i(513416),d=()=>i(252833),c=()=>i(449506);var p=()=>i(47170),m=()=>i(249847),g=()=>i(106628),v=()=>i(217429),h=()=>i(666803),y=()=>i(329304),f=()=>i(760217),x=()=>i(939740),b=()=>i(64e3),S=()=>i(89924),T=()=>i(453697),w=()=>i(232376),A=i(474848);function I(e){let{environment:t,intl:i,store:n,isSyncedCollection:p,inputValue:m,value:h,format:y,propertySchema:I,handlePersonPropertyMenuAddMentions:_,sectionMenuTitle:k,externalSyncedCollectionType:M}=e;const j=async e=>{if(p&&e.emailAddress){const s=await g().T.searchActions.load(),r=await s.searchSpaceActors({environment:t,query:e.emailAddress,membersOnly:!1,userLocale:i.locale,shouldUseEdgeCacheRollout:v().default.checkGate({gateName:"edge_cache_person_property"}),limit:1});if(1===r.users.length)_([{table:o().oo,id:r.users[0].id}]);else{const i=await async function(e){let{environment:t,externalUser:i,blockPointer:n,externalSyncedCollectionType:s}=e;const r=await c().callApi({eventName:"getOrCreateNotionUserFromExternalUser",environment:t,data:{externalUser:(0,d().Vz)(i,s),blockPointer:n}});if(!(0,u().kX)(r))return"success"===r.type?r.data.notionUser:void 0}({environment:t,externalUser:e,blockPointer:n.pointer,externalSyncedCollectionType:M});i&&_([{table:o().oo,id:i.id}])}}},C={request:{query:m,actorPointers:l().pb(h,s().Pu),groupPointers:l().pb(h,(e=>"string"!=typeof e&&(0,r().GL)(e)))},performRequest:async e=>{let{query:i,actorPointers:s,groupPointers:r}=e;const o=await async function(e){let{environment:t,blockPointer:i,query:n}=e;const s=await c().callApi({eventName:"getExternalUsersForSyncedCollection",environment:t,data:{blockPointer:i,query:n}});return(0,u().kX)(s)?[]:"success"===s.type?s.data.externalUsers:[]}({environment:t,blockPointer:n.pointer,query:i});return{externalUsers:o,type:"externalUsers"}},render:(e,t,i)=>{if(e)return(0,A.jsx)(S().A,{title:k,loading:!i,children:(0,A.jsx)(b().A,{title:(0,A.jsx)(a().sA,{...w().Qg.searchErrorMessage})})});if(t&&"externalUsers"!==t.type)return(0,A.jsx)(S().A,{title:k,loading:!i,children:(0,A.jsx)(b().A,{title:(0,A.jsx)(a().sA,{...w().Qg.searchErrorMessage})})});const n=l().oE((t&&t.externalUsers||[]).map((e=>{const t=(0,A.jsx)(T().A,{avatar:{email:e.emailAddress,avatarUrl:"",name:e.displayName}});return{key:e.accountId,render:i=>(0,A.jsx)(f().A,{...i,title:e.displayName,caption:e.emailAddress,icon:t}),action:async()=>{await j(e)}}}))),s=l().oE([n.length>0?{key:"external user section",render:e=>(0,A.jsx)(S().A,{...e,title:(0,A.jsx)(a().sA,{defaultMessage:"Select user from Jira",id:"database.personPropertyValue.externalUsers.searchPlaceholder"}),loading:!i}),items:n}:void 0]);return(0,A.jsx)(x().Ay,{type:x().Oh.Vertical,initialFocus:m.length>0?0:void 0,sections:s})}};return{...C}}function _(){const e=(0,p().O)(),t=(0,m().T)(),i=(0,n().O$)(h().Ay).instanceValue===h().cK.DataCenter?"collection_synced_database_jira_datacenter":"collection_synced_database_jira";return(0,y()._X)({name:i,spaceId:e,userId:t})}},535279:(e,t,i)=>{i.d(t,{P4:()=>s,U1:()=>o,lW:()=>a});i(944114),i(898992),i(354520),i(737550);var n=()=>i(842599);function s(e){const{target:t,inviteTargetsStore:i}=e;return i.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:"group"===t.type?e.type===t.type&&e.value.group_id===t.value.group_id:e.type===t.type&&e.value.id===t.value.id))}function r(e){return"invalidUser"!==e.type}function o(e){const{inviteTargetsStore:t,includeInputFieldText:i}=e,o=[...t.state.inviteTargets];if(i){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,n().DT)(t))return;const i={type:"newUser",value:{email:t},source:"email"};return s({target:i,inviteTargetsStore:e})?void 0:i}(t);e&&o.push(e)}return o.filter(r)}function a(e){const{inviteTargetsStore:t,inviteTarget:i}=e;if(s({target:i,inviteTargetsStore:t})){const e=t.state.inviteTargets.filter((e=>"group"===i.type&&"group"===e.type?i.value.group_id!==e.value.group_id:"existingUser"===i.type&&"existingUser"===e.type?i.value.id!==e.value.id:"newUser"!==i.type||"newUser"!==e.type||i.value.email!==e.value.email));return t.setState({...t.state,inviteTargets:e}),!1}return t.setState({inviteTargets:[...t.state.inviteTargets,i],tokenQuery:""}),!0}},690490:(e,t,i)=>{i.d(t,{A:()=>ae});var n=i(296540),s=()=>i(484714),r=()=>i(56366),o=()=>i(401497),a=()=>i(959013),l=()=>i(381349),u=()=>i(496603),d=()=>i(966505),c=()=>i(545805),p=()=>i(859428),m=()=>i(912913),g=()=>i(366858),v=()=>i(58293),h=()=>i(646736),y=(i(581454),()=>i(401996)),f=()=>i(856952),x=()=>i(529183),b=(i(517642),i(658004),i(733853),i(845876),i(432475),i(515024),i(731698),()=>i(784892)),S=()=>i(842599),T=()=>i(534177),w=()=>i(284371),A=()=>i(453697),I=()=>i(423657),_=()=>i(101749),k=()=>i(765957),M=i(474848);const j=function(e){const{store:t,target:n}=e,u=(0,s().Y0)(),d=(0,a().tz)(),c=(0,s().v3)(),m=function(){const e=(0,o().IS)((()=>({verifiedDomain:{margin:2,backgroundColor:"rgba(83, 168, 63, 0.1)"},disabled:{margin:2,backgroundColor:"rgba(211, 79, 67, 0.1)",border:"dashed #D9655B 1px",paddingLeft:5},normal:{margin:2},guest:{margin:2,backgroundColor:"rgba(218, 163, 64, 0.2)"},error:{margin:2,backgroundColor:"rgba(195,90,75,0.2)",color:"#DE5550"},tokenContent:{display:"flex",alignItems:"center",maxWidth:"100%"},tokenSpan:{maxWidth:"100%"},tokenText:{marginLeft:4,...w().RC},base:{borderRadius:4}})),[]);return e}(),g=(0,r().K8)((()=>{const e=k().default.state.currentSpaceStore;return new Set(null==e?void 0:e.getEmailDomains())}),[]),v=(0,I().A)(t),h=(0,_().N)(t),y=(0,r().K8)((()=>{if("invalidUser"===n.type)return"invalidUser";if(e.tokenType)return e.tokenType;if("group"===n.type)return"group";if("existingUser"===n.type&&!Boolean(n.spaceRole)){var s;const e=null===(s=i(715392).W.getData(c,{userId:n.value.id,spaceId:t.getSpaceId()}))||void 0===s?void 0:s.membership_type;n.spaceRole=e?(0,i(848538).$N)(e):"not_in_space"}if(!(0,i(743260).yi)(n))return"member";if(v.isGuestRequestRequired)return"guestRequestRequired";if(v.isStoreInTeam&&!v.teamAllowsGuests)return"teamGuestDisabled";if(!v.isStoreInTeam&&!v.spaceAllowsGuests||v.isStoreInTeam&&!v.teamAllowsGuests&&!v.spaceAllowsGuests)return"spaceGuestDisabled";const r=(0,S().zN)(n.value.email);return r&&g.has(r)?"verifiedDomain":"guest"}),[e.tokenType,n,g,v,c,t]),f=(0,r().K8)((()=>{const e=m.base;switch(y){case"member":case"group":return{...e,...m.normal};case"invalidUser":return{...e,...m.error};case"guest":case"guestRequestRequired":return{...e,...m.guest};case"verifiedDomain":return{...e,...m.verifiedDomain};case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return{...e,...m.disabled};default:(0,T().HB)(y)}}),[y,m]);function j(){switch(n.type){case"newUser":return n.value.email.trim();case"invalidUser":return n.value.text.trim();case"existingUser":return(0,i(695608).c6)(d,n.value);case"group":return(0,i(698449).Pf)({intl:d,groupName:n.value.name});default:(0,T().HB)(n)}}function C(){const e=(0,i(133033).$)({height:16,width:16,color:"#D34F43"});switch(y){case"member":return(0,x().ju)(n)?(0,M.jsx)(A().A,{userValue:n.value,size:16}):(0,x().rP)(n)?(0,M.jsx)(A().A,{size:16,avatar:n.value}):(0,M.jsx)(A().A,{size:16});case"guest":case"guestRequestRequired":return(0,i(328347).h)({height:16,width:16,color:"#DAA340"});case"invalidUser":return(0,i(889154).G)({height:16,width:16,color:"#DE5550"});case"verifiedDomain":return(0,i(22394).o)({height:16,width:16,color:"#53A83F"});case"group":return(0,M.jsx)("div",{style:{height:16,width:16,backgroundColor:l().Ay.whiteWithAlpha(.8),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i(234194).M)({height:12,width:12,color:l().Ay.mediumTextColor})});case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return e;default:(0,T().HB)(y)}}function R(t){const i=C();let n=j(),s=m.tokenText;return e.onlyShowTokenType&&(["guest","teamGuestDisabled","spaceGuestDisabled"].includes(t)?(n="Guest",s={...s,color:"#DAA340"}):(n="Member",s={...s,color:"#53A83F"})),(0,M.jsxs)("div",{style:m.tokenContent,children:[i,(0,M.jsx)("div",{style:s,children:n})]})}function P(t){var i;t.stopPropagation(),null===(i=e.onClickRemove)||void 0===i||i.call(e)}const U="newUser"===n.type?n.value.email:"invalidUser"===n.type?n.value.text:n.value.id,E="group"!==n.type&&"invalidUser"!==n.type?n.value.email:void 0;return(0,M.jsx)(p().A,{placement:i(962730).W.Top,renderTooltip:()=>function(e){const{tokenType:t,target:i,email:n}=e;return"guest"===t?(0,M.jsx)(a().sA,{defaultMessage:"{email} will be invited as a guest",id:"inviteTargetToken.guest.tooltip",values:{email:n}}):"spaceGuestDisabled"===t||"teamGuestDisabled"===t||"guestRequestRequired"===t?h:"invalidUser"===i.type?(0,M.jsx)(a().sA,{defaultMessage:"{text} is not a valid email",id:"inviteTargetToken.invalidUser.tooltip",values:{text:i.value.text}}):"verifiedDomain"===t&&"group"!==i.type?(0,M.jsx)(a().sA,{defaultMessage:"{email}{br}will automatically be added to the workspace{br}since @{domain} is an allowed email domain.",id:"inviteTargetToken.verifiedDomain.tooltip",values:{email:i.value.email,br:(0,M.jsx)("br",{}),domain:(0,S().zN)(i.value.email)}}):"group"===i.type?i.value.name||(0,M.jsx)(a().sA,{defaultMessage:"Untitled group",id:"inviteTargetToken.group.untitled"}):n}({tokenType:y,email:E,target:n}),render:t=>(0,M.jsx)("div",{style:m.tokenSpan,...t,children:(0,M.jsx)(i(881690).A,{isSingle:!1,format:u.isMobile?b().NY.Large:b().NY.Medium,showRemoveButton:e.showRemoveButton,onClickRemove:P,disabledFeedback:!0,value:R(y),style:f,shouldWrap:!1})})},U)};const C=function(e){const{flowId:t,store:n,disabled:a,placeholder:d,right:c,focus:p,hideIconColorAndTooltips:m,showEmptyError:g,origin:v,onFocus:h,onSubmit:b,onInputChanged:S}=e,T=(0,s().v3)(),w=(0,s().Y0)(),A=(0,r().uB)(e.inviteTargetsStore,x().Ay),I=(0,r().K8)((()=>A.state.inviteTargets),[A]),_=(0,r().K8)((()=>A.state.tokenQuery),[A]),k=I.map((e=>{const t="newUser"===e.type?e.value.email:"invalidUser"===e.type?e.value.text:e.value.id;return(0,M.jsx)(j,{store:n,target:e,showRemoveButton:!0,tokenType:m?"member":void 0,onClickRemove:()=>y().S({inviteTargetsStore:A,targetToRemove:e})},t)})),C=(0,o().IS)((e=>({tokenInputMenuItem:{paddingTop:k.length>0?4:6,paddingLeft:4,paddingRight:4,paddingBottom:4,borderRadius:4,minHeight:32,...p&&{background:"none"},...a&&{background:e.inputBackground,color:e.text.secondary,fill:l().Ay.white,opacity:.4}},inputAndTokenWrapRight:{gap:2},inputInnerStyle:{paddingTop:0},warningMessage:{color:"#DE5550"}})),[p,a,k]);return(0,M.jsx)(f().Ay,{focus:p,focusAfterAnimation:!0,onClick:()=>{w.isMobile||null==h||h()},format:f().le.Share,value:_,onChange:e=>y().P({environment:T,event:e,inviteTargetsStore:A,inviteOrigin:v,flowId:t,onInputChanged:S}),type:"email",tokens:k,disabled:a,autoComplete:"off",placeholder:d,onRemoveLastToken:()=>{A.setState({...A.state,inviteTargets:A.state.inviteTargets.slice(0,-1)})},right:c,showBorder:!0,inputStyle:C.inputInnerStyle,inputAndTokenWrapRightStyle:C.inputAndTokenWrapRight,style:C.tokenInputMenuItem,onSubmit:b,inputFullWidth:!0,message:(0,M.jsx)(i(381374).p,{invalidInvites:(0,u().oE)(I.map((e=>"invalidUser"===e.type?e:void 0))),showEmptyError:g,styles:C.warningMessage})})};var R=()=>i(454354),P=()=>i(980270),U=()=>i(875497),E=(i(16280),i(898992),i(354520),i(737550),()=>i(68263)),D=()=>i(542056),B=()=>i(204063),L=()=>i(125565),G=()=>i(133507),q=()=>i(15897),F=()=>i(535279),O=()=>i(731320),W=()=>i(637573),N=()=>i(329304),V=()=>i(749240);function K(e){var t;const{store:i,sudoModeStore:o,personPropertyInviteStore:l,onInviteCompleteFn:u,inviteOrigin:c}=e,m=(0,s().v3)(),g=Y(),v=(0,r().uB)(e.inviteTargetsStore,x().Ay),h=(0,r().K8)((()=>l.state.isLoading),[l]),y=(0,n.useCallback)((e=>{l.setState({...l.state,isLoading:e,focus:U().E.NoFocus})}),[l]),[f,b]=(0,n.useState)("member"),S=(0,r().K8)((()=>{const{emailMessage:e}=l.state;return e}),[l]),T=(0,r().K8)((()=>{const{role:e}=l.state;return e}),[l]),w=(0,a().tz)(),A=(0,r().K8)((()=>l.state.flowId),[l]),j=(0,r().O$)(k().AppStoreCurrentSpaceStore),C=(0,r().K8)((()=>i.canEditMembership()),[i]),R=(0,r().K8)((()=>(0,F().U1)({inviteTargetsStore:v})),[v]),B=(0,n.useCallback)((async()=>{await P().handleEnterPress({environment:m,inviteTargetsStore:v,personPropertyInviteStore:l,allowShowEmptyError:!0})}),[m,v,l]),L=(0,n.useCallback)((()=>{const e=(0,F().U1)({inviteTargetsStore:v}),t=e.filter((e=>{let{type:t}=e;return"newUser"===t})).map((e=>{let{value:t}=e;return t.email})),i=e.filter((e=>{let{type:t}=e;return"existingUser"===t})).map((e=>{let{value:t}=e;return t.id}));return O().FC({environment:m,subscriptionData:V().subscriptionDataStoreInstance.state,newGuestIds:[...t,...i]})}),[v,m]),K=(0,r().K8)((()=>L()),[L]),$=(0,r().O$)(V().subscriptionDataStoreInstance),X=(0,W().r)()??0,J=(0,r().K8)((()=>O().LS($,X)),[X,$]),Z=(0,I().A)(i),ee=(0,r().K8)((()=>{if(Z.isGuestRequestRequired)return!1;const e=Z.isStoreInTeam&&!Z.teamAllowsGuests,t=!Z.isStoreInTeam&&!Z.spaceAllowsGuests||Z.isStoreInTeam&&!Z.teamAllowsGuests&&!Z.spaceAllowsGuests,i=R.some((e=>"newUser"===e.type||("existingUser"===e.type?"none"===e.spaceRole||"not_in_space"===e.spaceRole:void 0)));return(e||t)&&i}),[R,Z]),te=(0,r().K8)((()=>null==j?void 0:j.getRole()),[j]),ie=(0,r().K8)((()=>!(!te||!(0,E().NB)(te))&&!(!j||j.getDisableMembershipRequests())),[te,j]),ne=(0,N().P9)({name:"members",spaceId:null==j?void 0:j.id,userId:null===(t=m.currentUser)||void 0===t?void 0:t.id,amount:1}),se=Boolean(ne&&te&&(0,E().vp)(te));(0,n.useEffect)((()=>{b(se?"member":"guest")}),[se]);const re=(0,_().N)(i),oe=S.length>1e3,ae=(0,n.useCallback)((e=>{const{response:t,shouldDoCompleteFn:i,invitedUserEmails:n,isRequestMember:s}=e;t.success?i&&(d().cI(m,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c,invite_flow_id:A}),P().showMessageForInviteComplete({success:t.success,invitedUserEmails:n,isRequestMember:s}),y(!1),u(t)):(P().showMessageForInviteComplete({success:t.success,invitedUserEmails:n}),d().cI(m,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c}))}),[u,A,y,m,f,se,c]),le=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,shouldDoCompleteFn:n}=e;return await P().handleGuestInvite({environment:m,inviteOrigin:c,role:T,emailMessage:S,inviteTargetsStore:v,blockStore:i,sudoModeStore:o,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:n||!1,invitedUserEmails:t})}})}),[m,T,S,i,o,A,v,ae,c]),ue=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,disable_invite_email:i,guestInviteResponse:n,shouldDoCompleteFn:s}=e;if(!j)return null;const r=null!=n&&n.success?n.invitedUsers:void 0;await P().handleMemberInvite({environment:m,spaceStore:j,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:t})},intl:w,invitedUsers:r,inviteTargetsStore:v,inviteOrigin:c,disable_invite_email:i})}),[j,m,A,v,w,ae,c]),de=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,guestInviteResponse:n}=e;if(!j)return null;const s=null!=n&&n.success?n.invitedUsers:void 0;s&&await P().handleMemberRequest({environment:m,spaceStore:j,originType:"person_property_invite",intl:w,invitedUsers:s,reasonMessage:void 0,originId:i.id,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:!0,invitedUserEmails:t,isRequestMember:!0})},inviteOrigin:c})}),[m,A,j,w,ae,i,c]),ce=(0,n.useCallback)((async()=>{const e="member"===f,t=v.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(0===t.length)return void d().N_(m,{invite_stage:"click_invite_button",invite_flow_id:A,error:"No valid input emails"});const i=L();if(y(!0),e)if(i)await ue({invitedUserEmails:t,disable_invite_email:!1,guestInviteResponse:void 0,shouldDoCompleteFn:!0});else{const e=!se&&!ie,i=await le({invitedUserEmails:t,shouldDoCompleteFn:e});se?await ue({invitedUserEmails:t,disable_invite_email:!0,guestInviteResponse:i,shouldDoCompleteFn:!0}):ie&&await de({invitedUserEmails:t,guestInviteResponse:i})}else i?d().N_(m,{invite_stage:"click_invite_button",invite_flow_id:A,error:"Invite guest with guest limitation exceed"}):await le({invitedUserEmails:t,shouldDoCompleteFn:!0});y(!1),v.reset()}),[m,se,ie,f,A,L,v,le,ue,de,y]),pe=(0,n.useCallback)((async()=>{await B();const e=(0,F().U1)({inviteTargetsStore:v}).length;d().u$(m,{invited_user_count:e,invite_option:f,can_add_member:se,origin:c,inviteTargets:v.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:v.state.tokenQuery,invite_flow_id:A}),await ce()}),[m,A,B,ce,f,se,v,c]);let me;me=ee?re:oe?(0,M.jsx)(a().sA,{id:"shareMenu.inviteButton.emailOverMaxLength.tooltip",defaultMessage:"Message exceeds the limit of 1000 characters."}):void 0;const ge=(0,n.useMemo)((()=>[{key:"member",render:()=>(0,M.jsx)(p().A,{disableTooltip:se||ie,renderTooltip:()=>(0,M.jsx)(a().sA,{id:"invite.person_property.invite_member.tooltip",defaultMessage:"You do not have permission to add or request members to this workspace"}),render:e=>(0,M.jsx)(Q,{isSelected:"member"===f,inviteOption:"member",events:e})}),isDisabled:!se&&!ie},{key:"guest",render:()=>(0,M.jsx)(p().A,{disableTooltip:!K&&J,renderTooltip:()=>(0,M.jsx)(G().j,{}),render:e=>(0,M.jsx)(Q,{isSelected:"guest"===f,inviteOption:"guest",events:e})})}]),[f,K,J,ie,se]);return(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,M.jsx)("div",{style:g.section,children:(0,M.jsx)(q().A,{items:ge,itemStyle:g.itemStyle,innerStyle:g.innerStyle,value:f,onChange:e=>{b(e),d().ZZ(m,{invite_option:e,invite_flow_id:A,origin:c})}})}),!K&&J||"guest"!==f?(0,M.jsx)(H,{tooltip:me,disabled:!C||ee||oe,onClick:pe,isLoading:h}):(0,M.jsx)(z,{onClick:()=>{d().j$(m,{invited_user_count:R.length,invite_flow_id:A,origin:c}),D().D6({environment:m,upgradeButtonName:"user_permission_item"})}})]})}function z(e){const{onClick:t}=e;return(0,M.jsx)(p().A,{disableTooltip:!1,renderTooltip:()=>(0,M.jsx)(G().j,{}),render:e=>(0,M.jsx)(B().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},onClick:t,...e,children:(0,M.jsx)(a().sA,{id:"invite.person_property.upgrade",defaultMessage:"Upgrade"})})})}function H(e){const{tooltip:t,disabled:i,onClick:n,isLoading:s}=e;return(0,M.jsx)(p().A,{disableTooltip:!Boolean(t),renderTooltip:()=>t,render:e=>(0,M.jsx)(B().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},disabled:i,onClick:n,...e,isLoading:s,children:(0,M.jsx)(a().sA,{id:"invite.person_property.invite",defaultMessage:"Invite"})})})}function Q(e){const{isSelected:t,inviteOption:i,events:n}=e,s=Y(),r=t?s.mainTextSelected:s.mainTextUnselected;let o,l;switch(i){case"guest":o=(0,M.jsx)(a().sA,{id:"invite.person_property.addAsGuest.title",defaultMessage:"Add to page only"}),l=(0,M.jsx)(a().sA,{id:"invite.person_property.addAsGuest.subtitle",defaultMessage:"Invite as a Guest"});break;case"member":o=(0,M.jsx)(a().sA,{id:"invite.person_property.addAsMember.title",defaultMessage:"Add to Workspace"}),l=(0,M.jsx)(a().sA,{id:"invite.person_property.addAsMember.subtitle",defaultMessage:"Invite and bill as a Member"});break;default:throw new Error(`Unsupported invite option: ${i}`)}return(0,M.jsx)("div",{style:s.row,...n,children:(0,M.jsxs)("div",{style:r,children:[o,(0,M.jsx)(L().A,{isSmall:!0,style:s.optionSubtitle,children:l})]})})}function Y(){return(0,o().IS)((e=>({mainTextSelected:{fontWeight:w().Wy.medium,color:e.text.primary,fontSize:14,lineHeight:"14px"},mainTextUnselected:{color:e.text.secondary,fontSize:14,lineHeight:"14px"},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{padding:"16px 11px 16px 11px"},itemStyle:{margin:5,borderRadius:8,borderWidth:2},innerStyle:{borderWidth:0},optionSubtitle:{whiteSpace:"pre-wrap",paddingTop:2,fontSize:12}})),[])}var $=()=>i(149375),X=()=>i(285790);function J(e){let{handleBackButtonClick:t}=e;const i=(0,o().IS)((()=>({container:{display:"flex",margin:"0 12px 0px",height:40}})),[]);return(0,M.jsx)("div",{style:i.container,children:(0,M.jsx)(Z,{onClick:t})})}function Z(e){const{onClick:t}=e,i=(0,a().tz)(),n=(0,o().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},iconButton:{marginRight:6,height:24,width:24},arrowIcon:{height:16,width:16,strokeWidth:w().Wy.semibold},sendInviteLabel:{fontWeight:w().Wy.medium}})),[]);return(0,M.jsxs)("div",{style:n.topContainer,children:[(0,M.jsx)(X().A,{icon:$().v,iconStyle:n.arrowIcon,style:n.iconButton,onClick:t,ariaLabel:i.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,M.jsx)(L().A,{style:n.sendInviteLabel,children:(0,M.jsx)(a().sA,{id:"invite.person_property.popup_title",defaultMessage:"Invite and mention"})})]})}var ee=()=>i(456328),te=()=>i(623580),ie=()=>i(250064);const ne=u().sg((e=>{let{environment:t,flowId:i,origin:n}=e;d().IT(t,{origin:n,invite_flow_id:i})}),1e3);function se(e){const{inviteTargetsStore:t,personPropertyInviteStore:i,inviteOrigin:o}=e,a=(0,s().v3)(),{focus:l,emailMessage:u}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),d=(0,r().K8)((()=>i.state.flowId),[i]),c=(0,n.useCallback)((()=>{t.reset()}),[t]),p=(0,n.useCallback)((e=>{i.setState({...i.state,focus:l,emailMessage:e.target.value}),ne({environment:a,flowId:d,origin:o})}),[a,i,d,o,l]),m=(0,n.useCallback)((()=>{c()}),[c]),g=(0,n.useCallback)((()=>{i.setState({...i.state,focus:U().E.MessageInput,emailMessage:u})}),[i,u]);return(0,M.jsx)(re,{focus:l===U().E.MessageInput,value:u,onFocus:g,onChange:p,onCancel:m,maxLength:1e3,inviteTargetsStore:t})}function re(e){const{focus:t,value:i,maxLength:n,inviteTargetsStore:l,onFocus:u,onChange:d,onCancel:c}=e,p=(0,a().tz)(),m=i.length/n>=.8,g=(0,ee().BS)(i),v=m||g,h=(0,s().Y0)(),y=(0,o().IS)((e=>({container:{maxHeight:80,bottom:0,padding:"2px 16px 2px 16px",backgroundColor:e.modalBackground,pointerEvents:"all",transitionProperty:"max-height",transitionDuration:"0.3s",overflow:"hidden",zIndex:1,height:72},input:{maxHeight:80,borderTop:1,borderTopStyle:"solid",borderTopColor:e.regularDividerColor,padding:2,fontSize:14,transitionProperty:"max-height",transitionDuration:"0.3s",height:"100%"},inputBox:{padding:"0px 4px 0px 4px",boxShadow:e.inputBoxShadow,background:e.inputBackground,width:"auto",height:"100%",borderRadius:6,...t&&{background:"none",boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"}}})),[t]),f=(0,r().K8)((()=>l.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email))),[l]),x=(0,r().K8)((()=>f.length>0?p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.withEmails",defaultMessage:"Add a message for {users}"},{users:(0,ie().l)(f)}):p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.noEmails",defaultMessage:"Add a message to your invite..."})),[p,f]);return(0,M.jsxs)("div",{style:y.container,children:[v&&(0,M.jsx)(oe,{value:i,maxLength:n,shouldShowLengthWarning:m,shouldShowLinkWarning:g}),(0,M.jsx)(te().A,{textarea:!0,focusInitial:!1,format:te().C.Transparent,placeholder:x,maxlength:n,focus:t,value:i,onFocus:u,onChange:d,inputStyle:y.input,onCancel:c,style:y.inputBox,onClick:()=>{h.isMobile||null==u||u()}})]})}function oe(e){const{shouldShowLengthWarning:t,shouldShowLinkWarning:i,value:n,maxLength:s}=e,r=(0,o().IS)((e=>({container:{position:"absolute",top:0,display:"flex",justifyContent:"center",fontSize:12,color:e.text.tertiary,width:"100%"},warning:{display:"flex",justifyContent:"center",width:"calc(100% - 36px)",backgroundColor:e.modalBackground,marginTop:1}})),[]);return(0,M.jsx)("div",{style:r.container,children:(0,M.jsxs)("div",{style:r.warning,children:[t&&(0,M.jsx)(a().sA,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",values:{characters:n.length,maxCharacters:s}}),t&&i&&" · ",i&&(0,M.jsx)(a().sA,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning"})]})})}function ae(e){const{store:t,handleBackButtonClick:i,onInviteCompleteFn:a,inviteTargetsStore:l,personPropertyInviteStore:d,inviteOrigin:p}=e,m=(0,r().uB)(void 0,R().A),g=(0,s().v3)(),v=(0,n.useCallback)((async()=>{await P().handleEnterPress({environment:g,inviteTargetsStore:l,personPropertyInviteStore:d,allowShowEmptyError:!1})}),[g,l,d]),h=(0,o().IS)((()=>({container:{position:"relative",width:450,transition:"all",transitionDuration:"0.3s",display:"flex",flexDirection:"column",maxHeight:500},searchBar:{paddingLeft:16,paddingRight:16,paddingBottom:16,paddingTop:16},horizontalLine:{margin:"0",color:"#E3E2E0",opacity:.3}})),[]);return(0,M.jsx)(c().A,{debugName:"PersonPropertyInvitePopup",capture:!0,onLeft:u().D_,onRight:u().D_,onSelectAll:u().D_,onRedo:u().D_,onUndo:u().D_,onCut:u().D_,onCopy:u().D_,onPaste:u().D_,onKeypress:u().D_,onDelete:u().D_,onBackspace:u().D_,onTab:u().D_,onEnter:v,children:(0,M.jsxs)("div",{style:h.container,children:[(0,M.jsx)(J,{handleBackButtonClick:i}),(0,M.jsx)("hr",{style:h.horizontalLine}),(0,M.jsx)("div",{style:h.searchBar,children:(0,M.jsx)(le,{store:t,inviteTargetsStore:l,personPropertyInviteStore:d,inviteOrigin:p})}),(0,M.jsx)(se,{store:t,inviteTargetsStore:l,personPropertyInviteStore:d,inviteOrigin:p}),(0,M.jsx)("div",{children:(0,M.jsx)(K,{store:t,inviteTargetsStore:l,sudoModeStore:m,onInviteCompleteFn:a,personPropertyInviteStore:d,inviteOrigin:p})})]})})}function le(e){const{store:t,personPropertyInviteStore:i,inviteOrigin:n}=e,u=(0,a().tz)(),c=(0,s().v3)(),y=(0,r().uB)(e.inviteTargetsStore,x().Ay),f=(0,v().r)(),b=(0,h().HI)(),S=(0,g().A)(f),{focus:T,emailMessage:w}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),{role:A,showEmptyError:I}=(0,r().K8)((()=>{const{role:e,showEmptyError:t}=i.state;return{role:e,showEmptyError:t}}),[i]),_=(0,r().K8)((()=>t.getType()),[t]),k=(0,r().K8)((()=>i.state.flowId),[i]),j=(0,r().K8)((()=>t.canEditMembership()),[t]),R=(0,o().IS)((()=>({permissionsRoleSelectButton:{display:"flex",whiteSpace:"nowrap",height:20,margin:0,borderRadius:4,color:l().Ay.uiGray}})),[]);return f&&b&&S?(0,M.jsx)(p().A,{disableTooltip:j,renderTooltip:()=>{if(!j)return(0,M.jsx)(a().sA,{id:"shareMenu.inviteButton.fullAccessOnlyMessage.tooltip",defaultMessage:"Only those with full access can add people."})},render:e=>(0,M.jsx)("div",{style:{display:"flex"},...e,children:(0,M.jsx)(C,{inviteTargetsStore:y,store:f,disabled:!j,origin:n,flowId:k,focus:T===U().E.InviteInput,showEmptyError:I,onFocus:()=>{i.setState({...i.state,focus:U().E.InviteInput,emailMessage:w||""})},placeholder:u.formatMessage({id:"invite.person_property.inviteTargetsInput.placeholder",defaultMessage:"Add emails..."}),onInputChanged:()=>i.setState({...i.state,showEmptyError:!1}),right:(0,M.jsx)(m().Ay,{disabled:!j,role:A,table:"block",type:"user_permission",blockType:_,isInvite:!0,upgradeButtonName:"invite_permission_block",buttonStyle:R.permissionsRoleSelectButton,isMenuItem:!1,onChange:e=>{i.setState({...i.state,role:e}),d().et(c,{invited_role:e,invite_flow_id:k,origin:n})}})})})}):null}},715392:(e,t,i)=>{i.d(t,{W:()=>s});var n=()=>i(666144);const s=new(i(848776).U)((e=>{let{userId:t,spaceId:i}=e;return`${t}-${i}`}),(async function(e,t){var s;let{userId:r,spaceId:o}=t;const[a,l]=await Promise.all([n().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:i(798880).oo,id:r},userId:r}),n().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:(0,i(848538).i1)({userId:r,spaceId:o}),userId:r})]),u=null===(s=i(765957).default.state.currentSpaceViewStore)||void 0===s||null===(s=s.getModel())||void 0===s?void 0:s.first_joined_space_time,d=null==a?void 0:a.value,c=null==l?void 0:l.value;if(d&&c&&u)return{id:d.id,space_id:c.id,membership_type:c.membership_type,email:d.email,name:d.name,profile_photo:d.profile_photo,onboarding_completed:d.onboarding_completed,first_joined_space_time:u}}));i(604341).exposeDebugValue("UserOnSpaceStore",s)},875497:(e,t,i)=>{i.d(t,{A:()=>r,E:()=>n});let n=function(e){return e.InviteInput="invite_input",e.MessageInput="message_input",e.NoFocus="no_focus",e}({});class s extends(()=>i(757695))().Store{getInitialState(){return{flowId:i(206267).JW(),role:"editor",focus:n.InviteInput,emailMessage:"",isLoading:!1,showEmptyError:!1}}}const r=s},980270:(e,t,i)=>{i.r(t),i.d(t,{handleEnterPress:()=>_,handleGuestInvite:()=>w,handleMemberInvite:()=>T,handleMemberRequest:()=>A,handlePopupClickWithEmail:()=>k,inviteToSpaceAsMembers:()=>I,showMessageForInviteComplete:()=>M});i(944114),i(898992),i(354520),i(430670),i(581454),i(737550),i(296540);var n=()=>i(842599),s=()=>i(857639),r=()=>i(206267),o=()=>i(68263),a=()=>i(959013),l=()=>i(319625),u=()=>i(502800),d=()=>i(966505),c=()=>i(449506),p=()=>i(579627),m=()=>i(542056),g=()=>i(436572),v=()=>i(250064),h=()=>i(535279),y=()=>i(731320),f=()=>i(134217),x=()=>i(10984),b=()=>i(475355),S=i(474848);async function T(e){const{environment:t,onInviteComplete:i,flowId:n,intl:r,spaceStore:o,invitedUsers:a,inviteTargetsStore:c,inviteOrigin:p,disable_invite_email:m}=e;let g={success:!1};try{g=await I({environment:t,spaceStore:o,invitedUsers:a,from:p,flowId:n,intl:r,inviteTargetsStore:c,disable_invite_email:m}),g.success?d().ke(t,{invited_user_count:Object.keys(g.invitedUsers).length,invite_flow_id:n,origin:p}):(d().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:g.error}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(v){const e=(0,l().A)(v);d().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,u().convertErrorToLog)(v)})}finally{null==i||i(g)}}async function w(e){const{environment:t,blockStore:i,inviteTargetsStore:a,sudoModeStore:c,onInviteComplete:m,inviteOrigin:g,role:v,emailMessage:f,flowId:x}=e;let b={success:!1};try{if(b=await async function(e){const{environment:t,blockStore:i,sudoModeStore:s,inviteTargetsStore:a,role:l,inviteOrigin:u,emailMessage:d,onInviteStart:c}=e,m=e.flowId||r().JW();if(!(0,o().PW)(l))return{success:!1};const{tokenQuery:g,inviteTargets:v}=a.state;if((0,n().DT)(g.trim())&&0===v.length){const e={type:"newUser",value:{email:g.trim()},source:"email"};h().P4({target:e,inviteTargetsStore:a})||a.setState({inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}const f=await y().hb(i,h().U1({inviteTargetsStore:a}));null==c||c();const x=await p().eP({environment:t,store:i,sudoModeStore:s,inviteTargets:f,inviteRole:l,isOnboarding:!1,invite:{inviteFlowId:m,inviteMessage:d,inviteOrigin:u}});return x}({environment:t,blockStore:i,sudoModeStore:c,inviteTargetsStore:a,role:v,emailMessage:f,inviteOrigin:g,flowId:x}),!b.success)return}catch(S){const e=(0,l().A)(S);d().N_(t,{invite_stage:"invite_guest",invite_flow_id:x,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,u().convertErrorToLog)(S)})}finally{b.success&&d().oU(t,{invited_user_count:Object.keys(b.invitedUsers).length,origin:g,invite_flow_id:x}),null==m||m(b)}return b}async function A(e){const{environment:t,spaceStore:i,originId:n,originType:r,reasonMessage:o,intl:a,flowId:u,onInviteComplete:p,invitedUsers:m,inviteOrigin:h}=e,y=[];let f={success:!1};try{const e=Object.entries(m).map((e=>{let[s,a]=e;return c().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:a,spaceId:i.id,message:o,attributes:{origin_id:n,origin_type:r,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>y.push([s,a])))}));await Promise.all(e),f={success:!0,invitedUsers:m,requestedUsers:{}}}catch(x){const e=(0,l().A)(x);return d().N_(t,{invite_stage:"request_member",invite_flow_id:u,error:e}),function(e,t){const i=Object.keys(t);if(0===i.length)return;g().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,v().l)(i)})})}(a,m),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:y}}}),f}finally{f.success&&d().d6(t,{invited_user_count:Object.keys(f.invitedUsers).length,origin:h,invite_flow_id:u}),null==p||p(f)}return f}async function I(e){const{environment:t,spaceStore:i,from:n,invitedUsers:r,intl:o,flowId:a,onInviteStart:l,inviteTargetsStore:u,disable_invite_email:d}=e,c=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(r),m=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(u),h=[...c];for(const s of m){c.some((e=>e.value.email===s.value.email))||h.push(s)}const y=(0,x().AI)(),S=y&&(0,f().fk)(y)?"editor":e.inviteRole??"read_and_write";let T={success:!1};if(!i.isTeamsEnabled()){if(!(await b().oH({environment:t,flowId:a,trackCreateTeamComplete:!1})))return T}try{null==l||l(),T=await p().eP({environment:t,store:i,inviteTargets:h,inviteRole:S,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:d}})}catch(w){return function(e,t){0!==t.length&&g().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,v().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(o,h),s().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:h}}}),T}return T}async function _(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:s,personPropertyInviteStore:r}=e,o=i.state.tokenQuery;if(""===o)return void(0===i.state.inviteTargets.length&&s&&r.setState({...r.state,showEmptyError:!0}));const a=(0,n().C3)(o),l=await m().Ah(t,a);let u=[];0===l.length&&(u=[{type:"invalidUser",value:{text:o}}]);const d=l.filter((e=>!h().P4({inviteTargetsStore:i,target:e}))),c=[...i.state.inviteTargets,...d,...u];i.setState({...i.state,inviteTargets:c,tokenQuery:""})}function k(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},s=[...i.state.inviteTargets];h().P4({inviteTargetsStore:i,target:n})||s.push(n),i.setState({...i.state,inviteTargets:s})}function M(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?g().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,v().l)(i)}})}):g().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,v().l)(i)}})})):g().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,v().l)(i)}})})}}}]);