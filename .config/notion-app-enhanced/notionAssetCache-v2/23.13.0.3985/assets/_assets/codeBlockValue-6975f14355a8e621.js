"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[69734],{141768:(e,t,n)=>{n.d(t,{YH:()=>s,bi:()=>l});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(908872);var o=()=>n(919709),i=()=>n(496603),a=()=>n(713972);function l(e){let t="";const n=document.createElement("div");n.innerHTML=e;const o=a().zn(n);for(const a of o){const e=i().ih(a.data);if(null!==a.parentElement&&a.parentElement!==n){t+=`<span class="${r({parent:a.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function r(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function s(e,t){const n={text:d(e),syntax:d(t)},i=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let a=0,l=0;for(;a<n.length&&l<o.length;){const e=n[a],t=o[l];e===t?(i.push(e),a+=1,l+=1):e<t?(i.push(e),a+=1,o[l]-=e):(i.push(t),n[a]-=t,l+=1)}return i}(n.text,n.syntax)),a={text:0,syntax:0},l={text:0,syntax:0},r=[],s=e.map(o().N8A).join("");for(const[o,d]of i){const e=o+d,i=t[a.syntax],u={value:s.substring(o,e),textTokenIndex:a.text,classNames:(c=i,c&&c[1])};r.push(u);const m=n.text[a.text],p=n.syntax[a.syntax];e>=l.text+m&&(a.text+=1,l.text+=m),e>=l.syntax+p&&(a.syntax+=1,l.syntax+=p)}var c;return r}function d(e){return e.map((e=>e[0].length))}},849332:(e,t,n)=>{n.r(t),n.d(t,{CodeBlockValueWithDeps:()=>D});n(18107),n(967357),n(581454);var o=n(296540),i=()=>n(56366),a=()=>n(979004),l=()=>n(379632),r=()=>n(919709),s=()=>n(191772),d=()=>n(496603),c=()=>n(884107),u=()=>n(319975),m=()=>n(315097),p=()=>n(751156),g=()=>n(659602),v=()=>n(354584),f=()=>n(335722),b=()=>n(921855),k=()=>n(713972),h=()=>n(231722),S=()=>n(141768),C=()=>n(645873),x=()=>n(77246),y=()=>n(735372),M=()=>n(871399),A=n(474848);const T=1e4,w=o.memo((function(e){const{disabled:t,store:g,blockStore:v,markdownLinkifyIt:f,codeWrap:k,wrapStyle:C,tinyMceMicrosoftWordPasteFilter:w,language:D,Prism:F,parentSpaceId:P,isQuickFind:V,style:R,disableSuggestEdit:_,disableFormattingAnnotations:H,disableRichTextActions:U}=e,j=(0,n(959013).tz)(),O=(0,n(484714).v3)(),$=(0,n(401497).DP)(),L=(0,n(792485).S)(),W=(0,o.useRef)(null),q=(0,n(493720).RJ)(),K=(0,i().O$)(n(24157).default),z=(0,i().O$)(n(116008).A),J=(0,i().O$)(n(555776).A),Y=(0,i().O$)(y().qu),G=(0,i().O$)(y().wb),Q=(0,i().K8)((()=>L&&L.publicEditModeStore.state),[L]),Z=(0,i().K8)((()=>L&&L.pageStore?x().Uv.getMode(L.pageStore):"default"),[L]),X=(0,i().K8)((()=>g.canEdit()),[g]),ee=(0,i().K8)((()=>g.canComment()),[g]),te=(0,o.useMemo)((()=>{var e;return"editing"===K.mode&&(null===(e=(0,h().H7)(K.multiSelection))||void 0===e?void 0:e.store)===g}),[g,K]),ne=(0,o.useCallback)((()=>{var e;null===(e=W.current)||void 0===e||null===(e=e.getNode())||void 0===e||e.blur()}),[W]),oe=(0,o.useMemo)((()=>{var e;return z.open&&"inline"===z.type&&(null===(e=(0,h().H7)(z.multiSelection))||void 0===e?void 0:e.store)===g}),[z,g]),ie=(0,o.useCallback)((()=>{if((0,n(731320).QT)(Q))return!1;const e=null!=L&&L.pageStore?Z:"default";return!(t||"suggest"!==e||!ee)||Boolean(!t&&X)}),[t,null==L?void 0:L.pageStore,Q,Z,X,ee]),ae=(0,o.useMemo)((()=>!ie()),[ie]),le=(0,i().K8)((()=>{if(!J.isHovered||"right_margin_button"!==J.hoverEntryPoint)return!1;const e=M().default.state.isOpen?M().default.state.currentStore:void 0;return g&&(null==e?void 0:e.id)===g.id}),[g,J]),re=(0,o.useMemo)((()=>{const e=(0,n(792540).wc)(G)&&G.id===g.id;return{query:Y,focusedResult:e?G:void 0}}),[G,Y,g.id]),se=(0,o.useCallback)(((e,t)=>{(0,n(267856).D)({type:e,environment:O,blockStore:v,store:g,isInCollectionView:!1,eventTimeStamp:t})}),[O,v,g]),de=(0,o.useCallback)((e=>{var t,o;if(!ie)return;if(se("typing_enter",e.timeStamp),null===(t=e.preventDefault)||void 0===t||t.call(e),W&&null!==(o=W.current)&&void 0!==o&&o.isComposing())return;const i="editing"===K.mode&&(0,h().H7)(K.multiSelection);if(i){const e=null!=L&&L.pageStore?Z:"default";!function(e){const{environment:t,editorMode:o,store:i,selection:a}=e;let l="";if(n(217429).default.checkGate({gateName:"code_block_preserve_indent"})){const e=r().Ffo(i.getValue(),0,a.startIndex),t=r().q4_(e).split("\n").at(-1),n=null==t?void 0:t.match(/^[ \t]+/);n&&(l=n[0])}p().createAndCommit({userAction:"CodeBlockValue.handleEnter",environment:t,canUndo:!0,perform:e=>{u().$D({environment:t,editorMode:o,store:i,string:`\n${l}`,selection:a,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})}({environment:O,store:g,editorMode:e,selection:i.selection})}}),[g,O,se,L,W,ie,K,Z]),ce=(0,o.useCallback)((e=>{var t;b().HP({environment:O,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:oe,isRightMarginCommentActionHovered:le}),editorNode:(null===(t=W.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:ie()})}),[g,O,v,ie,re,W,oe,le]),ue=(0,o.useCallback)((e=>{if(ie()&&(se("typing_delete",e.timeStamp),"editing"===K.mode&&K.multiSelection.start.store===g)){const t=null!=L&&L.pageStore?Z:"default";p().createAndCommit({userAction:"CodeBlockValue.handleDelete",environment:O,canUndo:!0,perform:n=>{m().wT({environment:O,multiSelection:K.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:t})}})}}),[O,g,se,ie,L,K,Z]),me=(0,o.useCallback)((e=>{if(ie()&&(se("typing_backspace",e.timeStamp),"editing"===K.mode&&K.multiSelection.start.store===g)){if(m().CZ({device:O.device,event:e,multiSelection:K.multiSelection}))return;const t=null!=L&&L.pageStore?Z:"default";p().createAndCommit({userAction:"CodeBlockValue.handleBackspace",environment:O,canUndo:!0,perform:n=>{m().wT({environment:O,multiSelection:K.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:t})}})}}),[O,g,se,ie,L,K,Z]),pe=(0,o.useCallback)((e=>{var t;if(ie()&&(se("typing_enter",e.timeStamp),null===(t=e.preventDefault)||void 0===t||t.call(e),"editing"===K.mode)){const e=null!=L&&L.pageStore?Z:"default";p().createAndCommit({userAction:"CodeBlockValue.handleShiftEnter",environment:O,canUndo:!0,perform:t=>{n(261374).Ve({environment:O,editorMode:e,multiSelection:K.multiSelection,transaction:t})}}),E()}}),[O,se,ie,null==L?void 0:L.pageStore,K,Z]),ge=(0,o.useCallback)((e=>{if(!ie())return;se("typing_tab",e.timeStamp),e.preventDefault();const t="editing"===K.mode&&(0,h().H7)(K.multiSelection);if(t){const e=null!=L&&L.pageStore?Z:"default";p().createAndCommit({userAction:"CodeBlockValue.handleTab",environment:O,canUndo:!0,perform:n=>{u().RJ({environment:O,editorMode:e,store:g,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[O,g,se,ie,null==L?void 0:L.pageStore,K,Z]),ve=(0,o.useCallback)((e=>{if(!ie())return;se("typing_untab",e.timeStamp),e.preventDefault();const t="editing"===K.mode&&(0,h().H7)(K.multiSelection);if(t){const e=null!=L&&L.pageStore?Z:"default";p().createAndCommit({userAction:"CodeBlockValue.handleUntab",environment:O,canUndo:!0,perform:n=>{u().Ye({environment:O,editorMode:e,store:g,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[O,g,se,ie,L,K,Z]),fe=(0,o.useCallback)((async e=>{if(!ie())return void e.preventDefault();(await c().R.clipboardActions.load()).cutWithMaybeConfirmation({environment:O,event:e,markdownLinkifyIt:f})}),[O,f,ie]),be=(0,o.useCallback)((async e=>{if(!ie())return void e.preventDefault();const t=await c().R.clipboardActions.load();p().createAndCommit({userAction:"CodeBlockValue.handlePaste",environment:O,canUndo:!0,perform:o=>{(0,n(675925).o)(O,{action:"paste",block_type:null==v?void 0:v.getType(),from:"keyboard_shortcut"},(n=>{t.paste({environment:O,event:e,disableEmbedMenu:!0,transaction:o,onPasteFiles:t.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:f,tinyMceMicrosoftWordPasteFilter:w}),n()}))}})}),[O,f,w,ie,v]),ke=(0,o.useCallback)((e=>{var t;b().sp({environment:O,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:oe,isRightMarginCommentActionHovered:le}),editorNode:(null===(t=W.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:ie()})}),[ie,O,re,W,g,v,oe,le]),he=(0,o.useCallback)((e=>{var t;b().W5({environment:O,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:oe,isRightMarginCommentActionHovered:le}),editorNode:(null===(t=W.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:ie()})}),[re,g,v,oe,le,W,ie,O]),Se=(0,o.useCallback)((()=>{if(te)return(0,n(792002).Do)(g)}),[te,g]),Ce=(0,o.useCallback)((()=>{const e=n(634201).PE(r().q4_(N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:oe,isRightMarginCommentActionHovered:le})));return{startIndex:e.length,endIndex:e.length}}),[g,v,re,oe,le]),xe=(0,o.useRef)(),ye=(0,o.useCallback)((()=>{const e=N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:oe,isRightMarginCommentActionHovered:le}),t=r().q4_(e),i=F.languages[D];D!==a().PrismLanguages.html&&D!==a().PrismLanguages.markup||(F.languages.markup.tag.addInlined("style","css"),F.languages.markup.tag.addInlined("script","javascript"));const c=t.length>=T,u=xe.current;if(xe.current=t.length,t&&i&&!c){const n=document.createElement("div"),a=F.highlight(t,i,D);n.innerHTML=S().bi(a);const c=Array.from(n.childNodes).map(B),u=function(e){let{syntaxTokens:t,textValue:n,parentSpaceId:o,store:i,theme:a}=e;const l=(0,s().E7)(n&&{value:n,spaceId:o},i.getRecordModel),d=S().YH(l,t),c=l.map(r().uPN).map((e=>(0,s().sT)({annotations:e,theme:a,spaceId:o,getRecordModel:i.getRecordModel})));return d.map(((e,t)=>(0,A.jsx)("span",{className:[e.classNames||"",...c[e.textTokenIndex].classNames].join(" "),style:c[e.textTokenIndex].style,"data-token-index":e.textTokenIndex,children:e.value},t)))}({parentSpaceId:P,store:g,syntaxTokens:d().oE(c),textValue:e,theme:$}),m=(0,A.jsxs)(o.Fragment,{children:[u,(0,A.jsx)("span",{children:"\n"})]});return l().A.renderToStaticMarkup(m)}c&&"number"==typeof u&&u<T&&function(e){const{intl:t}=e,o=new Intl.NumberFormat(t.locale),i=o.format(T);n(812182).HK({presentationType:"transient",title:t.formatMessage({id:"codeBlock.maxChars.toast.title",defaultMessage:"Code highlighting disabled"}),message:t.formatMessage({id:"codeBlock.maxChars.toast.message",defaultMessage:"Syntax highlighting is not supported for more than {numBlocks} characters"},{numBlocks:i})})}({intl:j});const m=b().S5({environment:O,textValue:e&&{value:e,spaceId:P},parentStore:g,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!1,disabled:!ie(),theme:$,emojiType:"raw",katex:void 0,formulaValueTypes:[]});return l().A.renderToStaticMarkup((0,A.jsx)(A.Fragment,{children:m}))}),[re,g,v,oe,le,O,ie,P,F,D,$,j]),Me=(0,o.useCallback)((()=>{p().createAndCommit({userAction:"CodeBlockValue.handleMoveUp",environment:O,canUndo:!0,perform:e=>{u().$P({environment:O,transaction:e,direction:"up"})}})}),[O]),Ae=(0,o.useCallback)((()=>{p().createAndCommit({userAction:"CodeBlockValue.handleMoveDown",environment:O,canUndo:!0,perform:e=>{u().$P({environment:O,transaction:e,direction:"down"})}})}),[O]),Te=(0,o.useCallback)(((e,t)=>{ie()&&(t.preventDefault(),n(482287).po({environment:O,annotation:e}),E())}),[ie,O]),we=(0,o.useCallback)((e=>{const{newValue:t}=e;se("typing_lag",e.timeStamp);const n=null!=L&&L.pageStore?x().Uv.getMode(null==L?void 0:L.pageStore):"default";p().createAndCommit({userAction:"CodeBlockValue.handleMutation",environment:O,canUndo:!0,perform:e=>{u().dw({environment:O,editorMode:n,store:g,newValue:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e})}})}),[se,O,g,null==L?void 0:L.pageStore]),De=(0,o.useCallback)((async e=>{(await c().R.clipboardActions.load()).copy({environment:O,event:e,markdownLinkifyIt:f})}),[O,f]),Ee=(0,o.useCallback)(((e,t,o)=>{let{leafRef:i,wrapperRef:a,...l}=e;if(W)return(0,A.jsx)("div",{ref:a,style:{display:"flex",padding:"12px 0px",...!k&&{overflowX:"auto",WebkitOverflowScrolling:"touch"},...C},className:"line-numbers notion-code-block",...l,children:(0,A.jsx)(n(477450).A,{leafRef:q(W,i),style:{...I($,R),...V&&{paddingTop:12},...k?{whiteSpace:"break-spaces",wordBreak:"break-all",minWidth:0}:{whiteSpace:"pre"}},debugName:"CodeBlockValue",store:g,isDisabled:ae,getHtml:ye,getSelection:Se,onMutation:e=>we(e),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:ke,onMouseOut:he,suppressNewlineEvents:!1,placeholder:" ",disableContentEditableWhenNotEditingTextOnMobile:!0,expandSelectionOnTripleClick:!1})})}),[V,k,C,$,R,ae,ye,Se,we,ke,he,q,W,g]);return(0,A.jsx)(n(682372).F,{store:g,disabled:t,clearBrowserSelection:ne,onBlur:ne,getEndSelection:Ce,onClick:ce,onDelete:ue,onBackspace:me,onEnter:de,onShiftEnter:pe,onCommandEnter:d().D_,onCommandShiftEnter:d().D_,onTab:ge,onUntab:ve,onToggleHighlight:e=>Te(["h",n(77272).A.getMostRecentlyUsedColor()],e),onToggleBold:e=>Te(["b"],e),onToggleItalics:e=>Te(["i"],e),onToggleUnderline:e=>Te(["_"],e),onToggleStrike:e=>Te(["s"],e),onToggleCode:d().D_,onCopy:e=>De(e),onCut:fe,onPaste:be,onMoveUp:Me,onMoveDown:Ae,render:Ee,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,topBottomPadding:22,pasteBehavior:"inline",disableSuggestEdit:_,disableFormattingAnnotations:H,disableRichTextActions:U})}));function D(e){const{value:t}=(0,C().fJ)(v().y),{value:n}=(0,C().fJ)(g().g),{value:o}=(0,C().fJ)(f().S);return t?(0,A.jsx)(w,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function E(){n(908006).default.flush()}function B(e){return k().KH(e)?[e.data]:k().vq(e)?[e.textContent||"",e.className]:void 0}function I(e,t){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:n(284371).vc(n(662303).locale).githubMono,fontSize:"85%",tabSize:2,minHeight:"1em",color:e.text.primary,...t}}function N(e){const{store:t,blockStore:n,inPageFindDetails:o,isNewDiscussionMenuTarget:i,isRightMarginCommentActionHovered:a}=e;let l=t.getValue();if(o.query&&(l=b().nu({textValue:l,blockId:null==n?void 0:n.id,find:o.query,textProps:{type:"block_match"},currentFocusedResult:o.focusedResult})),a){const e=r().qAZ(l);return b().PB({store:t,temporaryAnnotation:r().Ifu.TemporarySelection,multiSelection:{start:{store:t,index:0},end:{store:t,index:e.length}}})}return i?b().Fm({store:t}):l}}}]);