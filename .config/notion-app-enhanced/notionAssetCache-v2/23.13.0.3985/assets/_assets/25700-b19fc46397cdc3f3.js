"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25700],{300451:(e,t,n)=>{n.d(t,{A:()=>a});class i extends(()=>n(757695))().Store{getInitialState(){return{settingOpen:"initial",permissionItem:void 0,from:void 0,sudoModeStore:void 0,location:"",faviconUrl:null,previewImageUrl:null,hideBreadcrumbs:!1,hideSearch:!1,hideWatermark:!1,enableDuplicateAsTemplate:!1,hideShare:!1,customHeaderBlockIds:[],googleAnalyticsId:void 0,theme:void 0,enableQna:!1}}}const a=new i},435212:(e,t,n)=>{n.d(t,{Kz:()=>o,Sc:()=>r,as:()=>a});var i=()=>n(2220);function a(e,t){(0,i().u)({environment:e,event:{eventName:"open_customize_site",eventProperties:t}})}function o(e,t){(0,i().u)({environment:e,event:{eventName:"update_site_customization_settings",eventProperties:t}})}function r(e){(0,i().u)({environment:e,event:{eventName:"close_customize_site",eventProperties:{}}})}},525700:(e,t,n)=>{n.d(t,{Bp:()=>P,DD:()=>R,E9:()=>$,H6:()=>H,HE:()=>M,HY:()=>x,JI:()=>G,Nf:()=>Y,P8:()=>X,V_:()=>K,XL:()=>z,Xz:()=>F,aD:()=>C,aN:()=>q,d7:()=>j,d8:()=>D,j4:()=>J,n0:()=>L,pu:()=>W,sd:()=>V,uH:()=>T,uY:()=>Z,wl:()=>N,yF:()=>Q,zV:()=>E});n(16280),n(944114),n(898992),n(354520),n(581454),n(296540);var i=()=>n(68263),a=()=>n(161479),o=()=>n(101628),r=()=>n(245241),s=()=>n(959013),d=()=>n(496603),l=()=>n(498212),c=()=>n(449506),u=()=>n(496414),m=()=>n(246826),p=()=>n(755636),g=()=>n(436572),v=()=>n(751156),h=()=>n(780054),S=()=>n(594794),f=()=>n(976721),I=()=>n(562800),b=()=>n(40226),A=()=>n(380682),y=()=>n(300451),U=()=>n(676870),_=()=>n(435212),k=n(474848);const w=(0,s().YK)({savingSiteSettings:{id:"siteSettingsActions.publishingSiteSettings.loadingMessage",defaultMessage:"Saving site settingsâ€¦"}});function D(e){const{environment:t,store:n,type:i,header:r,domainId:s}=e,d=n.getSiteStore();if(d)return d.id;let l=s;var c;l||(l=null===(c=I().Nq(n.getSpaceStore()))||void 0===c?void 0:c.id);const u=(0,S().JH)({environment:t,table:o().Eu,spaceId:(0,a().e)(n.getSpaceId())});v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const a=m().vt({environment:t,table:u.table,args:{id:u.id,type:i,spaceId:u.spaceId,blockId:n.id,domainId:l,currentUserId:t.currentUser.id,header:r??{}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e});return m().zv({store:n.getFormatStore(),data:{site_id:a.id},transaction:e}),a.id}})}function B(e){const{environment:t,siteRootBlockStore:n,domainId:i}=e;let a=n.getSiteStore();if(a||(D({environment:t,type:"site",store:n,domainId:i}),a=n.getSiteStore()),a)return a}function E(e){const{environment:t,domainId:n,resetWatermark:i}=e,a=B(e);a&&a.isDefined()&&(v().createAndCommit({userAction:"publishSite.updatePublicDomain",environment:t,canUndo:!0,perform:e=>{a.getDomainId()!==n&&v().applyOperation({transaction:e,store:a,operation:a.getModel().ops.updatePublicDomainId({domainId:n,currentUserId:t.currentUser.id})})}}),v().createAndCommit({userAction:"publishSite.resetWatermark",environment:t,canUndo:!0,perform:e=>{if(i){const n=a.getHeader();v().applyOperation({transaction:e,store:a,operation:a.getModel().ops.updateHeader({header:{...n,hideWatermark:!1},currentUserId:t.currentUser.id})})}}}),g().D6({label:(0,k.jsx)(s().sA,{id:"publishSiteSettings.publicDomain.confirmation",defaultMessage:"Successfully updated domain for all pages within this site"})}))}function H(e){const{environment:t,siteRootBlockStore:n,isSearchEngineIndexingEnabled:i}=e,o=B(e);if(!o)return;"form"!==o.getType()&&v().createAndCommit({userAction:"publishSite.updateSeoEnabled",environment:t,canUndo:!0,perform:e=>{o&&o.isDefined()&&i!==o.isSearchEngineIndexingEnabled()&&(v().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updateIsSearchEngineIndexingEnabled({isSearchEngineIndexingEnabled:i,currentUserId:t.currentUser.id})}),i&&e.postSubmitCallbacks.push((async e=>{e||await c().callApi({eventName:"enqueueScanContentTask",environment:t,data:{pagePointer:{id:n.id,table:"block",spaceId:(0,a().e)(n.pointer.spaceId)}}})})))}})}function M(e){const{environment:t,store:n,seoTitle:i,seoDescription:a}=e;v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const o=n.getFormat().seo_title,r=n.getFormat().seo_description;o===i&&r===a||(m().zv({store:n.getFormatStore(),data:{seo_title:i,seo_description:a},transaction:e}),(0,U().NZ)(t,{target_block_id:n.id,new_title:i??null,new_description:a??null}),g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishSeoChanges.confirmation",defaultMessage:"Successfully updated the SEO settings"})}))}})}function C(e){y().A.setState({...y().A.state,settingOpen:e})}function N(){y().A.setState({...y().A.state,settingOpen:"initial"})}function P(e){A().A.setState({...A().A.state,siteSettingContentType:e})}function x(e){var t,n,i;const{siteRootBlockStore:a,permissionItem:o,from:r,sudoModeStore:s}=e,d=a.getSiteStore(),l=null==d?void 0:d.getHeader(),c=(null==l||null===(t=l.customItems)||void 0===t?void 0:t.map((e=>e.blockId)))||[];y().A.setState({settingOpen:"initial",permissionItem:o,from:r,sudoModeStore:s,faviconUrl:(null==d?void 0:d.getFaviconUrl())||null,previewImageUrl:(null==d?void 0:d.getPreviewImageUrl())||null,hideBreadcrumbs:null==l?void 0:l.hideBreadcrumbs,hideSearch:null==l?void 0:l.hideSearch,hideShare:null==l?void 0:l.hideShare,hideWatermark:null==l?void 0:l.hideWatermark,enableDuplicateAsTemplate:o.allow_duplicate,customHeaderBlockIds:c,googleAnalyticsId:null==d?void 0:d.getGoogleAnalyticsId(),theme:null==d||null===(n=d.getSettings())||void 0===n?void 0:n.theme,enableQna:null==d||null===(i=d.getSettings())||void 0===i?void 0:i.enableQna})}async function T(e){var t;const{environment:n,store:a,siteRootBlockStore:o}=e,r=B({environment:n,siteRootBlockStore:o}),d=null==r?void 0:r.getType();if(!r||"form"===d)return;const m=y().A.getState(),p={},h=function(e,t){var n,i,a,o,r,s,d,l;const c=O(e.customHeaderBlockIds,null===(n=t.getHeader())||void 0===n?void 0:n.customItems);return e.faviconUrl!==(t.getFaviconUrl()||null)||e.previewImageUrl!==(t.getPreviewImageUrl()||null)||c||e.hideBreadcrumbs!==(null===(i=t.getHeader())||void 0===i?void 0:i.hideBreadcrumbs)||e.hideSearch!==(null===(a=t.getHeader())||void 0===a?void 0:a.hideSearch)||e.hideShare!==(null===(o=t.getHeader())||void 0===o?void 0:o.hideShare)||e.hideWatermark!==(null===(r=t.getHeader())||void 0===r?void 0:r.hideWatermark)||e.googleAnalyticsId!==t.getGoogleAnalyticsId()||e.theme!==(null===(s=t.getSettings())||void 0===s?void 0:s.theme)||e.enableQna!==(null===(d=t.getSettings())||void 0===d?void 0:d.enableQna)||(null===(l=e.permissionItem)||void 0===l?void 0:l.allow_duplicate)!==e.enableDuplicateAsTemplate&&e.permissionItem&&e.from}(m,r);if(!h)return;let S;if(u().m({message:w.savingSiteSettings}),m.enableQna)try{S=await async function(e){var t,n,i,a;const{environment:o,siteStore:r}=e,s=null===(t=r.getSettings())||void 0===t?void 0:t.siteUserId;if(s)return s;if(!((null===(n=r.getDomainStore())||void 0===n?void 0:n.getDomainName())??(null===(i=I().Nq(r.getSpaceStore()))||void 0===i?void 0:i.domain_name)))throw new Error("no domain on site");const d=I().Ix({spaceStore:r.getSpaceStore(),domainId:null===(a=r.getDomainStore())||void 0===a?void 0:a.id}).split(":")[0],u=`${(0,l().S2)(r.id)}@${d}`,m=await c().callApi({eventName:"createEmailUser",environment:o,data:{email:u}});if("failed"===m.type)throw new Error("failed to create qna user");return m.data.userId}({environment:n,siteStore:r})}catch{return u().V(),void g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.failure",defaultMessage:"Something went wrong, please try again later"})})}const{serverCommitResult:b}=v().createAndCommit({userAction:"publishSite.updateSiteSettingsInEditor",environment:n,canUndo:!0,perform:e=>{if(r&&r.isDefined()){var t,i;(r.getFaviconUrl()||null)!==m.faviconUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateFaviconUrl({faviconUrl:m.faviconUrl,currentUserId:n.currentUser.id})}),p.favicon=m.faviconUrl);(r.getPreviewImageUrl()||null)!==m.previewImageUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updatePreviewImageUrl({previewImageUrl:m.previewImageUrl,currentUserId:n.currentUser.id})}),p.preview_image=m.previewImageUrl);const a=r.getHeader();let o=a;const s=O(m.customHeaderBlockIds,null==a?void 0:a.customItems);s&&(o={...o,customItems:s},p.custom_headers=s.map((e=>e.blockId))),(null==a?void 0:a.hideBreadcrumbs)!==m.hideBreadcrumbs&&(o={...o,hideBreadcrumbs:m.hideBreadcrumbs},p.hide_breadcrumbs=m.hideBreadcrumbs),(null==a?void 0:a.hideSearch)!==m.hideSearch&&(o={...o,hideSearch:m.hideSearch},p.hide_search=m.hideSearch),(null==a?void 0:a.hideShare)!==m.hideShare&&(o={...o,hideShare:m.hideShare},p.hide_share=m.hideShare),(null==a?void 0:a.hideWatermark)!==m.hideWatermark&&(o={...o,hideWatermark:m.hideWatermark},p.hide_watermark=m.hideWatermark),o&&a!==o&&v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateHeader({header:o,currentUserId:n.currentUser.id})});r.getGoogleAnalyticsId()!==m.googleAnalyticsId&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateGoogleAnalyticsId({googleAnalyticsId:m.googleAnalyticsId,currentUserId:n.currentUser.id})}),p.google_analytics_id=m.googleAnalyticsId);(null===(t=r.getSettings())||void 0===t?void 0:t.theme)!==m.theme&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateTheme({theme:m.theme,currentUserId:n.currentUser.id})}),p.theme=m.theme);(null===(i=r.getSettings())||void 0===i?void 0:i.enableQna)!==m.enableQna&&(m.enableQna?S&&v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna,siteUserId:S}}}):v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna}}}))}}});try{await b}catch{return u().V(),void g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.failure",defaultMessage:"Something went wrong, please try again later"})})}if((null===(t=m.permissionItem)||void 0===t?void 0:t.allow_duplicate)!==m.enableDuplicateAsTemplate&&m.permissionItem&&m.from){const e=(0,i().Yi)(m.from);if(!(await(0,f().Hc)({oldPermissionItem:m.permissionItem,newPermissionItem:{...m.permissionItem,allow_duplicate:m.enableDuplicateAsTemplate},wasInherited:e!==a.id,environment:n,store:a,sudoModeStore:m.sudoModeStore,location:"published_site_settings"})))return u().V(),void g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.failure",defaultMessage:"Something went wrong, please try again later"})});p.enable_duplicate_as_template=m.enableDuplicateAsTemplate}u().V(),(0,_().Kz)(n,{settings_changed:p}),g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.confirmation",defaultMessage:"Changes published"})})}function O(e,t){const n=e.map((e=>({type:"block",blockId:e})));if((t||0!==n.length)&&(!t||!(0,d().n4)(n,t)))return n}function W(e){y().A.setState({...y().A.state,faviconUrl:e})}function Q(e){y().A.setState({...y().A.state,previewImageUrl:e})}function R(e){y().A.setState({...y().A.state,hideBreadcrumbs:e})}function z(e){y().A.setState({...y().A.state,hideSearch:e})}function F(e){y().A.setState({...y().A.state,hideWatermark:e})}function V(e){y().A.setState({...y().A.state,hideShare:e})}function j(e){y().A.setState({...y().A.state,enableDuplicateAsTemplate:e})}function q(e){const t=y().A.state.customHeaderBlockIds.concat([e]);y().A.setState({...y().A.state,customHeaderBlockIds:t})}function G(e){const t=y().A.state.customHeaderBlockIds.filter((t=>t!==e));y().A.setState({...y().A.state,customHeaderBlockIds:t})}function Y(e){y().A.setState({...y().A.state,googleAnalyticsId:e})}function K(e){y().A.setState({...y().A.state,theme:e})}async function J(e){const{environment:t,spaceStore:n,query:i,siteRootBlockId:a}=e;if(!n)return;const o=await c().callApi({eventName:"searchPagesInSite",environment:t,data:{query:i,spaceId:n.id,filters:r().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,editedBy:[],ancestors:[a],inTeams:[]}),sort:{field:"relevance"},limit:10}});return"failed"!==o.type?o.data:void 0}async function L(e){const{environment:t,blockStore:n,slug:i}=e,a=await c().callApi({eventName:"updatePublicPageSlug",environment:t,data:{spaceId:n.getSpaceId(),blockId:n.id,slug:i,clientVersion:h().A.version}});if("success"!==a.type)return{error:a};g().D6({label:(0,k.jsx)(s().sA,{id:"customSlugInput.updateSuccess.toast",defaultMessage:"Successfully updated URL for this page"})})}function X(e){y().A.setState({...y().A.state,enableQna:e})}function Z(e){const{environment:t,store:n,pageVisitSource:i}=e,a=b().R({store:n,pageVisitSource:i});p().f({environment:t,url:a})}function $(e){const{environment:t,siteStore:n,embedSettings:i}=e;v().createAndCommit({userAction:"embedSite.updateEmbedSettings",environment:t,canUndo:!0,perform:e=>{m().zv({store:n.getSettingsStore(),data:{embedSettings:i},transaction:e})}})}},676870:(e,t,n)=>{n.d(t,{EN:()=>a,Ex:()=>o,NZ:()=>r,T6:()=>d,i_:()=>s,kW:()=>l});var i=()=>n(2220);function a(e,t){(0,i().u)({environment:e,event:{eventName:"open_publish_modal",eventProperties:t}})}function o(e,t){(0,i().u)({environment:e,event:{eventName:"change_domain",eventProperties:t}})}function r(e,t){(0,i().u)({environment:e,event:{eventName:"update_seo_settings",eventProperties:t}})}function s(e,t){(0,i().u)({environment:e,event:{eventName:"site_set_link_expiration",eventProperties:t}})}function d(e,t){(0,i().u)({environment:e,event:{eventName:"page_unpublish",eventProperties:t}})}function l(e,t){(0,i().u)({environment:e,event:{eventName:"page_publish",eventProperties:t}})}}}]);