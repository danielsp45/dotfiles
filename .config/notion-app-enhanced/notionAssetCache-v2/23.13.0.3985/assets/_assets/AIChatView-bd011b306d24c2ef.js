"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[47108],{70128:(e,t,r)=>{r.d(t,{M:()=>i});var a=r(296540),s=()=>r(484714),n=()=>r(496603),o=()=>r(36951);function i(e){const{textValue:t,isEnabled:r,clientStore:i,configs:c}=e,l=(0,s().v3)(),d=(0,a.useCallback)((()=>{r&&t&&!i.state.userSelectedConfig&&(0,o().xh)({environment:l,clientStore:i,message:t,configs:c})}),[t,i,c,l,r]),p=(0,a.useMemo)((()=>(0,n().sg)(d,200)),[d]);(0,a.useEffect)((()=>()=>{p.cancel()}),[p]),(0,a.useEffect)((()=>{r&&p()}),[t,r,p])}},94701:(e,t,r)=>{r.r(t),r.d(t,{checkmarkFillIcon:()=>s,iconDefinition:()=>a});r(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.66 3.66 12.68 12.68",svg:(0,r(474848).jsx)("path",{d:"M15.913 3.787a.875.875 0 0 1 .3 1.2L9.658 15.914a.875.875 0 0 1-1.415.119l-4.37-5.098a.875.875 0 0 1 1.329-1.14l3.58 4.177 5.93-9.884a.875.875 0 0 1 1.2-.3"})},s=(0,r(340498).wt)("checkmarkFill",a)},124749:(e,t,r)=>{r.d(t,{$:()=>n});var a=()=>r(56366);const s=new(r(496506).ComputedStore)((()=>r(765957).default.state.currentUserStore),{debugName:"AppStoreCurrentUserStore"});function n(){return(0,a().O$)(s)}},278105:(e,t,r)=>{r.d(t,{i:()=>n});var a=r(296540),s=()=>r(725614);function n(e){const{textStore:t,initialFocus:r}=e,n=(0,a.useCallback)((()=>{s().setSelectionAtEnd({store:t})}),[t]);return(0,a.useEffect)((()=>{r&&n()}),[r,n]),n}},308903:(e,t,r)=>{r.d(t,{l:()=>S});var a=r(296540),s=()=>r(484714),n=()=>r(56366),o=()=>r(401497),i=()=>r(370657),c=()=>r(12193),l=()=>r(959013),d=()=>r(2220),p=()=>r(285790),u=()=>r(859428),g=()=>r(553965),m=()=>r(962730),h=()=>r(390898),f=r(474848);const y=(0,l().YK)({tooltipLabel:{id:"aiInferenceTranscript.webSearchButton.tooltipLabel",defaultMessage:"Web sources"},webSearchDownTooltip:{id:"aiInferenceTranscript.webSearchButton.webSearchDownTooltip",defaultMessage:"Web search is currently unavailable"}});function S(e){const{clientStore:t,webSearchDown:r,threadStore:S}=e,v=(0,s().v3)(),b=(0,l().tz)(),x=(0,n().K8)((()=>t.state.configForNewTranscripts),[t]),C=(0,a.useMemo)((()=>(0,i().bm)(x)&&x.useWebSearch),[x]),w=(0,a.useCallback)((()=>{if((0,i().bm)(x)){const e=!x.useWebSearch,r={...x,useWebSearch:e};t.setState({...t.state,configForNewTranscripts:r}),S&&(0,h().kh)({threadStore:S,config:r,environment:v}),(0,d().u)({environment:v,event:{eventName:"clicked_ai_chat_toggle_web_search_button",eventProperties:{mode:x.type,enabled_web_search:e}}})}}),[t,x,v,S]),I=(0,o().IS)((e=>({icon:{width:20,height:20,transition:"fill 150ms ease"},buttonHovered:{backgroundColor:C?e.palette.uiBlue[50]:void 0},buttonPressed:{backgroundColor:C?e.palette.uiBlue[100]:void 0}})),[C]);return(0,f.jsx)(u().A,{placement:m().W.Bottom,alignment:m().C.Start,renderTooltip:()=>r?(0,f.jsx)(l().sA,{...y.webSearchDownTooltip}):(0,f.jsx)(l().sA,{...y.tooltipLabel}),render:e=>(0,f.jsx)(p().A,{disabled:r,...(0,g().A)(e,{onClick:w}),ariaLabel:b.formatMessage(y.tooltipLabel),icon:c().globeIcon,iconStyle:I.icon,color:C?"uiBluePrimary":"tertiary",size:"md",hoveredStyle:I.buttonHovered,pressedStyle:I.buttonPressed})})}},383286:(e,t,r)=>{r.d(t,{E:()=>s});r(296540);var a=r(474848);const s=(0,r(340498).wt)("microphone",{viewBox:"0 0 17 25",svg:(0,a.jsx)("path",{d:"M0.20752 12.0743C0.20752 13.5496 0.511882 14.853 1.12061 15.9845C1.72933 17.116 2.57438 18.0219 3.65576 18.7023C4.73714 19.3826 5.98324 19.7908 7.39404 19.9269V22.129H3.45166C3.17236 22.129 2.93245 22.2257 2.73193 22.4191C2.53141 22.6196 2.43115 22.8595 2.43115 23.1388C2.43115 23.4109 2.53141 23.6437 2.73193 23.837C2.93245 24.0376 3.17236 24.1378 3.45166 24.1378H13.313C13.5923 24.1378 13.8322 24.0376 14.0327 23.837C14.2332 23.6437 14.3335 23.4109 14.3335 23.1388C14.3335 22.8595 14.2332 22.6196 14.0327 22.4191C13.8322 22.2257 13.5923 22.129 13.313 22.129H9.37061V19.9269C10.7814 19.7908 12.0239 19.3826 13.0981 18.7023C14.1795 18.0219 15.0246 17.116 15.6333 15.9845C16.242 14.853 16.5464 13.5496 16.5464 12.0743V9.94739C16.5464 9.66809 16.4461 9.43176 16.2456 9.2384C16.0522 9.04504 15.8159 8.94836 15.5366 8.94836C15.2573 8.94836 15.0174 9.04504 14.8169 9.2384C14.6164 9.43176 14.5161 9.66809 14.5161 9.94739V11.9991C14.5161 13.2166 14.2583 14.2837 13.7427 15.2003C13.2271 16.1098 12.5109 16.8152 11.5942 17.3165C10.6776 17.8178 9.60693 18.0685 8.38232 18.0685C7.16488 18.0685 6.09424 17.8178 5.17041 17.3165C4.24658 16.8152 3.52686 16.1098 3.01123 15.2003C2.50277 14.2837 2.24854 13.2166 2.24854 11.9991V9.94739C2.24854 9.66809 2.14827 9.43176 1.94775 9.2384C1.74723 9.04504 1.50374 8.94836 1.21729 8.94836C0.94515 8.94836 0.708822 9.04504 0.508301 9.2384C0.30778 9.43176 0.20752 9.66809 0.20752 9.94739V12.0743ZM8.38232 15.8448C9.10563 15.8448 9.75016 15.6766 10.3159 15.34C10.8888 14.9962 11.3364 14.5236 11.6587 13.922C11.9881 13.3204 12.1528 12.6222 12.1528 11.8273V4.59778C12.1528 3.80286 11.9881 3.10461 11.6587 2.50305C11.3364 1.90149 10.8888 1.43241 10.3159 1.09583C9.75016 0.752075 9.10563 0.5802 8.38232 0.5802C7.65902 0.5802 7.0109 0.752075 6.43799 1.09583C5.87223 1.43241 5.42464 1.90149 5.09521 2.50305C4.76579 3.10461 4.60107 3.80286 4.60107 4.59778V11.8273C4.60107 12.6222 4.76579 13.3204 5.09521 13.922C5.42464 14.5236 5.87223 14.9962 6.43799 15.34C7.0109 15.6766 7.65902 15.8448 8.38232 15.8448Z"})})},432229:(e,t,r)=>{r.d(t,{P:()=>M});r(581454),r(296540);var a=()=>r(560198),s=()=>r(401497),n=()=>r(995847),o=()=>r(84817),i=()=>r(704152),c=()=>r(493823),l=()=>r(864943),d=()=>r(8980),p=()=>r(460292),u=()=>r(554509),g=r(474848);function m(e){const t=(0,s().IS)((e=>({background:{position:"absolute",top:8,right:8,width:24,height:24,borderRadius:"100%",background:e.surface.contrast},button:{width:"100%",height:"100%",borderRadius:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"transparent"},hovered:{background:e.buttonHoveredBackground},pressed:{background:e.buttonPressedBackground}})),[]);return(0,g.jsx)("div",{style:t.background,children:(0,g.jsx)(i().A,{onClick:e.onClick,style:t.button,hoveredStyle:t.hovered,pressedStyle:t.pressed,children:(0,g.jsx)(d().I,{icon:n().xMarkSmallIcon,size:"sm",color:"primary"})})})}function h(e){const{text:t,onClick:r}=e,a=(0,s().IS)((e=>({button:{height:28,padding:"0 8px",borderRadius:6,borderWidth:1,borderColor:e.stroke.primary,borderStyle:"solid"}})),[]);return(0,g.jsx)(l().A,{size:"lg",onClick:r,style:a.button,children:(0,g.jsx)(u().D,{styleName:"UISmall-12px/Medium",colorName:"primary",children:t})})}function f(e){const{text:t,onClick:r}=e;return(0,g.jsx)(c().p,{onClick:r,children:(0,g.jsx)(u().D,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:t})})}function y(e){const{text:t,onClick:r}=e,a=(0,s().IS)((()=>({button:{height:28,padding:"4px 8px"}})),[]);return(0,g.jsx)(l().A,{size:"lg",onClick:r,style:a.button,children:(0,g.jsx)(u().D,{styleName:"UISmall-12px/Medium",colorName:"primary",children:t})})}function S(e){const{button:t}=e;return(0,g.jsx)(y,{...t})}function v(e){const{primary:t,secondary:r}=e;return(0,g.jsxs)(o().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,g.jsx)(h,{...t}),r?(0,g.jsx)(f,{...r}):void 0]})}function b(e){const{primary:t}=e;return(0,g.jsx)(o().Y1,{direction:"horizontal",gap:8,align:"center-right",children:(0,g.jsx)(h,{...t})})}function x(e){const{numDots:t,activeDot:r}=e,a=(0,s().IS)((e=>({dot:{width:6,height:6,borderRadius:"100%",background:e.icon.quaternary},active:{background:e.icon.primary}})),[]),n=new Array(t).fill(0).map(((e,t)=>{const s=t===r?{...a.dot,...a.active}:a.dot;return(0,g.jsx)("div",{style:s},t)}));return(0,g.jsx)(o().Y1,{direction:"horizontal",gap:8,children:n})}function C(e){const{button:t,numStages:r,stage:a}=e;return(0,g.jsxs)(o().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,g.jsx)(x,{numDots:r,activeDot:a}),(0,g.jsx)(h,{...t})]})}function w(e){const{alt:t,src:r,type:a}=e,n=(0,s().IS)((()=>({media:{width:"100%",height:"auto",borderRadius:2}})),[]);return"image"===a?(0,g.jsx)("img",{src:r,style:n.media,alt:t}):(0,g.jsx)("video",{title:t,src:r,style:n.media,autoPlay:!0,playsInline:!0,muted:!0,loop:!0,controls:!1})}function I(e){const{onDismiss:t,buttonsProps:r,icon:a,title:n,media:i,body:c,badge:l}=e,d=(0,s().IS)((e=>({card:{borderWidth:1,borderColor:e.stroke.secondary,borderStyle:"solid",background:e.surface.contrast,backdropFilter:"blur(15px)",WebkitBackdropFilter:"blur(15px)",padding:12,width:280},title:{paddingRight:24},icon:{paddingBottom:2}})),[]);let h,f,y,x,I;if(r)switch(r.type){case"carousel":h=(0,g.jsx)(C,{...r});break;case"full-width":h=(0,g.jsx)(S,{...r});break;case"left-aligned":h=(0,g.jsx)(v,{...r});break;case"right-aligned":h=(0,g.jsx)(b,{...r})}return a&&(f=(0,g.jsx)(p().Q,{iconGroup:a,variantName:"small",colorName:"primary",style:d.icon})),n&&(y=(0,g.jsx)("div",{style:d.title,children:(0,g.jsxs)(u().D,{styleName:"UISmall-12px/Semibold",colorName:"contrastPrimary",children:[n,l]})})),c&&(x=(0,g.jsx)(u().D,{styleName:"UISmall-12px/Regular",colorName:"primary",children:c})),i&&(I=(0,g.jsx)(w,{...i})),(0,g.jsxs)(o().Y1,{style:d.card,borderRadius:8,gap:8,children:[(0,g.jsxs)(o().Y1,{gap:2,children:[f,y,x]}),I,h,(0,g.jsx)(m,{onClick:t})]})}function M(e){return(0,g.jsx)(a().wX,{mode:"dark",children:(0,g.jsx)(I,{...e})})}},528782:(e,t,r)=>{r.d(t,{m:()=>s});r(296540);var a=r(474848);const s=(0,r(340498).wt)("stop",{viewBox:"0 0 20 20",svg:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 19 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{y:"0.793945",width:"18.8027",height:"18.8027",rx:"9.40137",fill:"#37352F"}),(0,a.jsx)("rect",{x:"5.91028",y:"6.7041",width:"6.98255",height:"6.98255",rx:"0.783447",fill:"white"})]})})},557336:(e,t,r)=>{r.d(t,{q:()=>m});r(944114);var a=r(296540),s=()=>r(17022),n=()=>r(484714),o=()=>r(56366),i=()=>r(751156),c=()=>r(356983),l=()=>r(965454),d=()=>r(124749),p=()=>r(765957),u=()=>r(390898),g=()=>r(915619);function m(e){const t=(0,o().O$)(p().AppStoreCurrentSpaceStore),r=(0,d().$)(),m=(0,o().O$)(p().AppStoreCurrentSpaceViewStore),h=(0,n().v3)(),{threadStore:f,clientAiChatStore:y,setThreadStore:S,aiChatFeatureController:v,config:b}=e,x=(0,a.useCallback)((e=>{S(e),s().e.withListenerIgnored((()=>{y.getOrCreateClientAIChatThreadStore(e.id)}))}),[y,S]),C=(0,o().K8)((()=>{const e=b??y.state.configForNewTranscripts;return v.shouldSupportAttachments(e.type)}),[v,y,b]),w=Boolean(f),I=(0,o().K8)((()=>{var e;return null==f||null===(e=f.getSpaceStore())||void 0===e?void 0:e.id}),[f]),M=(0,a.useMemo)((()=>{if(t&&r&&m&&C&&(!w||I&&t.id!==I)){const e=i().createAndCommit({userAction:"AIChatInput.useUploadAttachments",environment:h,canUndo:!1,perform:e=>(0,u().aP)({environment:h,spaceStore:t,userStore:r,transaction:e})}).performResult;return x(e),e}}),[w,h,x,C,t,m,r,I]),k=f??M,T=(0,o().K8)((()=>{if(k)return y.getOrCreateClientAIChatThreadStore(null==k?void 0:k.id)}),[y,k]),_=(0,c().z)({threadClientStore:T,aiChatFeatureController:v,config:b,clientChatStore:y}),{onPasteFiles:A,uploadAttachment:j,onDropFiles:P}=(0,g().PF)({threadStore:k,spaceStore:t,config:b,clientAiChatStore:y,aiChatFeatureController:v}),K=(0,a.useCallback)((async()=>{const e=l()._.persistTemporaryThreadStoreIfExists();e&&(await e.commitResult,S(e.threadStore)),await j({file:void 0,method:"clicked_attachment_button"})}),[S,j]),F=(0,a.useCallback)((e=>{const t=l()._.persistTemporaryThreadStoreIfExists(e.transaction);t&&S(t.threadStore),e.transaction.postSubmitCallbacks.push((()=>{A(e)}))}),[A,S]),B=(0,a.useCallback)((async e=>{const t=l()._.persistTemporaryThreadStoreIfExists();t&&(await t.commitResult,S(t.threadStore)),await P(e)}),[S,P]);if(t&&r&&m&&C&&_&&k)return{onPasteFiles:F,uploadFile:K,onDropFiles:B,threadStore:k,spaceStore:t,userStore:r,spaceViewStore:m}}},662236:(e,t,r)=>{r.r(t),r.d(t,{AIChatView:()=>Rt});r(16280),r(410838),r(944114),r(898992),r(354520),r(672577);var a=r(296540),s=()=>r(484714),n=()=>r(56366),o=()=>r(401497),i=()=>r(370657),c=()=>r(878456),l=()=>r(536095),d=()=>r(655923),p=()=>r(806184),u=()=>r(952816),g=()=>r(861017),m=()=>r(84262),h=()=>r(919709),f=()=>r(959013),y=()=>r(284371),S=()=>r(354785),v=()=>r(751156),b=()=>r(96563),x=()=>r(501305),C=()=>r(410930),w=()=>r(84817),I=()=>r(493823),M=()=>r(285790),k=()=>r(8980),T=()=>r(554509),_=()=>r(864943),A=()=>r(859428),j=()=>r(615505),P=()=>r(976582),K=()=>r(863059),F=()=>r(581495),B=()=>r(38337),D=()=>r(921855),E=()=>r(847743),W=()=>r(953418),O=()=>r(406792),R=()=>r(223955),z=()=>r(304961),L=()=>r(301421),N=()=>r(255063),H=()=>r(278105),V=()=>r(921614),U=()=>r(765957),Y=()=>r(430483),G=()=>r(948914),$=()=>r(329304),q=()=>r(847),X=()=>r(46986),Q=()=>r(758417),Z=()=>r(704338),J=()=>r(317053),ee=()=>r(390898),te=()=>r(65824),re=()=>r(600434),ae=()=>r(805126),se=()=>r(555102),ne=()=>r(755543),oe=()=>r(66913),ie=()=>r(145214),ce=()=>r(949305),le=()=>r(47170),de=()=>r(908006),pe=()=>r(715256),ue=()=>r(892936),ge=()=>r(831081),me=()=>r(383286),he=()=>r(528782),fe=()=>r(496603),ye=()=>r(277942),Se=()=>r(829300),ve=()=>r(319975),be=()=>r(725614),xe=()=>r(2220),Ce=()=>r(220331),we=()=>r(897119),Ie=()=>r(204063),Me=()=>r(524702),ke=()=>r(549500),Te=()=>r(792540),_e=()=>r(231722),Ae=()=>r(665579),je=()=>r(321843),Pe=()=>r(764756),Ke=()=>r(24157),Fe=()=>r(298182),Be=()=>r(717375),De=()=>r(721908),Ee=()=>r(187174),We=()=>r(299487),Oe=()=>r(449506);function Re(e){let{environment:t,currentTextValue:r,currentSpaceStore:s,isEnabled:o}=e;const[i]=(0,Ee().Yb)((()=>(0,We().TD)(t,"research_mode_discoverability_tooltip")),[t],{debugName:"checkResearchModeDiscoverabilityEligibility"}),c="resolved"===i.status&&i.value,l=(0,n().K8)((()=>je().R.isResearchModeDown()),[]),d=(0,a.useCallback)((async e=>{if(!c||!o||!s||l)return;if(e.trim().split(/\s+/).filter((e=>e.length>0)).length>=3)try{const r=await async function(e){const{environment:t,query:r,spaceId:a}=e,s=r.trim();try{const e=await Oe().callApi({eventName:"checkQualifiesForResearchMode",environment:t,data:{query:s,spaceId:a}});return"failed"!==e.type&&e.data.qualifies}catch(n){return!1}}({environment:t,query:e,spaceId:s.id});r&&(0,We().HH)(t,"research_mode_discoverability_tooltip")}catch(r){}}),[c,o,s,t,l]),p=(0,De().d)(d,500);(0,a.useEffect)((()=>{if(r){const e=(0,h().q4_)(r);p(e)}}),[p,r])}var ze=()=>r(70128),Le=()=>r(915619),Ne=()=>r(756219),He=(r(581454),()=>r(76118)),Ve=()=>r(534177),Ue=()=>r(323714),Ye=()=>r(805751),Ge=()=>r(928600),$e=()=>r(939740),qe=()=>r(89924),Xe=()=>r(722872),Qe=()=>r(970585),Ze=()=>r(36951),Je=()=>r(239666),et=()=>r(762433),tt=()=>r(604018),rt=()=>r(324561);const at=(0,f().YK)({painPoints:{id:"aiInferenceTranscript.promptMessages.researchMode.painPoints",defaultMessage:"Customer pain points from interviews"},keyInsights:{id:"aiInferenceTranscript.promptMessages.researchMode.keyInsights",defaultMessage:"Key insights from financial projections"},seasonalSales:{id:"aiInferenceTranscript.promptMessages.researchMode.seasonalSales",defaultMessage:"Seasonal sales trends in the last 3 years"},context:{id:"aiInferenceTranscript.promptMessages.researchMode.context",defaultMessage:"Context related to new user onboarding"},commonThemes:{id:"aiInferenceTranscript.promptMessages.researchMode.commonThemes",defaultMessage:"Extract common feedback themes from user reviews"},customerChurnInsights:{id:"aiInferenceTranscript.promptMessages.researchMode.customerChurnInsights",defaultMessage:"Insights from recent churned customer surveys"},opportunities:{id:"aiInferenceTranscript.promptMessages.researchMode.opportunities",defaultMessage:"Opportunities based on customer support tickets"}}),st=(0,f().YK)({manageTasks:{id:"aiInferenceTranscript.promptMessages.buildMode.manageTasks",defaultMessage:"Manage tasks for a product launch"},makePlan:{id:"aiInferenceTranscript.promptMessages.buildMode.makePlan",defaultMessage:"Make a plan for a marketing campaign"},trackPlan:{id:"aiInferenceTranscript.promptMessages.buildMode.trackPlan",defaultMessage:"Track plan for sales leads"},onboardingTeamMembers:{id:"aiInferenceTranscript.promptMessages.buildMode.onboardingTeamMembers",defaultMessage:"Make a plan for onboarding team members"},runCampaign:{id:"aiInferenceTranscript.promptMessages.buildMode.runCampaign",defaultMessage:"Run a campaign for an email marketing push"}}),nt=(0,f().YK)({travelItinerary:{id:"aiInferenceTranscript.promptMessages.chatMode.travelItinerary",defaultMessage:"Travel itinerary for a day in San Francisco"},alanKayImpact:{id:"aiInferenceTranscript.promptMessages.chatMode.alanKayImpact",defaultMessage:"Alan Kay’s impact on computer science"},biggestDominoEffects:{id:"aiInferenceTranscript.promptMessages.chatMode.biggestDominoEffects",defaultMessage:"Biggest domino effects in pop culture"},macroEvents:{id:"aiInferenceTranscript.promptMessages.chatMode.macroEvents",defaultMessage:"Macro events that shape architectural trends"},dailyMindfulness:{id:"aiInferenceTranscript.promptMessages.chatMode.dailyMindfulness",defaultMessage:"Daily mindfulness practices based on scientific studies"},votingSystems:{id:"aiInferenceTranscript.promptMessages.chatMode.votingSystems",defaultMessage:"How do voting systems differ around the world?"},unsolvedBiologyMysteries:{id:"aiInferenceTranscript.promptMessages.chatMode.unsolvedBiologyMysteries",defaultMessage:"What are the biggest unsolved mysteries in biology?"}}),ot=(0,f().YK)({outlineProjects:{id:"aiInferenceTranscript.promptMessages.searchMode.outlineProjects",defaultMessage:"Outline projects I’m currently working on"},readingList:{id:"aiInferenceTranscript.promptMessages.searchMode.readingList",defaultMessage:"Suggest a reading list of books, docs, or articles"},emergingTrends:{id:"aiInferenceTranscript.promptMessages.searchMode.emergingTrends",defaultMessage:"What are some emerging trends?"},summarizeNotes:{id:"aiInferenceTranscript.promptMessages.searchMode.summarizeNotes",defaultMessage:"Summarize my notes across recent meetings"},draftBio:{id:"aiInferenceTranscript.promptMessages.searchMode.draftBio",defaultMessage:"Draft a bio based on my recent work"},helpMePrioritize:{id:"aiInferenceTranscript.promptMessages.searchMode.helpMePrioritize",defaultMessage:"Help me prioritize projects for this month"}}),it=(0,f().YK)({teamTopPriorities:{defaultMessage:"What are the team’s top priorities this quarter?",id:"aiInferenceTranscript.promptMessages.businessPrompts.teamTopPriorities"},getAnswersFromConnectedApps:{defaultMessage:"Get answers from connected apps",id:"aiInferenceTranscript.promptMessages.businessPrompts.getAnswersFromConnectedApps"},synthesizeCustomerFeedback:{defaultMessage:"Synthesize customer feedback from the last 3 months",id:"aiInferenceTranscript.promptMessages.businessPrompts.synthesizeCustomerFeedback"},trendingTopicsInCompany:{defaultMessage:"Trending topics at the company",id:"aiInferenceTranscript.promptMessages.businessPrompts.trendingTopicsInCompany"}}),ct=(0,f().YK)({getAnswersFromConnectedApps:{defaultMessage:"Get answers from connected apps",id:"aiInferenceTranscript.promptMessages.personalPrompts.getAnswersFromConnectedApps"},outlineLesserKnownFactsAboutMars:{defaultMessage:"Outline lesser known facts about mars",id:"aiInferenceTranscript.promptMessages.personalPrompts.outlineLesserKnownFactsAboutMars"},mostPopularPersonalityTests:{defaultMessage:"What are the most popular personality tests?",id:"aiInferenceTranscript.promptMessages.personalPrompts.mostPopularPersonalityTests"}}),lt=(0,f().YK)({studyPlan:{id:"aiInferenceTranscript.promptMessages.educationPrompts.studyPlan",defaultMessage:"Create a structured study plan"},brainstormInterestingTopicsForEssays:{id:"aiInferenceTranscript.promptMessages.educationPrompts.brainstormInterestingTopicsForEssays",defaultMessage:"Brainstorm interesting topics for essays"},emergingEconomicTrends:{defaultMessage:"Tell me about emerging economic trends",id:"aiInferenceTranscript.promptMessages.educationPrompts.emergingEconomicTrends"}}),dt=(0,f().YK)({summarizeActivity:{defaultMessage:"Summarize activity from this week",id:"aiInferenceTranscript.promptMessages.slackPrompts.summarizeActivity"},overviewOutOfOffice:{defaultMessage:"Overview of what happened while I was OOO",id:"aiInferenceTranscript.promptMessages.slackPrompts.overviewOutOfOffice"},trendingTopics:{defaultMessage:"What topics are trending today?",id:"aiInferenceTranscript.promptMessages.slackPrompts.trendingTopics"},writingStyle:{defaultMessage:"What does my writing style say about me?",id:"aiInferenceTranscript.promptMessages.slackPrompts.writingStyle"},mostCommonQuestionsFromNewHires:{defaultMessage:"Most common questions from new hires",id:"aiInferenceTranscript.promptMessages.slackPrompts.mostCommonQuestionsFromNewHires"},topConcerns:{defaultMessage:"Top concerns discussed by the team this week",id:"aiInferenceTranscript.promptMessages.slackPrompts.topConcerns"},sentiment:{defaultMessage:"Sentiment trend in Slack conversations over the past month",id:"aiInferenceTranscript.promptMessages.slackPrompts.sentiment"}}),pt=(0,f().YK)({outlineBugs:{defaultMessage:"Outline bugs that were recently triaged",id:"aiInferenceTranscript.promptMessages.githubPrompts.outlineBugs"},prsWaitingForReview:{defaultMessage:"Which PRs have been waiting for review",id:"aiInferenceTranscript.promptMessages.githubPrompts.prsWaitingForReview"},highPriorityBugs:{defaultMessage:"Show me all high-priority bugs in our repo",id:"aiInferenceTranscript.promptMessages.githubPrompts.highPriorityBugs"},engineeringReport:{defaultMessage:"Generate an engineering report",id:"aiInferenceTranscript.promptMessages.githubPrompts.engineeringReport"},contributions:{defaultMessage:"Show contributions by team members this sprint",id:"aiInferenceTranscript.promptMessages.githubPrompts.contributions"},clusterIssues:{defaultMessage:"Cluster issues by product component or tag",id:"aiInferenceTranscript.promptMessages.githubPrompts.clusterIssues"}}),ut=(0,f().YK)({outlineInsights:{defaultMessage:"Outline relevant insights or updates",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.outlineInsights"},commonThemesInTeamPresentations:{defaultMessage:"Common themes in team presentations",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.commonThemesInTeamPresentations"},summarizeKeyUsage:{defaultMessage:"Summarize key usage in google drive",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.summarizeKeyUsage"},mostEditedDocuments:{defaultMessage:"List most edited docs in the past few months",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.mostEditedDocuments"},openQuestions:{defaultMessage:"What are the open questions across product specs?",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.openQuestions"},summarizeUserResearch:{defaultMessage:"Summarize user research across different slide decks",id:"aiInferenceTranscript.promptMessages.googleDrivePrompts.summarizeUserResearch"}}),gt=(0,f().YK)({makeAPlan:{id:"aiInferenceTranscript.promptMessages.setupGeneratorWorkPrompts.makeAPlan",defaultMessage:"Make a plan for a product roadmap"},manageTasks:{id:"aiInferenceTranscript.promptMessages.setupGeneratorWorkPrompts.manageTasks",defaultMessage:"Manage tasks for a website redesign"},collectFeedback:{id:"aiInferenceTranscript.promptMessages.setupGeneratorWorkPrompts.collectFeedback",defaultMessage:"Collect feedback on customer satisfaction"},trackPipeline:{id:"aiInferenceTranscript.promptMessages.setupGeneratorWorkPrompts.trackPipeline",defaultMessage:"Track pipeline for sales leads"},runCampaign:{id:"aiInferenceTranscript.promptMessages.setupGeneratorWorkPrompts.runCampaign",defaultMessage:"Run campaign for a product launch"}}),mt=(0,f().YK)({journalEntries:{id:"aiInferenceTranscript.promptMessages.setupGeneratorPersonalPrompts.journalEntries",defaultMessage:"Journal entries about daily reflections"},manageLists:{id:"aiInferenceTranscript.promptMessages.setupGeneratorPersonalPrompts.manageLists",defaultMessage:"Manage lists for grocery shopping"},trackHabits:{id:"aiInferenceTranscript.promptMessages.setupGeneratorPersonalPrompts.trackHabits",defaultMessage:"Track habits for daily workouts"},setGoals:{id:"aiInferenceTranscript.promptMessages.setupGeneratorPersonalPrompts.setGoals",defaultMessage:"Set goals for financial savings"},saveMemories:{id:"aiInferenceTranscript.promptMessages.setupGeneratorPersonalPrompts.saveMemories",defaultMessage:"Save memories from vacations and trips"}}),ht=3;function ft(e){const{clientStore:t}=e,r=(0,n().O$)(U().AppStoreCurrentSpaceStore),s=(0,n().K8)(tt().uM,[]),o=(0,a.useCallback)((e=>s.includes(e)),[s]),i=function(){const e=(0,n().O$)(U().AppStoreCurrentSpaceStore),t=(0,rt().f_)({spaceId:null==e?void 0:e.id}),r=(0,et().AI)(t);if("free"===r||"plus"===r)return"default";if("personal"===r)return"personal";if("business"===r||"enterprise"===r)return"business";if("student"===r)return"education";(0,Ve().HB)(r)}(),c=(0,n().K8)((()=>t.state.configForNewTranscripts),[t]),l=(0,n().K8)((()=>{if("researcher"===(null==c?void 0:c.type))return(0,fe().k4)(function(e){const t={type:"researcher"},r=(0,Be().Ol)({spaceStore:e.spaceStore,config:t})??t;return[{analyticsKey:"researcher.pain_points",type:"prompt",message:at.painPoints,config:r},{analyticsKey:"researcher.key_insights",type:"prompt",message:at.keyInsights,config:r},{analyticsKey:"researcher.seasonal_sales",type:"prompt",message:at.seasonalSales,config:r},{analyticsKey:"researcher.context",type:"prompt",message:at.context,config:r},{analyticsKey:"researcher.common_themes",type:"prompt",message:at.commonThemes,config:r},{analyticsKey:"researcher.customer_churn_insights",type:"prompt",message:at.customerChurnInsights,config:r},{analyticsKey:"researcher.opportunities",type:"prompt",message:at.opportunities,config:r}]}({spaceStore:r}));if("workflow"===(null==c?void 0:c.type))return(0,fe().k4)(function(e){const t={type:"workflow"},r=(0,Be().Ol)({spaceStore:e.spaceStore,config:t})??t;return[{analyticsKey:"workflow.manage_tasks",type:"prompt",message:st.manageTasks,config:r},{analyticsKey:"workflow.make_plan",type:"prompt",message:st.makePlan,config:r},{analyticsKey:"workflow.track_plan",type:"prompt",message:st.trackPlan,config:r},{analyticsKey:"workflow.onboarding_team_members",type:"prompt",message:st.onboardingTeamMembers,config:r},{analyticsKey:"workflow.run_campaign",type:"prompt",message:st.runCampaign,config:r}]}({spaceStore:r}));if("markdown-chat"===(null==c?void 0:c.type))return(0,fe().k4)(function(e){const t={type:"markdown-chat",model:"openai-gpt-4.1"},r=(0,Be().Ol)({spaceStore:e.spaceStore,config:{type:"markdown-chat",model:"openai-gpt-4.1"}})??t,a=(0,Be().Ol)({spaceStore:e.spaceStore,config:{type:"markdown-chat",model:"anthropic-sonnet-3.7"}})??t;return[{analyticsKey:"markdown-chat.travel_itinerary",type:"prompt",message:nt.travelItinerary,config:r},{analyticsKey:"markdown-chat.alan_kay_impact",type:"prompt",message:nt.alanKayImpact,config:a},{analyticsKey:"markdown-chat.biggest_domino_effects",type:"prompt",message:nt.biggestDominoEffects,config:a},{analyticsKey:"markdown-chat.macro_events",type:"prompt",message:nt.macroEvents,config:r},{analyticsKey:"markdown-chat.daily_mindfulness",type:"prompt",message:nt.dailyMindfulness,config:a},{analyticsKey:"markdown-chat.voting_systems",type:"prompt",message:nt.votingSystems,config:a},{analyticsKey:"markdown-chat.unsolved_biology_mysteries",type:"prompt",message:nt.unsolvedBiologyMysteries,config:a}]}({spaceStore:r}));if("setup-generator"===(null==c?void 0:c.type))return(0,fe().k4)(function(e){const{audience:t}=e,r=[{type:"action",id:"setup-generator",message:gt.makeAPlan,prompt:gt.makeAPlan},{type:"action",id:"setup-generator",message:gt.manageTasks,prompt:gt.manageTasks},{type:"action",id:"setup-generator",message:gt.collectFeedback,prompt:gt.collectFeedback},{type:"action",id:"setup-generator",message:gt.trackPipeline,prompt:gt.trackPipeline},{type:"action",id:"setup-generator",message:gt.runCampaign,prompt:gt.runCampaign}],a=[{type:"action",id:"setup-generator",message:mt.journalEntries,prompt:mt.journalEntries},{type:"action",id:"setup-generator",message:mt.manageLists,prompt:mt.manageLists},{type:"action",id:"setup-generator",message:mt.trackHabits,prompt:mt.trackHabits},{type:"action",id:"setup-generator",message:mt.setGoals,prompt:mt.setGoals},{type:"action",id:"setup-generator",message:mt.saveMemories,prompt:mt.saveMemories}];return"business"===t?r:a}({audience:i}));{const e=(0,fe().k4)(function(e){const{audience:t,spaceStore:r}=e;if("business"===t)return function(e){const{spaceStore:t}=e,r={type:"search",scopeForNextSearch:Je().W},a=(0,Be().Ol)({spaceStore:t,config:r})??r;return[{analyticsKey:"search.team_top_priorities",type:"prompt",message:it.teamTopPriorities,config:a},{analyticsKey:"search.synthesize_customer_feedback",type:"prompt",message:it.synthesizeCustomerFeedback,config:a},{analyticsKey:"search.trending_topics_in_company",type:"prompt",message:it.trendingTopicsInCompany,config:a}]}({spaceStore:r});if("personal"===t)return function(e){const{spaceStore:t}=e,r={type:"search",scopeForNextSearch:Je().W},a=(0,Be().Ol)({spaceStore:t,config:r})??r;return[{analyticsKey:"search.facts_about_mars",type:"prompt",message:ct.outlineLesserKnownFactsAboutMars,config:a},{analyticsKey:"search.personality_tests",type:"prompt",message:ct.mostPopularPersonalityTests,config:a}]}({spaceStore:r});if("education"===t)return function(e){const{spaceStore:t}=e,r={type:"search",scopeForNextSearch:Je().W},a=(0,Be().Ol)({spaceStore:t,config:r})??r;return[{analyticsKey:"search.study_plan",type:"prompt",message:lt.studyPlan,config:a},{analyticsKey:"search.brainstorm_interesting_topics_for_essays",type:"prompt",message:lt.brainstormInterestingTopicsForEssays,config:a},{analyticsKey:"search.emerging_economic_trends",type:"prompt",message:lt.emergingEconomicTrends,config:a}]}({spaceStore:r});if("default"===t)return function(e){const{spaceStore:t}=e,r={type:"search",scopeForNextSearch:Je().W},a=(0,Be().Ol)({spaceStore:t,config:r})??r;return[{analyticsKey:"search.outline_projects",type:"prompt",message:ot.outlineProjects,config:a},{analyticsKey:"search.reading_list",type:"prompt",message:ot.readingList,config:a},{analyticsKey:"search.emerging_trends",type:"prompt",message:ot.emergingTrends,config:a},{analyticsKey:"search.summarize_notes",type:"prompt",message:ot.summarizeNotes,config:a},{analyticsKey:"search.draft_bio",type:"prompt",message:ot.draftBio,config:a},{analyticsKey:"search.help_me_prioritize",type:"prompt",message:ot.helpMePrioritize,config:a}]}({spaceStore:r});(0,Ve().HB)(t)}({audience:i,spaceStore:r}));let t=Je().W;return"search"===(null==c?void 0:c.type)&&(t=c.scopeForNextSearch),"everything"===t.type?e:"slack"===t.type?(0,fe().k4)(yt.slack({spaceStore:r,isConnectorInProgress:o("slack")})):"github"===t.type?(0,fe().k4)(yt.github({spaceStore:r,isConnectorInProgress:o("github")})):"google-drive"===t.type?(0,fe().k4)(yt["google-drive"]({spaceStore:r,isConnectorInProgress:o("google-drive")})):e}}),[c,i,r,o]);return l.slice(0,ht)}const yt={slack:function(e){const{spaceStore:t,isConnectorInProgress:r}=e,a=[{analyticsKey:"slack.summarize_activity",message:dt.summarizeActivity},{analyticsKey:"slack.overview_out_of_office",message:dt.overviewOutOfOffice},{analyticsKey:"slack.trending_topics",message:dt.trendingTopics},{analyticsKey:"slack.writing_style",message:dt.writingStyle},{analyticsKey:"slack.most_common_questions_from_new_hires",message:dt.mostCommonQuestionsFromNewHires},{analyticsKey:"slack.top_concerns",message:dt.topConcerns},{analyticsKey:"slack.sentiment",message:dt.sentiment}];if(r)return a.map((e=>({...e,type:"action",id:"connector-upsell"})));{const e={type:"search",scopeForNextSearch:{type:"slack"}},r=(0,Be().Ol)({spaceStore:t,config:e})??e;return a.map((e=>({...e,type:"prompt",config:r})))}},github:function(e){const{spaceStore:t,isConnectorInProgress:r}=e,a=[{analyticsKey:"github.outline_bugs",message:pt.outlineBugs},{analyticsKey:"github.prs_waiting_for_review",message:pt.prsWaitingForReview},{analyticsKey:"github.high_priority_bugs",message:pt.highPriorityBugs},{analyticsKey:"github.prs_waiting_for_review",message:pt.prsWaitingForReview},{analyticsKey:"github.contributions",message:pt.contributions},{analyticsKey:"github.cluster_issues",message:pt.clusterIssues}];if(r)return a.map((e=>({...e,type:"action",id:"connector-upsell"})));{const e={type:"search",scopeForNextSearch:{type:"github"}},r=(0,Be().Ol)({spaceStore:t,config:e})??e;return a.map((e=>({...e,type:"prompt",config:r})))}},"google-drive":function(e){const{spaceStore:t,isConnectorInProgress:r}=e,a=[{analyticsKey:"google_drive.outline_insights",message:ut.outlineInsights},{analyticsKey:"google_drive.common_themes",message:ut.commonThemesInTeamPresentations},{analyticsKey:"google_drive.summarize_key_usage",message:ut.summarizeKeyUsage},{analyticsKey:"google_drive.most_edited_documents",message:ut.mostEditedDocuments},{analyticsKey:"google_drive.open_questions",message:ut.openQuestions},{analyticsKey:"google_drive.summarize_user_research",message:ut.summarizeUserResearch}];if(r)return a.map((e=>({...e,type:"action",id:"connector-upsell"})));{const e={type:"search",scopeForNextSearch:{type:"google-drive"}},r=(0,Be().Ol)({spaceStore:t,config:e})??e;return a.map((e=>({...e,type:"prompt",config:r})))}}};var St=r(474848);const vt=12;function bt(e){const{clientStore:t,submitCurrentInputValue:r,aiChatFeatureController:o,onSelectSuggestion:i}=e,[c,d]=(0,a.useState)(void 0),p=(0,n().uB)(void 0,Qe().A),u=ft({clientStore:t}),g=function(e){const{clientStore:t,aiChatFeatureController:r,onSelectSuggestion:o}=e,i=(0,s().v3)(),c=(0,f().tz)(),d=i.currentUser.id,p=(0,n().O$)(U().AppStoreCurrentSpaceStore),u=null==p?void 0:p.id,g=(0,$()._X)({name:"ai_connectors",spaceId:u,userId:d});return(0,a.useCallback)((async e=>{if(o(),"prompt"===e.type){const a=function(e){const{suggestion:t,spaceId:r,userId:a}=e,s=function(e){if("prompt"!==e.type)return;const t=e.config.type;switch(t){case"researcher":return"ai_research_mode";case"search":case"markdown-chat":return"ai_usage";case"setup-generator":case"workflow":return"ai_app_builder";case"autocorrect":case"autocomplete":case"debug-inference":case"fast-researcher":case"memory-agent":case"route-inference-transcript":case"summarize-transcript":case"tool-markdown-chat":case"aiBlock":case"mini-agent":case"formulas":return;default:(0,Ve().HB)(t)}}(t);if(!s||"ai_usage"===s)return{name:"ai_usage",spaceId:r,userId:a,amount:1};if("ai_research_mode"===s)return{name:s,spaceId:r,userId:a,amount:1};if("ai_app_builder"===s)return{name:s,spaceId:r,userId:a};(0,Ve().HB)(s)}({suggestion:e,spaceId:u,userId:d}),s=await(0,$().Bw)(i,a);(0,He().e2)(s)?(0,Ze().Iu)({environment:i,query:(0,h().x9d)(c.formatMessage(e.message)),clientStore:t,config:e.config,suggestedPrompt:{promptKey:e.analyticsKey,promptDescription:e.message.defaultMessage},surface:r.contextStepSurface}):(t.setState({...t.state,configForNewTranscripts:e.config}),V().d.setState({...V().d.state,inlineUsageErrorVisible:!0,featureAvailability:s}))}else if("action"===e.type)if("connector-upsell"===e.id)(0,b().pp)({environment:i,connector:"generic",analyticsFrom:"ai_full_page_welcome_connector_action_card",connectorsFeatureAvailability:g});else if("in-progress-connector"===e.id)(0,Ue().openConnectorInProgressModal)({environment:i,from:"ai_chat_in_progress_connector_prompt_suggestion",connector:e.connector});else if("setup-generator"===e.id){if(!p)return;(0,J().openSelectedTemplateOnboardingModalForInAppFlows)({parentStore:p,template:l().XK,environment:i,aiPrompt:(0,h().x9d)(c.formatMessage(e.prompt)),origin:"ai_chat",version:"build_with_ai",autoSubmit:!0})}else(0,Ve().HB)(e);else(0,Ve().HB)(e)}),[t,r,p,g,i,c,u,d,o])}({clientStore:t,aiChatFeatureController:o,onSelectSuggestion:i});return(0,St.jsx)(Ye().A,{debugName:"AIChatSuggestionDropdownMenu",capture:!0,allowMenuList:!0,allowEsc:!0,children:(0,St.jsx)(Ge().A,{menuType:Xe().gu.Popup,children:(0,St.jsx)($e().Ay,{type:$e().Oh.Vertical,store:p,initialFocus:void 0,disableKeyboardArrowWrap:!0,onEmptyEnter:()=>{r()},onKeyboardArrow:e=>{Ct(e)&&Ct(null==c?void 0:c.focus)&&p.unsetFocus(),d(p.getState())},sections:[{key:"suggestions",render:e=>(0,St.jsx)(qe().A,{...e}),items:u.map(((e,t)=>({key:`${e.message.id}-${t}`,action:()=>{g(e).catch((e=>{console.error(e)}))},render:t=>(0,St.jsx)(xt,{...t,suggestion:e})})))}]})})})}const xt=a.forwardRef(((e,t)=>{const{suggestion:a,...s}=e,n=(0,o().IS)((e=>({buttonMenuItem:{height:42,fontSize:14},enterIcon:{height:12,width:12,fill:e.icon.secondary,opacity:s.focused?1:0}})),[s.focused]);return(0,St.jsx)(r(760217).A,{...s,ref:t,title:(0,St.jsx)(f().sA,{...a.message}),style:n.buttonMenuItem,onMouseDown:e=>{var t;null===(t=s.onClick)||void 0===t||t.call(s,e)},right:(0,r(356596).K)(n.enterIcon)})}));function Ct(e){return!!e&&0===e.indexGlobal}xt.displayName="AIChatSuggestionMenuItem";var wt=()=>r(308903),It=()=>r(764235),Mt=()=>r(386164);function kt(e){const t=(0,f().tz)(),{store:r,onSubmit:i,clientStore:c,threadStore:l,showInitialModePicker:d,aiChatFeatureController:p,onLoaded:u,loadAttachmentsData:g}=e,m=(0,s().v3)(),y=(0,s().Y0)(),S=(0,o().DP)(),[b,x]=a.useState(!1),[C,w]=a.useState(!1),I=(0,a.useCallback)((()=>w(!0)),[]),k=(0,a.useCallback)((()=>w(!1)),[]),T=(0,n().K8)((()=>p.isInSidebarMode||!(0,ae().av)(l)),[p.isInSidebarMode,l]),_=(0,n().K8)((()=>d&&p.supportsSuggestions&&b),[p,b,d]);(0,a.useEffect)((()=>{_?Pe().m.setState({type:"hidden"}):"hidden"===Pe().m.state.type&&Pe().m.setState({type:"visible"})}),[_]);const[j,P]=a.useState(!1),K=(0,n().K8)((()=>r.getValue()),[r]),F=(0,n().O$)(U().AppStoreCurrentSpaceStore),B=(0,n().K8)((()=>{var e;return null===(e=U().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),D=(0,n().K8)((()=>(0,ae().zj)({clientStore:c,threadStore:l})),[c,l]);Re({environment:m,currentTextValue:K,currentSpaceStore:F,isEnabled:"search"===D.type}),(0,a.useEffect)((()=>{null==u||u()}),[u]);const E=(0,n().K8)((()=>0===(0,h().AhH)(r.getValue()||[])),[r]),W=(0,n().K8)((()=>Boolean(void 0!==(null==l?void 0:l.getCurrentInferenceId())||(null==l?void 0:l.id)&&c.getOrCreateClientAIChatThreadStore(l.id).state.loading)),[l,c]),O=(0,a.useCallback)((()=>{if(!l)return;const{serverCommitResult:e}=v().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:m,canUndo:!0,perform:e=>{(0,ee().GS)({threadStore:l,transaction:e,clientStore:c})}}),t=c.getOrCreateClientAIChatThreadStore(l.id);t.setState({...t.state,stopInferencePromise:e}),(0,xe().u)({environment:m,event:{eventName:"ai_chat_output_stopped_by_user",eventProperties:{thread_id:l.id,trace_id:t.state.traceId}}})}),[m,l,c]),R=(0,a.useCallback)((async()=>{const{dictationActions:e}=await ke().$O.load(),t=(0,h().q4_)(r.getValue()||[]);await e.StreamingDictationManager.start({environment:m,onTranscription:e=>{const a=t?`${t}\n${e}`:e;v().createAndCommit({userAction:"AIChatInput.handleDictation",environment:m,canUndo:!0,perform:e=>{ve().R9({environment:m,store:r,value:(0,h().x9d)(a),transaction:e})}})}}),P(!0)}),[m,r]),z=(0,a.useCallback)((async()=>{const{dictationActions:e}=await ke().$O.load();await e.StreamingDictationManager.stop(),P(!1)}),[]);(0,a.useEffect)((()=>()=>{z()}),[z]);const N=(0,n().K8)((()=>(0,Be().ak)({spaceStore:F})),[F]),H=d&&p.supportsModePicker;(0,ze().M)({textValue:K,isEnabled:p.supportsAutoRouting,clientStore:c,configs:N}),function(){const e=(0,s().v3)(),t=(0,a.useCallback)((()=>{const t=U().default.state.currentSpaceStore;if(!t)return;const r=t.id;Oe().callApi({eventName:"warmSearchCache",environment:e,data:{spaceId:r}}),Oe().callApi({eventName:"warmVectorDBCache",environment:e,data:{spaceId:r},headers:(0,Mt().WS)({spaceId:r})})}),[e]),r=(0,n().K8)((()=>(0,fe().sg)(t,200)),[t]);(0,a.useEffect)((()=>(r(),()=>{r.cancel()})),[r])}();const Y=(0,n().K8)((()=>!l||l.canEdit()),[l]),G=(0,a.useCallback)((()=>{Y&&!W&&(x(!1),null==i||i(r.getValue()))}),[i,W,Y,r]),$=(0,a.useCallback)((async()=>{const e=Ke().default.state;"editing"===e.mode&&(0,_e().KP)(e.multiSelection)&&e.multiSelection.start.store===r||(be().setSelectionAtEnd({store:r}),await de().default.afterNextFlush())}),[r]),[q,X]=a.useState(!1),Q=(0,n().K8)((()=>"researcher"!==D.type||(0,ae().av)(l)),[l,D]),Z=(0,n().K8)((()=>(0,It().iu)({config:D,threadStore:l,intl:t})),[D,l,t]),J=p.supportsTranscription,te=Tt({isPhone:y.isPhone,theme:S}),re=function(e){let{isPhone:t,theme:r}=e;const a=(0,Ae().O0)({mode:r.mode});return(0,fe().oE)(["light"===r.mode?"0 12px 32px rgba(0, 0, 0, 0.03)":"rgba(255, 255, 255, 0.075) 0px 0px 0px 1px inset",`0 0 0 ${a}px rgba(0, 0, 0, 0.1)`]).join(", ")}({isPhone:y.isPhone,theme:S}),{hoveredBoxShadow:se}=(0,Ae().UO)({isPhone:y.isPhone,theme:S}),ne=(0,n().K8)((()=>"empty"!==Ke().default.state.mode&&Ke().default.state.multiSelection.start.store.id===r.id),[r]),oe=(0,n().K8)((()=>p.supportsSearchScopePopup(D.type)&&Q),[p,D.type,Q]),ie=(0,n().K8)((()=>je().R.isWebSearchDown()),[]),ce=(0,n().K8)((()=>!!p.supportsWebSearch(D.type)&&("researcher"===D.type?(0,ae().av)(l):"search"!==D.type||"everything"===D.scopeForNextSearch.type)),[l,D,p]),le=(0,n().K8)((()=>p.shouldSupportAttachments(D.type)&&g),[p,D.type,g]),De=(0,n().K8)((()=>p.shouldAllowMentions(D.type)),[p,D.type]),Ee=(0,n().K8)((()=>{if(E)return!0;if(p.shouldShowUsageError&&void 0===V().d.state.featureAvailability)return!0;return!(!F||!je().R.isInferenceTranscriptConfigTypeDown({configType:D.type,spaceId:F.id,actor:B??pe().S3}))}),[p.shouldShowUsageError,D.type,F,B,E]),We=(0,o().IS)((e=>{const t=_?`${vt}px ${vt}px 0px 0px`:vt,r={width:24,height:24,margin:2};return{stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1,borderRadius:t,outline:q?`2px solid ${e.palette.uiBlue[500]}`:void 0},wrap:{display:"flex",fontSize:12,alignItems:"center",flexWrap:"wrap",boxShadow:ne?re:C?se:te,backgroundColor:"dark"===e.mode?e.surface.elevated:e.contentBackground,overflow:"inherit",position:"relative",borderRadius:t},textContainer:{flexGrow:1,paddingTop:12,paddingBottom:T?0:20,paddingLeft:16,paddingRight:16,minHeight:T?44:80,maxHeight:240,overflow:"auto",fontSize:16},placeholder:{opacity:1,cursor:"text",minHeight:T?44:80},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 13px",gap:6},leftGutter:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",padding:"0 0 12px 12px"},sendButton:{...r,background:Ee?e.grayButtonBackground:e.blueButtonBackground},stopButton:{...r},sendButtonIcon:{width:16,height:16},stopButtonIcon:{width:14,height:14},microphoneIcon:{width:28},stopIcon:{width:32,height:32},inputActionsRow:{display:"flex",width:"100%",justifyContent:"space-between",overflow:"hidden"},searchScopeButton:{marginRight:-3},attachButton:{width:28,height:28},atMentionButton:{width:28,height:28},attachmentStagingAreaWrapper:{paddingLeft:8},webSearchButtonWrapper:{opacity:ce?1:0,transition:"opacity 150ms ease",pointerEvents:ce?"auto":"none"},scopeButtonWrapper:{opacity:oe?1:0,transition:"opacity 150ms ease",pointerEvents:oe?"auto":"none"},attachmentsButtonWrapper:{opacity:le?1:0,transition:"opacity 150ms ease",pointerEvents:le?"auto":"none"},atMentionButtonWrapper:{opacity:De?1:0,transition:"opacity 150ms ease",pointerEvents:De?"auto":"none"}}}),[_,T,re,se,te,C,ne,ce,le,De,oe,Ee,q]),He=(0,n().K8)((()=>!(null==F||!F.id)&&je().R.isInferenceTranscriptConfigTypeDown({configType:D.type,spaceId:F.id,actor:B??pe().S3})),[D.type,F,B]),Ve=(0,a.useCallback)((()=>{"empty"===Ke().default.state.mode&&be().setSelectionAtEnd({store:r})}),[r]),Ue=(0,a.useCallback)((()=>{be().setSelectionAtEnd({store:r}),x(!0)}),[r]),Ye=(0,a.useCallback)((()=>{x(!1),be().clear({environment:m})}),[m]);return(0,St.jsx)(we().Ay,{popupType:we().nl.Popup,trapFocus:!1,open:_,disableMouseCapture:!0,onDismiss:()=>{x(!1)},sameWidthAsOrigin:!0,popupWrapStyle:{borderRadius:`0px 0px ${vt}px ${vt}px`},origin:(0,St.jsx)("div",{style:{...We.stagingAndInputWrap},tabIndex:0,onDrop:e=>{if(e.preventDefault(),X(!1),!le)return;const t=Array.from(e.dataTransfer.files);t.length>0&&null!=g&&g.onDropFiles&&g.onDropFiles(t)},onDragOver:e=>{e.preventDefault(),le&&X(!0)},onDragLeave:e=>{e.preventDefault(),X(!1)},children:(0,St.jsxs)("div",{style:We.wrap,onMouseOver:I,onMouseLeave:k,onClick:e=>{if(e.target===e.currentTarget){const t=L().n.findEditableWithStore(r);t&&t.handleClick(e)}},children:[(0,St.jsx)(Me().A,{style:We.textContainer,placeholder:Z,disabled:!1,store:r,placeholderStyle:We.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onPasteFiles:null==g?void 0:g.onPasteFiles,disableEnter:!1,onEnter:G,disableMobileActionBar:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:Te().Os.none,usePopupForMentionOnMobile:!0,disableMentions:!p.shouldAllowMentions,disabledMentionTypes:Fe().md,onFocus:Ue,onBlur:Ye,onClick:Ve}),p.shouldSupportAttachments(D.type)&&g&&(0,St.jsx)("div",{style:We.attachmentStagingAreaWrapper,children:(0,St.jsx)(Le().Yo,{clientStore:c,loadAttachmentsData:g})}),(0,St.jsxs)("div",{style:We.inputActionsRow,children:[H&&(0,St.jsx)("div",{style:We.leftGutter,children:(0,St.jsx)(ye()._,{clientStore:c,configs:N,threadStore:l})}),(0,St.jsx)("div",{style:{flexGrow:1}}),(0,St.jsxs)("div",{style:We.rightGutter,children:[(0,St.jsx)("div",{style:We.webSearchButtonWrapper,children:(0,St.jsx)(wt().l,{clientStore:c,threadStore:l,webSearchDown:ie})}),(0,St.jsx)("div",{style:We.scopeButtonWrapper,children:(0,St.jsx)(Ne().d,{clientStore:c,threadStore:l,aiChatFeatureController:p,style:We.searchScopeButton,disableNumericalEllipsis:!0})}),(0,St.jsx)("div",{style:We.attachmentsButtonWrapper,children:(0,St.jsx)(Le().Wn,{loadAttachmentsData:g,clientStore:c,style:We.attachButton})}),(0,St.jsx)("div",{style:We.atMentionButtonWrapper,children:(0,St.jsx)(Ce().q,{style:We.atMentionButton,onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){await $(),await de().default.afterNextFlush(),Se().Gf({environment:m,mentionTypes:Fe().Ap,usePopupOnMobile:!0}),(0,xe().u)({environment:m,event:{eventName:"clicked_ai_chat_at_mention_button",eventProperties:{mode:D.type}}})}()}})}),j?(0,St.jsx)(M().A,{icon:he().m,onClick:z,iconStyle:We.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"})},"stop-recording"):W?(0,St.jsx)(Ie().A,{color:"black",shape:"pill",iconLeading:ge().U,onClick:O,style:We.stopButton,iconStyle:We.stopButtonIcon,disabled:!p.supportsStopInference(D.type),ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"})}):(0,St.jsxs)(St.Fragment,{children:[!j&&J&&(0,St.jsx)(M().A,{icon:me().E,onClick:R,iconStyle:We.microphoneIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"})},"start-recording"),(0,St.jsx)(A().A,{disableTooltip:!He,renderTooltip:e=>(0,St.jsx)("div",{...e,children:(0,St.jsx)(f().sA,{...je().$.cannotSubmitMessage})}),render:e=>(0,St.jsx)(Ie().A,{shape:"pill",iconLeading:ue().f,onClick:G,style:We.sendButton,iconStyle:We.sendButtonIcon,disabled:Ee,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.submitAiMessage",defaultMessage:"Submit AI message"}),...e})})]})]})]})]})}),render:()=>_?(0,St.jsx)(bt,{onSelectSuggestion:()=>{x(!1)},submitCurrentInputValue:G,aiChatFeatureController:p,clientStore:c}):null})}function Tt(e){let{isPhone:t,theme:r}=e;if("dark"===r.mode)return"unset";r.mode;const a=(0,Ae().O0)({mode:r.mode});return(0,fe().oE)(["light"===r.mode?"0 12px 32px rgba(0, 0, 0, 0.03)":r.homeShadow.card.hovered,`0 0 0 ${a}px rgba(0, 0, 0, 0.05)`]).join(", ")}function _t(e){const{clientStore:t}=e,r=(0,s().v3)(),i=(0,s().Y0)(),c=(0,f().tz)(),[l,d]=(0,a.useState)(!1),p=(0,a.useCallback)((()=>d(!0)),[]),u=(0,a.useCallback)((()=>d(!1)),[]),g=(0,le().O)(),m=r.currentUser.id,h=(0,n().K8)((()=>V().d.state.inlineUsageErrorVisible),[]),S=(0,a.useCallback)((e=>{e.stopPropagation(),V().d.setState({...V().d.state,inlineUsageErrorVisible:!1})}),[]),v=(0,n().K8)((()=>t.state.configForNewTranscripts),[t]),{pfaFeatureLoadArgs:x,upsellFromForCheckoutBanner:C}=(0,n().K8)((()=>g&&m?(0,b().Lx)({clientStore:t,spaceId:g,userId:m}):{pfaFeatureLoadArgs:{name:"ai_usage",spaceId:g,userId:m,amount:0},upsellFromForCheckoutBanner:"ai_limit_in_app"}),[t,g,m]),w=(0,$()._X)(x);(0,a.useEffect)((()=>{V().d.setState({...V().d.state,featureAvailability:w})}),[w,v]);const{actionForFeatureAvailability:I,upsellMessage:k}=(0,ce().x)({featureAvailability:w,upgradeRequestAnalyticsEntrypoint:"ai_home_page",upgradeRequestEntrypoint:"ai_home_page",upsellFrom:C}),T=(0,o().IS)((e=>({animationWrapper:{zIndex:-1,position:"relative"},inlineUsageErrorContainer:{position:"absolute",top:-8,cursor:"pointer",backgroundColor:l?e.palette.uiBlue[100]:e.palette.uiBlue[50],color:e.text.secondary,fontWeight:y().Wy.medium,borderRadius:"0 0 12px 12px",padding:"16px 9px 8px 16px",display:"flex",alignItems:"center",fontSize:"12px",width:"100%",border:"none",justifyContent:"space-between",boxShadow:Tt({isPhone:i.isPhone,theme:e})},textWrapper:{textWrap:"pretty"}})),[i.isPhone,l]);return I||k?(0,St.jsx)("div",{style:T.animationWrapper,children:(0,St.jsx)(ie().A,{visible:!0,initial:{opacity:0,height:0,translateY:-100},animate:{opacity:h?1:0,height:h?50:0,visibility:h?"visible":"hidden",translateY:h?0:-100},exit:{opacity:0,height:0},config:{duration:500},children:(0,St.jsxs)("div",{role:"button",tabIndex:0,style:T.inlineUsageErrorContainer,onClick:I,onMouseOver:p,onMouseLeave:u,children:[(0,St.jsx)("div",{style:T.textWrapper,children:k}),(0,St.jsx)(M().A,{ariaLabel:c.formatMessage({id:"aiChatView.closeInlineError",defaultMessage:"Close"}),icon:oe().V,onClick:S})]})})}):null}var At=()=>r(549131),jt=()=>r(217514),Pt=()=>r(319117),Kt=()=>r(432229),Ft=()=>r(131448),Bt=()=>r(962730);const Dt={id:"research_mode_chat_history_tooltip",key:"research_mode_chat_history_tooltip",type:"static",props:{}};function Et(){const e=(0,f().tz)(),t=(0,s().v3)(),r=(0,a.useRef)(null),o=(0,n().K8)((()=>Ft().default.isVisible("research_mode_chat_history_tooltip")),[]);return(0,a.useEffect)((()=>{(0,We().HH)(t,"research_mode_chat_history_tooltip")}),[t]),(0,a.useEffect)((()=>{var e;o&&(null===(e=r.current)||void 0===e||e.focus())}),[o,r]),(0,St.jsx)(we().Ay,{popupType:we().nl.Popup,open:o,placementToOrigin:Bt().W.Bottom,alignmentToOrigin:Bt().C.End,disableMouseCapture:!0,enableOutsideClickDismiss:!0,trapFocus:!1,keepFocus:!0,originGap:8,render:()=>(0,St.jsx)(Kt().P,{title:e.formatMessage({id:"chatHistoryButton.callout.title",defaultMessage:"Chat history"}),body:e.formatMessage({id:"chatHistoryButton.callout.body",defaultMessage:"Find in-progress and completed research sessions here and in the 'Home' tab"}),buttonsProps:{type:"right-aligned",primary:{text:e.formatMessage({id:"chatHistoryButton.callout.button",defaultMessage:"Got it"}),onClick:()=>(0,We().OX)(t,Dt)}},onDismiss:()=>(0,We().OX)(t,Dt)}),origin:(0,St.jsx)(z().n,{onClickCallback:()=>(0,We().OX)(t,Dt),disableTooltip:o,ref:r})})}var Wt=()=>r(557336);const Ot="ai-chat-input-and-suggestion-container";function Rt(e){const{aiChatFeature:t,threadStore:r,onAfterThreadChange:c,defaultUserMessage:p,clientStore:u,parentStore:f,onLoaded:y}=e,v=(0,s().v3)(),I=(0,n().K8)((()=>v.RouterStore.state.route),[v.RouterStore]);(0,a.useEffect)((()=>{if("page"===I.name||"chat"===I.name||"home"===I.name){const e=I.targetConfig;if(e&&(0,g().bD)(e.type)){const t={...(0,i().bz)(e.type),...e};u.setState({...u.state,configForNewTranscripts:t})}}}),[I,u]);const M=(0,re().K)(t),[T,_]=(0,a.useState)(),A=(0,a.useRef)();(0,a.useEffect)((()=>{_(r)}),[r]);const j=(0,n().K8)((()=>(null==u?void 0:u.state.showDebug)??!1),[u]),{store:P,setValue:K}=(0,E().AI)({initialValue:(0,h().x9d)(p)});(0,H().i)({textStore:P,initialFocus:M.shouldHaveInitialFocusOnInput});const F=(0,a.useRef)(null),B=(0,a.useRef)(0),[z,G]=(0,a.useState)(!0),[ee,ne]=(0,a.useState)(!0),oe=(0,n().K8)((()=>M.isInSidebarMode||!(0,ae().av)(T)),[M.isInSidebarMode,T]),ie=(0,n().K8)((()=>M.showWelcomeMessage&&(0,ae().av)(T)),[M.showWelcomeMessage,T]),ce=(0,n().K8)((()=>{if(T&&!(0,ae().av)(T))return T.getTranscript().reverse().find((e=>"config"===e.type))}),[T]),le=null==ce?void 0:ce.value.type;(0,a.useEffect)((()=>{void 0!==(null==T?void 0:T.id)&&(null==T?void 0:T.id)!==A.current&&void 0!==ce&&(u.update((e=>({...e,configForNewTranscripts:ce.value}))),A.current=null==T?void 0:T.id)}),[null==T?void 0:T.id,ce,u]);const de=(0,o().IS)((e=>({columnContainer:{minHeight:0,...!oe&&{minHeight:void 0}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",...!oe&&{justifyContent:"center",minHeight:void 0}},contentWrapper:{flex:1,scrollbarGutter:"stable",overflowY:"auto",position:"relative",...!oe&&{flex:"0 1 auto"}},contentContainer:{margin:"0 auto",width:"100%",maxWidth:710,padding:20,marginLeft:"auto"},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:e.contentBackground,padding:M.chatInputWrapperPadding},fullPageWelcomeContainer:{textAlign:"center",marginBottom:24,display:"flex",flexDirection:"column",alignItems:"center"},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:8,borderRadius:20,backgroundColor:e.surface.wash,border:"none",cursor:"pointer",fontWeight:500,boxShadow:e.shadowLG,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:M.chatInputWidth,padding:M.chatInputPadding,marginLeft:"auto"},gradientMask:{width:"100%",height:M.isAgentChat?32:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(255, 255, 255, 0), ${e.contentBackground})`},overflowContainer:{overflowY:"auto",width:"100%",...!oe&&{overflowY:void 0}}})),[oe,M]),pe=(0,a.useCallback)((()=>{const e=F.current;if(!e)return;const t=e.scrollTop,r=t-B.current<0,a=e.scrollHeight-e.scrollTop-e.clientHeight<50;B.current=t,G(a),r&&!a&&ee&&ne(!1),"search"!==le&&a&&!ee&&ne(!0)}),[ee,le]);(0,a.useEffect)((()=>{const e=F.current;if(!e)return;e.addEventListener("scroll",pe);const t=new MutationObserver((()=>{ee&&(e.scrollTop=e.scrollHeight),setTimeout(pe,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(pe,100),()=>{e.removeEventListener("scroll",pe),t.disconnect()}}),[pe,ee]),(0,a.useEffect)((()=>{const e=F.current;if(!e)return;if("search"===le)return void ne(!1);const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,ne(!0)}),100);return()=>clearTimeout(t)}),[le]);const ue=(0,a.useCallback)((()=>{const e=F.current;e&&W().VG({element:e,environment:v,options:{top:e.scrollHeight,behavior:"smooth"}})}),[v]),ge=(0,a.useCallback)((()=>{ue(),ne(!0)}),[ue]),me=(0,n().O$)(U().AppStoreMainEditorCurrentBlockStore),he=(0,Wt().q)({threadStore:T,clientAiChatStore:u,setThreadStore:_,aiChatFeatureController:M,config:void 0}),fe=(0,n().O$)(se().bX),ye=(0,a.useCallback)((()=>{_(void 0)}),[_]),Se=(0,a.useCallback)((async e=>{await(0,x().closeAssistantRightHandSideMenu)({environment:v});const t=M.shouldMeasureInputToTranscriptRender?{metric:O().default.mark("ai_input_to_transcript_render"),surface:M.contextStepSurface}:void 0;if(u.setState({...u.state,userSelectedConfig:!0,userInputToTranscriptRenderMetric:t}),!e||0===e.length)return;if(!f)throw new Error("No parent store");if(!fe)throw new Error("No inference context");const{spaceStore:r,userStore:a}=fe;K(void 0);let s=V().d.state.featureAvailability;if(!s){const{pfaFeatureLoadArgs:e}=(0,b().Lx)({clientStore:u,spaceId:r.id,userId:a.id});s=await(0,$().Bw)(v,e)}if(!(0,m().e2)(s)&&M.shouldCheckFeatureAvailabilityBeforeSubmit)return void V().d.setState({...V().d.state,inlineUsageErrorVisible:!0});const n=(null==he?void 0:he.threadStore)??T,o=((null==n?void 0:n.getTranscript())||[]).find((e=>"search"===e.type));n&&o&&void 0===o.showResults&&(0,te().V)({environment:v,threadStore:n,stepId:o.id,showResults:!1,traceId:o.traceId});const i=(0,se().Kf)({environment:v,spaceStore:r,userStore:a,value:e}),d=null==n?void 0:n.getTranscript().findLast((e=>"context"===e.type)),p=u.state.configForNewTranscripts;if("setup-generator"===p.type)return void(0,J().openSelectedTemplateOnboardingModalForInAppFlows)({parentStore:r,template:l().XK,environment:v,aiPrompt:e,origin:"ai_chat",version:"build_with_ai",autoSubmit:!0});const g=t=>{if("researcher"===p.type){const a=(0,D().r4)(e,r),s=a.length,n=a.split(/\s+/).filter(Boolean).length;S().uH({environment:v,researchModeThreadId:t.id,queryLength:s,queryWords:n,searchSessionId:void 0,qnaSessionId:void 0,source:"welcome_page"})}};if(n){var h;const e=[],t=null===(h=u.getOrCreateClientAIChatThreadStore(n.id))||void 0===h?void 0:h.getAndClearStagedAssistantAttachmentSteps();if(t&&e.push(...t),(0,ae().av)(n)){const t=(0,se().Xd)({environment:v,inferenceContext:fe,config:p,addSteps:[...e,i],surface:M.contextStepSurface});return(0,q().addStepsToExistingThreadAndRun)({environment:v,spaceStore:r,userStore:a,threadStore:n,addSteps:t,waitForServerCommit:!0}),g(n),void c({oldThreadStore:T,newThreadStore:n,resetLocalThreadStore:ye})}const s=[];((null==d?void 0:d.value.collectionViewBlockId)??(null==d?void 0:d.value.blockId))!==(null==me?void 0:me.id)&&s.push((0,se().WM)({environment:v,inferenceContext:fe,surface:M.contextStepSurface})),t&&s.push(...t),s.push(i),(0,q().addStepsToExistingThreadAndRun)({environment:v,spaceStore:r,userStore:a,threadStore:n,addSteps:s,waitForServerCommit:!0}),ue()}else if("workflow"===p.type&&null!=me&&me.isCollectionView()){const e=(0,Q().Y)({environment:v,inferenceContext:fe,store:me,addSteps:[i]}),t=(0,q().addTranscriptToNewThreadAndRun)({environment:v,spaceStore:fe.spaceStore,transcript:e,blockId:me.id});c({oldThreadStore:T,newThreadStore:t,resetLocalThreadStore:ye})}else{const e=(0,se().Xd)({environment:v,inferenceContext:fe,config:p,addSteps:[i],surface:M.contextStepSurface}),t=(0,q().addTranscriptToNewThreadAndRun)({environment:v,spaceStore:fe.spaceStore,transcript:e});g(t),c({oldThreadStore:T,newThreadStore:t,resetLocalThreadStore:ye})}requestAnimationFrame((()=>{const e=L().n.findNodeFromStore(P);e&&e.focus()}))}),[v,u,f,K,null==he?void 0:he.threadStore,T,me,fe,ue,c,M,P,ye]),ve=(0,n().K8)((()=>(0,ae().av)(T)),[T]),be=(0,n().K8)((()=>Y().zD.isResearchModeRefactoredPlanningStepEnabled()),[]),xe=(0,a.useCallback)((e=>{const{transcript:t,threadId:r,runningInference:a}=e;return(0,N().dC)(t)?j?(0,N().BI)({transcript:t,threadId:r}):be?(0,N().nL)({transcript:t,runningInference:a??!1}):(0,N().an)({transcript:t,threadId:r,preserveNonResearcherSteps:!0}):t}),[j,be]),Ce=(0,n().K8)((()=>(0,X().Ke)()),[]);return(0,St.jsxs)(St.Fragment,{children:[M.supportsChatHeader&&(0,St.jsx)(zt,{aiChatFeatureController:M,threadStore:T,clientStore:u,onThreadChange:c,parentStore:f,resetLocalThreadStore:ye}),(0,St.jsx)(w().Y1,{height:"fill",direction:"vertical",children:(0,St.jsxs)(w().Y1,{height:"fill",direction:"horizontal",style:de.columnContainer,children:[M.supportsCollapsiblePanel&&Ce?(0,St.jsx)(C().z,{isOpen:j,width:{size:515,speed:"animate"},isResizable:!0,anchorToSide:"left",minSize:300,maxSize:900,children:(0,St.jsx)(jt().m,{clientStore:u,threadStore:T})}):null,(0,St.jsx)(w().Y1,{height:"fill",direction:"vertical",style:de.overflowContainer,children:(0,St.jsx)("div",{style:de.chatColumn,children:oe?(0,St.jsxs)(St.Fragment,{children:[(0,St.jsx)(Pt().F,{store:u}),(0,St.jsx)("div",{style:de.contentWrapper,ref:F,children:(0,St.jsxs)("div",{style:de.contentContainer,children:[(0,St.jsx)(At().Lm,{clientStore:u,threadStore:T,preprocessTranscript:xe,aiChatFeatureController:M}),(0,St.jsx)(Z().q,{clientStore:u,threadStore:T,userStore:void 0})]})}),(0,St.jsxs)("div",{style:de.inputWrapper,children:[(0,St.jsx)("button",{onClick:ge,style:{...de.scrollToBottomButton,...!z&&de.scrollToBottomButtonVisible},children:(0,St.jsx)(k().I,{icon:d().v,color:"primary"})}),(0,St.jsx)("div",{style:de.gradientMask}),(0,St.jsx)("div",{style:de.inputContainer,children:(0,St.jsx)(kt,{store:P,onSubmit:Se,clientStore:u,threadStore:T,showInitialModePicker:ve,aiChatFeatureController:M,loadAttachmentsData:he,onLoaded:y})})]})]}):(0,St.jsxs)("div",{style:de.inputWrapper,children:[ie&&(0,St.jsx)("div",{style:de.fullPageWelcomeContainer,children:(0,St.jsx)(R().L,{clientStore:u,marginTop:0,marginHorizontal:0,allPanelsLoaded:!0,showWelcomeAnimation:!1})}),(0,St.jsxs)("div",{className:Ot,style:de.inputContainer,children:[(0,St.jsx)(kt,{store:P,onSubmit:Se,clientStore:u,threadStore:T,showInitialModePicker:ve,aiChatFeatureController:M,loadAttachmentsData:he,onLoaded:y}),(0,St.jsx)(_t,{clientStore:u})]})]})})})]})})]})}function zt(e){const{aiChatFeatureController:t,onThreadChange:r,clientStore:i,threadStore:c,parentStore:l,resetLocalThreadStore:d}=e,p=(0,s().v3)(),u=(0,a.useContext)(F().eh),g=(0,n().O$)(G().b),m=(0,a.useCallback)((e=>{(0,ee().Wq)({environment:p,clientStore:i}),r({oldThreadStore:c,newThreadStore:e,resetLocalThreadStore:d})}),[i,r,p,c,d]),h=(0,P().m)({location:"AIChat"}),S=(0,n().K8)((()=>!(0,ae().av)(c)),[c]),v=(0,n().K8)((()=>{var e;const t=null==c||null===(e=c.getData())||void 0===e?void 0:e.title;return t&&0!==t.length?t:(0,St.jsx)(f().sA,{id:"aiInferenceTranscript.chat.untitled",defaultMessage:"Ask AI"})}),[c]),b=(0,n().K8)((()=>{var e;return!!c&&"researcher"===(null===(e=(0,ae().Ns)(c))||void 0===e?void 0:e.type)}),[c]),x=(0,o().IS)((()=>({leftContainer:{display:"flex",alignItems:"center",gap:8,paddingLeft:6},threadTitle:{maxWidth:280,...y().RC}})),[]),C=p.device.isElectron&&!g;return(0,St.jsx)("div",{className:C?B().sbV:void 0,children:(0,St.jsx)(j().W,{store:l,topbarFeatureController:h,isInvalidPage:!1,renderLeft:()=>t.supportsThreadHistoryPicker?(0,St.jsx)(ne().n,{threadStore:c,onThreadChange:m,parentStore:l}):(0,St.jsx)("div",{style:x.leftContainer,children:(0,St.jsx)(T().D,{style:x.threadTitle,styleName:"Body-14px/Regular",children:v})}),renderRight:()=>(0,St.jsxs)(St.Fragment,{children:[S?(0,St.jsx)(Ht,{onNewChat:()=>m(void 0)}):null,b?(0,St.jsx)(Et,{}):(0,St.jsx)(z().n,{}),(0,St.jsx)(Lt,{threadStore:c}),(0,St.jsx)(Nt,{clientStore:i}),u?(0,St.jsx)(_().A,{size:"lg",onClick:u,children:(0,St.jsx)(f().sA,{id:"chatSidebar.close",defaultMessage:"Close"})}):null]})})})}function Lt(e){const{threadStore:t}=e,r=(0,s().v3)(),i=((0,f().tz)(),(0,n().K8)((()=>{var e;return(null==t||null===(e=t.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[t]));(0,a.useCallback)((()=>{t&&!(0,ae().av)(t)&&v().createAndCommit({userAction:"AIChatHeader.toggleShareWithSpace",environment:r,canUndo:!0,perform:e=>{(0,ee().g6)({threadStore:t,transaction:e})}})}),[t,r]),(0,o().IS)((e=>({iconButton:{width:28,height:28},iconButtonIcon:{width:16,height:16,fill:i?e.icon.bluePrimary:e.icon.secondary}})),[i]),(0,n().K8)((()=>t&&!t.canEdit()),[t]),(0,n().K8)((()=>(0,c().q1)((null==t?void 0:t.getTranscript())??[])),[t]);return null}function Nt(e){const t=(0,f().tz)(),{clientStore:r}=e,s=(0,n().K8)((()=>r.state.showDebug),[r]),i=(0,K().gQ)(),c=(0,o().IS)((e=>({iconButton:{...i.iconButton,marginRight:0},iconButtonIcon:{width:16,height:16,fill:s?e.icon.uiBluePrimary:e.icon.tertiary}})),[s,i]),l=(0,a.useCallback)((()=>{r.setState({...r.state,showDebug:!r.state.showDebug})}),[r]);return(0,n().K8)((()=>(0,X().Ke)()),[])?(0,St.jsx)(A().A,{renderTooltip:()=>(0,St.jsx)("span",{children:"Debug"}),render:e=>(0,St.jsx)(M().A,{...e,icon:u().E,iconStyle:c.iconButtonIcon,style:c.iconButton,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:l})}):null}function Ht(e){let{onNewChat:t}=e;const r=(0,f().tz)(),a=(0,o().IS)((()=>({button:{gap:8}})),[]),s=r.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New chat"});return(0,St.jsx)(I().p,{style:a.button,iconLeading:()=>(0,St.jsx)(k().I,{size:"lg",icon:p().i}),ariaLabel:s,onClick:t,children:s})}},704338:(e,t,r)=>{r.d(t,{q:()=>n});var a=()=>r(645873);const s=new(a().O2)("WorkflowSetupInstructions",(async()=>await Promise.all([r.e(75134),r.e(16471),r.e(58550),r.e(44711),r.e(53321),r.e(90825),r.e(96346),r.e(55373),r.e(37353),r.e(29151),r.e(78191),r.e(62475),r.e(3151),r.e(98629),r.e(92845),r.e(84468),r.e(5605),r.e(48486),r.e(95794),r.e(13677),r.e(56952),r.e(48632),r.e(75078),r.e(25497),r.e(74562),r.e(27711),r.e(4422),r.e(11341),r.e(46414),r.e(95168),r.e(28271),r.e(34877),r.e(36908),r.e(17254),r.e(84185),r.e(32421),r.e(15315),r.e(24587),r.e(78708),r.e(43777),r.e(74752),r.e(91194),r.e(81197),r.e(98659),r.e(20502),r.e(6266),r.e(8184),r.e(83884),r.e(65881),r.e(99809),r.e(93282),r.e(43678),r.e(15019),r.e(90978),r.e(3910),r.e(77213),r.e(6912),r.e(30291),r.e(54220),r.e(19930),r.e(81768),r.e(52836),r.e(26483),r.e(31276),r.e(40863),r.e(25957),r.e(42510),r.e(97132)]).then(r.bind(r,652305)))),n=(0,a()._h)(s,(e=>e.WorkflowSetupInstructions))},755543:(e,t,r)=>{r.d(t,{n:()=>M});r(944114),r(898992),r(803949),r(581454),r(908872);var a=r(296540),s=()=>r(56366),n=()=>r(401497),o=()=>r(803960),i=()=>r(94701),c=()=>r(274570),l=()=>r(234459),d=()=>r(959013),p=()=>r(493823),u=()=>r(760217),g=()=>r(406699),m=()=>r(331542),h=()=>r(928600),f=()=>r(939740),y=()=>r(554509),S=()=>r(89924),v=()=>r(722872),b=()=>r(765957),x=()=>r(630116),C=()=>r(918052),w=r(474848);const I=(0,d().YK)({new_chat_title:{id:"WorkflowEditorTranscript.historyDropdown.newChatTitle",defaultMessage:"New chat"}});function M(e){const{threadStore:t,onThreadChange:r,parentStore:M}=e,k=(0,d().tz)(),T=(0,s().K8)((()=>{var e;const r=null==t||null===(e=t.getData())||void 0===e?void 0:e.title;return r||k.formatMessage(I.new_chat_title)}),[k,t]),_=Boolean(t),A=(0,n().IS)((e=>({checkIcon:{width:14},chevronDownIcon:{width:16,marginLeft:6,fill:e.icon.secondary,flexShrink:0},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{width:24,opacity:.2},threadTitleButton:{flexShrink:1,paddingRight:6},threadTitleInDropdown:{maxWidth:"250px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",flexShrink:1}})),[]),{status:j,value:P}=(0,C().s)({parentStore:M,threadStore:t}),K=(0,a.useCallback)((()=>(0,w.jsx)("div",{style:A.loadingStateContainer,children:(0,w.jsx)(m().A,{})})),[A.loadingStateContainer]),F=(0,a.useCallback)((()=>(0,w.jsx)("div",{style:A.loadingStateContainer,children:(0,c().clockIcon)(A.clockIcon)})),[A.loadingStateContainer,A.clockIcon]),B=(0,a.useCallback)((e=>{if("pending"===j)return[{key:"loading",render:e=>(0,w.jsx)(S().A,{...e,title:"Previous chats",shouldShowBottomDivider:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,w.jsx)(K,{})}]}];if(!P||0===P.length)return[{key:"empty",render:e=>(0,w.jsx)(S().A,{...e,title:"Previous chats"}),items:[{key:"empty-item",action:()=>{},render:()=>(0,w.jsx)(F,{})}]}];const a=[];let s=!1;const n=P.reduce(((e,t)=>{const r=new Date(t.created_at),a=new Date;a.setHours(0,0,0,0);const s=new Date(a);s.setDate(s.getDate()-1);const n=new Date(a);n.setDate(n.getDate()-7);const o=new Date(a);let i;return o.setDate(o.getDate()-30),i=r>=a?"today":r>=s?"yesterday":r>=n?"previous7days":r>=o?"previous30days":"older",e[i]||(e[i]=[]),e[i].push(t),e}),{});return[{key:"today",label:k.formatMessage({id:"aiInferenceTranscript.today",defaultMessage:"Today"})},{key:"yesterday",label:k.formatMessage({id:"aiInferenceTranscript.yesterday",defaultMessage:"Yesterday"})},{key:"previous7days",label:k.formatMessage({id:"aiInferenceTranscript.previous7days",defaultMessage:"Previous 7 days"})},{key:"previous30days",label:k.formatMessage({id:"aiInferenceTranscript.previous30days",defaultMessage:"Previous 30 days"})},{key:"older",label:k.formatMessage({id:"aiInferenceTranscript.older",defaultMessage:"Older"})}].forEach((o=>{let{key:c,label:d}=o;const p=n[c];if(null==p||!p.length)return;const g=s;s=!1,a.push({key:`history-${c}`,render:e=>(0,w.jsx)(S().A,{...e,title:d,topBorder:g}),items:p.map((a=>({key:a.id,action:()=>{const t=b().default.state.currentSpaceStore;if(!t)return;const s=x().Ei.createChildStore(t,{table:l().To,id:a.id,spaceId:t.id});r(s),e.close()},render:e=>(0,w.jsx)(u().A,{...e,title:a.title||k.formatMessage(I.new_chat_title),right:(null==t?void 0:t.id)===a.id?(0,i().checkmarkFillIcon)(A.checkIcon):void 0})})))})})),a}),[j,P,t,K,F,A.checkIcon,r,k]);return(0,w.jsx)(g().Ay,{popupType:g().z7.Popup,placementToOrigin:g().sx.Bottom,alignmentToOrigin:g().yP.Start,renderOrigin:e=>(0,w.jsxs)(p().p,{"aria-label":"history",...e,size:"md",style:A.threadTitleButton,children:[(0,w.jsx)(y().D,{styleName:"UIRegular-14px/Medium",style:A.threadTitleInDropdown,children:_?T:k.formatMessage(I.new_chat_title)}),(0,w.jsx)(w.Fragment,{children:(0,o().arrowChevronSingleDownIcon)(A.chevronDownIcon)})]}),render:e=>(0,w.jsx)(h().A,{menuType:v().gu.Popup,width:300,children:(0,w.jsx)(f().Ay,{type:f().Oh.Vertical,initialFocus:0,sections:B(e)})})})}},831081:(e,t,r)=>{r.d(t,{U:()=>s});r(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"3 3 10 10",svg:(0,r(474848).jsx)("path",{d:"M11.75 3h-7.5C3.56 3 3 3.56 3 4.25v7.5c0 .69.56 1.25 1.25 1.25h7.5c.69 0 1.25-.56 1.25-1.25v-7.5C13 3.56 12.44 3 11.75 3"})},s=(0,r(340498).wt)("mediaStopFillSmall",a)},915619:(e,t,r)=>{r.d(t,{PF:()=>T,Wn:()=>M,Yo:()=>k});r(581454);var a=r(296540),s=()=>r(484714),n=()=>r(56366),o=()=>r(401497),i=()=>r(370657),c=()=>r(609616),l=()=>r(234459),d=()=>r(155792),p=()=>r(959013),u=()=>r(436572),g=()=>r(2220),m=()=>r(624652),h=()=>r(28070),f=()=>r(128555),y=()=>r(515692),S=()=>r(356983),v=()=>r(285790),b=()=>r(859428),x=()=>r(594794),C=()=>r(140862),w=()=>r(805126),I=r(474848);function M(e){const{loadAttachmentsData:t,style:r}=e,{isMobile:n}=(0,s().Y0)(),i=(0,p().tz)(),l=(0,a.useCallback)((async()=>{t&&await t.uploadFile()}),[t]),d=(0,C().A)(!0),u=i.formatMessage({id:"assistantRichTextInput.insertAttachment.button.tooltip",defaultMessage:"Attach file"}),g=(0,o().IS)((e=>({tooltipSecondaryText:{color:e.text.contrastSecondary}})),[]);return(0,I.jsx)(b().A,{renderTooltip:()=>(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{children:u}),(0,I.jsx)("div",{style:g.tooltipSecondaryText,children:(0,I.jsx)(p().sA,{id:"assistantRichTextInput.insertAttachment.tooltip.supportedFormats",defaultMessage:"Most images and PDFs"})})]}),render:e=>(0,I.jsx)(v().A,{ariaLabel:u,icon:c().o,iconStyle:{width:n?19:20,height:n?19:20},style:{marginLeft:0,marginRight:0,width:(0,y().h6)(n),height:(0,y().h6)(n),...r},onClick:l,...e,...d})})}function k(e){const{loadAttachmentsData:{threadStore:t},clientStore:r}=e,s=(0,o().IS)((e=>({filePreviewWrapper:{width:"100%",paddingTop:4,paddingBottom:4,marginLeft:4}})),[]),i=(0,n().K8)((()=>r.getOrCreateClientAIChatThreadStore(t.id)),[r,t.id]),c=(0,n().K8)((()=>i.getStagedAttachmentUploadStoreIfExists()),[i]),l=(0,h().Jp)(c),d=(0,a.useCallback)((e=>{c&&(c.onDeleteFileUpload(e),i.unstageAttachmentInferenceTranscriptStep({fileId:e}))}),[c,i]);return l&&0!==l.length?(0,I.jsx)("div",{style:s.filePreviewWrapper,children:l.map((e=>{const{fileName:r}=e;return(0,I.jsx)(h().kp,{uploadProgress:e,permissionRecordOverride:t.pointer,onDeleteFile:"complete"===e.status?()=>d(e.fileUrl):void 0},r)}))}):null}function T(e){const{clientAiChatStore:t,threadStore:r,spaceStore:o,config:c,aiChatFeatureController:h}=e,y=(0,s().v3)(),v=(0,n().K8)((()=>{if(r&&t)return t.getOrCreateClientAIChatThreadStore(r.id)}),[t,r]),b=(0,n().K8)((()=>null==v?void 0:v.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore),[v]),C=(0,a.useCallback)((e=>{if(!v||!o)return;const t=v.getTemporaryAttachmentStagedDataOrInstantiate(),r=(0,x().Z1)({environment:y,table:d().mS,spaceId:o.id}),a=(0,i().jx)({uploadedFileData:e,id:r});v.stageAttachmentInferenceTranscriptStep({step:a}),t.stagedAttachmentUploadStore.onFileUploadCompleted(e.uploadIdentifier,e),(0,g().u)({environment:y,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:a.contentType,source:"custom_upload",framework:"inference_transcript"}}})}),[v,y,o]),I=(0,n().K8)((()=>h.analyticsSource(r)),[h,r]),M=(0,n().K8)((()=>(0,w().zj)({threadStore:r,clientStore:t})),[t,r]),k=(0,m().X)({currentSpaceId:null==o?void 0:o.id,progressOverrides:{threadPointer:r&&o?{spaceId:o.id,table:l().To,id:null==r?void 0:r.id}:void 0,onSuccess:C,progressStore:b},analyticsArgs:{configType:M.type,source:I}}),T=(0,S().z)({threadClientStore:v,config:c,clientChatStore:t,aiChatFeatureController:h}),_=(0,p().tz)(),A=(0,a.useCallback)((e=>{0!==e.files.length&&(T.canUpload?k({file:e.files[0],method:"paste"}):u().D6({label:_.formatMessage(f().E[T.reason])}))}),[T,_,k]),j=(0,a.useCallback)((async e=>{0!==e.length&&(T.canUpload?(await k({file:e[0],method:"paste"}),e.length>1&&u().D6({label:_.formatMessage({id:"aiInferenceTranscript.multipleFilesNotSupported",defaultMessage:"Only one attachment is supported at this time."})})):u().D6({label:_.formatMessage(f().E[T.reason])}))}),[T,_,k]);return{uploadAttachment:k,onPasteFiles:A,onDropFiles:j}}},921614:(e,t,r)=>{r.d(t,{d:()=>s});class a extends(()=>r(757695))().Store{getInitialState(){return{inlineUsageErrorVisible:!1,featureAvailability:void 0}}}const s=new a;r(604341).exposeDebugValue("AiChatInlineUsageErrorStore",s)},952816:(e,t,r)=>{r.d(t,{E:()=>s});r(296540);var a=r(474848);const s=(0,r(340498).wt)("bug",{viewBox:"0 0 64 64",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"m32,8c-5.55,0-9,3.83-9,10h18c0-6.17-3.45-10-9-10Z"}),(0,a.jsx)("path",{d:"m48,36h12v-4h-12v-6.01c2.74-.06,4.78-.94,6.76-2.92l4.24-4.24-2.83-2.83-4.24,4.24c-1.3,1.3-2.41,1.76-4.24,1.76h-13.69v32c6.15,0,10.63-3.12,12.7-8.47l1.54,1.54c1.3,1.3,1.76,2.41,1.76,4.24v2.69h4v-2.69c0-2.9-.88-5.02-2.93-7.07l-3.26-3.26c.12-.95.19-1.94.19-2.98v-2Z"}),(0,a.jsx)("path",{d:"m12.07,20.24l-4.24-4.24-2.83,2.83,4.24,4.24c1.98,1.98,4.02,2.85,6.76,2.92v6.01H4v4h12v2c0,1.04.07,2.03.19,2.98l-3.26,3.26c-2.05,2.05-2.93,4.17-2.93,7.07v2.69h4v-2.69c0-1.83.46-2.95,1.76-4.24l1.54-1.54c2.08,5.35,6.55,8.47,12.7,8.47V22h-13.69c-1.83,0-2.95-.46-4.24-1.76Z"})]})})}}]);