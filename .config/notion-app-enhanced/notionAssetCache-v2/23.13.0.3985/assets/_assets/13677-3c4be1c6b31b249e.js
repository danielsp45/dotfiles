"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[13677],{174723:(e,t,a)=>{a.d(t,{$Y:()=>u,AF:()=>s,Px:()=>m,Up:()=>d,dY:()=>p});a(898992),a(354520);var o=()=>a(662303),n=()=>a(427704),i=()=>a(939768),r=()=>a(780054),l=()=>a(22102),c=()=>a(630116);async function s(e,t){const a=await l().k.load();return e.filter((e=>{const o=e.getCopiedFromPointer();return Boolean(o&&a.isTemplate(o)&&Boolean(t&&t(o.id)))}))}function d(e){const t=window.location.href;return i().O$(t,{tg:e.templateGalleryItem})}function p(e){let t;return e instanceof c().$x?t=e.getBlockId():"type"in e?(e.type,t=e.template.rootId):t=e.rootId,t}function m(e){const t=o().locale&&"en-us"!==o().locale.toLocaleLowerCase()?`/${o().locale.toLowerCase()}`:"",a=void 0!==e?`${t}${n().JZ.templates}/${encodeURIComponent(e)}`:`${t}${n().JZ.templates}`;return`${r().A.domainBaseUrl}${a}`}function u(e){if(!e)return"";try{const a=JSON.parse(e);if("text"===a.content[0].content[0].nodeType){var t;const e=(null==a||null===(t=a.content)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value)||"";return e.replace(/^(#{2,6})\s+/gm,"# ")}}catch(a){return""}}},413677:(e,t,a)=>{a.r(t),a.d(t,{accept:()=>L,close:()=>O,createTemplateInstance:()=>F,loadAndDuplicatePageTemplate:()=>V,openWithItem:()=>N,previewItem:()=>$,setTemplateVisited:()=>G});a(16280);var o=()=>a(584262),n=()=>a(857639),i=()=>a(763884),r=()=>a(386164),l=()=>a(388821),c=()=>a(179034),s=()=>a(665344),d=()=>a(94830),p=()=>a(973647),m=()=>a(449506),u=()=>a(857783),v=()=>a(2220),g=()=>a(59110),_=()=>a(605605),S=()=>a(34542),I=()=>a(972435),f=()=>a(108944),b=()=>a(174723),y=()=>a(869562),T=()=>a(765957),C=()=>a(217429),h=()=>a(75368),w=()=>a(714818),k=()=>a(630116),A=()=>a(160568),P=()=>a(624550),M=()=>a(246826),E=()=>a(666144),R=()=>a(778417),B=()=>a(185544),D=()=>a(751156),x=()=>a(345913);const U="LastViewedTemplateId",z=(0,a(959013).YK)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error"}});function N(e){const{environment:t,item:a,createNewPage:o,isPrivate:n,disablePointerEvents:r,isCheckout:l=!1}=e;R().IU({environment:t}),w().A.setState({open:!0,item:a,createNewPage:o,isPrivate:n,isLoading:!1,disablePointerEvents:r,isCheckout:l}),i().K.set({userId:t.currentUser.id,key:U,value:a.rootId}),A().oO(t,{template_id:(0,b().dY)(a),from:o?"sidebar":"newPage"})}function $(e){let{templateItem:t,currentUserId:a}=e;const o=w().A.state.item;w().A.setState({...w().A.state,item:t}),o!==t&&i().K.set({userId:a,key:U,value:t.rootId})}function O(e){w().A.setState({item:w().A.state.item,open:!1}),R().IU({environment:e})}async function L(e){const{acceptFrom:t,item:a,environment:n,spaceStore:i,initializeStore:r,...l}=e;w().A.state.open&&w().A.setState({...w().A.state,isLoading:!0}),C().default.checkGate({gateName:"mobile_keep_template_gallery_open"})&&h().A.state.open&&h().A.setState({open:!1});const c=r?{...{...l,item:a,environment:n,spaceStore:i},initializeStore:r,type:"inExistingStore",useMinimalTemplates:!1}:{...{...l,item:a,environment:n,spaceStore:i},type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let s=!1;const d=Date.now();let p;try{var m;p=await F(c),s=!0;const e=null===(m=T().default.state.mainEditorCurrentBlockStore)||void 0===m?void 0:m.id;!p||e&&e===p.id||u().uK({environment:n,store:p,pageVisitSource:o().y8.Create,showMoveTo:!0}),O(n),n.device.isMobile&&(y().close(),h().A.setState({open:!1}))}finally{var v;const o=Date.now()-d,r=e.initializeStore?f().Uo(e.initializeStore):void 0,l=e.initializeStore?!r:e.isPrivate;A().BX(n,{destination:l?"private":"team",template_block_id:a.rootId,template_duplication_duration_ms:o,team_id:null==r?void 0:r.id,created_page_id:null===(v=p)||void 0===v?void 0:v.id}),A().hB(n,{from:"mobileApp",success:s,context:t,template_block_id:a.rootId,target_space_id:i.id,template_duplication_duration_ms:o,public_template_name:a.name,template_id:a.id})}}async function V(e){const{environment:t,initializeStore:a,item:o,isPrivate:n,useMinimalTemplates:i,spaceStore:c,spaceViewStore:s}=e,d=i?o.rootId:o.previewRootId,p=await m().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:d,spaceId:o.spaceId},shallow:!1},headers:(0,r().WS)({spaceId:o.spaceId})});let u;"success"===p.type&&(u=l().RecordMapWithRole.create(p.data.subtreeRecordMap));const S="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:f}=D().createAndCommit({userAction:S,environment:t,canUndo:!0,perform:e=>{const o=a||B().IT({environment:t,spaceStore:c,spaceViewStore:s,isPrivate:n,loading:!0,transaction:e});E()._O({environment:t,inMemoryRecordCache:o.inMemoryRecordCache,recordMap:u,debugSource:S});const i=(0,g().loadLocalSubtree)(t,{blockId:d,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0}).recordMap;if(!i)throw new Error(I().A.getIntl().formatMessage(z.clientCopyError));return(0,_().localDuplicate)({environment:t,sourceBlockId:d,targetBlockPointer:o.pointer,sourceBlockSubtree:i,targetInMemoryRecordCache:o.inMemoryRecordCache,transaction:e,options:{allowRedundancy:!0,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}}),o}}),b=f.getCollectionPointer();return(0,v().u)({environment:t,event:{eventName:"create_app_templates",eventProperties:{target_page_ids:[f.id],template_label:o.name,collection_ids:b?[b.id]:[]}}}),f}async function F(e){var t;const{environment:a,item:o,useRecordCache:i,useMinimalTemplates:r,spaceStore:l,isOnboarding:m,from:u,type:v,initializeStore:g,teamStore:_,onSuccess:I,onError:f,isEmailShared:b}=e,y=i&&!r?o.previewRootId:o.rootId,T={id:y,spaceId:o.spaceId},h=m?"onboarding":null!==(t=o.marketplaceTemplateMetadata)&&void 0!==t&&t.isMobileMarketplaceTemplate?"mobile_app":"homepage_team"===u?"team_home":void 0,w=await(0,S().oC)(a,y),A=h?{context:"",source:h,isListedTemplate:Boolean(w),isFirstPartyPaidTemplate:void 0!==w&&(0,d().Z1)(w),isEmailShared:b}:void 0;let M=!1,E=l;const R=new(k().Bv)(a,{table:c().ev,id:T.id,spaceId:T.spaceId});if("inExistingStore"===v&&g){if(E=g,g.isEmptyPage()){const e=g.getParentStore();e&&e.canEdit()&&("block"===e.table||"space"===e.table||"team"===e.table)&&(M=!0,E=e)}}else"inTeam"===v&&_&&(E=_);const B=C().default.checkGate({gateName:"use_local_duplication_for_onboarding"});A||n().log({level:"warning",from:"pageTemplateModalActions.createTemplateInstance",type:"templateInstallationMetadataNotSet",data:{miscDataToConvertToString:{template_id:o.id,template_block_id:o.rootId,target_space_id:l.id,public_template_name:o.name,isOnboarding:m,from:u,type:v}}});const U=C().default.checkGate({gateName:"enable_local_duplication_for_non_marketplace_templates"}),z=!(0,s().Fe)(null==A?void 0:A.source)&&U||B&&"onboarding"===h,N="onboarding"===h,$=await P().Jx({environment:a,store:R,newParentStore:E,addCopyName:!1,duplicateOnlyCollectionSchema:!1,unlockPage:!0,templateInstallationMetadata:A,shouldAttemptServerBackedLocalDuplication:z,shouldUseSynchronousDuplicationAPI:N,from:u??(m?"onboarding":void 0)});if($){if(p().Q.isSuccess($)&&$.value.length>0){const e=$.value[0];if(M&&g){const t=g;try{await t.waitUntil((()=>t.isDefined()));const{serverCommitResult:o}=D().createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplateInPlace",environment:a,canUndo:!0,perform:e=>{x().oD({environment:a,blocks:[t],transaction:e,permanentlyDelete:!0})}});return await o,e}catch(O){n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplateInPlace",type:"transactionError",data:{miscDataToConvertToString:{error:O}}})}}return null==I||I(e),e}return null==f||f(),void n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplate",type:"duplicateTemplateError",data:{miscDataToConvertToString:{error:$.error,template_id:o.id,template_block_id:o.rootId,target_space_id:l.id,public_template_name:o.name}}})}}function G(e){const{item:t,transaction:a,spaceViewStore:o}=e;if(o){const e=o.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);M().zv({store:o,data:{visited_templates:n},transaction:a})}}}}}]);